function bizagiQueue(){var e=this,t=[];e.add=function(e){t.push({callbacks:[e]})},e.addParallel=function(i){if(0==t.length)return e.add(i);t[t.length-1].callbacks.push(i)},e.execute=function(){for(var e=new $.Deferred,i=e.promise(),r=t.length,a=0;a<r;a++)i=i.pipe(function(){var e=t.shift();return $.when.apply($,$.map(e.callbacks,function(e){return"function"==typeof e?e():e}))});return e.resolve(),i=i.done(function(){t=[]})}}!function(e){e.widget("ui.bizagi_grid",{options:{id:"no-id",columns:[],sortBy:"",sortType:"asc",showSummary:!1,collapse:!1,collapseState:!1,data:{},indexedData:{},maxColumns:0,buttonsPst:!1,title:"",tableCssClass:"",headerStyles:"",floatingHeader:!1,template:{grid:"",waiting:"",table:"",emptyTable:"",column:"",specialColumn:"",row:"",rowButtons:"",cell:"",specialCell:"",pager:"",buttons:"",dynamicPager:"",summary:"",summaryCell:""},actions:{add:!0,edit:!0,remove:!0,details:!0,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1},mode:"execution"},_init:function(){var t=this,i=t.options,r=t.element;t.page=1,t.changes={},t.totalRows=0,t.totalPages=0,t.data=i.data,t.selectedRow=0,t.components={},t.buttons={},t.asyncCells={},t.scrollableArea=i.scrollableArea||t,t.columnByIndex={},t.columnByName={},t.columnKeyIndex=0,e.each(i.columns,function(e,i){i.key=void 0!==i.key&&i.key,i.label=void 0!==i.label?i.label:i.name,i.sortType="asc",i.tooltip=void 0!==i.tooltip?i.tooltip:"",t.columnByIndex[i.index]=i,t.columnByName[i.name]=i,i.key&&(t.columnKeyIndex=i.index)}),i.sortBy=i.sortBy||t.columnByIndex[0].name,t.columnByName[i.sortBy]?t.columnByName[i.sortBy].sortType=i.sortType:t.columnByName[i.sortBy.split(".")[0]]&&(t.columnByName[i.sortBy.split(".")[0]].sortType=i.sortType),r.addClass("ui-bizagi-grid-wrapper"),r.attr("data-bizagi-id",i.id),t.calculateKeyIndex(),t.collapseState=i.collapseState,t.startLoading(!1)},startLoading:function(t){var i=this;if(t=void 0===t||t,"execution"==i.options.mode&&void 0!==i.options.sortBy){var r=function(){var t=i.element,r=i.options;i.waitingTimeout=null,t.append(e.fasttmpl(r.template.waiting))};t?i.waitingTimeout=setTimeout(r,250):r()}},endLoading:function(){var e=this,t=e.element;e.waitingTimeout&&(clearTimeout(e.waitingTimeout),e.waitingTimeout=null),t.empty()},setData:function(e){var t=this;t.data=e,t.calculateKeyIndex(),t.refresh()},getData:function(){return this.data},calculateKeyIndex:function(){var t=this,i=t.options.columns,r=t.data;indexedData={},r.rows&&e.each(r.rows,function(t,r){var a;e.each(i,function(e,t){t.key&&(a=r[e])}),indexedData[a]=r}),t.indexedData=indexedData},getChanges:function(){},refresh:function(){var e=this;e._cleanComponents(),e._cleanButtons(),e.components={},e.draw()},refreshSummary:function(e){var t=this,i=t.options,r=t._getComponent("summary");t.drawing||r&&i.showSummary&&(e?t.refreshSummaryCell(e):(r.empty(),r.append(t.drawSummary()),t.postRenderSummary(r)))},refreshSummaryCell:function(t){var i=this,r=(i.options,i._getComponent("summary")),a=function(t,i){var r=t.is("[data-bizagi-component=summary-cells]")?t.children():t.find("[data-bizagi-component=summary-cells]").children();return e(r[i])},n=a(r,t),o=i.columnByIndex[t];if(!o.key){var s=i.drawSummaryCell(o);n.replaceWith(s),n=a(r,t),i.onCellReady(o,"summary",n,!1)}},changeCellValue:function(e,t,i){this.indexedData[e]&&(this.indexedData[e][t]=i)},draw:function(){var t=this,i=t.options,r=t.element;if(t.drawing=!0,t.endLoading(),"rtl"==i.orientation)var a=e.fasttmpl(i.template.gridRtl,{label:i.title,buttonsPst:i.buttonsPst,collapse:i.collapse,collapseState:t.collapseState,isDesign:"design"===i.mode});else a=e.fasttmpl(i.template.grid,{label:i.title,buttonsPst:i.buttonsPst,collapse:i.collapse,collapseState:t.collapseState,isDesign:"design"===i.mode});if(a=t.drawTable(a),t.grid=e(a).appendTo(r),t.postRender(t.grid),t.attachPaginator(),t.attachHandlers(),"execution"==i.mode&&i.floatingHeader){var n=t._getComponent("table");e("table",n).stickyTableHeaders({scrollableArea:t.scrollableArea,zIndex:1e3})}0==t.data.rows.length?(t._getComponent("table").hide(),t._getComponent("pager").hide(),t._getButton("remove").hide(),t._getButton("edit").hide(),t._getComponent("dynamicPager").hide(),t._getComponent("emptyTable").show()):(t._getComponent("table").show(),t._getButton("remove").show(),t._getButton("edit").show(),t._getComponent("emptyTable").hide(),i.actions.allowMore?(t._getComponent("dynamicPager").show(),t._getComponent("pager").hide()):(t._getComponent("pager").show(),t._getComponent("dynamicPager").hide()),i.actions.edit&&t._getButton("edit").show(),i.actions.enableXlsExport||i.actions.enablePdfExport?t._getButton("show-grid-export-options").show():t._getButton("show-grid-export-options").css("display","none")),"undefined"!=typeof Windows&&t.grid.find(".bz-rn-grid-data-wraper").addClass("bz-rn-grid-data-wraper-fix-w8"),t.drawing=!1},attachPaginator:function(){},drawTable:function(t){var i=this,r=i.options,a=e.fasttmpl(r.template.table,{showSummary:r.showSummary,tableCssClass:r.tableCssClass}),n=e.fasttmpl(r.template.emptyTable);return a=i._replaceElement(a,"columns",i.drawHeader()),a=i._replaceElement(a,"rows",i.drawBody()),r.showSummary&&(a=i._replaceElement(a,"summary",i.drawSummary())),t=i._replaceElement(t,"pager",i.drawPager()),t=i._replaceElement(t,"buttons",i.drawButtons()),t=i._replaceElement(t,"gridExportOptions",i.drawGridExportOptions()),t=i._replaceElement(t,"rowButtons",i.drawRowButtons()),t=i._replaceElement(t,"dynamicPager",i.drawDynamicPager()),t=i._replaceElement(t,"table",a),t=i._replaceElement(t,"emptyTable",n)},isExactMatch:function(){for(var e=this.options.columns,t=this.options.sortBy,i=0,r=e.length;i<r;)if(t==e[i++].name)return!0;return!1},drawHeader:function(){var t=this,i=t.options,r="",a=!1;return t.exactMatch=t.isExactMatch(),e.each(i.columns,function(e,i){a||(t.options.maxColumns>0?e<=t.options.maxColumns?r+=t.drawColumn(i):(r+=t.drawSpecialColumn(i),a=!0):r+=t.drawColumn(i))}),r},drawColumn:function(t){var i=this.options,r=t.bizAgiProperties||{},a=r.cssclass?r.cssclass:"",n=i.headerStyles?i.headerStyles.header:"";return n+=(""!==n?"; text-align:":"text-align:")+(r.columntitlealign?r.columntitlealign:"center"),e.fasttmpl(i.template.column,e.extend({},t,{isKey:t.key,sortActive:t.name===i.sortBy?t.name===i.sortBy:t.name===i.sortBy.split(".")[0]&&!this.exactMatch&&t.name===i.sortBy.split(".")[0],sortType:i.sortOrder,tooltip:t.tooltip||"",columnCssClass:a,headerLabelStyles:i.headerStyles?i.headerStyles.label:"",headerStyles:n}))},drawSpecialColumn:function(){var t=this.options;return e.fasttmpl(t.template.specialColumn)},drawDynamicPager:function(){var t=this.options;return e.fasttmpl(t.template.dynamicPager)},drawBody:function(){var t=this,i="";return e.each(t.data.rows,function(e,r){i+=t.drawRow(r)}),i},drawRow:function(t,i){var r=this,a=r.options,n=t[r.columnKeyIndex],o=i||!1,s=Math.floor(1e4*Math.random()),l=e.fasttmpl(a.template.row,{key:s,isNewRow:i,businessKey:n}),d="",c=!1;return e.each(t,function(e,t){c||(r.options.maxColumns>0?e<r.options.maxColumns+1?d+=r.drawCell(e,n,t,o):(d+=r.drawSpecialCell(e,n,t),c=!0):d+=r.drawCell(e,n,t,o))}),l=r._replaceElement(l,"cells",d)},drawSummary:function(){var t=this,i=t.options,r=e.fasttmpl(i.template.summary),a="";return e.each(i.columns,function(e,i){t.options.maxColumns>0?e<=t.options.maxColumns&&(a+=t.drawSummaryCell(i)):a+=t.drawSummaryCell(i)}),r=t._replaceElement(r,"summary-cells",a)},drawSummaryCell:function(t){var i=this,r=i.options,a=t.bizAgiProperties||{},n=a.columnAlign?a.columnAlign:"center",o=e.fasttmpl(r.template.summaryCell,{hidden:t.hidden||!1,summarizeBy:t.summarizeBy,cellAlign:n}),s=i.onDrawCell(t,"summary",i.calculateSummary(t),!1);return(s=null!=s&&"number"!=typeof s?s.replace("summaryValue",i.calculateSummary(t)):s)||(s=""),"object"==typeof s&&s.done?"resolved"===s.state()?o=i._replaceElement(o,"cellContent",i.resolveResult(s)):(o=i._replaceElement(o,"cellContent",""),i.asyncCells[key+"-"+columnIndex]=s):o=i._replaceElement(o,"cellContent",s),o},drawCell:function(t,i,r,a){var n=this,o=n.options;a=a||!1;var s="";if(!n.columnByIndex[t])return"";t>0&&(s=n.columnByIndex[t].bizAgiProperties&&n.columnByIndex[t].bizAgiProperties.messageValidation);var l=n.columnByIndex[t].bizAgiProperties||{},d=l.cssclass?l.cssclass:"",c=l.columnAlign?l.columnAlign:"center",u=e.fasttmpl(o.template.cell,{isKey:n.columnByIndex[t].key,hidden:o.columns[t].hidden||!1,isDesign:"design"===o.mode,messageValidation:s,columnCssClass:d,id:o.columns[t].bizAgiProperties?o.columns[t].bizAgiProperties.id:void 0,cellAlign:c}),p=n.onDrawCell(n.columnByIndex[t],i,r,a);return p||(p=""),"object"==typeof p&&p.done?"resolved"===p.state()?u=n._replaceElement(u,"cellContent",n.resolveResult(p)):(u=n._replaceElement(u,"cellContent",""),n.asyncCells[i+"-"+t]=p):u=n._replaceElement(u,"cellContent",p),n.columnByIndex[t].cell=e(u),u},resolveResult:function(e){var t;return e.done(function(e){t=e}),t},drawSpecialCell:function(t){var i=this.options;return this.columnByIndex[t]?e.fasttmpl(i.template.specialCell):""},drawGroupHeader:function(){},drawFooter:function(){},drawPager:function(){for(var t=this,i=t.options,r=[],a=1;a<=t.data.total;a++)r.push({number:a,active:a==t.data.page});return e.fasttmpl(i.template.pager,{page:t.data.page,pages:r,records:t.data.records})},drawButtons:function(){var t=this.options,i=t.tooltips||{},r=e.extend(t.actions,i);return this._canShowButtons()?"rtl"==t.orientation?e.fasttmpl(t.template.buttonsRtl,r):e.fasttmpl(t.template.buttons,r):""},drawGridExportOptions:function(){var t=this.options,i=t.actions;tooltips=t.tooltips||{};var r=e.extend({enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},tooltips);return e.fasttmpl(t.template.exportOptions,r)},drawRowButtons:function(){var t=this.options;return this._canShowRowButtons()?"rtl"===t.orientation?e.fasttmpl(t.template.rowButtons.rtl,t.actions):e.fasttmpl(t.template.rowButtons,t.actions):""},postRender:function(){var t=this,i=t.options,r=t._getComponent("cells");if(r&&e.each(r,function(i,r){r=e(r),t.postRenderRow(r)}),i.showSummary){var a=t._getComponent("summary");t.postRenderSummary(a)}t._triggerHandler("gridControlReady")},postRenderRow:function(t){var i=this,r=t.attr("data-business-key"),a=t.attr("data-new-row"),n=t.is("[data-bizagi-component=cells]")?t.children():t.find("[data-bizagi-component=cells]").children();e.each(n,function(t,n){var o=i.columnByIndex[t];if(!o.key){var s=i.asyncCells[r+"-"+o.index];s?e.when(s).done(function(t){(n=e(n)).append(t),i.onCellReady(o,r,n,a)}):i.onCellReady(o,r,e(n),a)}})},postRenderSummary:function(t){var i=this,r=t.is("[data-bizagi-component=summary-cells]")?t.children():t.find("[data-bizagi-component=summary-cells]").children();e.each(r,function(t,r){var a=i.columnByIndex[t];if(!a.key){var n=i.asyncCells[key+"-"+a.index];n?e.when(n).done(function(t){(r=e(r)).append(t),i.onCellReady(a,"summary",r,!1)}):i.onCellReady(a,"summary",e(r),!1)}})},attachHandlers:function(){},selectDynamicPager:function(){this.onDynamicPager()},changePage:function(e){var t=this,i=Number(t.data.page),r=t.data.total,a=e;if("previous"===e){if(!(i>1))return;a=i-1}if("next"===e){if(!(i<r))return;a=i+1}t._cleanComponents(),t.page=Number(a),t.onPageRequested()},isValid:function(){return this._triggerHandler("isValid")},sortBy:function(e,t){var i=this.options,r=this.columnByIndex[e];if(void 0===i.sortBy)return!0;void 0===r.name&&(r.name=r.label),t=r.name==i.sortBy?t||("asc"==i.sortOrder?"desc":"asc"):r.name==i.sortBy.split(".")[0]?t||("asc"==i.sortType?"desc":"asc"):t||i.sortType,i.sortBy.split(".").length>1?(i.sortBy.split(".")[0],r.name,i.sortBy=r.name):i.sortBy=r.name,void 0!==r.bizAgiProperties.sortAttribute&&-1!==r.bizAgiProperties.type.indexOf("column")&&(i.sortBy=r.name+"."+r.bizAgiProperties.sortAttribute),i.sortColumn=r,i.sortType=t,i.sortOrder=t,this._cleanComponents(),this.onSortRequested()},selectRow:function(e,t){var i=this;i.selectedRow==e?(i.onRowUnselected(),i.selectedRow=0,i.selectedBusinessKey=0):(0!=i.selectedRow&&i.onRowUnselected(),i.selectedRow=e,i.selectedBusinessKey=t,i.onRowSelected())},unselectRow:function(){0!=this.selectedRow&&(this.onRowUnselected(),this.selectedRow=0,this.selectedBusinessKey=0)},calculateSummary:function(t){var r=this,a=t.summarizeBy;e.each(r.data.rows,function(e,i){void 0!==r.data.rows[e][t.index]&&null==r.data.rows[e][t.index]&&null!=t.bizAgiProperties.defaultvalue&&(r.data.rows[e][t.index]=t.bizAgiProperties.defaultvalue)});var n,o=e.map(r.data.rows,function(e,i){return e[t.index]});if(0==o.length)return 0;if("sum"===a)n=0,e.each(o,function(e,t){null!=t&&(n+=Number(t))});else if("min"===a)n=o[0]||0,e.each(o,function(e,t){"number"==typeof t&&null!=t&&t<n&&(n=Number(t))}),n===Math.max()&&(n=null);else if("max"===a)n=o[0]||0,e.each(o,function(e,t){"number"==typeof t&&null!=t&&t>n&&(n=Number(t))}),n===Math.min()&&(n=null);else if("avg"===a)n=0,e.each(o,function(e,t){null!=t&&(n+=Number(t))}),n/=o.length;else if("count"===a)for(n=0,o=r.data.rows,i=0;i<o.length;i++){var s=o[i][t.index];s instanceof Array&&s.length>0?n+=1:s instanceof Array||null===s||""===s||(n+=1)}return n},processAction:function(e,t){var i=this;"add"==e&&i.onAddRow(),"edit"==e&&i.onEditRow(),"remove"==e&&i.onDeleteRow(),"more"==e&&i.onShowMore(t.key),"details"==e&&i.onShowDetails(t),"show-grid-export-options"==e&&i.onShowExportGridOptions()},onPageRequested:function(){return this.startLoading(),this._triggerHandler("pageRequested",this._buildRefreshParameters())},onSortRequested:function(){return this.startLoading(),this._triggerHandler("sortRequested",this._buildRefreshParameters())},onRowSelected:function(){return this._triggerHandler("rowSelected",{key:this.selectedBusinessKey})},onRowUnselected:function(){return this._triggerHandler("rowUnselected",{key:this.selectedBusinessKey})},onCollapseGrid:function(){return this._triggerHandler("performCollapseGrid")},onDynamicPager:function(){return this._triggerHandler("moreRows",{key:this.selectedBusinessKey})},onDrawCell:function(e,t,i,r){return this._triggerHandler("drawCell",{column:e,key:t,value:i,isNewRow:r})},onCellReady:function(e,t,i,r){return this._triggerHandler("cellReady",{column:e,key:t,cell:i,isNewRow:r})},onDrawControl:function(){},onDrawGroupHeader:function(){},onAddRow:function(){return this._triggerHandler("addRow")},onEditRow:function(){return this._triggerHandler("editRow",{key:this.selectedBusinessKey})},onDeleteRow:function(){return this._triggerHandler("deleteRow",{key:this.selectedBusinessKey})},onShowMore:function(e){return this._triggerHandler("showMore",{key:e})},onShowDetails:function(){return this._triggerHandler("showFormDetails",{key:this.selectedBusinessKey})},onShowExportGridOptions:function(){return this._triggerHandler("showGridExportOptions")},_replaceElement:function(e,t,i){return e.replace("{{element "+t+"}}",i)},_buildRefreshParameters:function(){var e=this.options,t=null!=e.sortColumn?e.sortColumn.index:1;return{page:this.page,sortBy:e.sortBy,sortType:e.sortOrder,sortColumnIndex:t}},_triggerHandler:function(e,t){var i=this.options[e];return i?i.call(this.element[0],t):null},_getComponent:function(t){var i=this.element;if(!this.components[t]){var r=e("[data-bizagi-component="+t+"]",i);null!=r&&r.length>0&&(this.components[t]=r)}return this.components[t]},_getButton:function(t){var i=this.element;return this.buttons[t]||(this.buttons[t]=e("[data-action="+t+"]",i)),this.buttons[t]},_cleanComponents:function(){this.components={}},_cleanButtons:function(){this.buttons={}},_canShowButtons:function(){return!0},_canShowRowButtons:function(){return!0}})}(jQuery),function(e){e.widget("ui.bizagi_grid_tablet",e.ui.bizagi_grid,{attachHandlers:function(){var t=this;t._getComponent("pager").find("ul li").bind("click",function(){var i=parseInt(e(this).attr("data-page-number"));i&&t.changePage(i)}),t._getComponent("dynamicPager").find("input").bind("click",function(){t.selectDynamicPager()}),t._getComponent("columns").find(".ui-bizagi-grid-column").bind("click",function(){if(t.isModeOnline()){var i=e(this).attr("data-column-index");t.sortBy(i)}}),t._getComponent("rows").find("tr").bind("click",function(){var i=e(this).attr("data-key"),r=e(this).attr("data-business-key");t.selectRow(i,r)}),t._getComponent("buttons").find("[data-action]").bind("click",function(){"totalizer"===e(this).attr("data-action")?t.totalizer():(t.processAction(e(this).attr("data-action")),t.unselectRow())}),t._getComponent("rowButtons").find("[data-action]").bind("click",function(){t.processAction(e(this).attr("data-action")),t.unselectRow()}),t._getComponent("rows").find("[data-action=more]").bind("click",function(i){i.stopPropagation();var r=e(this).parents("[data-bizagi-component=cells]").attr("data-business-key");t.processAction(e(this).attr("data-action"),{key:r})})},totalizer:function(){this.options.totalData()},onRowSelected:function(){e.ui.bizagi_grid.prototype.onRowSelected.apply(this,arguments),this._showRowButtons()},onRowUnselected:function(){e.ui.bizagi_grid.prototype.onRowUnselected.apply(this,arguments),this._hideRowButtons()},getCell:function(t,i,r){var a=this._getComponent("rows").find("[data-business-key="+t+"]"),n="";return n=r<4?e("td",e(a))[r+1]:e("td:visible",e(a))[r],e(n)},_canShowButtons:function(){var e=this.options.actions;return this.isModeOnline()?e.add:e.add||e.remove||e.edit||e.inlineAdd},drawPager:function(){var t=this,i=t.options,r=[];renderPages=[];for(var a=1;a<=t.data.total;a++)r.push({number:a,active:a==t.data.page});t.data.page<3||t.data.page>t.data.total-2?renderPages=[]:renderPages=[t.data.page-1,t.data.page,t.data.page+1];var n={renderPages:renderPages,pages:r,pagination:{totalPages:t.data.total,currentPage:t.data.page}};return e.fasttmpl(i.template.pager,n)},_canShowRowButtons:function(){var e=this.options.actions;return!!this.isModeOnline()&&(e.edit||e.remove)},_showRowButtons:function(){var t=this,i=window.document,r=t.element,a=r.find("[data-bizagi-component=rows] tr[data-key="+t.selectedRow+"]");if(a.addClass("ui-bizagi-state-selected"),t.isModeOnline()){var n=t._getComponent("rowButtons");n.show(),n.find(".ui-bizagi-grid-row-buttons").show(),n.position({my:"right",at:"left",of:a,collision:"none",offset:"-5 0"}),n.css("left")&&Number(n.css("left").replace("px",""))<0&&n.css("left","0"),setTimeout(function(){n.click(function(e){e.stopPropagation()}),r.find("[data-bizagi-component=rows]").click(function(e){e.stopPropagation()}),e(i).one("click",function(){t.unselectRow()})},100)}else{t._getComponent("buttons").find("[data-action=remove]").removeClass("ui-grid-buttons-hidden")}},_hideRowButtons:function(){var t=this;(e.ui.bizagi_grid.prototype.onRowUnselected.apply(t,arguments),t._getComponent("rows").find("tr[data-key="+t.selectedRow+"]").removeClass("ui-bizagi-state-selected"),t.isModeOnline())?t._getComponent("rowButtons").hide():t._getComponent("buttons").find("[data-action=remove]").addClass("ui-grid-buttons-hidden")},getNewRowKeys:function(t){return t=t||this._getComponent("rows").find("[data-new-row=true]"),e.map(t,function(t,i){return e(t).data("business-key")})},processAction:function(t){e.ui.bizagi_grid.prototype.processAction.apply(this,arguments),"save"===t&&this.onSaveAddedRows(),"cancel"===t&&this.onCancelEdition()},isNewRecord:function(t){var i=this._getComponent("rows");return!(!i||(t=i.find("[data-business-key='"+t+"']"),!e(t).data("new-row")))},addInlineRow:function(){var t=this;t._triggerHandler("beforeInlineAdd");var i=t.drawRow(t.createAddRowData(),!0),r=e(i);t.postRenderRow(r),t._getComponent("rows").append(r);var a=t._getComponent("buttons");t.isModeOnline()?(a.find("[data-action=save]").css("display","inline-block"),a.find("[data-action=cancel]").css("display","inline-block")):(a.find("[data-action=save]").removeClass("ui-grid-buttons-hidden"),a.find("[data-action=cancel]").removeClass("ui-grid-buttons-hidden")),0===t.data.rows.length&&(t._getComponent("table").show(),t._getComponent("emptyTable").hide()),t._triggerHandler("afterInlineAdd")},createAddRowData:function(){var t=this,i=t.options,r=[];return e.each(i.columns,function(e){if(e===t.columnKeyIndex){var i=Math.ceil(1e5*Math.random());r.push(i)}else r.push(null)}),r},onAddRow:function(){if(this.options.actions.add)return this.options.actions.inlineAdd?this.addInlineRow():this._triggerHandler("addRow")},onCancelEdition:function(){var e=this,t=e._getComponent("rows").find("[data-new-row=true]"),i=e._getComponent("rows").find("[data-new-row=false]");t.detach();var r=e._getComponent("buttons");return e.isModeOnline()?(r.find("[data-action=save]").hide(),r.find("[data-action=cancel]").hide()):(r.find("[data-action=save]").addClass("ui-grid-buttons-hidden"),r.find("[data-action=cancel]").addClass("ui-grid-buttons-hidden")),0===i.length&&(e._getComponent("table").hide(),e._getComponent("emptyTable").show()),e._triggerHandler("cancelEdition",{keys:e.getNewRowKeys(t)})},onSaveAddedRows:function(){var t=this,i=t.getNewRowKeys(),r=t._getComponent("buttons");if(i.length>=1&&t.isValid()){var a=t._getComponent("rows");return t.isModeOnline()?(r.find("[data-action=save]").hide(),r.find("[data-action=cancel]").hide(),t._triggerHandler("saveAddedRows",{keys:i}),t._triggerHandler("removeNewRecords",{keys:i})):(e.each(i,function(t,i){var r=a.find("[data-business-key='"+i+"']");e(r).attr("data-new-row","false")}),r.find("[data-action=save]").addClass("ui-grid-buttons-hidden"),r.find("[data-action=cancel]").addClass("ui-grid-buttons-hidden"),t._triggerHandler("saveAddedRows",{keys:i}),!0)}return!0},isModeOnline:function(){return!(void 0!==this.options.isOfflineForm&&bizagi.util.parseBoolean(this.options.isOfflineForm))}})}(jQuery),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.context=void 0!==bizagi.context?bizagi.context:{},bizagi.util.randomNumber=function(e,t){return e=e||1,t=t||1e7,Math.floor(Math.random()*(t-e+1))+e},bizagi.resolveResult=function(e){var t;return e.done(function(e){t=e}),t},bizagi.util.identicalObjects=function(e,t){if(typeof e!=typeof t)return!1;if("function"==typeof e)return e.toString()===t.toString();if(e instanceof Object&&t instanceof Object){if(bizagi.util.countProps(e)!==bizagi.util.countProps(t))return!1;for(k in e)if(!bizagi.util.identicalObjects(e[k],t[k]))return!1;return!0}return e===t},bizagi.util.countProps=function(e){var t=0;for(k in e)e.hasOwnProperty(k)&&t++;return t},bizagi.util.encodeHtml=function(e){return null==e?"":"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},bizagi.util.encodeXpath=function(e){return bizagi.util.isEmpty(e)?"":e.replaceAll(".","_").replaceAll("=","_").replaceAll("[","_").replaceAll("]","_")},bizagi.clone=function(e){return JSON.parse(JSON.encode(e))},Math.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},bizagi.util.isMapEmpty=function(e){if(1==e.length&&0==e[0].length)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},bizagi.util.scrollTop=function(e){if(e&&e[0])for(;"HTML"!==e[0].tagName&&"scroll"!=e.css("overflow-y")&&"auto"!=e.css("overflow-y")&&e.parent().length>0;)e=e.parent();return e},bizagi.util.getQueryString=function(e){for(var t={},i=((e=e||window.location.href).indexOf("?")>0?e.substring(e.indexOf("?")+1):"").split("&"),r=0;r<i.length;r++){var a=i[r].indexOf("=");if(-1!=a){var n=i[r].substring(0,a),o=i[r].substring(a+1);t[n]=unescape(o)}}return t};var scenarioInfo=function(e){return this.getFileScenario=function(e){var t=((e=e||{}).scenario.split(".")||[])[0];return BIZAGI_SMARTPHONE_PATH+"scenarios/"+t+"/"+e.scenario+".js"},{getFileScenario:this.getFileScenario}};function printf(e){var t,i=Array.prototype.slice.call(arguments,1);return e.replace(/(%[disv])/g,function(e,r){if(void 0!==(t=i.shift()))switch(r.charCodeAt(1)){case 100:return+t;case 105:return Math.round(+t);case 115:return String(t);case 118:return t}return r})}bizagi.util.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},bizagi.util.isScrolledIntoView=function(e,t){if(null==e)return!1;var i=(t=t||$(window)).scrollTop(),r=$(e).offset().top;return r+$(e).height()<=i+$(t).height()&&r>=i},bizagi.util.isEventSupported=function(e,t){var i,r=!("onblur"in document.documentElement);return!!e&&(t&&"string"!=typeof t||(t=document.createElement(t||"div")),!(i=(e="on"+e)in t)&&r&&(t.setAttribute||(t=document.createElement("div")),t.setAttribute&&t.removeAttribute&&(t.setAttribute(e,""),i="function"==typeof t[e],void 0!==t[e]&&(t[e]=void 0),t.removeAttribute(e))),i)},bizagi.util.isAndroid=function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},function(e){e.fn.startLoading=function(e){bizagi.util.smartphone.startLoading()},e.fn.endLoading=function(){bizagi.util.smartphone.stopLoading()}}(jQuery),bizagi.util.dispose=function(e){for(key in e)"object"==typeof e[key]&&delete e[key],"function"==typeof e[key]&&(e[key]=null,delete e[key])},bizagi.util.stripslashes=function(e){return e.replace(/\\'/g,"'").replace(/\"/g,'"').replace(/\\\\/g,"\\").replace(/\\0/g,"\0")},bizagi.util.md5=function(e){var t=t||function(e,t){var i={},r=i.lib={},a=function(){},n=r.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var a=0;a<e;a++)t[r+a>>>2]|=(i[a>>>2]>>>24-a%4*8&255)<<24-(r+a)%4*8;else if(65535<i.length)for(a=0;a<e;a+=4)t[r+a>>>2]=i[a>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],r=0;r<t;r+=4)i.push(4294967296*e.random()|0);return new o.init(i,t)}}),s=i.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],r=0;r<e;r++){var a=t[r>>>2]>>>24-r%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(i,t/2)}},d=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],r=0;r<e;r++)i.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r++)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(i,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},u=r.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,r=i.words,a=i.sigBytes,n=this.blockSize,s=a/(4*n);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*n,a=e.min(4*t,a),t){for(var l=0;l<t;l+=n)this._doProcessBlock(r,l);l=r.splice(0,t),i.sigBytes-=a}return new o.init(l,a)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=u.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}});var p=i.algo={};return i}(Math);return function(e){function i(e,t,i,r,a,n,o){return((e=e+(t&i|~t&r)+a+o)<<n|e>>>32-n)+t}function r(e,t,i,r,a,n,o){return((e=e+(t&r|i&~r)+a+o)<<n|e>>>32-n)+t}function a(e,t,i,r,a,n,o){return((e=e+(t^i^r)+a+o)<<n|e>>>32-n)+t}function n(e,t,i,r,a,n,o){return((e=e+(i^(t|~r))+a+o)<<n|e>>>32-n)+t}for(var o=t,s=(d=o.lib).WordArray,l=d.Hasher,d=o.algo,c=[],u=0;64>u;u++)c[u]=4294967296*e.abs(e.sin(u+1))|0;d=d.MD5=l.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;16>o;o++){var s=e[u=t+o];e[u]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}o=this._hash.words;var l,d,u=e[t+0],p=(s=e[t+1],e[t+2]),g=e[t+3],h=e[t+4],m=e[t+5],f=e[t+6],b=e[t+7],v=e[t+8],y=e[t+9],C=e[t+10],x=e[t+11],R=e[t+12],z=e[t+13],E=e[t+14],T=e[t+15],A=o[0],w=n(w=n(w=n(w=n(w=a(w=a(w=a(w=a(w=r(w=r(w=r(w=r(w=i(w=i(w=i(w=i(w=o[1],d=i(d=o[2],l=i(l=o[3],A=i(A,w,d,l,u,7,c[0]),w,d,s,12,c[1]),A,w,p,17,c[2]),l,A,g,22,c[3]),d=i(d,l=i(l,A=i(A,w,d,l,h,7,c[4]),w,d,m,12,c[5]),A,w,f,17,c[6]),l,A,b,22,c[7]),d=i(d,l=i(l,A=i(A,w,d,l,v,7,c[8]),w,d,y,12,c[9]),A,w,C,17,c[10]),l,A,x,22,c[11]),d=i(d,l=i(l,A=i(A,w,d,l,R,7,c[12]),w,d,z,12,c[13]),A,w,E,17,c[14]),l,A,T,22,c[15]),d=r(d,l=r(l,A=r(A,w,d,l,s,5,c[16]),w,d,f,9,c[17]),A,w,x,14,c[18]),l,A,u,20,c[19]),d=r(d,l=r(l,A=r(A,w,d,l,m,5,c[20]),w,d,C,9,c[21]),A,w,T,14,c[22]),l,A,h,20,c[23]),d=r(d,l=r(l,A=r(A,w,d,l,y,5,c[24]),w,d,E,9,c[25]),A,w,g,14,c[26]),l,A,v,20,c[27]),d=r(d,l=r(l,A=r(A,w,d,l,z,5,c[28]),w,d,p,9,c[29]),A,w,b,14,c[30]),l,A,R,20,c[31]),d=a(d,l=a(l,A=a(A,w,d,l,m,4,c[32]),w,d,v,11,c[33]),A,w,x,16,c[34]),l,A,E,23,c[35]),d=a(d,l=a(l,A=a(A,w,d,l,s,4,c[36]),w,d,h,11,c[37]),A,w,b,16,c[38]),l,A,C,23,c[39]),d=a(d,l=a(l,A=a(A,w,d,l,z,4,c[40]),w,d,u,11,c[41]),A,w,g,16,c[42]),l,A,f,23,c[43]),d=a(d,l=a(l,A=a(A,w,d,l,y,4,c[44]),w,d,R,11,c[45]),A,w,T,16,c[46]),l,A,p,23,c[47]),d=n(d,l=n(l,A=n(A,w,d,l,u,6,c[48]),w,d,b,10,c[49]),A,w,E,15,c[50]),l,A,m,21,c[51]),d=n(d,l=n(l,A=n(A,w,d,l,R,6,c[52]),w,d,g,10,c[53]),A,w,C,15,c[54]),l,A,s,21,c[55]),d=n(d,l=n(l,A=n(A,w,d,l,v,6,c[56]),w,d,T,10,c[57]),A,w,f,15,c[58]),l,A,z,21,c[59]),d=n(d,l=n(l,A=n(A,w,d,l,h,6,c[60]),w,d,x,10,c[61]),A,w,p,15,c[62]),l,A,y,21,c[63]);o[0]=o[0]+A|0,o[1]=o[1]+w|0,o[2]=o[2]+d|0,o[3]=o[3]+l|0},_doFinalize:function(){var t=this._data,i=t.words,r=8*this._nDataBytes,a=8*t.sigBytes;i[a>>>5]|=128<<24-a%32;var n=e.floor(r/4294967296);for(i[15+(a+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i[14+(a+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(i.length+1),this._process(),i=(t=this._hash).words,r=0;4>r;r++)a=i[r],i[r]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=l._createHelper(d),o.HmacMD5=l._createHmacHelper(d)}(Math),t.MD5(e).toString()},bizagi.util.b64toBlob=function(e,t,i){t=t||"",i=i||512;for(var r=atob(e),a=[],n=0;n<r.length;n+=i){for(var o=r.slice(n,n+i),s=new Array(o.length),l=0;l<o.length;l++)s[l]=o.charCodeAt(l);var d=new Uint8Array(s);a.push(d)}return new Blob(a,{type:t})},bizagi.util.arrayEach=function(e,t){var i;if(e)if("[object Array]"===Object.prototype.toString.apply(e)&&"[object Function]"===Object.prototype.toString.apply(t)){for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(e[i],i,e[i]))return}else $.each(e,t)},bizagi.util.isHTMLValidText=function(e){return new RegExp(/<(.|\n)*?>/g).test(e)},bizagi.util.hasScroll=function(e,t){e.length&&(e=e[0]);var i=!!e[t="vertical"===t?"scrollTop":"scrollLeft"];return i||(e[t]=1,i=!!e[t],e[t]=0),i},bizagi.util.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},bizagi.util.isIphoneHigherIOS5=function(){return null!=this.value?this.value:this.value=RegExp("OS\\s*(5|6|7|8)_*\\d").test(navigator.userAgent)&&RegExp(" AppleWebKit/").test(navigator.userAgent)},bizagi.util.getStandardNotation=function(e,t){t=t||".";var i="",r=!1,a=!1;e=(e.length>0?e.toString().toLowerCase():"").replace(/ /g,"");for(var n=0;n<e.length;n++)("+"!==e[n]&&"-"!==e[n]||0!==n&&"e"!=e[n-1])&&isNaN(Number(e[n]))?e[n]!==t||r?"e"!==e[n]||a||(i+=e[n],a=!0):(i+=e[n],r=!0):i+=e[n];return i},bizagi.util.scientificNotationFormat=function(e,t,i,r,a){t=t||".",e=bizagi.util.getStandardNotation(e,t),i=i>0?i:38,r=r>0?r:-125,a=a>0?a:125;var n=new RegExp("[0-9]+("+t+"[0-9]+)?(e[+-]?[0-9]+)?"),o=e.match(n),s=0,l="-"===e[0]?e[0]:"",d=0;if(e=e.replace(l,""),o&&o[0]&&o[2]){var c=o[0]?o[0].replace(o[2],"").split(t):"",u="",p="";return c[0]=c[0].replace(/^0+/g,""),c[0].length>1?(d=(u=c[0].slice(1)).length,p=c[0][0]||"",u=u.concat(o[1]||"")):1===c[0].length?(p=c[0][0]||"",u=u.concat(c[1]||"")):(d=c[1].length,c[1]=c[1].replace(/^0+/g,""),d=c[1].length-1-d,p=c[1][0],u=c[1].slice(1)),(u=u.replace(t,"").replace(/0+$/g,"")).length>=i&&(u=u.slice(0,i-1)),l+p+(u?t+u:"")+"e"+((s=(s=Number(o[2].replace("e",""))+d)>a?a:s<r?r:s)>0?"+"+s:s)}if(e){d=e.indexOf(t);var g=0,h=e.length-1;e=e.replace(t,"");for(var m=g;!f;)"0"!==e[m]&&e[m]!==t?(f=!0,g=m):m++;for(var f=!1,b=h;!f;)"0"!==e[b]&&e[b]!==t?(f=!0,h=b+1):b--;if(h=h>i+g?i+g:h,-1!==d){f=!1;return s=d-(g+1),(u=e.slice(g,h)).length>0&&!isNaN(Number(u[0]))?l+u[0]+(u.length>1?t+u.slice(1):"")+"e"+(s>0?"+"+s:s):"0"}var v=e.slice(g,g+1),y=e.slice(g+1,e.length);return s=y.length,(y=y.replace(/0+$/g,"")).length>i&&(y=e.slice(g+1,i+g)),Number(v)?l+v+(y.length>0?t+y:"")+"e"+(s>0?"+"+s:s):"0"}return""},bizagi.util.isString=function(e){return"[object String]"===Object.prototype.toString.apply(e)},bizagi.util.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)},function(e){e.timeago=function(r){return t.settings={refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:bizagi.localization.getResource("bizagi-editor-form-timeago-ago"),suffixFromNow:bizagi.localization.getResource("bizagi-editor-form-timeago-from-now"),seconds:bizagi.localization.getResource("bizagi-editor-form-timeago-seconds"),minute:bizagi.localization.getResource("bizagi-editor-form-timeago-minute"),minutes:bizagi.localization.getResource("bizagi-editor-form-timeago-minutes"),hour:bizagi.localization.getResource("bizagi-editor-form-timeago-hour"),hours:bizagi.localization.getResource("bizagi-editor-form-timeago-hours"),day:bizagi.localization.getResource("bizagi-editor-form-timeago-day"),days:bizagi.localization.getResource("bizagi-editor-form-timeago-days"),month:bizagi.localization.getResource("bizagi-editor-form-timeago-month"),months:bizagi.localization.getResource("bizagi-editor-form-timeago-months"),year:bizagi.localization.getResource("bizagi-editor-form-timeago-year"),years:bizagi.localization.getResource("bizagi-editor-form-timeago-years"),wordSeparator:" ",numbers:[]}},r instanceof Date?i(r):"string"==typeof r?(r=r.replace(".","-"),i(e.timeago.parse(r))):i("number"==typeof r?new Date(r):e.timeago.datetime(r))};var t=e.timeago;function i(e){return t.inWords((i=e,(new Date).getTime()-i.getTime()));var i}e.extend(e.timeago,{inWords:function(t){var i=this.settings.strings,r=i.prefixAgo,a=i.suffixAgo;this.settings.allowFuture&&t<0&&(r=i.prefixFromNow,a=i.suffixFromNow);var n=Math.abs(t)/1e3,o=n/60,s=o/60,l=s/24,d=l/365;function c(r,a){var n=e.isFunction(r)?r(a,t):r,o=i.numbers&&i.numbers[a]||a;return n.replace(/%d/i,o)}var u=n<45&&c(i.seconds,Math.round(n))||n<90&&c(i.minute,1)||o<45&&c(i.minutes,Math.round(o))||o<90&&c(i.hour,1)||s<24&&c(i.hours,Math.round(s))||s<42&&c(i.day,1)||l<30&&c(i.days,Math.round(l))||l<45&&c(i.month,1)||l<365&&c(i.months,Math.round(l/30))||d<1.5&&c(i.year,1)||c(i.years,Math.round(d)),p=i.wordSeparator||"";return void 0===i.wordSeparator&&(p=" "),e.trim([r,u,a].join(p))},parse:function(t){var i=e.trim(t);return i=(i=(i=(i=(i=i.replace(/\.\d+/,"")).replace(/-/,"/").replace(/-/,"/")).replace(/T/," ").replace(/Z/," UTC")).replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2")).replace(/([\+\-]\d\d)$/," $100"),new Date(i)},datetime:function(i){var r=t.isTime(i)?e(i).attr("datetime"):e(i).attr("title");return t.parse(r)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}})}(jQuery),function(e){var t=(bizagi.util.isEventSupported("paste")?"paste":"input")+".mask";e.widget("ui.mask",{_init:function(){var t=this.options,i=this;e.extend(this,{caret:function(t,r){return e.ui.mask.caret(i.element,t,r)}}),t.mask&&t.mask.length&&(t.placeholder&&t.placeholder.length||(t.placeholder="_"),this._prepareBuffer(),this._bindEvents(),this._checkVal(this.element.val().length&&t.allowPartials))},destroy:function(){this.element.unbind(".mask").removeData("mask")},value:function(){this.element;var t=this,i=e.map(t.buffer,function(e,i){return t.tests[i]?e:null}).join(""),r=new RegExp("\\"+this.options.placeholder,"gi");return i.replace(r,"")},formatted:function(){var e=new RegExp("\\"+this.options.placeholder,"gi");return this.element.val().replace(e,"")},apply:function(){this.element.trigger("apply.mask")},_setData:function(t,i){e.widget.prototype._setData.apply(this,arguments);var r=this.options;switch(t){case"mask":if(!r.mask||!r.mask.length){this.element.unbind(".mask");break}case"placeholder":r.placeholder&&r.placeholder.length||(r.placeholder="_"),this.element.val(""),this._prepareBuffer(),!this.eventsBound&&this._bindEvents()}},_prepareBuffer:function(){this._escapeMask();var t=this,i=this.element,r=this.options,a=r.mask,n=e.ui.mask.definitions,o=[],s=a.length,l=null;a.length;i.is(":input")||(i.val=i.html),e.each(a.split(""),function(e,t){"?"==t?(0,s=e):n[t]?(o.push(new RegExp(n[t])),null==l&&(l=o.length-1)):o.push(null)}),e.extend(this,{buffer:e.map(a.split(""),function(e,t){if("?"!=e)return n[e]?r.placeholder:e}),tests:o,firstNonMaskPos:l,partialPosition:s}),this.buffer=e.map(this.buffer,function(e,i){return"\t"==e?t.maskEscaped[i]:e}),this.options.mask=a=this.maskEscaped},_bindEvents:function(){var i=this,r=this.element,a=!1,n=r.val();r.attr("readonly")||(r.bind("focus.mask",function(){n=r.val();var e=i._checkVal();i._writeBuffer(),setTimeout(function(){e==i.options.mask.length?i.caret(0,e):i.caret(e)},0)}).bind("blur.mask",function(){i._checkVal(),r.val()!=n&&r.change()}).bind("apply.mask",function(){n=r.val();i._checkVal();i._writeBuffer()}).bind("keydown.mask",function(t){t=t||window.event;var o=i.caret(),s=t.keyCode,l=e.ui.keyCode;return a=s<l.SHIFT||s>l.SHIFT&&s<l.SPACE||s>l.SPACE&&s<41,o.begin-o.end==0||a&&s!=l.BACKSPACE&&s!=l.DELETE||i._clearBuffer(o.begin,o.end),s==l.BACKSPACE||s==l.DELETE?(i._shiftL(o.begin+(s==l.DELETE||s==l.BACKSPACE&&o.begin!=o.end?0:-1),Math.abs(o.begin-o.end)),!1):s==l.ESCAPE?(r.val(n),i.caret(0,i._checkVal()),!1):void 0}).bind("keypress.mask",function(t){var n=(t=t||window.event).charCode||t.keyCode||t.which,o=e.ui.keyCode,s=i.options.mask.length;if(a)return a=!1,t.keyCode!=o.BACKSPACE&&null;var l=i.caret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(n>=o.SPACE&&n<=125||n>186){var d=i._seekNext(l.begin-1);if(d<s){var c=String.fromCharCode(n);if(i.tests[d]&&i.tests[d].test(c)){i._shiftR(d),i.buffer[d]=c,i._writeBuffer();var u=i._seekNext(d);i.caret(u),i.options.completed&&u==s&&i.options.completed.call(r)}}}return!1}).bind(t,function(){setTimeout(function(){i.caret(i._checkVal(!0))},0)}),this.eventsBound=!0)},_writeBuffer:function(){return this.element.val(this.buffer.join("")).val()},_clearBuffer:function(e,t){for(var i=this.options.mask.length,r=e;r<t&&r<i;r++)this.tests[r]&&(this.buffer[r]=this.options.placeholder)},_seekNext:function(e){for(var t=this.options.mask.length;++e<=t&&!this.tests[e];);return e},_shiftR:function(e){for(var t=this.options.mask.length,i=e,r=this.options.placeholder;i<t;i++)if(this.tests[i]){var a=this._seekNext(i),n=this.buffer[i];if(this.buffer[i]=r,!(a<t&&this.tests[a].test(n)))break;r=n}},_shiftL:function(e,t){for(;!this.tests[e]&&--e>=0;);for(var i=e,r=this.options.mask.length,a=this.options.placeholder,n=e;n<r&&(n>=0||t>1);n++)if(this.tests[n]){this.buffer[n]=a;var o=this._seekNext(n);if(o<r&&this.tests[n].test(this.buffer[o]))for(this.buffer[e]=this.buffer[o],this.buffer[o]=a,e++;!this.tests[e];)e++}this._writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,i))},_checkVal:function(e){for(var t=this.element,i=t.val(),r=this.options.mask.length,a=-1,n=0,o=0;n<r;n++)if(this.tests[n]){for(this.buffer[n]=this.options.placeholder;o++<i.length;){var s=i.charAt(o-1);if(this.tests[n].test(s)){this.buffer[n]=s,a=n;break}}if(o>i.length)break}else this.buffer[n]==i[o]&&n!=this.partialPosition&&(o++,a=n);return!e&&a+1<this.partialPosition?this.options.allowPartials&&this.value().length?t.is(":input")||this._writeBuffer():(t.val(""),this._clearBuffer(0,r)):(e||a+1>=this.partialPosition)&&(this._writeBuffer(),e||t.val(t.val().substring(0,a+1))),this.partialPosition?n:this.firstNonMaskPos},_escapeMask:function(){for(var e=this.options.mask,t=[],i=[],r=0;r<e.length;r++){var a,n=e[r]||e.charAt(r);"\\"==n&&"\\"!=e[r-1]||("\\"==e[r-1]?(a="\t",i[t.length]=n):a=n,t[t.length]=a)}this.options.mask=t.join("");for(r=0;r<t.length;r++)void 0!==i[r]&&(t[r]=i[r]);this.maskEscaped=t.join("")}}),e.extend(e.ui.mask,{version:"@VERSION",getter:"value formatted",defaults:{mask:"",placeholder:"_",completed:null,allowPartials:!1},definitions:{"#":"[\\d]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},caret:function(e,t,i){var r=e[0];if("number"==typeof t){if(i="number"==typeof i?i:t,r.setSelectionRange)r.focus(),r.setSelectionRange(t,i);else if(r.createTextRange){(a=r.createTextRange()).collapse(!0),a.moveEnd("character",i),a.moveStart("character",t),a.select()}return e}if(r.setSelectionRange)t=r.selectionStart,i=r.selectionEnd;else if(document.selection&&document.selection.createRange){var a;i=(t=0-(a=document.selection.createRange()).duplicate().moveStart("character",-1e5))+a.text.length}return{begin:t,end:i}}})}(jQuery),jQuery.fn.numeric=function(e,t){return e=e||".",t="function"==typeof t?t:function(){},this.keypress(function(t){var i=t.charCode?t.charCode:t.keyCode?t.keyCode:0;if(13==i&&"input"==this.nodeName.toLowerCase())return!0;if(13==i)return!1;var r=!1;if(t.ctrlKey&&97==i||t.ctrlKey&&65==i)return!0;if(t.ctrlKey&&120==i||t.ctrlKey&&88==i)return!0;if(t.ctrlKey&&99==i||t.ctrlKey&&67==i)return!0;if(t.ctrlKey&&122==i||t.ctrlKey&&90==i)return!0;if(t.ctrlKey&&118==i||t.ctrlKey&&86==i||t.shiftKey&&45==i)return!0;if(i<48||i>57){if(45==i&&0==this.value.length)return!0;i==e.charCodeAt(0)&&-1!=this.value.indexOf(e)&&(r=!1),8!=i&&9!=i&&13!=i&&35!=i&&36!=i&&37!=i&&39!=i&&46!=i?r=!1:void 0!==t.charCode&&(t.keyCode==t.which&&0!=t.which?r=!0:0!=t.keyCode&&0==t.charCode&&0==t.which&&(r=!0)),i==e.charCodeAt(0)&&-1==this.value.indexOf(e)&&(r=!0)}else r=!0;return r}).blur(function(){var i=jQuery(this).val();""!=i&&(new RegExp("^\\d+$|\\d*"+e+"\\d+").exec(i)||t.apply(this))}),this},jQuery.fn.numericSN=function(e,t){e=e||".",t=t||"e";return callback="function"==typeof callback?callback:function(){},this.keypress(function(i){var r=i.charCode?i.charCode:i.keyCode?i.keyCode:0;if(13==r&&"input"==this.nodeName.toLowerCase())return!0;if(13==r)return!1;var a=!1;return!!(i.ctrlKey&&97==r||i.ctrlKey&&65==r)||(!!(i.ctrlKey&&120==r||i.ctrlKey&&88==r)||(!!(i.ctrlKey&&99==r||i.ctrlKey&&67==r)||(!!(i.ctrlKey&&122==r||i.ctrlKey&&90==r)||(!!(i.ctrlKey&&118==r||i.ctrlKey&&86==r||i.shiftKey&&45==r)||(r<48||r>57?(r==e.charCodeAt(0)&&-1!=this.value.indexOf(e)&&(a=!1),r==t.charCodeAt(0)&&-1!=this.value.indexOf(t)&&(a=!1),8!=r&&9!=r&&13!=r&&35!=r&&36!=r&&37!=r&&39!=r?a=!1:void 0!==i.charCode&&(i.keyCode==i.which&&0!=i.which?a=!0:0!=i.keyCode&&0==i.charCode&&0==i.which&&(a=!0)),r==t.charCodeAt(0)&&-1==this.value.indexOf(t)&&(a=!0),r==e.charCodeAt(0)&&-1==this.value.indexOf(e)&&(a=!0),r!="-".charCodeAt(0)&&r!="+".charCodeAt(0)||(a=!0)):a=!0,a)))))}).blur(function(){var t=jQuery(this).val();""!=t&&(new RegExp("^\\d+$|\\d*"+e+"\\d+").exec(t)||callback.apply(this))}),this},function(e){function t(t){var i=e.formatCurrency.regions[t];if(i)return i;if(/(\w+)-(\w+)/g.test(t)){var r=t.replace(/(\w+)-(\w+)/g,"$1");return e.formatCurrency.regions[r]}return null}function i(e){if(""===e.symbol)return new RegExp("[^\\d"+e.decimalSymbol+"-]","g");var t=e.symbol.replace("$","\\$").replace(".","\\.");return new RegExp(t+"|[^\\d"+e.decimalSymbol+"-]","g")}e.formatCurrency={},e.formatCurrency.regions=[],e.formatCurrency.regions[""]={symbol:"$",positiveFormat:"%s%n",negativeFormat:"(%s%n)",decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0},e.fn.formatCurrency=function(r,a){1==arguments.length&&"string"!=typeof r&&(a=r,r=!1);var n={name:"formatCurrency",colorize:!1,region:"",global:!0,roundToDecimalPlace:2,eventOnDecimalsEntered:!1};return n=e.extend(n,e.formatCurrency.regions[""]),(a=e.extend(n,a)).region.length>0&&(a=e.extend(a,t(a.region))),a.regex=i(a),this.each(function(){var t=e(this),i="0",n=new RegExp("^(0+|-0+)","g");if((i=t[t.is("input, select, textarea")?"val":"html"]()).search("\\(")>=0&&(i="-"+i),i.match(/[1-9]/g)||(i=i.replace(n,0)),""!==i&&("-"!==i||-1!==a.roundToDecimalPlace)){if(isNaN(i)){if(""===(i=i.replace(a.regex,""))||"-"===i&&-1===a.roundToDecimalPlace)return;"."!=a.decimalSymbol&&(i=i.replace(a.decimalSymbol,".")),isNaN(i)&&(i="0")}var o=String(i).split("."),s=i==Math.abs(i),l=o.length>1,d=l?o[1].toString():"0",c=d;if(i=Math.abs(o[0]),i=isNaN(i)?0:i,a.roundToDecimalPlace>=0&&("2"==(d=(d=parseFloat("1."+d)).toFixed(a.roundToDecimalPlace)).substring(0,1)&&(i=Number(i)+1),d=d.substring(2)),i=String(i),a.groupDigits)for(var u=0;u<Math.floor((i.length-(1+u))/3);u++)i=i.substring(0,i.length-(4*u+3))+a.digitGroupSymbol+i.substring(i.length-(4*u+3));(l&&-1==a.roundToDecimalPlace||a.roundToDecimalPlace>0)&&(i+=a.decimalSymbol+d);var p=(s?a.positiveFormat:a.negativeFormat).replace(/%s/g,a.symbol);p=p.replace(/%n/g,i);var g=e([]);(g=r?e(r):t)[g.is("input, select, textarea")?"val":"html"](p),l&&a.eventOnDecimalsEntered&&c.length>a.roundToDecimalPlace&&g.trigger("decimalsEntered",c),a.colorize&&g.css("color",s?"black":"red")}})},e.fn.toNumber=function(r){var a=e.extend({name:"toNumber",region:"",global:!0},e.formatCurrency.regions[""]);return(r=jQuery.extend(a,r)).region.length>0&&(r=e.extend(r,t(r.region))),r.regex=i(r),this.each(function(){var t=e(this).is("input, select, textarea")?"val":"html";e(this)[t](e(this)[t]().replace("(","(-").replace(r.regex,""))})},e.fn.asNumber=function(r){var a=e.extend({name:"asNumber",region:"",parse:!0,parseType:"Float",global:!0},e.formatCurrency.regions[""]);(r=jQuery.extend(a,r)).region.length>0&&(r=e.extend(r,t(r.region))),r.regex=i(r),r.parseType=function(e){switch(e.toLowerCase()){case"int":return"Int";case"float":return"Float";default:throw"invalid parseType"}}(r.parseType);var n=e(this).is("input, select, textarea")?"val":"html",o=e(this)[n]();return o=(o=(o=o||"").replace("(","(-")).replace(r.regex,""),r.parse?(0==o.length&&(o="0"),"."!=r.decimalSymbol&&(o=o.replace(r.decimalSymbol,".")),window["parse"+r.parseType](o)):o}}(jQuery),function(e){e.fn.bztabs=function(t){var i=e(this);(t=t||{}).activeTab=t.activeTab||0,t.tabNumber=t.tabNumber||1;var r=t.activate&&"function"==typeof t.activate?t.activate:function(){},a=(t.beforeActivate&&"function"==typeof t.beforeActivate&&t.beforeActivate,i.find(">div.bz-bizagi-container-tap-popup").hide()),n=a.children().length,o=e("<div class='bz-header_select'></div>"),s=t.tabNumber>n?n:t.tabNumber,l=Math.floor(100/Number(s));a.children().each(function(e,t){o.append("<div class='bz-wp-tabs-ui bz-wp-tabs-item' data-index='"+e+"' data-reference-tab='"+t.getAttribute("data-reference-tab")+"'><span>"+t.textContent+"</span></div>")}),o.find("> .bz-wp-tabs-ui").css("width",l+"%"),o.append("<div class='bz-wp-tabs-arrow-container'><div class='bz-cm-icon bz-mo-icon bz-plus'></div></div>"),i.prepend(o);var d=i.find("> .bz-bizagi-container-tap-popup > .bz-container-items-tabs").eq(t.activeTab);e(e(d).data("reference-tab"),i).addClass("childrenActive"),d.addClass("tabSelected");var c=e(".bz-wp-tabs-ui:nth-child("+(t.activeTab+1)+")",o).addClass("tabSelected"),u=l+(100-l*s);function p(){t.tabNumber<n?(e(".bz-wp-tabs-arrow-container",i).first().addClass("show-pluss"),o.addClass("show-pluss"),c.trigger("click",{origin:"popUp"})):(e(".bz-wp-tabs-arrow-container",i).removeClass("show-pluss"),o.removeClass("show-pluss"),o.find("> .bz-wp-tabs-ui:last").addClass("bz-wp-no-border"))}function g(t,n){if((n=n||{}).origin=n.origin||"header",t.stopPropagation(),t.preventDefault(),!e(this).hasClass("tabSelected")||"popUp"===n.origin){var s,d,p,g=t.currentTarget.getAttribute("data-reference-tab"),h=e(g,i);c=e(t.currentTarget),i.find(">div.childrenActive").removeClass("childrenActive"),h.addClass("childrenActive"),o.find(">div.tabSelected").removeClass("tabSelected").css("width",l+"%"),"block"===a.css("display")&&a.toggle(),n.origin&&"popUp"===n.origin&&(c=e("[data-reference-tab='"+g+"']",o),s=g,d=o.find(".bz-wp-tabs-ui"),p=!0,d.each(function(e,t){s!==t.getAttribute("data-reference-tab")&&p?(o.remove("[data-reference-tab='"+s+"']"),o.append(t)):p=!1})),c.addClass("tabSelected").css("width",u+"%"),r(t,n)}}c.css("width",u+"%"),void 0!==t.domIncluded?e.when(t.domIncluded).done(function(){p()}):p(),i.find(".bz-wp-tabs-arrow-container").first().bind("click",function(t){var i=o.innerWidth()-29,r=0;e(".bz-container-items-tabs",a).removeClass("show"),o.find(".bz-wp-tabs-ui").each(function(t,n){(r+=e(":first-child",n).outerWidth())>i&&a.children().each(function(t,i){if(i.textContent===n.textContent)return e(i).addClass("show"),e(".cell.bz-container-items-tabs").css("border-bottom",""),void e(".cell.bz-container-items-tabs.show").last().css("border-bottom","none")})}),t.stopPropagation(),t.preventDefault(),a.toggle()}),e(">div.cell",a).bind("click",function(e){g(e,{origin:"popUp"})}),e(".bz-wp-tabs-ui",o).bind("click",g),o.bind("resizeHeader",function(){p()})}}(jQuery),function(e){e.fn.helpText=function(t){(t=t||{}).helpText=t.helpText||"",t.dir=void 0!==t.dir&&""!==t.dir?t.dir:"inherit";var i=kendo.template('<div class="bz-container-rn-helptext-overlay">   <div class="bz-rn-helptext" dir="#: data.dir #">       <div class="bz-cancel-container">           <a href="\\#" style="opacity: 0; width: 0; height: 0"></a>           <span class="bz-mo-icon bz-cancel"></span>       </div>       <span class="bz-rn-helptext-text">#= data.helpText #</span>   </div></div>',{useWithBlock:!1}),r=e(i(t));e(this).bind("click",function(){e("body").append(r),e("body").css("position","fixed"),e("a",r).get(0).focus(),e(".bz-cancel",r).bind("click",function(){r.remove(),e("body").css("position","")}),e("a",r).bind("blur",function(){e(".bz-cancel",r).click()}),r.addClass("active")})}}(jQuery),bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render",i="Rest/Handlers/Render/Upload",r="Rest/Handlers/RenderFile",a="Rest/Handlers/Letter",n="Rest/Handlers/MultiAction",o="Rest/Handlers/Metadata";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+i,"render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+n,"render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+r,"render-upload-add-url":e.proxyPrefix+i,"render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+o,"render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+a,"render-letter-content-url":e.proxyPrefix+a,"render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}&xsrf="+bizagi.cookie(".BIZCSRF"),"render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+i,"render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+n,"render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+r,"render-upload-add-url":e.sharepointProxyPrefix+i,"render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+o,"render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+a,"render-letter-content-url":e.sharepointProxyPrefix+a,"render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+i+"?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+r+"?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+i+"?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+a+"?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+a+"?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+i+"?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+r+"?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+i+"?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+a+"?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+a+"?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&!bizagi.util.isMobileDevice()&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={}},multiaction:function(){return this.multiactionService},getFormData:function(e){var t=this;if(e&&e.data)return e.data;e=e||{};var i={};if(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",e.idProcess&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),!1===e.editable&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){var r="all_";e[t.Class.BA_ACTION_PARAMETER_PREFIX+r+"rows"]&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+r+"rows"]=e[t.Class.BA_ACTION_PARAMETER_PREFIX+r+"rows"])}return e.prepare?i:(bizagi.chrono.initAndStart("data"),$.ajax({url:e.url||t.serviceLocator.getUrl("form-get-data"),data:i,type:"POST",dataType:"json",serviceType:e.action||"LOAD"}).pipe(function(t){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{t.form.properties.editable="False";var r=function(e){return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=i.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(i,function(t,i){"object"==typeof i&&(e[t]=r(e[t]))}),e)};t=r(t)}catch(e){}return t}))},getSearchFormData:function(e){var t=this;e=e||{};var i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-search-form-get-data"),data:i,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){var t=this;data=t.resolveData(e.data||{},e.xpathContext),data=t.processDataValues(data),data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var i=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||t.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:i})},resolveData:function(e,t){var i,r,a;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(i in e)-1!==i.search(/\[id=\d+\]/)&&t==i.substr(0,i.search(/\]/)+1)&&(r=i.substr(i.search(/\]/)+2),a=e[i],e[r]=a,delete e[i]);return e},getPropertyData:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){var t=this;return e.extra=e.extra||{},e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this,i=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(r)+"&xsrf="+bizagi.cookie(".BIZCSRF")},getUploadFileEntityUrl:function(e){var t=this,i=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),t.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(r)+"&xsrf="+bizagi.cookie(".BIZCSRF")},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},deleteImage:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-upload-delete-url"),data:i,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-upload-delete-url"),data:i,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=this,i=e.extra||{};return i.action="getECMMetadata",i.idFileUpload=e.idFileUpload,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i.xpathContext=e.xpathContext,i.xPath=e.xPath,i.idAttrib=e.idAttrib,e.sessionId&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-ecm-upload-url"),data:i,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+t.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=this,i=e.url||t.serviceLocator.getUrl("render-ecm-upload-url")+"File",r=e.extra||{};return r.action="viewECMFile",r.idFileUpload=e.idFileUpload,r.xPath=e.xPath,r.idAttrib=e.idAttrib,r.fileName=e.fileName,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r.xpathContext=e.xpathContext,e.sessionId&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(r.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",r),t.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(r)+"&xsrf="+bizagi.cookie(".BIZCSRF")},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-edit-url"),data:i,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-add-url"),data:i,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=this,i=e.extra||{};i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var r=e.submitData||{};for(key in r)i[key]=r[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-add-url"),data:i,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=this,i=e.extra||{};i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var r=e.submitData||{};for(key in r=t.processDataValues(r))i[key]=r[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-save-url"),data:i,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-save-url"),data:i,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:"text"}).pipe(function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}})},rollbackGridAction:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-rollback-url"),data:i,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,i=this,r=e.extra||{},a=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==a&&(a+=" "+e.order),r[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",r[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[i.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[i.Class.BA_CONTEXT_PARAMETER_PREFIX+i.Class.BA_PAGE_CACHE]=e.idPageCache,r[i.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,r[i.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=a,r[i.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,r[i.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,r[i.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=i.processDataCriteria(e.criteria),r[i.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(r[i.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(r[i.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",r),e.prepare?r:$.ajax({url:e.url||i.serviceLocator.getUrl("render-search-advanced-url"),data:r,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,i.associatedUser=e.associatedUser,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-stakeholder-associated"),data:i,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-stakeholder-associated"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=this,i=e.extra||{};i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache;var r=e.url||t.serviceLocator.getUrl("render-letter-notEditable-url");return t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(i)},getLetterContent:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-letter-content-url"),data:i,type:"POST",dataType:"html"}).pipe(function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}})},getCanGenerateLetter:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?i:$.ajax({url:t.serviceLocator.getUrl("render-letter-content-url"),data:i,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=this,i=e.extra||{};i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache;var r=e.content||"",a=(e.url||t.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(i);return bizagi.debug("Save request for letter sent to: "+a,r),e.prepare?i:$.ajax({url:a,data:r,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrintUrl:function(e){var t=this,i=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(r)},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=this,i=e.extra||{};i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var r=e.submitData||{};for(key in r=t.processDataValues(r))i[key]=r[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-save-url"),data:i,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){var t=this;return e=e||{},t.userfieldRequests[e.userfield]?t.userfieldRequests[e.userfield]:(t.userfieldRequests[e.userfield]=$.read(t.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),t.userfieldRequests[e.userfield])},refreshControl:function(e){var t=this;e=e||{};var i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("form-get-data"),data:i,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){var t=this;e=e||{};var i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("form-get-data"),data:i,type:"POST",dataType:"json"})},executeRule:function(e){var t=this,i={};return e=e||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},executeInterface:function(e){var t=this,i={};return e=e||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},executeSAPConnector:function(e){var t=this,i={};return e=e||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},executeConnector:function(e){var t=this,i={};return e=e||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?i:$.create(t.serviceLocator.getUrl("form-submit-data"),i)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.h_pageCacheId=e.idPageCache,i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.cookie(".BIZCSRF")},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe(function(e){return e})},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportUrl:function(e){var t=this,i=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(r)+"&xsrf="+bizagi.cookie(".BIZCSRF")},sendEmail:function(e){var t=this;e=e||{};var i={};if(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),i[t.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,i[t.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return i;var r=e.url||t.serviceLocator.getUrl("form-get-data");return $.create(r,i)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){(e=e||{}).idUser,e.password;return $.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t=this,i={};e=e||{},i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var r=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?r="tablet":bizagi.util.isSmartphoneDevice()&&(r="mobile"),i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=r,e.prepare?i:$.create(t.serviceLocator.getUrl("form-get-data"),i)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t=this,i={};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,e.idStartScope&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(i[t.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:t.serviceLocator.getUrl("form-get-data"),data:i,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.pguidConstructor&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],i=function(t){t=t||{};var r="";return $.each(e,function(e,a){a[0]==t[6]&&(r+=i(a)+a[1]+" > ")}),r},r=function(t,a){var n,o,s,l=(s=[],o=(o=a)||"",$.each(e,function(e,t){t[6]==o&&s.push(t)}),s);return $.each(l,function(e,a){var o=r([],a[0]);(""!==(n={guidEntity:a[0],displayName:a[1],hasConstructor:!!a[5],type:a[3],guidObject:a[4],guidConstructor:a[5],xpathContext:a[2],children:o,parents:i(a)}).guidConstructor||n.children.length>0)&&t.push(n)}),t};return r(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},i=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:i,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:e.url,data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-commit-url"),data:i,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=this,i=e.extra||{};return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",i),e.prepare?i:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-checkpoint-url"),data:i,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})}}),bizagi.render.services.service.extend("bizagi.render.services.service",{},{init:function(e){this._super(e),this.database=e.database},getFormData:function(e){var t=this;return(e=e||{}).isOfflineForm?bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?t.getFormDataFromNative(e).then(function(e){return t.database.mergeForm(e[1],e[0].data)}):$.when(t.database.getCase(e.idCase)).then(function(e){var i=$.trim(e.idWfClass.toString());return t.database.mergeForm(e,t.database.getFormData(i))}):t._super(e)},getFormDataFromNative:function(e){var t=new $.Deferred;return bizagiapp.getNativeFormData(e,function(i){bizagiapp.getCase(e.idCase,function(e){var r=[JSON.parse(i),JSON.parse(e)];t.resolve(r)},function(e){t.reject(e)})},function(e){t.reject(e)}),t.promise()},submitData:function(e){var t=this;if((e=e||{}).isOfflineForm){var i=t.resolveData(e.data||{},e.xpathContext);return i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?t.saveNativeFormInfo(e,i):t.database.saveFormInfo(e,i)}return t._super(e)},saveNativeFormInfo:function(e,t){var i=this,r=new $.Deferred;return i.getFormDataFromNative(e).then(function(a){return i.database.nativeSaveFormInfo(t,a[1],a[0].data).done(function(t){bizagiapp.saveFormData(e,t),r.resolve(t)})}),r.promise()}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,arguments){var t=this.service;if(!arguments||1!=arguments.length)return e.apply(t,arguments);if("object"!=typeof arguments[0])return e.apply(t,arguments);var i=arguments[0];if(1==i.prepare)return e.apply(t,arguments);i.prepare=!0;var r=e.apply(t,arguments);return this.add(r)},makeCircularDependenciesError:function(e){return printf(bizagi.localization.getResource("render-actions-loop-validation"),e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,i=new $.Deferred,r=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA"].indexOf(r)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(r,e),clearTimeout(t.batchTimeout);var a=e.tag=Math.guid(),n={action:e,deferred:i};return t.batch[a]=n,t.batchTimeout=setTimeout(function(){var e=t.circularDependencies.resolve();if(e.error){for(var i in t.batch){var r=e.error.multiactionError;t.batch[i].deferred.reject(r)}t.batch={}}else t.fire()},t.batchTimer),i.promise()},fire:function(){var e={},t=[];$.each(this.batch,function(i,r){t.push(r.action),e[i]=r}),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done(function(t){$.each(t,function(t,i){var r=i.tag;i.error?e[r].deferred.reject(i.error,i,i.error.message):e[r].deferred.resolve(i.result),delete e[r]}),$.each(e,function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")})}).fail(function(t,i,r){var a=void 0!==r?r.message:r||"Operation didn't executed";$.each(e,function(e,t){t.deferred.reject({type:"not-processed",message:a},"","Operation didn't executed")})})},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,delete i.tag}),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done(function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(this,"servererror",t)}n.resolve(e)}).fail(function(e){var t,i=e.responseText||e;try{t=JSON.parse(i)}catch(e){}n.reject(e,"servererror",t)}),n.promise()}}),$.Class.extend("bizagi.command.controllers.controller",{THROW_ERROR:!0},{init:function(e){this.form=e,this.dateFormat=e.getResource("dateFormat")},buildConditions:function(e,t,i){var r=e.expressions&&e.expressions.length>1?this.buildConditionOperator(e.operator):e.operator;if(t=t||!1,i=i||!1,"true"==r)return"true";if("false"==r)return"false";for(var a="",n=0;n<e.expressions.length;n++){var o=e.expressions[n];o.simple?a+=this.buildSimpleCondition(o.simple,t,i):o.complex&&(a+="("+this.buildConditions(o.complex,t,i)+") "),a+=n<e.expressions.length-1?r:""}return a},buildConditionOperator:function(e){return"and"==e?" && ":"or"==e?" || ":e},buildSimpleCondition:function(e,t,i){var r,a,n="",o=e.operator,s="",l="";t=t||!1,i=i||!1;var d=e.xpath||e.renderId,c=this.detectConditionArgumentType(d,e.argumentType);if(r=this.buildXpath(d,c,t),"boolean"!=c&&(s+="!bizagi.util.isEmpty("+r+") && "),i&&d&&d.length>0&&!{boolean:""}.hasOwnProperty(c)&&(l="self.isVisible('"+d+"') && self.isEditable('"+d+"') && "),bizagi.util.isEmpty(e.argument)?""===e.argument&&(n='""'):(n=this.buildArgument(e.argument,c,t),"xpath"==c&&(s+="!bizagi.util.isEmpty("+n+") && ")),"includes"==o)return l+s+"self.includes("+r+","+n+") ";if("changes"==o)return"self.isChanged("+r+", params.changed)";if("equals"==o)return l+s+r+" == "+n;if("not-equals"==o)return l+r+" != "+n;if("less-than"==o)return l+s+r+" < "+n;if("less-equals-than"==o)return l+s+r+" <= "+n;if("greater-than"==o)return l+s+r+" > "+n;if("greater-equals-than"==o)return l+s+r+" >= "+n;if("like"==o)return l+s+r+".toString().indexOf("+n+") >= 0 ";if("is-empty"==o)return"entity"!=c?l+"bizagi.util.isEmpty("+r+")":l+"("+r+" == 0 || bizagi.util.isEmpty("+r+"))";if("is-not-empty"==o)return"entity"!=c?l+"!bizagi.util.isEmpty("+r+")":l+"("+r+" != 0 && !bizagi.util.isEmpty("+r+"))";if("is-true"==o)return l+"( "+r+" == true || "+r+" == 'true' )";if("is-false"==o)return l+"( "+r+" == false || "+r+" == 'false' || "+r+" == 'False' )";if("does-not-contain"==o)return l+s+r+".toString().indexOf("+n+") < 0 ";if("contains"==o)return l+s+r+".toString().indexOf("+n+") >= 0 ";if("begins-with"==o)return l+s+r+".toString().startsWith("+n+") == true ";if("does-not-begins-with"==o)return l+s+r+".toString().startsWith("+n+") == false ";if("file-uploaded"==o)return a=d,t&&a&&(a=a.replaceAll("[]","[' + i + ']")),l+"self.isFileUploaded('"+a+"') ";if("file-not-uploaded"==o)return a=d,t&&a&&(a=a.replaceAll("[]","[' + i + ']")),l+"!self.isFileUploaded('"+a+"') ";if("is-invalid-email"==o)return l+"!self.isValidEmail("+r+") ";if("letter-edited"==o)return"false";if("letter-not-edited"==o)return"false";if("cell-change"==o)return"column == "+n;if("on-press"==o)return t?"self.isGridButtonPressed("+this.buildXpath(d,"id",t)+", params.pressed)":"self.isButtonPressed('"+d+"', params.pressed)";if("on-deleted-row"==o)return"self.onDeletedGridRow('"+(a=d||"")+"', params.rowDeleted)";throw new"There is no implementation for operator code "+o},detectConditionArgumentType:function(e,t){if(void 0===t||"const"==t){var i=this.form,r=i.getRender(e)||i.getRenderById(e);if(null==r)throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller");if("grid"==r.properties.type){var a=this.processGridXpath(e);if(""===a.remainingXpath)return"xpath";if(null==(r=r.getColumn(a.remainingXpath)))throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller")}var n=r.properties.dataType,o=r.properties.type;return this.isRelatedEntityRender(o)?"entity":1==n||2==n||3==n||4==n||6==n||7==n||10==n||11==n?"number":8==n?"money":12==n||13==n?1==r.properties.showTime?"datetime":"date":5==n?"boolean":"button"==o?"button":"text"}return"xpath"==t||"function"==t||"entity"==t?t:"text"},isRelatedEntityRender:function(e){return"combo"==e||"cascadingCombo"==e||"list"==e||"radio"==e||"search"==e||"searchCombo"==e||"columnCombo"==e},buildXpath:function(e,t,i){return(i=i||!1)&&(e=e.replaceAll("[]","[' + i + ']")),"xpath"!=t||i?"id"==t?"'"+e+"'":"function"==t?"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')":i?"self.evalGridXpath(params, '"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')"},buildArgument:function(argument,argumentType,bGridDetected,xpathContext){var self=this,number;if(bGridDetected=bGridDetected||!1,"text"==argumentType)return argument=null==argument?"":argument,argument="string"!=typeof argument?argument.toString():argument,-1!=argument.indexOf("'")&&(argument=argument.replaceAll("'","\\'")),-1!=argument.indexOf("\n")&&(argument=argument.replaceAll("\n","")),"'"+argument.toString()+"'";if("boolean"==argumentType)return"string"==typeof argument?1==eval(argument.toLowerCase())?"true":"false":1==eval(argument)?"true":"false";if("number"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("money"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("date"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument);return date&&0!=date||(date=new Date(0)),date.setHours(0,0,0,0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date)+"').getTime()"}if("datetime"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument,!0);return date&&0!=date||(date=new Date(0)),date.setSeconds(0),date.setMilliseconds(0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date,!0)+"', true).getTime()"}if("color"==argumentType)return"'"+argument.toString()+"'";if("entity"==argumentType){if(bizagi.util.isEmpty(argument))return null;try{argument="object"!=typeof argument?JSON.parse(argument):argument}catch(e){argument=argument||{}}var result=argument.id||argument;return JSON.stringify(result)}if("xpath"==argumentType){var xpath=argument.toString();return bGridDetected&&(xpath=xpath.replaceAll("[]","[' + i + ']")),xpathContext&&(xpath=xpathContext+"."+xpath),self.buildXpath(xpath,argumentType,bGridDetected)}if("json"==argumentType)return JSON.encode(argument);if("function"==argumentType){if("BANow"==argument)return"self.getCurrentDate()";throw"There is no implementation for function "+argument}if(null==argumentType)return null;throw"There is no implementation for argument type "+argumentType},isEditable:function(e){var t=this.getRender(e);if(null!=t)return t.properties.editable;this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isVisible:function(e){var t=this.getRender(e);if(null!=t)return!!t.properties.visible&&this.isParentVisible(t.parent);this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isParentVisible:function(e){return e.parent?!!e.properties.visible&&this.isParentVisible(e.parent):e.properties.visible},evalGridXpath:function(params,xpath,argumentType){var self=this;if(void 0===params)return this.evalXpath(xpath,argumentType);var grid=params.grid;if(null==grid)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var gridXpath=self.processGridXpath(xpath),gridColumn=grid.getColumn(gridXpath.remainingXpath);if(!gridColumn)return!1;var cellValue=grid.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue=cellValue?cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:0),"columnCombo"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnSearch"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType||"date"==argumentType&&!bizagi.util.isEmpty(self.getRender(xpath,argumentType).value)?eval(self.buildArgument(cellValue,argumentType)):(void 0!==gridColumn&&void 0!==gridColumn.properties&&void 0!==gridColumn.properties.type&&"columnDate"==gridColumn.properties.type&&(cellValue=bizagi.util.dateFormatter.getDateFromInvariant(cellValue)),cellValue)},evalXpath:function(xpath,argumentType){var self=this,i,renderToEval,renders=self.getRenders(xpath);if(null==renders)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var rendersToEval=[];for($.each(renders,function(e,t){t.properties.editable&&rendersToEval.push(t)}),0===rendersToEval.length&&$.each(renders,function(e,t){rendersToEval.push(t)}),i=0;i<rendersToEval.length;){renderToEval=rendersToEval[i++];var bIsGrid="grid"==renderToEval.properties.type;if(bIsGrid){var gridXpath=self.processGridXpath(xpath),gridColumn=renderToEval.getColumn(gridXpath.remainingXpath);if(!gridColumn)continue;var cellValue=renderToEval.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue=cellValue?cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:0),"columnCombo"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnSearch"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType||"date"==argumentType&&!bizagi.util.isEmpty(self.getRender(xpath,argumentType).value)?eval(self.buildArgument(cellValue,argumentType)):(void 0!==gridColumn&&void 0!==gridColumn.properties&&void 0!==gridColumn.properties.type&&"columnDate"==gridColumn.properties.type&&(cellValue=bizagi.util.dateFormatter.getDateFromInvariant(cellValue)),cellValue)}var value=renderToEval.getValue();return void 0===argumentType||"undefined"===argumentType?value:("combo"!=renderToEval.properties.type&&"list"!=renderToEval.properties.type&&"cascadingCombo"!=renderToEval.properties.type&&"search"!=renderToEval.properties.type&&"radio"!=renderToEval.properties.type||(bizagi.util.isEmpty(value)||""==value.id)&&(value=0),"comboSelected"==renderToEval.properties.type?"string"==typeof value?JSON.parse(value).value:value:bizagi.util.isEmpty(value)?("boolean"!=renderToEval.properties.type||"check"!=renderToEval.properties.display)&&((!bizagi.util.isEmpty(value)||"boolean"!=renderToEval.properties.type||"check"!=renderToEval.properties.display)&&value):"xpath"==argumentType?eval(self.buildArgument(xpath,argumentType)):eval(self.buildArgument(value,argumentType)))}},isFileUploaded:function(e){var t=this.evalXpath(e);return!!(t&&t.length&&t.length>0)},isValidEmail:function(e){return!(!e||!e.match(new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gi)))},isButtonPressed:function(e,t){var i=this.getRenderById(e);return null!==i&&"button"==i.properties.type&&t},isGridButtonPressed:function(e,t){var i=this.processGridXpath(e),r=i.gridXpath,a=this.getRender(r),n=i.remainingXpath||"";return t&&a&&a.columns&&$.each(a.columns,function(e,i){i.properties.xpath!==n&&i.properties.id!==n||"columnButton"!==i.properties.type||(t=!0)}),t},isChanged:function(e,t){return null!=e&&t},includes:function(e,t){return null!=e&&(null!=t&&$.grep(e,function(e){return e.id==t}).length>0)},onDeletedGridRow:function(e,t){return!(!(this.getRender(e)||{})||!t)},getRenders:function(e){var t=this.form,i=null,r=/id=([\w-]+)/gi.exec(e);if(r&&r.length>1){var a=this.getRenderById(r[1]);return a?0==a.length?null:((i=[]).push(a),i):null}return 0==(i=t.getRenders(e)).length?null:i},getRender:function(e){return this.form.getRender(e)},getRenderById:function(e){return this.form.getRenderById(e)},showRenderNotFoundError:function(e){bizagi.debug("Cannot find render in DOM: "+e)},showContainerNotFoundError:function(e){bizagi.debug("Cannot find container in DOM: "+e)},getCurrentDate:function(){var e=new Date;return e.setHours(0,0,0,0),e},processGridXpath:function(e){var t,i,r,a=new RegExp(/([\w\.]*)\[(\d*)\]\.([\w\.|\w-\.]*)/g).exec(e);return a?(r=a[1],t=a[2],i=a[3]):(t="",i=""),{xpath:e,index:t,remainingXpath:i,gridXpath:r}},searchForGridReference:function(e,t){var i;if(e)return this.searchGridReferenceInCondition(e);if(t)for(i in t){var r=t[i];return this.searchForGridReferenceInCommand(r)}return null},searchForGridReferenceInCommand:function(e){return e.xpath&&e.xpath.indexOf("[]")>0?e.xpath.substring(0,e.xpath.indexOf("[]")):"xpath"==e.argumentType&&e.argument.indexOf("[]")>0?e.argument.substring(0,e.argument.indexOf("[]")):void 0},searchGridReferenceInCondition:function(e){var t,r=this;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){for(i in e.expressions)if(t=r.searchGridReferenceInCondition(e.expressions[i]))return t}else{if(e.simple)return r.searchGridReferenceInCondition(e.simple);if(e.complex)return r.searchGridReferenceInCondition(e.complex);if(e.xpath||e.renderId){if(t=r.searchGridReferenceInXpath(e.xpath)||r.searchGridReferenceInXpath(e.renderId))return t;if("xpath"==e.argumentType&&(t=r.searchGridReferenceInXpath(e.argument)))return t}}return null},searchGridReferenceInXpath:function(e){return e&&e.indexOf("[]")>0?e.substring(0,e.indexOf("[]")):null},getGridControl:function(e,t){var i=this.processGridXpath(e).remainingXpath;return this.getRender(e).getControlCell(t,i)}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.validation",{},{init:function(e,t,i){var r=this;r.enableDebug=!1,this._super(e);var a=null!=i?i.container:e.container,n=$("<div />").appendTo(a);$.widget("ui.bizagi_notifications",$.ui.bizagi_notifications,{expand:function(){this._super(),r.form.triggerGlobalHandler("modalViewDidAppear",{})},collapse:function(){this._super(),r.form.triggerGlobalHandler("modalViewDidDisappear",{})}}),n.bizagi_notifications({itemIcon:"ui-icon-circle-close",minimized:!1,clearEnabled:!1,title:e.getResource("render-form-validations-header-text"),device:bizagi.util.detectDevice(),orientation:e.properties.orientation}),n.bind("itemClick",function(e,t){r.onNotificationClick(t.data)}),t&&r.buildValidations(t),r.validationBox=n,r.validations=t||[]},buildValidations:function(e){var t=this,i=t.buildAllValidations(e);t.form.bind("rendervalidate",function(){return i(t)})},showErrorMessage:function(e){bizagi.showErrorAlertDialog=!1,this.showValidationMessage(e,null,"ui-icon-circle-close","ui-state-error")},showAlertMessage:function(e){this.showValidationMessage(e,null,"ui-icon-alert","ui-state-highlight")},showInfoMessage:function(e){this.showValidationMessage(e,null,"ui-icon-info","ui-state-highlight")},showValidationMessage:function(e,t,i,r,a){var n=this,o=n.form,s=t?o.getRender(t):null;bizagi.showErrorAlertDialog=!1;var l=function(){n.clearValidationMessages(),n.validating=!0,n.performValidations(),n.validating=!1,0==n.countValidationMessages()?(n.hideValidationMessages(),n.form.triggerGlobalHandler("modalViewDidDisappear",{})):n.form.triggerGlobalHandler("modalViewDidAppear",{}),o.triggerGlobalHandler("modalViewDidDisappear",{})};n.validationBox.bizagi_notifications("addNotification",e,t,i,r,l,a),s&&(s.setValidationMessage(e),bizagi.util.isIE8()||n.validating||s.one("rendervalidate",l))},countValidationMessages:function(){return this.validationBox.bizagi_notifications("count")},clearValidationMessages:function(e){return $(".ui-bizagi-notifications-container","body").not(".ui-bizagi-log-container").bizagi_notifications("clearAll",void 0,e)},hideValidationMessages:function(){return this.validationBox.bizagi_notifications("hide")},showValidationMessages:function(){return this.validationBox.bizagi_notifications("show")},expandNotificationBox:function(e){return!1!==e&&this.validationBox.bizagi_notifications("autoFocusFirstError"),this.validationBox.bizagi_notifications("expand")},isExpandedNotificationBox:function(){return this.validationBox.bizagi_notifications("isExpanded")&&this.validationBox.bizagi_notifications("isContentVisible")},performValidations:function(e){var t=this;t.clearValidationMessages(),t.validationBox.bizagi_notifications("initBatch");var i=t.validateRenders(e),r=!(t.validations.length>0)||t.form.triggerHandler("rendervalidate");return t.validationBox.bizagi_notifications("endBatch"),!(!r||!i)||(t.validationBox.bizagi_notifications("show"),!1)},buildAllValidations:function(e){for(var t="",i=0;i<e.length;i++){if(null==e[i].enabled||e[i].enabled)try{t+=this.buildValidation(e[i].conditions,e[i].validationCommand)}catch(t){"RenderNotFoundException"!=t.message&&bizagi.logError("Validation cannot be parsed: "+t.message,e[i])}}var r="var baTmpFn = function(self, params){\r\n var bValid = true;\r\n "+t+"\r\n return bValid;}; baTmpFn";return this.evalValidation(r)},buildValidation:function(e,t){var i="",r="",a=this.searchForGridReference(e),n=null!=a;i+="( "+this.buildConditions(e,n,!0)+" )",t.message=t.message.replace(/'/g,"\\'"),t.message=t.message.replace(/\n/g," ");var o=t.focus||"";if(n&&(o=a),t.tokens?r+="self.showValidationMessage(' "+t.message+"', '"+o+"', JSON.parse('"+JSON.encode(t.tokens)+"')); bValid = false;\r\n":r+="self.showValidationMessage(' "+t.message+"', '"+o+"'); bValid = false;\r\n",n){var s="var grid = self.form.getRender('"+a+"');\r\n";return s+="if(grid === null) return true;\r\n",s+="var data = grid.getIndexes();\r\n",s+="var bGridValid = true;\r\n",s+="$.each(data, function(_, i) {\r\n",s+="if ("+i+"){\r\n bGridValid = false; \r\n}",s+="});\r\n",s+="if (bGridValid == false){\r\n "+r+"\r\n}"}return"if ("+i+"){\r\n "+r+" \r\n}"},onNotificationClick:function(e){var t=this.form;if(e){var i=t.getRender(e);i&&i.focus()}},validateRenders:function(e){e=e||[];var t=this.form.isValid(e);if(!t)for(var i=0;i<e.length;i++)(e[i].message||e[i].xpath)&&this.showValidationMessage(e[i].message,e[i].xpath);return t},evalValidation:function(command){var self=this;return self.enableDebug&&null!=console&&console.log(command),eval(command)}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.action",{},{init:function(e,t){var i=this;this._super(e),i.globalDependencies={},i.initialCallFunctions={},i.initialCallFunctionsDeferred=new $.Deferred,t&&i.buildActions(t),i.actions=t,i.internalSubmitActions={},i.initialCallTimeout=25,i.initialCallIncrements=25,i.actionsHistory={},i.period=50},processInternalSubmitAction:function(e,t){this.internalSubmitActions[e]||(this.internalSubmitActions[e]=t,this.buildAction(t,!0))},isSummaryOrGlobalForm:function(){var e=!1;return"SummaryForm"!=this.form.properties.typeForm&&"GlobalForm"!=this.form.properties.typeForm||(e=!0),e},evalClientAction:function(e){for(var t,i=0,r=!1,a=[].concat(e.commands,e.elseCommands),n=a.length;i<n;i++)if(t=a[i],!this.isClientAction(t)){r=!0;break}r&&(e.enabled=!1)},buildActions:function(e,t){var i,r,a=this,n={},o=a.isSummaryOrGlobalForm();for(i=0,r=e.length;i<r;i++)try{var s=e[i],l=bizagi.util.md5(JSON.stringify(s.conditions)),d=bizagi.util.md5(JSON.stringify(s.commands));n[l]?-1===n[l].indexOf(d)&&(o&&a.evalClientAction(s),a.buildAction(s,t),n[l].push(d)):(o&&a.evalClientAction(s),a.buildAction(s,t),n[l]=[d])}catch(t){"RenderNotFoundException"!=t.message&&bizagi.logError("Action cannot be parsed: "+t.message,e[i])}},unbindActions:function(){$.each(this.globalDependencies,function(e,t){t.unbind("renderchange.action")}),this.globalDependencies={},$.each(this.initialCallFunctions,function(e,t){clearTimeout(t)}),this.initialCallFunctions={}},refreshActions:function(e){var t=this;t.initialCallTimeout=25,t.initialCallFunctions={},e=e||[],t.actions=t.actions.concat(e),t.buildActions(t.actions,!0),$.each(t.internalSubmitActions,function(e,i){try{t.buildAction(i,!1)}catch(e){"RenderNotFoundException"!=e.message&&bizagi.logError("Action cannot be parsed: "+e.message,i)}})},buildAction:function(e,t){var i=this,r=i.form,a=[],n=[];if(null==e.enabled||e.enabled){if(e.conditions&&"true"==e.conditions.operator&&(e.dependencies||(e.dependencies=[]),$.each(e.commands,function(t,r){var a=i.searchGridReferenceInXpath(r.xpath);if(a){var n,o,s=!1;for(n=0,o=e.dependencies;n<o;n++)e.dependencies[n]==a&&(s=!0);s||e.dependencies.push(a)}})),e.dependencies)for(var o=0;o<e.dependencies.length;o++)if(void 0!==e.dependencies[o]){var s=r.getRenders(e.dependencies[o]);if(0==s.length){var l=r.getRenderById(e.dependencies[o]);s=l?[l]:null}s&&$.each(s,function(e,t){var i;$.inArray(t.properties.id,n)<0&&(i=t.properties.type,-1===["groupedgrid","collectionnavigator"].indexOf(i)&&(n.push(t.properties.id),a.push(t)))})}var d=i.buildFunction(e.conditions,e.commands,e.elseCommands);if($.each(a,function(r,a){a.bind("renderchange.action",function(t,r){if((r=r||{}).changed=void 0===r.changed||r.changed,r.column){for(var a=0;a<e.gridColumns.length;a++)if(r.column==e.gridColumns[a])return void d(i,r)}else d(i,r)}),i.globalDependencies[a.properties.id]=a,"grid"==a.properties.type&&(t=!0,e.gridColumns=[],i.searchGridColumns(e.conditions,e.gridColumns))}),!t){var c,u,p;c=i,u=Math.guid(),p=setTimeout(function(){try{d(c),delete c.initialCallFunctions[u]}catch(e){}},c.initialCallTimeout),c.initialCallFunctions[u]=p,c.initialCallTimeout+=c.initialCallIncrements}}},buildFunction:function(conditions,commands,elseCommands){var self=this,gridReference=self.searchForGridReference(conditions,commands),bGridDetected=null!=gridReference&&gridReference,sJsCondition="",sJsAction="",sStatement,sJsElseAction="",bAutomaticRestore=!elseCommands,bCondition=!!conditions,i;for(bCondition&&(sJsCondition+=self.buildConditions(conditions,bGridDetected)),i=0;i<commands.length;i++){var queueAction=self.isServerCommand(commands[i])?"addParallel":"add",command=self.buildCommand(commands[i],bGridDetected);command=command.indexOf(";")>=1?command.replace(";",""):command,sJsAction+="actionQueue."+queueAction+"(function(){return "+command+" ;}); \r\n",bAutomaticRestore&&(sJsElseAction+=self.buildRestoreCommand(commands[i],bGridDetected))}if(!bAutomaticRestore){for(sJsElseAction+="var actionQueue = new bizagiQueue(); \r\n",sJsElseAction+="if (params.render){params.render.startActionExecution();} \r\n",i=0;i<elseCommands.length;i++){var queueAction=self.isServerCommand(elseCommands[i])?"addParallel":"add",elseCommand=self.buildCommand(elseCommands[i],bGridDetected);elseCommand=elseCommand.indexOf(";")>=1?elseCommand.replace(";",""):elseCommand,sJsElseAction+="actionQueue."+queueAction+"(function(){return "+elseCommand+" ;}); \r\n"}sJsElseAction+="var execute = actionQueue.execute().always(function(){ \r\n",sJsElseAction+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sJsElseAction+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n"}if(sStatement="var baTmpFn = function(self, params){ \r\n",sStatement+="params = params || {};\r\n",bGridDetected&&(sStatement+="var i = params.key;\r\n",sStatement+="var column = params.column;\r\n"),bCondition&&(sStatement+="if ("+sJsCondition+"){ \r\n"),sStatement+="var actionQueue = new bizagiQueue(); \r\n",sStatement+="if (params.render){params.render.startActionExecution();} \r\n",sStatement+=sJsAction,sStatement+="var execute = actionQueue.execute().always(function(){ \r\n",sStatement+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sStatement+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n",bCondition&&(sStatement+="\r\n } ",sJsElseAction.length>0&&(sStatement+="else { \r\n"+sJsElseAction+" }\r\n")),sStatement+="};\r\n",bGridDetected){var sGridStatement="var baGridTmpFn = function(self, args){ \r\n";sGridStatement+="args = args || {};\r\n",sGridStatement+="\t var grid = args.render || self.form.getRender('"+gridReference+"') || []; \r\n",sGridStatement+="\t args.grid = grid; \r\n",sGridStatement+="if(args.surrogateKey === undefined){\r\n",sGridStatement+="\t var data = grid.getIndexes();\r\n",sGridStatement+="\t $.each(data, function(i, index) {\r\n",sGridStatement+="\t\t args.key = index; \r\n",sGridStatement+="\t\t baTmpFn(self, args);\r\n",sGridStatement+="\t });\r\n",sGridStatement+="} else {\r\n",sGridStatement+="\t args.key = args.surrogateKey; \r\n",sGridStatement+="\t\t baTmpFn(self, args ); \r\n",sGridStatement+="}\r\n",sGridStatement+="};\r\n",sStatement+=sGridStatement,sStatement+="baGridTmpFn"}else sStatement+="baTmpFn";return eval(sStatement)},isServerCommand:function(e){var t=e.command;return"refresh"==t||"submit-data"==t||"execute-rule"==t||"execute-interface"==t||"execute-sap"==t||"execute-connector"==t||"execute-excel-bot"==t},isClientAction:function(e){var t=e.command;return"background-color"==t||"forecolor"==t||"visible"==t||"required"==t||"collapse"==t||"set-active"==t},isRecentAction:function(e,t){var i=this,r=e+"@"+t;return null!=i.actionsHistory[r]||($.when(i.runAction(e,t)).done(function(){delete i.actionsHistory[r],bizagi.log("resolve "+r)}),!1)},runAction:function(e,t){var i=e+"@"+t;return this.actionsHistory[i]=new $.Deferred,setTimeout(this.actionsHistory[i].resolve,this.period),this.actionsHistory[i].promise()},buildCommand:function(e,t){var i=t=t||!1,r=e.command,a=this.detectCommandArgumentType(e.argumentType,r),n=this.buildArgument(e.argument,a,t,e.xpathContext),o=e.xpath;if(e.renderId&&(o="id="+e.renderId),t&&o&&(o=o.replaceAll("[]","[' + i + ']")),e.xpath&&e.xpath.length>0||e.renderId&&e.renderId.length>0)switch(r){case"background-color":return"activityFlowButton"===e.controlType?"self.changeButtonBackground('"+o+"', "+n+");":"self.changeRenderBackground('"+o+"', "+n+");";case"forecolor":return"activityFlowButton"===e.controlType?"self.changeButtonForeground('"+o+"', "+n+");":"self.changeRenderForeground('"+o+"', "+n+");";case"visible":return"activityFlowButton"===e.controlType?"self.changeButtonVisibility('"+o+"', "+n+");":"self.changeRenderVisibility('"+o+"', "+n+");";case"readonly":return"activityFlowButton"===e.controlType?"self.changeButtonEditability('"+o+"', "+n+");":"self.changeRenderEditability('"+o+"', "+n+");";case"required":return"self.changeRenderRequired('"+o+"', "+n+");";case"set-value":return t&&"xpath"==e.argumentType&&e.xpathContext&&(e.argument=e.xpathContext+"."+e.argument,n=this.buildArgument(e.argument,a,t)),"self.changeRenderValue('"+o+"', "+n+");";case"set-min":return"self.changeRenderMinValue('"+o+"', "+n+");";case"set-max":return"self.changeRenderMaxValue('"+o+"', "+n+");";case"calculate":return"self.executeCalculatedField('"+o+"');";case"submit-value":return"self.submitRender('"+o+"', '"+n+"');";case"clean-data":return"self.cleanRenderData('"+o+"');";case"refresh":return this.searchForGridReferenceInCommand(e)?"self.refreshGridCell('"+o+"', '"+(e.xpathContext||"")+"');":"self.refreshControl('"+o+"', '"+(e.xpathContext||"")+"','"+r+"');";case"trigger-click":return"self.triggerClick('"+o+"');"}else switch(r){case"background-color":return"self.changeContainerBackground('"+e.container+"', "+n+");";case"visible":return"self.changeContainerVisibility('"+e.container+"', "+n+");";case"collapse":return"self.toogleContainer('"+e.container+"', "+!bizagi.util.parseBoolean(n)+");";case"set-active":return"self.changeActiveItem('"+e.container+"');";case"readonly":return"self.changeContainerEditability('"+e.container+"', "+bizagi.util.parseBoolean(n)+");";case"refresh":return"self.refreshContainer('"+e.container+"', '"+(e.xpathContext||"")+"');"}if("submit-data"==r)return"self.submitFormData();";if("execute-rule"==r){var s=e.argument||{},l="";try{l=JSON.parse(s).guid}catch(e){}var d=e.xpathContext||"";if(t){var c=i+"[id=%s]";return"self.executeRule('"+l+"', printf('"+c+"',i) ,'"+r+"');"}return"self.executeRule('"+l+"','"+d+"','"+r+"');"}if("execute-interface"==r){var u=e.argument||{},p="";try{p=JSON.parse(u).guid}catch(e){}return d=e.xpathContext||"",t?"self.executeInterface('"+p+"', printf('"+(c=i+"[id=%s]")+"',i));":"self.executeInterface('"+p+"','"+d+"');"}if("execute-sap"==r){var g=e.argument||{},h="";try{h=JSON.parse(g).guid}catch(e){}return d=e.xpathContext||"",t?"self.executeSAPConnector('"+h+"', printf('"+(c=i+"[id=%s]")+"',i));":"self.executeSAPConnector('"+h+"','"+d+"');"}if("execute-connector"==r||"execute-excel-bot"==r){g=e.argument||{};var m="";try{m=JSON.parse(g).guid}catch(e){}return d=e.xpathContext||"",t?"self.executeConnector('"+m+"', printf('"+(c=i+"[id=%s]")+"',i));":"self.executeConnector('"+m+"','"+d+"');"}return bizagi.log("There is no definition for commandType: "+r),""},buildRestoreCommand:function(e,t){var i=e.xpath,r=e.command;return t=t||!1,e.renderId&&(i="id="+e.renderId),t&&(i=i.replaceAll("[]","[' + i + ']")),i&&i.length>0?"self.restoreRender('"+i+"', '"+r+"');":"self.restoreContainer('"+e.container+"', '"+r+"');"},detectCommandArgumentType:function(e,t){if(void 0===e)return e;if("const"==e){if("background-color"==t)return"color";if("forecolor"==t)return"color";if("visible"==t)return"boolean";if("readonly"==t)return"boolean";if("required"==t)return"boolean";if("set-value"==t)return"text";if("collapse"==t)return"boolean";if("set-active"==t)return"number";if("set-min"==t)return"text";if("set-max"==t)return"text";if("calculate"==t)return;if("refresh"==t)return;if("submit-value"==t)return"json"}else if("xpath"==e||"entity"==e)return e;return bizagi.log("There is no definition for commandType: "+t),null},restoreRender:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){var n=a.originalProperties,o=n.textFormat||{};"background-color"==t&&i.changeRenderBackground(e,o.background||""),"forecolor"==t&&i.changeRenderForeground(e,o.color||"none"),"visible"==t&&i.changeRenderVisibility(e,null==n.visible||n.visible),"readonly"==t&&i.changeRenderEditability(e,null==n.editable||n.editable),"required"==t&&i.changeRenderRequired(e,null!=n.required&&n.required)}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},restoreContainer:function(e,t){var i=this,r=i.form.getContainer(e);if(null!=r){var a=r.originalProperties;"background-color"==t&&i.changeContainerBackground(e,a.backgroundColor||"none"),"visible"==t&&i.changeContainerVisibility(e,null==a.visible||a.visible),"collapse"==t&&i.toogleContainer(e,!0),"readonly"==t&&i.changeContainerEditability(e,null==a.editable||a.editable)}else i.Class.THROW_ERROR&&i.showContainerNotFoundError(xpath)},changeRenderBackground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellBackgroundColor(r[e],n.remainingXpath,t)}else a.changeCellBackgroundColor(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){a.changeBackgroundColor(t)})}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonBackground:function(e,t){var i=e.substring(3),r=this.form.getButton(i);r.css("background-image","none"),r.addClass("ui-fast-transition"),void 0!==r[0]&&r[0].style.setProperty("background-color",t,"important")},changeRenderForeground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellColor(r[e],n.remainingXpath,t)}else a.changeCellColor(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){a.changeColor(t)})}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonForeground:function(e,t){var i=e.substring(3);this.form.getButton(i).css("color",t,"!important")},changeRenderVisibility:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellVisibility(r[e],n.remainingXpath,t)}else a.changeCellVisibility(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){$.when(a.renderingDeferred).done(function(){a.changeVisibility(t)})})}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonVisibility:function(e,t){var i=e.substring(3),r=this.form.getButton(i);1==bizagi.util.parseBoolean(t)?(r.show(),r.css("display","")):r.hide()},changeRenderEditability:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){if(i.isValidRender(a))if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellEditability(r[e],n.remainingXpath,t)}else a.changeCellEditability(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){$.when(a.renderingDeferred).done(function(){a.changeEditability(t)})})}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonEditability:function(e,t){var i=e.substring(3),r=this.form.getButton(i);1==bizagi.util.parseBoolean(t)?r.removeAttr("disabled"):r.attr("disabled","disabled")},triggerClick:function(e){var t=e.substring(3);this.form.getButton(t).trigger("click")},changeRenderRequired:function(e,t){var i=this,r=i.getRenders(e),a=[];null!=r?($.each(r,function(e,t){bizagi.util.parseBoolean(t.properties.editable)&&a.push(t)}),0===a.length&&(a=r),$.each(a,function(r,a){if(i.isValidRender(a))if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellRequired(r[e],n.remainingXpath,t)}else a.changeCellRequired(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){$.when(a.renderingDeferred).done(function(){a.changeRequired(t)})})})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderValue:function(e,t){var i=this;"object"==typeof t&&(t=$.extend(t,{fromAction:!0}));var r=i.getRenders(e);if(null!=r){var a=[];$.each(r,function(e,t){t.properties.editable&&a.push(t)}),0==a.length&&$.each(r,function(e,t){a.push(t)}),$.each(a,function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellValue(r[e],n.remainingXpath,t)}else a.changeCellValue(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){a.asyncRenderDeferred?$.when(a.asyncRenderDeferred).done(function(){a.setDisplayValue(t)}):a.setDisplayValue(t)})})}else i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMinValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellMinValue(r[e],n.remainingXpath,t)}else a.changeCellMinValue(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){var e=a.properties.type;"number"!=e&&"date"!=e&&"money"!=e||a.changeMinValue(t)})}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMaxValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done(function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellMaxValue(r[e],n.remainingXpath,t)}else a.changeCellMaxValue(n.index,n.remainingXpath,t)})}else $.when(a.ready()).done(function(){a.changeMaxValue(t)})}):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},executeCalculatedField:function(e){var t=this.getRenders(e);null!=t?$.each(t,function(e,t){$.when(t.ready()).done(function(){t.runFormula()})}):this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshControl:function(e,t,i){var r=this.getRenders(e)||this.form.getContainer(e),a=new bizagiQueue;if(null!=r)return $.each(r,function(i,r){a.add(r.ready().pipe(function(){return r.refreshControl({xpath:e,xpathContext:t})}))}),a.execute();this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i)return $.when(i.ready()).pipe(function(){return i.refreshContainer({xpathContext:t})});this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshGridCell:function(e,t){var i=this,r=new bizagiQueue,a=new $.Deferred,n=i.getRenders(e)||i.form.getContainer(e);if(null==n)return i.Class.THROW_ERROR&&i.showRenderNotFoundError(e),null;var o=[];return $.each(n,function(e,t){if(t.properties.editable)return o.push(t),!1}),0==o.length&&$.each(n,function(e,t){return o.push(t),!1}),0!==o.length?(i.form&&""!==i.form.properties.xpathContext&&(t=""!==t?i.form.properties.xpathContext+"."+t:i.form.properties.xpathContext),r.add(a.promise()),$.when.apply($,$.map(o,function(e){e.ready()})).done(function(){for(var r=o.length,n=new bizagiQueue,s=0;s<r;s++){var l=o[s],d=i.processGridXpath(e);if(bizagi.util.isEmpty(d.index))for(var c=l.getIndexes(),u=c.length,p=0;p<u;p++)n.addParallel(l.refreshCell({key:c[p],column:d.remainingXpath,xpathContext:t}));else n.add(l.refreshCell({key:d.index,column:d.remainingXpath,xpathContext:t}))}$.when(n.execute()).done(function(){a.resolve()})}),r.execute()):void 0},submitFormData:function(e){var t=this.form;return $.when(t.ready()).pipe(function(){return t.submitData(e)})},executeRule:function(e,t,i){var r=this.form,a=e+"."+t;return this.isRecentAction(a,i)?void 0:$.when(r.ready()).pipe(function(){return r.executeRule({rule:e,xpathContext:t})})},executeInterface:function(e,t){var i=this.form;return $.when(i.ready()).pipe(function(){return i.executeInterface({interface:e,xpathContext:t})})},executeSAPConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe(function(){return i.executeSAPConnector({guidsap:e,xpathContext:t})})},executeConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe(function(){return i.executeConnector({guidConnector:e,xpathContext:t})})},submitRender:function(e,t){var i=this.getRender(e);if(null!=i)return $.when(i.ready()).pipe(function(){return i.submitOnChange()});this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},cleanRenderData:function(e){var t=this,i=t.getRenders(e);null!=i?$.each(i,function(i,r){if(t.isGridComponent(r,e)){var a=t.processGridXpath(e);$.when(r.ready()).done(function(){if(bizagi.util.isEmpty(a.index)){var e,t,i=r.getIndexes();for(e=0,t=i.length;e<t;e++)r.cleanCellData(i[e],a.remainingXpath)}else r.cleanCellData(a.index,a.remainingXpath)})}else $.when(r.ready()).done(function(){$.when(r.renderingDeferred).done(function(){r.cleanData(),t.changeRenderRequired(e,null!=r.properties.required&&r.properties.required)})})}):t.Class.THROW_ERROR&&t.showRenderNotFoundError(e)},changeContainerBackground:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done(function(){i.changeBackgroundColor(t)}):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerVisibility:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready(!0)).done(function(){$.when(i.renderingDeferred).done(function(){i.changeVisibility(t)})}):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},toogleContainer:function(e,t){var i=this.form.getContainer(e);null!=i?"group"==i.properties.type&&$.when(i.ready()).done(function(){i.toogleContainer(t)}):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeActiveItem:function(e){var t=this.form.getContainer(e);null!=t?("tabItem"==t.properties.type&&t.loadingDeferred.resolve(),$.when(t.ready()).done(function(){t.setAsActiveContainer()})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerEditability:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done(function(){i.changeEditability(t)}):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},searchGridColumns:function(e,t){var i;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){var r,a;for(r=0,a=e.expressions.length;r<a;r++)this.searchGridColumns(e.expressions[r],t)}else{if(e.simple)return this.searchGridColumns(e.simple,t);if(e.complex)return this.searchGridColumns(e.complex,t);var n=e.xpath||e.renderId;n&&(n&&n.indexOf("[]")>0&&(i=n.substring(n.indexOf("[]")+3),t.push(i)),"xpath"==e.argumentType&&e.argument.indexOf("[]")>0&&(i=e.argument.substring(e.argument.indexOf("[]")+3),t.push(i)))}return null},isGridComponent:function(e,t){return"grid"==e.properties.type&&t.indexOf("[")>=0},isValidRender:function(e){return-1===["collectionnavigator"].indexOf(e.properties.type)}}),bizagi.command.controllers.action.extend("bizagi.command.controllers.action",{},{changeButtonBackground:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()&&this._super(e,t)},changeButtonForeground:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()&&this._super(e,t)},changeButtonVisibility:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()?this._super(e,t):this.changeFloatingButtonVisibility(e,t)},changeButtonEditability:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()?this._super(e,t):this.changeFloatingButtonVisibility(e,t)},changeFloatingButtonVisibility:function(e,t){var i=this.form,r=e.substring(3),a=i.getNavigation(),n=i.buttons&&i.buttons.length?i.buttons:i.properties.buttons||[],o=!1!==bizagi.util.parseBoolean(t),s=n.findIndex(function(e){return e.id===r});-1!==s&&(n[s].visible=o),i.buttons=n||[],a.setNavigationButtons(i)}}),$.Class.extend("bizagi.rendering.element",{ELEMENT_TYPE_CONTAINER:1,ELEMENT_TYPE_RENDER:2,ELEMENT_TYPE_COLUMN:3},{init:function(e){this.renderFactory=e.renderFactory,this.dataService=e.dataService,this.parent=e.parent,this.resources=bizagi.localization,this.observableElement=$("<div />"),this.disposed=!1,this.initializeData(e.data),this.subscribers=[]},initializeData:function(e){this.properties={},e&&e.properties&&(this.properties=e.properties),this.properties.xpathContext=this.getXpathContext(),this.properties.idPageCache=this.getPageCache()},getXpathContext:function(){return null!=this.parent&&"function"==typeof this.parent.getXpathContext?this.parent.getXpathContext():""},getPageCache:function(){return null!=this.parent&&"function"==typeof this.parent.getPageCache?this.parent.getPageCache():""},getFormContainer:function(){if(void 0!==this.parent)return this.parent.getFormContainer()},getResource:function(e){return this.resources.getResource(e)},getElementType:function(){},resize:function(e){},focus:function(){if(this.properties.required){var e=$("#ui-bizagi-wp-app-render-form-content");bizagi.util.isScrolledIntoView(this.element,e)||$(this.element).attr("tabindex",-1).focus(),this.element&&this.element.effect("highlight",2e3)}this.parent&&"function"==typeof this.parent.focus&&this.parent.focus()},triggerGlobalHandler:function(e,t){return this.disposed?null:this.parent?this.parent.triggerGlobalHandler(e,t):null},trigger:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.trigger(e,t):null},triggerHandler:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.triggerHandler(e,t):null},bind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.bind(e,t):(this.subscribers.push({event:e}),null)},unbind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.unbind(e,t):null},one:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.one(e,t):(this.subscribers.push({event:e}),null)},getRenderedElement:function(){},getMode:function(){if(this.parent)return this.parent.getMode()},getParams:function(){if(this.parent)return this.parent.getParams()},getFormType:function(){return this.getFormContainer().properties.type||"form"},ready:function(){},isReadyToSave:function(){},getCustomHandlers:function(){return null},dispose:function(){var e=this;e.disposed=!0,setTimeout(function(){null!=e.subscribers&&$.each(e.subscribers,function(t,i){e.unbind(i.event)}),delete e.subscribers,e.observableElement&&e.observableElement.off(),bizagi.util.dispose(e)},bizagi.override.disposeTime||50)},isDisposed:function(){return this.disposed},processFailMessage:function(e){var t=this.getFormContainer(),i=bizagi.util.isOfflineForm({context:this});if("CustomMessageException"===e.errorType){t.validationController.clearValidationMessages();var r=bizagi.localization.getResource(e.message);t.validationController.showErrorMessage(r)}else if("InvalidCaseStateException"===e.errorType){var a=t.getParams();t.validationController.clearValidationMessages(),t.container.trigger("routing",{idCase:a.idCase||bizagi.context.idCase})}else{var n=(e="string"==typeof(e=e||{})?JSON.parse(e):e).type||"error",o=e.code||"code";if(e=e.responseText||e.message||e,"not-processed"===n)return;if("not-shown"===n)return;if(i&&"AUTH_ERROR"===o)return;t.validationController.clearValidationMessages(),"alert"==n?t.validationController.showAlertMessage(e):t.validationController.showErrorMessage(e)}return e},startLoading:function(){},endLoading:function(){},beforeToRefresh:function(){},afterToRefresh:function(){}}),bizagi.rendering.element.extend("bizagi.rendering.container",{TYPE_QUERY_FORM:"queryForm"},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||(t.parent?t.parent.properties.orientation:"ltr"),this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,function(e,i){i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)})},createRenderElement:function(e){var t,i=this,r=i.properties;0==r.editable&&(e.render.properties.editable=r.editable,"grid"==e.render.properties.type&&(e.render.properties.inlineEdit=!1)),!1===r.required&&(e.render.properties.required=r.required),"duplicate"==e.render.properties.retype&&(t=bizagi.clone(e));var a=i.renderFactory.getRender({type:e.render.properties.type,data:e.render,dataService:i.dataService,parent:i,mode:i.getMode()});i.children.push(a),"duplicate"==e.render.properties.retype&&i.processDuplicateRender(a,t),i.getFormContainer().registerRender(a)},createContainerElement:function(e){var t=this,i=t.properties;0==i.editable&&(e.container.properties.editable=i.editable),!1===i.required&&(e.container.properties.required=i.required);var r=t.renderFactory.getContainer({type:e.container.properties.type,data:e.container,parent:t,dataService:t.dataService,mode:t.getMode()});t.children.push(r),t.getFormContainer().registerRender(r)},createFormElement:function(e){var t=this,i=t.properties;0==i.editable&&(e.container.properties.editable=i.editable);var r=t.renderFactory.getContainer({type:e.form.properties.type||"form",data:e.form,parent:t,dataService:t.dataService,mode:t.getMode()});t.children.push(r)},getElement:function(){return this.container},getElementsByType:function(e,t){t=t||[];return $.each(this.children,function(i,r){r.properties.type==e&&t.push(r),r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.getElementsByType(e,t)}),t},processDuplicateRender:function(e,t){var i=this,r=JSON.parse(JSON.encode(t.render));r.properties.displayName=r.properties.displayName+" "+i.getResource("render-text-duplicate-label-sufix"),r.properties.xpath=r.properties.xpath+".clone",r.properties.isClone=!0;var a=i.renderFactory.getRender({type:r.properties.type,data:r,parent:i,mode:i.getMode()});e.cloneRender=a,i.children.push(a)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_CONTAINER},render:function(){var e,t=this;t.getMode();return e=t.internalRender(),t.applyContainerDefaults(),e.attr("data-container-id",t.properties.id),t.properties.tag&&e.attr("data-tag",t.properties.tag),t.params&&t.params.requestedForm&&e.addClass(t.params.requestedForm),e},internalRender:function(){var e=this.renderContainerHtml(),t=this.container=$(e);return this.postRenderContainer(t),this.container},renderContainerHtml:function(){return this.renderingDeferred=this.renderingDeferred||new $.Deferred,this.renderContainer()},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},getRenderedElement:function(){return bizagi.util.isEmpty(this.container)&&alert("container hasn't been rendered!"),this.container},applyContainerDefaults:function(){var e=this.properties;e.backgroundColor&&this.changeBackgroundColor(e.backgroundColor),e.visible||this.changeVisibility(e.visible)},changeBackgroundColor:function(e){this.properties.backgroundColor=e,$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeBackgroundColor(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeBackgroundColor(e)})},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?this.container.show():this.container.hide()},changeEditability:function(e){this.properties.editable=bizagi.util.parseBoolean(e),$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeEditability(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeEditability(e)})},replaceTag:function(e,t,i){bizagi.util.replaceSelector(e,t,i)},replaceChildrenTag:function(e,t){this.replaceTag(e,".children",t)},replaceChildrenHtml:function(e,t){return e.replace("{{children}}",t)},renderContainer:function(){},postRenderContainer:function(e){var t=this,i=(t.properties,t.getMode());t.renderingDeferred&&t.renderingDeferred.resolve(),t.container=e,t.executeChildrenPostRender(e),"execution"==i&&(t.configureHandlers(),t.applyPlaceHolderPolyfill()),"design"==i&&t.configureDesignView(),"layout"==i&&(t.configureDesignView(),t.configureLayoutView())},applyPlaceHolderPolyfill:function(){var e=window.placeHolderConfig||{};("placeholder"in $("<input>")[0]||"placeHolder"in $("<input>")[0])&&!e.forceApply||Placeholders.enable()},executeChildrenPostRender:function(e){var t=this,i=e.children();$.each(i,function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}else t.executeChildrenPostRender(i)})},configureHandlers:function(){},configureDesignView:function(){},configureLayoutView:function(){},renderChildrenHtml:function(){var e=this,t="";return $.each(e.children,function(i,r){var a=r.getElementType();a==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t+=r.renderElement()),a==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.renderContainerHtml()),e.childrenHash[r.properties.uniqueId]=r}),t},collectRenderValues:function(e){this.children&&$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)})},hasChanged:function(e){if((e=e||[]).length)return e;this.children&&$.each(this.children,function(t,i){if(e.length||i.hasChanged(e))return!1})},collectRenderValuesQueryForm:function(e){$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValuesQueryForm(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSentQueryForm()&&i.collectDataQueryForm(e)})},firstChild:function(){return this.children[0]},getRenders:function(e,t){return t=t||[],e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),$.each(this.children,function(i,r){r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.getRenders(e,t):r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e==r.properties.xpath&&t.push(r)}),t},getRender:function(e){var t=this.getRenders(e),i=null;return $.each(t,function(e,t){t.properties.editable&&null==i&&(i=t)}),null==i&&$.each(t,function(e,t){i=t}),i},getRendersByXpath:function(e){return this.getRenders(e)},getContainer:function(e){var t;return this.properties.id==e?this:($.each(this.children,function(i,r){if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var a=r.getContainer(e);if(null!=a)return t=a,!1}}),t)},isValid:function(e){return $.each(this.children,function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.isValid(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.isValid(e))}),0==e.length},hasValidGrids:function(e){return $.each(this.children,function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.hasValidGrids(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&void 0!==i.grid&&i.isValid(e))}),0==e.length},ready:function(){return $.when(this.parent.ready(),this.isRendered())},isReadyToSave:function(){var e=$.map(this.children,function(e){return e.isReadyToSave()});return $.when.apply($,e)},getFocus:function(){var e;return $.each(this.children,function(t,i){if(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var r=i.getFocus();bizagi.util.isEmpty(r)||(e=r)}}),e},getCustomHandlers:function(){var e=this.getFormContainer();if(e)return e.getCustomHandlers()},getCustomHandler:function(e){var t=this.getCustomHandlers();if(t)return t[e]},dispose:function(){var e=this;setTimeout(function(){e.children&&$.each(e.children,function(e,t){t.dispose()})},bizagi.override.disposeTime||50),e._super()},refreshContainer:function(e){var t=this,i=t.properties;return t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,contexttype:t.properties.contexttype||""})).done(function(e){if(!t.isDisposed()){t.unregisterChildren(),delete t.children,delete t.childrenHash,t.getFormContainer().removeActions(),!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var i=t.container,r=t.render();"tabItem"==t.properties.type&&$(r).addClass("childrenActive"),i.replaceWith(r);var a=e.container&&e.container.actions?e.container.actions:[];t.getFormContainer().refreshActions(a),t.triggerChildrenActions(),t.afterToRefresh()}}).fail(function(e){e=t.processFailMessage(e)}).always(function(){t.endLoading()})},refreshDesignContainer:function(e){var t=this,i=t.properties;if(t.beforeToRefresh(e),$.extend(e.properties,{editable:i.editable,contexttype:i.contexttype||"",idPageCache:i.idPageCache,idRender:i.id,messageValidation:i.messageValidation,uniqueId:i.uniqueId,visible:i.visible,xpath:i.xpath,mode:"design",xpathContext:i.xpathContext||""}),!t.isDisposed()){t.unregisterChildren(),delete t.children,delete t.childrenHash,!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var r=t.container,a=t.render();"tabItem"==t.properties.type&&$(a).addClass("childrenActive"),r&&r.replaceWith(a),t.afterToRefresh()}},beforeToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].beforeToRefresh()},afterToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].afterToRefresh()},triggerChildrenActions:function(){this.getFormContainer();for(var e=this.children,t=0,i=e.length;t<i;t++){var r=e[t],a=r.getElementType();a===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.triggerChildrenActions():a===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.triggerRenderChange({changed:!1})}},registerActions:function(e){var t=this.getFormContainer();e&&t.actionController.buildActions(e)},unregisterChildren:function(){for(var e=this.getFormContainer(),t=this.children,i=0,r=t.length;i<r;i++){var a=t[i],n=a.getElementType();n===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?a.unregisterChildren():n===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e.unregisterRender(a)}},replaceChild:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){if(t[i].properties.uniqueId==e.properties.uniqueId){t.splice(i,1),t.splice(i,0,e);break}}},getChildById:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var a=t[i];if(a.properties.id==e)return a}return null}}),bizagi.rendering.container.extend("bizagi.rendering.container",{},{}),bizagi.rendering.container.extend("bizagi.rendering.form",{},{init:function(e){var t=this,i=e.data,r=bizagi.util.detectDevice();t.rendersById={},t.rendersByXpath={},t.rendersByType={},t.idPageCache=i.pageCacheId,t.mode=e.mode||"execution",t.focus=e.focus,t.params=e,this._super(e);var a="";a="desktop"!==r?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");var n=t.properties;n.sessionId=i.sessionId,n.displayAsReadOnly=bizagi.util.parseBoolean(i.displayAsReadOnly)||!1,n.userConfirmationMessage=n.userConfirmationMessage||a,n.orientation=n.orientation||"ltr",n.hasRule=bizagi.util.parseBoolean(n.hasRule)||!1,n.contexttype=e.contexttype||"",n.paramsRender=e.paramsRender||{},n.processPath=e.data.processPath?e.data.processPath.replaceAll("/","  &rsaquo;  "):"",n.breadCrumb=e.data.processPath?e.data.processPath.split("/"):[],this.validations=i.validations,this.actions=i.actions,t.initializeButtons(i),i.transitions&&(t.transitions=i.transitions),this.originalProcessButton=this.processButton},initializeButtons:function(e){var t=this;t.buttons=[],e.buttons&&$.each(e.buttons,function(e,i){var r=i.button.properties;r.caption=bizagi.util.isEmpty(r.caption)||t.getResource(r.caption)==r.caption?r.caption:t.getResource(r.caption),r.actions&&$.each(r.actions,function(e,t){r[t]=!0}),r.ordinal=e,r.action=r.next?"next":r.nextWithoutValidations?"nextWithoutValidations":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"",r.save="save"==r.action,(r.next||r.back||r.nextWithoutValidations)&&(r.routing=!0),r.hasRule&&(r.executeRule=!0),r.style=t.buildButtonStyle(r),"rtl"!==t.properties.orientation||t.properties.useCustomButtons?t.buttons.push(r):t.buttons.unshift(r)})},getParams:function(){return this.params},setParam:function(e,t){this.params&&(this.params[e]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){if(this.params)return this.params.customHandlers},registerRender:function(e){var t=this;t.rendersById[e.properties.id]=e,e.properties.xpath&&(t.rendersByXpath[e.properties.xpath]||(t.rendersByXpath[e.properties.xpath]=[]),t.rendersByXpath[e.properties.xpath].push(e)),t.rendersByType[e.properties.type]||(t.rendersByType[e.properties.type]=[]),t.rendersByType[e.properties.type].push(e)},unregisterRender:function(e){var t=this;if(t.rendersById[e.properties.id]&&delete t.rendersById[e.properties.id],e.properties.xpath)if($.isArray(t.rendersByXpath[e.properties.xpath])&&t.rendersByXpath[e.properties.xpath].length>1)for(var i=0,r=t.rendersByXpath[e.properties.xpath].length;i<r;i++){if(t.rendersByXpath[e.properties.xpath][i].properties.id===e.properties.id){t.rendersByXpath[e.properties.xpath].splice(i,1);break}}else delete t.rendersByXpath[e.properties.xpath];if(e.properties.type){var a=t.getRenderByType(e.properties.type),n=a.length,o=e.properties.id||e.properties.xpath;for(i=0;i<n;i++){var s=a[i];if(void 0!==s.properties.id&&s.properties.id==o||void 0!==s.properties.xpath&&s.properties.xpath==o){t.rendersByType[e.properties.type].splice(i,1);break}}}},getRenderById:function(e){return this.rendersById[e]},getGridByColumn:function(e){for(var t=this.getRenderByType("grid"),i=0;i<t.length;i++)if(-1!=t[i].columnsIds.indexOf(e))return t[i];return null},getRenders:function(e){return e&&e.indexOf&&e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),this.rendersByXpath[e]?this.rendersByXpath[e]:[]},getRenderByType:function(e){return"string"==typeof e&&e.length>0&&this.rendersByType[e]?this.rendersByType[e]:[]},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("form"),r=$.fasttmpl(i,{buttons:e.buttons,transitions:e.transitions,uniqueId:t.uniqueId,helptext:t.helpText,mode:e.getMode(),queryForm:"queryForm"==e.getFormType(),summaryForm:e.params.summaryForm||!1,globalForm:e.properties.displayAsReadOnly||!1,idCase:"",displayName:e.params.displayName||"",processPath:t.processPath,breadCrumb:t.breadCrumb,orientation:t.orientation});return r=e.replaceChildrenHtml(r,e.renderChildrenHtml())},postRenderContainer:function(e){var t=this.getMode();e.addClass("ui-bizagi-rendering-mode-"+t),this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each(function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)}):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",function(e,i){t.validationController=new bizagi.command.controllers.validation(t,t.validations,i),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()}),$(e).find(".ui-checkbox").bind("click",function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)})},configureDesignView:function(){var e=this;e.container;e.bind("ondomincluded",function(){e.readyDeferred.resolve()})},buildButtonStyle:function(e){var t={};if(e.format){if(e.format.size&&"0"!=e.format.size){var i=100+10*Number(e.format.size)+"%";t["font-size"]=i+" !important"}if(e.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),e.format.italic&&(t["font-style"]="italic !important"),e.format.underline||e.format.strikethru){var r=bizagi.util.parseBoolean(e.format.strikethru)?"line-through ":"",a=bizagi.util.parseBoolean(e.format.underline)?"underline ":"";t["text-decoration"]=r+a+" !important"}e.format.background&&(t["background-color"]=e.format.background+" !important",t["background-image"]="none !important"),e.format.color&&(t.color=e.format.color+" !important")}var n="";for(key in t)n+=key+":"+t[key]+";";return n},render:function(){return this.readyDeferred||(this.readyDeferred=new $.Deferred),this._super()},ready:function(){return this.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){if("startform"==this.properties.formtype)return"LOADSTARTFORM"},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var e=this,t=e.getButtons();t&&0!=t.length&&t.on("click",function(t){t.preventDefault(),t.stopImmediatePropagation(),e.startLoading();var i=$(this),r=i.attr("ordinal"),a=e.buttons[r];e.lastActionButton=a,i.prop("disabled",!0),i.hasOwnProperty("disabled")&&i.button("disable"),e.propagateExternalEvents(t),setTimeout(function(){$.when(e.processButton(a)).always(function(){e.processDefer=void 0,e.endLoading(),$.contains(document.documentElement,i.get(0))&&(i.prop("disabled",!1),i.hasOwnProperty("enable")&&i.button("enable"))})},100)})},preProcessButton:function(e){return!0},postProcessButton:function(e,t){return!0},setLoaderDeferred:function(){this.loaderDeferred=$.Deferred().resolve()},deleteLoaderDeferred:function(){var e=this;e.isLoaderDeferredSet()&&$.when(e.loaderDeferred.promise()).done(function(){delete e.loaderDeferred})},useOrSetLoaderDeferred:function(){this.isLoaderDeferredSet()||this.setLoaderDeferred()},getLoaderPromise:function(){return this.isLoaderDeferredSet()?this.loaderDeferred.promise():void 0},isLoaderDeferredSet:function(){return!!this.loaderDeferred},appendWaitForLoader:function(e){var t=e.promise,i=e.create||!1;if(!this.isLoaderDeferredSet()){if(!i)return;this.setLoaderDeferred()}this.loaderDeferred=this.loaderDeferred.then(function(){return t})},processButton:function(e){var t=this,i=$.Deferred(),r=t.properties;e.routing||bizagi.chrono.initAndStart("submitForm"),bizagi.chrono.init("waiting"),t.validationController.clearValidationMessages();var a=t.getFormContainer(),n=a.getRenderByType("tabItem"),o=n.length;a.innerTabsLoading=!0,t.useOrSetLoaderDeferred();for(var s=0;s<o;s++){var l=n[s];l.loadingDeferred&&l.parent.container&&l.loadingDeferred.resolve()}return delete a.innerTabsLoading,$.when(t.ready(),t.getLoaderPromise()).done(function(){t.deleteLoaderDeferred(),!bizagi.util.parseBoolean(e.validate)||t.validationController.performValidations()?("save"!==e.action&&"next"!=e.action&&"back"!=e.action&&"createnewcase"!=e.action&&"nextWithoutValidations"!=e.action||$(document).data("auto-save",""),bizagi.util.parseBoolean(t.properties.needsUserConfirmation)&&bizagi.util.parseBoolean(e.routing)?(t.endLoading(),$.when(bizagi.showConfirmationBox(r.userConfirmationMessage,null,!1)).done(function(){t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done(function(){i.resolve()}))}).fail(function(){i.reject()})):t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done(function(){$(document).trigger("FORMACTION",e),i.resolve()}).fail(function(){i.reject(arguments)}))):(t.endLoading(),e.submitData?$.when(t.submitData()).done(function(){i.reject()}):i.reject(),t.validationController.expandNotificationBox());var a=t.getCustomHandler("afterFormButtonClick");a&&a(e)}),i.promise()},validateForm:function(){return this.validationController.clearValidationMessages(),this.validationController.performValidations()},saveForm:function(){var e=this,t=bizagi.util.isOfflineForm({context:e}),i=e.collectRenderValuesForSubmit(),r=null;return i.deferreds&&(r=$.when.apply($,i.deferreds),delete i.deferreds),$.when(r).pipe(function(){return e.startLoading(),$.when(e.dataService.submitData({action:"SAVE",data:i,idCase:e.params.idCase,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,isOfflineForm:t||!1})).always(function(){e.endLoading()})})},submitForm:function(e){var t=this,i=$.Deferred(),r=bizagi.util.isOfflineForm({context:t});return $.when(t.isReadyToSave()).done(function(){r?t.internalSubmitFormOffline(e):$.when(t.internalSubmitForm(e)).done(function(){i.resolve()}).fail(function(){i.reject(arguments)})}).fail(function(){t.endLoading(),bizagi.log("The form is not saved, no changes were found"),i.reject()}),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){return this.lastActionButton},internalSubmitFormOffline:function(e){var t,i=this,r="",a=bizagi.util.isOfflineForm({context:i});if(a&&i.properties&&!i.properties.idPageCache&&(i.properties.idPageCache=""),(e.submitData||e.executeRule)&&(t=i.collectRenderValuesForSubmit()),i.transitions){var n=[];if($.each(this.activeTransitions,function(e,t){t&&n.push(e)}),0==bizagi.util.countProps(n))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),""}$.when(i.dataService.submitData({action:e.action,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:n||"",idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,isOfflineForm:a||!1})).done(function(t){i.postProcessButton(t,e)&&(e.routing?(i.triggerHandler("routing",{offlineAction:e.action,idCase:i.params.idCase,idWorkitem:i.params.idWorkitem}),$(document).trigger("tryPushData.offline")):(r=bizagi.util.isValidResource("workportal-mobile-offline-form-successful")?bizagi.localization.getResource("workportal-mobile-offline-form-successful"):"Saved",bizagi.util.showNotification({text:r,type:"success"})))}).fail(function(e){r=bizagi.util.isValidResource("workportal-mobile-offline-successful-fail")?bizagi.localization.getResource("workportal-mobile-offline-successful-fail"):"Not saved",bizagi.util.showNotification({text:r,type:"error"})})},internalSubmitForm:function(e){var t,i=this,r=$.Deferred();(e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done(function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")});var a=null,n=null,o=null,s=null,l=null;if(e.executeRule&&((a=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",s=i.PrepareCheckpointAction(e.id),t={},(n=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",l=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(i.transitions){var d=[];if($.each(this.activeTransitions,function(e,t){t&&d.push(e)}),0==bizagi.util.countProps(d))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),r.reject(),r.promise()}(o=i.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:d||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}var c=[];n&&(c.push(a),c.push(s),c.push(n),c.push(l)),o&&c.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var u=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done(function(e){u.resolve(e)}).fail(function(){u.reject(),console.log("Error: It was not possible resolve async actions on form ")}):u.resolve(),$.when(u).done(function(){$.when(i.dataService.multiaction().execute({actions:c})).done(function(t){var a;bizagi.chrono.stop("submitForm-ajax"),i.endLoading();var n="";if($.each(t,function(e,t){var r=i.validationToDisplayMessages(a,t.result.type,t.result.messages,n);a=r.bHasValidations,n=r.alertMessage}),a)""!==n&&bizagi.modalError.show(n,"workportal-general-word-information",!1),e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&(bizagi.jqxhrList.abortAll("rendering_"+i.dataService.guid),i.triggerHandler("routing",{idCase:i.params.idCase})),e.createnewcase&&t.length>0&&(bizagi.jqxhrList.abortAll("rendering_"+i.dataService.guid),i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber}))}r.resolve()}).fail(function(t,t,a){e.executeRule&&i.sendRollbackAction(e.id),a&&a.error&&("WaitForCompletionPlanException"===a.error.errorType||"InvalidPlanStateException"===a.error.errorType||"CustomMessageException"===a.error.errorType)?(i.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(a.error.message),null,!1)).then(function(){return $.when(i.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))}).done(function(){r.resolve()}).fail(function(){r.reject()})):(i.failHandler(a),r.reject(a))})}),r.promise()},validationToDisplayMessages:function(e,t,i,r){return"validationMessages"==t&&(this.addValidationMessage(i),e=!0),"desktop"==bizagi.detectDevice()&&"alertMessages"==t&&(r=""===r?i:r+"\n\n"+i,e=!0),{bHasValidations:e,alertMessage:r}},addValidationMessage:function(e,t,i,r,a,n){var o=this;o.validationController||(o.validationController=new bizagi.command.controllers.validation(o)),"string"==typeof e?o.validationController.showValidationMessage(e,t,i,r,n):$.each(e,function(e,a){o.validationController.showValidationMessage(a,t,i,r,n)}),o.validationController.expandNotificationBox(a)},clearValidationMessages:function(e){this.validationController&&this.validationController.clearValidationMessages(e)},addErrorMessage:function(e){this.validationController.showErrorMessage(e),this.validationController.expandNotificationBox()},refreshForm:function(e){var t=this,i=t.properties,r=$.Deferred();(e=e||t.getFocus())&&!e.id&&(e={id:e});var a={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""};return t.startLoading(),$.when(t.triggerHandler("refresh",a)).done(function(){t.endLoading(),r.resolve()}).fail(function(){t.endLoading(),r.reject()}),r.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,function(e){return{tab:e.properties.id,selected:e.activeTab}}),i={},r=0,a=t.length;r<a;r++)i[t[r].tab]=t[r].selected;return i},getButtons:function(){},addSubmitAction:function(e,t){this.actionController.processInternalSubmitAction(e,t)},startLoading:function(){var e=this,t=e.renderFactory.getTemplate("form-waiting");if(!e.waitingOverlay||!e.waitingMessage)if(bizagi.util.isTabletDevice())e.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),e.waitingMessage=$.tmpl(t).appendTo("body",$(document));else{var i="sharepoint"==e.params.context&&"undefined"==typeof Windows,r=e.params.canvas;i&&(r=bizagi.util.scrollTop(r)).context||(r=$("body",$(document)));var a=this.getSize(),n=this.getOffset();a.height==$(window).height()&&(n.top=0),e.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(r),e.waitingMessage=$.tmpl(t).appendTo(r),e.waitingOverlay.css({height:"100%",width:"100%","min-height":a.height,"min-width":a.width}),e.waitingMessage.css({top:n.top+Math.ceil((a.height-e.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((a.width-e.waitingMessage.outerWidth())/2)+"px"}),r.css("position","relative")}},endLoading:function(){var e=this;if(e.waitingOverlay&&e.waitingMessage){e.waitingOverlay.remove(),e.waitingMessage.remove(),e.waitingOverlay=null,e.waitingMessage=null;var t=e.params.canvas;null!=t&&t.css("position","")}},getFocusedElement:function(){return this.focus},setFocusedElement:function(e){this.focus=e},triggerGlobalHandler:function(e,t){return this.triggerHandler("globalHandler",{eventType:e,data:t})},failHandler:function(e){try{e=JSON.parse(e)}catch(e){}if(e&e.length&&e.length>1&&(e=e[0]),e.error&&(e=e.error),e.error&&(e=e.error),"object"==typeof e&&e.message)e="WaitForCompletionPlanException"===e.errorType||"InvalidPlanStateException"===e.errorType||"CustomMessageException"===e.errorType?bizagi.localization.getResource(e.message):e.message;else if("string"==typeof e)try{var t=JSON.parse(e);"WaitForCompletionPlanException"!==t.errorType&&"InvalidPlanStateException"!==t.errorType&&"CustomMessageException"!==e.errorType||(t.message=bizagi.localization.getResource(t.message)),e=t.message}catch(e){}this.addErrorMessage(e),this.endLoading()},resize:function(e){this.setSize(e)},setSize:function(e){this.size=e},getSize:function(){if(this.size)return this.size;var e=this.params.canvas?this.params.canvas:this.getFormContainer().container;return{width:e.width(),height:e.height()}},getOffset:function(){return this.getFormContainer().container.offset()},submitData:function(e){var t=this,i=t.collectRenderValuesForSubmit();if(bizagi.util.isOfflineForm({context:t})&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),$.each(i,function(e,i){var r=t.getRenders(e);$.each(r,function(e,t){t.updateOriginalValue()})}),!$.isEmptyObject(i))return $.when(t.dataService.multiaction().submitData({action:"SUBMITDATA",data:i,idPageCache:t.properties.idPageCache,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||""})).fail(function(e){e=t.processFailMessage(e)})},executeRule:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:e.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages({clearOnlyServer:!0}),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage.apply(t,[e.messages,void 0,void 0,void 0,!1,"serverMessage"]),"desktop"==bizagi.detectDevice()&&"alertMessages"==e.type&&bizagi.modalError.show(e.messages.join("\n\n"),"workportal-general-word-information",!1)}).fail(function(e){e=t.processFailMessage(e)})},executeInterface:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:e.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)}).fail(function(e){e=t.processFailMessage(e)})},executeSAPConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:e.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)}).fail(function(e){e=t.processFailMessage(e)})},executeConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:e.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)}).fail(function(e){e=t.processFailMessage(e)})},refreshActions:function(e){this.actionController.refreshActions(e)},removeActions:function(){this.actionController.unbindActions()},collectRenderValuesForSubmit:function(e){var t=this;return e=e||{},t.collectRenderValues(e),$.each(e,function(e,i){var r=t.getRenders(e);$.each(r,function(e,t){t.updateOriginalValue()})}),e},internalSubmitOnChange:function(e){var t=this,i=(e=e||{}).properties,r=new $.Deferred,a=e.data||{},n=void 0===e.bRefreshForm||e.bRefreshForm;(e.notCollect?e.notCollect:void 0)&&!$.isEmptyObject(a)||t.collectRenderValuesForSubmit(a),t.startLoading();var o=null;return a.deferreds&&(o=$.when.apply($,a.deferreds),delete a.deferreds),$.when(o).then(function(){t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done(function(e){if(t.cancelPreviousRequest(),t.endLoading(),e&&"validationMessages"==e.type)"function"==typeof t.clearValidationMessages&&t.clearValidationMessages(),t.addValidationMessage(e.messages),r.resolve();else if(n){var a={id:i.id,xpath:i.xpath};void 0!==i.idCase&&$.extend(a,{idCaseObject:bizagi.cache.idCaseObject}),e.IdScope&&(t.properties.idStartScope=e.IdScope),$.when(t.refreshForm(a)).done(function(){r.resolve()}).fail(function(){r.resolve()})}else r.resolve()}).fail(function(e){t.endLoading();var i=JSON.parse("object"==typeof e&&e.responseText?e.responseText:{})||{},a=i.message||e;t.validationController.clearValidationMessages(),"alert"==i.type?t.validationController.showAlertMessage(a):t.validationController.showErrorMessage(a),r.resolve()})}),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var e,t=bizagi.multiactionConnection.length,i=0;i<t;i++)(e=bizagi.multiactionConnection.pop())&&e.abort&&(bizagi.showErrorAlertDialog=!1,e.abort())},PrepareCheckpointAction:function(e){return checkpointAction=this.dataService.sendCheckpoint({url:this.properties.checkpointUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0}),checkpointAction.tag="checkpoint",checkpointAction},prepareCommitAction:function(e){var t=this.dataService.commitLinkForm({url:this.properties.commitUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="commit",t},sendRollbackAction:function(e){this.dataService.rollbackLinkForm({url:this.properties.rollbackUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache})},dispose:function(){var e=this;e.endLoading(),setTimeout(function(){e.params&&delete e.params.canvas,delete e.params,delete e.control,e.validationController&&(e.unbind("rendervalidate"),delete e.validationController),e.actionController&&(e.actionController.unbindActions(),delete e.actionController)},bizagi.override.disposeTime||50),e._super()},getButton:function(e){return $(".ui-bizagi-button[data-id='"+e+"']",this.container)},getFloatingButton:function(e){return $("li[data-id='"+e+"']",this.container)},propagateExternalEvents:function(e){$(".bz-overflow-menu")&&$(document).trigger("click.overflow"),$(".jquery-image-zoom")&&"block"==$(".jquery-image-zoom").css("display")&&$("div.jquery-image-zoom a").click()}}),bizagi.rendering.form.extend("bizagi.rendering.formTemplate",{init:function(e){this._super(e),e.paramsRender&&e.paramsRender.contextEvent&&(self.contextEvent=e.paramsRender.contextEvent)},processTemplate:function(e,t){var i=e.replace(/\{\{(((repeater)\s*(\{["':,-\[\]\w\s]*\}))|([\/repeater]+:item)|(\/repeater)|(repeater)|(separator))\}\}/g,"");return i=(i=i.replace(/\{\{([\w:]*)\s*(\{["':,-\[\]\w\s]*\})\}\}/g,function(e,i,r,a,n){var o=JSON.parse(r);return t[o.id]||""})).replace(/{{([\w:]*)\s*}}/g,function(){return""})},renderContainer:function(){var e=this,t=e.getRenderByType("layout"),i=t.length>0?t[0]:{},r="function"==typeof i.getTemplate?i.getTemplate():"",a="function"==typeof i.getCss?i.getCss():"",n=e.getMode(),o=e.properties.layoutguid||Math.guid(),s={};return i.children&&$.each(i.children,function(t,i){if("execution"!=n||"layoutPlaceholder"!=i.properties.type){var r=i.getElementType();r==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(s[i.properties.id]=i.renderElement()),r==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(s[i.properties.id]=i.renderContainerHtml()),e.childrenHash[i.properties.uniqueId]=i}}),bizagi.util.loadStyle(a,o),e.processTemplate(r,s)},getContextEvent:function(){return self.contextEvent}}),bizagi.rendering.container.extend("bizagi.rendering.layout",{},{getTemplate:function(){var e=this.getMode(),t=this.properties.html||"";return"design"==e&&t&&(t="<div class='bz-design-template'>"+t+"</div>"),bizagi.util.stripslashes(t)},getCss:function(){var e=this.properties.css||"";return"design"==this.getMode()&&(e=e&&e.desktop),bizagi.util.stripslashes(e)},postRenderContainer:function(e){var t=this,i=(t.properties,t.getMode());t.renderingDeferred&&t.renderingDeferred.resolve(),t.container=e,t.executeChildrenPostRender(e),"execution"==i&&t.configureHandlers(),"design"==i&&t.configureDesignView(),"layout"==i&&(t.configureDesignView(),t.configureLayoutView())}}),bizagi.rendering.container.extend("bizagi.rendering.accordion",{},{initializeData:function(e){this._super(e),$.each(this.children,function(e,t){t.properties.ordinal=e})},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordion"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),bizagi.rendering.container.extend("bizagi.rendering.accordionItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordionItem"),i=$.fasttmpl(t,{id:e.id,ordinal:e.ordinal,displayName:e.displayName,orientation:e.orientation,uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e}}),bizagi.rendering.container.extend("bizagi.rendering.group",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||"cssClassContainer",t.collapse=!(void 0===t.collapse||!bizagi.util.parseBoolean(t.collapse))},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("group");e.expandedIcon=e.getExpandedIcon(),e.collapsedIcon=e.getCollapsedIcon();var r=$.fasttmpl(i,{expandedClassIcon:e.expandedIcon,displayName:t.displayName,editable:t.editable,orientation:t.orientation,uniqueId:t.uniqueId,collapse:t.collapse,isDesign:"execution"!==e.getMode(),messageValidation:t.messageValidation,cssclass:t.cssclass,guid:t.guid});return r=e.replaceChildrenHtml(r,e.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(e,t){}}),bizagi.rendering.container.extend("bizagi.rendering.horizontal",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("horizontal"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),bizagi.rendering.container.extend("bizagi.rendering.panel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("panel"),i=$.fasttmpl(t,{displayName:e.displayName,loading:e.loading,message:e.message,orientation:e.orientation,uniqueId:e.uniqueId,cssClass:e.cssclass});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.properties;t.height&&e.height(t.height),this._super(e)}}),bizagi.rendering.form.extend("bizagi.rendering.searchForm",{},{renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("searchForm");"entity"!=t.contexttype&&e.parent&&(t.contexttype="function"==typeof e.parent.getContextType?e.parent.getContextType():"");var r=$.fasttmpl(i,{displayName:t.displayName,uniqueId:t.uniqueId});return r=(r=e.replaceChildrenHtml(r,e.renderChildrenHtml())).replace("{{result}}",e.renderResult())},performSearch:function(e){this.properties.searchParams=e,this.submitSearch()},submitSearch:function(){this.refreshResults()},ready:function(){return this.parent.ready()},getRemoteData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.collectSearchValues();return bizagi.util.isMapEmpty(a)?(bizagi.showMessageBox(this.getResource("render-search-advanced-no-filters"),this.getResource("render-form-dialog-box-search"),"error"),null):(e.rows=i.searchParams&&i.searchParams.maxRecords&&i.searchParams.maxRecords>0?i.searchParams.maxRecords:e.rows,i.searchParams&&void 0!==i.searchParams.maxRows&&(e.rows=i.searchParams.maxRows||e.rows),t.dataService.submitSearch($.extend(e,{url:i.dataUrl,idRender:i.idRender,idPageCache:i.idPageCache,idSearchForm:i.id,allowFullSearch:i.searchParams.allowFullSearch?i.searchParams.allowFullSearch:null,maxRecords:i.searchParams.maxRecords>0?i.searchParams.maxRecords:null,criteria:a})).done(function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages||0,e.records>1e4?(i.deviceMaxRecordsExceeded=!0,e.deviceMaxRecordsExceeded=!0):delete i.deviceMaxRecordsExceeded,r.resolve(e),t.onSearchFinished()}).fail(function(e){if(bizagi.showErrorAlertDialog=!1,e.responseText)try{var t=JSON.parse(e.responseText).message;bizagi.showMessageBox(t,"","error")}catch(e){}r.reject()}),r.promise())},collectSearchValues:function(){var e={};this.collectRenderValues(e);var t=[];for(key in e){var i=key,r=e[key],a=this.getCriteriaOperation(this.getRender(i)),n={};bizagi.util.isEmpty(r)||(n.xpath=i,n.value=r,n.operation=a,t.push(n))}return t},getCriteriaOperation:function(e){var t=this.properties,i="EQUALS";return"15"==e.properties.dataType&&"approx"===e.properties.typeSearch&&(i=t.allowFullSearch?"FULLLIKE":"LIKE"),i},renderResult:function(){},refreshResults:function(){},parseAdditionalProperties:function(e){return 1==e||2==e||3==e||4==e||6==e||7==e||10==e||11==e?{type:"columnNumber"}:29==e?{type:"columnNumberScientificNotation"}:8==e?{type:"columnMoney"}:12==e||13==e?{type:"columnDate"}:5==e?{type:"columnBoolean"}:{type:"columnText"}},onSearchFinished:function(){}}),bizagi.rendering.container.extend("bizagi.rendering.tab",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||""},renderContainer:function(){for(var e=this,t=this.properties,i=$.map(e.children,function(e,t){return e.properties.counter=t,e.properties.tooltip=e.properties.tooltip||e.properties.displayName||"",e.properties}),r=e.renderFactory.getTemplate("tab"),a=e.getMode(),n=$.fasttmpl(r,{id:t.id,tabs:i,mode:a,editable:t.editable,tabOrientation:t.orientation,uniqueId:t.uniqueId,cssclass:t.cssclass}),o=e.activeTab=e.getActiveTab(),s=0,l=e.children.length;s<l;s++)e.children[s].properties.loadOnDemand=s!=o;return n=e.replaceChildrenHtml(n,e.renderChildrenHtml())},getActiveTab:function(){var e=this,t=e.properties,i=this.getFormContainer().getParams();"execution"===e.getMode()&&!i.isRefresh&&t.activeTab&&e.getFormContainer().setFocusedElement(t.activeTab);var r=i&&i.selectedTabs?i.selectedTabs:{};if(r[e.properties.id]>=0)return r[e.properties.id];for(var a=0,n=e.children.length;a<n;a++)if(e.children[a].containsFocusedElement())return a;return 0}}),bizagi.rendering.container.extend("bizagi.rendering.tabItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("tabItem"),i=$.fasttmpl(t,{id:e.id,uniqueId:e.uniqueId,counter:e.counter});return i=this.renderTabContent(i)},renderTabContent:function(e){return this.replaceChildrenHtml(e,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e},containsFocusedElement:function(){var e=this,t=e.getFormContainer().getFocusedElement();if(t){if(t.xpath){var i=e.getFormContainer().getRenders(t.xpath);$.each(i,function(e,i){i.properties.id==t.id&&i.properties.editable&&(r=i)})}else var r=e.getFormContainer().getContainer(t)||e.getFormContainer().getRenderById(t);if(r)for(;r.parent;){if(r.properties.id==e.properties.id||r.parent.properties.id==e.properties.id)return!0;r=r.parent}}return!1}}),bizagi.rendering.panel.extend("bizagi.rendering.nestedForm",{},{}),bizagi.rendering.element.extend("bizagi.rendering.render",{postRenderTimeout:0,maxRendersPerScreen:50,rendersExecuted:0,renderOptimization:!1,TYPE_QUERY_FORM:"queryForm",startOptimization:function(){bizagi.rendering.render.postRenderTimeout=500,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1},stopOptimization:function(){bizagi.rendering.render.postRenderTimeout=0,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1}},{initializeData:function(e){var t=this;t._super(e);var i=t.getFormContainer(),r=t.properties;r.included=void 0!==r.included&&bizagi.util.parseBoolean(r.included),r.uniqueId=Math.ceil(1e6*Math.random()),r.displayName=r.displayName||"",r.editable=void 0===r.editable||bizagi.util.parseBoolean(r.editable),r.visible=void 0===r.visible||bizagi.util.parseBoolean(r.visible),r.includedInResult=void 0!==r.includedInResult&&bizagi.util.parseBoolean(r.includedInResult),"hidden"==r.type&&(r.visible=!1),r.required=void 0!==r.required&&bizagi.util.parseBoolean(r.required),r.submitOnChange=void 0!==r.submitOnChange&&bizagi.util.parseBoolean(r.submitOnChange),r.maxLength=r.maxLength||0,r.helpText=bizagi.util.trim(r.helpText)||"",r.textFormat=r.textFormat||{},r.valueFormat=r.valueFormat||{},r.isHidden=void 0!==r.isHidden&&bizagi.util.parseBoolean(r.isHidden),r.visible=!r.isHidden&&r.visible,r.color&&(r.textFormat.color=r.color),r.backgroundColor&&(r.textFormat.backgroundColor=r.backgroundColor),r.required=!!r.editable&&r.required,r.orientation=r.orientation||"auto",r.contexttype=i.params&&i.params.data&&i.params.data.contextType?i.params.data.contextType:"",t.originalProperties={textFormat:{color:r.textFormat.color,backgroundColor:r.textFormat.backgroundColor},valueFormat:{color:r.textFormat.color,backgroundColor:r.textFormat.backgroundColor},visible:r.visible,editable:r.editable,required:r.required,labelAlign:r.labelAlign},t.value=void 0!==r.value?r.value:null,t.properties.originalValue=t.value,t.properties.previousValue=t.value,t.calculateInitialLayoutProperties()},calculateInitialLayoutProperties:function(){var e=this,t=e.properties;t.displayType=t.displayType||"normal",t.labelAlign=t.labelAlign||e.getDefaultLabelAlign(t.displayType),t.valueAlign=t.valueAlign||e.getDefaultValueAlign(t.displayType),"rtl"==t.orientation&&(t.labelAlign=e.getRTLAlign(t.labelAlign),t.valueAlign=e.getRTLAlign(t.valueAlign));var i=e.calculateRenderWidth(t.labelWidth,t.valueWidth,t.displayType);t.labelWidth=i.label,t.valueWidth=i.control,"percentage"==t.layoutType&&(t.valueWidth=i.control),0==t.labelWidth&&(t.displayType="value",t.valueWidth=i.control),0==t.valueWidth&&(t.displayType="label"),"userfield"===t.type&&("both"===t.displayType?(t.valueWidth=t.valueWidth||50,t.labelWidth=t.labelWidth||50):"vertical"===t.displayType?(t.valueWidth=100,t.labelWidth=100):(t.valueWidth=100,t.labelWidth=0))},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_RENDER},render:function(e){return this.renderElement(e)},renderElement:function(e){var t=this,i=t.properties,r=t.getFormContainer();t.renderingDeferred=new $.Deferred,e=e||"render";var a=t.renderFactory.getTemplate(e),n=i.displayName;"string"==typeof n&&(n=(n=(n=(n=(n=(n=n.replaceAll("&","&amp;")).replaceAll("$","&#36;")).replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"));var o=parseFloat(i.labelWidth),s=$.fasttmpl(a,{label:n,helpText:i.helpText,editable:i.editable,isExtendedText:"text"==i.type&&i.isExtended,orientation:i.orientation,uniqueId:i.uniqueId,id:i.id,xpath:i.xpath,tag:i.tag,displayType:i.displayType,displayOptionClass:t.getDisplayOptionClass(i.displayType),labelAlignClass:t.getAlignClass(i.labelAlign),valueAlignClass:t.getAlignClass(i.valueAlign),labelWidth:o,stringLabelWidth:o+("pixels"==i.layoutType?"px":"%"),valueWidth:parseFloat(i.valueWidth),stringValueWidth:parseFloat(i.valueWidth)+("pixels"==i.layoutType?"px":"%"),layoutType:i.layoutType,isDesign:"design"===t.getMode(),messageValidation:i.messageValidation,printVersion:r.params.printversion,cssClass:i.cssclass||"",includedInResult:i.includedInResult,included:i.included,type:i.type,showFullRender:"desktop"!==bizagi.util.detectDevice()&&("association"===i.type||"uploadecm"===i.type||"actionLauncher"===i.type&&bizagi.util.isTabletDevice()||"polymorphicLauncher"===i.type&&bizagi.util.isTabletDevice()||"grid"===i.type&&!bizagi.util.isTabletDevice())}),l=t.internalRenderControl();return l||(l=""),"object"==typeof l&&l.done?"resolved"===l.state()?(s=t.replaceControlHtml(s,t.resolveResult(l)),t.asyncRenderDeferred=null):(t.asyncRenderDeferred=l,s=t.replaceControlHtml(s,"")):s=t.replaceControlHtml(s,l),s},resolveResult:function(e){return bizagi.resolveResult(e)},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},internalRenderControl:function(){var e=this,t=e.properties;return e.control=null,e.renderFactory.printVersion?(t.editable=!1,e.renderControl()):t.editable?e.renderControl():e.renderReadOnly()},postRenderElement:function(e){var t=this,i=t.properties;t.element=e,i.submitOnChange&&t.configureSubmitOnChange(),isLabelFormat=!0;var r=function(e){bizagi.rendering.render.renderOptimization&&bizagi.rendering.render.rendersExecuted>bizagi.rendering.render.maxRendersPerScreen?setTimeout(function(){t.internalPostRender(e),bizagi.rendering.render.postRenderTimeout+=50},bizagi.rendering.render.postRenderTimeout):t.internalPostRender(e),bizagi.rendering.render.rendersExecuted++};t.asyncRenderDeferred?$.when(t.asyncRenderDeferred).done(function(i){var a=t.getControl();"function"==typeof t.emptyControlByAsyncRenderDeferred&&t.emptyControlByAsyncRenderDeferred(),a.append(i),r(e),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})}):r(e)},internalPostRender:function(e){var t=this,i=t.properties,r=t.getMode();t.control=t.getControl();t.renderingDeferred&&t.renderingDeferred.resolve(),i.editable?t.renderFactory.printVersion&&t.postRenderPrintVersion?t.postRenderPrintVersion():t.postRender():t.postRenderReadOnly(e),"execution"==r?t.performExecutionModeMethods():t.performDesignModeMethods(),t.processLayout(isLabelFormat,t.properties.textFormat||{}),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})},performExecutionModeMethods:function(){var e=this,t=e.properties;e.getFormType()==e.Class.TYPE_QUERY_FORM&&e.configureHandlersQueryForm(),t.editable?e.configureHandlers():e.configureHandlersReadOnly(),e.internalSetInitialValue()},performDesignModeMethods:function(){this.properties;var e=this.getControl();null!==e&&$("input, select, button, textarea",e).attr("readonly",!0),this.configureDesignView(),this.internalSetInitialValue()},replaceControlHtml:function(e,t){return t=t||"",(e=e||"").replace("{{control}}",t)},getRenderedElement:function(){return bizagi.util.isEmpty(this.element)&&bizagi.log(" render hasn't been rendered!",this,"error"),this.element},internalSetInitialValue:function(){var e=this,t=e.properties;e.internalSetInitialValueFlag=!0,t.editable,bizagi.util.isEmpty(e.value)||e.setDisplayValue(e.value),e.internalSetInitialValueFlag=!1},isValid:function(e){var t,i=this,r=i.properties,a=i.grid&&i.grid.properties&&i.grid.properties.inlineAdd;if(0==bizagi.util.parseBoolean(r.visible))return!0;if(0==bizagi.util.parseBoolean(r.editable)&&!a)return!0;if(i.setValidationMessage(""),bizagi.util.parseBoolean(r.required)){var n=i.getFormContainer(),o=i.grid?[i]:n.getRenders(r.xpath),s=!1;if($.each(o,function(e,t){if(t.hasValue()&&(t.properties.editable||a))return s=!0,!1}),!s&&!i.properties.isClone)return t=i.getResource("render-required-text").replaceAll("#label#",r.displayName),e.push({xpath:r.xpath,message:t}),!1}if("duplicate"==r.retype){if(i.cloneRender&&i.cloneRender.getValue()!=i.getValue())return t=i.getResource("render-text-retype-error"),e.push({xpath:r.xpath,message:t}),!1}else if("double"==r.retype){var l=$("input",i.element);if(l&&l.data("oldValue")){if(""==l.val())return t=i.getResource("render-text-retype-error"),e.push({xpath:r.xpath,message:t}),!1;if(l.val()!=l.data("oldValue"))return t=i.getResource("render-text-retype-error"),e.push({xpath:r.xpath,message:t}),!1}}var d=!i.grid||!i.grid.getColumn||i.grid.getColumn(i.properties.xpath).properties.editable;if("userPassword"!=r.type&&void 0!==r.maxLength&&r.maxLength>0&&bizagi.util.isNumeric(r.maxLength)&&(d||!d&&i.controlValueIsChanged())){var c=new Number(r.maxLength),u=i.getValue();if(u&&u.toString().length>c)return t=i.getResource("render-text-maxLength-error").replaceAll("#maxLength#",c),e.push({xpath:r.xpath,message:t}),!1}return!0},hasValue:function(){var e=this.getValue();return e=e&&"text"==this.properties.type&&"string"==typeof e?e.trim():e,!bizagi.util.isEmpty(e)},postRender:function(){},postRenderReadOnly:function(){},configureHandlers:function(){},configureHandlersReadOnly:function(){},configureDesignView:function(){},processLayout:function(e,t){var i=this,r=i.properties;if(null!=i.getControl()){(t=t||{}).color&&i.changeColor(t.color,e),t.background&&i.changeBackgroundColor(t.background),!t.bold&&t.bold&&e||i.changeFontBold(t.bold,e),t.italic&&i.changeFontItalic(t.italic,e),t.underline&&i.changeFontUnderline(t.underline,e),t.strikethru&&i.changeFontStrikethru(t.strikethru,e),t.size&&i.changeFontSize(t.size,e),r.required=null!=r.required&&bizagi.util.parseBoolean(r.required);var a=null==r.visible||bizagi.util.parseBoolean(r.visible);r.required&&i.changeRequired(r.required),a||i.changeVisibility(a)}},setValue:function(e,t){var i=this;t=void 0===t||t,bizagi.util.identicalObjects(e,i.value)||(i.properties.previousValue=i.properties.originalValue=i.value,i.value=i.properties.value=e,i.properties.required&&"execution"==i.getMode()&&(i.checkRequired([])?i.changeRequiredLabel(!1):i.changeRequiredLabel(!0)),t&&!i.internalSetInitialValueFlag&&(i.triggerRenderChange(),i.triggerRenderValidate()))},checkRequired:function(e){var t=this.properties;return!(bizagi.util.parseBoolean(t.required)&&!this.hasValue())||(message=this.getResource("render-required-text").replaceAll("#label#",t.displayName),e.push({xpath:t.xpath,message:message}),!1)},validateInputRetype:function(){return!this.properties.retype||!this.cloneRender||this.getValue()==this.cloneRender.getValue()},triggerRenderChange:function(e){(e=e||{}).changed=void 0===e.changed||e.changed,this.triggerHandler("renderchange",{render:this,changed:e.changed})},triggerRenderValidate:function(){this.triggerHandler("rendervalidate",{render:this})},setDisplayValue:function(e){var t=this,i=t.getControl();if(t.setValue(e,!1),0==t.properties.editable&&"check"!=t.properties.display){var r=t.getDisplayValue(e);"string"!=typeof r&&"number"!=typeof r||$(i).html("<label class='readonly-control'>"+r+"</label>")}},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},getLabel:function(){bizagi.util.mustImplement("getLabel")},getControl:function(){bizagi.util.mustImplement("getControl")},getControlFiller:function(){bizagi.util.mustImplement("getControlFiller")},renderControl:function(){},setValidationMessage:function(e){this.validationMessage=e},renderReadOnly:function(){var e=this.getValue(),t="";if(bizagi.util.isObject(e)&&void 0!==e.value)t=e.value;else if(!bizagi.util.isEmpty(e))if(bizagi.util.isString(e)){var i=e.replaceAll("&","&amp;");t=i=(i=(i=(i=i.replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>")}else t=e;return t},postRenderPrintVersion:function(){},changeDisplayOption:function(e){this.properties.displayType=e},getDisplayOptionClass:function(e){return""},changeLabelAlign:function(e){this.properties.labelAlign=e},changeValueAlign:function(e){this.properties.valueAlign=e},getAlignClass:function(e){return""},customizeRenderWidth:function(){},changeColor:function(e,t){var i=this,r=i.getControl(),a=i.getLabel();t=void 0===t&&null==t||t;r&&a&&("none"!=e?"value"!=i.properties.displayType&&t?(i.element.each(function(){this.style.setProperty("color",e,"important")}),"grid"==i.properties.type&&i.getControl().find(".bz-rn-grid-header-title").each(function(){this.style.setProperty("color",e,"important")}),i.getLabel().find("label").css("color",e,"!important"),!1===i.properties.editable&&(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getElementsToStylize($("label",i.getControl()).css("color",e,"!important")))):(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each(function(t,r){i.getElementsToStylize(r).css("color",e,"!important")})):(i.element.css("color",""),i.getLabel().find("label").css("color",""),i.getControl().css("color",""),i.getControl().find("input, textarea").each(function(e,t){var r=$(t).data("originalColor")||"";i.getElementsToStylize(t).css("color",r)})))},changeBackgroundColor:function(e){var t=this,i=t.getControl(),r=t.getLabel();if(i&&r)if("none"!=e){t.element.each(function(){this.style.setProperty("background-color",e,"important")}),void 0!==r.find("label").style?t.getLabel().find("label").style("background-color",e,"important"):t.getLabel().find("label").css("background-color",e,"!important");var a=t.getLabel().attr("style");a+="; background-color:"+e+"!important",t.getLabel().attr("style",a)}else t.element.css("background-color",""),t.getLabel().find("label").css("background-color",""),t.getControl().css("background-color",""),t.getControl().find("input, textarea").each(function(e,t){var i=$(t).data("originalColor")||"";$(t).css("background-color",i)})},getFormattingLabel:function(){return this.getLabel().find("label")},changeFontBold:function(e,t){var i=this;t=void 0===t&&null==t||t;0!=bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("font-weight","bold","!important"),i.getControl().each(function(e,t){$(t).css("font-weight","bold","!important")})):t&&i.getFormattingLabel().css("font-weight","normal","!important"),t||(1==bizagi.util.parseBoolean(e)?i.getControl().find("*").each(function(e,t){$(t).css("font-weight","bold","!important")}):(i.getControl().find("*").each(function(e,t){$(t).css("font-weight","normal","!important")}),i.getControl().css("font-weight","normal","!important")))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0;if($.forceCollectData)return!0;if("grid"==this.properties.type&&"pending"==this.ready().state())return!1;if("combo"==e.type||"queryCombo"==e.type||"list"==e.type||"queryList"==e.type||"radio"==e.type||"queryRadio"==e.type||"cascadingCombo"==e.type)t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&t.id?t.id:t,i=i&&i.id?i.id:i,a=void 0!==(r=r&&r.id?r.id:r)&&null!=r?i!=t||i==r:i!=t;else if("boolean"==e.type||"queryBoolean"==e.type||"queryCheck"==e.type)a=bizagi.util.parseBoolean(i)!=bizagi.util.parseBoolean(t);else if("searchNumber"==e.type)a=!!t;else if("number"==e.type)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("text"==e.type)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("date"==e.type)a=!(!i&&!t)&&i!=t;else if("actionLauncher"==e.type){a=!1;var n=[];try{n="string"==typeof i?JSON.parse(i):i}catch(e){}var o=function(e,t){e=e||"";for(var i=!1,r=0,a=(t=t||[]).length;r<a;r++)if(t[r].guidAction==e){i=!0;break}return i};if(n.length==t.length)for(var s=0,l=n.length;s<l;s++)o(n[s].guidAction,t)||(a=!0);else a=!0}else if("polymorphicLauncher"==e.type||"entityTemplate"==e.type)a=i.length!=t.length||JSON.encode(t)!=JSON.encode(i);else if("image"==e.type)a=!(null==i&&t.indexOf(!0)<0);else if("searchList"==e.type){var d={};try{d=JSON.parse(t)}catch(e){console.log("Error when detect change value on searchList control")}a=JSON.encode(i)!=JSON.encode(d.value)}else a=i!==t;return a},changeFontItalic:function(e,t){var i=this;t=void 0===t&&null==t||t;"value"!=i.properties.displayType&&t?1==bizagi.util.parseBoolean(e)?i.getFormattingLabel().css("font-style","italic","!important"):i.getFormattingLabel().css("font-style","normal","!important"):1==bizagi.util.parseBoolean(e)?(t&&i.getFormattingLabel().css("font-style","italic","!important"),i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("font-style","italic","!important")}):i.getElementsToStylize(i.getControl()).css("font-style","italic","!important")):(t&&i.getFormattingLabel().css("font-style","normal","!important"),i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("font-style","normal","!important")}):i.getElementsToStylize(i.getControl()).css("font-style","normal","!important"))},changeFontUnderline:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(a.strikethru)?"line-through ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("text-decoration",n+"underline","!important"),i.getControl().each(function(e,t){i.getElementsToStylize(t).css("text-decoration",n+"underline")})):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"underline","!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"underline","!important"):i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")}))},changeFontStrikethru:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(a.underline)?"underline ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?i.getFormattingLabel().css("text-decoration",n+"line-through","!important"):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"line-through","!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"line-through","!important"):i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",o,"!important"))},changeFontSize:function(e,t){var i=this;t=void 0===t&&null==t||t;if("0"!=e){var r=i.getFormattingLabel(),a=100+10*Number(e)+"%";if(t&&r.css("font-size",a,"!important"),"value"==i.properties.displayType||!t){var n=i.getControl();"object"==typeof n.children()&&n.children().length>0?i.getElementsToStylize(n.children()).css("font-size",a,"!important"):(i.getElementsToStylize(n).css("font-size",a,"!important"),-1!=i.properties.type.indexOf("ombo")&&e>4&&n.children(0).height(2*e+20)),i.getElementsToStylize(n.find(".ui-bizagi-render-date")).css("line-height","normal")}}},getElementsToStylize:function(e){return $(e)},changeVisibility:function(e){var t=this,i=t.properties;1==bizagi.util.parseBoolean(e)?"hidden"!==i.type&&(t.element.show(),t.element.css("display",""),i.required&&(t.hasValue()||t.changeRequiredLabel(!0))):t.element&&t.element.hide(),i.visible=e},changeEditability:function(e){var t=this,i=t.properties,r=t.getControl();i.editable=bizagi.util.parseBoolean(e),r.empty(),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done(function(e){"function"==typeof t.emptyControlByChangeEditability&&t.emptyControlByChangeEditability(),t.asyncRenderDeferred||r.append(e),t.postRenderElement(t.element)})},changeEditabilityCellControl:function(e,t,i){var r=this,a=r.properties,n=r.getControl(),o=r.grid.getColumn(i),s=o.getDecorated(t);a.editable=bizagi.util.parseBoolean(e),n.empty(),"function"==typeof r.internalRenderControl&&$.when(r.internalRenderControl()).done(function(e){n.append(e),r.postRenderElement(r.element),a.editable&&(o.bind("rendered",function(){o.readyDeferred.resolve()}),s.unbind("renderchange"),s.bind("renderchange",function(e,i){o.changed=!0,r.grid.onCellChange(o,null,t,i)}))})},changeRequired:function(e){var t=this,i=t.properties,r=i.displayName||"",a=$("label",t.getLabel()),n=t.getControl();i.required=e,"execution"==t.getMode()&&t.checkRequired([])?t.changeRequiredLabel(!1):1==bizagi.util.parseBoolean(e)&&i.editable?"rtl"==t.properties.orientation?n.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(n.addClass("control-required"),n.prepend('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==t.properties.orientation?$(".ui-bizagi-render-control-required-rtl",n).remove():(n.removeClass("control-required"),$(".ui-bizagi-render-control-required",n).remove()),a.html(r),t.triggerRenderValidate()},changeRequiredLabel:function(e){var t=this,i=t.properties,r=i.displayName||"",a=$("label",t.getLabel()),n=t.getControl();1==bizagi.util.parseBoolean(e)&&i.editable?"rtl"==t.properties.orientation?n.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(n.addClass("control-required"),n.append('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==t.properties.orientation?$(".ui-bizagi-render-control-required-rtl",n).remove():(n.removeClass("control-required"),$(".ui-bizagi-render-control-required",n).remove()),a.html(r),t.triggerRenderValidate()},refreshControl:function(e){var t=this,i=t.properties,r=(t.value,t.getFormContainer().properties.id||"");return e=e||{},t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,idForm:r})).pipe(function(e){t.control=t.controlFiller=t.label=null;var i=t.element;return t.initializeData(e.render),$.when(t.render()).pipe(function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i}).pipe(function(e){i.replaceWith(e),t.grid||t.triggerRenderChange({changed:!1}),t.afterToRefresh()})}).fail(function(e){e=t.processFailMessage(e)}).always(function(){t.endLoading()})},refreshDesignControl:function(e){var t=this,i=t.properties;t.beforeToRefresh(),t.control=t.controlFiller=t.label=null,$.extend(e.render.properties,{xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext||"form",idPageCache:i.idPageCache});var r=t.element;return t.initializeData(e.render),$.when(t.render()).pipe(function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i}).pipe(function(e){r.replaceWith(e),t.triggerRenderChange(),t.beforeToRefresh()})},cleanData:function(){this.setValue(""),this.clearDisplayValue()},clearDisplayValue:function(){var e=this.getControl(),t=e.find("input");t.length>0?t.val(this.getValue()):!1===this.properties.editable&&$(e).html("<label class='readonly-control'></label>")},updateOriginalValue:function(){this.properties.originalValue=this.value},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""!==r&&null!==r||(e[t.xpath]=""):e[t.xpath]=r)),this.validateInputRetype()||(e[t.xpath]="")},hasChanged:function(e){return!!this.controlValueIsChanged()&&(e.push(!0),!0)},configureHandlersQueryForm:function(){var e=this;e.element.find(".ui-bizagi-render-control-included").change(function(){e.properties.included=$(this).is(":checked")})},collectDataQueryForm:function(e){var t=this,i=t.properties,r=i.xpath,a=t.getValue(),n=null;if(!bizagi.util.isEmpty(r)){if(null!=a)n=void 0!==a.id?bizagi.util.isEmpty(a.id)?null:[a]:""!==a?a:null;if((null!==n||i.included)&&("check"!=i.display||0!=i.value)){var o=t.properties.typeSearch||t.properties.rangeQuery||"NONE";o=o.toUpperCase();var s={value:n,included:t.properties.included,xpath:i.xpath,searchType:o,orderType:"NONE"};void 0!==i.displayXpath&&""!==i.displayXpath&&(s.displayXpath=i.displayXpath),e.push(s)}}},canBeSent:function(){var e,t=this.properties,i=bizagi.util.parseBoolean(t.displayOnly)||!1,r=t.editable;if(!i&&r)return!0;if(t.isClone)return!1;if(t.xpath&&1==this.getFormContainer().getRenders(t.xpath).length){if(e=!!$.forceCollectData&&$.forceCollectData.toString(),$.forceCollectData=e?void 0:$.forceCollectData,this.controlValueIsChanged())return $.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData,!0;$.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData}return!1},canBeSentQueryForm:function(){return!this.properties.isClone},focus:function(e){var t=this;if(t.properties.visible){this._super();var i=$("#ui-bizagi-wp-app-render-form-content"),r=function(){var e=t.getControl(),r="grid"!=t.properties.type?$("input, select, option, textarea",e):$("input, select, option, textarea",e).first();r.length>0&&$.each(r,function(e){var t=r[e];if("hidden"!=$(t).attr("type")&&"none"!=$(t).css("display")&&"hidden"!=$(t).css("visibility"))try{bizagi.util.isIE()||bizagi.util.autoScrollBottom(i),t.focus()}catch(e){}})};$.when(t.ready()).done(function(){e>0?setTimeout(r,e):r()})}},getDefaultLabelAlign:function(e){return"normal"==(e=e||"normal")||"both"==e?"left":"vertical"==e?"left":"reversed"==e?"left":"verticalReversed"==e?"left":"label"==e?"left":"value"==e?"left":""},getDefaultValueAlign:function(e){return"normal"==(e=e||"normal")||"both"==e?"left":"vertical"==e?"left":"reversed"==e?"right":"verticalReversed"==e?"left":"label"==e?"left":"value"==e?"left":""},configureSubmitOnChange:function(){var e=this,t=e.properties,i="";if(t.editable){t.dependencies=t.dependencies||"all";var r={conditions:{expressions:[{simple:{xpath:i=t.xpath?t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.xpath:t.xpath:t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};$.when(e.ready()).done(function(){e.getFormContainer().addSubmitAction(i,r)})}},submitOnChange:function(e,t,i){var r=this,a=$.Deferred();return""!=r.properties.contexttype&&e&&(e[r.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=r.properties.contexttype),$.when(r.isReadyToSave()).done(function(){r.internalSubmitOnChange(e,t,i).done(function(){a.resolve()}).fail(function(){a.reject()})}),a.promise()},getCacheIdCase:function(){var e=this.getParams().idCase;return void 0===bizagi.cache?(bizagi.cache={},bizagi.cache.idCaseObject={idCase:void 0!==e?e:void 0!==bizagi.cache.idCase?bizagi.cache.idCase:void 0}):void 0!==e&&void 0!==bizagi.cache.idCaseObject?bizagi.cache.idCaseObject.idCase=e:void 0!==e&&void 0===bizagi.cache.idCaseObject&&(bizagi.cache.idCaseObject={},bizagi.cache.idCaseObject.idCase=e),e=void 0===e?void 0===bizagi.cache.idCaseObject?void 0:bizagi.cache.idCaseObject.idCase:e},internalSubmitOnChange:function(e,t,i){var r=this.getFormContainer(),a=this.properties,n={data:e,bRefreshForm:t,notCollect:i,properties:{idCase:this.getCacheIdCase(),id:a.id,xpath:a.xpath,idPageCache:a.idPageCache,contexttype:a.contexttype}};return r.internalSubmitOnChange(n)},ready:function(){return $.when(this.parent.ready(),this.isRendered())},getCustomHandlers:function(){var e=this.getFormContainer();return e?e.getCustomHandlers():null},getCustomHandler:function(e){var t=this.getCustomHandlers();return t?t[e]:null},getRTLAlign:function(e){return"default"==e||"left"==e?"right":"right"==e?"left":e},calculateRenderWidth:function(e,t,i){if(e="100"==t&&void 0===e?"0":e?"0"!=e?e:"50":"50%",t=t?"0"!=t?t:"50":"50%","normal"==i||"both"==i||"reversed"==i){if(e&&bizagi.util.percent2Number(e)<5&&t&&bizagi.util.percent2Number(t)<5)return{label:0,control:100};e&&!t?t=100-(e=bizagi.util.percent2Number(e)):!e&&t?e=100-(t=bizagi.util.percent2Number(t)):(e=bizagi.util.percent2Number(e))+(t=bizagi.util.percent2Number(t))!=100&&void 0!==this.properties&&"pixels"!=this.properties.layoutType&&(t=100-e)}else e=100,t=100;return{label:e,control:t}},getIdCase:function(){return this.getFormContainer().params.idCase||bizagi.context.idCase},getIdWorkitem:function(){return this.getFormContainer().params.idWorkitem||bizagi.context.idWorkitem},getidTask:function(){return this.getFormContainer().params.idTask||bizagi.context.idTask},getSessionId:function(){return this.getFormContainer().properties.sessionId},changeCellColor:function(e){var t=this.getControl();t&&("none"!=e?(t.css("color",e),t.find("input, textarea, label").each(function(t,i){$(i).css("color",e)})):(t.css("color",""),t.find("input, textarea, label").each(function(e,t){$(t).css("color","")})))},changeCellBackgroundColor:function(e){var t=this.getControl(),i="",r="";if(t)if("none"!=e&&(i=e,r="none"),this.properties.editable){var a=!1;t.find("input, textarea, .ui-selectmenu").each(function(e,t){"text"!=t.type&&"textarea"!=t.type||$(t).hasClass("ui-select-data")||(a=!0),$(t).css({"background-color":i,"background-image":r})}),a||t.closest("td").each(function(e,t){$(t).css({"background-color":i,"background-image":r})})}else t.each(function(e,a){($(a).hasClass("ui-bizagi-cell-readonly")?t.closest("td"):$(a)).css({"background-color":i,"background-image":r})})},changeCellVisibility:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)?(i.css("visibility","visible"),i.css("display","")):i.css("visibility","hidden")),t.visible=e},changeCellRequired:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)&&bizagi.util.isEmpty(this.value)?(i.addClass("control-required"),i.append('<div class="ui-bizagi-render-control-required"></div>')):(i.removeClass("control-required"),$(".ui-bizagi-render-control-required",i).remove()),t.required=e)},startActionExecution:function(){this.startLoading(),this.actionExecutionDeferred=new $.Deferred},endActionExecution:function(){this.endLoading(),this.actionExecutionDeferred&&this.actionExecutionDeferred.resolve(),delete this.actionExecutionDeferred},readyActionExecution:function(){return this.actionExecutionDeferred?this.actionExecutionDeferred.promise():$.when(!0)},isFromCreatedRow:function(){var e=this;if(e.grid)for(var t=e.grid.columns.length;t-- >0;)if(e.grid.columns[t].properties.xpath==e.properties.xpath&&1==e.grid.columns[t].isNewRow)return!0;return!1},submitInvalidatePageCacheRequest:function(e){var t=this.properties,i=e?e.idPageCache:t.idPageCache;this.dataService.invalidatePageCache({idPageCache:i})}}),$.Class.extend("bizagi.rendering.render.base",{},{processLayout:function(e,t){var i=this.properties;if("boolean"==typeof e)if(e)this.processLabelLayout(t);else{this.processControlLayout(t),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required);var r=void 0===i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||this.changeVisibility(r)}else console.warm("error calling processLayout, 'isLabelFormat' is not boolean")},processLabelLayout:function(e){var t=this.getLabel();null!=t&&(void 0===(e=e||{}).bold&&(e.bold=!0),this.changeBackgroundColor(e.background).changeFontColor(t,e.color).changeFontBold(t,e.bold).changeFontSize(t,e.size).changeFontItalic(t,e.italic).changeTextDecoration(t,(e.underline?"underline":"")+(e.strikethru?" line-through":"")))},processControlLayout:function(e){var t=this.getControl(),i=this.getElementsToStylize(t);e=e||{},this.changeFontColor(i,e.color).changeFontBold(i,e.bold).changeFontItalic(i,e.italic).changeFontSize(i,e.size).changeTextDecoration(i,(e.underline?"underline":"")+(e.strikethru?" line-through":""))},changeColor:function(e){var t=this.getLabel(),i=this.getControl(),r=this.getElementsToStylize(i);return this.changeFontColor(t,e).changeFontColor(r,e)},changeFontColor:function(e,t){if(void 0===e)return this;if(void 0===t)return this;var i="none"!==t?t:"";return e.css("color",i),this},changeFontSize:function(e,t){if(void 0===t)return this;if(void 0===e)return this;if("0"!==t){var i=100+10*Number(t)+"%";e.css("font-size",i)}return this},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)},changeFontItalic:function(e,t){var i=bizagi.util.parseBoolean(t)?"italic":"normal";return e.css("font-style",i),this},changeFontBold:function(e,t){var i=bizagi.util.parseBoolean(t)?"bold":"normal";return e.css("font-weight",i),this},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.css("background-color",e):this.element.css("background-color",""),this)}}),bizagi.rendering.render.extend("bizagi.rendering.render",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.formParams=t.getParams()},postRender:function(){this.configureHelpText()},postRenderReadOnly:function(){var e=this.getControl();this._super(),this.configureHelpText(),e.addClass("bz-rn-read-only"),e.parent().addClass("bz-rn-read-only")},configureHelpText:function(){var e=this.properties;if(e&&e.helpText&&""!==e.helpText){var t=this.getContainerHelpText();t&&$(t).helpText({helpText:e.helpText,dir:e.orientation})}},getLabel:function(){var e=this;if(!e.label){var t=$(".ui-bizagi-label",e.element||e.observableElement);return t.length>0&&(e.label=t),t}return e.label},getControl:function(){var e=this;return e.control&&0!==e.control.length||(e.control=$(".ui-bizagi-render-control",e.element||e.observableElement)),e.control},getControlFiller:function(){var e=this;return e.controlFiller||(e.controlFiller=$(".ui-bizagi-render-control",e.element||e.observableElement)),e.controlFiller},startLoading:function(){},endLoading:function(){},getDisplayOptionClass:function(e){return"normal"==e||"both"==e?"ui-bizagi-render-display-normal":"vertical"==e?"ui-bizagi-render-display-vertical":"reversed"==e?"ui-bizagi-render-display-reversed":"verticalReversed"==e?"ui-bizagi-render-display-vertical-reversed":"label"==e?"ui-bizagi-render-display-label":"value"==e?"ui-bizagi-render-display-value":void 0},getRTLDisplayType:function(e){return e},changeDisplayOption:function(e){var t=this.element;t.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),t.addClass(this.getDisplayOptionClass(e))},getAlignClass:function(e){return"left"==e?"ui-bizagi-render-align-left":"center"==e?"ui-bizagi-render-align-center":"right"==e?"ui-bizagi-render-align-right":void 0},changeLabelAlign:function(e){var t=this.getLabel();t.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right"),t.addClass(this.getAlignClass(e))},changeValueAlign:function(e){var t=this.getControlFiller();t.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right"),t.addClass(this.getAlignClass(e))},customizeRenderWidth:function(){var e=this.getLabel(),t=this.properties,i=this.getControlFiller(),r=t.labelWidth?"0"!=t.labelWidth?t.labelWidth:"50%":null,a=t.valueWidth?"0"!=t.valueWidth?t.valueWidth:"50%":null;r&&!a?a=100-(r=bizagi.util.percent2Number(r)):!r&&a?r=100-(a=bizagi.util.percent2Number(a)):(r=bizagi.util.percent2Number(r))+(a=bizagi.util.percent2Number(a))!=100&&(a=100-r),e.width(r+"%"),i.width(a-.01+"%")},submitOnChange:function(e,t){var i=this,r=new $.Deferred;return bizagi.util.tablet.startLoading(),$.when(i.isReadyToSave()).done(function(){$.when(i.internalSubmitOnChange(e,t)).done(function(){r.resolve()}).fail(function(){r.reject()}).always(function(){bizagi.util.tablet.stopLoading()})}),r.promise()},getContainerHelpText:function(){var e=this;return e.containerHelpText||(e.containerHelpText=$(".bz-container-rn-helptext",e.element||e.observableElement)),e.containerHelpText&&0!==e.containerHelpText.length?e.containerHelpText:null},setValidationMessage:function(e){var t=this;t._super(e),$.when(t.ready()).done(function(){var i=t.getControl();if(e&&e.length>0){var r=0===t.element.prev().length&&t.parent===t.getFormContainer();e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),i.attr("data-error",e),i.addClass(r?"ui-bizagi-render-error-firstControl":"ui-bizagi-render-error")}else i&&(i.attr("data-error",""),i.removeClass("ui-bizagi-render-error"),i.removeClass("ui-bizagi-render-error-firstControl"))})},processLayout:function(e,t){var i=this,r=i.properties;if(null!=i.getControl()){(t=t||{}).color&&i.changeColor(t.color,e),t.background&&i.changeBackgroundColor(t.background),!t.bold&&t.bold&&e||i.changeFontBold(t.bold,e),t.italic&&i.changeFontItalic(t.italic,e),t.underline&&i.changeFontUnderline(t.underline,e),t.strikethru&&i.changeFontStrikethru(t.strikethru,e),t.size&&i.changeFontSize(t.size,e),r.required=null!=r.required&&bizagi.util.parseBoolean(r.required);var a=null==r.visible||bizagi.util.parseBoolean(r.visible);r.required&&i.changeRequired(r.required),a||i.changeVisibility(a)}},changeRequiredLabel:function(){this.properties.required&&(this.checkRequired([])?$("div.ui-bizagi-render-control-required",this.getControl()).hide():$("div.ui-bizagi-render-control-required",this.getControl()).show())},changeRequired:function(e){var t=this,i=$("label",t.getLabel()),r=t.getControl();r.find(".ui-bizagi-render-control-required").remove();var a=t.properties;a.required=e,bizagi.util.parseBoolean(e)?(i.text((a.displayName||"")+" "),t.hasValue()?r.prepend("<div class='ui-bizagi-render-control-required' style='display: none'></div>"):r.prepend("<div class='ui-bizagi-render-control-required'></div>")):i.text(a.displayName||""),t.triggerRenderValidate()},changeEditability:function(e){var t=bizagi.util.parseBoolean(e);this._super(e);var i=this.getRenderedElement();i&&i.toggleClass("bz-rn-non-editable",!t).toggleClass("bz-rn-read-only",!t)},getElementsToStylize:function(e){return e=$("*:not(.bz-mo-icon):not(.bz-rn-container-control-icon):not(.bz-rn-upload-show-menu):not(.ui-bizagi-render-yesno)",$(e))},getFormParams:function(){return this.formParams||{}},clearDisplayValue:function(){var e=this.getControl().find("input").filter(function(e,t){return"file"!==t.type&&"radio"!==t.type&&"checkbox"!==t.type});e.length>0?e.val(this.getValue()):this.setDisplayValue("")}}),bizagi.rendering.render.extend("bizagi.rendering.actionLauncher",{},{init:function(e){this._super(e)},initializeData:function(e){var t=this;this._super(e);var i=t.getFormContainer();this.typeForm=i.properties.typeForm||"";var r=t.getMode(),a=t.properties;t.deferredActions=new $.Deferred,t.deferredActions.promise(),"execution"==r&&(t.engine=new bizagi.templateEngine({renderFactory:t.renderFactory,cache:!0,autoGenerateData:!1,templateGuid:a.selecttemplate})),t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",psurrogatedKey:t.properties.surrogatedKey,ptags:t.properties.tagslist||[],pmaxitems:t.properties.maxItems,pactionXpath:t.properties.xpathActions},t.processPropertyValueDataTmplArgs={pactionXpath:t.properties.xpathActions,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,ptemplateGuid:a.selecttemplate,property:"dataTemplate",xpathActions:t.properties.xpathActions},t.properties.valueWidth=100,t.properties.displayType="value";var n="entityTemplate"!==e.properties.type;t.properties.allowactions=void 0===e.properties.allowactions?n:e.properties.allowactions,t.properties.isHorizontal=void 0===e.properties.isHorizontal||e.properties.isHorizontal,t.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,t.properties.selecttemplate=void 0===e.properties.selecttemplate?"":e.properties.selecttemplate,t.properties.templatetype=void 0!==a.templatetype?a.templatetype:"none",t.properties.sessionId=i.params.data.sessionId,t.properties.value?"string"==typeof t.properties.value&&(t.properties.value=t.value=JSON.parse(t.properties.value)):(t.properties.value=t.value=[],t.properties.originalValue=[])},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeAction",psurrogatedKey:t.properties.surrogatedKey,pguidAction:e.guidAction,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done(function(i){t.notifyExecution(i,e)}).fail(function(i){t.notifyExecution("Error",e)})},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this,i=t.properties,r="";if("design"==t.getMode()){e=t.renderFactory.getTemplate("render-actionLauncher-design");var a={type:i.type,isHorizontal:i.isHorizontal,allowSearch:i.allowSearch,templateDefined:"none"!=i.templatetype,allowactions:i.allowactions};r=$.fasttmpl(e,a)}else i.surrogatedKey&&(e=t.renderFactory.getTemplate("render-actionLauncher"),r=$.fasttmpl(e,{allowactions:t.properties.allowactions}));return r},isValid:function(e){var t=this,i=t.properties;t.getValue();return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||!(!i.required||!t.value)&&(t.value.length>0||(message=t.getResource("render-required-register-action"),e.push({xpath:i.xpath,message:message}),!1)))},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidProcess||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done(function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayName,recordXpath:e.recordXpath})).done(function(t){e.idStartScope=t,r.resolve(e)}):r.resolve(e)});break;case"Rule":r.resolve(e);break;case"Form":e.xpathContext?$.when(t.processActionFormCollection(e)).done(function(t){e.idStartScope=t,r.resolve(e)}):("Form"===e.actionType&&(e.xpathContext=void 0,e.contextType="entitytemplate",e.guidEntity=e.guidEntity||t.properties.guidEntity),$.when(t.processActionForm(e)).done(function(t){e.idStartScope=t,r.resolve(e)}))}return r.promise()},addActionToQueue:function(e){var t=this,i=t.getValue(),r=t.getFormContainer().getParams();e.params=e.params||{};var a=t.properties.xpathContext;switch(e.actionType){case"Process":e.params={idStartScope:e.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,recordXpath:a};break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),entityXpath:t.properties.xpathActions,idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity};break;case"Rule":e.params={xpathActions:e.xpathActions||"",recordXpath:a}}var n=bizagi.clone(i);n.push(e),t.setValue(n),t.setDisplayValue(n)},removeActionToQueue:function(e){var t=bizagi.clone(this.getValue());t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidAction,r.push(i)}),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,function(t,r){r.guidAction==e.guidAction&&i++}),i},getPropertiesActionLaucher:function(e){for(var t=this.getFormContainer(),i=0,r=e.length;i<r;i+=1)6===e[i].length&&(e[i].splice(5,0,""),"Process"==e[i][3]&&t.properties.xpathContext&&(e[i][5]=t.properties.xpathContext));return e}}),bizagi.rendering.render.extend("bizagi.rendering.entityTemplate",{},{init:function(e){this._super(e)},initializeData:function(e){var t=this;this._super(e);var i=t.getFormContainer();t.deferredActions=new $.Deferred,t.deferredActions.promise(),t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",psurrogatedKey:t.properties.surrogatedKey},t.properties.valueWidth=100,t.properties.displayType="value",t.properties.allowactions=void 0===e.properties.allowactions||e.properties.allowactions,t.properties.value?"string"==typeof t.properties.value&&(t.properties.value=t.value=JSON.parse(t.properties.value)):t.properties.value=t.value=[]},renderControl:function(){var e,t=this,i="";return"design"==t.getMode()?(e=t.renderFactory.getTemplate("render-entityTemplate-design"),i=$.fasttmpl(e,{})):t.properties.surrogatedKey&&(e=t.renderFactory.getTemplate("render-entityTemplate"),i=$.fasttmpl(e,{allowactions:t.properties.allowactions})),i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)}}),bizagi.rendering.render.extend("bizagi.rendering.polymorphicLauncher",{},{init:function(e){this._super(e)},initializeData:function(e){var t=this;this._super(e);var i=t.getFormContainer();this.typeForm=i.properties.typeForm||"";t.getMode();t.deferredActions=new $.Deferred,t.deferredActions.promise(),t.properties.valueWidth=100,t.properties.displayType="value",t.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,t.properties.additionalXpath=t.properties.additionalXpath||[],t.properties.value?"string"==typeof t.properties.value&&(t.properties.value=t.value=JSON.parse(t.properties.value)):(t.properties.value=t.value=[],t.properties.originalValue=[]),t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",ptags:t.getTagList(t.properties.tagslist),additionalXpaths:t.properties.additionalXpath}},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeConstructor",psurrogatedKey:t.properties.surrogatedKey,pguidConstructor:e.guidConstructor,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done(function(i){t.notifyExecution(i.response,e)}).fail(function(i){t.notifyExecution("Error",e)})},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-polymorphicLauncher-design");var r={type:t.type,allowSearch:t.allowSearch};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-polymorphicLauncher"),i=$.fasttmpl(e));return i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidObject||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done(function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayNamee,recordXpath:e.recordXpath})).done(function(t){e.idStartScope=t,r.resolve(e)}):r.resolve(e)});break;case"Rule":r.resolve(e);break;case"Form":$.when(t.processActionForm(e)).done(function(t){e.idStartScope=t,r.resolve(e)})}return r.promise()},addActionToQueue:function(e){var t=this,i=t.getValue(),r=t.getFormContainer().getParams();e.params=e.params||{};var a=t.properties.xpathContext;switch(e.actionType){case"Process":e.params={additionalXpaths:t.properties.additionalXpath.join(","),idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,recordXpath:a},void 0!==e.idStartScope&&(e.params.idStartScope=e.idStartScope);break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),entityXpath:t.properties.xpathActions,idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity,guidEntity:e.guidEntity}}i.push(e),t.setValue(i),t.setDisplayValue(i)},removeActionToQueue:function(e){var t=this.getValue();t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidObject||t.guidAction,i.displayName=t.displayName,i.guidConstructor=t.guidConstructor,i.actionType=t.actionType,i.xpathContext=t.xpathContext,i.guidEntity=t.guidEntity,r.push(i)}),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,function(t,r){r.guidAction==e.guidAction&&i++}),i},getTagList:function(e){for(var t=[],i=(e=e||[]).length;i>0;i--)t.push(e[i-1].value);return t.length>0?t:""}}),bizagi.rendering.render.extend("bizagi.rendering.combo",{},{initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=t.data||!1,void 0===t.enableTyping&&(t.enableTyping=!0),t.value=t.value&&t.value.length>0?t.value[0]:t.defaultValue&&t.defaultValue.length>0?t.defaultValue[0]:null,t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data)),t.loadOnDemand=!1},renderControl:function(){var e=this,t={};if(e.isDependant&&e.properties&&"cascadingCombo"===e.properties.type&&e.getParentCombo){var i=e.getParentCombo().getValue();i&&i.id&&(t[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=i.id)}return e.renderCombo(t)},renderCombo:function(e){var t=this;if(t.properties.loadOnDemand)return t.renderComboTemplate();var i=new $.Deferred,r=t.getData(e);return $.when(r).done(function(e){var r=t.renderComboTemplate(e);t.properties.data=e,i.resolve(r)}).fail(function(e){var r=t.renderComboTemplate({});i.resolve(r)}),i.promise()},renderComboTemplate:function(e){var t=this,i=t.properties,r=t.renderFactory.getTemplate(t.getTemplateName()),a=bizagi.override.emptyLabelForCombo||t.getResource("render-combo-empty-selection"),n=i.value?"":a;return e=e||t.properties.data||{},"columnCombo"!==t.properties.type||""!==n||"object"!=typeof i.value||""!==i.value.id||""!==i.value.value&&i.value.value!==t.getResource("render-combo-empty-value")||(n=t.getResource("render-combo-empty-selection")),$.fasttmpl(r,$.extend(t.getTemplateParams(),{id:i.id,xpath:i.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:i.idPageCache,items:e,align:i.valueAlign,value:n}))},postRenderReadOnly:function(){var e=this;e._super();var t=e.getValue(),i=e.getControl();e.control&&e.control.parent()&&e.control.parent().addClass("ui-bizagi-noneditable-"+e.properties.displayType),t?(null!=t.value&&"boolean"==typeof t.value&&(1==bizagi.util.parseBoolean(t.value)?t.value=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(t.value)&&(t.value=this.getResource("render-boolean-no"))),e.getResource("render-combo-empty-value")==t.value||e.getResource("render-combo-empty-selection")==t.value?i.text(""):i.html("<label class='readonly-control'>"+e.formatItem(t.value)+"</label>")):i.text("")},getTemplateName:function(){return"combo"},showEmpty:function(){return!0},showCurrentData:function(){return!0},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;return"execution"!=t.getMode()?t.getDummyData():(i.hasLocalData?r.resolve(i.data):i.remoteDataLoaded&&"cascadingCombo"!=i.type?r.resolve(i.data):t.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,extra:e,contexttype:t.properties.contexttype||null}).done(function(e){i.recalculate||(i.remoteDataLoaded=!0),i.data=t.complementData(e),r.resolve(i.data)}).fail(function(e){if("not-processed"!=e.type){var i=t.getFormContainer(),a=t.properties.displayName+": ";if("string"==typeof e)var n=JSON&&JSON.parse(e)||$.parseJSON(e);else n=e;a+=n.message,i.addValidationMessage(a),r.reject(e)}}),r.promise())},getDummyData:function(){var e=this.properties;return e.data?e.data:(e.data=[],e.data=this.complementData(e.data),e.data.push({id:"",value:"Item 1"}),e.data.push({id:"",value:"Item 2"}),e.data)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=null,e.remoteDataLoaded=!1},getDisplayValue:function(){var e=this;if(e.combo&&e.combo.length>0)return e.getSelectedValue();var t="",i=e.getValue();return i&&(t=e.formatItem(i.value)),t},getSelectedValue:function(){},getTemplateParams:function(){return{}},formatItem:function(e){if(null!=e){if($.isArray(e)){for(var t=0,i=e.length;t<i;t++)null!=e[t]&&"boolean"==typeof e[t]&&(1==bizagi.util.parseBoolean(e[t])?e[t]=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e[t])&&(e[t]=this.getResource("render-boolean-no")));return e.join(" - ")}return e}return""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||null==r||("object"!=typeof r||void 0!==r.id&&""!==r.id?e[t.xpath]=void 0!==r.id?r.id:"":e[t.xpath]=""))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0;return $.forceCollectData?a:(t=t&&void 0!==t.length?t[0]:t,i=i&&void 0!==i.length?i[0]:i,r=r&&void 0!==r.length?r[0]:r,t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,a=void 0!==(r=r&&void 0!==r.id?r.id:r)?r!=i||r!=t:t!=i)},parseAdditionalValues:function(e){var t=this;return $.map(e,function(e){var i=e.value?t.formatItem(e.value):e,r={id:e.id,value:i};return e.hidden&&(r.hidden=!0),e})},complementData:function(e){var t=this,i=t.properties,r=!1;if($.each(e,function(e,a){void 0!==a.value&&null!==a.value?(a.value=t.formatItem(a.value),i.value&&a.id==i.value.id&&(r=!0)):a.value=""}),t.showEmpty()){for(var a=!1,n=0,o=e.length;n<o;n++)if(""==e[n].id){a=!0;break}if(!a){var s=bizagi.override.emptyLabelForCombo||bizagi.localization.getResource("render-combo-empty-value");e.unshift({id:"",value:s})}}return i.value&&!r&&t.showCurrentData()&&e.unshift({id:i.value.id,value:i.value.value,hidden:!0}),t.parseAdditionalValues(e)},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&("[object Object]"!==Object.prototype.toString.apply(e)||!bizagi.util.isEmpty(e.id)&&0!=e.id)},cleanData:function(){var e={id:"",label:""};this.setDisplayValue(e),this.setValue(e,!1)},beforeToRefresh:function(){this.column&&!this.column.comboData&&this.getData()},isExtraItem:function(){var e=(this.value||{}).value||"";return""===e||e===this.getResource("render-combo-empty-selection")||e==this.getResource("render-combo-empty-value")},escapeValue:function(e){return bizagi.util.isString(e)?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e}}),bizagi.rendering.render.extend("bizagi.rendering.check",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("check"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t})},renderReadOnly:function(){return this.renderControl()},postRender:function(){var e=this.getControl();this._super(),this.input=e.find("label")},getDisplayValue:function(){var e=this.getValue();return 1==bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&(!1!==bizagi.util.parseBoolean(e)||!this.properties.required)}}),bizagi.rendering.render.extend("bizagi.rendering.number",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.dataTypeMinValue=this.calculateMinValue(t.dataType),t.dataTypeMaxValue=this.calculateMaxValue(t.dataType)},renderControl:function(){var e=this.renderFactory.getTemplate("number"),t=bizagi.util.detectDevice(),i={};return"desktop"!==t&&(i={type:-1!==t.indexOf("android")?"tel":"text"}),$.fasttmpl(e,i)},postRender:function(){var e=this;e._super();var t=e.getControl(),i=e.properties;e.numericInput=t.find("input"),e.numericInput.numeric(e.properties.decimalSymbol),e.attachFormatCurrency(),"double"==i.retype&&e.attachRetypeDouble()},removeValidations:function(){(this.getFormContainer().parent||this.getFormContainer()).clearValidationMessages()},attachRetypeDouble:function(){},attachFormatCurrency:function(){var self=this,properties=self.properties,message=bizagi.localization.getResource("render-number-retype-fail"),control=self.getControl();self.isValidRender=self.isValidRender||!0,null==$.formatCurrency.regions[bizagi.language]&&($.formatCurrency.regions[bizagi.language]=this.getResource("numericFormat")),self.numericInput.blur(function(){void 0===self.getFormContainer().validationController&&(self.getFormContainer().validationController=new bizagi.command.controllers.validation(self.getFormContainer(),self.validations));var e=self.getFormContainer().validationController||self.getFormContainer().parent.validationController,t=".",i=",";"undefined"==typeof BIZAGI_DEFAULT_CURRENCY_INFO?(t=self.getResource("numericFormat").decimalSymbol||".",i=self.getResource("numericFormat").digitGroupSymbol||","):(t=BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,i=BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator);var r=self.getMinValue(),a=self.getMaxValue();properties.percentage&&self.numericInput.val(self.numericInput.val().replace("%",""));var n=self.numericInput.val();n=(n=","==t?n.replace(/\,0+$/,""):n.replace(/\.0+$/,"")).replace(properties.symbol,""),-1!=(n=bizagi.util.replaceAll(n,i,"")).toString().indexOf(t)&&(","==t&&(n=n.replace(/([0-9]+(\,[0-9]+[1-9])?)(\,?0+$)/,"$1")),"."==t&&(n=n.replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"))),null!=n&&n.length>0&&self.numericInput.val(n);var o=n.replace(/[^0-9]+/g,"").length,s=self.properties.xpath,l=self.numericInput.val();if(null!=self.isInvalidFormat&&1==self.isInvalidFormat||""!=n&&-1!=["$","£","€","¥",properties.symbol].indexOf(n))return self.setValue(""),self.getControl().find("input").val(""),void self.numericInput.val("");if(""!=bizagi.util.trim(n)){var d=parseFloat(n.replace(",","."));if(isNaN(d)&&(d=self.numericInput.asNumber()),message=void 0!==r&&null!=r&&d<r?bizagi.localization.getResource("render-numeric-minimum-validation").replaceAll("#label#",properties.displayName+" ("+l+")").replaceAll("#minValue#",r.toString()):null!=a&&d>a?bizagi.localization.getResource("render-numeric-maximum-validation").replaceAll("#label#",properties.displayName+" ("+l+")").replaceAll("#maxValue#",a.toString()):message+" "+l,null!=r&&d<r||null!=a&&d>a||10==self.properties.dataType&&o>15||1==self.properties.dataType&&o>19||11==self.properties.dataType&&o>7||11==self.properties.dataType&&o>7||l.match(/[^$£€¥,-.()\d]/)){if(void 0!==e&&null!=e){self.removeValidations();var c=message;-1===c.indexOf(l)&&(c=message+" "+l),e.showValidationMessage(c,s),self.isValidRender=!1,self.isValidRenderMessage=c}message=message.replace(l,"")}else self.isValidRender=!0,self.isValidRenderMessage="",this.value.toString().length>0&&!properties.allowDecimals&&!properties.groupDigits?(this.value=this.value.toString().replace(/^0+/,""),properties.symbol.length>0&&(this.value=this.value.toString().replace(properties.symbol+"0",properties.symbol)),this.value=this.value.toString().replace(/^0+/,""),0==this.value.replaceAll("0","").length?this.value=properties.symbol+"0":this.value.toString()==parseInt(this.value)&&(this.value=properties.symbol+this.value)):"money"!==self.properties.type&&"number"!==self.properties.type&&"columnMoney"!==self.properties.type&&"columnNumber"!==self.properties.type||(this.value=this.value.toString().replace(/^0+/,""),""===this.value&&(this.value=0)),self.executeFormatCurrencyPlugin(),self.setValue(self.numericInput.asNumber({symbol:properties.symbol,positiveFormat:properties.positiveFormat,negativeFormat:properties.negativeFormat,decimalSymbol:properties.decimalSymbol,digitGroupSymbol:properties.digitGroupSymbol,groupDigits:properties.groupDigits})),properties.percentage&&self.numericInput&&-1==self.numericInput.val().indexOf("%")&&self.numericInput.val(self.numericInput.val()+"%"),message=message.replace(l,"")}else self.setValue("")}).bind("paste",function(e){try{var tmpData=bizagi.util.isIE()||bizagi.util.isIE11()?window.clipboardData.getData("text"):e.originalEvent.clipboardData.getData("Text"),totalVal="/[^0-9";properties.decimalSymbol.length>0&&(totalVal+=properties.decimalSymbol),8==properties.dataType&&(properties.symbol.length>0&&(totalVal+=properties.symbol),properties.digitGroupSymbol.length>0&&(totalVal+=properties.digitGroupSymbol)),totalVal+="\\-\\s]/gi";try{tmpData.replace(eval(totalVal),"").length!=tmpData.length&&e.preventDefault()}catch(e){}}catch(e){bizagi.log("Error to pasting content"),self.isInvalidFormat=!0}}).keydown(function(e){self.previousValue=this.value;var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if("undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO&&0==BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits&&(properties.allowDecimals=!1),(properties.dataType<5||8==properties.dataType&&0==properties.allowDecimals)&&(188!=t&&190!=t&&110!=t||e.preventDefault()),this.value&&void 0!==e&&this.value.length>0&&(8==properties.dataType||10==properties.dataType))if(t>47&&t<58){self.formatTimeout&&clearTimeout(self.formatTimeout);var i=this.value+"";properties.digitGroupSymbol&&properties.digitGroupSymbol.length>0&&(i=i.replaceAll(properties.digitGroupSymbol,"")),properties.symbol.length>0&&(i=i.replaceAll(properties.symbol,"")),i=$.trim(i),properties.decimalSymbol&&properties.decimalSymbol.length>0&&(i=i.replaceAll(properties.decimalSymbol,".")),10*i>properties.dataTypeMaxValue&&e.preventDefault()}else 109!=t&&189!=t||(this.value=properties.symbol+"-"+this.value.replace(properties.symbol,""))}).keyup(function(e){var t=(e=window.event||e).charCode||e.keyCode;if(void 0!==e)switch(t){case 16:case 17:case 13:case 18:break;case 27:this.value=""}}).keypress(function(e){var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if(void 0!==e){35==t||37==t||39==t?e.preventDefault():8!=properties.dataType&&36==t&&e.preventDefault();var i=String.fromCharCode(t);!1===properties.allowDecimals&&0===properties.numDecimals&&i===properties.decimalSymbol&&e.preventDefault()}})},executeFormatCurrencyPlugin:function(){var e=this,t=e.properties;if(e.numericInput&&e.numericInput.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),8!=t.dataType&&!0===bizagi.override.removeTrailingZeros){var i=e.numericInput.val(),r=!0;-1!=i.indexOf(")")&&(r=!1,i=i.replace("(","").replace(")",""));var a=new RegExp("("+t.decimalSymbol+"\\d*?[1-9])0+$","g");i=i.replace(a,"$1"),a=new RegExp("\\"+t.decimalSymbol+"0+$","g"),i=i.replace(a,""),e.numericInput.val(i),r||e.numericInput.val("("+i+")")}t.percentage&&e.numericInput.val(e.numericInput.val()+"%")},getDisplayValue:function(){var e=this.properties,t=this.getControl(),i=void 0!==this.getValue()?this.getValue():$("input",t).val()||"",r=$("<label/>").html(i);if(r.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),e.percentage&&(r=$("<label/>").html(r.text()+"%")),0==e.editable&&8!=e.dataType&&!0===bizagi.override.removeTrailingZeros){var a=!0;-1!=(i=r.text()).toString().indexOf(")")&&(a=!1,i=i.replace("(","").replace(")",""));var n=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");return i=i.replace(n,"$1"),n=new RegExp("\\"+e.decimalSymbol+"0+$","g"),i=i.replace(n,""),a||(i="("+i+")"),i}return r.text()},isValid:function(e){var t,i=this,r=i.properties,a=this._super(e),n=i.getValue(),o=(i.getDisplayValue(),i.getMinValue()),s=i.getMaxValue();if("string"==typeof n&&""!=n&&(n=Number(n)),i.hasValue()&&(bizagi.util.isEmpty(o)||n<o&&(t=this.getResource("render-numeric-minimum-validation").replaceAll("#label#",r.displayName.toString()+" ("+n+")").replaceAll("#minValue#",o.toString()),e.push({xpath:r.xpath,message:t}),a=!1),bizagi.util.isEmpty(s)||n>s&&(t=this.getResource("render-numeric-maximum-validation").replaceAll("#label#",r.displayName.toString()+" ("+n+")").replaceAll("#maxValue#",s.toString()),e.push({xpath:r.xpath,message:t}),a=!1)),!(!1!==i.isValidRender||a&&bizagi.util.isMobileDevice())){a=!1;var l=i.isValidRenderMessage?i.isValidRenderMessage:"error";e.push({xpath:r.xpath,message:l})}return a},getMinValue:function(){var e=this.properties.minValue;return null!=e?e:this.properties.dataTypeMinValue},getMaxValue:function(){var e=this.properties.maxValue;return null!=e?e:this.properties.dataTypeMaxValue},getDefaultAllowDecimals:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1},setGroupDigits:function(){var e=this;return void 0!==e.properties.thousands?!!e.properties.digitGroupSymbol&&bizagi.util.parseBoolean(e.properties.thousands):!!e.properties.digitGroupSymbol&&this.getDefaultGroupDigits(e.properties.dataType)},calculateMinValue:function(e){return 8==e||10==e?-922337203685477:4==e?0:3==e?-32768:2==e?-2147483648:1==e?-999999999999999:null},calculateMaxValue:function(e){return 8==e||10==e?922337203685477:4==e?255:3==e?32767:2==e?2147483647:1==e?999999999999999:null},changeMinValue:function(e){var t=Number(e);this.properties.minValue=this.properties.dataTypeMinValue=Number.isNaN(t)?this.calculateMinValue(this.properties.dataType):t},changeMaxValue:function(e){var t=Number(e);this.properties.maxValue=this.properties.dataTypeMaxValue=Number.isNaN(t)?this.calculateMaxValue(this.properties.dataType):t}}),bizagi.rendering.render.extend("bizagi.rendering.numberScientificNotation",{initializeData:function(e){this._super(e),this.properties.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:format.decimalSymbol},renderControl:function(){var e=this.renderFactory.getTemplate("numberScientificNotation");return $.fasttmpl(e,{})},postRender:function(){var e=this.getControl();this.numericInput=e.find("input"),this.numericInput.numericSN(this.properties.decimalSymbol)},getDisplayValue:function(){return this.getValue().replace(".",this.properties.decimalSymbol)},setValue:function(e){e=(e||"").toString().replace(this.properties.decimalSymbol,"."),this._super(e)},controlValueIsChanged:function(){var e=this.properties,t=this.getValue()||"",i=e.originalValue||"";return!!$.forceCollectData||i.toLowerCase()!=t.toLowerCase()}}),bizagi.rendering.render.extend("bizagi.rendering.date",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");if(t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.showTime&&-1===t.fullFormat.search(/[h|H]+/gi)&&(t.fullFormat=t.fullFormat+" "+t.timeFormat),t.value){var a=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime);if(0!=a){this.value=t.value;var n=bizagi.localization.getResource("datePickerRegional");t.displayValue=bizagi.util.dateFormatter.formatDate(a,t.fullFormat,n)}else this.value=null}},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("date"),i=e.dateFormat.substring(0,e.dateFormat.indexOf(":")).lastIndexOf(" ");return $.fasttmpl(t,{showTime:e.showTime,value:e.value,dateFormat:i>0?e.dateFormat.substring(0,i):e.dateFormat,timeFormat:e.showTime&&i>0?e.dateFormat.substring(i):"",rtl:"rtl"==e.orientation})},configureHandlers:function(e,t){var i=this,r=i.properties,a=i.getDateControl(),n=i.getTimeControl();r.mask&&a.mask({mask:r.mask}),a.bind("change",function(){i.onChangeHandler()}),r.showTime&&n.bind("change",function(e,t){i.updatingTime?delete i.updatingTime:i.onChangeHandler(t)})},onChangeHandler:function(){},getDisplayValue:function(e){var t,i=this.properties;if(!i.displayValue&&e){var r=bizagi.util.dateFormatter.getDateFromInvariant(e,i.showTime),a=bizagi.localization.getResource("datePickerRegional");t=bizagi.util.dateFormatter.formatDate(r,i.fullFormat,a)}else t="";return i.displayValue||t||""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(i))if(bizagi.util.isEmpty(r))""===r&&(e[t.xpath]="");else{var a=bizagi.util.dateFormatter.getDateFromInvariant(r,t.showTime);void 0!==a&&0!==a&&(t.showTime||a.setHours(0,0,0,0),e[t.xpath]=bizagi.util.dateFormatter.formatInvariant(a,!0))}},getDateControl:function(){},getTimeControl:function(){},isValid:function(e){var t,i=this,r=i.properties,a=this._super(e),n=i.getValue();if(n&&(!0===bizagi.util.parseBoolean(r.editable)&&0!=(n=bizagi.util.dateFormatter.getDateFromInvariant(n,r.showTime)))){if(n.setSeconds(0),n.setMilliseconds(0),r.minValue&&("string"==typeof r.minValue||"number"==typeof r.minValue)){var o="string"==typeof r.minValue?bizagi.util.dateFormatter.getDateFromInvariant(r.minValue,r.showTime):new Date(r.minValue);o.setSeconds(0),o.setMilliseconds(0),n<o&&(t=this.getResource("render-date-minimum-validation").replaceAll("#label#",r.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(o,r.fullFormat)),e.push({xpath:r.xpath,message:t}),a=!1)}if(r.maxValue&&("string"==typeof r.maxValue||"number"==typeof r.maxValue)){var s="string"==typeof r.maxValue?bizagi.util.dateFormatter.getDateFromInvariant(r.maxValue,r.showTime):new Date(r.maxValue);s.setSeconds(0),s.setMilliseconds(0),n>s&&(t=this.getResource("render-date-maximum-validation").replaceAll("#label#",r.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(s,r.fullFormat)),e.push({xpath:r.xpath,message:t}),a=!1)}}if(r.showTime&&!0===bizagi.util.parseBoolean(r.editable)&&r.required&&i.hasValue()){var l=i.getDateControl(),d=i.getTimeControl();if(l.length>0&&d.length>0&&l.val().length>0&&0==d.val().length)return t=i.getResource("render-required-text").replaceAll("#label#",r.displayName),e.push({xpath:r.xpath,message:t}),!1}return a}}),bizagi.rendering.render.extend("bizagi.rendering.extendedText",{},{initializeData:function(e){this._super(e);var t=this.properties;t.regularExpressionExpression&&(t.regularExpression={expression:t.regularExpressionExpression,message:t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message")})},renderControl:function(){var e=this.renderFactory.getTemplate("extendedText");return $.fasttmpl(e,{isEmptyField:void 0===this.properties.value})},postRender:function(){var e=this;e._super();var t=e.getControl(),i=e.properties;e.textarea=t.find("textarea"),e.textarea?e.textarea.css({resize:"both"}):e.textarea.css({resize:"none"}),"double"==i.retype&&e.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.maxLength&&e.textarea.prop("maxlength",t.maxLength),t.maxLines?e.textarea.prop("rows",t.maxLines):e.textarea.prop("rows",6),e.textarea.bind("change",function(){e.getValue();e.setValue(e.textarea.val());var i=[];if("duplicate"!=t.retype)if(e.isValid(i)||void 0===t.regularExpression)e.setValue(e.textarea.val(),!0);else{var r=i[0].message;bizagi.showMessageBox(r,"Bizagi","error")}}),e.textarea.bind("blur",function(){e.setValue(e.textarea.val())})},isValid:function(e){var t,i=this,r=i.properties,a=this._super(e),n=i.getValue(),o=bizagi.util.isOfflineForm({context:i});return r.regularExpression?(o&&bizagi.util.isTabletDevice()&&(n="object"==typeof n&&n.value?n.value:n),n&&(n.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!n.match(new RegExp(r.regularExpression.expression))&&i.properties&&"userName"===i.properties.xpath)?(t=r.regularExpression.message,e.push({xpath:r.xpath,message:t}),a=!1):!n||!n.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))&&n.match(new RegExp(r.regularExpression.expression))||(t=r.regularExpression.message,e.push({xpath:r.xpath,message:t}),a=!1)):n&&n.match(new RegExp(".*?eval\\(","g"))&&n.match(new RegExp(".*?eval\\u0028","g"))&&r.editable&&(t=this.getResource("render-text-regular-expression-default-message"),e.push({xpath:r.xpath,message:t}),a=!1),a},setDisplayValue:function(e){var t=this.getControl(),i=this.getDisplayValue(),r=bizagi.util.decodeURI(e),a=bizagi.util.decodeURI(i);if(0==this.properties.editable&&"string"==typeof e){var n=a.replaceAll("&","&amp;");n=(n=(n=(n=n.replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"),t.html(n)}this.setValue(r,!1)},collectData:function(e){this.properties;this._super(e)},setValue:function(e){var t=bizagi.util.decodeURI(e);this._super(t)}}),bizagi.rendering.render.extend("bizagi.rendering.grid",{},{initializeData:function(e){var t=this;t.originalData=bizagi.clone(e.properties),this._super(e);var i,r,a=this.properties;t.initProperties(),t.columns=[],t.columnsIds=[],t.enabledChecks={},t.exclusiveChanges={},t.originalEnabledChecks=[],$.each(e.elements,function(n,o){var s=o.render.properties;if(s.groupBy&&(a.groupBy=s.xpath||"",a.allowGrouping=!bizagi.util.isEmpty(a.groupBy)),"columnLabel"===s.type&&t.spliceRowData(e.properties.data,n+1),"columnBoolean"===s.type&&s.isExclusive){s.xpath;if(e.properties.data){t.enabledChecks[s.xpath]=[];for(var l=0;l<e.properties.data.rows.length;l++){var d=e.properties.data.rows[l],c=d[n+1];c&&(t.originalEnabledChecks.push(d[0]),t.enabledChecks[s.xpath].push([d[0],c]))}}}t.properties.inlineEdit||(o.render.properties.editable=!1);var u=t.renderFactory.getColumn({type:s.type,data:o.render,parent:t,singleInstance:a.singleInstance});t.columns.push(u),t.columnsIds.push(o.render.properties.id),s.editable&&(i=!0),s.totalize&&s.totalize.operation&&(r=!0,s.totalize.format=s.totalize.format||{},s.totalize.format.bold=void 0===s.totalize.format.bold||s.totalize.format.bold)}),"rtl"==a.orientation&&(t.columns=t.columns.reverse()),a.inlineEdit&&!i&&(a.inlineEdit=!1,a.allowEdit=!1),r&&(a.showSummary=!0,a.rowsPerPage=0)},initProperties:function(){var e=this,t=e.getFormContainer(),i=e.properties;i.editable=bizagi.util.parseBoolean(i.editable)||!1,i.allowEdit=null==bizagi.util.parseBoolean(i.allowEdit)||bizagi.util.parseBoolean(i.allowEdit),i.inlineEdit=null==bizagi.util.parseBoolean(i.inlineEdit)||bizagi.util.parseBoolean(i.inlineEdit),i.withEditForm=null!=bizagi.util.parseBoolean(i.withEditForm)&&bizagi.util.parseBoolean(i.withEditForm),i.allowAdd=null==bizagi.util.parseBoolean(i.allowAdd)||bizagi.util.parseBoolean(i.allowAdd),i.inlineAdd=!!i.allowAdd&&(null==bizagi.util.parseBoolean(i.inlineAdd)||bizagi.util.parseBoolean(i.inlineAdd)),i.allowDelete=null==bizagi.util.parseBoolean(i.allowDelete)||bizagi.util.parseBoolean(i.allowDelete),i.allowDetail=null!=bizagi.util.parseBoolean(i.allowDetail)&&bizagi.util.parseBoolean(i.allowDetail),i.keyColumn="",i.data=i.data||null,i.displayType="value",i.skipInitialLoad=i.skipInitialLoad||!1,i.allowMore=bizagi.util.parseBoolean(i.allowMore)||!1,i.allowFilter=bizagi.util.parseBoolean(i.allowFilter)||!1,i.allowGrouping=!1,i.groupBy="",i.groupSummary=i.groupSummary||null,i.groupText=this.getResource("render-grid-group-text"),i.groupCollapsed=bizagi.util.parseBoolean(i.groupCollapsed)||!1,i.groupOrder=i.groupOrder||"asc",i.formShowMode=bizagi.util.parseBoolean(i.formShowMode)||"popup",i.floatingHeader=bizagi.util.parseBoolean(i.floatingHeader)||!1,i.sortBy=i.sortBy?i.sortBy:i.data&&i.data.sort?i.data.sort:i.keyColumn,i.sortOrder=void 0!==i.sortOrder&&null!==i.sortOrder?"True"===i.sortOrder?"asc":"desc":i.data&&i.data.order?i.data.order:"asc",i.sort=i.sortBy+" "+i.sortOrder,i.rowsPerPage=i.allowGrouping?1e3:i.rowsPerPage||20,i.page=1,i.records=0,i.totalPages=0,i.addLabel=i.addLabel||this.getResource("render-grid-add-label")+i.displayName,i.editLabel=i.editLabel||$.trim(this.getResource("render-grid-edit-label"))+" "+i.displayName,i.deleteLabel=i.deleteLabel||this.getResource("render-ecm-confirm-bt-delete")+" "+i.displayName,i.exportOptionsLabel=i.exportOptionsLabel||this.getResource("render-grid-export-options-label")+i.displayName,i.detailLabel=i.detailLabel||this.getResource("render-collection-navigator-details-form"),i.tableCssClass=i.cssClass||"",i.alreadySaved=!1,"entity"!=i.contexttype&&(i.contexttype="function"==typeof e.parent.getContextType?e.parent.getContextType():"");try{(e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable||!i.editable)&&(i.allowAdd=!1,i.allowEdit=!1,i.allowDelete=!1,i.inlineEdit=!1,i.inlineAdd=!1,i.editable=!1)}catch(e){}i.allowEdit&&(i.inlineEdit||i.withEditForm)||(i.editable=!1),i.labelWidth=0,i.valueWidth="100%",i.overrideGetRemoteData=i.overrideGetRemoteData||void 0,i.singleInstance=!!bizagi.util.isEmpty(i.singleInstance)||i.singleInstance,i.contextType=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:null,e.changes={},e.cellOverrides={},e.isRTL()&&null!=i.data&&(i.data.rows=e.changeOrderData(i.data.rows))},hasValue:function(){return this.properties.data&&this.properties.data.rows.length>0},isRTL:function(){var e=this.properties;return!e||"string"==typeof e.orientation&&"RTL"==e.orientation.toUpperCase()},changeOrderData:function(e){var t,i=[],r=e||[];return $.each(r,function(e,a){t=a.shift(),(i=a.reverse()).unshift(t),r[e]=i}),r},removeRemainingColumns:function(e,t){var i=e||[],r=0;return i.length>0&&(r=i[0].length-t-1),r>0&&$.each(i,function(e,t){for(var i=0;i<r;i++)t.pop()}),i},getColumn:function(e){var t=null;return $.each(this.columns,function(i,r){r.properties.xpath!=e&&r.properties.id!=e||(t=r)}),t},getColumnType:function(e){var t=this.columnsIds.indexOf(e);return-1!=t?this.columns[t].properties.type:null},renderControl:function(){var e=this,t=this.properties,i=new $.Deferred;"execution"!=e.getMode()&&(t.data=e.getDummyData());var r=e.getGridTemplate(),a=e.applyTemplate(r),n=[];return $.each(e.columns,function(e,t){var i=t.initialize();i&&n.push(i)}),jQuery.when.apply($,n).done(function(){i.resolve(a)}),i.promise()},postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block")},getGridTemplate:function(){return this.renderFactory.getTemplate("grid")},applyTemplate:function(e){var t=this.properties;return orientation=this.properties.orientation,$.fasttmpl(e,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),allowAdd:t.allowAdd,addLabel:t.addLabel})},renderReadOnly:function(){this.properties;return this.renderControl()},getRemoteData:function(e){var t=this,i=t.properties;return e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sortBy,order:i.sortType,page:i.page,rows:i.rowsPerPage,searchFilter:i.searchFilter,orientation:i.orientation||"ltr"}),i.overrideGetRemoteData?i.overrideGetRemoteData(e):t.dataService.multiaction().getGridData(e).then(function(e){return t.originalData=t.originalData||{},t.originalData.data=bizagi.clone(e),i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,e})},spliceRowData:function(e,t){"execution"==this.getMode()&&e&&e.rows&&$.each(e.rows,function(i,r){var a=t||e.rows[i].length;e.rows[i].splice(a,0,"")})},spliceRowDataVisible:function(e,t){"execution"==this.getMode()&&e&&e.visible&&$.each(e.visible,function(i,r){var a=t||e.visible[i].length;e.visible[i].splice(a,0,!0)})},spliceRowDataEditable:function(e,t){"execution"==this.getMode()&&e&&e.editable&&$.each(e.editable,function(i,r){var a=t||e.editable[i].length;e.editable[i].splice(a,0,!0)})},getDummyData:function(){var e=this.properties;if(e.data)return e.data;for(var t=["1"],i=0;i<this.columns.length;i++)t.push("");return{page:1,total:1,records:1,rows:[t]}},submitEditRequest:function(e){var t=this.properties,i=t.xpath+this.buildCellXpathFilter(e);return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType})},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=null;t.deferreds&&(a=$.when.apply($,t.deferreds),delete t.deferreds);var n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+i.buildCellXpathFilter(e):r.xpath+i.buildCellXpathFilter(e);return $.when(a).pipe(function(){return i.startLoading(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,submitData:t,contexttype:r.contextType,disableServerGridValidations:t.disableServerGridValidations||!1}).pipe(function(e){return i.endLoading(),e}).fail(function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)})})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+t.buildCellXpathFilter(e);return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType}).pipe(function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e})},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache}).pipe(function(e){return e.idEntity}).promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e?e.idPageCache:t.idPageCache,contexttype:this.properties.contexttype||""})},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,r=e.value,a=void 0===e.trigger||e.trigger,n=e.pressed||!1;this.changes[t]=this.changes[t]||{},this.changes[t][i]=r,a&&this.triggerRenderChange({key:t,column:i,pressed:n})},configureColumnSubmitOnChange:function(e){var t=this,i=t.properties,r={commands:[{xpath:i.xpath,command:"submit-value",argument:"all"}],conditions:{operator:"and",expressions:[{simple:{operator:"cell-change",xpath:i.xpath+"[]."+e,argumentType:"text",argument:e}}]},dependencies:[i.xpath]};$.when(t.ready()).done(function(){t.getFormContainer().addSubmitAction(e,r)})},collectData:function(e){var t=this,i=t.properties,r=[];for(var a in t.changes){if("summary"!=a)for(var n in t.changes[a])if(t.canColumnBeSent(a,n)){var o=i.xpath+t.buildCellXpathFilter(a)+"."+n,s=(i.xpath,t.buildCellXpathFilter(a),n.substr(n.lastIndexOf(".")+1,n.length),t.changes[a][n]);e[o]=s}r.push(a)}if(t.exclusiveChanges)for(var a in t.exclusiveChanges){var l=t.exclusiveChanges[a],d=t.enabledChecks[a];if(l&&d){for(var c=0;c<d.length;c++){e[i.xpath+t.buildCellXpathFilter(d[c][0])+"."+a]=!1}e[i.xpath+t.buildCellXpathFilter(l.key)+"."+l.xpath]=l.value}}$.each(r,function(e,i){delete t.changes[i]})},hasChanged:function(e){return!$.isEmptyObject(this.changes)&&(e.push(!0),!0)},canColumnBeSent:function(e,t){var i,r;for(i in this.columns)if(this.columns.hasOwnProperty(i)){var a=this.columns[i];if("columnUserfield"!==a.properties.type){if(a.properties.xpath==t){var n=this.getCellOverride(e,a.columnIndex-1);return a.canBeSent(e,n)}}else for(r in a.properties)if(a.properties.hasOwnProperty(r)&&"[object String]"===Object.prototype.toString.apply(a.properties[r])&&a.properties[r].substr(a.properties[r].lastIndexOf(".")+1)===t)return!0}return!1},canBeSent:function(){var e=this.properties;return!(bizagi.util.parseBoolean(e.displayOnly)||!1||!e.inlineEdit&&!e.inlineAdd&&$.isEmptyObject(this.changes))},getCellValue:function(e,t){for(var i=this.properties.data.rows,r=0;r<i.length;r++)if(i[r][0]==e)for(var a=0;a<this.columns.length;a++){if(this.columns[a].properties.xpath==t)return i[r][a+1]}return null},getCellCurrentValue:function(e,t){var i=this.getControlCell(e,t);return i&&"function"==typeof i.getValue?i.getValue():null},getControlCell:function(e,t){var i=this,r=null;if(void 0!==i.columns)for(var a=0;a<i.columns.length;a++)if(i.columns[a].properties.xpath==t||i.columns[a].properties.id==t){r=i.columns[a].getDecorated(e);break}return r},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required")),this.triggerRenderValidate()},refresh:function(){},setError:function(e,t){},changeCellBackgroundColor:function(e,t,i){},changeCellColor:function(e,t,i){},changeCellVisibility:function(e,t,i){},changeCellEditability:function(e,t,i){},changeCellRequired:function(e,t,i){},changeCellProperties:function(e,t,i){},changeCellMaxValue:function(e,t,i){},changeCellMinValue:function(e,t,i){},cleanCellData:function(e,t){},changeEditability:function(e){var t=this,i=(t.properties,t.getControl());t.saveGrid().done(function(){var r={properties:$.extend({editable:bizagi.util.parseBoolean(e)},t.originalData)};i.empty(),bizagi.rendering.render.prototype.initializeData.apply(t,[r]),t.initProperties(),t.changeColumnsEditability(e),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done(function(e){i.append(e),t.postRenderElement(t.element)})})},saveGrid:function(){var e=$.Deferred(),t=$("[data-bizagi-component=rows]",this.element).find("[data-new-row=true]");return t.length>0?(t=$.map(t,function(e,t){return $(e).data("business-key")}),this.saveInlineAddedRows(t).done(function(){e.resolve()})):e.resolve(),e.promise()},changeColumnsEditability:function(e){var t=this.columns||[];$.each(t,function(t,i){i.properties.editable=e})},refreshCell:function(e){var t=this,i=t.properties,r=e.key,a=e.column,n=""!==e.xpathContext?e.xpathContext+"."+t.properties.xpath+t.buildCellXpathFilter(r):t.properties.xpath+t.buildCellXpathFilter(r),o=t.getControlCell(r,e.column),s=t.getFormContainer().properties.id;if(o)return o.beforeToRefresh(),$.when(t.dataService.multiaction().refreshGridCell({idRender:i.id,column:o.properties.id,idPageCache:i.idPageCache,xpathContext:n,idForm:s,typeRender:o.properties.type})).done(function(e){var i=function(e){return e&&"object"==typeof e&&e.length>=1?e[0].length>=1?e[0][0]:e[0]:""},n=i(e.rows),s=i(e.editable);bizagi.util.isBoolean(s)||(s=!0),s=!(!s||void 0===o.column||void 0===o.column.properties||!o.column.properties.editable);var l=i(e.visible)||!0;t.changeCellVisibility(r,a,l),t.changeCellEditability(r,a,s),o.setValue(n),o.setDisplayValue(n),t.triggerRenderChange({key:r,column:a,changed:!1}),null!=o.column&&"desktop"==bizagi.util.detectDevice()&&t.updateAffectedCellManually(r,n,o.column.columnIndex),o.afterToRefresh()})},triggerRenderChange:function(e){e=e||{},bizagi.util.isEmpty(e)||0==e.changed||(this.properties.canBeExported=!1),this.triggerHandler("renderchange",{render:this,surrogateKey:e.key,column:e.column,changed:e.changed,rowDeleted:e.rowDeleted,pressed:e.pressed})},validate:function(){this.isValid([])},isValid:function(e){var t=this,i=!0;if(t.hasErrors=!1,t.setValidationMessage(""),t.properties.data&&t.properties.data.rows){var r=t.getDataNewRows();0==r.length&&bizagi.util.parseBoolean(t.properties.required)&&(t.hasValue()||(message=t.getResource("render-required-text").replaceAll("#label#",t.properties.displayName),e.push({xpath:t.properties.xpath,message:message}),i=!1));for(var a=$.merge($.merge([],t.properties.data.rows),r),n=0;n<t.columns.length;n++){for(var o=[],s={},l=0;l<a.length;l++){var d=a[l][n+1],c=a[l][0];t.columns[n].properties.xpath;void 0!==t.changes[c]&&void 0!==t.changes[c][t.columns[n].properties.xpath]&&(d=t.changes[c][t.columns[n].properties.xpath]),t.columns[n].isValueValid(c,d,o,t.getCellOverride(c,n))||(i=!1,t.hasErrors=!0,t.setError(c,t.columns[n].properties.xpath))}for(var u=0,p=o.length;u<p;u++)null==s[o[u]]&&(s[o[u]]=o[u]);if(o.length>0){var g=t.getResource("render-grid-validation").replaceAll("#grid#",t.properties.displayName);for(c in s)e.push({xpath:t.properties.xpath,message:g+" "+c})}}}return i},configureSubmitOnChange:function(){},getCellOverride:function(e,t){var i=this;e=Number(e),t=Number(t);var r=i.columns[t].properties;return i.cellOverrides[e]||(i.cellOverrides[e]={}),i.cellOverrides[e][t]||(i.cellOverrides[e][t]={visible:r.visible,editable:r.editable,required:r.required}),i.cellOverrides[e][t]},setCellOverrides:function(e,t){var i;if(e.visible)for(var r=0,a=e.visible.length;r<a;r++){i=e.visible[r][0];for(var n=0,o=e.visible[r].length;n<o;n++)n>0&&(this.getCellOverride(i,n-1).visible=bizagi.util.parseBoolean(e.visible[r][n]))}if(e.editable)for(r=0,a=e.editable.length;r<a;r++){i=e.editable[r][0];for(n=0,o=e.editable[r].length;n<o;n++)if(n>0){var s=!t||bizagi.util.parseBoolean(t[n-1].properties.editable);this.getCellOverride(i,n-1).editable=!!s&&bizagi.util.parseBoolean(e.editable[r][n])}}if(e.required)for(r=0,a=e.required.length;r<a;r++){i=e.required[r][0];for(n=0,o=e.required[r].length;n<o;n++)n>0&&(this.getCellOverride(i,n-1).required=bizagi.util.parseBoolean(e.required[r][n]))}},getIndexes:function(){var e=$.merge(this.properties.data.rows,this.getDataNewRows());return $.map(e,function(e,t){return e[0]})},getDataNewRows:function(){var e=this,t=[];return"object"!=typeof e.newRecords||$.isEmptyObject(e.newRecords)||$.each(e.newRecords,function(i){var r=[];r.push(Number(i));for(var a=0,n=e.columns.length;a<n;a++)r.push(e.getCellCurrentValue(i,e.columns[a].properties.xpath));t.push(r)}),t},getGridExportUrl:function(e){var t=this.properties;return this.dataService.getGridExportUrl({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e.disposition,exportType:e.exportType,sort:t.sort,sessionId:this.getSessionId(),idForm:this.getFormContainer().properties.id})},submitForGridChange:function(){return this.submitOnChange(null,!1)},dispose:function(){var e=this;setTimeout(function(){e.columns&&$.each(e.columns,function(e,t){t.dispose()})},bizagi.override.disposeTime||50),e._super()},getEnabledChecks:function(e){var t=this,i=t.properties;e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,rows:i.rowsPerPage,xpathfilter:e.xpath});var r=new $.Deferred;return t.dataService.multiaction().getGridDataExclusivesSelected(e).done(function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),r.resolve(e)}),r.promise()},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},cleanNewRecords:function(){this.newRecords={}},changeBackgroundColor:function(e){this._super(e);var t=this.getControl();t.find(".bz-rn-grid-header-title").css("background-color",e,"!important"),t.find(".bz-rn-grid-container-foother").css("background-color",e,"!important")}}),bizagi.rendering.render.extend("bizagi.rendering.hidden",{},{renderControl:function(){return"design"===this.getMode()?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"</div>":"<div />"},postRender:function(){var e=this.properties;this._super(),void 0!==e.value&&this.setDisplayValue(e.value)}}),bizagi.rendering.render.extend("bizagi.rendering.label",{},{initializeData:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.labelAlign=this.originalProperties.labelAlign||"left",this.properties.displayName=e.properties.displayName||"",bizagi.util.parseBoolean(this.properties.allowDinamiclabel)&&(this.properties.displayName=e.properties.displayName||bizagi.localization.getResource("render-label-default-display-name")),this.bindingValue(),this.calculateInitialLayoutProperties()},postRender:function(){var e=this,t=e.properties;e._super(),e.changeDisplayOption("label"),e.changeLabelAlign(t.labelAlign||"left"),"function"==typeof e.configureHelpText&&e.configureHelpText()},postRenderReadOnly:function(){var e=this.properties;this._super(),this.changeDisplayOption("label"),this.changeLabelAlign(e.labelAlign||"left")},isValid:function(e){},getDefaultLabelAlign:function(e){return"left"},canBeSent:function(){return!1},bindingValue:function(){var e=this;e.properties.allowDinamiclabel&&e.properties.value&&("object"==typeof e.properties.value&&e.properties.value[0]?e.properties.displayName=e.properties.value[0].value:"string"==typeof e.properties.value&&""!==e.properties.value&&(e.properties.displayName=e.properties.value))}}),bizagi.rendering.render.extend("bizagi.rendering.search",{},{initializeData:function(e){this._super(e);var t=this.properties;t.searchForms=t.searchForms||[],t.maxRecords=Number(t.maxRecords)||20,t.advancedSearch=null!==bizagi.util.parseBoolean(t.advancedSearch)&&bizagi.util.parseBoolean(t.advancedSearch),t.allowSuggest=null!==bizagi.util.parseBoolean(t.allowSuggest)&&bizagi.util.parseBoolean(t.allowSuggest),t.allowFullSearch=t.allowFullSearch||!1,t.allowAdd=bizagi.util.parseBoolean(t.allowAdd)||!1,t.allowTyping=null!==bizagi.util.parseBoolean(t.allowTyping)&&bizagi.util.parseBoolean(t.allowTyping),t.allowTyping=!!bizagi.util.parseBoolean(t.allowSuggest)||t.allowTyping,t.allowClear=null!==bizagi.util.parseBoolean(t.allowClear)&&bizagi.util.parseBoolean(t.allowClear),t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.searchLength=t.searchLength||2,t.enableLocalStorage=!1,t.expireCache=9e5,t.advancedSearch&&"execution"===this.getMode()&&(t.submitOnChange=bizagi.util.parseBoolean(t.submitOnChange)||!1,t.submitOnChange=!((t.submitVersion||1)>1)||t.submitOnChange)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,allowTyping:e.allowTyping,advancedSearch:e.advancedSearch})},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getFormContainer(),n=a.getContextType()||a.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:n&&(e.h_contexttype=n),e.h_contexttype=t.properties.enableQuerySuggestBehavior?"metadata":e.h_contexttype,e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:e.h_contexttype,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done(function(e){i.data=e,r.resolve(i.data)}).fail(function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)}),r.promise(r)},setValue:function(e,t){t=void 0===t||t,this._super(e,t),null!=e?(this.value=e,this.selectedValue=e.label):(this.value=null,this.selectedValue=null)},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(i)&&null!=r){if("object"==typeof r&&void 0===r.id)return;e[t.xpath]=r}},submitData:function(){var e=this.properties,t={};this.grid||(t[e.xpath]=this.getValue()),this.submitOnChange(t,void 0,!1)},isValid:function(e){return this._super(e)},formatItem:function(e){return bizagi.util.formatItem(e)}}),bizagi.rendering.render.extend("bizagi.rendering.text",{},{initializeData:function(e){this._super(e);var t=this.properties;t.regularExpressionExpression&&(t.regularExpression={expression:t.regularExpressionExpression,message:t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message")})},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("text");return $.fasttmpl(t,{value:"",isEmptyField:void 0===e.value})},renderReadOnly:function(){this.properties;var e=this.renderFactory.getTemplate("text-read-only");return $.fasttmpl(e,{value:this.getValue()})},postRender:function(){var e=this,t=e.getControl(),i=e.properties;e._super(),e.input=t.find("input"),"double"==i.retype&&e.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;e.getControl(),e.input;t.mask&&e.input.mask({mask:t.mask}),e.input.bind("change",function(){e.getValue();e.setValue(e.input.val(),!1);var i=[];"duplicate"!=t.retype&&(e.isValid(i)||void 0===t.regularExpression?e.setValue(e.input.val(),!0):message=i[0].message)}).keypress(function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")})},isValid:function(e){var t=this.properties,i=this._super(e),r=this.getValue();if("string"==typeof r)if(t.regularExpression){var a=new RegExp("");try{a=new RegExp(t.regularExpression.expression)}catch(r){bizagi.override.showDesignValidations&&(bizagi.log(r),e.push({xpath:t.xpath,message:r.message}),i=!1)}if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a)&&this.properties&&"userName"===this.properties.xpath)){var n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}else if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a))){n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}}else if(r&&r.match(new RegExp(".*?eval\\(","g"))&&r.match(new RegExp(".*?eval\\u0028","g"))&&t.editable){n=this.getResource("render-text-regular-expression-default-message");e.push({xpath:t.xpath,message:n}),i=!1}return i},setDisplayValue:function(e){var t=this.getControl(),i=this.getDisplayValue(),r=bizagi.util.decodeURI(e),a=bizagi.util.decodeURI(i);if(!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var n=a.replaceAll("&","&amp;");n=(n=(n=(n=n.replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"),t.html("<label class='readonly-control'>"+n+"</label>")}else bizagi.util.isNull(e)&&t.html("");this.setValue(r,!1)},setValue:function(e){this._super(e)}}),bizagi.rendering.render.extend("bizagi.rendering.button",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption||"",t.displayType="value",t.required=!1,t.preventDefault=t.preventDefault||!1},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("button");return $.fasttmpl(t,{caption:e.caption,cssClass:e.cssclass||""})},renderReadOnly:function(){return this.renderControl()},saveForm:function(){return this.getFormContainer().saveForm()},executeButton:function(){var e=this,t=e.properties,i=t.xpathContext||"";return t.submitOnChangexpathContextRow&&(i=i?i+"."+t.submitOnChangexpathContextRow:t.submitOnChangexpathContextRow),e.getFormContainer().startLoading(),e.dataService.multiaction().executeButton({idRender:t.id,xpath:t.xpath||"",xpathContext:i||"",idPageCache:t.idPageCache}).always(function(){return e.getFormContainer().endLoading(),arguments?arguments[0]:void 0})},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},processButton:function(){var e=this;e.properties.editable&&(e.getFormContainer().clearValidationMessages(),e.saveForm().pipe(function(){return e.executeButton()}).done(function(t){if(null==t||1==t||"success"==t.result||"success"==t.type)return e.refreshForm();"validationMessages"==t.type&&e.getFormContainer().addValidationMessage(t.messages)}).fail(function(t,i,r){e.getFormContainer().addErrorMessage(r)}))},triggerRenderChange:function(e){var t=(e=e||{}).pressed||!1;this.triggerHandler("renderchange",{render:this,pressed:t})},canBeSent:function(){return!1}}),bizagi.rendering.render.extend("bizagi.rendering.fileprint",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption&&" "!=t.caption?t.caption:"render-fileprint-property-caption",t.displayType="value",this.calculateInitialLayoutProperties(),t.required=!1},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("fileprint");return $.fasttmpl(t,{caption:e.caption})},renderReadOnly:function(){return this.renderControl()},getFilePrintUrl:function(e){var t=this.properties;return this.dataService.getFilePrintUrl({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e,sessionId:this.getSessionId()})},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},saveForm:function(){return this.getFormContainer().saveForm()}}),bizagi.rendering.render.extend("bizagi.rendering.link",{},{initializeData:function(e){this._super(e),this.properties.displayType="value",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("link");return $.fasttmpl(t,{displayName:e.displayName,align:e.valueAlign})},renderReadOnly:function(){return this.renderControl()},isValid:function(e){},setDisplayValue:function(e){},canBeSent:function(){return!1}}),bizagi.rendering.render.extend("bizagi.rendering.checkList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,this.setValue(t.items),this.updateOriginalValue()},postRender:function(){var e=this.getControl();this._super(),this.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",e)},renderControl:function(){return this.renderCheckList()},renderCheckList:function(e){var t=this.properties,i=this.renderFactory.getTemplate(this.getTemplateName()),r=this.properties.items||[];return $.fasttmpl(i,$.extend(this.getTemplateParams(),{id:t.id,xpath:t.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:t.idPageCache,items:r}))},getTemplateName:function(){return"checkList"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){return{vertical:!this.properties.horizontal}},cleanData:function(){},setValue:function(e){this.value=bizagi.clone(e)},getValue:function(e){return this.value||[]}}),bizagi.rendering.render.extend("bizagi.rendering.layoutRender",{},{renderElement:function(e){var t=this,i=t.properties,r=t.getFormContainer();t.renderingDeferred=new $.Deferred,e=e||"render-layout";var a=t.renderFactory.getTemplate(e),n=i.displayName;"string"==typeof n&&(n=(n=(n=(n=(n=(n=n.replaceAll("&","&amp;")).replaceAll("$","&#36;")).replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"));parseFloat(i.labelWidth);var o=$.fasttmpl(a,{label:n,isExtendedText:"text"==i.type&&i.isExtended,orientation:i.orientation,uniqueId:i.uniqueId,id:i.id,isDesign:"design"===t.getMode(),messageValidation:i.messageValidation,printVersion:r.params.printversion,cssClass:i.cssclass||"",hide:i.hide}),s=t.internalRenderControl();return s||(s=""),"object"==typeof s&&s.done?"resolved"===s.state()?(o=t.replaceControlHtml(o,t.resolveResult(s)),t.asyncRenderDeferred=null):(t.asyncRenderDeferred=s,o=t.replaceControlHtml(o,"")):o=t.replaceControlHtml(o,s),o},getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=this.element),this.control&&0!=this.control.length?this.control:null},changeFontItalic:function(e){bizagi.util.parseBoolean(e)?this.getControl().css("font-style","italic","!important"):this.getControl().css("font-style","normal","!important")},changeFontUnderline:function(e){var t=this.properties.valueFormat||{},i=bizagi.util.parseBoolean(t.strikethru)?"line-through ":"";bizagi.util.parseBoolean(e)?this.getControl().css("text-decoration",i+"underline","!important"):this.getControl().find("*").each(function(e,t){$(t).css("text-decoration",i,"!important")})}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutImage",{},{init:function(e){this._super(e)},renderControl:function(){this.getMode(),this.properties.value;var e=this.renderFactory.getTemplate("layout-image");return $.fasttmpl(e,{useDefaultImage:!0})},getImage64:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey,width:96,height:96};return this.dataService.getEntityImage64(e)},getImageUri:function(){var e={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(e)}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutLink",{},{init:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("layout-link");return $.fasttmpl(e,{displayName:this.properties.displayName})}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutLabel",{},{init:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.labelAlign=this.originalProperties.labelAlign||"left",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("layout-label"),t=this.properties.displayName||this.properties.value||"";return $.fasttmpl(e,{value:t})}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutText",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-text");return $.fasttmpl(e,{value:this.properties.value,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutUpload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.editable=!0,i.allowDelete=!0,i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1},getValueFilesByData:function(e){var t,i,r=$.Deferred();t=e.value.value?e.value.value:e.value;try{this.isContextContainerWidgetRender()?(i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)):$.when(this.getDataFilesWithoutScope()).done(function(t){i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)})}catch(t){i=JSON.parse('{ "files": []}'),r.resolve(e,i),console.warn("Exception converting data files. Error: ",t)}return r.promise()},isContextContainerWidgetRender:function(){var e=this.getFormContainer();return e.params.paramsRender&&e.params.paramsRender.idRender},getDataFilesWithoutScope:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey};return this.dataService.getFilesDataForLayoutUploadControl(e)},getValue:function(){return this.files},getUploadXpath:function(){return this.properties.xpath}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutBoolean",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e),this.properties.editable=!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-boolean");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},setValue:function(e,t){null===e||""===e?this.properties.value="":"true"!==e.toString().toLowerCase()&&"false"!==e.toString().toLowerCase()||(this.properties.value=bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):this.getResource("render-boolean-no")),this._super(this.properties.value,t)}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutDateTime",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");if(t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.showTime)-1===t.fullFormat.search(/[h|H]+/gi)&&(t.fullFormat=t.fullFormat+" "+t.timeFormat);else{var a=t.fullFormat.search(/[h|H]+/gi);-1!==a&&(t.fullFormat=t.fullFormat.substring(0,a-1))}if(t.value){var n=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime);if(0!=n){var o=bizagi.localization.getResource("datePickerRegional");this.value=t.value,t.displayValue=bizagi.util.dateFormatter.formatDate(n,t.fullFormat,o)}else this.value=null}else this.value=null,t.value="",t.displayValue=""},renderControl:function(){var e=this.renderFactory.getTemplate("layout-date-time"),t=null===this.properties.value||""===this.properties.value?"":this.properties.value;return $.fasttmpl(e,{value:t})},setDisplayValue:function(e){var t,i=this.properties,r=this.getDateControl(),a="MM/dd/yyyy H:mm:ss";if(this.i18n=bizagi.localization.getResource("datePickerRegional"),e.length==a.length||e.length==a.length+1?t=bizagi.util.dateFormatter.getDateFromInvariant(e,!0):!(t=bizagi.util.dateFormatter.getDateFromInvariant(e))||isNaN(Date.parse(t))||$.isNumeric(t)||t.setHours(0,0,0,0),e&&!isNaN(Date.parse(e))){var n=bizagi.util.dateFormatter.formatDate(t,i.fullFormat,this.i18n);r.text(n)}},getDateControl:function(){return this.dateControl=$(".ui-bizagi-render-date-time",this.getControl()),this.dateControl}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutNumber",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.getDefaultGroupDigits(t.dataType),t.colorize=t.colorizeOnNegative||!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-number");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},getDisplayValue:function(e){var t=this.properties,i=(this.getControl(),$("<label/>").html(e));return e.toString().match(/[\u20AC \u0024\u00A3]/)||i.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),i.text()},getDefaultAllowDecimals:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1}}),bizagi.rendering.layoutNumber.extend("bizagi.rendering.layoutMoney",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol?t.symbol=t.currencySymbol?t.currencySymbol:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:t.symbol="",t.groupDigits=!0}}),bizagi.rendering.layoutRender.extend("bizagi.rendering.layoutPlaceholder",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-placeholder"),t=this.properties.value||this.properties.displayName||"";return $.fasttmpl(e,{value:t})}}),bizagi.rendering.render.extend("bizagi.rendering.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;if(i.maxSize=Number(i.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):i.maxSize=Number(i.maxSize)||4091904),i.maxfiles=Number(i.maxfiles)||999,i.validExtensions=i.validExtensions||"",i.validExtensions.length>0&&i.validExtensions.indexOf(".")<0){for(var r=i.validExtensions.replace(/\ /gi,"").split(";"),a=[],n=0;n<r.length;n++)if(r[n].length>0)a.push("*."+r[n]);else{r.indexOf(r[n]);r.splice(n,1)}i.validExtensions=a.join(";")}i.addUrl=i.addUrl||this.dataService.getUploadAddUrl(),i.deleteUrl=i.deleteUrl||void 0,i.editable=bizagi.util.parseBoolean(i.editable)||!1,i.allowDelete=!(null===bizagi.util.parseBoolean(i.allowDelete)||!i.editable)&&bizagi.util.parseBoolean(i.allowDelete),i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1,this.files=i.value||[],this.filesCount=this.files.length},renderControl:function(){for(var e=this.properties,t=this.renderFactory.getTemplate("upload"),i=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:e.editable,noFiles:0==this.filesCount,allowSendInMail:e.allowSendInMail}),r="",a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(n)}return i=this.replaceFilesHtml(i,r)},renderReadOnly:function(){return this.renderControl()},renderUploadItem:function(e){var t=this.properties,i=this.getMode(),r=this.renderFactory.getTemplate("uploadItem"),a=this.buildItemUrl(e);return"execution"!=i&&(a="javascript:void(0);"),$.fasttmpl(r,{url:a,allowDelete:t.allowDelete,filename:e.fileName,id:e.id,mode:i,editable:t.editable})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},deleteUploadItem:function(e,t){var i=this,r=i.properties,a=i.getUploadXpath()+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']");return i.dataService.deleteUploadFile({url:r.deleteUrl,idRender:r.id,xpath:a,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype}).pipe(function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,function(e){return e[0]!=t})})},canBeSent:function(){return!1},setValue:function(e,t){this.files=e||[],this.filesCount=this.files.length,this._super(e,t)},getValue:function(){return this.files},isValid:function(e){var t,i=this.properties,r=!0;if(this.setValidationMessage(""),i.required&&i.editable){var a=this.grid&&this.grid.isFromCreatedRow.apply(this);if(this.filesCount<=0&&!a)(!this.grid||this.grid.properties.inlineEdit)&&(t=this.getResource("render-required-upload").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),r=!1)}return r},buildAddParams:function(){var e=this,t=e.properties,i=e.getFormContainer(),r={};r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.getUploadXpath(),r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=t.id,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=t.xpathContext,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+e.Class.BA_PAGE_CACHE]=t.idPageCache,r[e.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=i.properties.sessionId,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=t.contexttype;try{"undefined"!=typeof BIZAGI_SESSION_NAME?r[BIZAGI_SESSION_NAME]=i.properties.sessionId:r.JSESSIONID=i.properties.sessionId}catch(e){r.JSESSIONID=i.properties.sessionId}return r},getUploadXpath:function(){return this.properties.xpath},checkRequired:function(e){var t=this.properties;if(bizagi.util.parseBoolean(t.required))if(this.grid&&1==this.grid.properties.inlineAdd){if(!this.hasValue()&&!this.getControl().parents("tr").data("new-row"))return this.setRenderRequired(e,t),!1}else if(!this.hasValue())return this.setRenderRequired(e,t),!1;return!0},setRenderRequired:function(e,t){message=this.getResource("render-required-text").replaceAll("#label#",t.displayName),e.push({xpath:t.xpath,message:message})}}),bizagi.rendering.render.extend("bizagi.rendering.yesno",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("yesno"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t})},getDisplayValue:function(){var e=this.getValue();return 1==bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""}}),bizagi.rendering.render.extend("bizagi.rendering.letter",{},{initializeData:function(e){this._super(e),this.letterOpened=!1},renderControl:function(){var e=this.renderFactory.getTemplate("letter");return $.fasttmpl(e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("letter.readonly");return $.fasttmpl(e)},getLetterContent:function(){var e=this.properties;return this.letterOpened=!0,this.dataService.getLetterContent({url:e.getUrl,idRender:e.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:e.idPageCache})},saveLetterContent:function(e){var t=this.properties;return this.dataService.saveLetterContent({url:t.saveUrl,idRender:t.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,content:e})},getCanGenerateLetter:function(){var e=this.properties;return this.dataService.getCanGenerateLetter({idRender:e.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:e.idPageCache})},saveForm:function(){return this.getFormContainer().saveForm()},isValid:function(e){var t,i=this.properties;return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!i.required||0!=this.letterOpened||(t=this.getResource("render-letter-required-text").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),!1)))},getXpath:function(){return this.properties.xpath},getContextXpath:function(){return this.properties.xpathContext}}),bizagi.rendering.render.extend("bizagi.rendering.formLink",{},{initializeData:function(e){this._super(e),this.properties.displayType="value",this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("link");return $.fasttmpl(t,{id:e.id,align:e.valueAlign,displayName:e.displayName,value:e.value,likeButton:bizagi.util.parseBoolean(e.likeButton)||!1})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.configureHandlers()},submitEditRequest:function(){var e=this.properties;return 0!=e.editable||e.value?this.dataService.editLinkForm({url:e.editUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitSaveRequest:function(e){var t=this,i=t.properties;if(0==i.editable&&!i.value)return null;var r=t.getFormLinkXpath();return t.dataService.saveLinkForm({url:i.saveUrl,idRender:i.id,xpathContext:null==i.xpathContext||""==i.xpathContext?r:r?i.xpathContext+"."+r:i.xpathContext,submitData:e}).done(function(e){var i=!0;e&&"validationMessages"==e.type&&(i=!1),i&&t.submitOnChange({})})},submitRollbackRequest:function(e){var t=this.properties;return 0!=t.editable||t.value?this.dataService.rollbackLinkForm({url:t.rollbackUrl,idRender:t.id,xpath:this.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:e?e.idPageCache:t.idPageCache}):null},submitCommitRequest:function(){var e=this.properties;return 0!=e.editable||e.value?this.dataService.commitLinkForm({url:e.commitUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitCheckpointRequest:function(){var e=this.properties;return 0!=e.editable||e.value?this.dataService.sendCheckpoint({url:e.checkpointUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitDataRequest:function(){var e=this.properties;return 0!=e.editable||e.value?this.dataService.submitData({url:e.checkpointUrl,action:"SUBMITDATA",idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},isValid:function(e){},getFormLinkXpath:function(){return this.properties.xpath},canBeSent:function(){return!1},setDisplayValue:function(e){},changeColor:function(e){var t=this.getControl(),i=this.getLabel();t&&i&&("none"!=e?(this.getControl().find("a").css("color",e,"!important"),"function"==typeof this.getControl().find("a").style&&this.getControl().find("a").style("color",e,"!important")):(this.getControl().find("a").css("color",""),"function"==typeof this.getControl().find("a").style&&this.getControl().find("a").style("color",""))),this._super(e)}}),bizagi.rendering.render.extend("bizagi.rendering.document",{},{initializeData:function(e){this._super(e);var t=this.properties;t.validate=null!=bizagi.util.parseBoolean(t.validate)&&bizagi.util.parseBoolean(t.validate),t.caption?(t.caption=bizagi.util.trim(t.caption),0==t.caption.length&&(t.caption=this.getResource("render-documentgenerator-button-label"))):t.caption=this.getResource("render-documentgenerator-button-label")},renderControl:function(){var e=this;e.preRenderControl();for(var t=e.properties,i=e.getMode(),r=!t.value||0==t.value.length,a=t.downloadalldocuments=!!t.downloadalldocuments&&t.downloadalldocuments,n=void 0===t.allowGenerate||t.allowGenerate,o=e.renderFactory.getTemplate(e.getTemplate()),s="",l=t.value?t.value.length:0,d=e.getControlHtml(o,i,a,n,t,r),c=0;c<l;c++){var u={id:t.value[c][0],fileName:t.value[c][1]};s+=e.renderDocumentItem(u)}if(!r&&a){var p={fileName:e.getResource("render-document-downloadalldocuments")};s+=e.renderAllDocumentDownload(p)}return d=e.replaceFilesHtml(d,s)},getControlHtml:function(e,t,i,r,a,n){return $.fasttmpl(e,{noActivateButton:!1,editable:"execution"!=t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:!!a.append&&a.append,caption:a.caption,noFiles:n,allowSendInMail:a.allowSendInMail})},getXpath:function(e){return e},preRenderControl:function(){},activateButton:function(){return!0},getDocumentXpath:function(e){return e},getContextXpath:function(){return this.properties.xpathContext},renderDocumentItem:function(e){this.properties;var t=this.getMode(),i=this.renderFactory.getTemplate(this.getTemplateItem()),r=this.buildItemUrl(e);return"execution"!=t&&(r="javascript:void(0);"),$.fasttmpl(i,{url:r,allowDelete:this.properties.allowDelete,filename:e.fileName,mode:t,joined:!1})},buildItemUrl:function(e){var t=this.properties;this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,sessionId:this.getSessionId()})},buildAllDocumentsUrl:function(){var e=this.properties;return this.dataService.getAllDocumentsDownloadUrl({xpath:this.getDocumentXpath(e.xpath),xpathContext:this.getContextXpath(),idPageCache:e.idPageCache,idCase:e.caseId,idWorkItem:e.workitemId,sessionId:this.getSessionId()})},postRender:function(){return this._super(),"<div></div>"},postRenderReadOnly:function(){if("design"!=this.getMode()){var e=this.getControl(),t=this.renderControl();e.append(t),this.updateControlForPrintMode(e),this.postRender()}},validateContainer:function(){return this.getFormContainer().validateForm()},save:function(){return this.getFormContainer().saveForm()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},canBeSent:function(){return!1},isValid:function(e){var t,i=this.properties;return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!(i.required&&!i.buttonExecuted&&this.value)||(this.value.length>0||(t=this.getResource("render-document-required-text"),e.push({xpath:i.xpath,message:t}),!1))))},configureHandlers:function(){var e=this,t=e.getControl(),i=e.getMode();e._super();var r=$(".ui-bizagi-button-documentgenerator",t);"execution"==i&&r.click(function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),e.properties.buttonExecuted=!0,e.properties.validate)e.validateContainer()&&e.documentTemplateGenerate();else e.documentTemplateGenerate();e.properties.buttonExecuted=!1}}),$(".ui-bizagi-document-preview",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),e.showDocumentPreview($(this).data("url"),$(this).data("filename")))}),$(".ui-bizagi-container-documents-item-delete",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).data("filename")))})},deleteDocumentTemplate:function(e){var t=this,i=new Object;i.xpath=t.properties.xpath+"[fileName='"+e+"']",i.idRender=t.properties.id,i.xpathContext=t.getContextXpath(),i.idPageCache=t.properties.idPageCache,$.when(t.dataService.deleteUploadFile(i)).done(function(){$.when(t.dataService.multiaction().getPropertyData({xpath:t.properties.xpath,idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache,property:"value"})).done(function(e){t.redrawDocuments(e,!1,t.properties.downloadalldocuments),t.value=e,t.configureHandlers()})})},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),e.save().done(function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.generateDocumentTemplate(t)).done(function(){$.when(e.dataService.multiaction().getPropertyData({xpath:t.xpath,idRender:t.id,xpathContext:e.getContextXpath(),idPageCache:t.idPageCache,property:"value"})).done(function(i){e.redrawDocuments(i,!1,t.downloadalldocuments),e.value=i,e.autoOpenDocuments(),e.configureHandlers(),e.endLoading()})}).fail(function(t){e.endLoading(),e.showErrorMessage(t)})}).fail(function(t){e.endLoading(),e.showErrorMessage(error)})},showErrorMessage:function(e){var t=this.getFormContainer(),i=this.resources.getResource("render-upload-alert-maxsize").replace("{0}",BIZAGI_SETTINGS.UploadMaxFileSize);try{i=e&&void 0!==e.responseText?JSON.parse(e.responseText).message:e}catch(e){}t.addErrorMessage(i),t.endLoading()},autoOpenDocuments:function(){},showDocumentPreview:function(e,t){},returnCssTypeFile:function(e){if(null==e||0==e.lenght)return"ui-bizagi-document-upload-item-generic-file";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc";case"pdf":return"ui-bizagi-document-upload-item-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls";default:return"ui-bizagi-document-upload-item-generic-file"}},redrawDocuments:function(e,t,i){var r=this.getControl(),a=$(".ui-bizagi-container-documents",r);a.empty();for(var n="",o=0;o<e.length;o++){var s={id:e[o][0],fileName:e[o][1]};n+=this.renderDocumentItem(s)}if(i&&!t&&e.length>0){var l={fileName:this.getResource("render-document-downloadalldocuments")};n+=this.renderAllDocumentDownload(l)}a.append(n),this.setValue(e)},renderAllDocumentDownload:function(e){var t=this.properties,i=this.getMode(),r=this.renderFactory.getTemplate(this.getTemplateItem()),a=this.buildAllDocumentsUrl(e);"execution"!=i&&(a="javascript:void(0);");var n=$.fasttmpl(r,{url:a,allowDelete:t.allowDelete,filename:e.fileName,mode:i,joined:!0});return this.removeDeleteButton(n)},removeDeleteButton:function(e){var t=e.indexOf('<span class="ui-bizagi-container-documents-item-delete');if(t>0){var i=e.substring(t),r=i.indexOf("</span>")+7;return e.substring(0,t)+i.substring(r)}return e},getTemplate:function(){return"document"},getTemplateItem:function(){return"document-item"},getErrorTemplate:function(){return"form-error"}}),bizagi.rendering.combo.extend("bizagi.rendering.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{init:function(e){this._super(e),this.dependants=[],this.isDependant=!1},initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=!!bizagi.util.isEmpty(t.parentCombo)&&t.hasLocalData,t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data))},renderControl:function(){var e=this.getMode(),t=this.parentCombo=this.getParentCombo();null!=t&&"cascadingCombo"==t.properties.type&&(this.isDependant=!0),this.initializingCascadingCombo=!0;var i=this._super();return"execution"!=e&&(this.initializingCascadingCombo=!1),i},configureHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},configureReadOnlyHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done(function(){var r=i.getControl(),a=i.getMode();r.empty(),$.when(i.renderCombo(e)).then(function(e){r.html(e),i.postRender(),"execution"==a&&i.configureHandlers(),void 0!==i.getValue()&&i.setDisplayValue(i.getValue()),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.value,t])})})},getData:function(e){return"execution"!=this.getMode()?this.getDummyData():this.isDependant?(this.parentCombo&&e&&(this.properties.remoteDataLoaded=!1),""!=(this.parentCombo.selectedValue?this.parentCombo.selectedValue.id:"")?this._super(e):[]):this._super(e)},bindDependantCombo:function(e){var t=this,i=t.properties;"cascadingCombo"==e.properties.type&&(t.dependants.push(e),e.onChangeFunction=function(i,r,a){t.refreshDependantCombo(e,r.id,t.focusDependant,a),a||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||i.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},isEventBinded:function(e){return void 0!==$._data(this.observableElement.get(0),"events")&&void 0!==$._data(this.observableElement.get(0),"events")[e]},unbindDependantCombo:function(e){this.unbind("select",e.onChangeFunction)},refreshDependantCombo:function(e,t,i,r){var a={};a[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t,e.deferredVisible=$.Deferred(),r||e.setValue("",!1),e.refresh(a,r),i&&$.when(e.deferredVisible.promise()).done(function(){e.inputCombo.trigger("click")})},emptyControlByChangeEditability:function(){this.getControl().empty()},cleanInput:function(){this.triggerHandler("select",{id:0})},getParentCombo:function(){var e=this.properties;if(void 0===e.parentCombo)return null;for(var t=this.getFormContainer(),i=t.getRenderByType("cascadingCombo"),r=0,a=0,n=[],o=null;r<i.length;r++)e.parentCombo===i[r].properties.id&&n.push({control:i[r],index:r});if(n.length>1){for(var s,l;a<n.length;a++)if(s=(l=n[a].control.properties.xpath.split(".")).length,l.slice(0,s-1).join(".")===e.xpath){o=i[n[a].index];break}}else o=t.getRenderById(e.parentCombo);return o},canBeSent:function(){return this._super()&&bizagi.util.isMapEmpty(this.dependants)},showCurrentData:function(){return"execution"!=this.getMode()},configureSubmitOnChange:function(){this.configured||(this._super(),this.configured=!0)},internalSubmitOnChange:function(e,t){var i=new $.Deferred;return this.isDependant&&this.canBeSent()&&void 0!==this.itemSelected?this._super(e,t):i.resolve()},internalSetInitialValue:function(){this._super(),this.value&&0==this.isDependant&&(this.internalSetInitialValueFlag=!0,this.trigger("select",[this.value,!0])),this.internalSetInitialValueFlag=!1}}),bizagi.rendering.combo.extend("bizagi.rendering.list",{},{initializeData:function(e){this._super(e);var t=this.properties;t.listSize=t.listSize||0},getTemplateName:function(){return"list"},showCurrentData:function(){return!1}}),bizagi.rendering.render.extend("bizagi.rendering.multiSelect",{},{initializeData:function(e){this._super(e);var t=this.properties;t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.maxRecords=Number(t.maxRecords)||20},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},getData:function(){var e=this,t=new $.Deferred,i=this.properties;return e.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contexttype||null,idPageCache:i.idPageCache}).done(function(e){i.data=e,t.resolve(i.data)}).fail(function(i){if("not-processed"!==i.type){var r=e.getFormContainer(),a=e.properties.displayName+": ";a+=("string"==typeof i?JSON&&JSON.parse(i)||$.parseJSON(i):i).message,r.addValidationMessage(a),t.reject(i)}}),t.promise()},setValue:function(e,t){t=void 0===t||t,e=JSON.encode({value:e}),this._super(e,t)},setDisplayValue:function(e){var t=this;t.setValue(e,!1),setTimeout(function(){t.addSelectedElements()},100)},canBeSent:function(){return!0},getValue:function(){return this.value||[]},getDataValue:function(){try{return JSON.parse(this.value).value||[]}catch(e){return[]}},hasValue:function(){var e=this.getDataValue();return e&&e.length>0},getElementsToStylize:function(e){return $(".bz-multiselect .bz-multiselect__tag:not(.bz-multiselect__plus)",e)},getDefaultLabelAlign:function(e){return"left"},getDefaultValueAlign:function(e){return"left"},addElement:function(e){var t=this.getDataValue();t.push(e),this.setValue(t)},removeElement:function(e){var t=e.id,i=this.getDataValue().filter(function(e){return e.id!==t});this.setValue(i)},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},markAsChecked:function(e){var t=this;return t.selected.some(function(i,r){var a=i.id===e;return a&&t.selected.splice(r,1),a})},canAddMoreItems:function(e){var t=this;return parseInt(e.css("width"))>e.children().toArray().reduce(function(e,i){return e+=t.getElementWidth(i)},0)+t.Class.MORE_OPTION_WIDTH},getElementWidth:function(e){var t=window.getComputedStyle(e);return $(e).outerWidth()+["padding-left","padding-right","margin-left","margin-right"].reduce(function(e,i){return e+=parseInt(t[i])},0)},filterList:function(e,t){t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},addSelectedElements:function(){},findItemById:function(e){return(this.properties.data||[]).find(function(t){return t.id==e})},formatItem:function(e){return bizagi.util.formatItem(e)}}),bizagi.rendering.number.extend("bizagi.rendering.money",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol?t.symbol=t.currencySymbol?t.currencySymbol:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:t.symbol="",t.groupDigits=!0}}),bizagi.rendering.combo.extend("bizagi.rendering.radio",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,t.unique=bizagi.util.randomNumber(1e3,1e6)},getTemplateName:function(){return"radio"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){return{vertical:!this.properties.horizontal}},cleanData:function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e,!1),this.clearDisplayValue()},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue;return t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,void 0!==(r=r&&void 0!==r.id?r.id:r)&&r==t&&t==i||(null!==t&&""!==t||null!==i&&""!==i)&&i!=t}}),bizagi.rendering.render.extend("bizagi.rendering.userfieldDefinition",{},{getFileDependencies:function(){return null},postRender:function(){var e=this;e._super();var t=$.Deferred(),i=e.getFileDependencies();return i&&i.length>0?bizagi.loader.loadFile(i).then(function(){e.internalRenderControl(),t.resolve()}):$.when(e.renderUserfieldControl()).done(function(){t.resolve()}),t.promise()},renderUserfieldControl:function(){var e=this,t=e.getControl(),i=e.properties,r=new $.Deferred;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var a;return(a=e.getEditableControl())&&(e.input=t.html(a)),e.renderComplex(),r.resolve(),r.promise()},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var r=function(){var i=e.getReadonlyControl();i&&(e.input=t.html(i)),e.renderComplex()};e.ready?e.ready().done(function(){r()}):r()},getDisplayValue:function(){return this.getReadonlyValue()},setDisplayValue:function(e){this.setValue(e),this.setEditableValue(e)},getValue:function(){return this.getEditableValue()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done(function(e){"error"==e.type?(i.getFormContainer().addErrorMessage(e.message),a.reject(e)):a.resolve(e)}).fail(function(e,t,i){a.reject(e,t,i)}),a.promise()},saveForm:function(){return this.getFormContainer().saveForm()},getRenderElements:function(e){var t=$(),i=this.getFormContainer().getRenders(e);return $.each(i,function(e,i){t=t.add($(i.element))}),t},getServerResourceURL:function(e){var t="Rest/Userfields/{0}/resource/{1}/{2}";t=t.replace("{0}",this.properties.userfieldGuid),e=e.replace("\\","__").replace("/","__");var i=bizagi.util.detectDevice();return t=(t=t.replace("{1}",i)).replace("{2}",e)},getRenderValue:function(e){var t,i=this.getFormContainer().getRenders(e);return $.each(i,function(e,i){t&&!i.properties.editable||(t=i)}),t?t.getValue():null},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},showDialog:function(e,t){bizagi.util.mustImplement("Must implement the showDialog method")},showPopup:function(e,t){bizagi.util.mustImplement("Must implement the showPopup method")},updateOriginalValue:function(){this.properties.originalValue=this.value=this.properties.value}}),bizagi.rendering.userfieldDefinition.extend("bizagi.rendering.basicUserField",{},{getEditableControl:function(){},renderComplex:function(){},getEditableValue:function(){return bizagi.rendering.render.prototype.getValue.apply(this,arguments)},setEditableValue:function(e){return bizagi.rendering.render.prototype.setValue.apply(this,arguments)},getReadonlyControl:function(){},getReadonlyValue:function(){return bizagi.rendering.render.prototype.getDisplayValue.apply(this,arguments)},dispose:function(){this._super()}}),bizagi.rendering.render.extend("bizagi.rendering.userfieldWrapper",{},{init:function(e){this._super(e),this.initialParams=e,this.userfieldGuid=this.properties.userfieldGuid,this.userfieldName=this.properties.control},internalPostRender:function(){var e=this;$.when(e.getUserfieldControl()).done(function(t){return t.element=e.element,e.column&&(t.isColumn=!0,t.grid=e.grid,t.surrogateKey=e.surrogateKey,t.properties.xpathContext=e.getControlXpathContext(t),t.getControl=e.column.getControl),t.internalPostRender()})},getControlXpathContext:function(e){var t=e.properties;return e.isColumn?t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]":t.xpathContext},getUserfieldControl:function(){var self=this,sControl=self.userfieldName,exists=eval("bizagi.rendering."+sControl+" !== undefined"),def=new $.Deferred;if(exists)$.when(self.parent.ready()).done(function(){def.resolve(self.createUserfieldInstance(sControl))});else{var device=bizagi.util.detectDevice();device.indexOf("smartphone")>=0?device="smartphone":device.indexOf("tablet")>=0&&(device="tablet"),$.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:device})).pipe(function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))})}return def.promise()},createUserfieldInstance:function(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=new bizagi.rendering.defaultUserField(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",function(){self.triggerHandler("renderchange",arguments)}),control},replicateUserfieldMethods:function(control){var self=this;for(var key in control.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"subscribe"!=key&&"unsubscribe"!=key&&"publish"!=key&&"render"!=key&&"triggerHandler"!=key&&"dispose"!=key&&(self[key]=eval("var tmp = function(){ if (this.userfieldInstance) return this.userfieldInstance."+key+".apply(this.userfieldInstance, arguments); return null;};tmp"));control.properties=self.properties,control.value=self.value},loadUserfield:function(data){var self=this;self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,function(index,val){if("js"==val.type)try{eval(val.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"==val.type&&bizagi.util.loadStyle(val.content,self.properties.styleGuid)});var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},dispose:function(){var e=this;setTimeout(function(){e.userfieldInstance&&(e.userfieldInstance.unbind("renderchange"),e.userfieldInstance.dispose())},bizagi.override.disposeTime||50),e._super()}}),bizagi.rendering.render.extend("bizagi.rendering.association",{},{initializeData:function(e){this._super(e);var t=this.properties;t.property="flipped",t.idRender=this.properties.id,t.allowFlip=void 0===t.allowFlip||bizagi.util.parseBoolean(t.allowFlip),t.flipped=void 0!==t.flipped&&bizagi.util.parseBoolean(t.flipped),t.flipstate=t.flipped,t.leftData=t.leftData||[],t.rightData=t.rightData||[],t.value&&this.processPropertyValue()},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done(function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=$.fasttmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(a)}),i.promise()},getFlipAssociation:function(){return"execution"==this.getMode()&&this.dataService.getFlipAssociation(this.properties)},getDisplayValue:function(){return this.getValue()},getTemplateName:function(){return"association"},getColumnData:function(){var e=this.data,t=[],i=e.flipped?e.rightData:e.leftData;return $.each(i,function(e,i){t.push({id:i.id,value:i.value})}),t},getRightAssociation:function(e){var t=this.data,i=[],r=function(e,i){var r=!1;return $.each(t.formatJson.value,function(t,a){!r&&a.id==e&&a.value.indexOf(i)>=0&&(r=!0)}),r};return t.flipped?$.each(t.leftData,function(t,a){i.push({id:a.id,name:a.value,checked:r(a.id,e)})}):$.each(t.rightData,function(t,a){i.push({id:a.id,name:a.value,checked:r(e,a.id)})}),i},removeElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,function(r,a){i.properties.flipped?a.id==t&&$.each(i.properties.formatJson.value[r].value,function(t,a){e==a&&i.properties.formatJson.value[r].value.splice(t,1)}):a.id==e&&$.each(i.properties.formatJson.value[r].value,function(e,a){t==a&&i.properties.formatJson.value[r].value.splice(e,1)})}),i.setValue(JSON.encode(i.properties.formatJson))},addElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,function(r,a){i.properties.flipped?a.id==t&&i.properties.formatJson.value[r].value.push(e):a.id==e&&i.properties.formatJson.value[r].value.push(t)}),i.setValue(JSON.encode(i.properties.formatJson))},makeJsonBase:function(){this.properties.formatJson=this.properties.formatJson||{leftXpath:this.properties.leftXpath,rightXpath:this.properties.rightXpath,leftFactName:this.properties.leftFactName,rightFactName:this.properties.rightFactName,value:this.properties.value}},hasValue:function(){if(this.properties.formatJson)var e=this.properties.formatJson.value;else e=this.properties.value;for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r&&r.value.length>0)return!0}return!1},processPropertyValue:function(){for(var e=this.properties,t=e.value,i=[],r=0,a=t.length;r<a;r++){var n=t[r];i.push({id:n[0],value:n[1]})}e.value=i}}),bizagi.rendering.render.extend("bizagi.rendering.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(e){this._super(e);var t=this.properties;if(t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var i=t.validExtensions.split(";"),r=0;r<i.length;r++)i[r]="*."+i[r];t.validExtensions=i.join(";")}t.addUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=uploadECMFile",t.editUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=updateECMFileContent",t.deleteUrl=t.deleteUrl||void 0,t.allowDelete=null===bizagi.util.parseBoolean(t.allowDelete)||bizagi.util.parseBoolean(t.allowDelete),t.q_xpath=bizagi.util.encodeXpath(t.xpath),t.showMetadata=void 0===t.showMetadata||null===t.showMetadata||bizagi.util.parseBoolean(t.showMetadata);var a=this.getResource("dateFormat"),n=this.getResource("timeFormat");t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||a,t.timeFormat=t.timeFormat||n,t.fullFormat=t.dateFormat,this.files=t.value||[],this.filesCount=this.files.length,t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||""},renderControl:function(e,t){var i=this,r=i.properties,a=i.renderFactory.getTemplate("ecm"),n=i.getMode(),o=new $.Deferred;r.value=t?[[t.idFileUpload,t.fileName]]:i.value;var s=$.fasttmpl(a,r,{getFileExtension:i.getFileExtension,isImage:i.isImage});if(null!=i.properties.value){var l=i.properties.value.length;0==l&&o.resolve(s),$.each(i.properties.value,function(e,r){var a={};a.idFileUpload=r[0],a.fileName=r[1],a.idPageCache=i.properties.idPageCache,a.xpathContext=i.getXpathContext(),a.xPath=i.properties.xpath,a.editable=i.properties.editable,a.idAttrib=i.properties.idAttrib;var d=i.getFormContainer();d&&d.properties&&d.properties.sessionId&&(a.sessionId=d.properties.sessionId),"execution"==n&&$.when(i.renderFileLayout(a,t)).done(function(e){l--,bizagi.loader.productBuildToAbout&&0==bizagi.loader.productBuildToAbout.indexOf("10.4")&&(e=e.replaceAll("Handlers/MetadataFile","Handlers/Metadata")),s=i.replaceItemHtml(s,i.properties.id+"-"+a.idFileUpload,e),0==l&&o.resolve(s)})})}else o.resolve(s);return o.promise()},replaceItemHtml:function(e,t,i){return e.replace("{{"+t+"}}",i)},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),a=i.renderFactory.getTemplate("ecm-metadata"),n=(i.getControl(),$.Deferred());return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done(function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice();var s=$.fasttmpl(a,t[0]);n.resolve(s)}),n.promise()},isImage:function(e){var t=this.getFileExtension(e);return["JPG","JPEG","GIF","PNG","BMP"].indexOf(t.toUpperCase())>-1},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderReadOnly:function(){return this.renderControl()},canBeSent:function(){return!1},buildItemUrl:function(e){var t=bizagi.cookie("JSESSIONID");return this.dataService.getECMFileUrl({idFileUpload:e.idFileUpload,xPath:e.xpath,xpathContext:e.xpathContext,idAttrib:e.data.idAttrib,idPageCache:this.properties.idPageCache,fileName:e.data.fileName.replace(/ /g,"_"),p_sessionId:t,sessionId:e.data.sessionId||""})},buildAddParams:function(){var e=this.properties,t={};return t.fileExt=e.validExtensions,t.fileDesc=e.validExtensions?this.getResource("render-upload-allowed-extensions")+e.validExtensions:"",t.xPath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=e.xpathContext,t.metaValues=[],t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t},getFileExtension:function(e){return(e=e||"").split(".").pop()},setValue:function(e,t){var i=this.properties;this._super(e,t),this.files=i.value||[],this.filesCount=this.files.length?this.files.length:i.value},getXpathContext:function(){return this.properties.xpathContext||""},getUploadXpath:function(){return this.properties.xpath},deleteUploadItem:function(e,t){var i=this,r=i.properties,a={idFileUpload:t,xPath:r.xpath,idAttrib:r.idAttrib,idPageCache:r.idPageCache,xpathContext:i.getXpathContext()};return i.dataService.deleteECMFile(a).pipe(function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,function(e){return e[0]!=t})})}}),bizagi.rendering.render.extend("bizagi.rendering.searchList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.maxRecords=Number(t.maxRecords)||20,t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),this.setValue(t.value)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,value:e.value,editable:!0},{formatItem:this.formatItem})},setValue:function(e){this.value=JSON.encode({value:e}),this.triggerRenderChange()},addElement:function(e){var t=JSON.parse(this.value);t.value.push(e),this.setValue(t.value)},removeElement:function(e){var t=JSON.parse(this.value),i=[];$.each(t.value,function(t,r){r.id!=e.id&&i.push({id:r.id,value:r.value})}),this.setValue(i)},removeLastElement:function(){var e=JSON.parse(this.value);e.value.length>0&&(e.value.pop(),this.setValue(e.value))},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;return t.dataService.getSearchData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.term,extra:e}).done(function(e){i.data=e,r.resolve(i.data)}).fail(function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)}),r.promise()},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},canBeSent:function(){return!0},formatItem:function(e){return bizagi.util.formatItem(e)}}),bizagi.rendering.render.extend("bizagi.rendering.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(e){this._super(e);var t=this.properties;if(t.editable=!!bizagi.util.parseBoolean(t.editable),t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var i=t.validExtensions.replace(/\ /gi,"").split(";"),r=0;r<i.length;r++)if(0!=i[r].length)i[r]="*."+i[r].replaceAll(" ","");else{i.indexOf(i[r]);i.splice(r,1)}t.validExtensions=i.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddFileUrl(t.isUserPreference),t.allowDelete=null!==bizagi.util.parseBoolean(t.allowDelete)&&bizagi.util.parseBoolean(t.allowDelete),t.isAutoWidth=!1,t.isAutoHeight=!1,-1==t.width?(t.width="99%",t.isAutoWidth=!0):t.width=t.width+"px",-1==t.height?(t.height="auto",t.isAutoHeight=!0):t.height=t.height+"px"},renderControl:function(){var e=this,t=new $.Deferred,i=e.renderFactory.getTemplate("image"),r=bizagi.util.isOfflineForm({context:e});return $.when(e.buildItemUrl()).done(function(a){if(!e.isDisposed()){e.properties.url=""!==a?a:"",e.properties.value=e.value=e.properties.url.length>0?[e.properties.url]:null,e.setValue(e.properties.value),r&&-1!==a.indexOf("Invalid case id")&&(e.properties.url="");var n=$.fasttmpl(i,{url:e.properties.url});t.resolve(n)}}),t.promise()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("image-readonly");return $.fasttmpl(e)},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},renderUploadItem:function(e){var t=this,i=t.properties,r=t.getMode(),a="",n=new $.Deferred,o=t.getTemplateItem();return $.when(t.buildItemUrl()).done(function(e){a=e||a;var s=$.fasttmpl(o,{url:a,allowDelete:i.allowDelete,mode:r});t.properties.value=a.length>0?[a]:null,n.resolve(s)}),n.promise()},buildItemUrl:function(e){var t=this.properties,i=this.getMode(),r=new $.Deferred,a="",n=bizagi.util.isOfflineForm({context:this});if("execution"!==i)a="javascript:void(0);",r.resolve(a);else{var o={url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,property:e&&e.property?e.property:"fileContent",dataType:"text"};t.contexttype&&(o.contexttype=t.contexttype),t.isUserPreference&&(this.currentUser=bizagi.currentUser.idUser,o.xpathContext="@Context.Users[id == "+this.currentUser+"]",o.contexttype="entity",o.surrogatekey=this.currentUser),n?r.resolve(bizagi.util.getDataUrl(t)):this.dataService.multiaction().getPropertyData(o,"text").done(function(e){'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(a="data:image/png;base64,"+e),r.resolve(a)})}return r.promise()},buildFullItemUrl:function(){var e=new $.Deferred;return $.when(this.buildItemUrl({property:"fileFullContent"})).done(function(t){e.resolve(t)}),e.promise()},canBeSent:function(){return!1},setValue:function(e,t){this.properties;this._super(e,t)},getValue:function(){return this.properties.value||[]},isValid:function(e){var t=this.properties;if(0==bizagi.util.parseBoolean(t.visible))return!0;if(0==bizagi.util.parseBoolean(t.editable))return!0;if((this.setValidationMessage(""),t.required)&&(!(this.grid&&this.grid.isFromCreatedRow.apply(this))&&0===this.getValue().length)){var i=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName);return e.push({xpath:this.properties.xpath,message:i}),!1}return!0},buildAddParams:function(){var e=this,t=e.properties,i=e.getFormContainer(),r={};r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.getUploadXpath(),r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=t.id,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=t.xpathContext,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+e.Class.BA_PAGE_CACHE]=t.idPageCache,r[e.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=i.properties.sessionId,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="savefile",t.contexttype&&(r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=t.contexttype);try{null!=BIZAGI_SESSION_NAME?r[BIZAGI_SESSION_NAME]=i.properties.sessionId:r.JSESSIONID=i.properties.sessionId}catch(e){r.JSESSIONID=i.properties.sessionId}return r},getUploadXpath:function(){return this.properties.xpath},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()}}),bizagi.rendering.render.extend("bizagi.rendering.geolocation",{},{init:function(e){this._super(e);var t=this.properties;t.allowUpdate=bizagi.util.parseBoolean(t.allowUpdate),this.geoloc=window.navigator.geolocation},renderControl:function(){var e=this.renderFactory.getTemplate("geolocation");return $.fasttmpl(e,this.properties)},isValid:function(e){return this._super(e)},setDisplayValue:function(e){this.setValue(e,!1)},configureHandlers:function(){},getCurrentPosition:function(e,t){var i=this;if(void 0!==i.geoloc){return i.geoloc.getCurrentPosition(function(t){e&&e(t)},function(e){var r=i.getErrorMessage(e);t&&t(r)})}t&&t(bizagi.localization.getResource("render-control-unsuported-by-browser").replace("{0}",i.properties.type))},getErrorMessage:function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:case 1:t=bizagi.localization.getResource("render-geolocation-permission-denied");break;case e.POSITION_UNAVAILABLE:case 2:t=bizagi.localization.getResource("render-geolocation-position-unavailable");break;case e.TIMEOUT:case 3:t=bizagi.localization.getResource("render-geolocation-timeout");break;default:t="WD: "+bizagi.localization.getResource("render-geolocation-permission-denied")}return t}}),bizagi.rendering.render.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.allowAdd=void 0===i.allowAdd||bizagi.util.parseBoolean(i.allowAdd),i.withAddForm=i.withAddForm&&i.allowAdd,i.allowEdit=void 0===i.allowEdit||bizagi.util.parseBoolean(i.allowEdit),i.withEditForm=i.withEditForm&&i.allowEdit,i.allowDetail=void 0!==i.allowDetail&&bizagi.util.parseBoolean(i.allowDetail),i.inlineAdd=void 0===i.inlineAdd||bizagi.util.parseBoolean(i.inlineAdd),i.inlineAdd=i.inlineAdd&&i.allowAdd,i.inlineEdit=void 0===i.inlineEdit||bizagi.util.parseBoolean(i.inlineEdit),i.inlineEdit=i.inlineEdit&&i.allowEdit,i.allowDelete=void 0===i.allowDelete||bizagi.util.parseBoolean(i.allowDelete),t.orientation=t.properties.orientation||"ltr",t.data=t.properties.data,t.keys=t.data?t.getKeys(t.data.rows):[],t.pointer=0,t.totalRows=0,t.inlineAddRecords=[],t.data&&(t.totalRows=t.data.rows.length)},getKeys:function(e){for(var t=[],i=0,r=(e=e||[]).length;i<r;i++){var a=e[i];t.push(a[0])}return t},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("collectionnavigator"),i=this.getMode(),r=$.fasttmpl(t,{uniqueId:e.uniqueId,displayName:e.displayName?e.displayName:"",id:e.id,guid:e.guid,showPreview:this.showPreview(),mode:i,orientation:this.getFormContainer().properties.orientation});return r=this.drawControls(r)},renderReadOnly:function(){return this.renderControl()},drawControls:function(e){},drawActions:function(e){},drawControl:function(e){},drawForms:function(e){},drawPreview:function(){var e="execution"===this.getMode()?"collectionnavigator-execution":"collectionnavigator-preview",t=this.renderFactory.getTemplate(e),i=$.tmpl(t);this.canvas.append(i)},hasData:function(){return this.getTotalRows()>0},getRow:function(){return this.keys[this.pointer]},getNextRow:function(){return this.getTotalRows()>this.pointer+1&&(this.pointer+=1),this.getRow()},getPreviousRow:function(){return this.pointer>0&&(this.pointer-=1),this.getRow()},getFirstRow:function(){return this.pointer=0,this.getRow()},getLastRow:function(){return this.pointer=this.keys.length-1,this.getRow()},getTotalRows:function(){return this.keys.length},getIndexes:function(){return this.properties.data.rows},setPointer:function(e){this.pointer=e-1},isTherePendingInlineRow:function(){return this.inlineAddRecords.length>0},addKey:function(e){this.keys.push(e)},removeKey:function(){var e=this.pointer;if(e>=0){this.keys.splice(e,1);var t=this.getTotalRows();t>0&&e>=t&&this.setPointer(t)}},showPreview:function(){var e=this.getMode(),t=this.properties;return"execution"==e?!this.hasData():!bizagi.util.parseBoolean(t.navigationform)},getParameters:function(e){var t={},i=this.properties,r=i.xpath+"[id="+e.id+"]";return t.idRender=i.id,t.recordXPath=r,t.xpathContext=i.xpathContext,t.idPageCache=i.idPageCache,t.requestedForm=e.requestedForm,t.contextType=i.contextType||i.contexttype,t.url=e.url,t.editable=e.editable,i.orientation,t},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType||e.contexttype,idPageCache:e.idPageCache,orientation:e.orientation||"ltr"}).pipe(function(e){return e.idEntity}).promise()},submitEditRequest:function(e){var t=this.properties,i=t.xpath+"[id="+e+"]";return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype||"",orientation:t.orientation||"ltr"})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+"[id="+e+"]";return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType||i.contexttype}).pipe(function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e})},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+"[id="+e+"]":r.xpath+"[id="+e+"]";return i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:a,contexttype:r.contextType||r.contexttype||"",submitData:t}).fail(function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)})},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e.idPageCache,contexttype:this.properties.contexttype||""})},getRemoteData:function(e){var t=this.properties;return e=e||{},$.extend(e,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache}),this.dataService.getData(e)},isValid:function(e){this.validateControls(e)},validateControls:function(e){return!!this.form&&this.form.validationController.performValidations(e)}}),bizagi.rendering.element.extend("bizagi.rendering.columns.column",{},{init:function(e){this._super(e),this.decoratedClass=e.decorated,this.data=e.data,e.singleInstance?(this.decorated=new this.decoratedClass({data:this.data,parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),this.decorated.getControl=this.getControl,e.decorated=this.decorated,this.decorated.properties.isColumn=!0):this.decorateRenders=[],this.grid=e.parent;var t=this.properties;t.columnVisible=null==bizagi.util.parseBoolean(t.columnVisible)||bizagi.util.parseBoolean(t.columnVisible),t.align=t.align||"center",t.textFormat=t.textFormat||{},t.submitOnChange=void 0!==t.submitOnChange&&bizagi.util.parseBoolean(t.submitOnChange),t.singleInstance=e.singleInstance,t.editable=void 0===t.editable||bizagi.util.parseBoolean(t.editable),t.visible=void 0===t.visible||bizagi.util.parseBoolean(t.visible),t.required=void 0!==t.required&&bizagi.util.parseBoolean(t.required),t.showColumn=void 0===t.showColumn||bizagi.util.parseBoolean(t.showColumn);try{e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable&&(t.editable=!1)}catch(e){}this.readonly=void 0!==t.readonly&&t.readonly,this.readonly&&(t.editable=required=!1),this.originalProperties=JSON.parse(JSON.encode(t))},isReadonly:function(){return!1},getControl:function(){return $(".ui-bizagi-render-control",this.element||this.observableElement)},getDecorated:function(e){if(this.properties.singleInstance)return this.decorated;var t=this.decorateRenders[e];if(null==t){"object"!=typeof this.decorateRenders&&(this.decorateRenders=[]);var i=new this.decoratedClass({data:bizagi.clone(this.data),parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService});t=i,this.decorateRenders[e]=i,t.surrogateKey=e,this.applyOverrides(t),"summary"==e&&"columnMoney"!=t.properties.type&&"columnNumber"!=t.properties.type&&(t.setDisplayValue=function(e){this.getControl().html(e)})}return t},ready:function(){return this.readyDeferred.promise()},initialize:function(){},canBeSent:function(e,t){var i=this.getDecorated(e);return t&&(i.properties.visible=t.visible,i.properties.editable=t.editable),i.canBeSent()||!this.properties.editable&&this.hasChanged()||!i.properties.editable&&this.hasChanged()},isValueValid:function(e,t,i,r){var a=this.getDecorated(e),n=[];return r.visible&&(this.setValue(e,t),a.properties=$.extend(a.properties,r),this.grid&&void 0===a.grid&&(a.grid=this.grid),a.isValid(n)),!(n.length>0)||($.each(n,function(e,t){i.push(t.message)}),!1)},applyOverrides:function(e){},render:function(e,t){var i=this,r=i.properties,a=i.getDecorated(e);if(a.grid=i.grid,a.column=this,a.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),i.changed=!1,!r.editable&&"CALLER_RENDER_READ_ONLY_COLUMNSLINK"!==arguments[3])return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var n=a.render("cell");return a.bind("renderchange",function(){i.changed=!0}),i.bind("rendered",function(){i.readyDeferred.resolve()}),n},postRender:function(e,t){this.getDecorated(e).postRenderElement(t)},renderReadOnly:function(e,t){var i=this,r=i.getDecorated(e);r.grid=i.grid,r.column=this,r.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),r.properties.editable=!1,i.readyDeferred=new $.Deferred;var a=r.render("cell.readonly");return i.bind("rendered",function(){i.readyDeferred.resolve()}),a},renderSummary:function(e,t){var i=this.renderFactory.getTemplate("cell.summary");return $.tmpl(i).html()},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},postRenderSummary:function(){return!1},getCell:function(){return this.decorated.getDisplayValue()},setSurrogateKey:function(e){this.surrogateKey=e},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,null==t&&void 0!==this.properties.defaultvalue&&null!=i.grid&&(t=this.setDefaultValue(e,i)),i.properties.value=t,i.setValue(t,!1))},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i,i},getValue:function(e){return this.getDecorated(e).getValue()},getCompositeValue:function(e){return this.getValue(e)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_COLUMN},hasChanged:function(){return this.changed},trigger:function(e,t){this.decorated&&this.decorated.trigger(e,t)},triggerHandler:function(e,t){this.decorated&&this.decorated.triggerHandler(e,t)},bind:function(e,t){this.decorated&&this.decorated.bind(e,t)},unbind:function(e,t){this.decorated&&this.decorated.unbind(e,t)},overrideDecoratedRenderProperties:function(e){var t=this.getDecorated(e);t.properties.editable=this.properties.editable,t.properties.visible=this.properties.visible,t.properties.required=this.properties.required},overrideProperties:function(e){this.properties.editable=e.editable||this.properties.editable,this.properties.visible=e.visible||this.properties.visible,this.properties.required=e.required||this.properties.required},getSortName:function(){var e=this.getAnyDecoratedInstance();return e&&e.getSortColumn?e.getSortColumn():this.properties.xpath},getAnyDecoratedInstance:function(){var e;for(e in this.decorateRenders)break;return e?this.decorateRenders[e]:null},dispose:function(){var e=this;setTimeout(function(){e.decorated&&(e.decorated.unbind("renderchange"),e.decorated.dispose()),e.decorateRenders&&bizagi.util.arrayEach(e.decorateRenders,function(e,t){t&&(t.unbind("renderchange"),t.dispose())})},bizagi.override.disposeTime||50),e._super()}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.readonly",{},{init:function(e){this._super(e),this.properties.editable=required=!1},isReadonly:function(){return!0},render:function(e,t){if("string"==typeof t){var i=t.replaceAll("\\n","<br/>");return i=i.replaceAll("\n","<br/>")}return null===t?"":t},postRender:function(e,t){},renderReadOnly:function(e,t){return this.render(e,t)},postRenderReadOnly:function(e,t){},isValueValid:function(){return!0}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.column",{},{applyOverrides:function(e){e&&(e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getFormattingLabel=function(e){return this.getControl()})},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(".ui-bizagi-cell-readonly",this.element||this.observableElement)),e},getDecorated:function(e){var t=this._super(e);return void 0===t.grid&&(t.grid=this.grid),t},render:function(e,t,i){var r=this._super(e,t,i),a=this.getDecorated(e);return a.element&&(a.element.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),a.element.addClass("ui-bizagi-render-display-cell")),r},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,null==i.grid&&(i.grid=this.grid),this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},applyColumnStyles:function(e){var t=this.properties;(e=$(e)).css("-webkit-box-pack",t.align),t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.combo",{},{init:function(e){this._super(e);var t=this.properties;t.recalculate=bizagi.util.parseBoolean(t.recalculate)||!1},applyOverrides:function(e){var t=this.properties;this._super(e),t.recalculate||(e.originalGetData=e.getData,e.getData=this.getDataForAllCells,e.findDataById=this.findDataById)},findDataById:function(e){var t={};return this.column&&this.column.comboData&&$.each(this.column.comboData,function(i,r){r.id==e&&(t=r)}),t},getDataForAllCells:function(e){var t=this.column;return t.comboData?t.comboData:t.fetchingData?t.dataPromise:(t.fetchingData=!0,t.dataPromise=$.when(this.originalGetData(e)).pipe(function(e){return t.comboData=e,t.fetchingData=!1,e}),t.dataPromise)},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);if(t&&bizagi.util.isString(t))this._super(e,t);else if(t&&t.length>0){var r={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};this._super(e,r),i.selectedValue=r.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):"columnRadio"==this.properties.type?(this._super(e,null),i.selectedValue=t):t&&"number"==typeof t?this._super(e,t):(this._super(e,null),i.selectedValue="")}},getCompositeValue:function(e){var t=this.getDecorated(e),i=t.getValue(),r=t.getSelectedValue(),a=[];return i&&(i.id>0||bizagi.util.isString(i.id))?(a.push([]),a[0].push(i.id),a[0].push(r)):a.push([]),a},getValue:function(e){var t=this.getDecorated(e).getValue();return t?t.id:t},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},renderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties,a=r.xpathContext.length>0?r.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return i.properties.xpathContext=a,this._super(e,t)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.date",{},{setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if(this._super(e,t),null==t&&void 0!==this.properties.defaultvalue&&(t=this.setDefaultValue(e,i)),"summary"==e)return this._super(e,t);null==t&&(i.setValue(t,!1),i.properties.displayValue="");var r=bizagi.util.dateFormatter.getDateFromInvariant(t,i.properties.showTime);if(0==r&&(r=bizagi.util.dateFormatter.getDateFromInvariant(t,!i.properties.showTime)),0!=r){var a=bizagi.localization.getResource("datePickerRegional"),n=bizagi.util.dateFormatter.formatDate(r,i.properties.fullFormat,a);i.properties.displayValue=n,i.setValue(t,!1)}}},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},i=bizagi.util.dateFormatter.getDateFromInvariant(i,!1),i=bizagi.util.dateFormatter.formatInvariant(i,!0),t.grid.changes[e][this.properties.xpath]=i,i}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.search",{},{init:function(e){this._super(e);var t=this.properties;t.advancedSearch&&"execution"===this.getMode()&&(t.submitOnChange=bizagi.util.parseBoolean(t.submitOnChange)||!1,t.submitOnChange=!((t.submitVersion||1)>1)||t.submitOnChange)},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},getValue:function(e){var t=this.getDecorated(e).getValue();return t&&"object"==typeof t?t.id:t},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);if(t&&t.length>0){var r={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};this._super(e,r),i.selectedValue=r.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):t&&t.id&&t.label?(this._super(e,t),i.selectedValue=t.label):(this._super(e,t),i.selectedValue="")}}}),bizagi.rendering.container.extend("bizagi.rendering.contentPanel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("contentPanel"),i=$.fasttmpl(t,{displayName:e.displayName,mode:this.getMode(),uniqueId:e.uniqueId,isDesign:"design"===this.getMode(),messageValidation:e.messageValidation,cssClass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){this._super(e)}}),bizagi.rendering.render.extend("bizagi.rendering.range",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e)},renderControl:function(){var e;this.properties;return e=this.renderFactory.getTemplate("render-range"),$.fasttmpl(e,{})},setRanageControls:function(e,t){this.minControl=e||null,this.maxControl=t||null;var i=this.getControl(),r=$(".bz-range-maximum",i),a=$(".bz-range-minimum",i);this.renderRangeControl(a,e),this.renderRangeControl(r,t)},getValue:function(){return{min:this.minControl.getValue(),max:this.maxControl.getValue()}},renderRangeControl:function(e,t){$.when(t.render("render")).done(function(i){e.empty().append(i),t.postRenderElement(e)})}}),bizagi.rendering.range.extend("bizagi.rendering.rangeDate",{},{defineRangeControl:function(e){var t=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),r=new t(this.getRenderProperties("min")),a=new i(this.getRenderProperties("max"));r.suscribe(a),a.suscribe(r),this.setRanageControls(r,a)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r}}),bizagi.rendering.range.extend("bizagi.rendering.rangeMoney",{},{defineRangeControl:function(){var e=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),bizagi.rendering.range.extend("bizagi.rendering.rangeNumber",{},{defineRangeControl:function(){var e=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.tablet.startForm",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},configureViewHandlers:function(){},goBack:function(){this.slideContainer.destroy()},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getStartForm(e)).then(function(r){!1===e.editable&&(r.form.properties.editable=!1);var a=bizagi.rendering.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done(function(r){null==r||1==r||"success"==r.type?(i.resolve(),t.goBack()):"validationMessages"==r.type?(t.form.addValidationMessage(r.messages),$.each(e,function(e,i){var r=t.form.getRenders(e);$.each(r,function(e,t){t.updateOriginalValue()})})):"error"==r.type&&t.form.addErrorMessage(r.message)}):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:r.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new a(n),t.form.bind("refresh",function(i,r){r=$.extend({selectedTabs:t.form.getSelectedTabs(),isRefresh:!0},e,r,{idStartScope:t.form.properties.idStartScope}),t.renderSlideForm(r)}),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:t.slideFormParams.saveButtonLabel,actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""})],t.form.render()}).done(function(i){t.slideContainer.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+(t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"))+"</div>").delegate('div[ordinal="0"]',"click",function(){t.form.submitForm()}),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}),t.form.triggerHandler("ondomincluded")}).fail(function(e,i,r){var a=t.renderFactory.getCommonTemplate("form-error"),n=r.message||"Error";$.kendoTmpls(a,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)}),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.form",{},{init:function(e,t,i){var r=this;r.dataService=e,r.renderFactory=t,r.slideFormParams=i||{},r.slideContainer&&r.slideContainer.destroy&&r.slideContainer.destroy(),r.slideContainer=r.slideFormParams.navigation.createRenderContainer({title:r.slideFormParams.title}),r.configureViewHandlers()},goBack:function(){this.slideContainer.destroy()},configureViewHandlers:function(){},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(e)).then(function(r){!1===e.editable&&(r.form.properties.editable=!1);var a=bizagi.rendering.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done(function(r){null===r||!0===r||"success"===r.type?(i.resolve(),t.goBack()):"validationMessages"===r.type?(t.form.addValidationMessage(r.messages),$.each(e,function(e,i){var r=t.form.getRenders(e);$.each(r,function(e,t){t.updateOriginalValue()})})):"error"===r.type&&t.form.addErrorMessage(r.message)}):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:r.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form||(t.form=new a(n)),t.form.render()}).done(function(i){t.slideContainer.element.html(i),t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">Save</div>').delegate('div[ordinal="0"]',"click",function(){t.form.submitForm()}),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",function(){t.renderSlideForm(e)})}).fail(function(e,i,r){var a=t.renderFactory.getCommonTemplate("form-error"),n=r.message||"Error";$.kendoTmpls(a,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)}),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.view",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideFormDeferred=new $.Deferred,this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},buttons:[],processButtons:function(e){var t=this;e.buttons=[$.extend(e.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){if(e&&e.validateForm()){var i={};e.collectRenderValues(i),t.slideFormParams.allowGetOriginalFormValues&&(i.formValues=e.children),i.idPageCache=e.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(i)).done(function(r){r&&!0!==r&&"success"!==r.type?"validationMessages"===r.type?e.addValidationMessage(r.messages):"error"===r.type&&e.addErrorMessage(r.message):(t.goBack(),t.slideFormDeferred.resolve(i))}).fail(function(r){var a=r.responseText?r.responseText:"string"==typeof r?r:r.toString();if("string"==typeof a)try{a=JSON.parse(a).message}catch(e){a=(a=a.match(/"message":(.*)",/)[0]).substr(11,a.length-13)}else a.message||(a=r);e.validateForm(),e.clearValidationMessages(),e.addValidationMessage(a),t.goBack(),t.slideFormDeferred.resolve(i)}):(t.goBack(),t.slideFormDeferred.reject())}}}),$.extend(e.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){t.goBack(),t.slideFormDeferred.reject()}})],t.slideFormParams.showSaveButton||e.buttons.shift()},render:function(e){return this.renderSlideForm(this.slideForm,e),this.slideFormDeferred.promise()},renderSlideForm:function(e,t){var i=this,r=new $.Deferred;return bizagi.loading.start(),$.when(i.dataService.getFormData(t)).then(function(e){return t.recordXPath&&(e.form.properties.recordXpath=t.recordXPath),i.slideFormParams.showSaveButton&&!1!==t.editable||(e.form.properties.editable=!1),void 0!==e.form.properties&&(e.form.properties.orientation=i.slideFormParams.orientation||"ltr"),i.form=i.renderFactory.getContainer({type:"form",data:e.form,navigation:i.slideFormParams.navigation,view_container:i.container}),i.form.params=t.formParams,i.processButtons(i.form),i.form.render()}).done(function(e){i.container.element.html(e),t.isRefresh||i.slideFormParams.navigation.navigate(i.container.id),i.container.setNavigationButtons(i.form),$(".ui-bizagi-button-container .action-button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append(i.buttonContainer),i.form.triggerHandler("ondomincluded"),i.form.bind("refresh",function(e,t){t.formParams=t.params||i.form.params,i.render(t)})}).fail(function(e){var t=i.renderFactory.getCommonTemplate("form-error"),r=e.message||"Error";$.kendoTmpls(t,{message:r}).appendTo(i.container.element),i.slideFormParams.navigation.navigate(i.container.id)}).always(function(){bizagi.loading.stop()}),r.promise()},goBack:function(){this.container.destroy()},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,function(e,i){$("<div class='action-button'>"+i.caption+"</div>").click(i.callback).appendTo(t)}),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.view.grid",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(this.slideForm,e),this.slideFormDeferred.resolve(),this.slideFormDeferred.promise()},renderSlideForm:function(e,t){var i=this,r=i.transformData(t);i.form=i.renderFactory.getContainer({type:"form",data:r.form,navigation:i.slideFormParams.navigation,view_container:i.container}),i.form.buttons=[$.extend(i.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){i.goBack();var e={};i.form.collectRenderValues(e),i.slideFormDeferred.resolve(e)}}),$.extend(i.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){i.goBack(),i.slideFormDeferred.reject()}})],i.slideFormParams.allowEdition||i.form.buttons.shift(),$.when(i.form.render()).done(function(e){i.container.element.html(e),i.slideFormParams.navigation.navigate(i.container.id),i.container.setNavigationButtons(i.form),$(".ui-bizagi-button-container .action-button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append(i.buttonContainer),i.form.triggerHandler("ondomincluded")})},transformData:function(e){var t=this,i=e.row,r=e.columns,a=e.xpathContext.length>0?e.xpathContext+"."+e.xpath+"["+e.row[0]+"]":e.xpath+"[id="+e.row[0]+"]",n={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{xpathContext:a},actions:t.transformActions(e.xpath,e.actions),validations:t.transformValidations(e.xpath,e.validations)}};return $.each(i,function(e,i){if(e>0){var a={render:{properties:$.extend({},r[e-1].properties)}};if(a.render.properties.type=t.mapRenderType(a.render.properties.type),a.render.properties.displayType="both",0==t.slideFormParams.allowEdition&&(a.render.properties.editable=!1),a.render.properties.value=t.mapValue(a.render.properties.type,i),a.render.properties.recalculate&&(a.render.properties.data=null),void 0!==a.render.properties.columnVisible&&(a.render.properties.visible=a.render.properties.columnVisible),"upload"==a.render.properties.type&&(a.render.properties.isColumn=!0),"search"==a.render.properties.type){var o=a.render.properties.value;o.length>0&&(o=[].concat(o[0]),a.render.properties.value={id:o[0],label:o[1],additionallabel:o[2]||void 0})}n.form.elements.push(a)}}),n},mapRenderType:function(e){return"FormLink"===(e=e.substring(6,e.length))?"formLink":e=e.toLowerCase()},mapValue:function(e,t){return"combo"===e||"radio"===e?t&&t.length>0?[{id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!==t}):t[0][1]}]:null:t},transformActions:function(e,t){var i=this,r=[];return bizagi.util.isEmpty(t)?r:($.each(t,function(t,a){var n=!1;for(t=0;t<a.dependencies.length;t++)-1!=a.dependencies[t].indexOf(e)&&(n=!0);if(n){var o=JSON.parse(JSON.encode(a));for(t=0;t<o.dependencies.length;t++)o.dependencies[t]=o.dependencies[t].replaceAll(e+"[].","");i.transformConditions(e,o.conditions),i.transformCommands(e,o.commands),i.transformCommands(e,o.elseCommands),r.push(o)}}),r)},transformValidations:function(e,t){var i=this,r=[];return bizagi.util.isEmpty(t)?r:($.each(t,function(t,a){var n=JSON.parse(JSON.encode(a));i.transformConditions(e,n.conditions),r.push(n)}),r)},transformConditions:function(e,t){if(t.expressions)for(i in t.expressions)this.transformConditions(e,t.expressions[i]);else t.simple?this.transformConditions(e,t.simple):t.complex?this.transformConditions(e,t.complex):t.xpath&&(t.xpath=t.xpath.replaceAll(e+"[].",""),"xpath"==t.argumentType&&(t.argument=t.argument.replaceAll(e+"[].","")))},transformCommands:function(e,t){var i=null;if(null!=t&&0!==t.length){for(var r=0;r<t.length;r++)"refresh"===t[r].command?i=r:(t[r].xpath&&(t[r].xpath=t[r].xpath.replaceAll(e+"[].","")),"xpath"===t[r].argumentType&&(t[r].argument=t[r].argument.replaceAll(e+"[].","")));null!=i&&t.splice(r,1)}},goBack:function(){this.container.destroy()},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,function(e,i){$("<div class='action-button'>"+i.caption+"</div>").click(i.callback).appendTo(t)}),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.view.upload",{},{init:function(e,t,i){var r=this;this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},r.slideContainer=r.slideFormParams.navigation.createRenderContainer({title:r.slideFormParams.title}),r.processButtons().done(function(e){r.slideFormDeferred.resolve(e)}).fail(function(){r.slideFormDeferred.reject()})},processButtons:function(){var e=this,t=new $.Deferred,i={buttons:[]},r=function(){e.goBack(),t.reject()};return i.buttons.push({text:bizagi.localization.getResource("workportal-case-dialog-box-close"),caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!1,refresh:!1,ordinal:0,action:"back",save:!0,style:"",callback:r,click:r}),this.slideFormParams=$.extend(i,this.slideFormParams),e._renderButtons(this.slideFormParams),t.promise()},render:function(e){return this.renderUploadFile(this.slideForm,e),this.slideFormDeferred.promise()},renderUploadFile:function(e,t){var i=this.renderFactory.getCommonTemplate("uploadSlide"),r=$.kendoTmpls(i,{url:t.url});this.slideContainer.element.html(r),this.slideFormParams.navigation.navigate(this.slideContainer.id);var a=$.extend({originalProperties:{uniqueId:101,id:101}},this.slideFormParams);a.container=this.slideContainer.element,this.slideFormParams.navigation.setNavigationButtons(a),r.find(".ui-slide-upload-link").click(function(){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-tablet-slide-upload-confirmation"))).done(function(){window.location.href=t.url})})},goBack:function(){this.slideContainer.destroy()},_renderButtons:function(e){var t=$('<div class="bz-slide-button-container"></div>');$.each(e.buttons,function(e,i){$('<div class="action-button">'+i.text+"</div>").click(i.click).appendTo(t)}),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.view.search",{},{init:function(e,t,i,r,a){var n=this;n.dataService=e,n.renderFactory=t,n.searchForms=i,n.searchParams=r,n.slideParams=a,n.slideDeferred=new $.Deferred,n.extraButtons=!!a.hasOwnProperty("buttons")&&a.buttons,n.container=n.slideParams.navigation.createRenderContainer({title:n.slideParams.title}),n.processButtons().done(function(e){n.slideDeferred.resolve(e)}).fail(function(){n.slideDeferred.reject()}),n.configureViewHandlers()},render:function(e){return this.properties=e,this.renderSearchDialog(e),this.slideDeferred.promise()},renderSearchDialog:function(e){var t=this;bizagi.util.tablet.startLoading(),$.when(t.getSearchContainerData(e)).pipe(function(e){e.form.properties&&(e.form.properties.orientation=t.searchParams.orientation||"ltr");var i=t.renderFactory.getContainer({type:"form",data:e.form,navigation:t.slideParams.navigation,view_container:t.container});return i.buttons=[{ordinal:1,action:"search",caption:bizagi.localization.getResource("render-form-dialog-box-search"),callback:function(){t.currentSearchForm.performSearch(t.searchParams)}},{ordinal:2,action:"cancel",caption:"cancel",callback:function(){t.goBack()}},{ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var e={idCase:t.slideParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}}],t.slideParams.allowNew||i.buttons.pop(),t.form=i,i.render()}).done(function(e){t.container.element.html(e),t.slideParams.navigation.navigate(t.container.id),$(".ui-bizagi-button-container",t.form.container).append(t.buttonContainer),t.searchResultContainer=$(".ui-bizagi-container-search-results",e),t.searchResultContainer.hide(),t.form.triggerHandler("ondomincluded"),t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded"),t.currentSearchForm.bind("instancerefresh",function(){t.searchResultContainer.show()}),t.form.bind("refresh",function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.container},i),t.renderSearchDialog(i)}),t.currentSearchForm.bind("instanceSelected",function(e,i){t.goBack(),t.slideBoxDeferred.resolve({id:i.id,label:""})}),t.handleSearchFormZindex("show"),t.containerSearchCriteria=t.currentSearchForm.container.find(".ui-bizagi-container-search-criteria")}).always(function(){bizagi.util.tablet.stopLoading()})},renderAddForm:function(e){var t=this;e=e||{};var i=t.properties;void 0===t.addContainer&&(t.addContainer=t.slideParams.navigation.createRenderContainer({title:bizagi.localization.getResource("render-dialog-entity")}));var r=e.isRefresh||!1,a={idPageCache:e.idPageCache,guidEntity:i.entity,contextType:"entity"};r?(a.isRefresh=!0,a.idStartScope=e.idStartScope):(a.idRender=i.idRender,a.requestedForm="addForm"),bizagi.util.tablet.startLoading(),$.when(t.dataService.getFormData(a)).pipe(function(i){!1===e.editable&&(i.form.properties.editable=!1),i.form.properties&&(i.form.properties.orientation=t.searchParams.orientation||"ltr"),i.form.contextType="entity";var a=t.renderFactory.getContainer($.extend({},t.addFormParams,{type:"form",data:i.form,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:r,requestedForm:e.requestedForm,navigation:t.slideParams.navigation,view_container:t.addContainer}));for(var n in a.buttons=[$.extend(t.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.saveDataAddForm(a).done(function(){t.addContainer.destroy(),delete t.addContainer,t.currentSearchForm.performSearch(t.searchParams)})}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.addContainer.destroy(),delete t.addContainer}})],$.extend(a,{processButtons:function(){$.each(a.buttons,function(e,i){switch(i.ordinal){case 1:$(a.getButtons()[e]).click(function(){t.addContainer.destroy(),delete t.addContainer}),a.getButtons()[e].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),a.buttons[e].caption=bizagi.localization.getResource("render-form-dialog-box-close"),a.buttons[e].action="back";break;default:$(a.getButtons()[e]).click(function(){t.saveDataAddForm(a),t.addContainer.destroy(),delete t.addContainer})}})}}),a.children)a.children[n].params=$.extend({},a.children[n].params,t.addFormParams);return $.when(a.render()).done(function(e){t.currentAddForm=a.firstChild(),t.addContainer.element.html(e),r||t.slideParams.navigation.navigate(t.addContainer.id,"overlay:up"),t.addContainer.setNavigationButtons(a),a.triggerHandler("ondomincluded"),t.handleSearchFormZindex("show"),a.bind("refresh",function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.slideParams.navigation,view_container:t.addContainer},i),t.renderAddForm(i)})})}).fail(function(){t.addContainer.destroy(),delete t.addContainer,console.log("there was an error :(")}).always(function(){bizagi.util.tablet.stopLoading()})},saveDataAddForm:function(e){var t=this,i=(t.properties,$.Deferred());if(e.validateForm()){var r={};$.forceCollectData=!0,e.collectRenderValues(r),r.idPageCache=e.idPageCache;var a={action:"SAVE",data:r,idPageCache:r.idPageCache,guidEntity:e.properties.entity,contexttype:"entity"},n={};e.collectRenderValuesForSubmit(n),$.forceCollectData=!1,bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")),i.reject()):(bizagi.util.tablet.startLoading(),$.when(t.dataService.submitData(a)).done(function(){for(var r in n){var a=(o=r,void 0,"object"==typeof(s=t.currentSearchForm.getRender(o))&&null!==s?{found:!0,obj:s}:{found:!1,obj:{}});a.found&&(a.obj.setValue(n[r]),t.setDisplayValueToControl(a.obj,e,r,n))}var o,s;i.resolve()}).fail(function(t,r,a){e.addValidationMessage(a.message),i.reject()}).always(function(){bizagi.util.tablet.stopLoading()}))}else i.reject();return i},setDisplayValueToControl:function(e,t,i,r){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(r[i])},processButtons:function(){var e=this;e.slideBoxDeferred=new $.Deferred;var t={buttons:[]};return t.buttons.push({text:bizagi.localization.getResource("render-form-dialog-box-search"),click:function(){e.currentSearchForm.performSearch(e.searchParams)}}),e.slideParams.allowNew&&t.buttons.push({text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){var t={idCase:e.slideParams.idCase,idRender:e.properties.idRender,displayName:e.properties.displayName,idPageCache:e.properties.idPageCache};e.renderAddForm(t)}}),t.buttons.push({text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){e.goBack()}}),t=$.extend(t,e.slideParams),e._renderButtons(t),e.slideBoxDeferred.promise()},getSearchContainerData:function(e){var t=this,i=new $.Deferred,r={form:{properties:{},elements:[]}},a=r.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},s=[];$.each(t.searchForms,function(e,i){var r=i.default||!1,l={};l.properties={id:e,type:"tabItem",displayName:i.caption},l.elements=[],r?(o.elements.push({container:l}),a=l,n=t.searchForms[0]):s.push({container:l})}),$.each(s,function(e,t){o.elements.push(t)}),r.form.elements.push({container:o})}return bizagi.util.tablet.startLoading(),$.when(t.getSearchFormData(e,n)).done(function(e){a.elements.push(e),a.properties.id=Math.guid(),i.resolve(r)}).always(function(){bizagi.util.tablet.stopLoading()}),i.promise()},getSearchFormData:function(e,t){return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe(function(t){return t.form.properties.idRender=e.idRender,t})},goBack:function(){this.handleSearchFormZindex("hide"),this.container.destroy()},configureViewHandlers:function(){},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,function(e,i){$("<div class='action-button'>"+i.text+"</div>").click(i.click).appendTo(t)}),this.buttonContainer=t},handleSearchFormZindex:function(e){var t=jQuery.grep($(".km-modalview-root"),function(e){return"block"==$(e).css("display")});t.length>0&&("show"==e?$(t).css("z-index",0):$(t).css("z-index",10001))}}),bizagi.rendering.form.extend("bizagi.rendering.form",{init:function(e){e=e||{},this.warnings={},this.errors={},this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each(function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)}):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",function(){t.validationController=new bizagi.command.controllers.validation(t,t.validations),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.configureMediaQueryHandlers(),t.readyDeferred.resolve()}),t.bind("modalViewDidAppear",function(){t.params.navigation.modalViewDidAppear()}),t.bind("modalViewDidDisappear",function(){t.params.navigation.modalViewDidDisappear()}),$(".bz-rn-cg-checkbox-control",e).bind("click",function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)})},configureMediaQueryHandlers:function(){var e=this,t=window.matchMedia("(max-width: 600px)");function i(t){t.matches?e.container&&$(".ui-bizagi-render",e.container).addClass("vertical"):e.container&&$(".ui-bizagi-render",e.container).removeClass("vertical")}t.addListener(i),i(t)},postRenderContainer:function(e){var t=this,i=t.properties;t._super(e);var r=t.getButtons();if("tablet_android"!=bizagi.util.detectDevice()&&$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),!bizagi.util.isObjectEmpty(t.warnings)){var a=$('<ul class="ui-bizagi-form-warnings"></ul>');for(var n in t.warnings)a.append($("<li>"+n+"</li>"));$("<button>X</button>").appendTo(a),a.prependTo(t.container),a.click(function(){a.detach()})}if(!bizagi.util.isObjectEmpty(t.errors)){var o=$('<ul class="ui-bizagi-form-errors"></ul>');for(var s in t.errors)o.append($("<li>"+s+"</li>"));$("<button>X</button>").prependTo(o),o.appendTo(t.container),o.click(function(){o.detach()}),$.each(i.buttons,function(e,i){i.routing&&t.getButtons().eq(e).prop("disabled",!0)})}(r?r.length:0)&&($(document).data("auto-save","auto-save"),$(document).unbind("save-form").bind("save-form",function(e,i){t.autoSaveEvents(i)}),$(window).unbind("beforeunload").bind("beforeunload",function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")})),"tablet_android"!=bizagi.util.detectDevice()&&setTimeout(function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")},1e3)},autoSaveEvents:function(e,t){var i=this,r={},a=!1;bizagi.util.isOfflineForm({context:i})?(r=[],i.hasChanged(r),a=!bizagi.util.isEmpty(r)):(i.collectRenderValues(r),a=!$.isEmptyObject(r)),a?$.when(bizagi.showSaveBox(bizagi.localization.getResource("confirmation-savebox-message1"),"Bizagi","warning")).done(function(){i.saveForm(),e.resolve()}).fail(function(){e.resolve()}):e.resolve()},internalSubmitForm:function(e){var t,i=this,r=[],a=$.Deferred(),n=null,o=null,s=null,l=null,d=null;if((e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done(function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}),e.executeRule&&((n=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",l=i.PrepareCheckpointAction(e.id),t={},(o=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",d=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase){if(i.transitions){var c=[];if($.each(this.activeTransitions,function(e,t){t&&c.push(e)}),0==bizagi.util.countProps(c))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),a.reject(),a.promise()}(s=i.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}o&&(r.push(n),l&&r.push(l),r.push(o),d&&r.push(d),r.push(o)),s&&r.push(s),bizagi.chrono.initAndStart("submitForm-ajax");var u=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done(function(e){u.resolve(e)}).fail(function(){u.reject(),console.log("Error: It was not possible resolve async actions on form ")}):u.resolve(),$.when(u).done(function(){bizagi.util.tablet.startLoading(),$.when(i.dataService.multiaction().execute({actions:r})).done(function(t){var r;if(bizagi.chrono.stop("submitForm-ajax"),$.each(t,function(e,t){"validationMessages"==t.result.type&&(i.addValidationMessage(t.result.messages),r=!0)}),r)e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&i.triggerHandler("routing",{idCase:i.params.idCase}),e.createnewcase&&t.length>0&&i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber})}delete i.nonSupportedMethods,a.resolve()}).fail(function(t,t,r){e.executeRule&&i.sendRollbackAction(e.id),r&&r.error&&("WaitForCompletionPlanException"===r.error.errorType||"InvalidPlanStateException"===r.error.errorType||"CustomMessageException"===r.error.errorType)?(i.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(r.error.message),null,!1)).then(function(){return $.when(i.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))}).done(function(){a.resolve()}).fail(function(){a.reject()})):(i.failHandler({error:void 0===r?bizagi.localization.getResource("workportal-general-error"):r}),a.reject(r))}).always(function(){bizagi.util.tablet.stopLoading()})}).always(function(){bizagi.util.tablet.stopLoading()}),a.promise()},PrepareCheckpointAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},prepareCommitAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},getPane:function(){return this.pane},getButtons:function(){var e=this.container;return $(".ui-bizagi-button-container .action-button",e)},processButtons:function(){var e=this,t=e.getParams();t&&t.processButtons&&(0,t.processButtons)(e);var i=e.properties,r=e.getButtons();i.buttons=e.buttons||r,e.saveButton=null,e.nextButton=null;for(var a=0,n=i.buttons.length;a<n;a++)"save"==i.buttons[a].action?e.saveButton=i.buttons[a]:"next"==i.buttons[a].action&&(e.nextButton=i.buttons[a]);var o=e.getNavigation();if(void 0!==o){var s=e.getViewContainer();void 0!==s?s.setNavigationButtons(e):o.setNavigationButtons(e)}e._super()},refreshForm:function(e){var t,i=this,r=i.properties,a=i.getParams(),n=$.Deferred();return(e=e||i.getFocus())&&!e.id&&(e={id:e}),t={idCase:i.params.idCase||"",idWorkitem:i.params.idWorkitem||"",idTask:i.params.idTask||"",focus:e,selectedTabs:i.getSelectedTabs(),xpathContext:r.xpathContext,idPageCache:r.idPageCache,isRefresh:!0,action:i.getEndPointAction(),idStartScope:i.properties.idStartScope||"",navigation:a.navigation,view_container:a.view_container},(a.postRenderEdit||a.processButtons)&&(t.isOfflineForm=i.params.isOfflineForm||!1,t.formsRenderVersion=i.params.formsRenderVersion||0,t.postRenderEdit=a.postRenderEdit,t.processButtons=a.processButtons,t.originalParams=a.originalParams||{},t.getButtons=a.getButtons),$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),i.startLoading(),$.when(i.triggerHandler("refresh",t)).done(function(){setTimeout(function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")},1e3),n.resolve()}).fail(function(){n.reject()}).always(function(){i.endLoading()}),n.promise()},checkWidgetsData:function(){var e=null;if(bizagi.workportal.tablet.popup&&bizagi.workportal.tablet.popup.instance&&bizagi.workportal.tablet.popup.instance.getResponseValues){if(null===(e=bizagi.workportal.tablet.popup.instance.getResponseValues(bizagi.workportal.tablet.popup.instance.getResponseValuesParams)))return bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-complexgateway-path"),bizagi.localization.getResource("workportal-widget-complexgateway-error")),-1;bizagi.workportal.tablet.popup.instance.dontClose=!1,bizagi.workportal.tablet.popup.instance.close()}return e},repaintComplexGateway:function(){var e=this;void 0!==e.focus&&void 0!==e.focus.idCaseObject&&void 0!==e.focus.idCaseObject.isComplex&&e.dataService.getWorkitems({idCase:e.focus.idCaseObject.idCase}).done(function(t){if(1==t.workItems.length&&"ComplexGateway"==t.workItems[0].taskType){var i=t.workItems[0].transitions;e.currentPopup="complexgateway",$(document).triggerHandler("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_COMPLEXGATEWAY,options:{transitions:i,sourceElement:".ui-bizagi-form",insertAfter:".ui-bizagi-form .ui-bizagi-button-container",height:"auto",offset:"8 0",activeScroll:!1,dontClose:!0,closed:function(){e.currentPopup=null}}})}})},addWarning:function(e){this.warnings[e]=e},addError:function(e){this.errors[e]=e},processButton:function(e){var t=$.Deferred();return!bizagi.util.isObjectEmpty(this.errors)&&(t.resolve(),bizagi.util.parseBoolean(e.routing))?t.promise():this._super(e)},getNavigation:function(){return this.getFormContainer().getParams().navigation},getViewContainer:function(){return this.getFormContainer().getParams().view_container},isFloatingButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFloatingButtonsEnabled()},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()},dispose:function(e){void 0!==e&&void 0!==e.isRefresh&&0!=e.isRefresh||this._super()},failHandler:function(e){var t=this;t._super(e);var i={};try{i=JSON.parse(e)||{}}catch(t){i=e.length&&e.length>1?e[0]:e}finally{i.error&&(i=i.error),i.error&&(i=i.error),void 0!==i.code&&"AUTH_ERROR"==i.code&&($.notifier.add({class_name:"error",title:"Error",text:bizagi.localization.getResource("render-idle-expired-error","Idle timer expired. For safety reasons this view will be refreshed automatically in 5 seconds. Note that any unsaved data is lost.").replace("%s","5"),sticky:!1,time:5e3}),setTimeout(function(){t.triggerHandler("routing",{idCase:t.params.idCase,idWorkitem:t.params.idWorkitem})},5e3))}},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("form"),r=$.kendoTmpl(i,{buttons:e.buttons,transitions:e.transitions,uniqueId:t.uniqueId,helptext:t.helpText,mode:e.getMode(),queryForm:"queryForm"==e.getFormType(),summaryForm:e.params.summaryForm||!1,globalForm:e.properties.displayAsReadOnly||!1,idCase:"",displayName:e.params.displayName||"",processPath:t.processPath,breadCrumb:t.breadCrumb,orientation:t.orientation});return r=e.replaceChildrenHtml(r,e.renderChildrenHtml())}}),bizagi.rendering.panel.extend("bizagi.rendering.panel",{},{}),bizagi.rendering.tab.extend("bizagi.rendering.tab",{VISIBLE_TABS:4},{postRenderContainer:function(e){this._super(e),this.suscribeMethods()},suscribeMethods:function(){var e=this,t=e.container;$(t).bztabs({activeTab:void 0!==e.activeTab&&null!==e.activeTab?e.activeTab:0,tabNumber:e.Class.VISIBLE_TABS,domIncluded:e.ready(),activate:function(t,i){e.activeTab=$(t.currentTarget)?$(t.currentTarget).data("index"):0;var r=e.activeTab,a=e.getFormContainer(),n={};n[e.children[r].parent.properties.id]=r,a.setParam("selectedTabs",n)}})},checkPlusVisibility:function(){$(".bz-header_select > .bz-wp-tabs-ui:not(:hidden)",this.container).length<=this.Class.VISIBLE_TABS?$(".bz-wp-tabs-arrow-container.show-pluss",this.container).hide():$(".bz-wp-tabs-arrow-container.show-pluss",this.container).show()}}),bizagi.rendering.tabItem.extend("bizagi.rendering.tabItem",{},{init:function(e){this._super(e),this.tabReadyDeferred=new $.Deferred,this.loadingDeferred=new $.Deferred,this.tabActiveDeferred=new $.Deferred},setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done(function(){var e=t.parent;e&&e.container.tabs.hasOwnProperty("option")&&e.container.tabs("option","active",t.container.data("tab-counter"))})},focus:function(){this.setAsActiveContainer(),this._super()},changeVisibility:function(e){var t=this,i=t.properties,r=t.parent.container,a=t.parent.getActiveTab(),n="ui-bizagi-tab-"+i.id,o=$(".bz-wp-tabs-item[data-reference-tab='#"+n+"']",r);i.visible=bizagi.util.parseBoolean(e),$.when(t.ready()).done(function(){if(i.visible){if(t.container.css("display",""),t.setAsActiveContainer(),o&&o.css("display","none")){var e=$("div[data-reference-tab='#"+n+"']",r);e&&e.css("display","")}}else if(t.container.hide(),o&&o.css("display","block")){var a=$("div[data-reference-tab='#"+n+"']",r);a&&a.hide()}}).always(function(){r&&r.tabs.hasOwnProperty("option")&&r.tabs("option","active",a),t.parent.checkPlusVisibility()})}}),bizagi.rendering.horizontal.extend("bizagi.rendering.horizontal",{},{}),bizagi.rendering.accordion.extend("bizagi.rendering.accordion",{},{}),bizagi.rendering.accordionItem.extend("bizagi.rendering.accordionItem",{},{setAsActiveContainer:function(e){},focus:function(){this.setAsActiveContainer(),this._super()}}),bizagi.rendering.group.extend("bizagi.rendering.group",{},{postRenderContainer:function(e){var t=this.properties;this._super(e),e=this.container,t.expanded=!0,this.subscribeOnTouch()},isOpen:function(){var e=this.container;return!!$(".childrenContainer",e).is(":visible")},focus:function(){this.expand(),this._super()},expand:function(){var e=this.container;this.isOpen()||$("h1",e).trigger("click")},collapse:function(){var e=this.container;this.isOpen()&&$("h1",e).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()},subscribeOnTouch:function(){var e=this.container;$(e).find(">div.headertitle").bind("click",function(){$(e).toggleClass("collapsed")})}}),bizagi.rendering.searchForm.extend("bizagi.rendering.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,visible:!1,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var r=t.columns;$.each(r,function(t){var a={render:{}};a.render.properties={displayName:r[t].caption,xpath:r[t].xpath,editable:!1},$.extend(a.render.properties,e.parseAdditionalProperties(r[t].dataType)),0==r[t].dataType&&(a.render.properties.columnVisible=!1),7!=r[t].dataType&&8!=r[t].dataType||(a.render.properties.allowDecimals=r[t].allowDecimals),10!=r[t].dataType&&11!=r[t].dataType||(a.render.properties.allowDecimals=!0),12==r[t].dataType&&(a.render.properties.showTime=r[t].showTime),i.elements.push(a)});var a=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode()});return a.properties.inlineAdd=!1,a.properties.allowDelete=!1,a.properties.allowAdd=!1,a.properties.allowEdit=!1,e.resultsGrid=a,a.render()},postRenderContainer:function(e){var t=this,i=e.find(".ui-bizagi-container-search-criteria"),r=e.find(".ui-bizagi-container-search-results"),a=i.children(),n=t.getMode();t.container=e,$.each(a,function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}});var o=$(r.children()[0]);t.resultsGrid.postRenderElement(o),"execution"==n&&t.configureHandlers(),"design"==n&&t.configureDesignView(),"layout"==n&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;e.criteriaContainer=$(".ui-bizagi-container-search-criteria",e.container),e.resultsContainer=$(".ui-bizagi-container-search-results",e.container),e.resultsGrid.bind("rowSelected",function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)})},refreshResults:function(){this.trigger("instancerefresh"),this.resultsGrid.refresh()},onSearchFinished:function(){this.properties.deviceMaxRecordsExceeded||(this.resultsGrid.changeVisibility(!0),this.properties&&(0==this.properties.records?$(".ui-bizagi-container-search-results .ui-bizagi-label",this.container).hide():$(".ui-bizagi-container-search-results .ui-bizagi-label",this.container).show()))}}),bizagi.rendering.actionLauncher.extend("bizagi.rendering.actionLauncher",{},{postRender:function(){var e,t=this,i=t.properties,r=new $.Deferred;return t.actions=[],t.configureQueueVisibility(),t.startLoading(),$.when(t.dataService.multiaction().getActions(t.processPropertyValueArgs)).then(function(r){return r=t.getPropertiesActionLaucher(r),t.actions=r,t.deferredActions.resolve(r),i.isHorizontal?"none"!==i.templatetype?t.dataService.multiaction().getPropertyData(t.processPropertyValueDataTmplArgs).then(function(e){return t.engine.render($.extend(e,{isDefaultTemplate:"default"===i.templatetype,sessionId:t.properties.sessionId}),$.extend({},t.processPropertyValueDataTmplArgs,{formParams:t.getFormParams(t.getFormContainer())}))}).then(function(i){e=t.renderFactory.getTemplate("render-actionLauncher-horizontal");var r=$($.kendoTmpl(e,{actions:t.actions,template:!0}));return $(".template-container",r.wrap("<div>").parent()).append(i),r}):(e=t.renderFactory.getTemplate("render-actionLauncher-horizontal"),$.kendoTmpl(e,{actions:t.actions,maxItems:i.maxItems})):(e=t.renderFactory.getTemplate("render-actionLauncher-vertical"),$.kendoTmpl(e,{actions:t.actions,allowSearch:i.allowSearch,maxItems:i.maxItems}))}).done(function(e){var i=t.getControl(),a=$(".bz-action-launcher-actions-container",i);t.endLoading(),a.append(e),t.configureHandlers(),t.configureTemplateHandlers(),r.resolve(a)}).fail(function(e){t.endLoading(),r.fail(e)}),r.promise()},getFormParams:function(e){return e.parent?this.getFormParams(e.parent.getFormContainer()):e.getParams()},configureHandlers:function(){var e=this,t=e.getControl(),i=e.properties,r=void 0===i.multipleSelection||i.multipleSelection;$(".action-launcher-control",t).on("click",function(){var i=e.actions[parseInt($(this).data("index"))],a={guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5],readOnlyForm:i[6]||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};r?"Form"==a.actionType&&e.countSameActions(a)>=1&&!a.xpathContext?$(".action-to-execute-control[data-guidaction='"+a.guidAction+"'] label",t).click():$.when(e.actionManager(a)).done(function(t){e.executeAction(t)}):e.getValue().length>0?e.showConfirmationDialog(a):$.when(e.actionManager(a)).done(function(t){e.executeAction(t)})}),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())};var a=$(".action-container .wp-action-more span",t);function n(){a.addClass("km-minus").removeClass("km-plus"),$(".action-container .bz-actions-to-hide",t).removeClass("hidden")}$(".action-container .wp-action-more",t).click(function(){a.hasClass("km-minus")?(a.addClass("km-plus").removeClass("km-minus"),$(".action-container .bz-actions-to-hide",t).addClass("hidden")):n()}),$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup(function(){var e=$(this).val();$(".ui-bizagi-render-actionLauncher-actions-list .action-launcher-control",t).show(),e&&(a.hasClass("km-plus")&&n(),$(".ui-bizagi-render-actionLauncher-actions-list .action-launcher-control",t).not(":FilterAction("+e+")").hide())})},configureTemplateHandlers:function(){var e=this;e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)})},notifyExecution:function(e,t){"success"==e.response?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,r=t.getParams(),a=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,s=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:r.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:i.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)})},onCancel:function(e){}}),l={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?r.idWorkitem:void 0,additionalXpaths:a,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(l.contextType="entitytemplate",l.xpathContext=void 0,l.guidEntity=e.guidEntity,l.rewriteContextType=!0),s.render(l),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=new $.Deferred,o=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,s=""!==o?printf("%s[id=%s]",o,e.idEntity):o,l=""!==o?printf("%s[]",o):o,d=r.getParams();return new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:d.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(r){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:r,xpathContext:s,idPageCache:r.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){n.resolve(e.IdScope)}):t.dataService.addGridRecordData({idRender:i.id,xpathContext:o,contexttype:"start",idPageCache:r.idPageCache,submitData:r}).done(function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),n.resolve(i.IdScope)})},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:d.idCase,additionalXpaths:a,xpathContext:e.editMode?s:l,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),n.promise()},processStartForm:function(e){var t=this,i=new $.Deferred;e=e||{};var r=t.getFormContainer().getParams();return new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{title:e.title||"",navigation:r.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"===t.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){i.resolve(e.IdScope)})}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?r.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),i.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.executeActionImmediately(e)})}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.setValue([]),$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})})},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-action-launcher-actions-to-execute-container",i),a=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done(function(i){$.each(e,function(t,r){var a,n,o=(a=r.guidAction,n=[],$.each(i,function(e,t){t[4]==a&&(n=t)}),n);e[t].displayName=o[1],e[t].guidProcess=o[0],e[t].actionType=o[3],e[t].xpathContext=o[5],e[t].readOnlyForm=o[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)}),$.when($.kendoTmpl(a,{actions:e})).done(function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control .delete-action",r),a=$(".action-to-execute-control label",r);i.on("click",function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)}),a.on("click",function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("readonlyform")||!1,l=e.data("identity")||"",d=e.data("guidaction"),c=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:c});break;case"Form":var u={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,readOnlyForm:s,idEntity:l,recordXpath:c};if(u.xpathContext)t.processActionFormCollection(u);else{u.xpathContext=void 0;var p={},g=t.value.filter(function(e){return e.guidAction==d});g.length>0&&(p={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||g[0].guidEntity}),t.processActionForm($.extend(u,p))}}})})})},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".action-to-execute-label",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.actionLauncher.extend("bizagi.rendering.entityTemplate",{},{postRender:function(){var e=this,t=e.properties,i=new $.Deferred;return e.actions=[],e.configureQueueVisibility(),e.startLoading(),e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then(function(i){return e.engine.render(i,e.processPropertyValueDataTmplArgs).then(function(i){var r=e.renderFactory.getTemplate("render-actionLauncher-horizontal");if(t.allowactions)return e.dataService.multiaction().getActions(e.processPropertyValueArgs).then(function(t){e.deferredActions.resolve(t),e.actions=t;var a=$($.kendoTmpl(r,{actions:e.actions,template:!0}));return $(".template-container",a.wrap("<div>").parent()).append(i),a});var a=$($.kendoTmpl(r,{template:!0}));return $(".template-container",a.wrap("<div>").parent()).append(i),a})}).done(function(t){var r=e.getControl(),a=$(".bz-action-launcher-actions-container",r);e.endLoading(),a.append(t),e.configureHandlers(),e.configureTemplateHandlers(),i.resolve(a)}).fail(function(t){e.endLoading(),i.fail(t)}),i.promise()},configureHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],xpathActions:e.properties.xpathActions||""};"Form"===i.actionType&&(i.xpathContext=void 0,i.contextType="entitytemplate",i.guidEntity=e.properties.guidEntity),$.when(e.actionManager(i)).done(function(t){e.executeAction(t)})})},configureTemplateHandlers:function(){var e=this;e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)})}}),bizagi.rendering.polymorphicLauncher.extend("bizagi.rendering.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties;return"design"!=t.getMode()&&t.properties.surrogatedKey?(t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done(function(r){r=t.dataService.serializePolymorphicActions(r),t.totalActions=bizagi.clone(r);var a=bizagi.clone(r);t.lessActions=bizagi.clone(a);var n={actions:a,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(a)};e=t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");var o=t.getControl();$(".bz-polymorphic-launcher-constructors-container",o).append($.kendoTmpl(e,n)),t.bindHandlers()})):""},getTreeItems:function(e,t){var i=this,r="<ul>",a=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,function(e,n){r+=$.kendoTmpl(a,n),n.children&&(r+=i.getTreeItems(n.children,t+1))}),r+="</ul>"},bindHandlers:function(){var e=this,t=e.getControl();$(".bz-polymorphic-launcher-constructors-container li span",t).on("click",function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)}),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup(function(){var e=$(this).val();$(".bz-polymorphic-launcher-constructors-container li",t).show(),e&&$(".bz-polymorphic-launcher-constructors-container li",t).not(":FilterAction("+e+")").hide()})},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})},notifyExecution:function(e,t){"success"==e?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=new $.Deferred,o=(e.xpathContext,r.getParams()),s=t.properties.recordXpath,l=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:o.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){var r=i.idPageCache;return i.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:l.form.properties.xpathContext,idPageCache:r,isOfflineForm:!1,isActionStartForm:!0}).done(function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),n.resolve(i.IdScope)})},onCancel:function(e){}});return l.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?o.idWorkitem:void 0,additionalXpaths:a,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,recordXpath:s}),n.promise()},processStartForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=new $.Deferred,n=r.getParams();return e=e||{},new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",navigation:n.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return r.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){r.endLoading(),a.resolve(e.IdScope)})}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?n.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),a.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.executeActionImmediately(e)})}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.setValue([]),$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})})},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-polymorphic-launcher-constructors-to-execute-container",i),a=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.kendoTmpl(a,{actions:e})).done(function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control .delete-action",r),a=$(".action-to-execute-control label",r);i.on("click",function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)}),a.bind("click",function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("identity")||"",l=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:d});break;case"Form":var c={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,idEntity:s,guidEntity:l,guidObject:r};t.processActionForm(c)}})})},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-polymorphic-launcher-constructors-to-execute-container",e),i=$(".actions-to-execute-title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.text.extend("bizagi.rendering.text",{},{postRender:function(){var e=this.properties;this._super(),e.maxLength>0&&this.input.prop("maxlength",e.maxLength)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.kendoTmpl(e,{})},postRenderReadOnly:function(){var e=this.getControl();this._super(),this.input=e.find(".bz-rn-readonly")},setDisplayValue:function(e){var t=this.properties,i=bizagi.util.decodeURI(e);if(!bizagi.util.isEmpty(e)&&t.editable)e=(e=e.replaceAll("\\n"," ").replaceAll("\n"," ")).replaceAll("&amp;","&"),this.input.prop("value",e);else if(!this.properties.editable)if("string"==typeof(e="boolean"==typeof e?e.toString():e)){var r=this.getDisplayValue(),a=bizagi.util.decodeURI(r).replaceAll("&","&amp;");a=(a=(a=(a=a.replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"),this.input.html(a)}else bizagi.util.isNull(e)&&this.input.html("");this.setValue(i,!1)},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur(function(){var t=$(this);if("hidden"!==$(t).attr("type")&&"none"!==$(t).css("display")&&"hidden"!==$(t).css("visibility"))if(t.data("oldValue")&&""!==$(this).data("oldValue"))t.val()!==t.data("oldValue")?(e.setValue(""),t.val(""),t.data("oldValue",""),t.tooltip("destroy"),t.attr("title",e.getResource("render-text-retype-error")),t.tooltip(),t.tooltip("open"),setTimeout(function(){t.focus()},100)):(t.data("newValue",t.val()),t.data("oldValue",""),t.tooltip("destroy"));else{if(""===t.val()||t.val()===t.attr("newValue"))return;t.data("oldValue",t.val()),t.val("");try{t.tooltip("destroy")}catch(e){}t.attr("title",e.getResource("render-number-retype")),t.tooltip(),t.tooltip("open"),setTimeout(function(){t.focus()},100)}})}}),bizagi.rendering.extendedText.extend("bizagi.rendering.extendedText",{},{init:function(e){this._super(e);var t=this.properties;t.rowSize=t.rowSize||6},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlyExtendedText");return $.kendoTmpl(e)},postRender:function(){var e=this,t=e.properties,i=0;if(this._super(),t.editable?e.textarea=$(".ui-bizagi-render-text-extended",e.getControl()):e.textarea=$(".ui-bizagi-render-text-extended pre",e.getControl()),e.textarea.length>0){e.textarea.prop("rows",t.rowSize),t.maxLength>0&&e.textarea.attr("maxlength",t.maxLength);var r=function(){clearInterval(a)},a=t.autoExtend?setInterval(function(){(i>2e3||void 0!==e.textarea&&e.textarea[0]&&e.textarea[0].scrollHeight>0)&&(e.autoAdjustExtendedFrame(e.textarea[0]),r()),i+=500},500):null}},postRenderReadOnly:function(){this.element.addClass("bz-rn-read-only bz-rn-non-editable"),this.textarea=$(".ui-bizagi-render-text-extended pre",this.getControl())},setDisplayValue:function(e){var t=this.properties,i=bizagi.util.decodeURI(e),r=bizagi.util.isOfflineForm({context:this});if(e="string"==typeof i?i:"",this._super(e),e&&t.editable){r&&(e="object"==typeof e&&e.value?e.value:e);var a=$.br2nl(e);this.textarea.val(a)}},configureHandlers:function(){var e=this,t=e.properties;e._super(),t.maxLength>0&&t.autoExtend&&$(e.textarea).bind("keydown keypress",function(t){e.autoAdjustExtendedFrame(this)})},autoAdjustExtendedFrame:function(e){if(e.scrollHeight<=0){var t=$(document.createElement("div")),i=null;$(t).attr("display","none"),$("body").append(t),i=(i=$(e).val()).replace(/\n/g,"<br>"),t.html(i+"<br>"),$(e).css("height",t.height()),t.remove()}else for($(e).height()>100&&$(e).height($(e).height()-20);$(e).outerHeight()<e.scrollHeight;)$(e).height($(e).height()+1)}}),bizagi.rendering.label.extend("bizagi.rendering.label",{},{postRender:function(){this.getLabel().addClass("ui-bizagi-render-label")},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("ui-bizagi-render-label")}}),bizagi.rendering.number.extend("bizagi.rendering.number",{},{renderReadOnly:function(){var e=this._super(),t=this.renderFactory.getTemplate("readonlyNumber");return $.kendoTmpl(t,{value:e})},postRender:function(){this._super(),this.numericInput=$("input",this.getControl()),","==this.properties.decimalSymbol&&this.numericInput.attr("lang","en-150");var e=$("input",this.element);e&&e.length},postRenderReadOnly:function(){var e=this.getControl();e.closest(".ui-bizagi-render").addClass("bz-rn-read-only"),this.numericInput=$(".ui-bizagi-render-numeric",e)},setDisplayValue:function(e){var t=this.properties;this.setValue(e,!1),"string"!=typeof e&&"number"!=typeof e||(t.editable&&this.numericInput?(this.numericInput.prop("value",e),this.executeFormatCurrencyPlugin()):t.editable||this.numericInput.text(this.getDisplayValue()))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur(function(){var t=$(this);e.retypeDouble(t)})},retypeDouble:function(e){if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===e.val())return;if(e.val()!==e.data("oldValue")){this.setValue(""),e.val(""),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}e.attr("title",this.getResource("render-number-retype-fail")),e.tooltip(),e.tooltip("open"),setTimeout(function(){e.focus()},100)}else{e.data("newValue",e.val()),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}}}else{if(""===e.val()||e.val()===e.attr("newValue"))return;e.data("oldValue",e.val()),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",this.getResource("render-number-retype")),e.tooltip(),e.tooltip("open"),setTimeout(function(){e.focus()},100)}}}),bizagi.rendering.numberScientificNotation.extend("bizagi.rendering.numberScientificNotation",{},{postRender:function(){var e=this.getControl();this.inputDisplay=$("input",e).first(),this.numericInput=this.input=$("input",e).last(),this.numericIcon=$("span",this.getControl()),this.numericInput.numericSN(this.properties.decimalSymbol),this.attachFormatSientificNotation()},setDisplayValue:function(e){var t=this.properties,i=(e=bizagi.util.scientificNotationFormat(e,t.decimalSymbol,38),bizagi.util.scientificNotationFormat(e,t.decimalSymbol,20));this._super(i),null!=e&&t.editable&&(this.numericInput.val(e),this.inputDisplay.val(i))},attachFormatSientificNotation:function(){var e=this;e.inputDisplay.focus(function(){$(this).val(e.getDisplayValue())}),e.inputDisplay.blur(function(){void 0===e.getFormContainer().validationController&&(e.getFormContainer().validationController=new bizagi.command.controllers.validation(e.getFormContainer(),e.validations));var t=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,38),i=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,20);e.numericInput.val(t),e.inputDisplay.val(i),e.setValue(t)})}}),bizagi.rendering.date.extend("bizagi.rendering.date",{DEFAULT_PROPERTIES:{maxYearsToDisplay:100}},{initializeDateControl:function(){var e=this.getControl();this.input=$(".bz-rn-date-control",e)},configureHandlers:function(){},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlyDate");return $.kendoTmpl(e,{})},postRenderReadOnly:function(){this._super();var e=this.getControl();$("i",e).addClass("bz-calendar-input"),this.input=$("span",e),this.isValidMinMaxValue()||(this.setValue(""),this.input.prop("value",""),this.properties.displayValue="")},postRender:function(){var e=this;e._super(),e.initializeDateControl();var t=e.getDateControl(),i=e.properties.showTime?["calendar","time"]:["calendar"],r=e.getFormattedDate(e.properties.value,e.properties.showTime,!0),a=e.getFormattedDate(e.properties.minValue,e.properties.showTime,!1),n=e.getFormattedDate(e.properties.maxValue,e.properties.showTime,!1),o=e.properties.showTime?e.getTimeFormat():"";if(isNaN(Date.parse(a))&&((a=new Date).setFullYear(a.getFullYear()-e.Class.DEFAULT_PROPERTIES.maxYearsToDisplay),a.setHours(0,0,0,0)),isNaN(Date.parse(n))&&((n=new Date).setFullYear(n.getFullYear()+e.Class.DEFAULT_PROPERTIES.maxYearsToDisplay),n.setHours(23,59,59)),$(".bz-calendar-input",e.control).click(function(){t.click()}),e.isValidMinMaxValue()||(e.setValue(""),e.input.prop("value",""),e.properties.displayValue=""),t.mobiscroll().calendar({mode:"mixed",display:"bottom",controls:i,min:a,max:n,defaultValue:r,timeFormat:o,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",buttons:["set",{text:this.getResource("render-plugin-search-users-clear-button-name"),handler:function(t,i){e.date=void 0,e.time=void 0,e.timeS=void 0,e.onChangeHandler(!0),i.clear()}},"cancel"],onSet:function(t,i){var r=i.getVal();e.date={day:r.getDate(),month:r.getMonth(),year:r.getFullYear()},e.properties.showTime&&(e.time={hours:r.getHours(),minutes:r.getMinutes()},e.is24h||(e.timeS=r.getHours()<12?"am":"pm")),e.onChangeHandler()},onBeforeShow:function(t,i){e.triggerGlobalHandler("modalViewDidAppear",{}),e.changeMinValue(e.properties.minValue),e.changeMaxValue(e.properties.maxValue)},onClose:function(t,i){e.triggerGlobalHandler("modalViewDidDisappear",{}),$(".mbsc-fr-scroll").css("overflow-y","auto")},onShow:function(e,t){$(".mbsc-fr-scroll").css("overflow-y","hidden")}}),t.on("focus",function(e){e.preventDefault(),e.stopPropagation(),bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.close())}),""===e.properties.displayValue&&e.properties.value){var s=e.getFormattedDate(e.properties.value,e.properties.showTime,!0,!1);if(void 0!==s){var l=bizagi.util.dateFormatter.formatDate(s,e.properties.fullFormat);e.input.prop("value",l)}}t.attr("keyboard","disable")},getTimeFormat:function(){return-1!==this.properties.timeFormat.indexOf("H")||-1!==this.properties.timeFormat.indexOf("HH")?(this.is24h=!0,"HH:ii"):(this.is24h=!1,"hh:ii A")},getFormattedDate:function(e,t,i){if(e&&!bizagi.util.isObjectEmpty(e)){var r=t&&("0:0"===this.getTime()||i)?" "+e.substr(e.length-8,e.length):"",a=i&&t&&r.split("/").length>1||1===e.split(":").length?e+=" 00:00:00":e;e=bizagi.util.dateFormatter.getDateFromInvariant(a,t);var n=t?""!==r?r:" "+this.getTime():" 00:00",o=this.setHour(this.getFullFormatedDate(e,n));return o=bizagi.util.dateFormatter.getDateFromISO(o,!0)}},changeMinValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{min:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{min:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{max:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{max:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.maxValue=e)},setDisplayValue:function(e){var t=this.properties,i=this.getFormattedDate(e,t.showTime,!1),r=this.preprocessDateValue(i);!1===t.editable?"string"!=typeof r&&"number"!=typeof r||this.input.html(r):this.input.prop("value",r)},getDateControl:function(){return $("input.bz-rn-date-control",this.getControl())},getTime:function(){var e=this;if(e.properties.showTime&&e.time&&""!==e.time.minutes){var t=e.time.hours+":"+e.time.minutes;return-1!=(t+=e.timeS).indexOf("am")&&12==e.time.hours&&(t=t.replace("12","0")),-1!=t.indexOf("pm")&&e.time.hours<12&&(t=t.replace(e.time.hours,parseInt(e.time.hours)+12)),t.replace(/(am|pm)/,"")}return""},getDate:function(){return this.date&&""!==this.date.month?this.date.year+"-"+(parseInt(this.date.month)+1)+"-"+this.date.day:""},onChangeHandler:function(e){var t=this,i=t.properties,r=t.getDate(),a=i.showTime?" "+t.getTime():" 0:00";if(""===r&&!i.showTime||""===r&&""===a||e)t.setValue(""),t.input.prop("value",""),i.displayValue="";else{var n=t.setHour(t.getFullFormatedDate(r,a));if(!(n=bizagi.util.dateFormatter.getDateFromISO(n,!0))||0==n)return;t.setNewDateValue(n,i.showTime);var o=t.preprocessDateValue(n);i.displayValue=o,t.input.prop("value",t.properties.displayValue)}},getFullFormatedDate:function(e,t){var i="";i=e.length>0?e:void 0!==e?bizagi.util.dateFormatter.formatISO(e,!1):bizagi.util.dateFormatter.formatISO(new Date,!1),i+=t;var r=bizagi.util.dateFormatter.getDateFromFormat(i,"yyyy-MM-dd H:m");return bizagi.util.dateFormatter.formatDate(0!==r?r:e,"yyyy-MM-dd H:mm:ss")},setNewDateValue:function(e,t){var i=""!=e?bizagi.util.dateFormatter.formatInvariant(e,t):"";this.setValue(i)},applyDateFormat:function(e,t){if(!t){var i=null,r=(i=-1!=e.indexOf("00:00")?e.indexOf("00:00"):-1!=e.indexOf("0:00")?e.indexOf("0:00"):-1!=e.indexOf("12:00")?e.indexOf("12:00"):"-1")+8;e=-1===i?e:e.replace(e.substring(i,r),"").replace(" am","").replace(" pm","")}return e},preprocessDateValue:function(e){var t=this.properties;return bizagi.util.dateFormatter.formatDate(e,t.fullFormat)},isValid:function(e){var t=this,i=t.properties,r=!0,a=t.getValue();if(a&&bizagi.util.parseBoolean(i.editable)&&0!==(a=bizagi.util.dateFormatter.getDateFromInvariant(a))&&(a.setHours(0,0,0,0),i.minValue&&"string"==typeof i.minValue&&(r=!t.validateMinAndMaxValue(a,!0,i,e)&&r),i.maxValue&&"string"==typeof i.maxValue&&(r=!t.validateMinAndMaxValue(a,!1,i,e)&&r)),bizagi.util.parseBoolean(i.editable))if(i.required&&t.hasValue()){var n=t.getDateControl();n.length>0&&n.val().length<=0&&(r=t.showMandatoryMessage(i,e))}else i.required&&!t.hasValue()&&t.showMandatoryMessage(i,e);return r&&t.setValidationMessage(""),r},validateMinAndMaxValue:function(e,t,i,r){var a=bizagi.util.dateFormatter.getDateFromInvariant(t?i.minValue:i.maxValue);if(0==a){var n="";-1==i.timeFormat.indexOf(":ss")&&(n=t?i.minValue+":00":i.maxValue+":00"),a=bizagi.util.dateFormatter.getDateFromFormat(n,i.fullFormat+":ss")}if(a.setHours(0,0,0,0),t&&e<a||!t&&e>a){var o=bizagi.util.dateFormatter.formatDate(a,i.fullFormat),s=t?this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",o):this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",o);return r.push({xpath:i.xpath,message:s}),!0}return!1},showMandatoryMessage:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",e.displayName);return t.push({xpath:e.xpath,message:i}),!1},setHour:function(e){return e.replace(" 0:"," 00:").replace(" 1:"," 01:").replace(" 2:"," 02:").replace(" 3:"," 03:").replace(" 4:"," 04:").replace(" 5:"," 05:").replace(" 6:"," 06:").replace(" 7:"," 07:").replace(" 8:"," 08:").replace(" 9:"," 09:")},clearDisplayValue:function(){this.date=void 0,this.time=void 0,this.timeS=void 0,this.onChangeHandler(!0),this.setDisplayValue("")},isValidMinMaxValue:function(){var e=!0,t=this.getValue();return t&&0!==(t=bizagi.util.dateFormatter.getDateFromInvariant(t))&&(t.setHours(0,0,0,0),this.properties.minValue&&"string"==typeof this.properties.minValue&&(e=this.validateMinAndMaxValue(t,!0)),this.properties.maxValue&&"string"==typeof this.properties.maxValue&&(e=this.validateMinAndMaxValue(t,!1))),e},validateMinAndMaxValue:function(e,t){var i=t?this.properties.minValue:this.properties.maxValue,r=bizagi.util.dateFormatter.getDateFromInvariant(i);return r.setHours(0,0,0,0),!(t&&e<r||!t&&e>r)}}),bizagi.rendering.yesno.extend("bizagi.rendering.yesno",{},{postRender:function(){var e=this,t=e.getControl();this._super(),t.addClass("ui-bizagi-render-display-block"),t.addClass("ui-bizagi-render-boolean-yesno"),t.bind("optiongroupchange",function(t,i){e.value!=i.value&&e.setValue(i.value)}),t.find(".ui-bizagi-render-boolean-radio").bind("click",function(){e.getControl().find(".ui-bizagi-render-boolean-radio").removeClass("ui-radio-state-checked"),e.getControl().find(".ui-bizagi-render-boolean-radio").removeClass("bz-check").addClass("bz-unchecked"),$(this).addClass("ui-radio-state-checked"),$(this).addClass("ui-radio-state-checked").addClass("bz-check").removeClass("bz-unchecked");var t=$(this).attr("value");e.value!=t&&e.setValue(t)})},setDisplayValue:function(e){var t=this.properties,i=this.getControl();if(this.setValue(e.toString().toLowerCase(),!1),null!=e&&t.editable){var r=bizagi.util.parseBoolean(e);i.find(".ui-bizagi-render-boolean-radio.yes").prop("checked",!0===r).toggleClass("bz-unchecked",!0!==r).toggleClass("bz-check",!0===r),i.find(".ui-bizagi-render-boolean-radio.no").prop("checked",!1===r).toggleClass("bz-unchecked",!1!==r).toggleClass("bz-check",!1===r)}else this._super(e)}}),bizagi.rendering.check.extend("bizagi.rendering.check",{},{postRender:function(){var e=this;e._super(),e.input=e.getControl().find("input"),e.input.change(function(){var t=e.input.is(":checked");t?e.input.removeClass("bz-unchecked").addClass("bz-check"):e.input.addClass("bz-unchecked").removeClass("bz-check"),e.setValue(t)})},setDisplayValue:function(e){var t=this.properties,i=this.getControl().find("input");this.setValue(e,!1);var r="";r=t.editable?bizagi.util.parseBoolean(e):bizagi.util.parseBoolean(this.properties.value),i.prop("checked",!0===r),i.toggleClass("bz-check",!0===r).toggleClass("bz-unchecked",!0!==r)}}),bizagi.rendering.combo.extend("bizagi.rendering.combo",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlyCombo");return $.kendoTmpl(e,{})},initializeCombo:function(){var e=this;e._super();var t=e.properties,i=e.getRenderedElement(),r=e.getControl(),a={};e.showDisplayValue=!1,e.input=$(".bz-rn-combo-control",r),t.parentComboValue&&null!=t.parentComboValue&&(a[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t.parentComboValue,e.showDisplayValue=e.parentCombo&&e.parentCombo.value&&""!==e.parentCombo.value.value&&e.properties.value&&e.properties.value.value),t.editable?void 0===e.initialValueSet||e.initialValueSet?e.configureCombo():$.when(e.renderCombo(a)).done(function(t){e.getControl().html(t),e.input=e.combo=e.getControl(),e.configureCombo(),e.processLayout(!1,e.properties.valueFormat||{})}):(e.inputSpan=$(".bz-rn-text",r),i.addClass("bz-rn-non-editable bz-command-edit-inline"),null!=e.value&&e.inputSpan.text(e.value.value||e.value.id))},postRender:function(){this.initializeCombo();var e=this.properties,t=this.getRenderedElement();e.editable&&t.addClass("bz-command-edit-inline"),this.configureHelpText(),this._super(),this.processLayout(!1,this.properties.valueFormat||{})},postRenderReadOnly:function(){var e=this.getControl(),t=this.getValue();e.closest(".ui-bizagi-render").addClass("bz-rn-read-only"),this.inputSpan=$(".bz-rn-text",e),t?(null!=t.value&&"boolean"==typeof t.value&&(1==bizagi.util.parseBoolean(t.value)?t.value=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(t.value)&&(t.value=this.getResource("render-boolean-no"))),this.getResource("render-combo-empty-value")==t.value||this.getResource("render-combo-empty-selection")==t.value?this.inputSpan.text(""):this.inputSpan.text(this.formatItem(t.value))):this.inputSpan.text("")},configureCombo:function(){var e=this;e.inputSpan=e.input.find(".bz-rn-cm-text-label"),e.inputSpan.html($("option:selected",e.input).text()),e.inputSpan.val($("option:selected",e.input).text()),$(".bz-rn-container-combo",e.control).unbind().bind("click",function(){e.input.find(".bz-rn-combo-control").blur(),$(e.input).blur(),e.input.attr("keyboard","disable"),e.processComboData(e.properties.data);var t=e.renderFactory.getTemplate("comboModalView"),i=kendo.template(t,{useWithBlock:!1}),r={items:e.properties.data,displayName:e.properties.displayName||"",orientation:e.properties.orientation},a=$($.trim(i(r)));a.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.configureModalViewHandlers(a),e.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open"),a.closest(".k-animation-container").addClass("bz-rn-new-modalview-position")})},configureModalViewHandlers:function(e){var t=this,i=new $.Deferred,r=e.find(".bz-wp-modalview-results-list li");e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.delegate("#ui-bizagi-cancel-button","click",function(){i.reject(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-header-input-search").bind("change keypress  keyup change",function(){t.filterList(this.value,r,e)}),e.find(".bz-wp-modalview-header-cancel-search").bind("click",function(){t.filterList("",r,e),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)}),t.list=$(".bz-wp-modalview-results-list",e),t.setModalViewDisplayValue(t.properties.value||!1),t.inputSpan=e.find(".bz-rn-cm-text-label"),t.inputSpan.html($("li.ui-selected",t.list).text()),t.inputSpan.val($("li.ui-selected",t.list).text()),t.list.find("li").bind("click",function(){var i=t.list.find(".ui-state-active");t._newSelectedElement=this,i.each(function(e,i){t._newSelectedElement.id!==i.id&&$(i).removeClass("ui-state-focus ui-selected ui-state-active")}),$(this).addClass("ui-state-focus ui-selected ui-state-active"),t.input.blur(),$(".bz-wp-modalview-header-input-search",e).blur()}),e.delegate(".ui-bizagi-apply-button","click",function(){i.resolve(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-close").bind("click",function(){i.reject(),e.data("kendoMobileModalView").close()}),$.when(i).done(function(){var e=$("li.ui-selected",t.list),i={id:$(e).data("value"),value:$(e).text()};t.selectedValue=i.value,t.setDisplayValue(i)}).fail(function(){})},filterList:function(e,t,i){""!==e?i.find(".bz-wp-modalview-header-cancel-search").show(500):i.find(".bz-wp-modalview-header-cancel-search").hide(500),t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},actionSave:function(){var e=this.inputEdition.find(".bz-rn-combo-selected"),t=e.find(">div >span").html(),i={id:e.attr("id"),value:t};this.changeCombo(t,i)},setModalViewDisplayValue:function(e){var t=this.properties;this.list&&t.editable&&null!=e&&""!==e.id&&this.list.find("#ui-bizagi-list-"+e.id).addClass("ui-state-focus ui-selected ui-state-active")},processComboData:function(e){var t=this;e.forEach(function(e){t.validateValue(e)})},validateValue:function(e){if(!bizagi.util.isEmpty(e)&&void 0!==e.id&&("number"==typeof e.id&&null!==e.id||"string"==typeof e.id&&e.id.length>0)){if(null!==e.value&&"boolean"==typeof e.value)!0,!0===bizagi.util.parseBoolean(e.value)?e.value=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=bizagi.localization.getResource("render-boolean-no"));else if(null!=e.value&&"object"==typeof e.value)for(var t=0,i=e.value.length;t<i;t++)null!=e.value[t]&&"boolean"==typeof e.value[t]&&(!0===bizagi.util.parseBoolean(e.value[t])?e.value[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[t])&&(e.value[t]=bizagi.localization.getResource("render-boolean-no")))}},setDisplayValue:function(e){if(e&&"object"==typeof e&&void 0!==e.label){var t=""==e.label||bizagi.util.isNumeric(e.label)?this.findDataValueById(e.value).value||"":e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.value,value:t}}var i=this.getControl();$("input",i).val(this.formatItem(e.value)),this.setValue(e)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=[],e.remoteDataLoaded=!1},cleanData:function(){this.setDisplayValue({id:"",value:""})},getTemplateName:function(){return"combo"},getTemplateEditionName:function(){return"edition.combo"}}),bizagi.rendering.upload.extend("bizagi.rendering.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{renderControl:function(){var e=this,t=e.properties,i=e.renderFactory.getTemplate("upload"),r=!0,a="";e.checkExtensions(),bizagi.util.isCordovaSupported()&&(r=e.validOptions&&(e.validOptions.image||e.validOptions.video));for(var n=$.kendoTmpl(i,{xpath:bizagi.util.encodeXpath(e.getUploadXpath()),editable:t.editable&&r,noFiles:0==e.filesCount,allow_upload:r,nonSupportedExtension:e.nonSupportedExtension,allowSendInMail:t.allowSendInMail}),o=0;o<e.filesCount;o++){var s={id:e.files[o][0],fileName:e.files[o][1]};a+=e.renderUploadItem(s)}return n=e.replaceFilesHtml(n,a)},postRender:function(){var e=this,t=e.properties;e._super(),(bizagi.util.isCordovaSupported()||bizagi.util.media.fileAPISupported())&&t.editable?bizagi.util.isCordovaSupported()?e.activateUploadNative():e.activeUploadWebControl():e.addEventToOpenSlide(),$("ul.files",e.getControl()).on("click",".ui-bizagi-render-link.button",function(t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).data("url"),this.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})})},postRenderReadOnly:function(){var e=this,t=e.getControl();(e._super(),!bizagi.util.isOfflineForm({context:e})&&void 0!==e.files&&e.files.length>0)&&t.find(".ui-bizagi-render-link").on("click",function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).data("url"),this.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})})},addEventToOpenSlide:function(){var e=this,t=e.getMode(),i=e.getControl();e.itemAddfile=$(".bz-rn-upload-show-menu",i),e.itemAddfile.hide(),bizagi.util.isCordovaSupported()||bizagi.util.media.fileAPISupported()||e.element.addClass("bz-rn-read-only"),$("li",i).click(function(i){if("execution"===t){bizagi.loading.start(),i.preventDefault(),i.stopPropagation();var r=this.title||$(this).data("name");$.when(bizagi.util.media.downloadFile($(this).data("url"),r)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})}})},activateUploadNative:function(){var e=this,t=e.properties,i=e.getControl();if(e.renderControl(),e.itemAddfile=$(".bz-rn-upload-show-menu",i),bizagi.util.isCordovaSupported()&&t.editable||e.itemAddfile.hide(),e.checkMaxFiles(),e.attachDeleteHandler(),!e.validOptions||e.validOptions.image||e.validOptions.video){var r=e.renderFactory.getTemplate("uploadModalView"),a=kendo.template(r,{useWithBlock:!1}),n=bizagi.util.isOfflineForm({context:e}),o=$.trim(a({editable:e.properties.editable,noFiles:e.properties.noFiles,displayName:e.properties.displayName||"",validExtensions:e.validOptions,isOfflineForm:n}));e.itemAddfile.bind("click",function(t){var i=new kendo.mobile.ui.ModalView(o,{close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},modal:!1,useNativeScrolling:!0});e.configureModalViewHandlers(i.element),e.triggerGlobalHandler("modalViewDidAppear",{}),i.open()})}else $("> *",e.itemAddfile).hide()},configureModalViewHandlers:function(e){var t=this;t.listOptions=e.find(".bz-rn-upload-options li"),t.listOptions.bind("click",function(){t.applyPlugin($(this).data("role"),this.getBoundingClientRect())}),e.find(".bz-wp-modalview-close").bind("click",function(){e.data("kendoMobileModalView")&&e.data("kendoMobileModalView").close()})},attachDeleteHandler:function(){var e=this,t=e.getControl();$(".bz-rn-upload-delete-icon",t).bind("click",function(){var t=$(this).parent(".ui-bizagi-render-upload-item"),i=t.data();$.when(e.deleteUploadItem(t,i.id)).done(function(){t.hide(),t.remove(),e.setValue(e.files,!1),e.checkMaxFiles(),e.triggerRenderChange()})})},applyPlugin:function(e,t){var i,r=this,a=bizagi.util.getAndroidVersion();switch(i=a&&a<=4.4?[{guid:4,displayName:bizagi.localization.getResource("workportal-size-original")}]:bizagi.util.media.getImageResolutionItems(),$(".bz-resolution-container",r.getControl()).actionSheet({actions:i,actionClicked:function(e){bizagi.loading.start(),$.when(r.resolutionButtonHandler(e.guid)).always(function(){bizagi.loading.stop()})},appear:function(e){r.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(e){r.triggerGlobalHandler("modalViewDidDisappear",{})}}),e){case"image":var n=bizagi.util.isOfflineForm({context:r}),o=new CameraPopoverOptions(t.left,t.top-20,200,100,4),s={quality:r.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:o};navigator.camera.getPicture(function(e){r.dataImage=e;var t=r.Class.EXTENSIONSIMG.concat(r.Class.EXTENSIONSVIDEO);bizagi.loading.start(),r.closeModalView(),$.when(bizagi.util.media.checkMaxSize(e,r.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(r.dataImage)).then(function(e){if(r.fileProperties=e,bizagi.util.media.checkFileTypes(e,r.properties,t)){var i=bizagi.util.getAndroidVersion();if(i&&i<=4.2||n)return r.saveImage(r,r.dataImage);if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return r.resolutionButtonHandler(e)});$(".bz-resolution-container",r.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},r.onFail.bind(r),s);break;case"file":break;case"cimage":navigator.camera.getPicture(function(e){bizagi.loading.start(),r.closeModalView(),$.when(bizagi.util.media.checkMaxSize(e,r.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(t){return r.fileProperties=t,r.saveImage(r,e)})}).always(function(){bizagi.loading.stop()})},r.onFail.bind(r),{quality:r.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0});break;case"cvideo":navigator.device.capture.captureVideo(function(e){bizagi.loading.start(),r.closeModalView(),$.when(bizagi.util.media.checkMaxSizeVideo(e,r.properties)).then(function(){return r.saveVideo(r,e)}).always(function(){bizagi.loading.stop()})},r.onFail.bind(r),{limit:r.Class.LIMIT})}},closeModalView:function(){var e=this.listOptions.closest(".modalview-upload-options");this.listOptions&&e&&e.data("kendoMobileModalView")&&e.data("kendoMobileModalView").close()},resolutionButtonHandler:function(e){var t=this,i=e||0;if($(".ui-bizagi-resolution-container").css("display","none"),$(".ui-bizagi-mask").remove(),i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t,t.dataImage);var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t,t.dataImage)})},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},renderUploadItem:function(e){var t=this.properties,i=this.getMode(),r=this.renderFactory.getTemplate("uploadItem"),a="execution"!==i?"javascript:void(0);":this.buildItemUrl(e);return $.kendoTmpl(r,{url:a,image:!1,allowDelete:t.allowDelete,editable:t.editable,filename:e.fileName,id:e.id,mode:i,isNativeContext:bizagi.util.isNativePluginSupported(),isCordovaSupported:bizagi.util.isCordovaSupported()})},getTemplateName:function(){return"upload"},getTemplateItemName:function(){return"uploadItem"},getTemplateEditionName:function(){return"edition.upload"},getTemplateEditionMenu:function(){return"edition.upload.menu"},saveImage:function(e,t){var i=e,r={},a=i.buildAddParams(),n=i.fileProperties.name;return i.editedImageURL?r.dataFile=i.editedImageURL:r.dataFile=i.fileProperties.url,a.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=i.properties.addUrl,i.editedImageURL=null,i.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),$.when(bizagi.util.media.uploadFile(r)).done(function(t){var r=JSON.parse(decodeURIComponent(t.response));"error"===r.type?bizagi.showMessageBox(r.message,r.errorType):i.onUploadFileCompleted(e,r)}).fail(function(e){var t=JSON.parse(decodeURIComponent(e.responseText));bizagi.showMessageBox(t.message,t.type)})},saveVideo:function(e,t){var i=e,r={},a=i.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileName=t[0].name,r.options.mimeType="video/quicktime",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=i.properties.addUrl,r.dataFile=t[0].fullPath,$.when(bizagi.util.media.uploadFile(r)).done(function(t){var r=JSON.parse(decodeURIComponent(t.response));"error"===r.type?bizagi.showMessageBox(r.message,r.errorType):i.onUploadFileCompleted(e,r)})},onFail:function(e){var t=bizagi.util.processFailMessage(e);if("string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";bizagi.showMessageBox(i)}},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl(),a=$("ul.files",r);if(t.id&&t.fileName){var n=i.renderUploadItem(t);$(a).append(n),i.filesCount=i.filesCount+1;var o=i.files.slice();o.push([t.id,t.fileName]),i.setValue(o,!0),i.checkMaxFiles(),r.find(".ui-bizagi-render-upload-item-no-upload").hide(),"columnUpload"!==i.properties.type&&i.properties.allowDelete&&i.properties.editable&&i.attachDeleteHandler(),i.editedImageURL=null}else bizagi.showMessageBox(t.message,"Error")},checkMaxFiles:function(){var e=this.properties,t=this.getControl(),i=e.maxfiles,r=e.value?e.value.length:0;e.editable?0!==i&&this.filesCount>=i&&r>=i?this.itemAddfile.hide():this.itemAddfile.show():0==this.filesCount&&$("#no-files",t).show()},checkExtensions:function(){var e=this.properties.validExtensions||"",t=[];if(e=(e=e.replace(/\s+/g,"").toLowerCase()).split(";"),this.nonSupportedExtension="",this.validOptions={video:!1,image:!1,file:!1},void 0!==e&&""!==e[0]){if(1!==e.length||-1===e[0].indexOf("*.*")){for(var i=0,r=e.length;i<r;i++)e[i]=e[i].replace("*.",""),this.Class.EXTENSIONSIMG.toString().indexOf(e[i])>=0?this.validOptions.image=!0:this.Class.EXTENSIONSVIDEO.toString().indexOf(e[i])>=0?this.validOptions.video=!0:t.push(e[i]);this.nonSupportedExtension=t.join(", ")||""}}else this.validOptions={video:!0,image:!0,file:!1}},activeUploadWebControl:function(){var e=this,t=e.getControl(),i=$(".bz-rn-upload-web",t),r=$(".bz-rn-upload-show-menu span.bz-cm-icon",t);e.itemAddfile=$(".bz-rn-upload-show-menu",t),e.itIsMaxNumberFilesReached()&&e.itemAddfile.hide(),e.itemAddfile.click(function(){i.click()}),r.addClass("bz-rn-upload-native"),r.on("click",function(){i.click()}),i.on("change",function(){var t=this.files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).then(function(t){e.onUploadFileCompleted(e,JSON.parse(decodeURIComponent(t)))}).fail(function(t){"Unauthorized"===t.statusText&&"ok"===t.statusText.toLowerCase()||bizagi.showMessageBox(e.getResource("workportal-widget-admin-language-error"))}).always(function(){bizagi.loading.stop()}):bizagi.loading.stop(),$(this).val("")}),e.checkMaxFiles(),e.attachDeleteHandler()},itIsMaxNumberFilesReached:function(){var e=this.properties,t=e.maxfiles,i=e.value?e.value.length:0;return 0!==t&&i>=t},buildAddFileParams:function(e){var t=this.Class.BA_CONTEXT_PARAMETER_PREFIX,i=this.properties,r=new FormData,a=this.getFormContainer();r.append(t+"xpath",this.getUploadXpath()),r.append(t+"idRender",i.id),r.append(t+"xpathContext",i.xpathContext),r.append(t+this.Class.BA_PAGE_CACHE,i.idPageCache),r.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),r.append(i.xpath,e),i.contexttype&&r.append(t+"contexttype",i.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}return r},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},clearDisplayValue:function(){var e=this;$(".ui-bizagi-render-upload-item",e.getControl()).each(function(t,i){var r=(i=$(i)).data();$.when(e.deleteUploadItem(i,r.id)).done(function(){i.hide(),i.remove(),e.setValue(e.files,!1),e.checkMaxFiles(),e.triggerRenderChange()})})}}),bizagi.rendering.upload.extend("bizagi.rendering.upload.offline",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{postRender:function(){bizagi.util.isCordovaSupported()&&this.properties.editable?this.activateUploadNative():this.addEventToOpenSlide(),this.atachOpenFileEvent(),this.configureHelpText()},addEventToOpenSlide:function(){this.itemAddfile=$(".bz-rn-upload-show-menu",this.getControl()),this.itemAddfile.hide()},atachOpenFileEvent:function(){var e=this;$("ul.files",e.getControl()).on("click",".ui-bizagi-render-link.button",function(t){var i=$(this).data("index"),r="number"==typeof i?e.properties.value[i]:null;if(r){var a=r[1]?r[1].value:"",n=r[2]?r[2].value:"image/jpeg";bizagi.loading.start(),$.when(bizagi.util.media.openOfflineFile(a,n,this.title)).fail(function(t){bizagi.showMessageBox(e.getResource("workportal-widget-admin-language-error"))}).always(function(){bizagi.loading.stop()})}})},renderControl:function(){var e=this,t=!0,i="",r=e.renderFactory.getTemplate("upload");e.checkExtensions(),bizagi.util.isCordovaSupported()&&(t=e.validOptions&&e.validOptions.image);var a=Number(e.properties.maxSize)||1048576,n="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;e.properties.maxSize=a<n?a:n;for(var o=$.kendoTmpl(r,{xpath:bizagi.util.encodeXpath(e.getUploadXpath()),editable:e.properties.editable&&t,noFiles:0===e.filesCount,allow_upload:t,validExtensions:e.properties.validExtensions,nonSupportedExtension:e.nonSupportedExtension,allowSendInMail:e.properties.allowSendInMail}),s=0,l=e.filesCount;s<l;s++){i+=e.renderUploadItem(e.files[s],s)}return o=e.replaceFilesHtml(o,i)},postRenderReadOnly:function(){this._super(),this.atachOpenFileEvent()},activateUploadNative:function(){this._super()},getTemplateName:function(){return"upload"},getTemplateItemName:function(){return"uploadItem"},getTemplateEditionName:function(){return"edition.upload"},getTemplateEditionMenu:function(){return"edition.upload.menu"},saveImage:function(e,t){var i=this;t=bizagi.util.media.getImagePath(t),i.getDataUri(t,function(e){var t=i.fileProperties?i.fileProperties.extension:"",r=bizagi.util.uniqueID()+t;i.onUploadFileCompletedOffline(r,e)})},getDataUri:function(e,t){var i=new XMLHttpRequest;try{i.onload=function(){var e=new FileReader;e.onloadend=function(){var i=e.result;t(i)},e.readAsDataURL(i.response)},i.open("GET",e),i.responseType="blob",i.send()}catch(e){t("")}},saveVideo:function(e,t){var i=e;window.resolveLocalFileSystemURL(t[0].fullPath,function(e){e.file(function(e){var r=new FileReader;r.onloadend=function(e){var r=bizagi.util.media.getFileExtension(t[0].name),a=bizagi.util.uniqueID()+r;i.onUploadFileCompletedOffline(a,e.target.result)},r.readAsDataURL(e)},i.failReadFile)},i.failReadFile)},renderUploadItem:function(e,t){var i=this.getMode(),r=this.renderFactory.getTemplate("uploadItem");return $.kendoTmpl(r,{url:"javascript:void(0);",image:!1,allowDelete:this.properties.allowDelete||!1,id:bizagi.util.randomNumber(),mode:i,editable:this.properties.editable,filename:e[0].value,isNativeContext:!1,isCordovaSupported:bizagi.util.isCordovaSupported(),index:t})},collectData:function(e){this.filesCount>0?e[this.properties.xpath]=this.files:"delete"===this.properties.method&&(e[this.properties.xpath]=[],delete this.properties.method)},onUploadFileCompletedOffline:function(e,t){var i=this,r=i.getControl(),a=$("ul.files",r),n=t.replace(/^data:.*;base64,/,""),o=i.properties,s=t.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/),l=[{xpath:"fileName",DataType:"15",value:e},{xpath:"data",DataType:"19",value:n},{xpath:"mimeType",DataType:"15",value:s=s&&s.length?s[1]:"image/jpeg"}],d=i.renderUploadItem(l,i.filesCount);$(a).append(d);var c=i.files.slice();c.push(l),i.filesCount=i.filesCount+1,i.setValue(c,!1),i.checkMaxFiles(),i.triggerRenderChange(),r.find(".ui-bizagi-render-upload-item-no-upload").hide(),o.allowDelete&&o.editable&&i.attachDeleteHandler(),i.closeModalView(),bizagi.util.tablet.stopLoading()},failReadFile:function(e){try{bizagi.log("Error code: "+e.target.error.code)}catch(e){}},onFail:function(e){this._super(e),this.closeModalView()},checkMaxFiles:function(){bizagi.rendering.upload.prototype.checkMaxFiles.apply(this,arguments)},checkExtensions:function(){var e=this.properties.validExtensions||"",t=[];if(e=(e=e.replace(/\s+/g,"").toLowerCase()).split(";"),this.nonSupportedExtension="",this.validOptions={video:!1,image:!1,file:!1},void 0!==e&&""!==e[0]){if(1!==e.length||-1===e[0].indexOf("*.*")){for(var i=0,r=e.length;i<r;i++)e[i]=e[i].replace("*.",""),this.Class.EXTENSIONSIMG.toString().indexOf(e[i])>=0?this.validOptions.image=!0:t.push(e[i]);this.nonSupportedExtension=t.join(", ")||""}}else this.validOptions.image=!0},checkMaxSize:function(e){return bizagi.util.media.checkMaxSize(e,this.properties)},checkMaxSizeVideo:function(e){return bizagi.util.media.checkMaxSizeVideo.apply(e,this.properties)},canBeSent:function(){return!0},attachDeleteHandler:function(){var e=this,t=e.getControl();$(".bz-rn-upload-delete-icon",t).bind("click",function(){var t=$(this).parent(".ui-bizagi-render-upload-item"),i=t.data(),r=t.index();e.filesCount=e.filesCount-1,0===e.filesCount&&(e.properties.method="delete"),e.files=$.grep(e.files,function(e,t){return t!==r&&e!==i.name}),t.hide(),t.remove(),e.setValue(e.files,!1),e.checkMaxFiles(),e.triggerRenderChange()})}}),bizagi.rendering.grid.extend("bizagi.rendering.grid",{GRID_PAGE_SIZE:10},{init:function(e){e.data.properties.singleInstance=!1,this._super(e),this.cellMetadata={};var t=this.properties,i=this.getFormContainer();this.properties.helpText&&null!=this.properties.helpText&&""!=this.properties.helpText?t.displayType="value":t.displayType="vertical",t.labelAlign="left",(t.groupBy||t.groupSummary)&&i.addWarning(this.getResource("render-tablet-warning-grid"))},initializeData:function(e){e.properties.singleInstance=!1,this._super(e)},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var r in e.initialLoadDone=!1,e.isPaginatorActive=!1,e._super(),e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(e.updateData(t.data),$.when(e.ready()).done(function(){e.triggerRenderChange({changed:!1})})),e.initialLoadDone=!0,e.pendingActions)e.pendingActions.hasOwnProperty(r)&&e.pendingActions[r].method.apply(e,e.pendingActions[r].arguments)},applyGridPlugin:function(){var e=this,t=e.properties,i=e.getMode(),r=e.grid,a=bizagi.util.isOfflineForm({context:e}),n=e.buildColumnModel(),o=jQuery.grep(n,function(e){return e.summarizeBy});r.bizagi_grid_tablet({columns:n,maxColumns:4,title:t.displayName,isOfflineForm:a||!1,mode:i,template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),totalizer:e.renderFactory.getTemplate("bizagi.grid.totalizer")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,inlineAdd:!1,allowMore:t.allowMore,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:o.length>0&&t.data.rows.length>0},pageRequested:function(t){"execution"==i&&e.fetchData(t.page,t.sortBy,t.sortType)},sortRequested:function(t){"execution"==i&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"==i&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){"execution"==i&&e.addRow()},editRow:function(t){"execution"==i&&e.editRow(t.key)},deleteRow:function(t){"execution"==i&&e.deleteRow(t.key)},moreRows:function(t){"execution"==i&&e.moreRows(t)},showMore:function(t){e.showMore(t.key)},totalData:function(t){"execution"==i&&e.onTotalData()}})},postRenderReadOnly:function(){this.postRender()},buildColumnModel:function(){this.properties;var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"center",key:!0}),$.each(e,function(e,i){i.columnIndex=e+1;var r=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,a={name:i.properties.xpath,index:e+1,label:r,key:!1,hidden:!i.properties.visible||"columnHidden"==i.properties.type||0==i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(a)}),t},refresh:function(){this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},loadChanges:function(e){var t,i=[];for(t=0,length=e.length;t<length;t++)i.push([e[t][0],t]);for(t=0,idRowLength=i.length;t<idRowLength;t++){var r,a,n,o=this.changes[i[t][0]];if(void 0!==o)for(a in r=i[t][1],o)o.hasOwnProperty(a)&&(n=this.getColumn(a).columnIndex,e[r][n]=o[a])}},updateData:function(e){var t=this.grid,i=this.columns;e&&(this.properties.data=e,this.setCellOverrides(e,i),t.bizagi_grid_tablet("setData",e),this.properties.data&&this.properties.data.total>this.Class.GRID_PAGE_SIZE&&(this.alternativePaginator(),this.isPaginatorActive=!0))},fetchData:function(e,t,i){var r=this,a=r.properties;r.dataReadyDeferred=new $.Deferred,e=e||a.page||1,t=t||a.sortBy||"",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then(function(e){if(e)if(e.deviceMaxRecordsExceeded)bizagi.showMessageBox(bizagi.localization.getResource("render-search-maximum-records-allowed"));else if(r.isRTL()&&(e.rows=r.changeOrderData(e.rows)),r.loadChanges(e.rows),r.updateData(e),r.triggerRenderChange(),r.dataReadyDeferred.resolve(),r.isPaginatorActive){var t=$(".ui-bizagi-grid-pager",r.element).find("li[data-page-number="+e.page+"]"),i=t.length>0?t.position().left:0;i=-1*Number(i-30);var a=Number($(".ui-bizagi-grid .ui-bizagi-grid-pager",r.getControl()).css("width").replace(/[^-\d\.]/g,"")),n=$(".ui-bizagi-grid .ui-bizagi-grid-pager ul li:last",r.getControl()),o=-(n=n.length>0?n.position().left:0)+a-90;a<n&&(i<o&&(i=o),$(".ui-bizagi-grid .ui-bizagi-grid-pager ul",r.getControl()).css({"margin-left":i+"px"}))}}).always(function(){r.endLoading()})},collectData:function(e){var t=this,i=t.grid;if(t.grid&&(t.properties.inlineAdd||t.properties.inlineEdit)){var r=i.bizagi_grid_tablet.hasOwnProperty("getNewRowKeys")?i.bizagi_grid_tablet("getNewRowKeys"):[];if(r.length>0&&!t.properties.alreadySaved&&t.isValid()){var a=t.saveInlineAddedRows(r,!0);e.deferreds=e.deferreds||[],e.deferreds.push(a)}for(var n=0;n<r.length;n++)t.changes[r[n]]&&delete t.changes[r[n]]}t._super(e)},drawCell:function(e,t,i,r){var a=this;if(e.key)return i;a.newRecords=a.newRecords||{};var n=e.index-1,o=a.columns[n];a.cellMetadata[t]||(a.cellMetadata[t]={}),a.cellMetadata[t][n]||(a.cellMetadata[t][n]={});var s=a.cellMetadata[t][n].properties||o.originalProperties;void 0===s.visible||s.visible,void 0===s.editable||s.editable;if(s.editable=!1,r&&!0,o.properties.displayType="value","summary"==t&&!1,o.setValue(t,i),o.setSurrogateKey(t),s.visible){o.properties=s;var l=new $.Deferred;return $.when(o.renderReadOnly(t,i)).done(function(e){for(var i=0;i<a.columns.length;i++)a.cellOverrides[t]=a.cellOverrides[t]||{},a.getCellOverride(t,i).visible=!0;l.resolve(e)}),l.promise()}return""},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.columns[a],o=(null!=this.cellMetadata[t][a]?this.cellMetadata[t][a].properties:void 0)||n.originalProperties,s=void 0===o.visible||o.visible,l=void 0===o.editable||o.editable;if(l=!!r,s)if(l){var d=n.properties.editable;if(n.properties.editable=l,n.properties.submitOnChange){var c=n.getDecorated(t);c&&(c.properties.submitOnChangexpathContext=this.properties.xpath+"[]")}n.postRender(t,i),n.properties.editable=d}else n.postRenderReadOnly(t,i)},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer(),r=e.getFormParams();e.startLoading(),$.when(e.submitAddRequest()).done(function(a){var n=new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,formParams:r,navigation:r.navigation,showSaveButton:!0,onSave:function(t){return e.submitSaveRequest(a,t)}});e.endLoading();var o=t.xpath+"[id="+a+"]";n.render({idRender:t.id,recordXPath:o,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"addForm",url:t.addPage,formParams:r,navigation:r.navigation}).done(function(){e.endLoading(),t.submitOnChange?e.submitOnChange():e.fetchData()}).fail(function(){e.endLoading(),e.submitRollbackRequest()})})},editRow:function(e){if(0!=e){var t=this,i=t.properties;if(1!=i.inlineEdit||0!=i.allowEdit)if(t.cleanActionChanges&&void 0!==t.cleanActionChanges[e]){t.changes=t.cleanActionChanges;var r=$.extend(t.changes[e],{});r.idPageCache=i.idPageCache,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(e,r)).done(function(){t.startLoading(),i.submitOnChange?t.submitForGridChange().always(function(){t.endLoading(),t.executeSubmitEditRequest(e)}):(t.endLoading(),t.fetchData())})}else t.executeSubmitEditRequest(e);else t.editInline(e)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},executeSubmitEditRequest:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.getFormParams(),n=new bizagi.rendering.tablet.slide.view(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:r.container,formParams:a,navigation:a.navigation,showSaveButton:!0,onSave:function(i){return t.submitSaveRequest(e,i)}});t.startLoading(),$.when(t.submitEditRequest(e)).done(function(){var r=i.xpath+"[id="+e+"]";n.render({idRender:i.id,recordXPath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"editForm",url:i.editPage,formParams:a,navigation:a.navigation}).done(function(){i.submitOnChange?t.submitOnChange():t.fetchData()}).fail(function(){t.startLoading(),$.when(t.submitRollbackRequest()).always(function(){t.endLoading()})})}).always(function(){t.endLoading()})},deleteRow:function(e){if(0!==e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(e)).done(function(i){t.fetchData(),"success"===i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})})})}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},moreRows:function(e){var t=this,i=t.properties;void 0===i.originalrowsPerPage&&(i.originalrowsPerPage=i.rowsPerPage),i.rowsPerPage+=i.originalrowsPerPage;var r={};t.collectData(r),t.startLoading(),jQuery.isEmptyObject(r)?t.moreRowsCommon(e):t.dataService.submitData({action:"SUBMITONCHANGE",data:r,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache}).done(function(){t.endLoading(),t.moreRowsCommon(e)})},moreRowsCommon:function(e){var t=this,i=t.properties;t.fetchData(e.page,e.sortBy,e.sortType),$.when(t.dataReadyDeferred).done(function(){0!=i.records&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()})},showMore:function(e){for(var t=this,i=t.properties.data,r=t.properties,a=t.getFormContainer(),n=t.getFormParams(),o=[],s=0,l=i.rows.length;s<l;s++)if(i.rows[s][0]==e){o=i.rows[s];break}var d=new bizagi.rendering.tablet.slide.view.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:a.container,allowEdition:!1,formParams:n,navigation:n.navigation});t.startLoading(),d.render({row:o,columns:t.columns,pageCacheId:r.idPageCache,xpath:r.xpath,xpathContext:r.xpathContext,sessionId:a.properties.sessionId,actions:a.actions,formParams:n,navigation:n.navigation}).done(function(){t.endLoading()})},editInline:function(e){for(var t=this,i=t.properties.data,r=t.properties,a=t.getFormContainer(),n=t.getFormParams(),o=[],s=0,l=i.rows.length;s<l;s++)if(i.rows[s][0]==e){o=i.rows[s];break}var d=new bizagi.rendering.tablet.slide.view.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:a.container,formParams:n,navigation:n.navigation,allowEdition:!0});$.when(d.render({row:o,columns:t.columns,pageCacheId:r.idPageCache,xpath:r.xpath,xpathContext:r.xpathContext,sessionId:a.properties.sessionId,actions:a.actions,validations:a.validations,formParams:n,navigation:n.navigation})).done(function(i){for(xpath in i)t.collectGridChange({id:e,xpath:xpath,value:i[xpath],trigger:!1});var a={};t.collectData(a),t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:r.id,xpath:r.xpath,xpathContext:r.xpathContext,idPageCache:r.idPageCache}).done(function(){t.fetchData()})})},changeCellBackgroundColor:function(e,t,i){if(this.initialLoadDone)for(var r=0;r<this.columns.length;r++){var a=this.getCellOverride(e,r).visible;if(this.columns[r].properties.xpath==t&&a){var n=this.grid.bizagi_grid_tablet("getCell",e,t,r);this.properties.editable&&(n=n.find("input")),n.css("background-color",i);break}}else this.pendingActions&&this.pendingActions.push({method:sel*f.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(e,t,i){if(this.initialLoadDone){for(var r=0;r<this.columns.length;r++)if(this.columns[r].properties.xpath==t){var a=this.grid.bizagi_grid_tablet("getCell",e,t,r);this.properties.editable&&(a=a.find("input")),a.css("color",i),$(a).find(".ui-bizagi-cell-readonly").css("color",i);break}}else this.pendingActions&&this.pendingActions.push({method:this.changeCellColor,arguments:arguments})},changeCellVisibility:function(e,t,i){var r=this;if(r.initialLoadDone){for(var a=0;a<r.columns.length;a++)if(r.columns[a].properties.xpath==t){var n=r.grid.bizagi_grid_tablet("getCell",e,t,a);1==i?n.show():n.hide(),r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,a).visible=i;break}}else r.pendingActions&&r.pendingActions.push({method:r.changeCellVisibility,arguments:arguments})},changeCellValue:function(e,t,i){},setError:function(e,t){if(this.initialLoadDone)for(var i=0;i<this.columns.length;i++){var r=this.getCellOverride(e,i).visible;if(this.columns[i].properties.xpath==t&&r){this.grid.bizagi_grid_tablet("getCell",e,t,i).parent().addClass("ui-bizagi-render-grid-cell-error");break}}else this.pendingActions&&this.pendingActions.push({method:this.setError,arguments:arguments})},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},startLoading:function(e){bizagi.loading.start(),this._super(e)},endLoading:function(){bizagi.loading.stop(),this._super()},cleanCellData:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getControlCell(e,t);if(r){r.cleanData();for(var a=0;a<i.columns.length&&i.columns[a].properties.xpath!=t;a++);for(var n=i.properties.data.rows,o=0,s=n.length;o<s;o++)if(Number(e)===n[o][0]){n[o][a+1]=[["",""]];break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,a).value=null,i.cleanActionChanges||(i.cleanActionChanges={}),i.cleanActionChanges[e]||(i.cleanActionChanges[e]={}),i.cleanActionChanges[e][t]=""}}else i.pendingActions.push({method:i.cleanData,arguments:""})},onTotalData:function(e){var t,i=this,r=(i.properties.data||{}).rows,a=(r.length,[]),n=i.buildColumnModel();bizagi.util.tablet.startLoading(),n.forEach(function(e,n){if(e.bizAgiProperties){switch(operationState=e.bizAgiProperties.totalize.operation,operationState){case"sum":t=r.sum(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n);break;case"count":t=r.count(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return bizagi.util.isArray(i)?bizagi.util.isArray(i)&&i.length>0?i:void 0:i},e,n);break;case"max":t=r.max(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n);break;case"min":t=r.min(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n);break;case"avg":t=(t=r.avg(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n)).toFixed(2)}operationState&&(t=i.formatTotalizedResult(operationState,e.bizAgiProperties.type,t),a.push({label:e.label,total:t}))}}),i.showTotals(a),bizagi.loading.stop()},formatTotalizedResult:function(e,t,i){switch(e){case"sum":case"avg":case"min":case"max":if("columnMoney"==t||"money"==t)return bizagi.util.formatMonetaryCell(i)}return i||0},showTotals:function(e){var t=kendo.template(this.renderFactory.getTemplate("bizagi.grid.totalizer"),{useWithBlock:!1}),i=$.extend(e,{orientation:this.properties.orientation}),r=$($.trim(t(i)));$(".bz-rn-grid-totalize-container").remove(),r.kendoMobileModalView({close:function(){this.destroy(),this.element.remove()},useNativeScrolling:!0}),r.delegate(".bz-rn-grid-totalize-close-btn","click",function(){r.data("kendoMobileModalView").close()}),r.kendoMobileModalView("open")},alternativePaginator:function(){}}),bizagi.rendering.grid.extend("bizagi.rendering.grid.offline",{MAX_ROWS_SUPPORTED:4},{init:function(e){e.data;this._super(e),this.cellMetadata={};var t=this.properties;t.data.originalRows=bizagi.clone(t.data.rows);var i=this.getFormContainer();t.displayType="vertical",t.labelAlign="left",(t.groupBy||t.groupSummary)&&i.addWarning(this.getResource("render-tablet-warning-grid"))},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var r in e.initialLoadDone=!1,i.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block"),e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),e.configureHelpText(),t.data&&(e.updateData(t.data),$.when(e.ready()).done(function(){e.triggerRenderChange({changed:!1})})),e.initialLoadDone=!0,e.pendingActions)e.pendingActions[r].method.apply(e,e.pendingActions[r].arguments)},postRenderReadOnly:function(){this.postRender()},applyGridPlugin:function(){var e=this,t=e.properties,i=e.grid,r=e.getMode(),a=bizagi.util.isOfflineForm({context:e}),n=e.buildColumnModel();i.bizagi_grid_tablet({columns:n,maxColumns:e.Class.MAX_ROWS_SUPPORTED,title:t.displayName,isOfflineForm:a||!1,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons.offline"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons.offline"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,details:!1,inlineAdd:!0,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1},isValid:function(){return e.isValidGrid()},pageRequested:function(t){"execution"==r&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){if("execution"==r){e.triggerHandler("rowSelected",{id:t.key,data:t})}},addRow:function(t){"execution"==r&&e.addRow()},editRow:function(t){"execution"==r&&e.editRow(t.key)},deleteRow:function(t){"execution"==r&&e.deleteRow(t.key)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&e.inlineAddDeferred.resolve()},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)}})},buildColumnModel:function(){return bizagi.rendering.grid.prototype.buildColumnModel.call(this)},refresh:function(){this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},updateData:function(e){return bizagi.rendering.grid.prototype.updateData.apply(this,arguments)},fetchData:function(e,t,i){var r=this;r.dataReadyDeferred=new $.Deferred,r.startLoading(),$.when(r.getRemoteData()).then(function(e){r.endLoading(),e&&(r.updateData(e),r.triggerRenderChange(),r.dataReadyDeferred.resolve())})},processChanges:function(){var e=[],t=this.properties.data;for(var i in this.changes){var r=[];for(var a in r.push(i),this.changes[i])if(this.canColumnBeSent(i,a)){var n=this.changes[i][a];"string"==typeof n&&null!==n.match(/\n/gm)&&(n=n.replaceAll("\n","\\n")),r.push({value:n,xpath:a,DataType:this.getColumn(a).properties.dataType})}if(void 0!==this.properties.data.rows&&this.properties.data.rows.length>0)for(var o=[],s=0;s<t.rows.length;s++)if(t.rows[s][0]==i){o=t.rows[s],t.rows.splice(s,1),s--,o=this.processRow(o),r=$.extend(!0,o,r);break}e.push(r)}return e},collectData:function(e){var t=this,i=[],r=t.properties,a=t.properties.data;if(t.isValid([]))for(var n in t.changes){var o=[];for(var s in t.changes[n])if(t.canColumnBeSent(n,s)){var l=t.getColumn(s).columnIndex-1,d=t.changes[n][s];"string"==typeof d&&null!==d.match(/\n/gm)&&(d=d.replaceAll("\n","\\n")),o[l]={value:d,xpath:s,DataType:t.getColumn(s).properties.dataType}}if(void 0!==t.properties.data.rows&&t.properties.data.rows.length>0)for(var c=[],u=0;u<a.rows.length;u++)if(a.rows[u][0]==n){c=a.rows[u],a.rows.splice(u,1),u--,c=t.processRow(c),o=$.extend(!0,c,o);break}i[i.length]=o}(JSON.stringify(a.rows)!==JSON.stringify(a.originalRows)||i.length>0)&&(void 0!==a.rows&&i.length>0?e[r.xpath]=$.merge($.merge([],t.processOldRows(a.rows)),i):void 0!==a.rows&&a.rows.length>0?e[r.xpath]=t.processOldRows(a.rows):e[r.xpath]=i)},processOldRows:function(e){for(var t=[],i=e,r=0,a=i.length;r<a;r++){var n=i[r];t[r]=$.grep(n,function(e,t){return t>0})}return t},processRow:function(e){return $.grep(e,function(e,t){return t>0})},drawCell:function(e,t,i,r){var a=this;if(e.key)return i;"object"!=typeof i||r||(i=i.hasOwnProperty("value")?i.value:i);var n=e.index-1,o=a.columns[n],s=a.getCellOverride(t,e.index-1);a.newRecords=a.newRecords||{},a.cellMetadata[t]||(a.cellMetadata[t]={}),a.cellMetadata[t][n]||(a.cellMetadata[t][n]={});var l=a.cellMetadata[t][n].properties||o.originalProperties,d=void 0===l.visible||l.visible,c=void 0===l.editable||l.editable;if(d=s.visible,c=!!l.editable&&s.editable,r&&(c=!0),"summary"==t&&(c=!1),o.properties.displayType="value",o.setValue(t,i),o.setSurrogateKey(t),"columnSearch"==o.properties.type&&null!=i)for(var u=0,p=o.properties.data.length;u<p;u++)o.properties.data[u].id==i&&(i={id:o.properties.data[u].id,label:o.properties.data[u].value});if(("columnCombo"==o.properties.type||"columnList"==o.properties.type)&&null!=i)for(u=0,p=o.properties.data.length;u<p;u++)o.properties.data[u].id==i&&(i=[[o.properties.data[u].id,o.properties.data[u].value]]);return d?c?a.drawEditableCell(o,l,t,i,r):a.drawReadonlyCell(o,l,t,i):""},drawEditableCell:function(e,t,i,r,a){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,r)).done(function(t){a&&!n.newRecords[i]&&(n.newRecords[i]={});for(var r=0;r<n.columns.length;r++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,r).visible=null==n.getCellOverride(i,r).visible||n.getCellOverride(i,r).visible;e.getDecorated(i).bind("renderchange",function(r){n.onCellChange(e,t,i)}),o.resolve(t)}),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,r){var a="";if("summary"==i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellChange:function(e,t,i){var r=e.getValue(i),a=e.getCompositeValue(i);if("columnDate"==e.properties.type&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(r))""===r&&(r="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(r,!0);r=bizagi.util.dateFormatter.formatInvariant(n,!0)}else if("columnDate"==e.properties.type){if(bizagi.util.isEmpty(r))""===r&&(r="");else(n=bizagi.util.dateFormatter.getDateFromInvariant(r,!1)).setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatInvariant(n,!0)}if(this.properties.allowEdit||this.grid.bizagi_grid_tablet("isNewRecord",i)){var o=!this.grid.bizagi_grid_tablet("isNewRecord",i);this.collectGridChange({id:i,xpath:e.properties.xpath,value:r,compositeValue:a,columnIndex:e.columnIndex,trigger:o})}this.grid.bizagi_grid_tablet("changeCellValue",i,e.columnIndex,r),e.properties.totalize&&e.properties.totalize.operation&&this.grid.bizagi_grid_tablet("refreshSummary",e.columnIndex)},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,r=e.value,a=void 0===e.trigger||e.trigger;this.changes[t]=this.changes[t]||{},this.changes[t][i]=r,a&&this.triggerRenderChange({key:t,column:i})},onCellReady:function(e,t,i,r){bizagi.rendering.grid.prototype.onCellReady.apply(this,arguments)},addRow:function(){bizagi.showMessageBox(bizagi.localization.getResource("render-tablet-error-userfield"),bizagi.localization.getResource("render-tablet-error-userfield"))},editRow:function(e){},deleteRow:function(e){if(e&&0!=e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(e)).done(function(){t.fetchData()})})}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editInline:function(e){},saveInlineAddedRows:function(e,t){var i=this.processChanges();bizagi.util.isEmpty(i)||(this.properties.data.rows=$.merge(this.properties.data.rows,i))},removeNewRecords:function(e){var t=this;e&&e.keys&&$.each(e.keys,function(e,i){t.newRecords[i]&&delete t.newRecords[i]})},changeCellBackgroundColor:function(e,t,i){bizagi.rendering.grid.prototype.changeCellBackgroundColor.apply(this,arguments)},changeCellColor:function(e,t,i){bizagi.rendering.grid.prototype.changeCellColor.apply(this,arguments)},changeCellVisibility:function(e,t,i){bizagi.rendering.grid.prototype.changeCellVisibility.apply(this,arguments)},changeCellEditability:function(e,t,i){bizagi.rendering.grid.prototype.changeCellEditability.apply(this,arguments)},cleanCellData:function(e,t){bizagi.rendering.grid.prototype.cleanCellData.apply(this,arguments)},changeCellRequired:function(e,t,i){bizagi.rendering.grid.prototype.changeCellRequired.apply(this,arguments)},setError:function(e,t){bizagi.rendering.grid.prototype.setError.apply(this,arguments)},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},getRemoteData:function(e){var t=this.properties;if(e=e||{},t.overrideGetRemoteData){var i=t.overrideGetRemoteData(e);return null!=i?i.promise():null}var r=new $.Deferred,a=t.data;return t.page=a.page,t.records=a.records,t.totalPages=a.totalPages,this.isRTL()&&(a.rows=this.changeOrderData(a.rows)),r.resolve(a),r.promise()},submitDeleteRequest:function(e){for(var t=this.properties.data,i=!1,r=0,a=t.rows.length;r<a;r++)if(t.rows[r][0]==e){t.rows[r],t.rows.splice(r,1),r--,t.records--,i=!0;break}return i||bizagi.showMessageBox(this.getResource("workportal-general-no-records-found")),t.rows},isValidGrid:function(){var e=[],t=this.getFormContainer();if(void 0!==t.validationController&&t.validationController.clearValidationMessages(),this.isValid(e),e.length>0){if(void 0!==t.validationController)for(var i=0;i<e.length;i++)t.validationController.showValidationMessage(e[i].message,e[i].xpath);return!1}return!0}}),bizagi.rendering.search.extend("bizagi.rendering.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,SEARCH_MIN_LENGTH:3,SEARCH_DELAY:750,MAX_ITEMS:10,MAX_ITEMS_OFFLINE:50},{init:function(e){this._super(e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlySearch"),t=this.properties.value,i=t&&this.hasValue()?t.additionallabel?t.label+", "+t.additionallabel:t.label:"";return $.kendoTmpl(e,{value:i})},postRenderReadOnly:function(){var e=this.getControl();this.input=$(".bz-rn-text",e),e.closest(".ui-bizagi-render").addClass("bz-rn-read-only")},postRender:function(){var e=this,t=e.getControl(),i=bizagi.util.isOfflineForm({context:e});e._super(),e.input=$(".bz-rn-container-control-search",t),e.searchInput=$("input",t),e.isOfflineForm=i||!1,e.isOfflineForm?(e.properties.submitOnChange=!1,e._simplySuggestOffline()):e.properties.advancedSearch?e._advanceSearch():e._simplySearch()},configureHandlers:function(){var e=this,t=e.properties,i=e.getControl();t.editable&&$(".bz-rn-search-control-icons-clear",i).bind("click",function(t){t.stopPropagation(),e.setValue({id:""}),e.searchInput.prop("value",""),$(this).addClass("hidden"),e.input.find(".bz-rn-input-search-text").removeClass("hasValue")})},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search"),i={allowSuggest:e.allowSuggest,editable:e.editable,allowClear:e.allowClear,id:e.id,xpath:e.xpath,hasValue:void 0!==e.value&&null!==e.value&&void 0!==e.value.label&&""!==e.value.label,allowTyping:e.allowTyping,advancedSearch:e.advancedSearch,hasMozillaHelpText:!(!$.browser||!$.browser.mozilla||null===e.helpText||""===e.helpText)};return $.kendoTmpl(t,i)},_simplySuggestOffline:function(){var e=this.getControl();$(".bz-wp-search-control-search-icon",e).addClass("disable-search"),this.applyAutocompletePlugin()},_simplySearch:function(){var e=this.getControl();$(".bz-wp-search-control-search-icon",e).addClass("disable-search"),this.applyAutocompletePlugin()},_advanceSearch:function(){var e=this;e.searchInput.attr("readonly","true"),e.input.bind("click",function(){e.showSlideSearch()})},setDisplayValue:function(e){var t="";null!=(e=this.mapValue(e))&&void 0!==e.id&&(t=e.additionallabel&&e.label?e.label+","+e.additionallabel:e.label?e.label:"",this.properties.editable?(this.searchInput.val(t),void 0!==e?this.input.find(".bz-rn-input-search-text").addClass("hasValue"):this.input.find(".bz-rn-input-search-text").removeClass("hasValue")):this.input.text(t))},cleanData:function(){var e={id:"",value:""};this.setValue(e),this.setDisplayValue(e)},getDisplayValue:function(){return this.selectedValue},showSlideSearch:function(){var e=this,t=e.properties,i=$.extend({},e.getParams(),{container:e.getFormContainer().container,title:t.displayName||"",allowNew:t.allowNew});new bizagi.rendering.tablet.slide.view.search(e.dataService,e.renderFactory,t.searchForms,{allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords,idRender:t.id,navigation:e.getParams().navigation,idPageCache:t.idPageCache,orientation:t.orientation||"ltr"},i).render({idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}).done(function(t){e.setValue(t),e.submitData()})},applyAutocompletePlugin:function(){var e=this,t=e.getControl(),i=e.searchInput;e.searchInput.parent().find(".bz-rn-autocomplete-wrapper").addClass("hidden"),i.addClass("ui-autocomplete-input"),i.on("click keyup",function(){e.autoCompleteSearchResults()}),t.on("click mousedown","li",function(){var t=$.data(this).itemautocomplete;e.setValue({id:t.id,label:t.value},!0),e.setDisplayValue({id:t.id,label:t.value}),e.isOfflineForm?$(this).parent().hide():(void 0!==e.properties.submitOnChange&&e.properties.submitOnChange&&e.submitOnChange(),$(this).parent().hide()),e.getControl().find(".bz-rn-search-control-icons-clear").removeClass("hidden"),e.input.find(".bz-rn-input-search-text").addClass("hasValue")}),t.on("focusout","input",function(){t.find("ul").hide(),e.searchInput.parent().find(".bz-rn-autocomplete-wrapper").addClass("hidden")})},autoCompleteSearchResults:function(){var e=this,t=e.searchInput;""===e.searchInput.val()&&e.input.find(".bz-rn-search-control-icons-clear").addClass("hidden"),$.when(e.processRequest({term:t.val()},function(){})).done(function(i){var r=e.searchInput.parent().find(".bz-rn-autocomplete-wrapper");i.length>0?r.removeClass("hidden"):r.hasClass("hidden")||r.addClass("hidden");var a=t.parent().find("ul");a.find("li").remove(),a.css({display:"inline-block",left:t.position().left,top:t.position().top+15});var n=i.length;if(n>0){e.control.find(".bz-rn-autocomplete-wrapper").show();for(var o=0;o<n;o++){var s=e.renderSearchItem(i[o]);$(s).addClass("bz-rn-autocomplete-item"),s.appendTo(a)}}})},processRequest:function(e){var t=this,i=t.properties,r=new $.Deferred,a=[];function n(e){i.advancedSearch&&e.push({id:t.Class.ADVANCED_SEARCH_ID,label:"",value:""}),i.allowAdd&&e.push({id:t.Class.ADVANCED_ADDITION_ID,label:"",value:""}),r.resolve(e)}if(e.term.length>=this.Class.SEARCH_MIN_LENGTH)if(i.term=e.term,t.isOfflineForm){var o=t.properties.data,s=0;$.each(o,function(e,r){if(s>=t.Class.MAX_ITEMS_OFFLINE)return!1;var n="";switch(typeof r.value){case"number":n=r.value;break;case"object":n=r.value.toString();break;case"string":default:n=r.value}void 0!==n&&(-1!==n.toLowerCase().indexOf(i.term.toLowerCase())||"%%%"===i.term)&&a.push({id:void 0!==r.id?r.id:"",label:void 0!==n?n.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(i.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"):"",value:void 0!==n?r.value:""}),s+=1}),n(a)}else this.getData().done(function(r){for(var o,s=-1;(o=r[++s])&&i.maxRecords>s&&s<t.Class.MAX_ITEMS;)a.push({id:o.id,label:o.value.toString().replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(e.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:o.value});n(a)}).fail(function(){r.reject()});else n(a);return r.promise()},renderSearchItem:function(e){var t=$.kendoTmpls(this.renderFactory.getTemplate("searchItem"),{id:e.id,label:e.label,value:e.value});return t.data("itemautocomplete",e),t},showAddRecordDialog:function(){var e=this,t=e.properties;return{buttons:{text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{showSaveButton:t.editable,title:bizagi.localization.getResource("render-dialog-entity"),onSave:function(i){var r={action:"SAVE",data:i,idPageCache:i.idPageCache,guidEntity:t.entity,contexttype:"entity"};$.when(e.dataService.submitData(r)).done(function(){})}}).render({idRender:t.id,idPageCache:t.idPageCache,requestedForm:"addForm",guidEntity:t.entity,contextType:"entity"}).fail(function(){})}}}}}),bizagi.rendering.letter.extend("bizagi.rendering.letter",{},{init:function(e){this._super(e),this.properties.required=!1}}),bizagi.rendering.button.extend("bizagi.rendering.button",{},{postRender:function(){var e=this,t=e.getControl(),i=$(":button",t);i.button(),i.removeClass("ui-state-default"),i.click(function(){e.processButton()})},postRenderReadOnly:function(){var e=this.getControl();this.postRender(),$(":button",e).button("option","disabled","true")},processButton:function(){var e=this,t=e.properties;t.editable&&(t.needsUserConfirmation?$.when(bizagi.showConfirmationBox(t.userConfirmationMessage,"Bizagi","warning")).done(function(){e.triggerRenderChange({pressed:!0})}):(t.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})))},runButtonAction:function(){var e=this;e.getFormContainer().clearValidationMessages(),e.saveForm().pipe(function(){return e.executeButton()}).done(function(t){if(null==t||1==t||"success"==t.result||"success"==t.type)return e.refreshForm();if("validationMessages"==t.type)try{e.getFormContainer().addValidationMessage(t.messages)}catch(e){bizagi.showMessageBox(t.messages,"Error")}}).fail(function(t,i,r){try{e.getFormContainer().addErrorMessage(r)}catch(e){bizagi.showMessageBox(r,"Error")}})},processLayout:function(){var e=this.properties,t=null==e.visible||bizagi.util.parseBoolean(e.visible);e.required=null!=e.required&&bizagi.util.parseBoolean(e.required),e.required&&this.changeRequired(e.required),t||this.changeVisibility(t)}}),bizagi.rendering.fileprint.extend("bizagi.rendering.fileprint",{},{postRender:function(){this.getControl().parent().hide()}}),bizagi.rendering.link.extend("bizagi.rendering.link",{},{configureHandlers:function(){var e=this,t=e.getControl(),i=e.properties,r=$(".ui-bizagi-render-link",t);e.input=t.find("a"),i.value?$(e.input).on("click",function(t){t.preventDefault(),e.isValidValue(i.value)&&window.open(encodeURI(this.getAttribute("href")),"_system")}):(r.addClass("bz-rn-link-disabled"),t.closest(".ui-bizagi-render").addClass("bz-rn-read-only"))},setDisplayValue:function(e){this.isValidValue(e)&&(e=getFullyDecodedURI($.trim(e)),this.input.attr("href",e),this.input.attr("target","_blank"),this.input.attr("data-rel","external"))},postRenderReadOnly:function(){this.properties.value&&this.configureHandlers(),this.configureHelpText()},isValidValue:function(e){return e&&null!==$.trim(e+"").toLowerCase().match(/^(http|https):\/\//)||!1}}),bizagi.rendering.checkList.extend("bizagi.rendering.checkList",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),this.properties.unique=Math.ceil(1e3*Math.random())},configureHandlers:function(){var e=this;e._super(),bizagi.util.isIE()?$("input[type=checkbox]",e.checkListGroup).bind("change",function(t,i){var r=$(this).data("item-guid"),a=!1;$(this).hasClass("bz-check")?($(this).removeClass("bz-check").addClass("bz-full-ball"),a=!1):($(this).removeClass("bz-full-ball").addClass("bz-check"),a=!0),e.onCheckListGroupChange(r,a)}):$("input[type=checkbox]",e.checkListGroup).bind("change",function(t,i){var r=$(this).data("item-guid"),a=!1;$(this).hasClass("bz-check")?($(this).removeClass("bz-check").addClass("bz-full-ball"),a=!1):($(this).removeClass("bz-full-ball").addClass("bz-check"),a=!0),e.onCheckListGroupChange(r,a)})},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,function(t,i){return t.guid===e});r&&r.length>0&&(i=r[0]),i.checked=t},clearDisplayValue:function(){bizagi.util.isIE()?$("input[type=checkbox]",this.checkListGroup).removeAttr("checked"):$("input[type=checkbox]",this.checkListGroup).check("uncheckItem")},setDisplayValue:function(e){}}),bizagi.rendering.checkList.extend("bizagi.rendering.activityCheckList",{},{postRender:function(){var e=this;e.getControl();this._super(),e.header=$(".ui-bizagi-render-checkList-activity-work",e.element),e.addButton=$(".ui-bizagi-render-checkList-add-item",e.control),e.newItemName=$(".ui-bizagi-render-checkList-input-name",e.control),e.separator=$(".ui-bizagi-render-checkList-separator",e.element),e.goalActivity=$(".ui-bizagi-render-checkList-goal-activity",e.element),e.addEditButton=$(".add-edit-item-button-checklist",e.control),e.cancelEditButton=$(".cancel-edit-item-button-checklist",e.control),e.additionalElements(),e.notifyLoadItems()},notifyLoadItems:function(){var e=this;setTimeout(function(){var t=e.properties.items.filter(function(e){return e.resolved}).length;bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:e.properties.idActivity,itemsResolved:t,items:e.properties.items,progress:e.properties.activityWork})),bizagi.webpart.publish("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})},100)},additionalElements:function(){var e=this,t=e.getControl(),i=(this.getResource("render-activity-check-list-activitywork"),e.properties.activityWork,this.getResource("render-activity-check-list-form"));e.header&&e.header.length>0||e.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-activity-work").append($("<span/>").text(bizagi.localization.getResource("workportal-project-plan-activity-work-title")))),e.goalActivity&&e.goalActivity.length>0||e.properties.activityDescription&&""!==e.properties.activityDescription&&e.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-goal-activity").append("<h4><span class='ui-bizagi-wp-bold'>"+bizagi.localization.getResource("workportal-project-plan-activity-goal")+": </span><span>"+e.properties.activityDescription+"</span></h4>")),e.addButton&&e.addButton.length>0||e.control.append($("<div/>").addClass("ui-bizagi-render-checkList-add-item").append($("<button/>").text("+"))),e.separator&&e.separator.length>0||e.element.append($("<div/>").addClass("ui-bizagi-render-checkList-separator").append($("<span/>").text(i))),e.addEditButton&&e.addEditButton.length>0&&e.addEditButton.hide(),e.cancelEditButton&&e.cancelEditButton.length>0&&e.cancelEditButton.hide(),t.parent().addClass("render-activity-check")},configureHandlers:function(){var e=this,t=e.getControl();this._super(),$(".ui-bizagi-render-checkList-add-item button",t).unbind("click").click(function(){var t=$(".ui-bizagi-render-checkList-item.selected",e.control);t.length<=0?e.prepareNewItem():$(".ui-bizagi-render-checkList-input-name",t).focus()}),$(".delete-item-from-activity",e.control).bind("click",function(){var t=this,i=bizagi.localization.getResource("workportal-widget-reports-confirm"),r=$(this).closest(".ui-bizagi-render-checkList-item");r.addClass("ui-bizagi-to-remove"),$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){var i=$(t).closest(".ui-bizagi-render-checkList-item").data("item-guid");e.deleteItem(i),e.addButton.show()}).fail(function(){r.removeClass("ui-bizagi-to-remove")})}),$(".activity-work-items",e.control).bind("click",function(){var t=$(this).closest(".ui-bizagi-render-checkList-item"),i=t.data("item-guid"),r=t.data("item-position");e.selectItem(i,r)})},selectItem:function(e){for(var t=0;t<this.properties.items.length;t++)this.properties.items[t].selected=this.properties.items[t].guid===e;this.repaintControl();var i=$(".ui-bizagi-render-checkList-item.selected"),r=$(".ui-bizagi-render-checkList-input-name",i),a=r.val();r.focus(),r[0].setSelectionRange(a.length,a.length),this.configureHandlers(),this.addSelectedHandlers()},deleteItem:function(e){for(var t=0;t<this.properties.items.length;t++)if(this.properties.items[t].guid===e){this.properties.items.splice(t,1);break}this.setValue(this.properties.items),this.repaintControl(),this.configureHandlers(),this.addSelectedHandlers()},prepareNewItem:function(){var e=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};e.properties.items.push(t),e.repaintControl(),e.addButton.hide(),e.newItemName.focus(),e.newItemName.blur(function(){var t=$(".ui-bizagi-render-checkList-item.selected",e.control);""===$(".ui-bizagi-render-checkList-input-name",t).val()&&e.properties.items&&e.properties.items.length>=1&&""===e.properties.items.slice(-1)[0].name&&e.properties.items.pop()}),e.addSelectedHandlers(),e.newItemName.keypress(function(t){13==t.which&&(t.preventDefault(),e.addItem(),e.prepareNewItem())})},addSelectedHandlers:function(){var e=this,t=$(".ui-bizagi-render-checkList-item.selected",e.control),i=$(".ui-bizagi-render-checkList-input-name",t);i.focus(),$(".add-item-button-checklist",t).bind("click",function(){var t=i.val();t&&""!==t&&e.addItem()}),$(".cancel-item-button-checklist",t).bind("click",function(t){var r=i.val(),a=$(this).closest(".ui-bizagi-render-checkList-item"),n=a.data("item-position"),o=a.data("item-guid");r&&""!==r&&""!==e.properties.items[n].name&&(e.properties.items[n].selected=!1),""!==r&&""!==e.properties.items[n].name||e.deleteItem(o),e.addButton.show(),e.repaintControl(),e.configureHandlers()})},addItem:function(){this.getControl();var e=$(".ui-bizagi-render-checkList-item.selected",this.control),t=$(".ui-bizagi-render-checkList-input-name",e).val();$.each(this.properties.items,function(e,i){i.selected&&(i.name=t,i.selected=!1)}),this.updateOriginalValue(),this.setValue(this.properties.items),this.repaintControl(),this.configureHandlers(),this.addButton.show()},repaintControl:function(){this.getControl();var e=this.renderControl();$(".ui-bizagi-render-checkList",this.control).replaceWith(e),this.postRender()},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,function(t,i){return t.guid===e});r&&r.length>0&&(i=r[0]),i.resolved=t,this.setValue(this.properties.items),this.refreshValue(this.properties.items)},refreshValue:function(e){this.getControl();for(var t=e.length,i=0,r=0;r<t;r++)e[r].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):100,this.notifyLoadItems()},getValue:function(e){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=this.properties.idActivity;this.controlValueIsChanged()?bizagi.util.isEmpty(i)||bizagi.util.isEmpty(a)||(Array.isArray(r)?e[t.xpath]={idActivity:a,items:r}:""===r&&(e[t.xpath]="")):bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))},isValid:function(e){var t,i=this.properties,r=this.getValue();t=this.getResource("render-activity-check-list-validation");for(var a=0;a<r.length;a+=1){if(!r[a].resolved){e.push({xpath:i.xpath,message:t});break}}}}),bizagi.rendering.layoutImage.extend("bizagi.rendering.layoutImage",{},{renderControl:function(){var e=this.renderFactory.getTemplate("layout-image");return this.control=this.getControl(),$.kendoTmpl(e,{})},postRender:function(){var e=this.getControl();if(this.value&&void 0!==this.value.value&&""!==this.value.value&&null!==this.value.value){var t=this.getImageUri();$.ajax({url:t,type:"GET",dataType:"binary",processData:!1,success:function(t){if("string"==typeof t){var i=arguments[2].getResponseHeader("Content-type");t=bizagi.util.media.byteArrayToBlob(bizagi.util.media.stringToByteArray(t),i)}var r=(window.URL||window.webkitURL).createObjectURL(t);$(e).find("img").attr("src",r)}})}},getImageUri:function(){var e=this.parent.parent.properties.paramsRender||{},t={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value,idcase:e.idRender?e.formParams.idCase:"_",idworkitem:e.idRender?e.formParams.idWorkitem:"_",contextxpath:e.idRender?e.xpathActions:"_"};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)},getDisplayValue:function(){return[this.value]}}),bizagi.rendering.layoutLink.extend("bizagi.rendering.layoutLink",{},{render:function(){this.getContainerRender().addClass("bz-command-not-edit")},postRender:function(){var e=this.element;e&&e.on("click",$.proxy(this.onClickElement,this))},onClickElement:function(){var e={displayName:this.properties.displayName,navigateFromRender:!1,reference:this.properties.reference,referenceType:this.properties.referenceType,xpath:this.properties.xpath};bizagi.kendoMobileApplication&&"#renderSplitView"===bizagi.kendoMobileApplication.view().id&&(e.navigateFromRender=!0),this.triggerGlobalHandler("DATA-NAVIGATION",e)}}),bizagi.rendering.layoutLabel.extend("bizagi.rendering.layoutLabel",{},{setValue:function(e,t){this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-label",i).text(e)}}),bizagi.rendering.layoutText.extend("bizagi.rendering.layoutText",{},{}),bizagi.rendering.layoutDateTime.extend("bizagi.rendering.layoutDateTime",{},{}),bizagi.rendering.layoutNumber.extend("bizagi.rendering.layoutNumber",{},{setValue:function(e,t){e=e?this.getDisplayValue(e):this.getDisplayValue(0),this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.layoutMoney.extend("bizagi.rendering.layoutMoney",{},{setValue:function(e,t){e=e?this.getDisplayValue(e):this.getDisplayValue(0),this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.layoutUpload.extend("bizagi.rendering.layoutUpload",{},{renderControl:function(){var e=this,t=e.properties,i=$.Deferred();return $.when(e.getValueFilesByData(bizagi.clone(t))).done(function(t,r){e.properties=t,e.files=r.files,i.resolve(e.getHTMLFiles())}),i.promise()},getHTMLFiles:function(){var e=this,t=$.map(e.files,function(t){var i={id:t[0],filename:t[1]};return i.url=e.buildItemUrl(i),i}),i=e.renderFactory.getTemplate("layout-upload");return $.fasttmpl(i,{files:t})},postRender:function(){var e=this;e.getControl().find(".ui-bizagi-render-layout-upload-item a").on("click",function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).attr("data-url"),this.title)).fail(function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)}).always(function(){bizagi.loading.stop()})})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileEntityUrl({isContextContainerWidgetRender:this.isContextContainerWidgetRender(),xpath:this.getUploadXpath(),fileId:e.id,idRender:i.properties.paramsRender.idRender||"undefined",xpathContext:t.xpathContext,idPageCache:i.properties.paramsRender.idPageCache||"undefined",xpathActions:i.properties.paramsRender.xpathActions||"undefined",sessionId:i.properties.sessionId,surrogatekey:this.properties.value.surrogateKey,guidentity:this.properties.value.guid})}}),bizagi.rendering.formLink.extend("bizagi.rendering.formLink",{},{postRender:function(){var e=this,t=e.getControl();$(".ui-bizagi-render-link",t).click(function(){if(e.properties.hasentryrule){var t=e.getFormContainer();$.when(t.saveForm()).done(function(){e.submitCheckpointRequest().done(function(){return e.openLinkRule("entryrule")})})}else e.openLink()}),e.properties.editable||e.element.addClass("bz-rn-read-only")},openLink:function(){var e=this;$.when(e.submitEditRequest()).done(function(){bizagi.util.tablet.startLoading(),$.when(e.paintFormLink()).done(function(){bizagi.util.tablet.stopLoading()}).fail(function(){bizagi.util.tablet.startLoading(),e.rollbackForm()}).always(function(){bizagi.util.tablet.stopLoading()})}).always(function(){bizagi.util.tablet.stopLoading()})},openLinkRule:function(e){var t=this,i=new $.Deferred;return bizagi.util.tablet.startLoading(),t.getPropertyValue(e,{}).done(function(r){if(void 0!==(r=r||{}).messages&&null!==r.messages){var a=r.messages[0];t.getFormContainer().validationController.showErrorMessage(a),i.reject()}else"entryrule"==e&&t.openLink();i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.util.tablet.stopLoading()}),i.promise()},postRenderReadOnly:function(){this.postRender()},paintFormLink:function(){var e=this,t=e.properties,i=e.getFormContainer(),r=e.getFormParams(),a=$.Deferred();return new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,navigation:e.getParams().navigation,showSaveButton:t.editable,orientation:t.orientation||"ltr",onSave:function(t){return e.actionSave(t).then(function(t){return e.submitForm(t).done(function(){a.resolve(t)}).fail(function(){a.reject()})}).fail(function(e){a.reject(e)})},goBack:function(){e.rollbackForm()}}).render({idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,formParams:r,url:t.editPage}).fail(function(){a.reject()}),a.promise()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done(function(e){"error"==e.type?(i.getFormContainer().validationController.showErrorMessage(e.message),a.reject(e)):a.resolve(e)}).fail(function(e,t,r){i.getFormContainer().validationController.showErrorMessage(e.message),a.reject(e,t,r)}),a.promise()},actionSave:function(e){var t=this,i=$.Deferred();return $.when(t.submitSaveRequest(e)).done(function(e){try{"validationMessages"==e.type?t.form.addValidationMessage(e.messages):"error"==e.type&&i.reject(e),i.resolve(e)}catch(e){i.reject({noAction:!0})}}).fail(function(e){i.reject(e)}),i.promise()},submitSaveRequest:function(e){var t=this.properties;if(!1===t.editable&&!t.value)return null;var i=this.getFormLinkXpath();return this.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:void 0===t.xpathContext||""===t.xpathContext?i:i?t.xpathContext+"."+i:t.xpathContext,submitData:e})},submitForm:function(e){var t=this,i=$.Deferred(),r=!0;return e&&"validationMessages"==e.type&&(r=!1),t.properties.hasexitrule?t.closeExitRule().done(function(){r&&t.submitCommitRequest().done(function(){t.properties.hasentryrule?t.submitCommitRequest().done(function(){$.when(t.submitOnChange()).done(function(){i.resolve(e)})}):$.when(t.submitOnChange()).done(function(){i.resolve(e)})})}).fail(function(){i.reject()}):r&&r&&t.submitCommitRequest().done(function(){t.properties.hasentryrule?t.submitCommitRequest().done(function(){$.when(t.submitOnChange()).done(function(){i.resolve(e)})}):$.when(t.submitOnChange()).done(function(){i.resolve(e)})}).fail(function(){i.reject()}),i.promise()},closeExitRule:function(){var e=this.properties,t=new $.Deferred;return e.hasexitrule&&$.when(this.openLinkRule("exitrule")).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},rollbackForm:function(){var e=this;$.when(e.submitRollbackRequest()).done(function(){e.properties.hasentryrule&&e.submitRollbackRequest()})},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e}}),bizagi.rendering.hidden.extend("bizagi.rendering.hidden",{},{}),bizagi.rendering.money.extend("bizagi.rendering.money",{},{renderReadOnly:function(){var e=this._super(),t=this.renderFactory.getTemplate("readonlyNumber"),i=$($.kendoTmpl(t,{value:e}));return $(".bz-cm-icon",i).removeClass("bz-rn-icon-number").removeClass("bz-number-icon").addClass("bz-coin-input").addClass("bz-rn-icon-coin"),i.get(0).outerHTML},postRender:function(){var e=this;e._super(),e.numericInput=$(".ui-bizagi-render-numeric",e.getControl()),e.numericIcon=$(".bz-cm-icon",e.getControl()),e.numericIcon.removeClass("bz-rn-icon-number").addClass("bz-rn-icon-coin"),e.numericIcon.removeClass("bz-number-icon").addClass("bz-coin-input"),","==e.properties.decimalSymbol&&e.numericInput.attr("lang","en-150");var t=$("input",e.element);t&&t.length},postRenderReadOnly:function(){var e=this.getControl();e.closest(".ui-bizagi-render").addClass("bz-rn-read-only"),this.numericInput=$(".ui-bizagi-render-numeric",e)},setDisplayValue:function(e){var t=this.properties;null!=e&&(t.editable?(this.numericInput.val(e),this.attachFormatCurrency(),this.executeFormatCurrencyPlugin()):this.numericInput.text(this.getDisplayValue()))}}),bizagi.rendering.radio.extend("bizagi.rendering.radio",{},{postRender:function(){var e=this;this._super(),e.combo=e.getControl(),e.combo.addClass("ui-bizagi-render-control-radio"),e.configureHelpText(),e.combo.change(function(){var t=e.combo.find("input:radio:checked");e.combo.find(".checked").removeClass("checked"),e.combo.find(".bz-check").addClass("bz-unchecked").removeClass("bz-check"),t.closest("div").addClass("checked"),t.addClass("bz-check"),t.removeClass("bz-unchecked");var i={id:t.prop("value"),value:t.siblings("label").text()};e.setValue(i)})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.kendoTmpl(e,{})},postRenderReadOnly:function(){var e=this.getControl();this._super(),e.addClass("bz-rn-read-only"),this.configureHelpText()},setDisplayValue:function(e){var t=this.properties;if(void 0!==e&&null!=e.id)if(t.editable){var i=this.combo.find("input[type='radio'][value='"+e.id+"']");i.prop("checked","checked"),i.closest("div").addClass("checked"),i.addClass("bz-check").removeClass("bz-unchecked")}else this.getControl().html(e.value)},cleanData:function(){var e={id:"",value:""};this.element.find(".ui-bizagi-render-radio-item .bz-check").prop("checked",!1).removeClass("bz-check").addClass("bz-unchecked"),this.setValue(e,!1),this.setDisplayValue(e)}}),bizagi.rendering.cascadingCombo.extend("bizagi.rendering.cascadingCombo",{},{init:function(e){var t=this;t._super(e),this.properties.data=this.properties.data||[],t.bind("select",function(e,i){t.onComboChange(i)})},renderReadOnly:function(){return bizagi.rendering.combo.prototype.renderReadOnly.apply(this,arguments)},initializeCombo:function(){var e=this,t=e.getParentCombo();null!=t&&"cascadingCombo"==t.properties.type&&(e.isDependant=!0,t.dependants.push(e),null!=e.getValue()?e.properties.parentComboValue=e.getValue().id:e.initializingCascadingCombo=!0),e.initialValueSet=!0,$.when(bizagi.rendering.combo.prototype.initializeCombo.apply(e,arguments)).done(function(){e.value&&0==e.isDependant&&e.triggerHandler("select",e.value),e.initialValueSet=!1})},bindDependantCombo:function(){},postRender:function(){bizagi.rendering.combo.prototype.postRender.apply(this,arguments)},postRenderReadOnly:function(){bizagi.rendering.combo.prototype.postRenderReadOnly.apply(this,arguments)},renderEdition:function(){bizagi.rendering.combo.prototype.renderEdition.apply(this,arguments)},configureCombo:function(){bizagi.rendering.combo.prototype.configureCombo.apply(this,arguments)},configureModalViewHandlers:function(){bizagi.rendering.combo.prototype.configureModalViewHandlers.apply(this,arguments)},filterList:function(){bizagi.rendering.combo.prototype.filterList.apply(this,arguments)},actionSave:function(){bizagi.rendering.combo.prototype.actionSave.apply(this,arguments)},setModalViewDisplayValue:function(){bizagi.rendering.combo.prototype.setModalViewDisplayValue.apply(this,arguments)},setDisplayValue:function(e){bizagi.rendering.combo.prototype.setDisplayValue.apply(this,arguments)},setValue:function(e,t){t=void 0===t||t,""===e&&(e={id:"",value:""}),e&&(null!==this.value&&this.value.id===e.id||this.triggerHandler("select",e),this._super(e,t))},findDataValueById:function(e){return(this.properties.data||[]).find(function(t){return t.id==e})},cleanData:function(){bizagi.rendering.combo.prototype.cleanData.apply(this,arguments)},resetData:function(){bizagi.rendering.combo.prototype.resetData.apply(this,arguments)},changeCombo:function(e,t){bizagi.rendering.combo.prototype.changeCombo.apply(this,arguments)},processComboData:function(e){bizagi.rendering.combo.prototype.processComboData.apply(this,arguments)},validateValue:function(e){bizagi.rendering.combo.prototype.validateValue.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.combo.prototype.getSelectedValue.call(this,arguments)},onComboChange:function(e){var t=this;t.selectedValue=e.value;var i={};i[t.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=e.id,$.each(this.dependants,function(r,a){a.properties.params=i,a.properties.parentComboValue=e.id,""==e.id?(a.resetData(),a.setDisplayValue({id:"",value:""})):$.when(a.getData(i)).done(function(e){if(a.properties.data=e,null!==a.value){var i=a.findDataValueById(a.value.id);i?""==i.id&&t.value&&""==t.value.value?(a.resetData(),a.setDisplayValue({id:"",value:""})):a.triggerHandler("select",i):(a.setDisplayValue({id:"",value:""}),a.triggerHandler("select",{id:"",value:""}))}else a.triggerHandler("select",{id:"",value:""})})})},getTemplateName:function(){return"combo"}}),bizagi.rendering.list.extend("bizagi.rendering.list",{},{postRender:function(){var e=this,t=e.getControl();if(this._super(),t.addClass("ui-bizagi-render-display-block"),e.list=$(".ui-bizagi-render-list",t),!e.properties.editable){container.addClass("bz-command-not-edit"),e.list.attr("readonly","readonly");var i=e.properties.value?e.properties.value.value:"- - ";e.control.html('<span class="bz-command-not-edit bz-rn-align-class bz-rn-text">'+i+"</span>")}$.when(e.ready()).done(function(){e.hasValue()?e.getControl().find(".bz-wp-list-clear-icon-list").show(500):(e.getControl().find(".bz-rn-input-selected").html("-------------"),e.getControl().find(".bz-wp-list-clear-icon-list").hide(500))}),e.configureListHandlers()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.kendoTmpl(e,{})},postRenderReadOnly:function(){var e=this.getControl();this._super(),this.list=e.find(".readonly-control")},configureListHandlers:function(){var e=this,t=e.getControl();e.list.find(".see-more-icon").bind("click",function(){var t=e.renderFactory.getTemplate("listModalView"),i=kendo.template(t,{useWithBlock:!1}),r={items:e.properties.data,displayName:e.properties.displayName||"",orientation:e.properties.orientation},a=$($.trim(i(r)));a.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.configureModalViewHandlers(a),e.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open"),a.closest(".k-animation-container").addClass("bz-rn-new-modalview-position")}),e.list.on("click",".bz-rn-regular-element",function(){var t={id:$(this).data("value"),value:$(this).text()};e.selectedValue=t.value,e.setValue(t),e.setDisplayValue(t)}),t.find(".bz-rn-first-element-container").on("click",".bz-wp-list-clear-icon-list",function(){var t={id:"",value:"-------------"};e.setValue(t),e.selectedValue=t.value,e.setDisplayValue(t)})},configureModalViewHandlers:function(e){var t=this,i=new $.Deferred,r=e.find(".ui-bizagi-render-list-elements li");e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.delegate("#ui-bizagi-cancel-button","click",function(){i.reject(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-header-input-search").bind("change keypress keyup change",function(){t.filterList(this.value,r,e)}),e.find(".bz-wp-modalview-header-cancel-search").bind("click",function(){t.filterList("",r,e),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)}),t.modalViewList=$(".ui-bizagi-render-list-elements",e),t.setModalViewDisplayValue(),t.modalViewList.on("click","li",function(){t.modalViewList.find("li").filter(function(){if($(this).hasClass("ui-state-active"))return $(this)}).removeClass("ui-state-focus ui-selected ui-state-active"),$(this).addClass("ui-state-focus ui-selected ui-state-active"),$(".bz-wp-modalview-header-input-search",e).blur()}),e.delegate(".ui-bizagi-apply-button","click",function(){i.resolve(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-close").bind("click",function(){i.reject(),e.data("kendoMobileModalView").close()}),$.when(i).done(function(){var e=$("li.ui-selected",t.modalViewList),i=$(e).data("value"),r=$(e).text();if(void 0!==i){var a={id:i,value:r};t.setValue(a),t.selectedValue=a.value,t.setDisplayValue(a)}}).fail(function(){})},filterList:function(e,t,i){""!==e?i.find(".bz-wp-modalview-header-cancel-search").show(500):i.find(".bz-wp-modalview-header-cancel-search").hide(500),t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},setDisplayValue:function(e){var t=this.properties,i=this.getControl();void 0!==e&&(t.editable?(i.find(".bz-rn-input-selected").html(e.value),"-------------"===e.value||""===e.value?i.find(".bz-wp-list-clear-icon-list").hide():i.find(".bz-wp-list-clear-icon-list").show()):this.list.text(e.value))},cleanData:function(){var e={id:"",value:""};this.getControl();this.setValue(e),this.setDisplayValue(e)},setModalViewDisplayValue:function(){var e=this.properties;this.list&&e.editable&&this.properties.value&&void 0!==this.properties.value&&""!==this.properties.value.id&&$("#ui-bizagi-list-"+this.properties.value.id,this.modalViewList).addClass("ui-state-focus ui-selected ui-state-active")},configureHandlers:function(){this._super()},getSelectedValue:function(){return this.selectedValue}}),bizagi.rendering.multiSelect.extend("bizagi.rendering.multiSelect",bizagi.rendering.render.base.prototype),bizagi.rendering.multiSelect.extend("bizagi.rendering.multiSelect",{MORE_OPTION_WIDTH:40,SEARCH_MIN_LENGTH:1,temporalElements:{}},{postRender:function(){this._super()},configureHandlers:function(){var e=this.getControl();$(".bz-multiselect__arrow",e).on("click",this.openModalView.bind(this)),$("ul.bz-multiselect__tags",e).on("click","li div.bz-btn-icn",this.onUnselectElement.bind(this)).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},configureHandlersReadOnly:function(){var e=this.getControl();$("ul.bz-multiselect__tags",e).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},onUnselectElement:function(e){var t=$(e.target).data("id");this.removeElement({id:t}),this.addSelectedElements()},onShowSelectedElements:function(e){var t=this,i=$(e.currentTarget).data("index"),r=(t.getDataValue()||[]).slice(i),a=this.renderFactory.getTemplate("list-multiselect-tags"),n=this.showFloatListView(a,{datasource:r,editable:t.properties.editable}),o=$("ul.bz-multiselect__tags",n);o.on("click, mousedown","li div.bz-btn-icn",function(e){t.onUnselectElement(e),n.remove()}),n.on("closeView",function(){o.off("click","li div.bz-btn-icn",t.onUnselectElement.bind(t)),n.remove()})},openModalView:function(){var e=this;e.Class.temporalElements={};var t=e.renderFactory.getTemplate("multiselectModalView"),i=e.getDataValue(),r={selected:i,isChecked:function(t){return e.markAsChecked.call(this,t)}};this.getData().done(function(a){var n={displayName:e.properties.displayName||"",orientation:e.properties.orientation,datasource:a,options:r};try{for(var o=kendo.template(t,{useWithBlock:!1}),s=0,l=i.length;s<l;s++)e.Class.temporalElements[i[s].id]=i[s];var d=$($.trim(o(n)));e.modalListHandlers(d),d.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.configureModalViewHandlers(d),e.triggerGlobalHandler("modalViewDidAppear",{}),d.kendoMobileModalView("open"),d.closest(".k-animation-container").addClass("bz-rn-new-modalview-position")}catch(e){bizagi.log(e.message)}})},configureModalViewHandlers:function(e){var t=this,i=e.find(".bz-multiselect__list li"),r=new $.Deferred;e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.delegate("#ui-bizagi-cancel-button","click",function(){r.reject(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-header-input-search").bind("keypress keyup",function(){""!==this.value?e.find(".bz-wp-modalview-header-cancel-search").show(500):(e.find(".bz-wp-modalview-header-cancel-search").hide(500),$("#ui-bizagi-wp-filter-results-multiselect-wrapper ul li",e).show()),t.filterList(this.value,i)}).focus(function(){e.find(".filter-searchlist-modal-view-tags").addClass("searching")}).blur(function(){e.find(".filter-searchlist-modal-view-tags").removeClass("searching")}),e.find(".bz-wp-modalview-header-cancel-search").bind("click",function(){$("#ui-bizagi-wp-filter-results-multiselect-wrapper ul li",e).show(),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)}),e.delegate(".ui-bizagi-apply-button","click",function(){r.resolve(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-close").bind("click",function(){r.reject(),e.data("kendoMobileModalView").close()}),e.find(".filter-searchlist-modal-view-tags").on("click",".bz-rn-remove-tag-on-search-list",function(){t.removeItem($(this),!0);var r=e.find(".bz-wp-modalview-header-input-search").val();t.filterList(r,i)}),$.when(r).done(function(){t.addNewValuesToInput(),t.Class.temporalElements={}}).fail(function(){t.Class.temporalElements={}})},addNewValuesToInput:function(){var e=[];$.each(this.Class.temporalElements,function(t,i){e.push(i)}),this.setValue(e),this.addSelectedElements()},postRenderReadOnly:function(){this._super()},addSelectedElements:function(){var e=this.getControl(),t=this.getDataValue(),i=t.length,r=$("ul.bz-multiselect__tags",e),a=this.properties.editable;if(r.empty(),i>0)for(var n=this.renderFactory.getTemplate("list-multiselect-tag"),o=0;o<i;o++){var s=t[o],l={id:s.id,value:s.value,editable:a},d=kendo.template(n,{useWithBlock:!1}),c=$($.trim(d(l)));if(r.append(c),this.processControlLayout(this.properties.valueFormat||{}),!this.canAddMoreItems(r)){r.children().last().remove();l={value:i-o,index:o};var u=kendo.template(this.renderFactory.getTemplate("list-multiselect-view-more"),{useWithBlock:!1}),p=$($.trim(u(l)));r.append(p);break}}},modalListHandlers:function(e){var t=this,i=e.find(".bz-multiselect__list li"),r=i.find("input[type=checkbox]");e.find(".bz-multiselect__search_input").bind("change keypress keyup mousedown",function(e){e.stopPropagation(),t.filterList(this.value,i)}),r.change(function(){var e=$(this),i=e.is(":checked"),r={id:e.data("id"),value:e.data("value")};i?t.addTemporalElement(r,!1):t.addTemporalElement(r,!0)}),e.on("closeView",function(){t.closeFloatView(),$(document).unbind("mousedown.multiselect")})},addTemporalElement:function(e,t){t?delete this.Class.temporalElements[e.id]:this.Class.temporalElements[e.id]=e},showFloatListView:function(e,t){var i=this.getControl(),r=$(".bz-multiselect",i),a=i.closest(".ui-bizagi-render-control"),n=kendo.template(e,{useWithBlock:!1}),o=$($.trim(n(t))),s=r.width();return a.append(o),o.width(s),o.position({my:"left top",at:"left bottom",of:r,collision:"fit"}).hide(),o.show(),o.on("mousedown",function(e){return e.preventDefault(),!1}),$(document).one("mousedown.multiselect",function(e){o.trigger("closeView")}),o}}),bizagi.rendering.association.extend("bizagi.rendering.association",{},{renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done(function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=e.getColumnData(),n=$.kendoTmpl(t,$.extend(e.properties,{columnData:a}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)}),i.promise()},getColumnData:function(){var e=this,t=e.properties,i=[];e.data=t;var r=t.flipped?t.rightData:t.leftData;return $.each(r,function(t,r){i.push({id:r.id,value:r.value,association:e.getRightAssociation(r.id)})}),i},postRender:function(){var e=this.getControl();this.association=$(".bz-rn-association-control",e),this.addEventControl(),this.showDefaultContainer()},showDefaultContainer:function(){var e=this.getControl();if($(".bz-rn-association-group .bz-rn-association-header",e).length>0){var t=$($(".bz-rn-association-group .bz-rn-association-header",e)[0]),i=$($(".bz-rn-association-group .bz-rn-association-items",e)[0]);this.closeAccordionSection(!0),t.addClass("active"),i.slideDown(300).addClass("open")}},closeAccordionSection:function(e){var t=this.getControl(),i=$(".bz-rn-association-group .bz-rn-association-header",t),r=$(".bz-rn-association-group .bz-rn-association-items",t);e&&(i=i.not(":first").removeClass("active"),r=r.not(":first").slideUp(300).removeClass("open")),i.removeClass("active"),r.slideUp(300).removeClass("open")},addEventControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e.association.delegate("input:checkbox","change",function(){var t=$(this);t.prop("checked")?(t.addClass("bz-check"),e.associateElement(t)):(t.removeClass("bz-check"),e.dissociateElement(t))}),e.association.delegate(".bz-rn-association-flip-button","click",function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties);var r=e.getColumnData();$.kendoTmpls(t,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation,getLeftName:e.getLeftName}).appendTo(i),e.postRender()}),e.association.delegate(".bz-rn-association-container .bz-rn-association-header","click",function(){$(this).is(".active")||(e.closeAccordionSection(),$(this).addClass("active"),$(this).siblings().slideDown(300).addClass("open"))})},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.renderFactory.getTemplate("association");t.empty(),e.makeJsonBase();var r=e.getColumnData();$.kendoTmpls(i,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation,getLeftName:e.getLeftName}).appendTo(t),e.association=$(".bz-rn-association-control",t),e.association.find("input:checkbox").hide(),e.association.find(".ui-bz-rn-check-item label").addClass("bz-rn-association-non-editable"),$.when(e.ready()).done(function(){e.showDefaultContainer(),e.properties.allowFlip&&e.association.delegate(".bz-rn-association-flip-button","click",function(){$(t).empty(),e.properties.flipped=!e.properties.flipped,e.postRenderReadOnly()}),e.association.delegate(".bz-rn-association-container .bz-rn-association-header","click",function(){$(this).is(".active")||(e.closeAccordionSection(),$(this).addClass("active"),$(this).siblings().slideDown(300).addClass("open"))})})},associateElement:function(e){var t=this.getControl(),i=$(e.parents("ul"),t).data("parent-id"),r=e.data("id");this.addElement(i,r)},dissociateElement:function(e){var t=this.getControl(),i=$(e.parents("ul"),t).data("parent-id"),r=e.data("id");this.removeElement(i,r)}}),bizagi.rendering.ecm.extend("bizagi.rendering.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav"]},{renderControl:function(e,t){var i=this;return $.when(i._super(e,t)).done(function(e){return e}).fail(function(){return"Error"}).always(function(e){return i.stopLoading(),e})},postRender:function(){this._super(),this.activateUploadNative()},replaceControlHtml:function(e,t){e=e||"",t=t||"";var i=$(e.replace("{{control}}",t));return""===t&&this.startLoading(i),i.get(0).outerHTML},changeRequired:function(e){var t=$("label",this.getLabel()),i=this.getControl();i.find(".ui-bizagi-render-control-required, .bz-rn-ecm-required").remove();var r=this.properties;r.required=e,bizagi.util.parseBoolean(e)?(t.text((r.displayName||"")+" "),this.hasValue()?i.prepend('<div class="bz-rn-ecm-required" style="display: none"></div>'):i.prepend('<div class="bz-rn-ecm-required"></div>')):t.text(r.displayName||""),this.triggerRenderValidate()},changeRequiredLabel:function(){var e=this.properties,t=this.getControl();t.find(".ui-bizagi-render-control-required, .bz-rn-ecm-required").remove(),e.required&&(this.checkRequired([])?t.prepend('<div class="bz-rn-ecm-required" style="display: none"></div>'):t.prepend('<div class="bz-rn-ecm-required"></div>'))},startLoading:function(e){e=e||this.getRenderedElement(),$(".ui-bizagi-render-control",e).prepend('<div class="innerLoader"></div>').addClass("bz-rn-ecm-control")},stopLoading:function(){$(".innerLoader",this.getControl()).remove()},startWaiting:function(e){var t=e.closest(".bz-rn-ecm-metadata");e.addClass("loading"),t.find("input, a").css("opacity",.6),t.find(".ui-bizagi-render-button, button, input").prop("disabled","disabled"),t.find("input").prop("readonly","readonly")},stopWaiting:function(e){var t=e.closest(".bz-rn-ecm-metadata");t.find("input, a").css("opacity",1),t.find(".ui-bizagi-render-button, button, input").prop("disabled",!1),t.find("input").prop("readonly",!1),t.find(".loading").removeClass("loading")},postRenderReadOnly:function(){bizagi.util.isCordovaSupported()||this.addEventToOpenSlide(),this.properties.editable||this.element.addClass("bz-rn-read-only"),this.closeAccordionSection()},addEventToOpenSlide:function(){var e=this,t=e.getMode(),i=e.getControl();e.itemAddfile=$(".bz-rn-upload-show-menu",i),e.itemAddfile.hide(),$("li",i).click(function(){if("execution"===t){bizagi.loading.start();var i=this.title||$(this).data("filename");$.when(bizagi.util.media.downloadFile($(this).data("url"),i)).fail(function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)}).always(function(){bizagi.loading.stop()})}})},activateUploadNative:function(){var e=this,t=e.properties,i=e.getControl(),r=e.getControl();if(e.getLabel()&&e.getLabel().hide(),e.itemAddfile=$(".bz-rn-ecm-upload",i),e.$inputFile=$(".bz-rn-upload-files-web",r),$(".bz-rn-ecm-activate-menu",r).bind("click",function(){var t=$(this),i=t.parents(".bz-rn-ecm-metadata"),r=$(".bz-rn-ecm-menu-container",i);$(this).is(".active")||$(".bz-rn-ecm-metadata-container",i).is(".active")?$(".bz-rn-ecm-metadata-container",i).is(".active")||($(this).removeClass("active"),e.closeAccordionSection()):(e.closeAccordionSection(),$(this).addClass("active"),r.addClass("showMenu"));var a=t.parent().data("idfileupload")||"";e.elementsEvent={menu:r,lock:$(".bz-ecm-lock",r),unlock:$(".bz-ecm-unlock",r),del:$(".bz-ecm-delete",r),edit:$(".bz-ecm-edit",r),element:{id:a,filename:t.parent().attr("title")||"",elementReference:this},params:{idFileUpload:a,xPath:e.properties.xpath,idAttrib:e.properties.idAttrib,idPageCache:e.properties.idPageCache,xpathContext:e.getXpathContext()},panelMetadata:$(".bz-rn-ecm-metadata-container",i),btnCancel:$(".ecm-btn-cancel",i),btnSave:$(".ecm-btn-save",i)},r.is(":visible")?e.addEventsEcm():e.removeEventsEcm()}),t.editable)if(bizagi.util.isCordovaSupported()){if(bizagi.util.isAndroidTabletDevice())e.uploadEcmLink=$(".bz-rn-ecm-url > span",i),e.uploadEcmLink.on("click",function(){window.open(encodeURI(this.getAttribute("href")),"_system","location=yes")});else if(bizagi.util.isNativePluginSupported()){var a=i.find(".bz-rn-ecm-url > a");a.removeAttr("href"),a.on("click",function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).data("url"),this.title)).fail(function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)}).always(function(){bizagi.loading.stop()})})}e.itemsUpload={file:$(".file",i),image:$(".image",i),cimage:$(".cimage",i),caudio:$(".caudio",i),cvideo:$(".cvideo",i)},e.itemAddfile.bind("click",function(){var t=e.renderFactory.getTemplate("ecmModalView"),i=kendo.template(t,{useWithBlock:!1}),r={editable:e.properties.editable,displayName:e.properties.displayName||""},a=$($.trim(i(r))).clone();a.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},modal:!1}),e.configureModalViewHandlers(a),e.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open")}),e.checkExtensions(),e.checkMaxFiles()}else bizagi.util.media.fileAPISupported()?$(e.itemAddfile).click(function(){e.$inputFile.click()}):e.itemAddfile.hide(),e.$inputFile.on("click",function(e){e.stopPropagation()}),e.$inputFile.on("change",function(){var t=e.$inputFile[0].files[0];t.fullPath=e.$inputFile[0].value;var i=[].concat(e.Class.EXTENSIONSIMG,e.Class.EXTENSIONSVIDEO,e.Class.EXTENSIONSAUDIO);e.startLoading(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.uploadFile(t)).done(function(t){"object"!=typeof t&&(t={response:t}),e.onUploadFileCompleted(e,t)}).fail(function(t){e.stopLoading(),"Unauthorized"!==t.statusText&&bizagi.showMessageBox(e.getResource("workportal-widget-admin-language-error")),3===t.code?bizagi.showMessageBox(e.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(e.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+t.code)}):e.stopLoading()});else e.itemAddfile.hide()},closeAccordionSection:function(){var e=this.getControl(),t=$(".bz-rn-ecm-activate-menu",e),i=$(".bz-rn-ecm-menu-container",e),r=$(".bz-rn-ecm-metadata-container",e);t.removeClass("active"),i.removeClass("showMenu"),r.removeClass("active"),r.slideUp(300).removeClass("open")},configureModalViewHandlers:function(e){var t=this;t.listOptions=e.find(".bz-rn-upload-options li"),t.listOptions.bind("click",function(){e.kendoMobileModalView("close"),t.applyListener($(this).data("role"))}),e.find(".bz-wp-modalview-close").bind("click",function(){e.kendoMobileModalView("close")})},addEventsEcm:function(){var e=this;e.removeEventsEcm(),e.elementsEvent.lock.click(function(){$.when(e.dataService.checkOutFile(e.elementsEvent.params)).done(function(){e.elementsEvent.lock.removeClass("bz-ecm-item-menu-enable"),e.elementsEvent.unlock.addClass("bz-ecm-item-menu-enable")})}),e.elementsEvent.unlock.click(function(){$.when(e.dataService.cancelCheckOut(e.elementsEvent.params)).done(function(){e.elementsEvent.unlock.removeClass("bz-ecm-item-menu-enable"),e.elementsEvent.lock.addClass("bz-ecm-item-menu-enable")})});var t=null;e.elementsEvent.del.bind("click",function(){clearTimeout(t),e.closeAccordionSection(),e.startLoading(),$(e.elementsEvent.element.elementReference).closest(".bz-rn-ecm-metadata").css("opacity",.5),$.when(e.dataService.deleteECMFile(e.elementsEvent.params)).done(function(){e.stopLoading(),e.removeEventsEcm(),$(e.elementsEvent.element.elementReference).parents(".bz-rn-ecm-metadata").remove();for(var t=[].concat(e.files),i=0;i<t.length;i++)t[i][0]===e.elementsEvent.params.idFileUpload&&t.splice(i,1);e.setValue(t),e.checkMaxFiles()})}),e.setMobiscroll(),e.elementsEvent.edit.click(function(){clearTimeout(t),e.closeAccordionSection(),e.elementsEvent.panelMetadata.is(".active")||(e.elementsEvent.panelMetadata.addClass("active"),t=setTimeout(function(){e.elementsEvent.panelMetadata.stop().slideDown(300).addClass("open")},200))}),e.elementsEvent.btnSave.click(function(){var i=e.properties,r=$(".bz-rn-ecm-metadata-value",e.elementsEvent.panelMetadata),a=[],n=!1,o=$(this);clearTimeout(t),e.startWaiting(o);for(var s=0;s<r.length;s++){var l=r[s],d=$(l).data("value"),c=$(l).data("metadatatype"),u=$(l).data("required"),p=$(l).data("readonly"),g=$(l).data("description"),h=$(l).data("idmetadata"),m=null;if(p)return e.stopLoading(),e.stopWaiting(o),!0;if("STRING"==c||"DECIMAL"==c)m=$("input",l).val();else if("BOOL"==c)m=$("input[name=ecm-radio]:checked",l).val();else if("DATETIME"==c){var f=e.properties.fullFormat?e.properties.fullFormat:"fullFormat"!=e.getResource("fullFormat")?e.getResource("fullFormat"):"yyyy-MM-dd HH:mm:ss";m=bizagi.util.dateFormatter.formatDate(bizagi.util.dateFormatter.getDateFromISO($("input",l).attr("value"),!1),f)}!u||""!==m&&null!==m||(bizagi.showMessageBox(g+": "+e.getResource("render-ecm-tooltip-mandatory"),"Error"),n=!0),n||m==d||a.push({idMetadata:h,value:m})}if(n)e.stopLoading(),e.stopWaiting(o);else{var b=e.buildAddParams();b.fileName=e.elementsEvent.element.filename,b.idFileUpload=e.elementsEvent.element.id,b.idPageCache=i.idPageCache,b.metaValues=JSON.encode({metadataValues:a}),$.when(e.dataService.updateECMMetadata(b)).done(function(){e.stopLoading(),e.stopWaiting(o)})}}),e.elementsEvent.btnCancel.click(function(){e.closeAccordionSection(),e.removeEventsEcm()})},setMobiscroll:function(){this.elementsEvent.panelMetadata.find(".bz-ecm-metadata-date").each(function(e,t){var i=$(t),r=i.attr("value"),a=new Date,n=new Date(r)||a,o=a.getTime()<n.getTime()?a:n;o.setFullYear(o.getFullYear()-2),i.mobiscroll().calendar({mode:"mixed",display:"bottom",controls:["calendar"],min:o,defaultValue:n,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",onSet:function(e){i.attr("value",e.valueText)}})})},removeEventsEcm:function(){this.elementsEvent.lock.unbind("click"),this.elementsEvent.unlock.unbind("click"),this.elementsEvent.del.unbind("click"),this.elementsEvent.edit.unbind("click"),this.elementsEvent.btnSave.unbind("click"),this.elementsEvent.btnCancel.unbind("click")},removeListener:function(){this.itemsUpload.image.unbind("click"),this.itemsUpload.file.unbind("click"),this.itemsUpload.cimage.unbind("click"),this.itemsUpload.caudio.unbind("click"),this.itemsUpload.cvideo.unbind("click")},applyListener:function(e){var t=this;switch(e){case"image":navigator.camera.getPicture(function(e){$.when(bizagi.util.media.checkMaxSize(e,t.properties)).done(function(){$.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){t.fileProperties=i,t.saveImage(t,e)})}),t.itemAddfile.click()},t.onFail,{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case"cimage":navigator.camera.getPicture(function(e){$.when(bizagi.util.media.checkMaxSize(e,t.properties)).done(function(){$.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){t.fileProperties=i,t.saveImage(t,e)})}),t.itemAddfile.click()},t.onFail,{quality:t.Class.QUALITY_PICTURE,correctOrientation:!0});break;case"caudio":navigator.device.capture.captureAudio(function(e){var i=e[0].localURL;$.when(bizagi.util.media.checkMaxSize(i,t.properties)).done(function(){t.saveAudio(t,e)}).always(function(){bizagi.loading.stop({})}),t.itemAddfile.click()},t.onFail,{limit:t.Class.LIMIT});break;case"cvideo":navigator.device.capture.captureVideo(function(e){$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).done(function(){t.saveVideo(t,e)}).always(function(){bizagi.loading.stop({})}),t.itemAddfile.click()},t.onFail,{limit:t.Class.LIMIT});break;case"file":bizagi.showMessageBox("In development","Error")}},renderUploadItem:function(e){return this._super(e)},uploadFile:function(e){var t=this,i=new $.Deferred;if(bizagi.util.media.checkMaxSizeFile(e,t.properties)&&bizagi.util.media.checkFileTypes(e,t.properties,[].concat(t.Class.EXTENSIONSIMG,t.Class.EXTENSIONSVIDEO,t.Class.EXTENSIONSAUDIO))){var r=new FormData,a=t.getFormContainer(),n=t.buildAddParams();Object.keys(n).map(function(e){r.append(e,n[e])}),r.append("Filedata",e),r.append("Filename",e.name.substr(e.name.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1)),t.properties.contexttype&&r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",t.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}t.dataService.processUploadFile({url:t.properties.addUrl,formData:r}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})}else bizagi.loading.stop();return i.promise()},saveImage:function(e,t){var i=e,r={},a=i.buildAddParams(),n=i.fileProperties.name;i.editedImageURL?r.dataFile=i.editedImageURL:i.fileProperties&&(r.dataFile=i.fileProperties.url),a.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),a.xPath=a.xPath,a.Filename=n,r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=i.properties.addUrl,i.editedImageURL=null,i.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(r)).done(function(t){i.onUploadFileCompleted(e,t)}).fail(function(e){3===e.code?bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(i.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+e.code)}).always(function(){bizagi.loading.stop({})})},saveAudio:function(e,t){var i=e,r={},a=t[0].name,n=i.buildAddParams();n.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),n.xPath=n.xPath,n.Filename=a,r.data=n,r.options=new FileUploadOptions,r.options.fileName=a,r.options.uploadKey={key:n.xPath},r.options.addUrl=i.properties.addUrl,r.dataFile=t[0].fullPath,bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(r)).done(function(t){i.onUploadFileCompleted(e,t)}).fail(function(e){3===e.code?bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(i.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+e.code)}).always(function(){bizagi.loading.stop({})})},saveVideo:function(e,t){var i=e,r={},a=t[0].name,n=i.buildAddParams();n.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),n.xPath=n.xPath,n.Filename=a,r.data=n,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=a,r.options.uploadKey={key:n.xPath},r.options.addUrl=i.properties.addUrl,r.dataFile=t[0].fullPath,bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(r)).done(function(t){i.onUploadFileCompleted(e,t)}).fail(function(e){3===e.code?bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(i.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+e.code)}).always(function(){bizagi.loading.stop({})})},onFail:function(e){bizagi.log("Error code: "+e.code)},onUploadFileCompleted:function(e,t){var i=this;try{if(!(t=JSON.parse(decodeURI(t.response))).idFileUpload)throw"not present idFileUpload";i.submitOnChange()}catch(e){bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"),bizagi.log("Error ECM:"),bizagi.log(e)}},checkMaxFiles:function(){var e=this.properties,t=e.maxfiles,i=e.value.length;0!==t&&i>=t&&(this.itemAddfile.hide(),this.removeListener())},checkExtensions:function(){var e=this,t=e.properties.validExtensions;if(t&&(1!=(t=t.split(";")).length||-1===t[0].indexOf("*.*"))){for(var i=!1,r=0;r<t.length;r++){t[r]=t[r].replace("*.",""),e.Class.EXTENSIONSIMG.toString().indexOf(t[r])>=0&&(i=!0)}i||(e.itemsUpload.image.hide(),e.itemsUpload.cimage.hide(),e.itemsUpload.image.parent().addClass("bz-rn-upload-hidden-item"),e.itemsUpload.cimage.parent().addClass("bz-rn-upload-hidden-item")),e.itemsUpload.caudio.hide(),e.itemsUpload.caudio.parent().addClass("bz-rn-upload-hidden-item"),e.itemsUpload.cvideo.hide(),e.itemsUpload.cvideo.parent().addClass("bz-rn-upload-hidden-item"),i||(e.itemAddfile.hide(),e.removeListener())}},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),a=i.renderFactory.getTemplate("ecm-metadata"),n=$.Deferred();return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done(function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice(),t[0].metadata&&t[0].metadata.length&&t[0].metadata.map(function(e){"DATETIME"===e.metadataType&&(e.dateFormat="fullFormat"!==i.getResource("fullFormat")?i.getResource("fullFormat"):i.properties.fullFormat?i.properties.fullFormat:"yyyy-MM-dd HH:mm:ss",e.value=bizagi.util.dateFormatter.formatDate(e.value?bizagi.util.dateFormatter.getDateFromFormat(e.value,e.dateFormat):new Date,"yyyy-MM-dd"))});var s=$.kendoTmpl(a,t[0]);n.resolve(s)}),n.promise()},isValid:function(e){var t=this.getControl(),i=[],r=!1,a=this.properties,n=!0;a.required&&(n=!!(this.grid&&this.grid.isFromCreatedRow.apply(this))||this._super(e),0===this.filesCount&&n&&(e.push({xPath:a.xpath,message:this.getResource("render-required-text").replaceAll("#label#",a.displayName)}),n=!1));if(a.editable){var o=$(".bz-rn-ecm-container:visible",t).find(".bz-rn-ecm-metadata-value[data-required='true']");$.each(o,function(e,t){""===$("input",t).val()&&(i.push($(t).data("description")),r=!0)})}if(r){var s=this.getResource("render-required-text").replaceAll("#label#",i.join(", "));e.push({xPath:a.xpath,message:s})}return n},cleanData:function(){this.setValue(null),this.clearDisplayValue()},clearDisplayValue:function(){var e=this,t=e.getControl().find(".bz-rn-ecm-file-container");t.length;$.each(t,function(t,i){var r=$(i),a=r.data();a&&$.when(e.deleteUploadItem(r,a.idfileupload)).done(function(){r.remove()})}),e.filesCount=0}}),bizagi.rendering.searchList.extend("bizagi.rendering.searchList",{SEARCH_MIN_LENGTH:2,temporalElements:{}},{initializeList:function(){this._super();var e=this.getControl();this.modalViewTemplates=kendo.template(this.renderFactory.getTemplate("searchListModalViewAuxTemplates"),{useWithBlock:!1}),this.inputTemplates=kendo.template(this.renderFactory.getTemplate("searchListInputAuxTemplates"),{useWithBlock:!1}),this.input=$(".bz-rn-container-searchlist",e),this.configureListHandlers()},postRender:function(){var e=this;e.initializeList(),this._super(),e.input.on("click",".bz-rn-remove-tag-on-search-list",function(){e.removeItem($(this))})},postRenderReadOnly:function(){this.initializeList(),this._super(),this.properties.editable||this.configureReadOnly()},configureListHandlers:function(){this.properties.editable&&(this.properties.value.length>0?this.configureModalView(".bz-rn-last-child"):(this.configureModalView("ul"),this.configureModalView(".bz-rn-last-child")))},configureModalView:function(e){var t=this;(""===e?t.input:$(e,t.input)).unbind().bind("click",function(){var e=$("ul li.bz-rn-regular-element",t.input),i=[];t.Class.temporalElements={};for(var r=0,a=e.length;r<a;r++){var n=$(e[r]).data("id"),o=$("label",$(e[r])).text(),s={id:n,value:o};i.push(s),t.addTemporalElement(n,o,!1)}var l=t.renderFactory.getTemplate("searchListModalView"),d=kendo.template(l,{useWithBlock:!1}),c={items:i,displayName:t.properties.displayName||"",orientation:t.properties.orientation},u=$($.trim(d(c)));u.kendoMobileModalView({close:function(){t.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),t.configureModalViewHandlers(u),t.triggerGlobalHandler("modalViewDidAppear",{}),u.kendoMobileModalView("open"),u.closest(".k-animation-container").addClass("bz-rn-new-modalview-position")})},configureModalViewHandlers:function(e){var t=this,i=new $.Deferred;e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.find(".bz-wp-modalview-header-input-search").on("keypress keyup",function(){""!==this.value?e.find(".bz-wp-modalview-header-cancel-search").show(500):e.find(".bz-wp-modalview-header-cancel-search").hide(500),bizagi.loading.start({selector:".bz-rn-new-modalview-content-styles"}),$.when(t.showResults(this.value,e)).always(function(){bizagi.loading.stop({selector:".bz-rn-new-modalview-content-styles"})})}),e.find(".bz-wp-modalview-header-cancel-search").bind("click",function(){t.showNoResultsMessage(t.getResource("workportal-widget-inboxcommon-no-results-found"),e),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)}),e.delegate(".ui-bizagi-apply-button-searchlist","click",function(){i.resolve(),e.data("kendoMobileModalView").close()}),e.find(".bz-wp-modalview-close").bind("click",function(){i.reject(),e.data("kendoMobileModalView").close()}),e.find(".filter-searchlist-modal-view-tags").on("click",".bz-rn-remove-tag-on-search-list",function(){t.removeItem($(this),!0);var i=e.find(".bz-wp-modalview-header-input-search").val();bizagi.loading.start({selector:".bz-rn-new-modalview-content-styles"}),$.when(t.showResults(i,e)).always(function(){bizagi.loading.stop({selector:".bz-rn-new-modalview-content-styles"})})}),$.when(i).done(function(){t.addNewValuesToInput(),t.Class.temporalElements={}}).fail(function(){t.Class.temporalElements={}})},showResults:function(e,t){var i=this;return $.when(i.processRequest({term:e})).done(function(e){0===e.length?i.showNoResultsMessage(i.getResource("workportal-widget-inboxcommon-no-results-found"),t):($("#ui-bizagi-wp-filter-results-searchlist-wrapper ul li",t).remove(),$("li",$(bizagi.util.trim(i.modalViewTemplates({template:"sugestions",items:e})))).appendTo($("#ui-bizagi-wp-filter-results-searchlist-wrapper ul",t)),i.modalViewList=$(".ui-bizagi-render-list-elements",t),i.modalViewList.find("li").unbind().bind("click",function(){i.appendFoundItem(this,$(".filter-searchlist-modal-view-tags",t)),0===$(this).siblings().length&&i.showNoResultsMessage(i.getResource("workportal-widget-inboxcommon-no-results-found"),t),$(this).remove()}))}).fail(function(e){i.showNoResultsMessage(e,t)})},addNewValuesToInput:function(){var e=this,t=[];$.each(e.Class.temporalElements,function(e,i){t.push(i.obj)}),e.setValue(t),$("ul li",e.input).remove(),$("li",$(bizagi.util.trim(e.inputTemplates({template:"inputContainer",value:t})))).appendTo($("ul",e.input)),$("ul",e.input).unbind(),$(".bz-rn-last-child",e.input).unbind(),t.length>0?e.configureModalView(".bz-rn-last-child"):(e.configureModalView("ul"),e.configureModalView(".bz-rn-last-child"))},hasValue:function(){return JSON.parse(this.getValue()).value.length>0},setValue:function(e,t){t=void 0===t||t,this.value=JSON.encode({value:e}),this.changeRequiredLabel(!this.hasValue()),t&&!this.internalSetInitialValueFlag&&this.triggerRenderChange()},showNoResultsMessage:function(e,t){$("#ui-bizagi-wp-filter-results-searchlist-wrapper ul li",t).remove(),$("li",$(bizagi.util.trim(this.modalViewTemplates({template:"modalViewDefaultMessage",message:e})))).appendTo($("#ui-bizagi-wp-filter-results-searchlist-wrapper ul",t))},appendFoundItem:function(e,t){if(-1==$.map($("li",t),function(e){return $(e).data("id")}).indexOf($(e).data("id"))){var i=$(e).data("id"),r=$("label",e).text(),a=$("li",$(bizagi.util.trim(this.modalViewTemplates({template:"fullElement",id:i,value:r})))),n=$("li:last",t);n.hasClass("bz-rn-any-element")?(n.remove(),$("ul",t).prepend(a)):$("ul",t).prepend(a),this.addTemporalElement($(e).data("id"),$("label",e).text(),!1)}},removeItem:function(e,t){var i=e.parent(),r=e.closest(".bz-rn-container-searchlist");if(0===r.length&&(r=e.closest(".filter-searchlist-modal-view-tags")),t?delete this.Class.temporalElements[i.data("id")]:this.removeElement({id:i.data("id")}),i.remove(),r.find("li").length<=1&&!t)$(".bz-rn-click-to-add-span",r).removeClass("hidden"),this.configureModalView("ul"),this.configureModalView(".bz-rn-last-child");else if(0===r.find("li").length&&t){var a=$(bizagi.util.trim(this.modalViewTemplates({template:"modalViewDefaultValue"})));$("li",a).appendTo($("ul",r))}},processRequest:function(e){var t=this,i=t.properties,r=[],a=new $.Deferred;return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(i.term=e.term,this.getData().done(function(i){$.each(i,function(i,a){var n;switch(typeof a.value){case"number":n=a.value;break;case"object":n=a.value.toString();break;case"string":n=a.value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.term+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");break;default:n=a.value}void 0===t.Class.temporalElements[a.id]&&r.push({id:a.id,label:n,value:a.value})}),a.resolve(r)})):a.reject(t.getResource("workportal-widget-inboxcommon-no-results-found")),a},setDisplayValue:function(e){var t=this.properties,i="string"==typeof e?JSON.parse(e).value:e.value;this.setValue(i),void 0!==e&&t.editable&&this.input.val(e.label)},getDisplayValue:function(){return this.selectedValue},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.kendoTmpl(t,{id:e.id,xpath:e.xpath,value:e.value,editable:!1})},configureReadOnly:function(){var e=this.getControl();$(".bz-rn-last-child",e).unbind("click"),$(".bz-rn-searchlist-search-icon",e).unbind("click"),$(".bz-rn-click-to-add-span",e).remove(),$(".bz-rn-remove-tag-on-search-list",e).remove(),this.input.addClass("searchListNonEditable")},addTemporalElement:function(e,t,i){this.Class.temporalElements[e]&&delete this.Class.temporalElements[e],this.Class.temporalElements[e]={obj:{id:e,value:t},remove:i}}}),bizagi.rendering.basicUserField.extend("bizagi.rendering.basicUserField",{},{init:function(e){(this._super(e),this.isSupported())||this.getFormContainer().addError(this.getResource("render-tablet-error-userfield"))},getEditableControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this,arguments)},getReadonlyControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this,arguments)},isSupported:function(){return!0}}),bizagi.rendering.basicUserField.extend("bizagi.rendering.defaultUserField",{},{getEditableControl:function(){var e=this.getControl(),t=this.properties.control.replace(/column/g,"");return this.input=$("<label>Userfield: "+t+" not found</label>").appendTo(e),this.input.addClass("ui-bizagi-render-userfield-notSupported"),this.input},getReadonlyControl:function(){return this.getEditableControl()},collectData:function(e){}}),bizagi.rendering.image.extend("bizagi.rendering.image",{QUALITY_PICTURE:50,EXTENSIONSIMG:["jpeg","jpg","png"]},{$addImage:null,$deleteImage:null,$inputFile:null,isNative:!1,isOfflineForm:!1,resolutionUpload:[],renderControl:function(){if(this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported(),this.isOfflineForm){var e=Number(this.properties.maxSize)||1048576,t="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=e<t?e:t}var i=this.renderFactory.getTemplate("image"),r=!this.isOfflineForm&&(this.properties.allowDelete&&this.properties.editable);return $.kendoTmpl(i,{url:"",allowDelete:r,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this.showAsyncImage()},postRenderReadOnly:function(){this.element.addClass("bz-rn-read-only bz-rn-non-editable"),this.showAsyncImage()},configureHandlers:function(){var e=this,t=bizagi.util.getAndroidVersion();this.resolutionUpload=[],this.$addImage=$(".bz-rn-image-actions-add",this.getControl()),this.$deleteImage=$(".bz-rn-image-actions-delete",this.getControl()),this.$inputFile=$(".bz-rn-upload-image-web",this.getControl()),this._super(),this.isNative?this.$addImage.off("click").click(function(){var t=e.createModal();t.find("ul.bz-rn-image-options").find('li[data-role="dimage"]').remove(),t.find("ul.bz-rn-image-options li").bind("click",function(){switch(t.kendoMobileModalView("close"),$(this).data("role")){case"image":e.imageAdd();break;case"cimage":e.imageAdd(!0)}}),t.find(".bz-wp-modalview-close").unbind("click").bind("click",function(){t.kendoMobileModalView("close")}),e.triggerGlobalHandler("modalViewDidAppear",{}),t.kendoMobileModalView("open"),t.adjustSize(),t.closest(".km-modalview-root").unbind("click").bind("click",function(){t.kendoMobileModalView("close")})}):bizagi.util.media.fileAPISupported()&&!e.isOfflineForm?this.$addImage.off("click").click(function(){e.$inputFile.click()}):(this.element.addClass("bz-rn-read-only bz-rn-non-editable"),this.$addImage.removeClass("bz-plus").addClass("bz-rn-read-only")),this.$deleteImage.off("click").click(function(){e.imageDelete()}),this.$inputFile.off("change").on("change",function(){e.imageAdd(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}),this.getControl().find("img").off("click").click(function(){e.renderEdition()}),resolutionUpload=t&&t<=4.4?[{guid:4,displayName:bizagi.localization.getResource("workportal-size-original")}]:bizagi.util.media.getImageResolutionItems(),$(".bz-resolution-container",e.getControl()).off("click").actionSheet({actions:resolutionUpload,actionClicked:function(t){bizagi.loading.start(),$.when(e.resolutionButtonHandler(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},clearDisplayValue:function(){this.$deleteImage.click()},renderEdition:function(){var e=this,t=e.properties,i=e.getParams(),r=i.navigation.createRenderContainer({title:t.displayName,view:{zoom:!0,useNativeScrolling:!1}}),a=$.kendoTmpls(e.renderFactory.getTemplate("image-preview"),{url:e.value&&""!==e.value[0]?e.value[0]:""});r.element.css("display","none"),e.inputEdition=r.element.html(a),i.navigation.navigate(r.id),e.isOfflineForm&&r.element.on("close",e.onPreviewActionBack.bind(e)),bizagi.loading.start(),$.when(e.buildFullItemUrl()).done(function(t){if(r.element.css("display","block"),t.indexOf("error")<0){$(".bz-rn-image-render-preview",r.element).attr("src",t);var i=$(".bz-rn-image-render-preview",r.element)[0],a=$(i).css("width");a=Number(a.substring(0,a.length-2)),-1!==e.properties.width&&e.properties.width<a&&$(".bz-rn-image-render-preview",r.element).css("width","100%")}}).always(function(){bizagi.loading.stop()})},onPreviewActionBack:function(e){self=this;var t=$(".bz-rn-image-render-preview",e.target).attr("src")||"";dataUrltoSave=t.length>0?[].concat(t):null,self.setValue(dataUrltoSave)},createModal:function(){var e=this,t=e.renderFactory.getTemplate("imageModalView"),i=kendo.template(t,{useWithBlock:!1}),r=$($.trim(i({editable:e.properties.editable,displayName:e.properties.displayName||"",orientation:e.properties.orientation||""})));return r.kendoMobileModalView({close:function(t){t.preventDefault(),window.event&&window.event.stopPropagation&&window.event.stopPropagation(),e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},show:function(){},modal:!1}),r.adjustSize=function(){var e=0,t=$(this).parent(),i=window.innerHeight,r=window.innerWidth,a=$(".bz-wp-modalview-results-wrapper",t).height(),n=$(".bz-wp-modalview-results-wrapper",t).width(),o=$("[data-role=header]",t).height(),s=(i-(e=a+o>=i?i-20:a+o+10))/2,l=(r-n)/2;t.css("height",e),t.parent().css("top",s),t.parent().css("left",l),t.parent().css("height",e)},r},imageAdd:function(e){var t=this;if(this.isNative){var i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var r=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(r.left,r.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI}}navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var r=bizagi.util.getAndroidVersion();if(r&&r<=4.2||t.isOfflineForm)return $.when(t.uploadFile(t.dataImage)).done(function(e){t.uploadFileCompleted(t)}).fail(function(e){t.executeFormFailHandler(e)});if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)});$(".bz-resolution-container",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail,i)}else{var a=this.$inputFile[0].files[0];a.fullPath=this.$inputFile[0].value;var n=this.Class.EXTENSIONSIMG;bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(a,t.properties)&&bizagi.util.media.checkFileTypes(a,t.properties,n)?$.when(t.uploadFile(a)).done(function(e){t.uploadFileCompleted(t)}).fail(function(e){t.executeFormFailHandler(e)}).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()}},onFail:function(e){bizagi.loading.stop()},imageDelete:function(){var e=this;bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-actionsheet-upload-remove-photo")).done(function(){bizagi.loading.start(),$.when(e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype})).done(function(){e.uploadFileCompleted(e)}).fail(function(e){var t,i=e.responseText;try{t=(t=JSON.parse(i)).message||i}catch(e){t=i}bizagi.showMessageBox(t,"Error")}).always(function(){bizagi.loading.stop()})})},uploadFile:function(e){var t=this,i=new $.Deferred;if(this.isOfflineForm)t.saveImageOffline(e,function(e){var r=e.replace(/^data:.*;base64,/,"");t.setValue(r),i.resolve()}),t.canBeSent=function(){return $.forceCollectData=!0,!0};else if(this.isNative){var r={},a=t.buildAddParams(),n=t.fileProperties.name;t.editedImageURL?r.dataFile=t.editedImageURL:t.fileProperties&&(r.dataFile=t.fileProperties.url),a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=t.properties.addUrl,t.editedImageURL=null,t.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),$.when(bizagi.util.media.uploadFile(r)).done(function(e){var t=JSON.parse(decodeURIComponent(e.response));"error"===t.type?i.reject(t):i.resolve(t)}).fail(function(e){i.reject(e)}).always(function(){})}else bizagi.util.media.checkMaxSizeFile(e,t.properties)&&bizagi.util.media.checkFileTypes(e,t.properties,t.Class.EXTENSIONSIMG)?t.dataService.processUploadFile({url:t.properties.addUrl,formData:t.buildAddFileParams(e)}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}):i.reject();return i.promise()},uploadFileCompleted:function(e){var t=e;try{t.showAsyncImage(),t.editedImageURL=null}catch(e){t.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl();$.when(e.buildItemUrl()).done(function(i){e.isDisposed()||(e.properties.url=""!==i?i:"",e.properties.value=e.properties.url.length>0?[].concat(e.properties.url):null,e.setValue(e.properties.value),e.isOfflineForm&&-1!==i.indexOf("Invalid case id")&&(e.properties.url=""),t.find(".bz-rn-image-container").off("click").toggleClass("bz-rn-image-actions-add",e.properties.editable&&""===e.properties.url),""!==e.properties.url?(t.find(".bz-rn-image-container img").css("display","inherit").attr("src",e.properties.url),t.find(".bz-rn-image-container img").off("click").click(function(){e.renderEdition()}),t.find(".bz-rn-image-actions-add").toggle(e.properties.editable),t.find(".bz-rn-image-actions-delete").toggle(e.properties.allowDelete&&e.properties.editable)):(t.find(".bz-rn-image-container img").css("display","none"),t.find(".bz-rn-image-actions-add.bz-upload").hide(),t.find(".bz-rn-image-actions-delete").hide()),e.properties.required&&e.getControl().children(".ui-bizagi-render-control-required, .ui-bizagi-render-control-required-rtl").addClass("image-required"),e.configureHandlers())}).fail(function(){})},saveImageOffline:function(e,t){var i=bizagi.util.media.getImagePath(e),r=new XMLHttpRequest;try{r.onload=function(){var e=new FileReader;e.onloadend=function(){var i=e.result;t(i)},e.readAsDataURL(r.response)},r.open("GET",i),r.responseType="blob",r.send()}catch(e){t("")}},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return $.when(t.uploadFile(t.dataImage)).done(function(e){t.uploadFileCompleted(t)}).fail(function(e){t.executeFormFailHandler(e)});var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,$.when(t.uploadFile(t.dataImage)).done(function(e){t.uploadFileCompleted(t)}).fail(function(e){t.executeFormFailHandler(e)})})},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},buildAddFileParams:function(e){var t=this,i=t.properties,r=new FormData,a=t.getFormContainer();r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",i.xpath),r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",i.id),r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",i.xpathContext),r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE,i.idPageCache),r.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action","savefile"),r.append(i.xpath,e),t.properties.contexttype&&r.append(t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",i.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}return r}}),bizagi.rendering.document.extend("bizagi.rendering.document",{},{postRender:function(){this.configureHelpText(),this.applyDocumentTemplatesFormat(),this.configureHandlers()},applyDocumentTemplatesFormat:function(){var e=this,t=e.getControl();t.addClass("ui-bizagi-render-display-block");var i=$(".ui-bizagi-document-upload-item",t);$.each(i,function(t,i){$(".ui-bizagi-document-type",i).addClass("ui-bizagi-document-extension");var r=$(".ui-bizagi-document-preview",i);r.attr("title",e.resources.getResource("render-document-preview-tooltip")),r.tooltip();var a=e.returnCssTypeFile($("a > span",i).html());$(".ui-bizagi-document-type",i).addClass(a),$(".ui-bizagi-button",i).remove(),$(".ui-bizagi-document-preview",i).attr("display","none")}),$(".ui-bizagi-document-upload-item > .ui-bizagi-document-upload-element",t).click(function(t){e.showDocumentPreview($(this).data("url"),$(this).attr("title"))}),$(".bz-rn-document-delete-icon",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).parent().data("filename")))})},returnCssTypeFile:function(e){if(null==e||0===e.lenght)return"ui-bizagi-document-upload-item-generic-file bz-file-text";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc bz-file-word";case"pdf":return"ui-bizagi-document-upload-item-pdf bz-file-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls bz-file-excel";default:return"ui-bizagi-document-upload-item-generic-file bz-file-text"}},redrawDocuments:function(e,t,i){this._super(e,t,i),this.applyDocumentTemplatesFormat()},autoOpenDocuments:function(){},updateControlForPrintMode:function(){},showDocumentPreview:function(e,t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,t)).fail(function(e){e.responseText&&self.getFormContainer().failHandler(e.responseText)}).always(function(){bizagi.loading.stop()})}}),bizagi.rendering.rangeDate.extend("bizagi.rendering.rangeDate",{},{setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.rangeMoney.extend("bizagi.rendering.rangeMoney",{},{postRender:function(){var e=new bizagi.rendering.money(this.getRenderProperties("min")),t=new bizagi.rendering.money(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.rangeNumber.extend("bizagi.rendering.rangeNumber",{},{postRender:function(){var e=new bizagi.rendering.number(this.getRenderProperties("min")),t=new bizagi.rendering.number(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.geolocation.extend("bizagi.rendering.geolocation",{},{postRender:function(){this._super();var e=this.getControl();this.cordinate=$(".bz-rn-geolocation-coordinate",e)},isValid:function(e){return this._super(e)},configureHandlers:function(){var e=this;"execution"===e.getMode()&&(null==e.value&&e.updateDisplayValue(),$(".bz-rn-geolocation-selector",e.getControl()).on("click",function(){e.cordinate.empty(),e.updateDisplayValue()}))},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.cordinate||(t.cordinate=t.getControl()),t.cordinate.html(e),t.setValue(e,!1),i.resolve();else{var r=function(e){var r=e.coords.latitude.toString()+" "+e.coords.longitude.toString();t.cordinate.html(r),t.setValue(r,!1),i.resolve()},a=function(e){var r=e;bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()&&(r=t.getErrorMessage(e)),i.reject(r)};bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()?navigator.geolocation.getCurrentPosition(r,a):t.getCurrentPosition(r,a)}return i.promise()},updateDisplayValue:function(){var e=this;e.setDisplayValue().then(function(){}).fail(function(t){e.cordinate.val(""),e.cordinate.html("<span style='color: red'>"+t+"</span>")})}}),bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.combo",{},{setValue:function(e,t){var i=this,r=i.getDecorated(e),a=bizagi.util.isOfflineForm({context:i});if(null!==r){if("summary"==e)return i._super(e,t);if(!a||"number"!=typeof t&&"string"!=typeof t)if(t&&t.length>0){n={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};i._super(e,n),r.selectedValue=n.value}else t&&t.id&&t.value?(i._super(e,t),r.selectedValue=t.value):"columnRadio"==i.properties.type?(i._super(e,null),r.selectedValue=t):t&&"number"==typeof t?i._super(e,t):a&&null!==t&&"object"==typeof t&&t.value?(i._super(e,t.value),r.selectedValue=t.value):(i._super(e,null),r.selectedValue="");else{var n="object"==typeof i.properties.data?i.properties.data.find(function(e){return e.id==t}):t;i._super(e,n),r.selectedValue=t}}}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),e.getControlHtml=this.getControlHtml,"design"!=t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.properties.xpathContext=this.getContextXpath())},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath);var i=e.parent;$.when(i.submitOnChange("",!1)).done(function(){$.when(e.dataService.generateDocumentTemplate(t)).done(function(t){$.when(i.refresh()).done(function(){e.autoOpenDocuments()}),e.endLoading()}).fail(function(t){e.endLoading(),e.showErrorMessage(t)})}).fail(function(t){e.endLoading(),e.showErrorMessage(t)})},getControlHtml:function(e,t,i,r,a,n){for(var o=!0,s=0,l=this.parent.properties.data.rows.length;s<l;s++)if(this.parent.properties.data.rows[s][0]==this.surrogateKey){o=!1;break}return $.kendoTmpl(e,{noActivateButton:o,editable:"execution"!=t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:!!a.append&&a.append,caption:a.caption,noFiles:n}).replace("ui-bizagi-document-upload-item-design","ui-bizagi-document-upload-item-design-column")},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){this.properties.value=this.value}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.date",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.text",{},{}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.number",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.image",{},{applyOverrides:function(e){var t=this.properties;this._super(e),e.getXpathContext=this.getImageXpathContext,e.setDisplayValue=function(){return!0},"execution"===this.getMode()&&(e.properties.xpathContext=(t.xpathContext?t.xpathContext+".":"")+this.grid.properties.xpath+"[id="+e.surrogateKey+"]")},getImageXpathContext:function(){return(this.column.properties.xpathContext?this.column.properties.xpathContext+".":"")+this.column.grid.properties.xpath+"[id="+this.surrogateKey+"]"}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.upload",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath;e.applyUploadPlugin;e.getXpathContext=function(){this.surrogateKey;var e=this.properties;return e.xpathContext.length>0?e.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:t.xpath,xpathContext:r,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})}},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.link",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&"layout"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.properties.xpathContext=this.grid.properties.xpath+"[id="+this.surrogateKey+"]",this.grid.properties.xpathContext&&-1==e.properties.xpathContext.indexOf(this.grid.properties.xpathContext)&&(e.properties.xpathContext=this.grid.properties.xpathContext+"."+e.properties.xpathContext)),"columnFormLink"==e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath)},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getUploadXpath=this.getUploadXpath,e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getUploadXpath(this.surrigateKey),a=(r=r.split("."))[r.length-1],n=this.getXpathContext(this.surrigateKey);return this.dataService.getUploadFileUrl({idRender:t.id,xpath:a,xpathContext:n,idPageCache:t.idPageCache,fileId:e.idFileUpload,sessionId:i.properties.sessionId,contexttype:t.contexttype})},e.getXpathContext=function(){var e=this.properties;return e.xpathContext.length>0?e.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]"}},renderReadOnly:function(e,t){var i="<div></div>",r=this.getDecorated(e);if(r.setValue(t),this.setValue(e,t),this.setSurrogateKey(e),this.applyOverrides(r),r.grid=this.grid,r.column=this,r.surrogateKey=e,this.readyDeferred=new $.Deferred,r.files.length>0){this.properties.editable;r.properties.editable=!1,i=r.render("cell.upload")}return i},getUploadXpath:function(e){return e=this.surrogateKey||e||"",this.grid.properties.xpath+"[id="+e+"]."+this.properties.xpath},getControl:function(){var e=this._super();return e&&0!=e.length?$(".ui-bizagi-render-control",this.element||this.observableElement):$(".ui-bizagi-cell-readonly",this.element||this.observableElement)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.button",{},{}),bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.radio",{},{}),bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.list",{},{}),bizagi.rendering.columns.search.extend("bizagi.rendering.columns.search",{},{applyOverrides:function(e){this._super(e)},renderReadOnly:function(e,t){return t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.exclusiveCheck",{},{}),$.Class.extend("bizagi.rendering.base.factory",{},{init:function(e){this.templates={},this.dataService=e},loadOverrides:function(){},initAsyncStuff:function(){return $.when.apply($,[this.loadOverrides(),this.loadTemplates()])},loadTemplates:function(){},loadTemplate:function(e,t){var i=this;return bizagi.templateService.getTemplate(t,e).done(function(t){i.templates[e]=t})},getCommonTemplate:function(e){return this.templates[e]},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.form(r):"mobileform"==t?new bizagi.rendering.mobileform(r):"template"==t?new bizagi.rendering.formTemplate(r):"queryForm"==t?new bizagi.rendering.queryForm(r):"layout"==t?new bizagi.rendering.layout(r):"usersForm"==t?new bizagi.rendering.usersForm(r):"panel"==t?new bizagi.rendering.panel(r):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.contentPanel(r):"nestedform"==t.toLowerCase()?new bizagi.rendering.nestedForm(r):"tab"==t?new bizagi.rendering.tab(r):"tabItem"==t||"tabitem"==t?new bizagi.rendering.tabItem(r):"horizontal"==t?new bizagi.rendering.horizontal(r):"accordion"==t?new bizagi.rendering.accordion(r):"accordionItem"==t?new bizagi.rendering.accordionItem(r):"group"==t?new bizagi.rendering.group(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.searchForm(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),"text"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"association"==t?new bizagi.rendering.association(r):"label"==t?new bizagi.rendering.label(r):"hidden"==t?new bizagi.rendering.hidden(r):"number"==t?new bizagi.rendering.number(r):"money"==t?new bizagi.rendering.money(r):"date"==t?new bizagi.rendering.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"combo"==t?new bizagi.rendering.combo(r):"cascadingCombo"==t?new bizagi.rendering.cascadingCombo(r):"list"==t?new bizagi.rendering.list(r):"multiSelect"==t?new bizagi.rendering.multiSelect(r):"radio"==t?new bizagi.rendering.radio(r):"image"==t?new bizagi.rendering.image(r):"uploadecm"==t?new bizagi.rendering.ecm(r):"upload"==t?new bizagi.rendering.upload(r):"grid"==t?new bizagi.rendering.grid(r):"groupedgrid"==t?new bizagi.rendering.grid(r):"search"==t?new bizagi.rendering.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.search(r)):"searchList"==t?new bizagi.rendering.searchList(r):"letter"==t?new bizagi.rendering.letter(r):"button"==t?new bizagi.rendering.button(r):"formLink"==t?new bizagi.rendering.formLink(r):"link"==t?new bizagi.rendering.link(r):"layoutImage"==t?new bizagi.rendering.layoutImage(r):"layoutLink"==t?new bizagi.rendering.layoutLink(r):"layoutLabel"==t?new bizagi.rendering.layoutLabel(r):"layoutText"==t?new bizagi.rendering.layoutText(r):"layoutDateTime"==t?new bizagi.rendering.layoutDateTime(r):"layoutNumber"==t?new bizagi.rendering.layoutNumber(r):"layoutMoney"==t?new bizagi.rendering.layoutMoney(r):"layoutPlaceholder"==t?new bizagi.rendering.layoutPlaceholder(r):"actionLauncher"==t?new bizagi.rendering.actionLauncher(r):"layoutBoolean"==t?new bizagi.rendering.layoutBoolean(r):"layoutUpload"==t?new bizagi.rendering.layoutUpload(r):"entityTemplate"==t?new bizagi.rendering.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):0==t.indexOf("query")?this.getQueryRender(e):"document"==t?new bizagi.rendering.document(r):"image"==t?new bizagi.rendering.image(r):"fileprint"==t?new bizagi.rendering.fileprint(r):"geolocation"==t?new bizagi.rendering.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.collectionnavigator(r):"getUser"==t?new bizagi.rendering.getUser(r):"rangeDate"==t?new bizagi.rendering.rangeDate(r):"rangeMoney"==t?new bizagi.rendering.rangeMoney(r):"rangeNumber"==t?new bizagi.rendering.rangeNumber(r):"activityCheckList"==t?new bizagi.rendering.activityCheckList(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==t){var a=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return r.decorated=a?bizagi.rendering.extendedText:bizagi.rendering.text,new bizagi.rendering.columns.text(r)}if("columnSearchList"==t)return r.decorated=bizagi.rendering.searchList,new bizagi.rendering.columns.searchList(r);if("columnNumber"==t)return r.decorated=bizagi.rendering.number,new bizagi.rendering.columns.number(r);if("columnMoney"==t)return r.decorated=bizagi.rendering.money,new bizagi.rendering.columns.number(r);if("columnDate"==t)return r.decorated=bizagi.rendering.date,new bizagi.rendering.columns.date(r);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(r.decorated=bizagi.rendering.check,e.data.properties.isExclusive)return new bizagi.rendering.columns.exclusiveCheck(r)}else r.decorated=bizagi.rendering.yesno;return new bizagi.rendering.columns.column(r)}return"columnCombo"==t?(r.decorated=bizagi.rendering.combo,new bizagi.rendering.columns.combo(r)):"columnRadio"==t?(r.decorated=bizagi.rendering.radio,new bizagi.rendering.columns.radio(r)):"columnList"==t?(r.decorated=bizagi.rendering.list,new bizagi.rendering.columns.list(r)):"columnHidden"==t?(r.decorated=bizagi.rendering.hidden,new bizagi.rendering.columns.column(r)):"columnUpload"==t?(r.decorated=bizagi.rendering.upload,new bizagi.rendering.columns.upload(r)):"columnImage"==t?(r.decorated=bizagi.rendering.image,new bizagi.rendering.columns.image(r)):"columnUploadEcm"==t?(r.decorated=bizagi.rendering.ecm,new bizagi.rendering.columns.uploadecm(r)):"columnLink"==t?(r.decorated=bizagi.rendering.link,new bizagi.rendering.columns.link(r)):"columnFormLink"==t?(r.decorated=bizagi.rendering.formLink,new bizagi.rendering.columns.link(r)):"columnUserfield"==t?(r.decorated=bizagi.rendering.userfieldWrapper,new bizagi.rendering.columns.column(r)):"columnSearch"==t?(r.decorated=bizagi.rendering.search,new bizagi.rendering.columns.search(r)):"columnLabel"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.column(r)):"columnReadonly"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.readonly(r)):"columnDocument"==t?(r.decorated=bizagi.rendering.document,new bizagi.rendering.columns.document(r)):"columnLetter"==t?(r.decorated=bizagi.rendering.letter,new bizagi.rendering.columns.letter(r)):"columnButton"==t?(r.decorated=bizagi.rendering.button,new bizagi.rendering.columns.button(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.numberScientificNotation(r):new bizagi.rendering.number(r):"searchMoney"==t?new bizagi.rendering.money(r):"searchDate"==t?new bizagi.rendering.date(r):"searchCombo"==t?new bizagi.rendering.combo(r):"searchSuggest"==t?new bizagi.rendering.search(r):"searchLabel"==t?new bizagi.rendering.label(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.queryExtendedText(r):new bizagi.rendering.queryText(r):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.queryCheck(r):new bizagi.rendering.queryYesNo(r):"queryNumber"==t?new bizagi.rendering.queryNumber(r):"queryMoney"==t?new bizagi.rendering.queryMoney(r):"queryDate"==t?new bizagi.rendering.queryDate(r):"queryCombo"==t?new bizagi.rendering.queryCombo(r):"queryCascadingCombo"==t?new bizagi.rendering.queryCascadingCombo(r):"querySuggest"==t?new bizagi.rendering.querySuggest(r):"queryLabel"==t?new bizagi.rendering.queryLabel(r):"queryList"==t?new bizagi.rendering.queryList(r):"queryMultiSelect"==t?new bizagi.rendering.queryMultiSelect(r):"querySearch"==t?new bizagi.rendering.querySearch(r):"queryRadio"==t?new bizagi.rendering.queryRadio(r):"queryState"==t?new bizagi.rendering.queryState(r):"queryCaseState"==t?new bizagi.rendering.queryCaseState(r):"queryProcess"==t?new bizagi.rendering.queryProcess(r):"querySearchUser"==t?new bizagi.rendering.querySearchUser(r):"queryHidden"==t?new bizagi.rendering.hidden(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getTemplate:function(e){return this.templates[e]}}),bizagi.rendering.base.factory.extend("bizagi.rendering.tablet.factory",{},{loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("form-error",bizagi.getTemplate("bizagi.renderingflat.tablet.form-error")),e.loadTemplate("form-waiting",bizagi.getTemplate("bizagi.renderingflat.tablet.form-waiting")),e.loadTemplate("icons",bizagi.getTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form",bizagi.getTemplate("bizagi.renderingflat.tablet.form")+"#ui-bizagi-render-form"),e.loadTemplate("complexgateway",bizagi.getTemplate("bizagi.renderingflat.tablet.form")+"#ui-bizagi-render-complexGateway"),e.loadTemplate("panel",bizagi.getTemplate("bizagi.renderingflat.tablet.panel")),e.loadTemplate("tab",bizagi.getTemplate("bizagi.renderingflat.tablet.tab")),e.loadTemplate("tabItem",bizagi.getTemplate("bizagi.renderingflat.tablet.tabItem")),e.loadTemplate("horizontal",bizagi.getTemplate("bizagi.renderingflat.tablet.horizontal")),e.loadTemplate("accordion",bizagi.getTemplate("bizagi.renderingflat.tablet.accordion")),e.loadTemplate("accordionItem",bizagi.getTemplate("bizagi.renderingflat.tablet.accordionItem")),e.loadTemplate("group",bizagi.getTemplate("bizagi.renderingflat.tablet.group")),e.loadTemplate("searchForm",bizagi.getTemplate("bizagi.renderingflat.tablet.searchForm")),e.loadTemplate("contentPanel",bizagi.getTemplate("bizagi.renderingflat.tablet.contentPanel")),e.loadTemplate("render",bizagi.getTemplate("bizagi.renderingflat.tablet.render")),e.loadTemplate("render-layout",bizagi.getTemplate("bizagi.renderingflat.tablet.render.layout")),e.loadTemplate("text",bizagi.getTemplate("bizagi.renderingflat.tablet.text")),e.loadTemplate("extendedText",bizagi.getTemplate("bizagi.renderingflat.tablet.extendedText")+"#ui-bz-mobile-extended-text-control"),e.loadTemplate("readonlyExtendedText",bizagi.getTemplate("bizagi.renderingflat.tablet.extendedText")+"#ui-bz-mobile-readonly-extended-text-control"),e.loadTemplate("number",bizagi.getTemplate("bizagi.renderingflat.tablet.number")+"#ui-bz-mobile-number-control"),e.loadTemplate("readonlyNumber",bizagi.getTemplate("bizagi.renderingflat.tablet.number")+"#ui-bz-mobile-readonly-number-control"),e.loadTemplate("numberScientificNotation",bizagi.getTemplate("bizagi.renderingflat.tablet.numberScientificNotation")),e.loadTemplate("date",bizagi.getTemplate("bizagi.renderingflat.tablet.date")+"#bz-rn-date"),e.loadTemplate("readonlyDate",bizagi.getTemplate("bizagi.renderingflat.tablet.date")+"#bz-rn-readonly-date"),e.loadTemplate("yesno",bizagi.getTemplate("bizagi.renderingflat.tablet.yesno")),e.loadTemplate("check",bizagi.getTemplate("bizagi.renderingflat.tablet.check")),e.loadTemplate("combo",bizagi.getTemplate("bizagi.renderingflat.tablet.combo")+"#ui-bz-mobile-combo-control"),e.loadTemplate("readonlyCombo",bizagi.getTemplate("bizagi.renderingflat.tablet.combo")+"#ui-bz-mobile-readonly-combo-control"),e.loadTemplate("comboModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.combo")+"#ui-bz-wp-popup-combo-control"),e.loadTemplate("list",bizagi.getTemplate("bizagi.renderingflat.tablet.list")+"#ui-bz-mobile-list-control"),e.loadTemplate("listModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.list")+"#ui-bz-wp-popup-list-control"),e.loadTemplate("radio",bizagi.getTemplate("bizagi.renderingflat.tablet.radio")),e.loadTemplate("image",bizagi.getTemplate("bizagi.renderingflat.tablet.image")+"#ui-bizagi-render-image"),e.loadTemplate("image-item",bizagi.getTemplate("bizagi.renderingflat.tablet.image")+"#ui-bizagi-render-image-item"),e.loadTemplate("image-preview",bizagi.getTemplate("bizagi.renderingflat.tablet.image")+"#bz-rd-upload-render-edition"),e.loadTemplate("imageModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.image")+"#ui-bizagi-render-image-modalview"),e.loadTemplate("upload",bizagi.getTemplate("bizagi.renderingflat.tablet.upload")+"#ui-bz-mobile-upload-control"),e.loadTemplate("uploadModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.upload")+"#ui-bz-wp-popup-upload-control"),e.loadTemplate("uploadItem",bizagi.getTemplate("bizagi.renderingflat.tablet.uploadItem")),e.loadTemplate("uploadSlide",bizagi.getTemplate("bizagi.renderingflat.tablet.slide.upload")),e.loadTemplate("grid",bizagi.getTemplate("bizagi.renderingflat.tablet.grid")),e.loadTemplate("cell",bizagi.getTemplate("bizagi.renderingflat.tablet.cell")),e.loadTemplate("cell.readonly",bizagi.getTemplate("bizagi.renderingflat.tablet.cell.readonly")),e.loadTemplate("cell.upload",bizagi.getTemplate("bizagi.renderingflat.tablet.cell.upload")),e.loadTemplate("search",bizagi.getTemplate("bizagi.renderingflat.tablet.search")+"#ui-bz-mobile-search-control"),e.loadTemplate("readonlySearch",bizagi.getTemplate("bizagi.renderingflat.tablet.search")+"#ui-bz-mobile-readonly-search-control"),e.loadTemplate("searchAddItem",bizagi.getTemplate("bizagi.renderingflat.tablet.searchAddItem")),e.loadTemplate("searchItem",bizagi.getTemplate("bizagi.renderingflat.tablet.searchItem")),e.loadTemplate("searchList",bizagi.getTemplate("bizagi.renderingflat.tablet.searchList")+"#ui-bz-mobile-searchlist-control"),e.loadTemplate("searchListModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.searchList")+"#ui-bz-wp-popup-searchlist-control"),e.loadTemplate("searchListModalViewAuxTemplates",bizagi.getTemplate("bizagi.renderingflat.tablet.searchList")+"#ui-bz-wp-searchlist-control-modalview-auxiliary-templates"),e.loadTemplate("searchListInputAuxTemplates",bizagi.getTemplate("bizagi.renderingflat.tablet.searchList")+"#ui-bz-wp-searchlist-control-input-auxiliary-templates"),e.loadTemplate("letter",bizagi.getTemplate("bizagi.renderingflat.tablet.letter")),e.loadTemplate("letter.readonly",bizagi.getTemplate("bizagi.renderingflat.tablet.letter.readonly")),e.loadTemplate("letter.dialog",bizagi.getTemplate("bizagi.renderingflat.tablet.dialog-letter")),e.loadTemplate("button",bizagi.getTemplate("bizagi.renderingflat.tablet.button")),e.loadTemplate("link",bizagi.getTemplate("bizagi.renderingflat.tablet.link")),e.loadTemplate("geolocation",bizagi.getTemplate("bizagi.renderingflat.tablet.geolocation")),e.loadTemplate("association",bizagi.getTemplate("bizagi.renderingflat.tablet.association")),e.loadTemplate("ecm",bizagi.getTemplate("bizagi.renderingflat.tablet.ecm")+"#bz-rn-ecm-view-default-item"),e.loadTemplate("ecm-metadata",bizagi.getTemplate("bizagi.renderingflat.tablet.ecm")+"#bz-rn-ecm-metadata"),e.loadTemplate("ecmModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.ecm")+"#ui-bizagi-render-ecm-modalview"),e.loadTemplate("checkList",bizagi.getTemplate("bizagi.renderingflat.tablet.checkList")),e.loadTemplate("document",bizagi.getTemplate("bizagi.renderingflat.tablet.document")+"#bz-document-generator"),e.loadTemplate("document-item",bizagi.getTemplate("bizagi.renderingflat.tablet.document")+"#bz-document-generator-item"),e.loadTemplate("render-actionLauncher",bizagi.getTemplate("bizagi.renderingflat.tablet.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",bizagi.getTemplate("bizagi.renderingflat.tablet.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-vertical",bizagi.getTemplate("bizagi.renderingflat.tablet.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",bizagi.getTemplate("bizagi.renderingflat.tablet.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher",bizagi.getTemplate("bizagi.renderingflat.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",bizagi.getTemplate("bizagi.renderingflat.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",bizagi.getTemplate("bizagi.renderingflat.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",bizagi.getTemplate("bizagi.renderingflat.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-confirm",bizagi.getTemplate("bizagi.renderingflat.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),e.loadTemplate("readonly",bizagi.getTemplate("bizagi.renderingflat.tablet.readonly")),e.loadTemplate("list-multiselect",bizagi.getTemplate("bizagi.renderingflat.tablet.multiSelect")+"#ui-bz-mobile-multiselect-control"),e.loadTemplate("list-multiselect-tag",bizagi.getTemplate("bizagi.renderingflat.tablet.multiSelect")+"#ui-bz-mobile-multiselect-tag"),e.loadTemplate("list-multiselect-tags",bizagi.getTemplate("bizagi.renderingflat.tablet.multiSelect")+"#bz-list-multiselect-tags"),e.loadTemplate("list-multiselect-view-more",bizagi.getTemplate("bizagi.renderingflat.tablet.multiSelect")+"#ui-bz-mobile-multiselect-view-more"),e.loadTemplate("multiselectModalView",bizagi.getTemplate("bizagi.renderingflat.tablet.multiSelect")+"#ui-bz-wp-popup-multiselect-control"),e.loadTemplate("render-slide-view",bizagi.getTemplate("bizagi.renderingflat.tablet.slide.view")),e.loadTemplate("render-slide-view-item",bizagi.getTemplate("bizagi.renderingflat.tablet.slide.view.item")),e.loadTemplate("layout-image",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.label")),e.loadTemplate("layout-link",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.link")),e.loadTemplate("layout-text",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.text")),e.loadTemplate("layout-date-time",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.dateTime")),e.loadTemplate("layout-money",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.money")),e.loadTemplate("layout-number",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.number")),e.loadTemplate("layout-upload",bizagi.getTemplate("bizagi.renderingflat.tablet.layout.upload")),e.loadTemplate("bizagi.grid.grid",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.waiting",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.cell",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pager",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-buttons"),e.loadTemplate("bizagi.grid.dynamicpager",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-dynamic-pager"),e.loadTemplate("bizagi.grid.totalizer",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-totalizer"),e.loadTemplate("bizagi.grid.buttons.offline",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-buttons-offline"),e.loadTemplate("bizagi.grid.row.buttons.offline",bizagi.getTemplate("bizagi.renderingflat.tablet.grid.component")+"#ui-bizagi-grid-row-buttons-offline")).done(function(){var i=e.getTemplate("icons");0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()}),t.promise()},loadOverrides:function(){if(bizagi.enableCustomizations)return bizagi.util.loadFile({src:bizagi.getJavaScript("bizagi.workportal.tablet.overrides"),type:"js"})},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService}),a=bizagi.util.isOfflineForm({container:e.parent});if("grid"===t)return bizagi.util.isTabletDevice()&&a?new bizagi.rendering.grid.offline(r):new bizagi.rendering.grid(r);if("upload"===t)return bizagi.util.isTabletDevice()&&a?new bizagi.rendering.upload.offline(r):new bizagi.rendering.upload(r);if("number"===t){var n=i.properties;if(n&&29===n.dataType)return new bizagi.rendering.numberScientificNotation(r)}return this._super(e)},getColumn:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnNumber"===t){var r=e.data.properties;if(r&&29===r.dataType)return i.decorated=bizagi.rendering.numberScientificNotation,new bizagi.rendering.columns.numberScientificNotation(i)}return this._super(e)}}),$.Class.extend("bizagi.rendering.device.factory",{},{init:function(e){this.device=bizagi.util.detectDevice(),this.cachedFactory=null},getRenderFactory:function(e,t){var i=this,r=new $.Deferred;if(null!=i.cachedFactory&&""==t)i.cachedFactory.printVersion=!1,r.resolve(i.cachedFactory);else{if("print"===t)return i.cachedFactory=new bizagi.rendering.print.factory(e),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)}),r.promise();if("desktop"===this.device)return i.cachedFactory=new bizagi.rendering.desktop.factory(e),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)}),r.promise();bizagi.util.isTabletDevice()?(i.cachedFactory=new bizagi.rendering.tablet.factory(e),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)})):bizagi.util.isSmartphoneDevice()?(i.cachedFactory=new bizagi.rendering.smartphone.factory(e),i.cachedFactory.initAsyncStuff().done(function(){r.resolve(i.cachedFactory)})):(bizagi.showMessageBox("Not supported device: "+this.device),r.resolve(""))}return r.promise()},getDataService:function(){return this.dataService}}),bizagi.rendering=bizagi.rendering||{},$.Class.extend("bizagi.rendering.facade",{form:void 0,executionDeferred:new $.Deferred},{init:function(e){e=e||{},this.observableElement=$({});var t=e.device||"";this.deviceFactory=new bizagi.rendering.device.factory,this.dataService=new bizagi.render.services.service(e),this.renderFactory=this.deviceFactory.getRenderFactory(this.dataService,t)},getFactory:function(){return{deviceFactory:this.deviceFactory,dataService:this.dataService,renderFactory:this.renderFactory}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)},update:function(e){return e.mode&&(this.mode=e.mode),this.execute($.extend(e,{canvas:this.canvas,mode:this.mode}))},execute:function(e){var t=this,i=this.ownerDocument,r=$("body",i);if(e=e||{},t.executionDeferred&&t.executionDeferred.state?"resolved"==t.executionDeferred.state()&&(t.executionDeferred=$.Deferred()):t.executionDeferred=$.Deferred(),bizagi.chrono.initAndStart("rendering+data",!0),bizagi.rendering.render.startOptimization(),void 0===e.mode&&!bizagi.util.isEmpty(window.location.search)){var a=bizagi.util.getQueryString();e.mode=a.mode}var n=t.canvas=e.canvas=e.canvas||$("<div />").appendTo(r);return t.mode=e.mode,t.process(e).done(function(i){e.refreshing||n.empty(),n.append(i.container),$(i.pathProcess).insertBefore(i.container),t.form=i,t.form.setSize({width:t.lastWidth,height:t.lastHeight}),setTimeout(function(){t.lastWidth=$(window).width(),t.lastHeight=$(window).height(),window.self!==window.top&&t.resizeInPopUpHTML()},2e3),i.triggerHandler("ondomincluded"),t.publish("rendering-formRendered",{}),t.configureRefresh(i,n),t.configureRouting(i,n),t.configureRenderError(i,n),t.configureResize(i),t.configureGlobalHandlers(i),e.summaryForm&&i.container.addClass("ui-bizagi-summary-form"),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("submitForm"),bizagi.chrono.stopAndLog("submitForm-ajax"),bizagi.chrono.stopAndLog("waiting"),bizagi.rendering.render.stopOptimization(),bizagi.override.enableE2EInterface&&(t.Class.form=t.form,t.Class.executionDeferred.resolve(t.form)),t.executionDeferred.resolve(t.form)}).fail(function(e,i){$.when(t.renderFactory).done(function(i){void 0!==e&&""!==e||(e=bizagi.localization.getResource("render-error-unknown"));var r=i.getCommonTemplate("form-error");n.empty(),n.append($.tmpl(r,{message:e})),t.canvas.triggerHandler("errorform",e),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),t.executionDeferred.reject()})}),t.executionDeferred.promise()},ready:function(){return this.executionDeferred.promise()},process:function(e){var t=this,i=new $.Deferred,r=t.dataService.getFormData(e),a=t.canvas||e.canvas;return bizagi.showErrorAlertDialog=!1,$.when(r,t.renderFactory).done(function(r,n){if(bizagi.showErrorAlertDialog=!0,bizagi.util.isEmpty(r))return t.publish("no-data-found"),void i.fail();if(r&&"reload"==r.type)(l=t.form)&&(l.endLoading(),l.dispose()),a.triggerHandler("routing");else if(r&&"suspended"==r.type){var o=n.getTemplate("info-message"),s=bizagi.localization.getResource("render-case-suspended");$.tmpl(o,{message:s}).appendTo(a),i.fail()}else if(r&&"error"!=r.type){e.hasOwnProperty("printversion")&&((r=t.transformGridControl(r)).form.properties.editable="False"),bizagi.chrono.initAndStart("rendering"),e.type=r.form&&r.form.properties.type||e.type;var l=t.processForm(r.form,n,e);i.resolve(l)}else t.getFailDeferred(r,i)}).fail(function(e){t.getFailDeferred(e,i)}),i.promise()},transformGridControl:function(e){var t=this;return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=e.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(e,function(i,r){"object"==typeof r&&(e[i]=t.transformGridControl(e[i]))}),e)},getFailDeferred:function(e,t){var i="",r={};try{r=JSON.parse(e.responseText)}catch(t){r={message:e.responseText,errorType:"ERRORUNKNOWN"}}r.message?(i+="<br>Error Type: "+r.errorType,i+="<br>Error Message: "+r.message):"JSharpNotSupportedException"==r.errorType&&(i+="<br>Error Message: "+bizagi.localization.getResource("jsharp-required")),"ERRORUNKNOWN"==r.errorType?t.reject(i,r.errorType):t.reject(i)},processForm:function(e,t,i){var r=t.getContainer($.extend(i,{type:i.type||"form",data:e}));if("undefined"!=typeof BIZAGI_ORIENTATION&&("rtl"==r.properties.orientation||"rtl"==BIZAGI_ORIENTATION)&&r.buttons.length>0){var a=r.buttons[0];r.buttons.splice(0,1),r.buttons.push(a)}return r.render(),r},resize:function(e){this.form&&this.form.trigger("renderresize",e)},configureRefresh:function(e,t){var i=this;e.bind("refresh",function(r,a){var n=e.container.parent(),o=(n=bizagi.util.scrollTop(n)).scrollTop();$(i.form).trigger("onRefreshStarted"),e.dispose(a),t.fastEmpty();var s=t.parent();s.find(".ui-bizagi-button-container").length>0&&s.find(".ui-bizagi-button-container").remove(),i.executionDeferred&&i.executionDeferred.state&&"resolved"==i.executionDeferred.state()&&(i.executionDeferred=$.Deferred());var l=i.form.getParams();return $.when(i.execute($.extend(a,{canvas:t,refreshing:!0,idCase:l.idCase,displayName:l.displayName}))).done(function(){setTimeout(function(){n.scrollTop(o),$(i.form).trigger("onRefreshFinished")},100)}),i.executionDeferred.promise()})},configureResize:function(e){var t=this;e.bind("renderresize",function(i,r){if(r=r||{},!t.resizeTimeout){t.resizeTimeout=setTimeout(function(){var i=$(window).width(),a=$(window).height();(r.forceResize||i!=t.lastWidth)&&(bizagi.chrono.initAndStart("resize"),e.resize({width:i,height:a}),t.lastWidth=i,t.lastHeight=a,bizagi.chrono.stopAndLog("resize"),bizagi.chrono.log("resize")),t.resizeTimeout=null},0)}}),t.resize()},configureRouting:function(e,t){e.bind("routing",function(i,r){e.dispose(),t.triggerHandler("routing",r)})},configureGlobalHandlers:function(e){var t=this;e.bind("globalHandler",function(e,i){return t.publish(i.eventType,i.data)})},configureRenderError:function(e,t){var i=this;e.bind("formRenderingError",function(e,r){$.when(i.renderFactory).done(function(e){var a="<br>Error: ";r=r.replace(/(\r\n|\n|\r)/gm,"");var n=JSON.parse(r);n.message&&(a+=n.message,a+="<br>Error Type: "+n.errorType);var o=e.getCommonTemplate("form-error");t.empty(),t.append($.tmpl(o,{message:a})),i.canvas.triggerHandler("errorform","renderItemError"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("rendering")})})},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0&&"cases"!=bizagi.util.getQueryString().type){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer"),r=i.outerHeight()||0,a=bizagi.util.getQueryString().renderBehavior||"";if("PopUp"==(a=a.replace("#",""))){if(void 0===self.postMessageSocket){var n=$(".activitiFormContainer").height()-50||396;$("#render-canvas").height(n),$("#render-canvas").css("overflowY","scroll")}else $(".activitiFormContainer").height($(".activitiFormContainer").height()+$(".ui-bizagi-button-container").height()+30);$(".ui-bizagi-button-container").css("position","absolute"),$(".ui-bizagi-button-container").appendTo(".activitiFormContainer"),$(".ui-bizagi-button-container").length>1&&($(".ui-bizagi-button-container:first").hide(),t.css("marginTop","-17px"))}i.length>0&&t.height(e-97-r),0==$(".ui-bizagi-button-container").children().length?$("#render-canvas").height($("#render-canvas").height()+r):(i.width("100%"),i.css("marginLeft",0),i.css("bottom",0))}else"render"==bizagi.util.getQueryString().type&&($("html").css("overflowX","hidden"),$("#render").height()<=window.innerHeight+5?$("html").css("overflowY","hidden"):$("html").css("overflowY","scroll"),$(".ui-widget-overlay").height(650))}});
//# sourceMappingURL=../../../../Maps/tablet_android/renderingflat.tablet.production.js.map
