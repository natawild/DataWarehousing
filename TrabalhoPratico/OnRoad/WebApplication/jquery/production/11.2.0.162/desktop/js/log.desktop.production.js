bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,a){var i=this;i.params=a||{},i._super(e,t,a),i.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this;a.params=$.extend(a.params,t.args),a.params.plan.idActivitySelected=void 0,a.clean();var i=a.getContent().empty();void 0!==e.type&&(a.params.showContextByMenuDashboard=e.type);var o={showFormOverview:a.params.menuDashboard.showFormOverview,showFormActivity:a.params.menuDashboard.showFormActivity,showCommentsOptionMenu:a.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:a.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:a.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:a.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:a.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:a.params.menuDashboard.contextFormActivityOptionMenu,isAdhocProcess:a.params.isAdhocProcess};a.getTemplate("project-dashboard-menu").render(o).appendTo(i),a.params.showContextByMenuDashboard&&$("li[data-context='"+a.params.showContextByMenuDashboard.toUpperCase()+"']",a.content).addClass("active").siblings().removeClass("active"),a.handlerEvents()},loadContentById:function(e){var t=this;e.preventDefault();var a=$(e.target).closest("li");if(!a.hasClass("active")){var i=a.data("context");i&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var e=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),a=parseInt(e[0]),o="",r=a;"PLANACTIVITIES"==i&&(r=a+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),t.params.refreshLastItemBreadcrumb=!1,t.pub("notify",{type:i.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:i,histName:o,level:r})}),$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")})}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),a=$("[data-context='FILES']",e),i=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",function(){t.toggle(),a.toggle(),i.toggle()})},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)})},clean:function(){var e=this,t=e.getContent();e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))}),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this,t=e.getTemplate("project-content-dashboard");return e.content=t.render({}),e.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.activity.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ACTIVITY_LOG},renderContent:function(){var e=this,t=e.getTemplate("activity.log");return e.idCase=e.params.idCase,e.idWorkflow=e.params.idWorkflow,e.content=$.tmpl(t,{idCase:e.idCase})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.authentication.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_AUTHENTICATION_LOG},renderContent:function(){var e=this.getTemplate("authentication.log");return this.content=$.tmpl(e,{})}}),bizagi.workportal.widgets.activity.log.extend("bizagi.workportal.widgets.activity.log",{},{init:function(e,t,a){var i=this;i.totalPages=0,i.maxRows=10,i.maxPages=10,i.currentPage=1,i._super(e,t,a),i.loadTemplates({"activity.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log"),"activity.log.general.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-general-content"),"activity.log.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-header"),"activity.log.detail.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-header"),"activity.log.detail.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-content"),useNewEngine:!1})},postRender:function(){var e=this;e.generalContentTmpl=e.getTemplate("activity.log.general.content"),e.generalHeaderContentTmpl=e.getTemplate("activity.log.header"),e.detailHeaderTmpl=e.getTemplate("activity.log.detail.header"),e.detailContentTmpl=e.getTemplate("activity.log.detail.content"),e.logCategories={ACTIVITIES:{id:"ActivityLog",serviceMethod:"getActivityLog",detailServiceMethod:"getActivityDetailLog",selectedDetailId:0},ENTITIES:{id:"EntityLog",serviceMethod:"getEntityLog",detailServiceMethod:"getEntityDetailLog",selectedDetailId:0},USERS:{id:"UserLog",serviceMethod:"getUserLog",detailServiceMethod:"getUserDetailLog",selectedDetailId:0},ADMINISTRATION:{id:"AdminLog",serviceMethod:"getAdminLog"}},e.containtersID={GENERAL:"general",DETAIL:"detail"};var t=null!=typeof e.dataService.serviceLocator.proxyPrefix?e.dataService.serviceLocator.proxyPrefix:"";new bizagi.render.services.service({proxyPrefix:t}).getCaseNumber({idCase:e.idCase}).done(function(t){var a=t.caseNumber;e.caseNumber=a||e.idCase,e.initWidget()})},initWidget:function(){this.displayNoResults(!1),this.setupHeader()},setupHeader:function(){var e=this;content=e.getContent();var t=$("#activity-log-data-header-wrapper",content);$.when(e.dataService.supportedLogTypes()).done(function(a){$.tmpl(e.generalHeaderContentTmpl,{supportedLogTypes:a.Supported}).appendTo(t);var i=e.getFirstAvailableLogTypes(a.Supported);e.currentPage=1,e.getActivityLogByCategory(e.logCategories[i]),e.bindHeaderElementInteraction($("#LnkActivities",e.content),e.logCategories.ACTIVITIES),e.bindHeaderElementInteraction($("#LnkEntities",e.content),e.logCategories.ENTITIES),e.bindHeaderElementInteraction($("#LnkUsers",e.content),e.logCategories.USERS),e.bindHeaderElementInteraction($("#LnkAdmin",e.content),e.logCategories.ADMINISTRATION)}).fail(function(e){})},getFirstAvailableLogTypes:function(e){for(var t in this.logCategories)for(var a in e)if(this.logCategories[t].id==a&&("true"==e[a]||1==e[a]))return t;return""},bindHeaderElementInteraction:function(e,t){var a=this;e.click(function(){$(this).hasClass("active")||($(".active",a.content).removeClass("active"),$(this).addClass("active"),a.currentPage=1,a.getActivityLogByCategory(t))})},getActivityLogByCategory:function(e){var t,a=this;a.selectedCategoryObj=$.isEmptyObject(e)?a.selectedCategoryObj:$.extend({},e),t={idCase:a.idCase,idActualPage:a.currentPage,pageSize:a.maxRows},$("#activity-log-data-general-wrapper",content).addClass("ui-bizagi-component-loading"),$.when(a.dataService[a.selectedCategoryObj.serviceMethod](t)).done(function(e){a.totalPages=e.total,a.generalActivityDataValidator(e)}).fail(function(e){bizagi.showErrorAlertDialog=!1,bizagi.showMessageBox(JSON.parse(e.responseText).message,"Bizagi","Error")})},generalActivityDataValidator:function(e){var t=this,a=t.getContent();$("#activity-log-data-general-wrapper",a);if(e.rows){if(t.selectedCategoryObj.id==t.logCategories.ADMINISTRATION.id)for(var i,o=e.rows.length;o-- >0;)i=-1!==e.rows[o][3].indexOf("--\x3e")?[].concat(e.rows[o][3].split("--\x3e")[0].split(":").concat(e.rows[o][3].split("--\x3e")[1].split(": :"))):[].concat(e.rows[o][3].split("--\x3e")[0].split(":")),e.rows[o][3]=[].concat(i);t.currentLogData=[].concat(e.rows)}else t.currentLogData=[];t.renderContentByCategory()},renderContentByCategory:function(){var e=this,t=e.getContent(),a=$("#activity-log-data-general-wrapper",t);$("#activity-log-data-detail-wrapper",t);a.removeClass("ui-bizagi-component-loading"),a.empty(),e.switchContent(e.containtersID.GENERAL);var i=e.getPaginationData();$.tmpl(e.generalContentTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,logItems:e.currentLogData,pagData:i}).appendTo(a),e.setUpPagination($("#biz-wp-activitylog-category-pager ul",e.content),"getActivityLogByCategory"),e.currentLogData.length>0?(e.displayNoResults(!1),$(".activity-log-table",a).show()):(e.displayNoResults(!0),$(".activity-log-table",a).hide()),$(".detail-item",a).click(function(t){t.preventDefault(),e.selectedLogItemIndex=$($(t.currentTarget).closest("tr")[0]).index()-1,e.currentPage=1,e.preprocessDetailRender($(this))}),$(".listHeaderLinks",a).click(function(e){e.preventDefault()})},getPaginationData:function(){for(var e=this,t=e.totalPages>1,a={page:e.currentPage,pagesArray:[],pagination:t},i=e.maxPages>e.totalPages?e.totalPages:e.maxPages,o=0;o<i;o++)a.pagesArray.push(o+1);return a},setUpPagination:function(e,t){var a=this;e.bizagiPagination({maxElemShow:a.maxRows,totalPages:a.totalPages,actualPage:a.currentPage,listElement:e,clickCallBack:function(i){a.currentPage=parseInt(i.page),a[t]({},e)}})},preprocessDetailRender:function(e){var t=this,a=(t.getContent(),t.getDetailRenderParams(e));t.selectedCategoryObj.detailServiceMethod&&$.when(t.dataService[t.selectedCategoryObj.detailServiceMethod](a)).done(function(e){t.totalPages=e.total,t.switchContent(t.containtersID.DETAIL),e.rows?t.currentDetailLogData=[].concat(e.rows):t.currentDetailLogData=[],t.renderLogDetail(e)}).fail(function(e){})},getDetailRenderParams:function(e){var t,a,i=this;switch(i.selectedCategoryObj.id){case i.logCategories.ACTIVITIES.id:$.isEmptyObject(e)?a=i.logCategories.ACTIVITIES.selectedDetailId:i.logCategories.ACTIVITIES.selectedDetailId=a=e.attr("data-id"),t={idCase:i.idCase,idWorkItemFrom:a};break;case i.logCategories.ENTITIES.id:$.isEmptyObject(e)?a=i.logCategories.ENTITIES.selectedDetailId:i.logCategories.ENTITIES.selectedDetailId=a=e.attr("data-id"),t={idCase:i.idCase,idEntity:a};break;case i.logCategories.USERS.id:$.isEmptyObject(e)?a=i.logCategories.USERS.selectedDetailId:i.logCategories.USERS.selectedDetailId=a=e.attr("data-id"),t={idCase:i.idCase,idUser:a}}return $.extend(t,{idActualPage:i.currentPage,pageSize:i.maxRows}),t},renderLogDetail:function(e){var t=this,a=t.getContent(),i=$("#activity-log-data-detail-wrapper",a);i.empty(),i.removeClass("ui-bizagi-component-loading"),$.when(t.renderDetailContent()).done(function(){var e=$("#log-filter-wrapper",a);t.showDetailResultMessage(),$("#back-general-content",i).click(function(e){e.preventDefault(),t.displayNoResults(!1),t.switchContent(t.containtersID.GENERAL)}),$("#apply-filter",e).click(function(e){e.preventDefault(),t.currentPage=1,t.applyDetailFilter()}),$("#remove-filter",e).click(function(a){a.preventDefault(),$("input",e).val(""),t.currentPage=1,t.applyDetailFilter()}),$(".listHeaderLinks",i).click(function(e){e.preventDefault()})})},showDetailResultMessage:function(){var e=$("#activity-log-data-detail-wrapper",this.getContent());this.currentDetailLogData.length>0?(this.displayNoResults(!1),$(".activity-log-table",e).show()):(this.displayNoResults(!0),$(".activity-log-table",e).hide())},applyDetailFilter:function(){var e=this,t=e.getFilterParams(),a=e.getContent();e.selectedCategoryObj.detailServiceMethod&&$.when(e.dataService[e.selectedCategoryObj.detailServiceMethod](t)).done(function(t){e.totalPages=t.total,t.rows?e.currentDetailLogData=[].concat(t.rows):e.currentDetailLogData=[];var i=e.getPaginationData(),o=$.tmpl(e.detailContentTmpl,{logCategory:e.selectedCategoryObj.id,title:e.selectedCategoryObj.title,detailItems:e.currentDetailLogData,pagData:i});$("#bz-workportal-activitylog-detailcontent-wrapper",a).remove(),$(o).insertAfter("#activity-log-data-detail-header-wrapper",a),e.showDetailResultMessage(),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",a),"applyDetailFilter")})},getFilterParams:function(){var e,t,a,i=this,o=i.getContent(),r=$("#log-filter-wrapper",o),s=i.getDetailRenderParams();return i.selectedCategoryObj.id==i.logCategories.ENTITIES.id?e=$("#filterUser",r).val().toLowerCase():i.selectedCategoryObj.id==i.logCategories.USERS.id&&(a=$("#filterEntity",r).val().toLowerCase()),t=$("#filterAttribute",r).val().toLowerCase(),$.extend(s,{userFullName:e,attribDisplayName:t,entDisplayName:a}),s},renderDetailContent:function(){var e=this,t=e.getContent(),a=$.Deferred(),i=$("#activity-log-data-detail-wrapper",t),o=e.getPaginationData();return $.when($.tmpl(e.detailHeaderTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,data:e.currentLogData[e.selectedLogItemIndex]}),$.tmpl(e.detailContentTmpl,{logCategory:e.selectedCategoryObj.id,title:e.selectedCategoryObj.title,detailItems:e.currentDetailLogData,pagData:o})).done(function(t,o){i.append(t),o.insertAfter("#activity-log-data-detail-header-wrapper",i),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",e.content),"preprocessDetailRender"),a.resolve()}),a.promise()},switchContent:function(e){var t=this.getContent(),a=$("#activity-log-data-general-wrapper",t),i=$("#activity-log-data-detail-wrapper",t);this.containtersID.DETAIL==e?(a.hide(),i.show()):(a.show(),i.hide())},displayNoResults:function(e){var t=this.getContent();e?$("#activity-log-no-results",t).show():$("#activity-log-no-results",t).hide()}}),bizagi.injector.register("bizagi.workportal.widgets.activity.log",["workportalFacade","dataService",bizagi.workportal.widgets.activity.log],!0),bizagi.workportal.widgets.authentication.log.extend("bizagi.workportal.widgets.authentication.log",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"authentication.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log"),"authentication.log.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-fields"),"authentication.log.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-button"),"authentication.log.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-result"),"authentication.log.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-pagination"),useNewEngine:!1})},postRender:function(){var e=this;e.maxElemShow=10,e.maxPageToShow=5,e.generalContentTmpl=e.getTemplate("authentication.log"),e.fieldsContentTmpl=e.getTemplate("authentication.log.fields"),e.buttonContentTmpl=e.getTemplate("authentication.log.button"),e.resultContentTmpl=e.getTemplate("authentication.log.result"),e.paginationTmpl=e.getTemplate("authentication.log.pagination"),e.setupInitialData()},setupInitialData:function(){var e=this,t=e.getContent(),a=[{dataType:"domains"},{dataType:"events"},{dataType:"subEvents"}];$.when(e.dataService.getAuthenticationLogData(a[0]),e.dataService.getAuthenticationLogData(a[1]),e.dataService.getAuthenticationLogData(a[2])).done(function(a,i,o){e.eventTypeList=i[0].response,e.subEventTypeList=o[0].response;var r=$.tmpl(e.fieldsContentTmpl,{domainList:a[0],eventTypeList:i[0].response,subEvenTypes:o[0].response});t.append(r),e.setupDatePicker(),e.setupFooterButtons()}).fail(function(e){bizagi.log(e)})},setupDatePicker:function(){var e=this.getContent(),t=bizagi.localization.getResource("dateFormat").replaceAll("yyyy","yy").replaceAll("MM","mm").replaceAll("M","m"),a=bizagi.localization.getResource("timeFormat");$(".biz-wp-form-datepicker",e).datetimepicker({controlType:"select",dateFormat:t,timeFormat:a,currentText:bizagi.localization.getResource("render-timeentry-now"),closeText:bizagi.localization.getResource("workportal-general-button-label-done"),timeText:bizagi.localization.getResource("workportal-project-plan-time-title"),hourText:bizagi.localization.getResource("reports-general-hour").capitalize(),minuteText:bizagi.localization.getResource("reports-general-minute").capitalize()})},setupFooterButtons:function(){var e=this,t=e.getContent(),a=$.tmpl(e.buttonContentTmpl,{});t.append(a);var i=$("#authentication-log-data-buttonset",t);$("#btn-authentication-search",i).click(function(a){$(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove();var i=e.validateData(),o=$("#sinceDate",t).val(),r=$("#toDate",t).val();if(""!=o&&(o=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(o,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")),""!=r&&(r=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(r,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")),i.fieldsAreEmpty||""!=i.errorMessage)bizagi.showMessageBox(i.errorMessage,"Bizagi","warning");else{var s={action:"AuthLog",domain:"none"!=$("#domainList",t).val()?$("#domainList",t).val():"",userName:$("#auth-log-user",t).val(),dtFrom:o,dtTo:r,eventSubType:$("#subEventType",t).val()!=e.subEventTypeList[0].displayName?$("#subEventType",t).val():"",eventType:$("#eventType",t).val()!=e.eventTypeList[0].displayName?$("#eventType",t).val():"",pagSize:e.maxElemShow};e.findResults(t,s)}})},validateData:function(){var e=this,t=e.getContent(),a={fieldsAreEmpty:!1,errorMessage:""},i="",o="",r=$("#sinceDate",t).val(),s=$("#toDate",t).val();return"none"==$("#domainList",t).val()&&""==$("#user",t).val()&&$("#eventType",t).val()==e.eventTypeList[0].id&&$("#subEventType",t).val()==e.subEventTypeList[0].id&&""==$("#sinceDate",t).val()&&""==$("#toDate",t).val()?(a.fieldsAreEmpty=!0,a.errorMessage=bizagi.localization.getResource("workportal-widget-authentication-log-emptyfields-message")):""!=r&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(r,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")?(o=bizagi.localization.getResource("workportal-widget-authentication-log-datesince"),i=(i=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",o),a.errorMessage=i):""!=s&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(s,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")&&(o=bizagi.localization.getResource("workportal-widget-authentication-log-dateto"),i=(i=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",o),a.errorMessage=i),a},findResults:function(e,t,a){var i=this;t.pag=a||1,$.when(i.dataService.getAuthenticationLogResult(t)).done(function(a){if($(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),i.totalRecords=a.records,i.totalPages=a.total,a.rows.length>0){var o=$.tmpl(i.resultContentTmpl,{resultList:a.rows});e.append(o);var r,s=i.maxPageToShow>i.totalPages?i.totalPages:i.maxPageToShow,n=$("#biz-wp-table-pager-wrapper"),c={};c.pagination=i.totalPages>1,c.page=a.page,c.pages={};for(var l=1;l<=s;l++)c.pages[l]={pageNumber:l};r=$.tmpl(i.paginationTmpl,c).html(),n.append(r),$("ul").bizagiPagination({maxElemShow:i.maxElemShow,totalPages:i.totalPages,actualPage:a.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(a){i.findResults(e,t,a.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")}).fail(function(e){bizagi.log(e)})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.overview",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-overview":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview"),"project-overview-no-summary-form-found":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview-no-summary-form-found")})},renderContent:function(){var e=this.getTemplate("project-overview");return this.content=e.render({}),this.content},postRender:function(){var e=this,t=e.getContent(),a=$("#ui-bizagi-wp-project-overview-wrapper",t);a.bind("oldrenderintegration",function(t){if(!t.isPropagationStopped()){t.stopPropagation();var i=e.workportalFacade.getTemplate("inbox-common-case-summary-oldrender"),o={};bizagi.oldrenderevent=!0;var r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"==r?"onmessage":"message",function(t){t.stopPropagation(),e.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.data})},!1),$.when(e.dataService.getWorkitems({idCase:e.params.idCase,onlyUserWorkItems:!0})).done(function(t){if("object"==typeof t.workItems&&t.workItems.length>=1){var r=t.workItems[0].idWorkItem,s=t.workItems[0].idTask;o.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&idWorkitem="+r+"&idTask="+s+"&isSummary=1"}else o.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&isSummary=1";a.empty(),$.tmpl(i,o).appendTo(a),e.iframeOldRender($("iframe",a))})}});var i={idCase:e.params.idCase};$.when(e.dataService.getCaseFormsRenderVersion(i)).done(function(i){1==i.formsRenderVersion?a.trigger("oldrenderintegration"):e.renderSummaryForm(e.params.idCase,$("#ui-bizagi-wp-project-overview-wrapper",t))})},renderSummaryForm:function(e,t){var a=this,i=null!=typeof a.dataService.serviceLocator.proxyPrefix?a.dataService.serviceLocator.proxyPrefix:"",o=new bizagi.rendering.facade({proxyPrefix:i});o.execute({canvas:t,summaryForm:!0,idCase:e}),o.subscribe("no-data-found",function(){var e=a.getTemplate("project-overview-no-summary-form-found");t.append(e.render())}),a.renderingFacade=o,setTimeout(function(){a.resizeLayout()},1e3)},iframeOldRender:function(e){this.getContent();var t,a=bizagi.readQueryString();$.each(e,function(){$(this).is("iframe")&&(t=$(this))}),t.load(function(){var e=$(this).contents(),t=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";t=t.replace("%theme%",a.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+t+"'>")})}}),bizagi.injector.register("bizagi.workportal.widgets.project.overview",["workportalFacade","dataService",bizagi.workportal.widgets.project.overview],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(e,t,a){var i=this;i._super(e,t,a),i.contextsSidebarActivity=a.contextsSidebarActivity,i.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),i.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")}),i.releaseDialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.releaseDialogBox.formContent=this.getTemplate("project-caseState-popup-release").render({}),this.content},postRender:function(){var e=this;(e.contextsSidebarActivity||[]).forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.plugins={},e.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",e.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",e.releaseDialogBox.formContent)}},e.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(e.onClickAcceptRelease,e)),e.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(e.onClickCancelRelease,e))},updateView:function(e,t){var a=this;$.extend(a.params,t.args);var i=t.args;a.getContent().empty();var o={isFavoriteCase:"off"};if(i.isFavorite&&JSON.parse(i.isFavorite)?o.isFavoriteCase="bz-icon-star":o.isFavoriteCase="bz-icon-star-outline",a.showCaseNumber(i,o),i.creationDate){var r="MM/dd/yyyy H:mm",s=i.creationDate,n=bizagi.util.dateFormatter.getDateFromFormat(s,r);o.creationDateFormat=a.getFormattedDate(n);var c=bizagi.util.dateFormatter.getDateFromFormat(i.solutionDate,r);o.solutionDateFormat=a.getFormattedDate(c);var l=new Date;a.calculateDataForTemplate(o,n,l,c,i)}$(a.getContent()).on("click",".show-diagram-case",function(){!(!a.params.isAdhocProcess||void 0===a.params.isAdhocProcess)?a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow,isAdhoc:!0,idProcess:a.params.idAdhocProcess}):a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow})}),$(a.getContent()).on("click",".show-process-help",function(){a.showHelpUrl(a.params.helpUrl)})},calculateDataForTemplate:function(e,t,a,i,o){var r=this.getContent(),s={};s.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(o.isOpen)?(s.fromDate=t.getTime(),s.toDate=a.getTime()):(s.fromDate=i.getTime(),s.toDate=a.getTime());var n=s.toDate-s.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n),null,!1);bizagi.util.parseBoolean(o.isOpen)?(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),e.colorStateCase="Opened"):(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),e.colorStateCase="Closed"),e.percentCompleteBar=100,e.isOpen=bizagi.util.parseBoolean(o.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(o,e)).appendTo($("#ui-bizagi-remaining",r)),o.currentState.length>0&&this.initilizeActionMenu(o.currentState)},showCaseNumber:function(e,t){var a=this,i=a.getContent(),o=a.getTemplate("project-caseState"),r=!1;r=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,a.params.helpUrl=bizagi.util.validateUrlWellFormed(a.params.helpUrl),o.render($.extend(e,t,{security:bizagi.menuSecurity,isAdhocProcess:r,urlHelp:!bizagi.util.isEmpty(a.params.helpUrl)})).appendTo(i),$(".case-summary-favorite",i).on("click",$.proxy(a.onClickFavorite,a)),$(".case-summary-back",a.content).on("click",$.proxy(a.goToCase,a,"back")),$(".case-summary-next",a.content).on("click",$.proxy(a.goToCase,a,"next")),a.showBackNextNavigation()},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},onClickFavorite:function(e){e.preventDefault();var t=this,a={};$(e.target).hasClass("bz-icon-star-outline")?(a={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(a)).done(function(a){t.params.guidFavorite=a.idFavorites,$(e.target).removeClass("bz-icon-star-outline"),$(e.target).addClass("bz-icon-star")})):(a={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(a)).done(function(){$(e.target).addClass("bz-icon-star-outline"),$(e.target).removeClass("bz-icon-star")}))},showHelpUrl:function(e){window.open(e)},initilizeActionMenu:function(e){var t=this,a=!1,i=!1;if(e&&e.length>0)for(j=0;j<e.length;++j)e[j]&&t.params&&e[j].idWorkItem==t.params.idWorkitem&&(a=bizagi.util.parseBoolean(e[j].allowsReassign)||!1,i=bizagi.util.parseBoolean(e[j].allowReleaseActivity)||!1);var o=$("#bt-case-action-reassing",t.content),r=$("#bt-case-action-release",t.content);a&&o.show();var s=t.params.assignationEveryone||{},n=i&&!(s.enabledReadOnlyForAsigneeToEveryone&&s.isAssignationMethodEveryone);n&&r.show(),(a||n)&&($(".ui-bizagi-wp-project-plan-action-menu",t.content).show(),$(".ui-bizagi-wp-project-plan-action-menu",t.content).menu({select:$.proxy(t.onSelectMenu,t)}).removeClass("ui-widget-content"))},onSelectMenu:function(e,t){if(0===$(e.currentTarget).find("i").length)switch($(t.item).data("item")){case"reassing":this.onClickMenuReasign();break;case"release":this.onClickMenuRelease()}},onClickMenuReasign:function(){var e=this.params.idCase,t=this.params.idWorkitem;$.when(this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:t},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))},onClickMenuRelease:function(){var e=this;e.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var e=this,t={idCase:e.params.idCase,idWorkItem:e.params.idWorkitem};$.when(e.dataService.releaseActivity(t)).done(function(a){var i;switch(a.status?a.status:""){case"Success":e.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":i=e.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:i=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var a=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(a,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}),e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){this.releaseDialogBox.formContent.dialog("destroy"),this.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(e){var t=$.Deferred();return e.fromDate?$.when(this.dataService.getEffectiveDuration(e)).done(function(e){t.resolve(e)}):t.resolve(null),t.promise()},clean:function(){var e=this;$(".show-diagram-case",e.getContent()).off();var t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},goToCase:function(e){var t="back"==e?this.getBackCase():this.getNextCase();t>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var e=0;e<bizagi.lstIdCases.length;e++)if(this.params.idCase==bizagi.lstIdCases[e])return e;return-1},getNextCase:function(){var e=this.getListKey();return bizagi.lstIdCases.length==e+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[e+1]},getBackCase:function(){var e=this.getListKey();return 0==e?-1:bizagi.lstIdCases[e-1]||-1},showBackNextNavigation:function(){var e=this,t=e.getNextCase(),a=e.getBackCase();t<=0?$(".case-summary-next",e.content).hide():$(".case-summary-next",e.content).show(),a<=0?$(".case-summary-back",e.content).hide():$(".case-summary-back",e.content).show(),t<=0&&a<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.params=i,a.getContent();var o={},r=(i.currentState||[]).filter(function(e){return e.idWorkItem==i.idWorkitem})[0];if(r){o.activityName=r.state,o.activityIsEvent=bizagi.util.parseBoolean(r.isEvent);var s="MM/dd/yyyy H:mm",n=bizagi.util.dateFormatter.getDateFromFormat(r.entryDateWorkItem,s);n.getTime&&(o.initDateFormat=a.getFormattedDate(n));var c=new Date,l=bizagi.util.dateFormatter.getDateFromFormat(r.estimatedSolutionDate,s);o.estimatedSolutionDateFormat="",n.getTime&&l.getTime&&r?a.calculateDataForTemplate(r,o,n,c,l):a.updateTemplateWidget(o)}},calculateDataForTemplate:function(e,t,a,i,o){new Date(Date.now()-a.getTime());var r=i.getTime()-o.getTime(),s=a.getTime()-o.getTime(),n=(bizagi.currentUser.idUser,a.getTime()),c=Date.now(),l=!1,p={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:o.getTime()},d={};r>0?(p.fromDate=o.getTime(),p.toDate=i.getTime(),l=!0):(d.idUser=bizagi.currentUser.idUser,d.fromDate=a.getTime(),d.toDate=o.getTime());var g=c-n,u=p.toDate-p.fromDate,m=r>0?0:d.toDate-d.fromDate,v=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-g),null,!1);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",v),t.percentCompleteBar=100,0===s)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===l){var b=this.getPercentBar(m/1e3/60,u/1e3/60);t.percentCompleteBar=b.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent)),t.estimatedSolutionDateFormat=this.getFormattedDate(o),this.updateTemplateWidget(t)},getPercentBar:function(e,t){var a={};return a.percent=Math.round(100*(1-t/e)),a},updateTemplateWidget:function(e){var t=this.getContent().empty();this.getTemplate("project-activityState-wrapper").render(e).appendTo(t)},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},clean:function(){var e=this,t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},callGetEffectiveDuration:function(e){var t=this,a=$.Deferred();return setTimeout(function(){e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){a.resolve(e)}):a.resolve(null)},200),a.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var e=this.getTemplate("project-process-state");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,o=a.getContent().empty();a.params=i;var r={};r.showParentProcess=i.idParentCase>=1,r.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:"0"==i.idTask?"":i.idTask,idWorkflow:i.idWorkflowParentCase},a.getTemplate("project-process-state").render($.extend(i,r)).appendTo(o),$("#go-to-parent-case",o).on("click",$.proxy(a.onClickGoToParentCase,a))},onClickGoToParentCase:function(e){e.preventDefault();this.routingExecute($(e.target).closest("#go-to-parent-case"))},clean:function(){var e=this;e.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(e,t,a,i){var o=this;o.relatedusers=a,o._super(e,t,i),o.contextsSidebarActivity=i.contextsSidebarActivity,o.plugins={},o.users=[],o.loadedUsers=!1,o.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.sub("ON_RENDER_FINISH",$.proxy(e.onRenderFinish,e))},updateView:function(e,t){var a=this;a.params=t,setTimeout(function(){!1===a.loadedUsers&&a.onRenderFinish()},500)},onRenderFinish:function(){var e=this,t=e.params.args,a=e.getContent().empty();e.loadedUsers=!0,e.getTemplate("project-users").render().appendTo(a);var i=[{id:t.createdBy.userId,typeName:"owner"}];t.idCase>0&&e.relatedusers.render(e.content,".relatedusers-wrapper",t.idCase,i)},clean:function(){var e=this;e.loadedUsers=!1,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(e){return e&&(responseSubprocessState=e),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(e){return e?jQuery.isArray(e)&&0===e.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(e):this.auxArrayListSubprocessesState}},{init:function(e,t,a){this._super(e,t,a),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(e){var t=this,a=t.getContent();$(e,a).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var e,a,i,o=$(this).closest("li").find("#idCase").val(),r=t.Class.auxArrayListSubprocesses().filter(function(e){return e.idCase==o});if(r.length>0)return e=r[0].indexSubprocess,a=r[0].idCustData,i=$(this).text(),t.getContentTooltip(e,a,i,t.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(e,t){if(void 0===e.originalEvent)return!1;var a=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+a).remove()},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(e,t,a,i){"-1"==t&&(t="0");var o=function(e,t){return{nameProperty:e,valueProperty:t}},r=[],s="",n=this.getSubprocessData(e,t),c=n.custData,l=n.custDataTypes,p=n.custFields,d=n.displayName;if(r.push(new o(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),d)),c.length)for(var g=0;g<c.length;g+=1)s=c[g],l&&("Money"==l[g]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==l[g]?s=bizagi.util.formatBoolean(s):"Float"==l[g]||"Real"==l[g]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),r.push(new o(p[g],s));var u={};u.arrayCustomsProperties=r,u.nameSubprocess=a;var m=i,v=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(u).appendTo(v),v.html()},getSubprocessData:function(e,t){var a={},i=this.Class.responseSubprocess().subProcesses,o=this.Class.responseSubprocess().subProcPersonalized;if(i&&i.length>0){a.custData=i[e].custData,a.custDataTypes=i[e].custDataTypes;var r=this.Class.responseSubprocess().CustFields[t];a.custFields=r[Object.keys(r)[0]],a.displayName=i[e].displayName}else o&&Object.keys(o).length>0&&(a.custData=o[0].subProcesses[e].custData,a.custDataTypes=o[0].subProcesses[e].custDataTypes,a.custFields=o[0].CustFields[0],a.displayName=o[0].subProcesses[e].displayName);return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var e=this.getTemplate("project-events");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,o=a.getContent().empty();a.params=i,$.when(a.getArgsTemplate(i)).done(function(e){a.getTemplate("project-events").render($.extend(i,e)).appendTo(o),$(".list-events li.event a",o).on("click",$.proxy(a.onClickGoEvent,a)),a.initializeTooltip(".list-events li")})},getArgsTemplate:function(e){var t=$.Deferred(),a={};if(e.countEvents>=1)for(var i=0;i<e.currentState.length;i++)"true"==e.currentState[i].isEvent&&e.currentState[i].idWorkItem==e.idWorkitem&&(e.countEvents=e.countEvents-1);return a.showEvents=e.countEvents>=1,a.showEvents?$.when(this.callSummaryCaseEvents(e.idCase)).done(function(i){e.showEvents=i.events.length>=1,e.showEvents&&(a.events=[],i.events.forEach(function(e){a.events.push($.extend(e[Object.keys(e)[0]],{idWorkFlow:i.idWorkFlow}))})),t.resolve(a)}):t.resolve(a),t.promise()},onClickGoEvent:function(e){e.preventDefault();var t=this;$.when(bizagi.util.autoSave()).done(function(){t.routingExecute($(e.target).closest("li"))})},callSummaryCaseEvents:function(e){var t=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:e})).done(function(e){t.resolve(e)}),t.promise()},clean:function(){var e=this;this.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(e){return this._super(e)},auxArrayListSubprocesses:function(e){return this._super(e)}},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.getContent().empty();a.params=i,a.params.idCase>0&&$.when(a.dataService.summarySubProcess({idCase:a.params.idCase})).done(function(e){a.Class.responseSubprocess(e),a.organizeDataForSubprocesses(a.params)})},organizeDataForSubprocesses:function(e){var t=this;if(t.Class.responseSubprocess().showSubProcess){$.each(t.Class.responseSubprocess().subProcesses,function(e){var a=t.Class.responseSubprocess().subProcesses[e].custData;if(a&&a.length)for(var i=0;i<a.length;i+=1)null===a[i]&&(a[i]="")});var a=t.Class.responseSubprocess().subProcesses||t.Class.responseSubprocess().subProcPersonalized;t.Class.auxArrayListSubprocesses([]);for(var i=0;i<Object.keys(a).length;i+=1){var o=a[i];t.Class.auxArrayListSubprocesses({isOpen:o.isOpen,radNumber:o.radNumber,displayName:o.displayName,idCase:o.idCase,indexSubprocess:i,idCustData:o.idCustData}),o.subProcesses&&Object.keys(o).forEach(function(e){t.Class.auxArrayListSubprocesses({isOpen:o[e].isOpen,radNumber:o[e].radNumber,displayName:o[e].displayName,idCase:o[e].idCase,indexSubprocess:i,idCustData:o[e].idCustData})})}t.renderWidget()}},renderWidget:function(){var e=this,t=e.getContent();e.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:e.Class.auxArrayListSubprocesses()}).appendTo(t),$(".list-subprocesses a",t).on("click",$.proxy(e.onClickGoSubprocess,e)),e.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(e){e.preventDefault();this.routingExecute($(e.target).closest("li"))},clean:function(){var e=this;e.params={},e.pluginTooltip=null,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(e,t,a){this._super(e,t,a),a=a||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var e=this,t=e.getTemplate("project-activity-description"),a=e.getWorkitemDescription();return e.content=a?t.render({description:a}):$("<div />"),e.content},postRender:function(){},getWorkitemDescription:function(){for(var e=this.params||{},t=e.idWorkitem||0,a=e.currentState||[],i="",o=0;o<a.length;o++)if(t==a[o].idWorkItem){i=a[o].tskDescription;break}return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/log.desktop.production.js.map
