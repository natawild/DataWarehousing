bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.queries",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES},renderContent:function(){var e=this,r=e.getTemplate("queries"),t=e.content=$.tmpl(r);return e.loadtemplates(),t},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.listCases",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES},setTableHeadFixed:function(e){e.TableElement.floatThead(e.floatOptions),e.groupByCaseNumber&&bizagi.util.isIE()&&e.TableElement.find("tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide").hide()}}),bizagi.workportal.widgets.listCases.extend("bizagi.workportal.widgets.queryform",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM},renderContent:function(){var e=this;bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms)&&!e.params.notMigratedUrl?e.modifiedRender():e.frankensteinRenderContent()},modifiedRender:function(){var e,r=this,t=r.getTemplate("queryform-wrapper");return e=r.content=$.tmpl(t,{}),r.loadtemplates(),e},loadtemplates:function(){},frankensteinRenderContent:function(){var e=this,r=e.getTemplate("queryform"),t="",i=e.params.idQueryForm||"",a=e.params.idStoredQuery||"",o=e.params.idCube||"";switch(e.params.queryFormAction){case"edit":t=e.dataService.getUrl({endPoint:"query-form-edit"})+"?idStoredQuery="+a+"&idQueryForm="+i;break;case"loadPrevious":t="App/ListaDetalle/listaitems.aspx?"+e.dataService.lastQueryFullKey;break;default:t=e.dataService.getUrl({endPoint:"query-form"})+"?idQueryForm="+i,t=""!=a?t+"&idStoredQuery="+a:t,t=""!=o?t+"&idCube="+o:t}return e.params.notMigratedUrl&&(t="App/"+e.params.notMigratedUrl),e.content=$.tmpl(r,{queryFormURL:t})}}),bizagi.workportal.widgets.queries.extend("bizagi.workportal.widgets.queries",{},{init:function(e,r,t){this._super(e,r,t),this.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),useNewEngine:!1})},postRender:function(){var e=this;e.configureTreeNavigation(),e.configureBackButton(),e.renderQueries(),e.scrollVertical({autohide:!1})},renderQueries:function(e,r){var t,i,a=this,o=a.getContent(),s=a.getTemplate("queries-elements"),n=a.getTemplate("queries-empty-elements"),u=$("#queries",o);$.when(a.dataService.getQueries({idElement:e})).done(function(e){u.empty(),(e=e||{}).length>=1?(i=null!=r?$.merge(r,e):e,t=$.tmpl(s,i,{checkChildNode:a.checkChildNode})):t=$.tmpl(n,i),t.appendTo(u),a.configureNavTree(u)})},configureNavTree:function(e){var r=this,t=r.getTemplate("queries-query-confirm");$("li","#queries").click(function(){var e=$(this).children("#idCube").val(),t=$(this).children("#queryId").val(),i=$(this).children("#prefix").val(),a=$(this).children("#nodesLength").val(),o=$(this).children("#idStoredQuery").val(),s=$(this).children("#id").val(),n=$(this).children("#queryDisplayName").val(),u=r.getTemplate("queries-query-tree"),d=$("#categoryTree");if("-1"==t)$.tmpl(u,{idParentQuery:s,queryDisplayName:n}).appendTo(d),r.configureTreeNavigation(),r.renderQueries(s);else if(a>0)$.tmpl(u,{idParentQuery:s,queryDisplayName:n}).appendTo(d),r.configureTreeNavigation(),r.renderQueries(s,[{queryDisplayName:n,idStoredQuery:o,id:s,idParent:"",queryId:t,prefix:i,nodes:[],idCube:$(this).data("idcube"),categoryWithLink:"true"}]);else{bizagi.workportal.desktop.popup.closePopupInstance();var l=this.data("queryDisplayName");r.showQueryFormPopup({idQuery:t,idStoredQuery:"-1"==o?"":o,title:l,idCube:e})}}),$(".editButton","#queries").click(function(e){e.stopPropagation();var t=$(this).parent().find("#idStoredQuery").val();r.showQueryFormPopup({queryFormAction:"edit",idQuery:"-1",idStoredQuery:"-1"==t?"":t,title:$("#queryDisplayName",$(this).parent()).val()}),bizagi.workportal.desktop.popup.closePopupInstance()}),$(".deleteButton","#queries").click(function(e){e.stopPropagation();var i,a=$(this).parent().find("#idStoredQuery").val(),o=$(this).parent().find("#prefix").val(),s=$(this).parent().find("#idCube").val(),n=$.tmpl(t);"prefix_MyStoredQuery"==o?i=r.dataService.getUrl({endPoint:"query-form-delete"})+"?idStoredQueryDel="+a+"&idQueryForm=-1":"prefix_Cube"==o&&(i=r.dataService.getUrl({endPoint:"query-form-delete-cube"})),$(n).dialog({resizable:!0,modal:!0,title:r.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:r.getResource("workportal-widget-queries-confirm-delete"),click:function(){"prefix_MyStoredQuery"==o?$.ajax({url:i}):"prefix_Cube"==o&&$.destroy(i,{idCube:s}),$(this).dialog("close"),bizagi.workportal.desktop.popup.closePopupInstance()}},{text:r.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})})},configureBackButton:function(){var e=this,r=e.getContent(),t=$("#bt-back",r),i=$("#categoryTree",r);t.click(function(){if($("li",i).length>1){$("li:last-child",i).remove();var r=$("li:last-child").children("#idParent").val();e.renderQueries(r)}})},configureTreeNavigation:function(){var e=this,r=e.getContent(),t=$("#categoryTree",r);$("li:last-child",t).click(function(){$(this).nextAll().remove();var r=$(this).children("#idParent").val();e.renderQueries(r)})},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(e){var r=e.idQuery||"",t=e.idStoredQuery||"",i=e.queryFormAction||"",a=e.title||"",o=e.idCube||"";"queryform"!=this.currentPopup?(this.currentPopup="queryform",this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,idQueryForm:r,idStoredQuery:t,queryFormAction:i,idCube:o,modalParameters:{title:a,id:"Queries"}})):bizagi.workportal.desktop.popup.closePopupInstance()}}),bizagi.workportal.widgets.queries.extend("bizagi.workportal.widgets.queries.definition",{},{init:function(e,r,t){this._super(e,r,t),this.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),"queries-definition-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-elements"),"queries-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-flat-list"),"queries-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-message-error"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.mainTemplate=e.getTemplate("queries-definition-elements"),e.emptyTemplate=e.getTemplate("queries-empty-elements"),e.flatListTemplate=e.getTemplate("queries-flat-list"),e.confirmTemplate=e.getTemplate("queries-query-confirm"),e.messageErrorTemplate=e.getTemplate("queries-query-message-error")},postRender:function(){this.configureTreeNavigation("#queries"),this.renderQueries(),this.scrollVertical({autohide:!1})},renderQueries:function(e,r){var t,i,a=this,o=a.getContent(),s=a.mainTemplate,n=a.emptyTemplate,u=$("#queries",o);$.when(a.dataService.getQueriesDefinitions({idNode:e})).done(function(o){u.empty(),(o=o||{}).length>=1?(i=void 0!==r?$.merge(r,o):o,t=$.tmpl(s,i,{checkChildNode:a.checkChildNode})):t=$.tmpl(n,i),void 0===e||"-1"===e?$.when(a.dataService.getStoredQueryFormList()).done(function(e){if(t.appendTo(u),e.storedQueryForms.length>0){var r=$.tmpl(s,{queryType:"-2",queryDisplayName:a.getResource("workportal-widget-queries-stored-query-forms"),nodes:[],guidForm:"stored"});$.merge(t,r).appendTo(u),a.storedQueryForm=e.storedQueryForms}a.configureNavTree(u)}):t.appendTo(u),a.configureNavTree(u)})},renderStoredQueries:function(){var e=this.getContent(),r=this.flatListTemplate,t=$("#queries",e);$.tmpl(r,{storedQueryForm:this.storedQueryForm}).appendTo(t)},configureNavTree:function(e){var r=this;r.getTemplate("queries-query-confirm");$("li","#queries").click(function(){var e=$(this).children("#idNode").val(),t=($(this).children("#guidQueryForm").val(),$(this).children("#guidForm").val()),i=$(this).children("#guidContext").val(),a=$(this).children("#queryType").val(),o=$(this).children("#nodesLength").val(),s=$(this).children("#queryDisplayName").val(),n=r.getTemplate("queries-query-tree"),u=$("#categoryTree"),d=$(this).children("#notMigratedUrl").val();if("-2"==a)r.renderStoredQueries(),$.tmpl(n,{idParentQuery:"-2",queryDisplayName:s}).appendTo(u),r.configureTreeNavigation("#queries");else if(o>0)$.tmpl(n,{idParentQuery:e,queryDisplayName:s}).appendTo(u),r.configureTreeNavigation("#queries"),r.renderQueries(e);else{bizagi.workportal.desktop.popup.closePopupInstance();var l=$("#queryDisplayName",this).val();r.showQueryFormPopup({guidForm:t,guidEntity:i,title:l,queryFormAction:"renderQueryForm",queryType:a,notMigratedUrl:d})}}),$(".deleteGAButton").click(function(e){e.stopPropagation();var t=$.tmpl(r.confirmTemplate),i={resizable:!0,modal:!0,title:r.getResource("workportal-widget-queries-confirm-title"),buttons:[]},a=$("#notMigratedUrlDelete",$(this).parent()).val();i.buttons=[{text:r.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close"),a&&$.destroy(a),bizagi.workportal.desktop.popup.closePopupInstance()}},{text:r.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}],$(t).dialog(i)})},configureTreeNavigation:function(e){var r=this,t=r.getContent(),i=$("#categoryTree",t),a=$(e,t);$("li:last-child",i).click(function(){$(this).nextAll().remove();var e=$(this).children("#idParent").val();"-2"==e?r.renderStoredQueries():r.renderQueries(e)}),$("li.storedQuery",a).click(function(){var e,t=$(this).data("guid"),i=($(this).data("id"),$(this).data("idnode")),a=$.grep(r.storedQueryForm,function(e){return e.idNode==i});1==a.length&&(e=a[0],r.showQueryFormPopup({idStoredQuery:t,idQuery:1,title:e.definition.name,paramsStoredQuery:e,queryFormAction:"execute",notMigratedUrl:e.notMigratedUrl?e.notMigratedUrl.execute:""}))}),$(".editButton",e).click(function(e){e.stopPropagation();$(this).parent().data("guid");var t,i=$(this).parent().data("id"),a=$(this).parent().data("idnode"),o=$.grep(r.storedQueryForm,function(e){return e.idNode==a});1==o.length&&(t=o[0],r.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:"-1"==i?"":i,paramsStoredQuery:t,title:t.definition.name,notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.edit:""}),bizagi.workportal.desktop.popup.closePopupInstance())}),$(".deleteButton",e).click(function(e){e.stopPropagation();$(this).parent().data("guid");var t,i,a,o=$(this).parent().data("id"),s=$(this).parent().data("idnode"),n=r.getResource("workportal-widget-admin-entities-message-migrate");n=n.replace("{build}",bizagi.loader.productBuildToAbout);var u=$.grep(r.storedQueryForm,function(e){return e.idNode==s});1==u.length&&(i=u[0],a={resizable:!0,modal:!0,title:r.getResource("workportal-widget-queries-confirm-title"),buttons:[]},null!==bizagi.cookie("JSESSIONID")&&i.notMigratedUrl?t=$.tmpl(r.messageErrorTemplate,{messageError:n}):(t=$.tmpl(r.confirmTemplate),a.buttons=[{text:r.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close"),i.notMigratedUrl&&i.notMigratedUrl.delete?$.get("App/"+i.notMigratedUrl.delete):r.dataService.deleteStoredQueryForm({idStoredQueryForm:o}),bizagi.workportal.desktop.popup.closePopupInstance(),r.publish("refreshQueryFormShortCut")}},{text:r.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]),$(t).dialog(a))})},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(e){var r=this,t=e.queryFormAction||"",i=e.title||"",a=e.queryType||"",o=e.guidForm||"",s=e.guidEntity||"",n=e.paramsStoredQuery||{};"queryform"!=r.currentPopup?(r.currentPopup="queryform",r.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,queryFormAction:t,queryType:a,paramsStoredQuery:n,modalParameters:{title:i,id:"Queries"},closeVisible:!1,guidForm:o,guidEntity:s,notMigratedUrl:e.notMigratedUrl||"",maximizeOnly:!0,editQueryForm:function(e){r.currentPopup=void 0,r.showPopUpEditQueryForm(e)},executeQueryForm:function(e){r.currentPopup=void 0,r.showPopUpResultsQueryForm(e)}})):bizagi.workportal.desktop.popup.closePopupInstance()},showPopUpEditQueryForm:function(e){var r=this;r.getContent();$.when(r.dataService.getStoredQueryFormList()).done(function(t){if(r.storedQueryForm=t.storedQueryForms,r.publish("refreshQueryFormShortCut"),e&&e.response){var i=e.response;r.editQueryForm(i)}})},showPopUpResultsQueryForm:function(e){var r=this;r.getContent();$.when(r.dataService.getStoredQueryFormList()).done(function(t){if(r.storedQueryForm=t.storedQueryForms,r.publish("refreshQueryFormShortCut"),e&&e.response){var i=e.response;r.executeQueryForm(i)}})},editQueryForm:function(e){var r=this.getParamsStoredQuery(e);1==r.length&&(r=r[0],this.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:"-1"==e?"":e,paramsStoredQuery:r,title:r.definition.name,notMigratedUrl:r.notMigratedUrl?r.notMigratedUrl.edit:""}))},executeQueryForm:function(e){var r=this.getParamsStoredQuery(e);1==r.length&&(r=r[0],this.showQueryFormPopup({idStoredQuery:r.guid,idQuery:1,title:r.definition.name,paramsStoredQuery:r,queryFormAction:"execute",notMigratedUrl:r.notMigratedUrl?r.notMigratedUrl.execute:""}))},getParamsStoredQuery:function(e){return $.grep(this.storedQueryForm,function(r){return r.id==e})}}),bizagi.workportal.widgets.queries.definition.extend("bizagi.workportal.widgets.queries.shortcut",{},{init:function(e,r,t){this._super(e,r,t),this.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),"queries-definition-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-elements"),"queries-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-flat-list"),"queries-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-message-error"),"queries-shortcut":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-shortcut"),"queries-shortcut-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-flat-list-shortcut"),"queries-shortcut-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-confirm-shortcut"),"queries-shortcut-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-message-error-shortcut"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.flatListTemplate=e.getTemplate("queries-shortcut-flat-list"),e.confirmTemplate=e.getTemplate("queries-shortcut-query-confirm"),e.messageErrorTemplate=e.getTemplate("queries-shortcut-query-message-error")},postRender:function(){var e=this.getTemplate("queries-shortcut");this.content=$.tmpl(e);this.handleEvents(),bizagi.workportal.widgets.queries.shortcut.instance=this},handleEvents:function(){var e=this;$("#queryFormShortcutContainer").show(),$("#queryFormShortcutContainer").click(function(){var r=$("#queryFormShortcut"),t=$(this).find("span");!!r.is(":hidden")?(r.show(),t.removeClass("Right"),t.addClass("Down"),e.renderStoredQueries()):(r.hide(),t.removeClass("Down"),t.addClass("Right"))})},configureTreeNavigation:function(){var e=this,r=($("#categoryTree",e.content),$("#queries-shortcut",e.content));$("li.storedQuery",r).click(function(){var r,t=$(this).data("guid"),i=($(this).data("id"),$(this).data("idnode")),a=$.grep(e.storedQueryForm,function(e){return e.idNode==i});1==a.length&&(r=a[0],e.showQueryFormPopup({idStoredQuery:t,idQuery:1,title:r.definition.name,paramsStoredQuery:r,queryFormAction:"execute",notMigratedUrl:r.notMigratedUrl?r.notMigratedUrl.execute:""})),e.currentPopup=void 0}),$(".bz-icon-pencil-outline","#queries-shortcut").click(function(r){$(this).closest(".storedQuery").data("guid");var t,i=$(this).closest(".storedQuery").data("id"),a=$(this).closest(".storedQuery").data("idnode"),o=$.grep(e.storedQueryForm,function(e){return e.idNode==a});1==o.length&&(t=o[0],e.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:"-1"==i?"":i,paramsStoredQuery:t,title:t.definition.name,notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.edit:""}),bizagi.workportal.desktop.popup.closePopupInstance())}),$(".bz-icon-close","#queries-shortcut .bz-shorcut__icons").click(function(r){r.stopPropagation();$(this).closest(".storedQuery").data("guid");var t,i,a,o=$(this).closest(".storedQuery").data("id"),s=$(this).closest(".storedQuery").data("idnode"),n=e.getResource("workportal-widget-admin-entities-message-migrate");n=n.replace("{build}",bizagi.loader.productBuildToAbout);var u=$.grep(e.storedQueryForm,function(e){return e.idNode==s});1==u.length&&(i=u[0],a={resizable:!0,modal:!0,title:e.getResource("workportal-widget-queries-confirm-title"),buttons:[]},null!==bizagi.cookie("JSESSIONID")&&i.notMigratedUrl?t=$.tmpl(e.messageErrorTemplate,{messageError:n}):(t=$.tmpl(e.confirmTemplate),a.buttons=[{text:e.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close"),i.notMigratedUrl&&i.notMigratedUrl.delete?$.get("App/"+i.notMigratedUrl.delete):$.when(e.dataService.deleteStoredQueryForm({idStoredQueryForm:o})).done(function(){bizagi.workportal.desktop.popup.closePopupInstance(),e.renderStoredQueries()}),e.renderStoredQueries(),bizagi.workportal.desktop.popup.closePopupInstance()}},{text:e.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]),$(t).dialog(a))})},renderStoredQueries:function(e){var r=this,t=r.flatListTemplate,i=$("#queries-shortcut",r.content);$.when(r.dataService.getStoredQueryFormList()).done(function(e){r.storedQueryForm=e.storedQueryForms,$.tmpl(t,{storedQueryForm:r.storedQueryForm}).appendTo(i),r.configureTreeNavigation(),r.storedQueryForm.length<=0?$("#queryFormShortcutContainer").hide():$("#queryFormShortcutContainer").show()})}}),bizagi.workportal.widgets.queryform.extend("bizagi.workportal.widgets.queryform",{},{init:function(e,r,t){this._super(e,r,t),this.loadTemplates({queryform:bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-frankenstein-queryform-wrapper"),"queryform-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-wrapper"),"queryform-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-container"),"queryform-buttons":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-buttons"),"queryform-graphic-analysis":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-graphic-analysis"),"queryform-result-set":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-result-set"),"queryform-search-result":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-search-result"),"queryform-pagination":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-pagination"),"queryform-admin-result":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-admin-result"),"queryform-share-selection":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-share-selection"),"queryform-select-user":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-select-user"),"queryform-select-group":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-select-group"),"queryform-save-as":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-save-as"),"queryform-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform--message-error"),useNewEngine:!1}),bizagi.referrerParams.referrer=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM},postRender:function(){var e=this;"true"==e.params.notMigratedUrl&&(e.params.notMigratedUrl=Boolean(e.params.notMigratedUrl)),""==e.params.notMigratedUrl||1==e.params.notMigratedUrl?e.modifiedPostRender():e.frankensteinPostRender()},loadtemplates:function(){var e=this;e.container=e.getTemplate("queryform-container"),e.buttons=e.getTemplate("queryform-buttons"),e.graphicalAnalysisContainer=e.getTemplate("queryform-graphic-analysis"),e.resultSet=e.getTemplate("queryform-result-set"),e.searchResult=e.getTemplate("queryform-search-result"),e.paginationTmpl=e.getTemplate("queryform-pagination"),e.adminResult=e.getTemplate("queryform-admin-result"),e.selectUser=e.getTemplate("queryform-select-user"),e.selectGroup=e.getTemplate("queryform-select-group"),e.shareSelection=e.getTemplate("queryform-share-selection"),e.dialogSaveAs=e.getTemplate("queryform-save-as")},modifiedPostRender:function(){var e=this,r=e.getContent();if(e.maxElemShow=10,e.maxPageToShow=5,e.atLeastOneChecked=!1,e.selectedItemsToShare={users:[],groups:[]},e.readyToSave=!1,e.includeAllUsers=!1,e.saveAs=!1,e.sortedField={},e.storedQueryFormParameters={},e.dialogSaveAs=$.tmpl(e.dialogSaveAs),e.orderType={ASC:"ASC",DESC:"DESC",NONE:"NONE"},e.queryFormContextTypes={CASES:"metadata",ENTITY:"entity"},e.queryFormTypes={CASES:"CASES",ENTITY:"ENTITIES"},1==e.params.notMigratedUrl||1==e.params.paramsStoredQuery.notMigratedUrl){var t=e.getResource("workportal-widget-admin-entities-message-migrate");t=t.replace("{build}",bizagi.loader.productBuildToAbout);var i=$.tmpl(e.getTemplate("queryform-message-error"),{messageError:t});return $(r).html(i),!1}switch(e.params.queryFormAction){case"edit":e.guidEntity=e.params.paramsStoredQuery.definition.entityGuid,e.guidForm=e.params.paramsStoredQuery.guid,e.queryFormType=e.params.paramsStoredQuery.definition.type,e.idQueryForm=e.params.paramsStoredQuery.id,e.renderQueryForm(),e.showSaveResultsForm(),e.previousValues(e.params.paramsStoredQuery);break;case"renderQueryForm":e.guidForm=e.params.guidForm,e.guidEntity=e.params.guidEntity,1==e.params.queryType?e.queryFormType=e.queryFormTypes.CASES:2==e.params.queryType&&(e.queryFormType=e.queryFormTypes.ENTITY),e.renderQueryForm();break;case"submitQueryForm":case"graphicalAnalysis":!function(){"string"==typeof e.params.queryParams.parameters&&(e.params.queryParams.parameters=JSON.parse(e.params.queryParams.parameters)),e.initialSearchParams=e.params.queryParams;var t=e.params.pageToShow||1;e.contextType=e.params.widget.contextType,e.guidForm=e.params.widget.guidForm,e.guidEntity=e.params.widget.guidEntity,e.queryForm=e.params.queryForm,1==e.params.queryType?e.queryFormType=e.queryFormTypes.CASES:2==e.params.queryType&&(e.queryFormType=e.queryFormTypes.ENTITY),e.handleEvents(),e.findResults(e.getContent(),e.params.queryParams,t),$("#copy-as-new-stored-queryform",r).hide(),$("#update-stored-queryform",r).hide(),$("#edit-stored-queryform",r).hide()}();break;case"execute":!function(){bizagi.referrerParams.queryForm={actionForm:"execute",data:e.params},e.guidEntity=e.params.paramsStoredQuery.definition.entityGuid,e.guidForm=e.params.paramsStoredQuery.guid,e.queryFormType=e.params.paramsStoredQuery.definition.type,e.includeAllUsers=e.params.paramsStoredQuery.definition.includeAllUsers,e.idQueryForm=e.params.paramsStoredQuery.id;var t={numberOfRows:10,pageNumber:1,queryFormGuid:e.params.paramsStoredQuery.guid,entityGuid:e.params.paramsStoredQuery.definition.entityGuid,type:e.params.paramsStoredQuery.definition.type,parameters:e.params.paramsStoredQuery.definition.parameters,ownerQuery:e.params.paramsStoredQuery.owner,includeAllUsers:e.params.paramsStoredQuery.definition.includeAllUsers};e.handleEvents(),e.initialSearchParams=JSON.parse(JSON.stringify(t)),e.queryFormType==e.queryFormTypes.CASES?e.contextType=e.queryFormContextTypes.CASES:e.queryFormType==e.queryFormTypes.ENTITY&&(e.contextType=e.queryFormContextTypes.ENTITY);var i={h_action:"QUERYFORM",h_contexttype:e.contextType,h_idForm:e.guidForm};$("#query-form-buttons",r).hide(),e.dataService.getQueryForm(i).done(function(i){e.queryFormElements=i.form.elements,e.findResults(r,t)}),$("#copy-as-new-stored-queryform",r).hide(),$("#update-stored-queryform",r).hide(),$("#edit-stored-queryform",r).show()}()}},renderQueryForm:function(e){var r=this,t=r.getContent();r.queryFormType==r.queryFormTypes.CASES?r.contextType=r.queryFormContextTypes.CASES:r.queryFormType==r.queryFormTypes.ENTITY&&(r.contextType=r.queryFormContextTypes.ENTITY);var i={h_action:"QUERYFORM",h_contexttype:r.contextType,h_idForm:r.guidForm};r.idQueryForm&&""!=r.idQueryForm&&(i.h_idqueryform=r.idQueryForm);var a=$.tmpl(r.container);r.dataService.getQueryForm(i).done(function(i){var o={canvas:a,data:i,type:"queryForm"};r.queryFormElements=i.form.elements,bizagi.loader.startAndThen("rendering").then(function(){var i=new bizagi.rendering.facade;i.execute(o).done(function(){if(r.queryForm=i.form,r.queryForm.properties&&void 0!==r.queryForm.properties.includeAllUsers&&(r.includeAllUsers=r.queryForm.properties.includeAllUsers),$("#query-form",t).html(a),r.validateRequireField(),$("#queryFormName",t).keyup(function(){r.validateRequireField()}),r.handleEvents(),$("#query-form",t).show(),$("#query-form-result",t).hide(),$("#mainButtons",t).css("width","100%"),$("#exportExcel",t).hide(),$("#graphicalAnalysis",t).hide(),$("#back-to-queryform",t).hide(),$("#save-queryform",t).hide(),e&&(r.setXpathValuesToQueryForm(r.queryForm,e),$("#query-form-admin-result",t).hide(),$("#copy-as-new-stored-queryform",t).hide(),$("#update-stored-queryform",t).hide(),$("#edit-stored-queryform",t).hide()),"renderQueryForm"==r.params.queryFormAction)$("#query-form-admin-result",t).hide(),$("#copy-as-new-stored-queryform",t).hide(),$("#update-stored-queryform",t).hide(),$("#edit-stored-queryform",t).hide();else if("edit"==r.params.queryFormAction){var o=r.params.paramsStoredQuery.definition.parentQueryForm||r.params.paramsStoredQuery.definition.name;$("#queryFormFieldsContainerName span",t).html(o),$("#queryFormFieldsContainer",t).html(a),$("#submit-for-search",t).hide(),$("#clear-queryform",t).hide(),$("#copy-as-new-stored-queryform",t).show(),$("#update-stored-queryform",t).show(),$("#edit-stored-queryform",t).hide()}})})})},setXpathValuesToQueryForm:function(e,r){var t;r=r||{};try{var i="string"==typeof r.parameters?JSON.parse(r.parameters):r.parameters;$.each(i,function(r,i){(t=e.getRender(i.xpath)).setValue(i.value),t.setDisplayValue(i.value)})}catch(e){console.log("Error:",e)}},handleEvents:function(){var e=this,r=e.getContent(),t={I_PROCESSSTATE:"ALL",h_idEnt:10001};t.h_idQueryForm=e.idQueryForm,$("#query-form-buttons",r).html($.tmpl(e.buttons,t)),$("#back-to-queryform",r).click(function(){if("execute"==e.params.queryFormAction)e.renderQueryForm();else if($("#iframeGraphicalAnalysis",r).hide(),$("#query-form-admin-result",r).hide(),"saveQueryForm"==e.params.queryFormAction)e.params.queryFormAction="renderQueryForm",$("#query-form-result",r).show(),$("#back-to-queryform",r).show(),$("#save-queryform",r).show(),$("#exportExcel",r).show(),$("#graphicalAnalysis",r).show();else{e.sortedField={},$("#query-form-result",r).hide(),$("#query-form",r).show(),e.enableButton($("#submit-for-search",e.getContent()));var t=$(this).closest(".ui-dialog"),i=t.length?t.find(".ui-dialog-content"):[];if(t.height()===i.height()&&i.height(440),e.originalHeight&&r.parent().height(e.originalHeight),$("#back-to-queryform",r).hide(),$("#submit-for-search",r).show(),$("#clear-queryform",r).show(),$("#save-queryform",r).hide(),$("#exportExcel",r).hide(),$("#graphicalAnalysis",r).hide(),"submitQueryForm"==e.params.queryFormAction&&e.params.widget&&e.params.recalculateQueryForm)e.params.widget.searchParams=e.params.widget.searchParams||{},e.renderQueryForm(e.params.widget.searchParams);else if("graphicalAnalysis"==e.params.queryFormAction){e.params.queryFormAction="submitQueryForm";var a={queryFormGuid:e.guidForm,numberOfRows:10,pageNumber:1,entityGuid:e.guidEntity,type:e.queryFormType,includeAllUsers:e.includeAllUsers,parameters:[]},o=e.queryForm.getSearchParams(a);e.submitQueryForm(o)}}e.readyToSave=!1}),$("#clear-queryform",r).click(function(){e.params.queryFormAction="renderQueryForm",e.renderQueryForm()}),$("#submit-for-search",r).click(function(){e.params.queryFormAction="submitQueryForm";var r={queryFormGuid:e.guidForm,numberOfRows:10,pageNumber:1,entityGuid:e.guidEntity,type:e.queryFormType,includeAllUsers:e.includeAllUsers,parameters:[],onlyLocalResults:!0},t=e.queryForm.getSearchParams(r);null!==t&&(e.disableButton($(this)),e.submitQueryForm(t))}),$(".ui-bizagi-render-control-included",r).tooltip({content:bizagi.localization.getResource("workportal-widget-query-form-included-tooltip")}),$("#save-queryform",r).click(function(){e.readyToSave?e.createStoredQueryForm():e.showSaveResultsForm(),e.params.queryFormAction="saveQueryForm",$("#exportExcel",r).hide(),$("#graphicalAnalysis",r).hide(),$("#mainButtons",r).css("width","100%")}),$("#copy-as-new-stored-queryform",r).click(function(){e.saveAs=!0,$(e.dialogSaveAs).dialog({resizable:!0,modal:!0,title:e.getResource("workportal-widget-query-form-copy-as-new"),buttons:[{text:e.getResource("workportal-general-button-label-ok"),click:function(){e.createStoredQueryForm()&&($(this).dialog("destroy"),bizagi.workportal.desktop.popup.closePopupInstance())}},{text:e.getResource("workportal-widget-queries-confirm-cancel"),click:function(){e.saveAs=!1,$(this).dialog("destroy")}}]})}),$("#update-stored-queryform",r).click(function(){e.updateStoredQueryForm()}),$("#edit-stored-queryform",r).click(function(){e.publish("closeCurrentDialog"),e.params.editQueryForm({response:e.params.paramsStoredQuery.id,fromExec:!0})}),$(".biz-wp-form-queryForm-graphicalAnalysisLink",r).click(function(){var t;e.params.queryFormAction="graphicalAnalysis","string"==typeof e.searchParams.parameters&&(e.searchParams.parameters=JSON.parse(e.searchParams.parameters)),t=e.params.paramsStoredQuery.definition?JSON.stringify(e.params.paramsStoredQuery.definition):JSON.stringify({name:"name",description:"desc",parameters:e.searchParams.parameters,type:e.queryFormType,entityGuid:e.guidEntity,includeAllUsers:e.includeAllUsers,parentQueryForm:e.queryForm.properties.displayName});var i=e.params.paramsStoredQuery.id?e.params.paramsStoredQuery.guid:e.params.guidForm,a=$.tmpl(e.graphicalAnalysisContainer,{h_guidQueryForm:i,h_idStoredQuery:e.params.paramsStoredQuery.id,h_definition:t});$("#query-form-result",r).html(a),$("#exportExcel",r).hide(),$("#graphicalAnalysis",r).hide(),$("#mainButtons",r).show(),$("#mainButtons",r).css("width","99%"),$("#save-queryform",r).hide(),e.originalHeight=r.parent().height(),r.parent().height("auto"),$("#formGraphicalAnalysis").delay(800).submit();var o=$("#iframeGraphicalAnalysis"),s=o.length?o.closest(".ui-dialog"):[],n=s.length?s.height():0;function u(){var e=$("#iframeGraphicalAnalysis"),r=$(this),t=r.length?r.height():0;t>550?e.height(t-100):(e.height(400),r.find(".ui-dialog-content").height("auto"))}n>550&&o.height(n-100),s.on("dialogmaximize",u),s.on("dialogunmaximize",u)}),$(".biz-wp-form-queryForm-exportExcelLink",r).click(function(){var r={entityGuid:e.guidEntity,type:e.queryFormType,includeAllUsers:e.includeAllUsers,parameters:[]},t=e.sortedField.xpath,i=e.sortedField.orderType,a=!1,o=JSON.parse(JSON.stringify(e.initialSearchParams.parameters));(o="array"===$.type(o)?o:JSON.parse(o)).length>0&&void 0!==t&&$.each(o,function(e,r){r.xpath==t&&(r.orderType=i,a=!0)}),a||""==t||void 0===t||o.push({value:null,included:!0,xpath:t,searchType:"NONE",orderType:i}),r.parameters=o;var s=e.refactorParameters(r),n=bizagi.cookie("JSESSIONID");null!=n&&(s.p_sessionId=n),e.dataService.getQueryFormExportExcel(s).done(function(){})})},disableButton:function(e){var r=this,t=r.getContent();$(".ui-bizagi-render-control-included:checked",t).size();(r.queryFormType==r.queryFormTypes.ENTITY&&r.atLeastOneChecked||r.queryFormType==r.queryFormTypes.CASES)&&e.attr("disabled",!0).addClass("ui-button-disabled")},enableButton:function(e){e.removeAttr("disabled").removeClass("ui-button-disabled")},submitQueryForm:function(e){var r=this,t=r.getContent(),i=$(".ui-bizagi-render-control-included:checked",t).size();r.atLeastOneChecked=i>0,null!==e&&(r.queryFormType==r.queryFormTypes.ENTITY&&r.atLeastOneChecked||r.queryFormType==r.queryFormTypes.CASES?(r.initialSearchParams=JSON.parse(JSON.stringify(e)),r.findResults(t,e)):(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-query-form-at-least-one-checked"),"Bizagi","warning"),r.enableButton($("#submit-for-search",r.getContent()))))},findResults:function(e,r,t){var i=this,a=(e=i.getContent(),$(".js-mini-loading",e));t&&(i.params.pageToShow=t),i.params.queryParams=r,bizagi.referrerParams.queryForm={actionForm:i.params.queryFormAction,data:i.params,queryParams:r,pageToShow:t,queryForm:i.queryForm},i.searchParams=JSON.parse(JSON.stringify(r)),(r=i.refactorParameters(r)).pageNumber=t||1,bizagiConfig.groupByCaseNumber&&(r.group="T_RADNUMBER"),a.show();var o=new bizagi.workportal.command.security(i.dataService);$.when(i.dataService.getQueryFormResponse(r),o.checkSecurityPerm("GraphicQuery"),o.checkSecurityPerm("TimeLine")).done(function(t,o,s){t=t[0],a.hide();var n=i.validateSecurityOptionIcons(t,o,s);$(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),i.totalRecords=t.records,i.totalPages=t.total,t.rows.length>0?(i.showSearchResultFrame(e,t,r,n),$("#query-form-buttons",e).show()):(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-query-form-no-records-found"),"Bizagi","warning"),i.enableButton($("#submit-for-search",i.getContent())),"execute"===i.params.queryFormAction&&(i.params.queryFormAction="edit",i.modifiedPostRender()))}).fail(function(e){a.hide(),bizagi.log(e)})},validateSecurityOptionIcons:function(e,r,t){var i=bizagi.override.enableFeatureShowTimelineButton&&t,a=-1;return r||i?i&&e.rows.length>0&&(a=e.rows[0].findIndex(function(e){return!(!e||"object"!=typeof e||!e.radNumber)}))>-1&&e.rows.forEach(function(e){null!=e[e.length-1]&&(e[e.length-1].radNumber=e[a].radNumber)}):e.header&&e.header.length&&0===e.header[e.header.length-1].dataType&&(e.header.splice(-1,1),e.rows.forEach(function(e){e.splice(-1,1)})),{graphicQuery:r,timeline:i}},checkDisplayedNames:function(e){var r=this;return"string"==typeof r.initialSearchParams.parameters&&(r.initialSearchParams.parameters=JSON.parse(r.initialSearchParams.parameters)),"string"==typeof r.searchParams.parameters&&(r.searchParams.parameters=JSON.parse(r.searchParams.parameters)),$.each(e.header,function(e,t){if(t.xpath){var i=r.getRenderElementDisplayByXpath(t.xpath,r.queryFormElements);if(i){if(r.initialSearchParams&&r.initialSearchParams.parameters)for(e=0;e<r.initialSearchParams.parameters.length;e++){var a=r.initialSearchParams.parameters[e],o=r.searchParams.parameters[e],s=a.xpath+"."+a.displayXpath,n={};if(r.params.paramsStoredQuery.definition&&(n=r.params.paramsStoredQuery.definition.parameters[e]),a.xpath===t.xpath||s===t.xpath){o.displayHeader=i,a.displayHeader=i,n.displayHeader=i,r.searchParams.parameters[e].displayName=i;break}}t.displayName=i}}}),e},getRenderElementDisplayByXpath:function(e,r){if(r&&r.length>0)for(var t=0,i=r.length;t<i;t++){var a=r[t];if(void 0!==a.render){var o=void 0===a.render.properties.included||a.render.properties.included,s=a.render.properties.xpath,n=a.render.properties.xpath+"."+a.render.properties.displayXpath;if(o&&(s===e||n===e))return a.render.properties.displayName}else if(void 0!==a.container){var u=this.getRenderElementDisplayByXpath(e,a.container.elements);if(null!=u)return u}}},refactorParameters:function(e){var r=[];return"string"==typeof e.parameters&&(e.parameters=JSON.parse(e.parameters)),$.each(e.parameters,function(e,t){null!=t.value&&"object"==typeof t.value&&t.value[0]&&void 0!==t.value[0].id&&(t.value=t.value[0].id),r.push(t)}),e.parameters=JSON.stringify(r),e},showSearchResultFrame:function(e,r,t,i){var a=this;a.queryFormElements=a.queryFormElements?a.queryFormElements:bizagi.referrerParams.queryForm.queryForm.params.data.elements,bizagi.referrerParams&&bizagi.referrerParams.queryForm&&bizagi.referrerParams.queryForm.queryForm&&bizagi.referrerParams.queryForm.queryForm.params&&bizagi.referrerParams.queryForm.queryForm.params.data&&(bizagi.referrerParams.queryForm.queryForm.params.data.elements=a.queryFormElements),r=a.checkDisplayedNames(r);var o,s=$.tmpl(a.searchResult,{headers:r.header,rows:r.rows,sortedField:a.sortedField.xpath?a.sortedField:null,records:r.records,groupByCaseNumber:bizagiConfig.groupByCaseNumber,securityGraphicQuery:bizagi.menuSecurity.GraphicQuery,resultList:r,enabledIcons:i},{getRadNumberColumnIndex:function(){for(var e=this.data,r=-1,t=0,i=e.headers.length;t<i;t++)"radnumber"==e.headers[t].fieldName&&(r=t);return r},showColumn:function(e){var r=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&r==e?" hidden ":""},createGroupedHeader:function(e){var r=this.data.resultList,t=!1,i=this.getRadNumber(r.rows[e]);this.data.groupByCaseNumber&&(0==e&&""!=i?t=!0:i!=this.getRadNumber(r.rows[e-1])&&""!=i&&(t=!0));return t},getRadNumber:function(e){var r=this.getRadNumberColumnIndex();return r>=0?e[r].radNumber:""},formatValue:function(e,r){return bizagi.util.formatValueByDataType(e,r)},isIEAndFirstRowAndGroupCases:function(e){return 0==e&&this.data.groupByCaseNumber&&bizagi.util.isIE()}}),n=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,u=$("#biz-wp-table-pager-wrapper",s),d={};d.pagination=a.totalPages>1,d.page=r.page,d.pages={};for(var l=1;l<=n;l++)d.pages[l]={pageNumber:l};o=$.tmpl(a.paginationTmpl,d).html(),u.append(o),$("#submit-for-search",e).hide(),$("#clear-queryform",e).hide(),$("#save-queryform",e).show(),r.permissions&&r.permissions.canExportData&&$("#exportExcel",e).show(),$("#mainButtons",e).css("width","100%"),$("#query-form",e).hide(),$("#query-form-result",e).show(),$("#query-form-result",e).html(s),$("#back-to-queryform",e).show(),r.permissions&&r.permissions.canAnalizeData?$("#graphicalAnalysis",e).show():$("#graphicalAnalysis",e).remove(),"execute"==a.params.queryFormAction&&($("#back-to-queryform",e).hide(),$("#save-queryform",e).hide()),0==t.ownerQuery&&$("#edit-stored-queryform",e).hide(),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:r.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(r){var t=$(".sortColumnsDataUpIcon, .sortColumnsDataDownIcon").parent().parent().last();if(0==t.length)a.findResults(e,a.initialSearchParams,r.page);else{var i=t.data("xpath"),o=null;null!=typeof a.sortedField.xpath&&a.sortedField.xpath==i&&(o=a.sortedField.orderType),null==o||o==a.orderType.DESC?a.findSortedResults(e,i,a.orderType.DESC,r.page):a.findSortedResults(e,i,a.orderType.ASC,r.page)}}}),$(".cases-column-header",e).click(function(r){var i=$(r.currentTarget).data("xpath"),o=null;null!=typeof a.sortedField.xpath&&a.sortedField.xpath==i&&(o=a.sortedField.orderType),null==o||o==a.orderType.DESC?a.findSortedResults(e,i,a.orderType.ASC,t.pageNumber):a.findSortedResults(e,i,a.orderType.DESC,t.pageNumber)}),$(".caseClicked",e).click(function(){a.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idcase"),idWorkItem:$(this)[0].getAttribute("data-idworkitem"),idTask:$(this)[0].getAttribute("data-idtask"),idWorkflow:$(this)[0].getAttribute("data-idworkflow")}),a.publish("closeCurrentDialog")}),$(".ui-bizagi-wp-app-inbox-grouped",e).bind("click",function(){var e=$(this).find("#idCase").val();a.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e}),a.publish("closeCurrentDialog")}),$(".js-show-graphic-query",e).click(function(){var e=$(this).data("idcase"),r=$(this).data("idworkflow");a.showGraphicQuery({idCase:e,idWorkflow:r})}),$(".js-show-timeline",e).click(function(){var e=$(this).data("idcase"),r=$(this).data("radnumber");a.showTimeLine({radNumber:r,idCase:e})}),a.setTableHeadFixed({TableElement:$("table",s),groupByCaseNumber:bizagiConfig.groupByCaseNumber,floatOptions:{position:"fixed",scrollContainer:function(){return $("#result-set-queryForm")}}})},applyFomatNumbers:function(e,r,t){var i=$("th[data-type='"+e+"']",r);$.each(i,function(e,t){var i=t.getAttribute("data-index");$(".biz-wp-table tr",r).find("td:eq("+i+")").find("span").addClass("formatMoney")}),bizagi.util.formatInvariantNumber(r,t)},findSortedResults:function(e,r,t,i){var a=!1,o=JSON.parse(JSON.stringify(this.initialSearchParams));if(o){var s=o.parameters;(s="array"===$.type(s)?s:JSON.parse(s)).length>0&&$.each(s,function(e,i){i.xpath==r&&(i.orderType=t,a=!0)}),a||""==r||void 0===r||s.push({value:null,included:!0,xpath:r,searchType:"NONE",orderType:t}),this.sortedField={xpath:r,orderType:t},o.parameters=s,this.findResults(e,o,i)}},previousValues:function(e){var r=this.getContent();$("#queryFormName",r).val(e.definition.name),$("#queryFormDescription",r).val(e.definition.description),this.selectedItemsToShare.users=e&&e.users?e.users:[],this.selectedItemsToShare.groups=e&&e.groups?e.groups:[]},createStoredQueryForm:function(){var e=this,r=e.buildStoredQueryFormParams();return null!=r&&($.when(e.dataService.saveStoredQueryForm(r)).done(function(r){e.publish("closeCurrentDialog"),e.readyToSave=!1,e.params.queryFormAction="renderQueryForm",0==$("#queryFormShortcut").has("#modalMenuBtList").length?$.when(e.workportalFacade.getWidget("queriesShortcut",{})).pipe(function(e){return widget=e,widget.render()}).done(function(){try{var t=widget.getContent();$("#queryFormShortcut").html(t),e.params.executeQueryForm(r)}catch(e){}}):e.params.executeQueryForm(r)}).fail(function(e){bizagi.log(e)}),!0)},closeQueryForm:function(){},updateStoredQueryForm:function(){var e=this,r=e.buildStoredQueryFormParams();return null!=r&&(r.id=e.idQueryForm,$.when(e.dataService.updateStoredQueryForm(r)).done(function(){e.readyToSave=!1,e.params.queryFormAction="renderQueryForm",e.renderQueryForm(),e.publish("refreshQueryFormShortCut")}).fail(function(e){bizagi.log(e)}),!0)},buildStoredQueryFormParams:function(){var e=this,r=e.getContent(),t={};if(t.users=JSON.stringify($.unique(e.selectedItemsToShare.users)),t.groups=JSON.stringify($.unique(e.selectedItemsToShare.groups)),"edit"==e.params.queryFormAction){e.searchParams=e.queryForm.getSearchParams({parameters:[]})}t.guid=e.guidForm;var i,a=$("#queryFormNameSaveAs",e.dialogSaveAs).val(),o=$("#queryFormName",r).val().trim();return!e.saveAs||null!=a&&""!=a?e.saveAs||null!=o&&""!=o?e.queryForm.validateForm()?("string"==typeof e.searchParams.parameters&&(e.searchParams.parameters=JSON.parse(e.searchParams.parameters)),t.definition=JSON.stringify({name:a||o,description:$("#queryFormDescriptionSaveAs",e.dialogSaveAs).val()?$("#queryFormDescriptionSaveAs",e.dialogSaveAs).val():$("#queryFormDescription",r).val(),parameters:e.searchParams.parameters,type:e.queryFormType,entityGuid:e.guidEntity,includeAllUsers:e.includeAllUsers,parentQueryForm:e.queryForm.properties.displayName}),t):void 0:((i=$("#queryFormName",r).next(".ui-bizagi-input-icon-error")).show(),i.tooltip({content:bizagi.localization.getResource("workportal-general-error-required")}),null):((i=$("#queryFormNameSaveAs").next(".ui-bizagi-input-icon-error")).show(),i.tooltip({content:bizagi.localization.getResource("workportal-general-error-required")}),null)},showSaveResultsForm:function(){var e=this,r=e.getContent();e.readyToSave=!0;var t=$.tmpl(e.adminResult,{});$("#tab_share",t).click(function(){e.initShareSelection(),$("#query-form").hide()}),$("#tab_definition",t).click(function(){"edit"===e.params.queryFormAction&&$("#query-form").show()}),$("input[type=radio][name=shareType]",t).change(function(){"users"==this.value?e.initShareSelection():"groups"==this.value&&$.when(e.searchGroupToShare()).done(function(){$("#userShare",e.shareSlection).hide()})}),$("#query-form",r).hide(),$("#query-form-result",r).hide(),$("#query-form-admin-result",r).show(),$("#query-form-admin-result",r).html(t),$("#admin-stored-query-form-wrapper",r).tabs(),$("#queryFormName",r).keyup(function(){e.validateRequireField()})},validateRequireField:function(){var e=$("#queryFormName").val();/([^\s])/.test(e)?$("#input-name-ui-bizagi-input-required").hide():$("#input-name-ui-bizagi-input-required").show()},initShareSelection:function(){var e=this,r=e.getContent(),t=$.tmpl(e.shareSelection,{}),i=e.selectedItemsToShare.users;$("#shareUsers",r).prop("checked",!0),$("#search_user",t).click(function(){e.searchUserToShare()}),$("#shareSelectionPanel",r).html(t),$("#move_left",r).click(function(){e.removeItem()}),$("#move_right",r).click(function(){e.addItem()}),i.length>0&&e.searchSavedUser()},searchUserToShare:function(){var e=this,r=e.getContent(),t={userName:$("#userName",r).val(),domain:$("#domain",r).val(),fullName:$("#fullName",r).val()};$.when(e.dataService.searchUsers(t)).done(function(r){var t=[];$.each(r.users,function(r,i){i&&$.inArray(i.idUser,e.selectedItemsToShare.users)<0&&t.push(i)}),e.showDataToShare(t,[])}).fail(function(e){bizagi.log(e)})},searchSavedUser:function(){var e=this,r=e.getContent(),t=$("input[type=radio][name=shareType]:checked",r).val();$.when(e.dataService.searchUsersByID(e.selectedItemsToShare.users)).done(function(i){$("#ListBoxResult",r).empty(),e.addPrevious(i,t)}).fail(function(e){bizagi.log(e)})},searchGroupToShare:function(){var e=this;return e.dataService.searchProfiles({profileType:11}).pipe(function(r){var t=[],i=[];$.each(r.response,function(r,a){a&&($.inArray(a.id,e.selectedItemsToShare.groups)<0?t.push(a):i.push(a))}),e.showDataToShare(t,i)})},showDataToShare:function(e,r){var t,i=this.getContent(),a=$("input[type=radio][name=shareType]:checked",i).val();"users"==a?t=$.tmpl(this.selectUser,{elementList:e}):(t=$.tmpl(this.selectGroup,{elementList:e}),$("#ListBoxResult",i).empty(),r.length>0&&this.addPrevious(r,a)),$("#ListBoxSource",i).replaceWith(t)},addPrevious:function(e,r){var t=this.getContent();"users"==r?$.each(e.users,function(e,r){$("#ListBoxResult",t).append(new Option(r.userName,r.idUser))}):$.each(e,function(e,r){$("#ListBoxResult",t).append(new Option(r.displayName,r.id))})},addItem:function(){var e=this,r=e.getContent(),t=$("input[type=radio][name=shareType]:checked",r).val(),i=$("#ListBoxSource option:selected",r);$.each(i,function(i,a){-1==$.inArray(a.value,e.selectedItemsToShare)?(e.selectedItemsToShare[t].push(a.value),$("#ListBoxSource option[value='"+a.value+"']",r).appendTo("#ListBoxResult")):$("#ListBoxSource option[value='"+a.value+"']",r).remove()}),$("#ListBoxResult option:selected").prop("selected",!1)},removeItem:function(){var e=this,r=e.getContent(),t=$("input[type=radio][name=shareType]:checked",r).val(),i=$("#ListBoxResult option:selected",r),a=$("#ListBoxSource option").toArray(),o=[];$.each(a,function(e,r){o.push(r.value)}),$.each(i,function(i,a){var s=a.value;-1==$.inArray(s,o)?$("#ListBoxResult option[value='"+s+"']",r).appendTo("#ListBoxSource"):$("#ListBoxResult option[value='"+s+"']",r).remove(),e.selectedItemsToShare[t].splice($.inArray(s,e.selectedItemsToShare[t]),1)}),$("#ListBoxSource option:selected").prop("selected",!1)},HTMLEncodeText:function(e){var r=e;return r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace("á","&aacute;")).replace("é","&eacute;")).replace("í","&iacute;")).replace("ó","&oacute;")).replace("ú","&uacute;")).replace("ñ","&ntilde;")).replace("Á","&Aacute;")).replace("É","&Eacute;")).replace("Í","&Iacute;")).replace("Ó","&Oacute;")).replace("Ú","&Uacute;")).replace("Ñ","&Ntilde;")},frankensteinPostRender:function(){var e=this,r=e.getContent(),t=$("#queryFormIFrame",r),i="",a="",o=[".ui-bizagi-old-render*","@font-face"];t.attr("frameborder",0),"object"==typeof o?$.each(o,function(e,r){i+=bizagi.getStyle(r),a+=r.replace(".","")+" "}):(i+=bizagi.getStyle(o),a+=o.replace(".","")),t.load(function(){var r=$(this).contents();r.find('input[name="btnReturn"]').css("display","none"),$("head",r).append("<style type='text/css'>"+i+"body, .ui-bizagi-old-render { overflow-y: visible;};</style>"),$("body",r).addClass(a.replace("*","")),$("body a.WPButton",r).parent().siblings().remove();var o=function(e){this.openBACase=function(r,t){var i=null,a=null;t.indexOf("idWorkitem=")>-1&&(i=(i=t.substring(t.indexOf("idWorkitem=")+11)).substring(0,i.indexOf("&"))),t.indexOf("idWorkflow=")>-1&&(a=t.substring(t.indexOf("idWorkflow=")+11)),e.controller.publish("executeAction",{action:e.routingAction,idCase:r,idWorkItem:i,idWorkflow:a,referrer:"queryform"});var o=document.getElementById("h_lastFullKey"),s=document.getElementById("h_lstCases");try{e.controller.dataService.lastQueryFullKey=o.value,e.bizagireference.referrerParams.referrer="queryform",e.bizagireference.lstIdCases=s.value.split(",")}catch(e){}for(var n=0;n<e.bizagireference.workportal.desktop.dialogStack.length;n++)e.controller.publish("closeCurrentDialog")},this.ShowCaseSumary=function(r){e.$.when(e.controller.dataService.getCaseFormsRenderVersion({idCase:r})).done(function(t){1==t.formsRenderVersion&&e.controller.publish("showDialogWidget",{widgetName:e.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:e.controller.dataService.serviceLocator.getUrl("old-render")+"?idCase="+r+"&isSummary=1",modalParameters:{title:e.controller.resources.getResource("workportal-widget-navigation-summary-case")},afterLoad:e.callBack,afterLoadParams:{routingAction:e.bizagireference.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,genericIframe:e.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,bizagi:e.bizagireference}})})}};t.callInside(o,{controller:e,routingAction:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,bizagireference:bizagi,callBack:o,$:jQuery})})}});
//# sourceMappingURL=../../../../Maps/desktop/queries.desktop.production.js.map
