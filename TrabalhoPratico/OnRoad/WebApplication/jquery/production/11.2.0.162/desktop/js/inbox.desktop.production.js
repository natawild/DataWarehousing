!function(e){e.fn.bizagiPagination=function(a){a=a||{};var t={limInf:0,totalPages:1,actualPage:1,listElement:e("ul"),first:"&lt;&lt;",firstClass:"first",prev:"&lt;",prevClass:"prev",next:"&gt;",nextClass:"next",last:"&gt;&gt;",lastClass:"last",liClass:"bz-page",arrowClass:"bz-pageArrow",selectedFocus:!0,clickCallBack:function(){}};a.actualPage>a.totalPages&&(a.actualPage=a.totalPages);var i={previousPage:t.actualPage>1?t.actualPage-1:1,nextPage:t.actualPage<t.totalPages?t.actualPage+1:t.totalPages};function o(a){a=a||1;var i=!1,o=e("li."+t.liClass+":first",t.listElement).data("page"),s=e("li."+t.liClass+":last",t.listElement).data("page");a<0&&o>1?i=!0:a>0&&s<t.totalPages&&(i=!0),i&&r(o,a)}function r(a,i){var o;if(a=a||1,(i=i||0)>0)o=a;else{if(!(i<0))return;o=a-2}e.each(e("li."+t.liClass,t.listElement),function(a,i){o++,e(this).data("page",o),e(this).find("span").html(o),e(this).attr("data-page",o),t.actualPage!=o||e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active")}),1==e(t.listElement).find(".active").length?e(t.listElement).parent().find("#tooltipPagination").css("visibility","hidden"):e(t.listElement).parent().find("#tooltipPagination").css("visibility","visible")}e.extend(t,t,a),function(){var a;if(t.totalElements=e("li."+t.liClass,t.listElement).length,t.totalPages>t.totalElements&&t.totalElements>1&&(t.listElement.prepend("<li/>").find("li:first").addClass(t.prevClass).data("page",i.previousPage).html(t.prev),t.listElement.prepend("<li/>").find("li:first").addClass(t.arrowClass+" "+t.firstClass).data("page","1").html(t.first),t.listElement.append("<li/>").find("li:last").addClass(t.nextClass).data("page",i.nextPage).html(t.next),t.listElement.append("<li/>").find("li:last").addClass(t.arrowClass+" "+t.lastClass).data("page",t.totalPages).html(t.last)),a={},e("li."+t.liClass+", li."+t.arrowClass,t.listElement).click(function(){a.page=e(this).hasClass(t.lastClass)?t.totalPages:e.trim(e(this).data("page")+" "),a.parent=e(this).parent(),a.self=e(this),t.clickCallBack(a)}),e("li."+t.nextClass,t.listElement).hover(function(){next=setInterval(function(){o(1)},300)},function(){clearInterval(next)}),e("li."+t.prevClass,t.listElement).hover(function(){back=setInterval(function(){o(-1)},300)},function(){clearInterval(back)}),t.selectedFocus&&t.actualPage>=t.totalElements&&t.totalPages>t.totalElements){var s,n=t.actualPage-Math.round(t.totalElements/2);s=n<1?1:n+t.totalElements>t.totalPages?(s=t.totalPages-t.totalElements)<1?1:s:n,0==t.listElement.find("li.active").length&&r(s,1)}}()}}(jQuery),function(e){e.fn.bizagiPagination=function(a){a=a||{};var t={limInf:0,totalPages:1,actualPage:1,listElement:e("ul"),first:"&lt;&lt;",firstClass:"first",prev:"&lt;",prevClass:"prev",next:"&gt;",nextClass:"next",last:"&gt;&gt;",lastClass:"last",liClass:"bz-page",arrowClass:"bz-pageArrow",selectedFocus:!0,clickCallBack:function(){}};a.actualPage>a.totalPages&&(a.actualPage=a.totalPages),e.extend(t,t,a);var i={previousPage:Math.max(1,parseInt(t.actualPage)-1),nextPage:parseInt(t.actualPage)+1};function o(a,i){var o;if(a=a||1,(i=i||0)>0)o=a;else{if(!(i<0))return;o=a-2}e.each(e("li."+t.liClass,t.listElement),function(a,i){o++,e(this).data("page",o),e(this).find("span").html(o),e(this).attr("data-page",o),t.actualPage!=o||e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active")}),1==e(t.listElement).find(".active").length?e(t.listElement).parent().find("#tooltipPagination").css("visibility","hidden"):e(t.listElement).parent().find("#tooltipPagination").css("visibility","visible")}!function(){var a,r,s;if(t.totalElements=e("li."+t.liClass,t.listElement[0]).length,t.totalPages>t.totalElements&&t.totalElements>1&&(a=i.previousPage==t.actualPage,r=t.actualPage==t.totalPages,t.listElement.prepend("<li/>").find("li:first").addClass(t.prevClass).addClass(a?"pagination-disabled":"").data("page",i.previousPage).html(t.prev),t.listElement.prepend("<li/>").find("li:first").addClass(t.arrowClass+" "+t.firstClass).addClass(a?"pagination-disabled":"").data("page","1").html(t.first),t.listElement.append("<li/>").find("li:last").addClass(t.nextClass).addClass(r?"pagination-disabled":"").data("page",i.nextPage).html(t.next),t.listElement.append("<li/>").find("li:last").addClass(t.arrowClass+" "+t.lastClass).addClass(r?"pagination-disabled":"").data("page",t.totalPages).html(t.last)),s={},e("li:not(.pagination-disabled)",t.listElement).click(function(){s.page=e(this).hasClass(t.lastClass)?t.totalPages:e.trim(e(this).data("page")+" "),s.parent=e(this).parent(),s.self=e(this),t.clickCallBack(s)}),t.selectedFocus&&t.actualPage>=t.totalElements&&t.totalPages>t.totalElements){var n,l=t.actualPage-Math.round(t.totalElements/2);n=l<1?1:l+t.totalElements>t.totalPages?(n=t.totalPages-t.totalElements)<1?1:n:l,0==t.listElement.find("li.active").length&&o(n,1)}}()}}(jQuery),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.inbox",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX},renderContent:function(){var e=this,a=e.getTemplate("inbox"),t={};t.enableFolders=!(null==bizagi.override||!bizagi.override.enableFolder),t.enableSmartFolders=!(null==bizagi.override||!bizagi.override.enableSmartFolders);var i=e.content=$.tmpl(a,t);return bizagi.workportal.currentInboxView=e.getWidgetName(),i},renderSummaryForm:function(e){var a=this,t=new $.Deferred,i=void 0!==a.dataService.serviceLocator.proxyPrefix?a.dataService.serviceLocator.proxyPrefix:"";return bizagi.loader.start("rendering").then(function(){var o=new bizagi.rendering.facade({proxyPrefix:i});o.execute({canvas:e,summaryForm:!0,idCase:a.idCase}),a.renderingFacade=o,setTimeout(function(){a.resizeLayout()},1e3),$.when(o.ready()).done(function(){t.resolve()})}),t.promise()},routingExecute:function(e){if(null==e)return!1;var a=e.find("#idCase").val(),t=e.find("#idWorkflow").val(),i=e.find("#idWorkItem").val(),o=e.find("#idTask").val(),r=e.find("#eventAsTasks").val()||!1;this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:a,idWorkflow:t,idWorkItem:i,idTask:o,eventAsTasks:r})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.listCases",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES},setTableHeadFixed:function(e){e.TableElement.floatThead(e.floatOptions),e.groupByCaseNumber&&bizagi.util.isIE()&&e.TableElement.find("tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide").hide()}}),bizagi.workportal.widgets.listCases.extend("bizagi.workportal.widgets.inboxGrid",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID},renderContent:function(){var e=this.getTemplate("inbox-grid"),a={};a.enableFolders=!(null==bizagi.override||!bizagi.override.enableFolder),a.enableSmartFolders=!(null==bizagi.override||!bizagi.override.enableSmartFolders);var t=this.content=$.tmpl(e,$.extend(a,{security:bizagi.menuSecurity}));return bizagi.workportal.currentInboxView=this.getWidgetName(),t},renderSummaryForm:function(e){var a=this,t=void 0!==a.dataService.serviceLocator.proxyPrefix?a.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then(function(){var i=new bizagi.rendering.facade({proxyPrefix:t});i.execute({canvas:e,summaryForm:!0,idCase:a.idCase}),a.renderingFacade=i,setTimeout(function(){a.resizeLayout()},1e3)})},routingExecute:function(e){if(null==e)return!1;var a=e.find("#idCase").val(),t=e.find("#idWorkItem").val(),i=e.find("#idTask").val(),o=e.find("#eventAsTasks").val()||!1;this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:a,idWorkItem:t,idTask:i,eventAsTasks:o})}}),$.Class.extend("bizagi.workportal.inbox.rowsPerPage",{},{initCombo:function(){var e={combo:[],id:"numberRows"},a=Array(10,20,30,40,50,100);return bizagiConfig.inboxRowsPerPage&&-1==a.indexOf(bizagiConfig.inboxRowsPerPage)&&(a.push(bizagiConfig.inboxRowsPerPage),a.sort(function(e,a){return e-a})),a.map(function(a){e.combo.push({id:a,name:a})}),e},_findValue:function(e,a){var t=!1;return e.map(function(e){e.id==a&&(t=e)}),t},initialValueCombo:function(e){var a=e.comboDataSource.combo[0],t=e.getRowValueCookie();if((t=t&&t.numberRows?t.numberRows:null)||bizagiConfig.inboxRowsPerPage){var i=t&&!1!==this._findValue(e.comboDataSource.combo,t)?t:bizagiConfig.inboxRowsPerPage;i&&(a=this._findValue(e.comboDataSource.combo,i))}return e.setRowValueCookie(a.id),a},renderNumberRowsCombo:function(e){var a=$.Deferred();e.comboWrapper.empty();var t=this.initialValueCombo({comboDataSource:e.combo,setRowValueCookie:e.setRowValueCookie,getRowValueCookie:e.getRowValueCookie}),i=t.id;return e.comboWrapper.uicombo({isEditable:!1,data:e.combo,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){a.resolve()},onChange:function(a){var t=a.ui.data("value");t!=i&&(i=t,$("#userPositionInput",e.content).val(t),e.setRowValueCookie(t),e.onChange())},initValue:t}),a}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.integration",{},{init:function(e,a,t){this.module=t.module||null,this.selector=t.selector||""},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INTEGRATION},renderContent:function(){var e=document.createElement(this.selector);return this.content=$(e)},postRender:function(){this.module&&bizagi.loader.start(this.module).then(function(){})},clean:function(){$(this.selector).empty(),this._super()}}),bizagi.workportal.widgets.inbox.extend("bizagi.workportal.widgets.inbox",{},{init:function(e,a,t){var i=this;i._super(e,a,t),i.taskState="all",i.icoTaskState="",i.idWorkflow=0,i.idCase=0,i.adhocCases=[],i.loadTemplates({inbox:bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox"),"inbox-cases":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases"),"inbox-cases-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases-list"),"inbox-cases-personalized-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases-personalized-list"),"inbox-common-processes":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-processes"),"inbox-common-noresults":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-noresults"),"inbox-common-header-view":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-header-view"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-form":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-form"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),"inbox-common-case-summary-oldrender":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-oldrender"),useNewEngine:!1})},postRender:function(){var e=this;bizagi.referrerParams=e.params.restoreStatus&&bizagi.referrerParams||{},e.params.taskState=e.params.taskState||bizagi.referrerParams.taskState||"all",e.processesTemplate=e.getTemplate("inbox-common-processes"),e.casesTemplate=e.getTemplate("inbox-cases"),e.casesTemplateList=e.getTemplate("inbox-cases-personalized-list"),e.caseSummaryTemplate=e.getTemplate("inbox-common-case-summary"),e.caseSummaryTemplateForm=e.getTemplate("inbox-common-case-summary-form"),e.caseSummaryTemplateSubprocess=e.getTemplate("inbox-common-case-summary-subprocess"),e.caseSummaryTemplateAssigness=e.getTemplate("inbox-common-case-summary-assignees"),e.caseSummaryTemplateEvents=e.getTemplate("inbox-common-case-summary-events"),e.noResults=e.getTemplate("inbox-common-noresults"),e.paginationTemplate=e.workportalFacade.getTemplate("inbox-common-pagination-inbox"),$.when(e.dataService.getInboxSummary()).done(function(a){e.updateSummary(a),e.changeTaskState(e.params.taskState)}),e.configureViewControl(),bizagi.override.enableSmartFolders&&e.configureSmartFolders(),e.comboRowsPerPage=new bizagi.workportal.inbox.rowsPerPage,e.renderNumberRowsCombo(e.comboRowsPerPage.initCombo())},renderNumberRowsCombo:function(e){var a=this,t=a.getContent();return a.comboRowsPerPage.renderNumberRowsCombo({combo:e,content:t,comboWrapper:$("#select-pagination",t),onChange:function(){a.changeProcess()},setRowValueCookie:a.setRowValueCookie,getRowValueCookie:a.getRowValueCookie})},getRowValueCookie:function(){var e="";return bizagi.cookie("bizagiUserDisplayOptions")&&(e=JSON.parse(bizagi.cookie("bizagiUserDisplayOptions"))),e},setRowValueCookie:function(e){if(this.getRowValueCookie()){var a=this.getRowValueCookie();a.numberRows=e,bizagi.cookie("bizagiUserDisplayOptions",JSON.stringify(a))}else{var t={startPage:"",maximizeModals:"",numberRows:e};bizagi.cookie("bizagiUserDisplayOptions",JSON.stringify(t))}},configureSmartFolders:function(){var e=this,a=e.getContent();$("#innerContentInbox>h2, #innerContentInbox .smartfolders",a).click(function(){"folders"!=e.currentPopup?(e.popupOpened=!0,e.currentPopup="folders",e.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,options:{sourceElement:"#innerContentInbox>h2",modalClass:"folders","max-height":"346",height:"auto",width:"110",offset:"88 0",activeScroll:!0,foldersView:"inboxdetails",closed:function(){e.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()})},configureViewControl:function(){var e=this,a=e.getContent(),t=$("#ui-bizagi-wp-app-inbox-bt-eye",a),i=$("#ui-bizagi-wp-app-inbox-bt-eye",a).parent();t.click(function(){bizagi.workportal.desktop.popup.closePopupInstance(),e.popupOpened=!1,i.addClass("active"),e.currentPopup="eyeDetails";var a=new bizagi.workportal.desktop.popup(e.dataService,e.workportalFacade,{sourceElement:"#ui-bizagi-wp-app-inbox-bt-eye",offset:"0 0",at:"left bottom",height:60,width:129,arrowPosition:{left:"64%"}}),t=e.getTemplate("inbox-common-header-view");a.render($.tmpl(t)),$.when(a.closed()).done(function(){e.popupOpened=!1,i.removeClass("active")});var o=a.getContent();$("#viewDetailsEvent",o).click(function(){e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX}),a.close()}),$("#viewGridEvent",o).click(function(){e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID}),a.close()})})},updateSummary:function(e){var a=this,t=a.getContent();$(".ui-bizagi-wp-app-inbox-tab#red",t).data("taskState","Red"),$(".ui-bizagi-wp-app-inbox-tab#green",t).data("taskState","Green"),$(".ui-bizagi-wp-app-inbox-tab#yellow",t).data("taskState","Yellow"),$(".ui-bizagi-wp-app-inbox-tab#favourites",t).data("taskState","Favorites"),"all"!=a.params.taskState&&$(".ui-bizagi-wp-app-inbox-tab",t).each(function(e,t){$(t).data("taskState")==a.params.taskState?$(t).addClass("active"):$(t).removeClass("active")}),$(".ui-bizagi-wp-app-inbox-tab#all",t).find(".toolTip").html(e.All),$(".ui-bizagi-wp-app-inbox-tab#red",t).find(".toolTip").html(e.Red),$(".ui-bizagi-wp-app-inbox-tab#green",t).find(".toolTip").html(e.Green),$(".ui-bizagi-wp-app-inbox-tab#yellow",t).find(".toolTip").html(e.Yellow),$(".ui-bizagi-wp-app-inbox-tab",t).click(function(){$(".ui-bizagi-wp-app-inbox-tab",t).removeClass("active"),$(this).addClass("active"),a.changeTaskState($(this).data("taskState"))})},changeTaskState:function(e){var a=this,t=a.getContent(),i=$("#contentProc",t),o="";a.params.smartfoldersParameters&&a.params.smartfoldersParameters.urlParameters&&(o=a.params.smartfoldersParameters.urlParameters);var r=a.params.taskState;a.params.taskState=e,"Favorites"==e?(a.taskState="all",a.onlyFavorites="true",r!==e&&(bizagi.referrerParams.page="1")):(a.taskState=e,a.onlyFavorites=""),$("#ui-bizagi-wp-app-inbox-tap-selector",t).removeClass().addClass(e),i.empty(),$.when(a.dataService.getAllProcesses({taskState:a.taskState||"all",onlyFavorites:a.onlyFavorites,smartfoldersParameters:o})).done(function(e){e.categories.length>0&&(e.categories[0].name=""),$.tmpl(a.processesTemplate,e).appendTo(i),$.when(a.dataService.getStoredQueryFormList()).done(function(e){e.storedQueryForms.length>0&&$.when(a.workportalFacade.getWidget("queriesShortcut",{})).pipe(function(e){return widget=e,widget.render()}).done(function(){var e=widget.getContent();$("#queryFormShortcut").html(e)})}),$("li",i).click(function(e){var t=$(this);$(".selected",i).removeClass("selected"),t.addClass("selected"),e.currentTarget&&e.currentTarget.tagName&&(bizagi.referrerParams.page="1");var r=$("#idWorkflow",t).val(),s=$(".ui-bizagi-wp-app-inbox-processes-name",t).text();a.changeProcess({idWorkflow:r,workflowName:s,smartfoldersParameters:o,page:bizagi.referrerParams?bizagi.referrerParams.page:void 0})}),$(".ui-bizagi-wp-app-inbox-processes-start",i).click(function(e){var t;e.stopPropagation();var i=this,o=$("#idWorkflow",$(i).parent()).val();$(i).removeClass("ui-bizagi-wp-app-inbox-processes-start").addClass("ui-bizagi-wp-app-inbox-processes-start-wait"),"false"==$(i).parent().find("#isFavorite").val()?(t={idObject:$(i).parent().find("#guidWFClass").val(),favoriteType:"WFCLASS"},$.when(a.dataService.addFavorite(t)).done(function(e){$(i).parent().find("#guidFavorite").val(e.idFavorites),$(i).removeClass("bz-icon-star-outline").addClass("bz-icon-star"),$(i).parent().find("#isFavorite").val("true"),$(i).removeClass("ui-bizagi-wp-app-inbox-processes-start-wait").addClass("ui-bizagi-wp-app-inbox-processes-start"),a.updateCountProcess(o,!0)})):(t={idObject:$(i).parent().find("#guidFavorite").val(),favoriteType:"WFCLASS"},$.when(a.dataService.delFavorite(t)).done(function(e){"true"!=e.deleted&&1!=e.deleted||($(i).parent().find("#guidFavorite").val(""),$(i).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(i).parent().find("#isFavorite").val("false"),$(i).removeClass("ui-bizagi-wp-app-inbox-processes-start-wait").addClass("ui-bizagi-wp-app-inbox-processes-start"),a.updateCountProcess(o,!1))})),"Favorites"==a.params.taskState&&$(i).parent().hasClass("selected")&&$(i).parent().trigger("click")}),$(".ui-bizagi-wp-app-inbox-processes-title",i).click(function(){var e=$(this).next("ul"),a=$(this).find("span");!!e.is(":hidden")?(e.show(),a.removeClass("Right"),a.addClass("Down")):(e.hide(),a.removeClass("Down"),a.addClass("Right"))});var t=!0;a.params.restoreStatus?($.each($(".ui-bizagi-wp-app-inbox-processes-title",i),function(e,o){$.each($("li",$(o,i).next()),function(e,r){$(r).find("#idWorkflow").val()==bizagi.referrerParams.idWorkflow&&$.when($(o,i).trigger("click")).done(function(){$(r,i).addClass("selected"),a.changeProcess({page:bizagi.referrerParams.page,idWorkflow:bizagi.referrerParams.idWorkflow,workflowName:$(".ui-bizagi-wp-app-inbox-processes-name",$(r,i)).text()}),t=!1})})}),a.params.restoreStatus=!1):($(".ui-bizagi-wp-app-inbox-processes-title:first",i).trigger("click"),$("li:first",i).addClass("selected").trigger("click"),t=!1),t&&($(".ui-bizagi-wp-app-inbox-processes-title:first",i).trigger("click"),$("li:first",i).addClass("selected").trigger("click")),$(i).bizagiScrollbar(),0==e.categories.length&&a.changeProcess()})},changeProcess:function(options){var self=this,content=self.getContent(),casesContainer=$("#contentCases",content),pageSelector=$("#footer #casesPagination"),descContainer=$("#contentDesc",content),nElemToShow=14,smartfoldersParameters="";self.params.smartfoldersParameters&&self.params.smartfoldersParameters.urlParameters&&(smartfoldersParameters=self.params.smartfoldersParameters.urlParameters),options=options||{};var page=options.page||1;bizagi.referrerParams.page=page;var idWorkflow=null!=options.idWorkflow?options.idWorkflow:self.idWorkflow;options.workflowName=options.workflowName||self.workflowName,self.idWorkflow=idWorkflow,self.workflowName=options.workflowName,casesContainer.empty(),descContainer.empty(),pageSelector.empty(),bizagi.showErrorAlertDialog=!1,$.when(self.dataService.getCasesByWorkflow({idWorkflow:self.idWorkflow,taskState:self.taskState,onlyFavorites:eval(self.onlyFavorites),page:page,pageSize:self.getRowValueCookie().numberRows,smartfoldersParameters:smartfoldersParameters})).done(function(e){if(bizagi.showErrorAlertDialog=!0,bizagi.lstIdCases=e.lstIdCases,$(e.rows).each(function(e,a){a.isAdhocProcess&&void 0!==a.isAdhocProcess?(a.isAdhocProcess=!0,self.adhocCases.push(a)):a.isAdhocProcess=!1}),e.idWorkflow=idWorkflow,!e.rows.length)return casesContainer.append("&nbsp;"),void descContainer.append("&nbsp;");e.processName=options.workflowName||"",e.pagination=e.totalPages>1,e.pages={};var a=e.totalPages,t=nElemToShow>e.totalPages?e.totalPages:nElemToShow;a>9&&t--,a>99&&t--;for(var i=1;i<=t;i++)e.pages[i]={pageNumber:i};var o=new bizagi.workportal.command.security(self.dataService);e.graphicQuery=o.checkSecurityPerm("GraphicQuery"),e.enableFolders=bizagi.override.enableFolder||!1;var r=$.tmpl(self.paginationTemplate,e).html();e.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,$(pageSelector).append(r),$.tmpl(self.casesTemplate,e,{replaceLineBreak:function(e){return"string"==typeof e&&-1!==e.search(/\n/)?e.replaceAll("\n","<br/>"):e},formatMonetaryCell:function(e){return bizagi.util.formatMoney(e,BIZAGI_DEFAULT_CURRENCY_INFO)},formatDecimalCell:function(e){var a,t={decimalSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,digitGroupSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator,roundToDecimalPlace:BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits};return a=$.extend({colorize:!1,decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0,negativeFormat:"(%s%n)",positiveFormat:"%s%n",roundToDecimalPlace:"2",symbol:""},t),bizagi.util.formatDecimal(e,a)},formatBoolean:function(e){return 1==bizagi.util.parseBoolean(e)?self.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e)?self.getResource("render-boolean-no"):""}}).appendTo(casesContainer),bizagi.util.formatInvariantDate(content,self.getResource("dateFormat")+" "+self.getResource("timeFormat")),$(".scrollCases").data("totalPage",e.totalPages),$(".scrollCases").data("page",1),$("ul").bizagiPagination({totalPages:e.totalPages,actualPage:e.page,listElement:$("ul",pageSelector),clickCallBack:function(e){self.changeProcess({idWorkflow:idWorkflow,page:e.page})}}),$("li",casesContainer).click(function(){var e=$(this);self.icoTaskState=$(this).children("#caseName").children("#taskState").val(),$(".selected",casesContainer).removeClass("selected"),e.addClass("selected");var a=$("#idCase",e).val(),t=$("#idWorkflowGQ",e).val();self.changeCase(a,t)}),$(".ui-bizagi-inbox-folder",casesContainer).click(function(e){e.stopPropagation();var a=$(this).data("idcase");"folders"!=self.currentPopup?(bizagi.workportal.desktop.popup.closePopupInstance(),self.popupOpened=!1,self.currentPopup="folders",self.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,options:{sourceElement:$(this),modalClass:"folders","max-height":"146",height:"auto",width:"110",offset:"88 0",activeScroll:!0,onlyFolderMode:!0,idCase:a,closed:function(){self.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()}),$(".ui-bizagi-wp-app-inbox-cases-start",casesContainer).click(function(e){var a;e.stopPropagation();var t=this;$(t).removeClass("ui-bizagi-wp-app-inbox-cases-start").addClass("ui-bizagi-wp-app-inbox-cases-start-wait"),"false"==$(t).parent().find("#isFavorite").val()?(a={idObject:$(t).parent().parent().find("#idCase").val(),favoriteType:"CASES"},$.when(self.dataService.addFavorite(a)).done(function(e){$(t).parent().find("#guidFavorite").val(e.idFavorites),$(t).removeClass("bz-icon-star-outline").addClass("bz-icon-star"),$(t).parent().find("#isFavorite").val("true"),$(t).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!0)})):(a={idObject:$(t).parent().find("#guidFavorite").val(),favoriteType:"CASES"},$.when(self.dataService.delFavorite(a)).done(function(e){"true"!=e.deleted&&1!=e.deleted||($(t).parent().find("#guidFavorite").val(""),$(t).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(t).parent().find("#isFavorite").val("false"),$(t).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!1))}))}),e.rows.length>0?(self.icoTaskState=$("li:first",casesContainer).children("#taskState").val(),$("li:first",casesContainer).addClass("selected").trigger("click")):self.changeCase(0),$(casesContainer).bizagiScrollbar()}).fail(function(e){e=JSON.parse(e.responseText)||{};var a=$("#contentDesc",content),t=self.workportalFacade.getTemplate("info-message"),i=e.message||e,o=$.tmpl(t,{message:i,css:"ui-bizagi-info-inbox-detail"});a.append("&nbsp;"),o.appendTo(casesContainer)})},changeCase:function(e,a){var t=this,i=t.getContent(),o=$("#contentDesc",i),r={},s="",n=!1,l=null;o.empty();for(var d=0;d<this.adhocCases.length;d++)e==this.adhocCases[d].id&&(n=!0,l=this.adhocCases[d].idAdhocProcess);t.idCase=e,0!=t.idCase&&$.when(t.dataService.summaryCaseDetails({idCase:t.idCase})).done(function(d){d.hasComments="true"==d.hasComments;var c=new bizagi.workportal.command.security(t.dataService);d.graphicQuery=c.checkSecurityPerm("GraphicQuery"),d.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,void 0===d.contextualized&&(d.contextualized=!0),d.currentState&&d.currentState.length>0&&d.currentState.forEach(function(e){e.idTask||(e.idTask=0),e.state||(e.state=e.displayName||" ")}),"undefined"!==d.process&&""!==d.process&&void 0!==d.process||(d.process=!1),"undefined"!==d.processPath&&""!==d.processPath&&void 0!==d.processPath||(d.processPath=!1);var p=$.tmpl(t.caseSummaryTemplate,$.extend(d,{security:bizagi.menuSecurity})).appendTo(o);bizagi.util.formatInvariantDate(i,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),$("#details",p).delegate(".summaryLink","click",function(){t.routingExecute($(this))}),$("#ui-bizagi-details-tabs",i).tabs({active:-1,create:function(e,a){$(this).tabs("option","active",0)},activate:function(e,a){switch(null==a?"formSummary":a.newPanel.attr("id")){case"comments":null==r.comments&&($.extend(t,{},bizagi.workportal.comments),d.canvas=$("#comments",o),d.readOnly=!0,$.when(t.renderComments(d)).done(function(e){r.comments=e})),bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":if(null==r.formSummary){var i=$("#formSummary",o);i.bind("oldrenderintegration",function(e){if(!e.isPropagationStopped()){e.stopPropagation();var a=t.getTemplate("inbox-common-case-summary-oldrender"),o={};bizagi.oldrenderevent=!0;var r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"==r?"onmessage":"message",function(e){e.stopPropagation(),t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.data})},!1),$.when(t.dataService.getWorkitems({idCase:t.idCase,onlyUserWorkItems:!0})).done(function(e){if("object"==typeof e.workItems&&e.workItems.length>=1){var r=e.workItems[0].idWorkItem,s=e.workItems[0].idTask;o.url=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+t.idCase+"&idWorkitem="+r+"&idTask="+s+"&isSummary=1"}else o.url=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+t.idCase+"&isSummary=1";i.empty(),$.tmpl(a,o).appendTo(i),t.iframeOldRender($("iframe",i)),t.performResizeLayout()})}});var n={idCase:t.idCase};$.when(t.dataService.getCaseFormsRenderVersion(n)).done(function(e){1==e.formsRenderVersion?i.trigger("oldrenderintegration"):$.when(t.renderSummaryForm(i)).done(function(){s=$("#formSummary",o).html(),r.formSummary=s})})}break;case"subprocess":null==r.subprocess&&$.when(t.dataService.summarySubProcess({idCase:t.idCase})).done(function(e){(s=$.tmpl(t.caseSummaryTemplateSubprocess,e)).appendTo($("#subprocess",o)),r.subprocess=s,s.delegate(".summaryLink","click",function(){t.routingExecute($(this))})});break;case"assignees":null==r.assignees&&$.when(t.dataService.summaryAssigness({idCase:t.idCase,preview:!0})).done(function(e){var a=[];$.each(e.events.split(", "),function(e,t){-1===$.inArray(t,a)&&a.push(t)}),e.events=a.join(", ");var i=[];$.each(e.activities.split(", "),function(e,a){-1===$.inArray(a,i)&&i.push(a)}),e.activities=i.join(", "),(s=$.tmpl(t.caseSummaryTemplateAssigness,e)).appendTo($("#assignees",o)),r.assignees=s});break;case"events":null==r.events&&$.when(t.dataService.summaryCaseEvents({idCase:t.idCase})).done(function(e){(s=$.tmpl(t.caseSummaryTemplateEvents,e)).appendTo($("#events",o)),r.events=s,s.delegate(".summaryLink","click",function(){t.routingExecute($(this))})})}}}),$.each($("#ui-bizagi-wp-app-inbox-processes-container li:even, #ui-bizagi-wp-app-inbox-cases-container li:even"),function(){$(this).addClass("ui-bizagi-wp-app-inbox-evenColor")}),$(".js-show-timeline",i).click(function(a){var i=$.trim($(this).closest("div.ui-bizagi-wp-app-inbox-processes-title").find("span.js-case-number").text());t.showTimeLine({radNumber:i,idCase:e})}),$(".ui-bizagi-wp-app-inbox-cases-ico-view",i).click(function(){n?t.showGraphicQuery({idCase:e,idWorkflow:a,isAdhoc:!0,idProcess:l}):t.showGraphicQuery({idCase:e,idWorkflow:a})}),$(".workonitRow",i).button(),$(".workonitRow",i).click(function(){var e=$(this).parent().find("#idWorkItem").val(),i={taskState:t.params.taskState,idWorkItem:e,idCase:t.idCase,idTask:$(this).parent().find("#idTask").val(),onlyFavorites:t.onlyFavorites,idWorkflow:t.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX};$.extend(bizagi.referrerParams,bizagi.referrerParams,i),t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.idCase,idTask:$(this).parent().find("#idTask").val(),idWorkItem:e,idWorkflow:a})}),t.resizeLayout(),$(".scrollProcess").bizagiScrollbar(),$(".scrollSummary").bizagiScrollbar({autohide:!1})})},casesPagination:function(e){var a=this,t=a.getContent(),i=$("#contentCases",t),o=$("#contentCases .scrollCases ul",t),r=new $.Deferred;return a.idWorkflow=e.idWorkflow,a.page=e.page||2,bizagi.showErrorAlertDialog=!1,$.when(a.dataService.getCasesByWorkflow({idWorkflow:a.idWorkflow,taskState:a.taskState,page:a.page})).done(function(e){bizagi.showErrorAlertDialog=!0,e.processName="",$.tmpl(a.casesTemplateList,e).appendTo(o),$("li",i).click(function(){var e=$(this);$(".selected",i).removeClass("selected"),e.addClass("selected");var t=$("#idCase",e).val(),o=$("#idWorkflowGQ",e).val();a.changeCase(t,o)}),r.resolve()}).fail(function(e){e=JSON.parse(e.responseText)||{};var t=a.workportalFacade.getTemplate("info-message"),o=e.message||e,s=$.tmpl(t,{message:o});$(".ui-bizagi-error",s).width("50%"),s.appendTo(i),r.resolve()}),r.promise()},performResizeLayout:function(){this._super(),this.renderingFacade&&this.renderingFacade.resize({forceResize:!0})},updateCountProcess:function(e,a){var t=this,i=t.getContent(),o=$("#contentProc",i),r=!1;if(a=!!a,"Favorites"!=t.params.taskState||""==e)return!0;$.when(t.dataService.getAllProcesses({taskState:t.taskState,onlyFavorites:t.onlyFavorites})).done(function(t){t.categories=t.categories||{},$.each(t.categories,function(a,t){$.each(t.workflows,function(a,t){t.idworkflow==e&&($('li > input[value="'+e+'"][id="idWorkflow"]',o).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(t.count),r=!0)})}),t.categories[bizagi.localization.getResource("workportal-widget-inbox-all-processes")].key="",r||(a?$('li > input[value="'+e+'"][id="idWorkflow"]',o).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(1):$('li > input[value="'+e+'"][id="idWorkflow"]',o).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(0))})},iframeOldRender:function(e){this.getContent();var a,t=bizagi.readQueryString();$.each(e,function(){$(this).is("iframe")&&(a=$(this))}),a.load(function(){var e=$(this).contents(),a=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";$("head",e).append("<script type='text/javascript' src='../../js/renderintegration.js'><\/script>"),a=a.replace("%theme%",t.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+a+"'>")})}}),bizagi.workportal.widgets.inboxGrid.extend("bizagi.workportal.widgets.inboxGrid",{},{init:function(e,a,t){var i=this;i._super(e,a,t),i.taskState="all",i.icoTaskState="",i.idWorkflow=0,i.isAdhocProcess=!0,i.idCase=0,i.page=0,i.adhocIds=[],i.loadTemplates({"inbox-grid":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid"),"inbox-grid-rubik":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid-rubik"),"inbox-grid-cases":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid-cases"),"inbox-common-processes":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-processes"),"inbox-common-header-view":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-header-view"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),"inbox-common-case-summary-oldrender":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-oldrender"),useNewEngine:!1})},postRender:function(){var e=this;bizagi.referrerParams=e.params.restoreStatus&&bizagi.referrerParams||{},e.params.taskState=e.params.taskState||bizagi.referrerParams.taskState||"all",e.processesTemplate=e.getTemplate("inbox-common-processes"),e.casesTemplate=e.getTemplate("inbox-grid-cases"),e.caseSummaryTemplate=e.getTemplate("inbox-common-case-summary"),e.caseSummaryTemplateSubprocess=e.getTemplate("inbox-common-case-summary-subprocess"),e.caseSummaryTemplateAssigness=e.getTemplate("inbox-common-case-summary-assignees"),e.caseSummaryTemplateEvents=e.getTemplate("inbox-common-case-summary-events"),e.paginationTemplate=e.workportalFacade.getTemplate("inbox-common-pagination-grid"),new bizagi.workportal.command.security(e.dataService).checkSecurityPerm("Inbox").done(function(a){a?($.when(e.dataService.getInboxSummary()).done(function(a){e.updateSummary(a),e.resizeLayout(),e.changeTaskState(e.params.taskState)}),e.configureViewControl(),bizagi.override.enableSmartFolders&&e.configureSmartFolders()):($("#contentInbox").remove(),$("#contentFramework").remove(),$("#footer").remove(),e.content=$('<div class="wp-empty"></div>')),e.comboRowsPerPage=new bizagi.workportal.inbox.rowsPerPage,e.renderNumberRowsCombo(e.comboRowsPerPage.initCombo())})},renderNumberRowsCombo:function(e){var a=this,t=a.getContent();return a.comboRowsPerPage.renderNumberRowsCombo({combo:e,content:t,comboWrapper:$("#select-pagination",t),onChange:function(){a.changeProcess()},setRowValueCookie:a.setRowValueCookie,getRowValueCookie:a.getRowValueCookie})},getRowValueCookie:function(){return bizagi.services.preferences().getValues()},setRowValueCookie:function(e){var a=this.getRowValueCookie();a.numberRows=e,strValues=JSON.stringify(a),bizagi.services.preferences().setValues(strValues)},configureSmartFolders:function(){var e=this,a=e.getContent();$("#innerContentInbox>h2, #innerContentInbox .smartfolders",a).click(function(){"folders"!=e.currentPopup?(e.popupOpened=!0,e.currentPopup="folders",e.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,options:{sourceElement:"#innerContentInbox>h2",modalClass:"folders","max-height":"346",height:"auto",width:"110",offset:"88 0",activeScroll:!0,foldersView:"inboxgrid",closed:function(){e.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()})},configureViewControl:function(){bizagi.workportal.widgets.inbox.prototype.configureViewControl.apply(this,arguments)},updateSummary:function(e){bizagi.workportal.widgets.inbox.prototype.updateSummary.apply(this,arguments)},changeTaskState:function(e){var a=this.getContent(),t=$("#contentProc",a);bizagi.workportal.widgets.inbox.prototype.changeTaskState.apply(this,arguments),$(t).bizagiScrollbar()},setFiltersOnChangeProcess:function(e,a){var t={};return t.page=a.page&&a.page>0?a.page:1,t.taskState=a.taskState||e.taskState,t.idWorkflow=null!=a.idWorkflow?a.idWorkflow:e.idWorkflow||"",t.orderFieldName=a.orderFieldName||(a.idWorkflow==e.idWorkflow||null==a.idWorkflow?e.orderFieldName:""),t.orderType=null!=a.orderType?a.orderType:a.idWorkflow==e.idWorkflow||null==a.idWorkflow?e.orderType:"0",t.order=a.order||(a.idWorkflow==e.idWorkflow||null==a.idWorkflow?e.order:""),e.idWorkflow=t.idWorkflow,e.orderFieldName=t.orderFieldName,e.orderType=t.orderType,e.order=t.order,t},changeProcess:function(options){var self=this,content=self.getContent(),casesContainer=$("#contentCases",content),procContainer=$("#contentProc",content),pageSelector=$("#footer #casesPagination"),nElemToShow=14;options=options||{};var res=self.setFiltersOnChangeProcess(self,options),page=res.page,taskState=res.taskState,idWorkflow=res.idWorkflow,orderFieldName=res.orderFieldName,orderType=res.orderType,order=res.order;bizagi.referrerParams.page=page;var smartfoldersParameters="";self.params.smartfoldersParameters&&self.params.smartfoldersParameters.urlParameters&&(smartfoldersParameters=self.params.smartfoldersParameters.urlParameters),casesContainer.empty(),pageSelector.hide().empty(),bizagi.showErrorAlertDialog=!1,$.when(self.dataService.getCustomizedColumnsData({idWorkflow:idWorkflow,taskState:taskState,onlyFavorites:eval(self.onlyFavorites),order:order,orderFieldName:orderFieldName,orderType:orderType,page:page,pageSize:self.getRowValueCookie().numberRows,smartfoldersParameters:smartfoldersParameters,group:bizagiConfig.groupByCaseNumber?"T_RADNUMBER":null})).done(function(e){bizagi.showErrorAlertDialog=!0,$(e.cases.rows).each(function(e,a){a.isAdhocProcess&&void 0!==a.isAdhocProcess||(a.isAdhocProcess=!1),a.isAdhocProcess&&self.adhocIds.push({caseId:a.id,processId:a.idAdhocProcess})}),bizagi.lstIdCases=e.cases.lstIdCases;var a=0;$(e.cases.columnTitle).each(function(t,i){"T_idTask"==i.order&&$(e.cases.rows).each(function(t,i){self.isArray(i.fields[a])||(e.cases.rows[t].fields[a]={workitems:[{TaskName:i.fields[a],State:e.cases.rows[t].taskState}]})}),a++});var t={};t.pagination=e.cases.totalPages>1,t.page=bizagi.referrerParams.page||e.cases.page,t.pages={};var i=nElemToShow>e.cases.totalPages?e.cases.totalPages:nElemToShow;for(a=1;a<=i;a++)t.pages[a]={pageNumber:a};if(t.gridPagination="gridCasePagination",t.previousPage=e.cases.page>1?e.cases.page-1:1,t.nextPage=e.cases.page<e.cases.totalPages?e.cases.page+1:e.cases.totalPages,t.totalPages=e.cases.totalPages,t.totalPages>1){var o=$.tmpl(self.paginationTemplate,t).html();$(pageSelector).show().append(o)}e.cases.enableFolders=bizagi.override.enableFolder||!1,e.cases=bizagi.util.formatDecimalAndMoneyCell(e.cases,BIZAGI_DEFAULT_CURRENCY_INFO);var r=new bizagi.workportal.command.security(self.dataService);$.when(r.checkSecurityPerm("GraphicQuery"),r.checkSecurityPerm("TimeLine")).done(function(a,i){e.cases.graphicQuery=a,e.cases.timeLine=i&&bizagi.override.enableFeatureShowTimelineButton,e.cases.groupByCaseNumber=bizagiConfig.groupByCaseNumber;var o=$.tmpl(self.casesTemplate,e.cases,{showMagicButton:function(){return bizagi.override.enableAdhocProcess},setFormat:self.formatValue,isArray:self.isArray,formatCategories:self.formatCategories,isDate:bizagi.util.isDate,replaceLineBreak:function(e){return"string"==typeof e&&-1!==e.search(/\n/)?e.replaceAll("\n","<br/>"):e},getRadNumberColumnIndex:function(){for(var e=this.data,a=-1,t=0,i=e.columnTitle.length;t<i;t++)"I_RadNumber"==e.columnTitle[t].fieldName&&(a=t);return a},showColumn:function(e){var a=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&a==e?" style=display:none; ":""},createGroupedHeader:function(e){var a=this.data,t=!1,i=this.getRadNumber(a.rows[e]);a.groupByCaseNumber&&(0==e?t=!0:i!=this.getRadNumber(a.rows[e-1])&&(t=!0));return t},getRadNumber:function(e){var a=this.getRadNumberColumnIndex();return a>=0?e.fields[a]:""},isIEAndFirstRowAndGroupCases:function(e){return 0==e&&this.data.groupByCaseNumber&&bizagi.util.isIE()}}).appendTo(casesContainer);if(bizagi.util.isIE9()){var r=new RegExp(">[ \t\r\n\v\f]*<","g"),s=$("#ui-bizagi-wp-app-inbox-grid-cases",casesContainer).html();$("#ui-bizagi-wp-app-inbox-grid-cases",casesContainer).html(s.replace(r,"><"))}1==bizagi.override.ShowTimeInInboxDates||null==bizagi.override.ShowTimeInInboxDates?bizagi.util.formatInvariantDate(content,self.getResource("dateFormat")+" "+self.getResource("timeFormat")):bizagi.util.formatInvariantDate(content,self.getResource("dateFormat")),$("li",pageSelector).parent().data("order",order),$("li",pageSelector).parent().data("orderFieldName",orderFieldName),$("li",pageSelector).parent().data("orderType",orderType),$("ul").bizagiPagination({maxElemShow:50,totalPages:t.totalPages,actualPage:t.page,listElement:$("ul",pageSelector),clickCallBack:function(e){self.changeProcess({idWorkflow:idWorkflow,page:e.page,order:e.parent.data("order"),orderFieldName:e.parent.data("orderFieldName"),orderType:e.parent.data("orderType")})}}),$(".inbox-grid-tooltip-button",content).tooltip(),$("#ui-bizagi-wp-app-inbox-grid-cases tr:nth-child(even)",o).addClass("event"),$(".ui-bizagi-wp-app-inbox-activity-name",o).click(function(){var e={taskState:self.params.taskState,idWorkItem:$(this).find("#idWorkItem").val(),idCase:$(this).find("#idCase").val(),idTask:$(this).find("#idTask").val(),onlyFavorites:self.onlyFavorites,idWorkflow:self.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,e);var a=$(this).find("#idCase").val(),t=$(this).find("#idTask").val(),i=$(this).find("#idWorkItem").val(),o=$(this).closest("tr").data("idworkflow");self.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:a,idWorkItem:i,idTask:t,idWorkflow:o})}),$(".ui-bizagi-wp-app-inbox-grouped",o).bind("click",function(){$(this).data("radnumber");var e={taskState:self.params.taskState,idWorkItem:$(this).find("#idWorkItem").val(),idCase:$(this).find("#idCase").val(),idTask:$(this).find("#idTask").val(),onlyFavorites:self.onlyFavorites,idWorkflow:self.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,e);var a=$(this).find("#idCase").val();self.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:a})}),$(o).delegate(".ui-bizagi-wp-app-inbox-cases-start","click",function(e){var a;e.stopPropagation();var t=this;$(t).removeClass("ui-bizagi-wp-app-inbox-cases-start").addClass("ui-bizagi-wp-app-inbox-cases-start-wait"),"false"==$(t).parent().find("#isFavorite").val()?(a={idObject:$(t).parent().find("#idCase").val(),favoriteType:"CASES"},$.when(self.dataService.addFavorite(a)).done(function(e){$(t).parent().find("#guidFavorite").val(e.idFavorites),$(t).removeClass("bz-icon-star-outline").addClass("bz-icon-star"),$(t).parent().find("#isFavorite").val("true"),$(t).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!0)})):(a={idObject:$(t).parent().find("#guidFavorite").val(),favoriteType:"CASES"},$.when(self.dataService.delFavorite(a)).done(function(e){"true"!=e.deleted&&1!=e.deleted||($(t).parent().find("#guidFavorite").val(""),$(t).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(t).parent().find("#isFavorite").val("false"),$(t).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!1))}))}),$("i.bz-icon-search-outline",o).click(function(){var e=$(this).parents("td").first().find("#idCase").val(),a=$(this).closest("tr").data("idworkflow");self.showCase(e,a)}),$(".ui-bizagi-wp-app-inbox-cases-ico-view",o).click(function(e){var a=$(this).parent().children("#idCase").val(),t=$(this).closest("tr").data("idworkflow"),i=null;if($(this).closest("tr").data("isadhoc")){for(var o=0;o<self.adhocIds.length;o++)if(parseInt(a)==self.adhocIds[o].caseId){i=self.adhocIds[o].processId,self.showGraphicQuery({idCase:a,idWorkflow:t,isAdhoc:!0,idProcess:i});break}}else self.showGraphicQuery({idCase:a,idWorkflow:t});e.preventDefault()}),$(".js-show-timeline",o).click(function(e){var a=$(this).parent().children("#idCase").val(),t=$.trim($(this).closest("tr").find(".I_RadNumber").text());self.showTimeLine({radNumber:t,idCase:a})}),$(".sortColumnsData",casesContainer).click(function(){self.changeProcess({idWorkflow:idWorkflow,orderFieldName:$(this).find("#orderFieldName").val(),orderType:0==$(this).find("#orderType").val()?1:0,order:$(this).find("#order").val()})}),$(casesContainer).bizagiScrollbar({autohide:!1}),$(".ui-bizagi-inbox-folder",o).click(function(e){e.stopPropagation();var a=$(this).data("idcase");"folders"!=self.currentPopup?(self.popupOpened=!0,self.currentPopup="folders",self.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,options:{sourceElement:$(this),modalClass:"folders","max-height":"146",height:"auto",width:"110",offset:"88 0",activeScroll:!0,onlyFolderMode:!0,idCase:a,closed:function(){self.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()}),$(".ui-bizagi-wp-app-magic-button",casesContainer).bind("click",function(){self.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INTEGRATION,module:"adhocProcess",selector:"app-root"})}),$(procContainer).bizagiScrollbar()});var s=$("li#contentCases > .ui-bizagi-wp-app-inbox-grid-cases-container-parent-tableHeadFixed > .ui-bizagi-wp-app-inbox-grid-cases-container-tableHeadFixed > table");self.setTableHeadFixed({TableElement:s,groupByCaseNumber:e.cases.groupByCaseNumber,floatOptions:{position:"fixed",zIndex:1,scrollContainer:function(){return $("li#contentCases > .ui-bizagi-wp-app-inbox-grid-cases-container-parent-tableHeadFixed > .ui-bizagi-wp-app-inbox-grid-cases-container-tableHeadFixed")}}}),s.find("thead > tr").height(s.prev().height())}).fail(function(e){e=JSON.parse(e.responseText)||{};var a=self.workportalFacade.getTemplate("info-message"),t=e.message||e;$.tmpl(a,{message:t}).appendTo(casesContainer)})},showCase:function(e,a){var t=this,o=t.getContent(),r=$("#contentDesc",o),s={},n="";t.idCase=e,r.empty(),0!=t.idCase&&$.when(t.dataService.summaryCaseDetails({idCase:t.idCase})).done(function(l){var d=null,c=!1;l.isAdhocProcess&&void 0!==l.isAdhocProcess||(l.isAdhocProcess=!1),l.isAdhocProcess&&(d=l.idAdhocProcess,c=!0),l.hasComments="true"==l.hasComments;var p=new bizagi.workportal.command.security(t.dataService);l.graphicQuery=p.checkSecurityPerm("GraphicQuery"),l.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,l.currentState&&l.currentState.length>0&&l.currentState.forEach(function(e){e.idTask||(e.idTask=0),e.state||(e.state=e.displayName||" ")}),"undefined"!==l.process&&""!==l.process&&void 0!==l.process||(l.process=!1),"undefined"!==l.processPath&&""!==l.processPath&&void 0!==l.processPath||(l.processPath=!1);var g=$.tmpl(t.caseSummaryTemplate,$.extend(l,{security:bizagi.menuSecurity})).appendTo(r);bizagi.util.formatInvariantDate(o,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),$("#details",g).delegate(".summaryLink","click",function(){t.routingExecute($(this)),m.dialog("close")});var m=g;$("#ui-bizagi-details-tabs",o).tabs({active:-1,create:function(e,a){$(this).tabs("option","active",0)},activate:function(e,a){switch(null==a?"formSummary":a.newPanel.attr("id")){case"comments":null==s.comments&&($.extend(t,{},bizagi.workportal.comments),l.canvas=$("#comments"),l.readOnly=!0,$.when(t.renderComments(l)).done(function(e){s.comments=e})),bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":if(null==s.formSummary){var o=$("#formSummary",r);o.bind("oldrenderintegration",function(e){if(!e.isPropagationStopped()){e.stopPropagation();var a=t.getTemplate("inbox-common-case-summary-oldrender"),r={};bizagi.oldrenderevent=!0;var s=window.addEventListener?"addEventListener":"attachEvent";(0,window[s])("attachEvent"==s?"onmessage":"message",function(e){e.stopPropagation(),t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.data})},!1),$.when(t.dataService.getWorkitems({idCase:t.idCase,onlyUserWorkItems:!0,eventAsTasks:!0})).done(function(e){if("object"==typeof e.workItems&&e.workItems.length>=1){var s=e.workItems[0].idWorkItem,n=e.workItems[0].idTask;for(i=0;i<e.workItems.length;i++)if(e.workItems[i].idCase==t.idCase){s=e.workItems[i].idWorkItem,n=e.workItems[i].idTask;break}r.url=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+t.idCase+"&idWorkitem="+s+"&idTask="+n+"&isSummary=1"}else r.url=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+t.idCase+"&isSummary=1";o.empty(),$.tmpl(a,r).appendTo(o),t.iframeOldRender($("iframe",o))})}});var d={idCase:t.idCase};$.when(t.dataService.getCaseFormsRenderVersion(d)).done(function(e){1==e.formsRenderVersion?o.trigger("oldrenderintegration"):$.when(t.renderSummaryForm($("#formSummary",g))).done(function(){n=$("#formSummary",g).html(),s.formSummary=n})})}break;case"subprocess":null==s.subprocess&&$.when(t.dataService.summarySubProcess({idCase:t.idCase})).done(function(e){(n=$.tmpl(t.caseSummaryTemplateSubprocess,e)).appendTo($("#subprocess",g)),s.subprocess=n,n.delegate(".summaryLink","click",function(){t.routingExecute($(this)),m.dialog("close")})});break;case"assignees":null==s.assignees&&$.when(t.dataService.summaryAssigness({idCase:t.idCase,preview:!0})).done(function(e){var a=[];$.each(e.events.split(", "),function(e,t){-1===$.inArray(t,a)&&a.push(t)}),e.events=a.join(", "),(n=$.tmpl(t.caseSummaryTemplateAssigness,e)).appendTo($("#assignees",g)),s.assignees=n});break;case"events":null==s.events&&$.when(t.dataService.summaryCaseEvents({idCase:t.idCase})).done(function(e){(n=$.tmpl(t.caseSummaryTemplateEvents,e)).appendTo($("#events",g)),s.events=n,n.delegate(".summaryLink","click",function(){t.routingExecute($(this)),m.dialog("close")})})}}}),$(".workonitRow",g).button(),$(".js-show-timeline",g).click(function(a){var i=$.trim($(this).closest("div.ui-bizagi-wp-app-inbox-processes-title").find("span.js-case-number").text());t.showTimeLine({radNumber:i,idCase:e})}),$("#ui-bizagi-wp-app-inbox-description-container .ui-bizagi-wp-app-inbox-cases-ico-view",o).click(function(){c?t.showGraphicQuery({idCase:e,idWorkflow:a,isAdhoc:!0,idProcess:d}):t.showGraphicQuery({idCase:e,idWorkflow:a})}),$(".workonitRow",g).click(function(){var e={taskState:t.params.taskState,idWorkItem:$(this).parent().find("#idWorkItem").val(),idCase:l.idCase,idTask:$(this).parent().find("#idTask").val(),onlyFavorites:t.onlyFavorites,idWorkflow:t.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,e),m.dialog("close"),t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:l.idCase,idWorkflow:a,idTask:$(this).parent().find("#idTask").val(),idWorkItem:$(this).parent().find("#idWorkItem").val()})});var u={};u[bizagi.localization.getResource("workportal-case-dialog-box-close")]=function(){r.empty(),g.remove(),$("#ui-bizagi-wp-app-inbox-description-container").remove()},m.dialog({modal:!0,title:l.process,width:1e3,height:600,draggable:!0,resizable:!0,buttons:u,close:function(){r.empty(),g.remove(),$("#ui-bizagi-wp-app-inbox-description-container").remove()}})})},formatRequest:function(e){return e},formatCategories:function(e){return e},isArray:function(e){return"object"==typeof e},updateCountProcess:function(e,a){var t=this,i=t.getContent(),o=$("#contentProc",i),r=!1;if(a=!!a,"Favorites"!=t.params.taskState||""==e)return!0;$.when(t.dataService.getAllProcesses({taskState:t.taskState,onlyFavorites:t.onlyFavorites})).done(function(t){t.categories=t.categories||{},$.each(t.categories,function(a,t){$.each(t.workflows,function(a,t){t.idworkflow==e&&($('li > input[value="'+e+'"][id="idWorkflow"]',o).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(t.count),r=!0)})}),r||(a?$('li > input[value="'+e+'"][id="idWorkflow"]',o).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(1):$('li > input[value="'+e+'"][id="idWorkflow"]',o).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(0))})},iframeOldRender:function(e){this.getContent();var a,t=bizagi.readQueryString();$.each(e,function(){$(this).is("iframe")&&(a=$(this))}),a.load(function(){var e=$(this).contents(),a=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";a=a.replace("%theme%",t.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+a+"'>")})},dispose:function(){this._super()}}),bizagi.workportal.widgets.inboxGrid.extend("bizagi.workportal.widgets.inboxGridRubik",{},{renderContent:function(){var e=this.getTemplate("inbox-grid-rubik"),a=this.content=$.tmpl(e,{});return bizagi.workportal.currentInboxView=this.getWidgetName(),a},postRender:function(){var e=this;bizagi.referrerParams=e.params.restoreStatus&&bizagi.referrerParams||{},e.changeProcess({idWorkflow:"",workflowName:"All Cases ",smartfoldersParameters:""}),e.getEventListener().on("PROCESS-VIEW-UPDATE",function(a,t){e.changeProcess(t)})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.folders",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS},init:function(e,a,t){this._super(e,a,t),this.loadTemplates({folders:bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders"),"folders-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-elements"),"folders-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-empty-elements"),"folders-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-query-tree"),"folders-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-confirm"),"folders-default":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-default"),"folders-input-new":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-input-new"),"folders-add-case":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-add-case"),"folders-elements-node":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-element-node"),"folders-query-edit":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-edit"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("folders");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.smartfolders",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS},init:function(e,a,t){this._super(e,a,t),this.loadTemplates({smartfolders:bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders"),"smartfolders-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-elements"),"smartfolders-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-empty-elements"),"smartfolders-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-confirm"),"smartfolders-default":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-default"),"smartfolders-add-case":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-add-case"),"smartfolders-elements-node":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-element-node"),"smartfolders-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-query-tree"),"smartfolders-query-edit":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-edit"),"smartfolders-input-new":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-input-new"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("smartfolders");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.folders.extend("bizagi.workportal.widgets.folders",{},{postRender:function(){var e=this;e.params.options.onlyFolderMode=e.params.options.onlyFolderMode||!1,e.configureTreeNavigation(),e.configureBackButton(),e.renderFolders(e.params.options.onlyFolderMode?"-1":""),e.scrollVertical({autohide:!1})},renderDefaultFolders:function(){var e=this.getContent(),a=this.getTemplate("folders-default"),t=$("#queries",e);t.empty(),$.tmpl(a).appendTo(t)},renderFolders:function(e,a){var t,i,o=this,r=o.getContent(),s=null!=o.params.options.onlyFolderMode&&o.params.options.onlyFolderMode?o.getTemplate("folders-add-case"):o.getTemplate("folders-elements"),n=o.getTemplate("folders-empty-elements"),l=$("#queries",r),d={};e=e||"",$.when(o.dataService.getFolders(e)).done(function(r){l.empty(),r=r||void 0;var c="";try{null!=r.folders&&r.folders.length>0&&(c=r.folders[0].idParent)}catch(e){}null!=r.folders&&""!=r.folders?(i=null!=a?{folders:null!=r?a.concat(r.folders):a}:r,$.each(i.folders,function(e,a){null!=a&&null!=a.childs.folders?i.folders[e].countChilds=i.folders[e].childs.folders.length:i.folders[e].countChilds=0}),""==e||o.params.options.onlyFolderMode?d=i:d.folders=i.folders.concat({name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:c,childs:[],categoryWithLink:"true",countChilds:0}),t=$.tmpl(s,d)):o.params.options.onlyFolderMode?t=$.tmpl(n):(d.folders=[{name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:c,childs:[],categoryWithLink:"true",countChilds:0}],t=$.tmpl(s,d)),t.appendTo(l),o.configureNavTree(l)})},configureNavTree:function(e){var a=this,t=a.getTemplate("folders-query-confirm");$("li","#queries").click(function(e){e.stopPropagation();var t=$(this).data("id"),i=$(this).data("childslength"),o=$(this).data("name"),r=$(this).data("urlparameters"),s=$(this).data("idparent"),n=a.getTemplate("folders-query-tree"),l=$("#categoryTree"),d=$(".queriesListDisplay li");0==i&&a.params.options.onlyFolderMode||("-1"==t?($.tmpl(n,{idParentQuery:-1,queryDisplayName:o}).appendTo(l),a.configureTreeNavigation(s),a.renderFolders(t)):"newFolder"==t?a.makeFolder({listElements:d,idParent:s}):i>0?($.tmpl(n,{idParentQuery:t,queryDisplayName:o}).appendTo(l),a.configureTreeNavigation(s),a.renderFolders(t,a.params.options.onlyFolderMode?[]:[{name:o,id:t,idParent:"",childs:[],categoryWithLink:!0,urlParameters:r}])):(bizagi.workportal.desktop.popup.closePopupInstance(),0==i&&r&&$.when(a.dataService.getCasesByFolder(r)).done(function(e){bizagi.lstIdCases=e.lstIdCases,bizagi.referrerParams=bizagi.referrerParams||{},bizagi.referrerParams.radNumber="",bizagi.referrerParams.page="",bizagi.referrerParams.referrer="folders",bizagi.referrerParams.urlParameters=r,bizagi.referrerParams.name=o,bizagi.referrerParams.id=t,e.customized=!0,e.urlParameters=r,e.title=o,e.casesGroupedByFolder=!0,e.idFolder=t,a.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,data:e,referrerParams:{}})})))}),$(".addButton","#queries").click(function(e){e.stopPropagation();var t=$(".queriesListDisplay li"),i=$(this).data("id"),o=$(this).data("idparent");a.makeFolder({listElements:t,idParent:i,beforeElement:$(this).parent(),style:"newSubFolder",idParentDone:o})}),$(".editButton","#queries").click(function(e){e.stopPropagation(),a.editFolder($(this).parent())}),$(".deleteButton","#queries").click(function(e){e.stopPropagation();var i=$.tmpl(t),o=$(this).data("id"),r=$(this).data("idparent");$(i).dialog({resizable:!0,modal:!0,title:a.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:a.getResource("workportal-widget-queries-confirm-delete"),click:function(){a.dataService.deleteFolder({idCustomFolder:o}),$(this).dialog("close"),a.renderFolders(r)}},{text:a.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})}),$(".addIco","#queries").click(function(e){e.stopPropagation();var t=$(this),i=t.parent(),o=t.data("id");t.addClass("wait"),$.when(a.dataService.associateCaseToFolder({idCustomFolder:o,idCase:a.params.options.idCase})).done(function(e){""==e.message?bizagi.workportal.desktop.popup.closePopupInstance():(t.removeClass("wait"),""==$(".errorMessage",i).text()&&(i.append($("<div class='errorMessage'></div>").html(e.message)),setTimeout(function(){$(".errorMessage",i).hide("blind","slow",function(){$(this).remove()})},5e3)))})})},configureBackButton:function(){var e=this,a=e.getContent(),t=$("#bt-back",a),i=$("#categoryTree",a);t.click(function(){if($("li",i).length>1){$("li:last-child",i).remove();var a=$("li:last-child").children("#idParent").val();e.renderFolders(a)}})},makeFolder:function(e){var a=this,t=e.template||a.getTemplate("folders-input-new");e.beforeElement=null!=e.beforeElement&&e.beforeElement.length>=1?e.beforeElement:e.listElements;var i=$.tmpl(t,{name:"",idParent:e.idParent,style:e.style}).insertAfter(1==e.beforeElement.length?e.beforeElement:e.beforeElement.last().prev());$(".newInput",i).focus(),$(".checkico",i).click(function(){var t=$(".newInput",i).val(),o=$(this).parent();$.when(a.checkRepeatFolderName({parent:o,options:e,folderName:t})).done(function(i){i?$.when(a.dataService.makeFolder({idParentFolder:e.idParent,folderName:t})).done(function(t){a.renderFolders(e.idParentDone||e.idParent)}):(o.append($("<div class='errorMessage'></div>").html(a.getResource("workportal-widget-folders-name-repeated"))),setTimeout(function(){$(".errorMessage",o).hide("blind","slow",function(){$(".errorMessage",o).remove()})},5e3))})}),$(".newInput",i).bind("keypress",function(e){13==e.keyCode&&$(".checkico",i).click()})},checkRepeatFolderName:function(e){var a=new $.Deferred,t=!0;return(e=e||{}).parent.hasClass("newSubFolder")?$.when(this.dataService.getFolders(e.options.idParent)).done(function(i){null!=i.folders&&$.each(i.folders,function(i,o){null!=o.name&&e.folderName==o.name&&(t=!1,a.resolve(t))}),a.resolve(t)}):($(".queriesListDisplay li").not(":last-child").each(function(){e.folderName==$(this).data("name")&&(t=!1)}),a.resolve(t)),a.promise()},editFolder:function(e){var a=this,t=$(e).data("idparent"),i=$(e).find("h3").html(),o=$(e).data("id"),r=a.getTemplate("folders-input-new"),s=$.tmpl(r,{name:i,idParent:t});e.replaceWith(s),$(".newInput",s).focus(),$(".checkico",s).click(function(){var e=$(".newInput",s).val();$.when(a.dataService.updateFolder({idFolder:o,folderName:e})).done(function(e){a.renderFolders(t)})}),$(".newInput",s).bind("keypress",function(e){13==e.keyCode&&$(".checkico",s).click()})},configureTreeNavigation:function(e){var a=this,t=a.getContent(),i=$("#categoryTree",t);$("li:last-child",i).click(function(){e=e||$(this).children("#idParent").val(),a.params.options.onlyFolderMode&&""==e&&a.renderFolders(-1),$(this).nextAll().remove(),a.renderFolders(e)})},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(e){var a=e.idQuery||"",t=e.idStoredQuery||"",i=e.queryFormAction||"",o=e.title||"";"queryform"!=this.currentPopup?(this.currentPopup="queryform",this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,idQueryForm:a,idStoredQuery:t,queryFormAction:i,modalParameters:{title:o}})):bizagi.workportal.desktop.popup.closePopupInstance()}}),bizagi.workportal.widgets.smartfolders.extend("bizagi.workportal.widgets.smartfolders",{},{postRender:function(){var e=this;e.params.options.onlyFolderMode=e.params.options.onlyFolderMode||!1,e.configureTreeNavigation(),e.configureBackButton(),e.renderFolders(e.params.options.onlyFolderMode?"-1":""),e.scrollVertical({autohide:!1})},renderDefaultFolders:function(){var e=this.getContent(),a=this.getTemplate("smartfolders-default"),t=$("#queries",e);t.empty(),$.tmpl(a).appendTo(t)},renderFolders:function(e,a){var t,i,o=this,r=o.getContent(),s=null!=o.params.options.onlyFolderMode&&o.params.options.onlyFolderMode?o.getTemplate("smartfolders-add-case"):o.getTemplate("smartfolders-elements"),n=o.getTemplate("smartfolders-empty-elements"),l=$("#queries",r),d={};e=e||"",$.when(o.dataService.getSmartFolders(e)).done(function(e){l.empty(),e=e||void 0;var r="";try{null!=e.folders&&e.folders.length>0&&(r=e.folders[0].idParent)}catch(e){}null!=e.folders&&""!=e.folders?(i=null!=a?{folders:null!=e?a.concat(e.folders):a}:e,$.each(i.folders,function(e,a){null!=a&&null!=a.childs.folders?i.folders[e].countChilds=i.folders[e].childs.folders.length:i.folders[e].countChilds=0}),o.params.options.onlyFolderMode?d=i:d.folders=i.folders.concat({name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:r,childs:[],categoryWithLink:"true",countChilds:0}),t=$.tmpl(s,d)):o.params.options.onlyFolderMode?t=$.tmpl(n):(d.folders=[{name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:r,childs:[],categoryWithLink:"true",countChilds:0}],t=$.tmpl(s,d)),t.appendTo(l),o.configureNavTree()})},configureNavTree:function(){var e=this,a=e.getTemplate("smartfolders-query-confirm");$("li","#queries").click(function(a){a.stopPropagation();var t=$(this).data("id"),i=$(this).data("childslength"),o=$(this).data("name"),r=$(this).data("urlparameters"),s=$(this).data("idparent"),n=$(".queriesListDisplay li");if(0!=i||!e.params.options.onlyFolderMode)if("-1"==t)e.configureTreeNavigation(s),e.renderFolders(t);else if("newFolder"==t)e.makeFolder({listElements:n,idParent:s});else if(i>0)e.configureTreeNavigation(s),e.renderFolders(t,e.params.options.onlyFolderMode?[]:[{name:o,id:t,idParent:"",childs:[],categoryWithLink:!0,urlParameters:r}]);else{var l;if(bizagi.workportal.desktop.popup.closePopupInstance(),0==i&&r)if(bizagi.override.viewSmartFoldersAsSearch)$.when(e.dataService.getCustomizedColumnsData({smartfoldersParameters:r})).done(function(a){bizagi.lstIdCases=a.lstIdCases,bizagi.referrerParams=bizagi.referrerParams||{},bizagi.referrerParams.radNumber="",bizagi.referrerParams.page="",bizagi.referrerParams.referrer="folders",bizagi.referrerParams.urlParameters=r,bizagi.referrerParams.name=o,bizagi.referrerParams.id=t,a.customized=!0,a.urlParameters=r,a.title=o,a.casesGroupedByFolder=!0,a.idFolder=t,e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,data:a,referrerParams:{}})});else bizagi.referrerParams=bizagi.referrerParams||{},"inboxgrid"==e.params.options.foldersView?(l=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,bizagi.referrerParams={urlParameters:r,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID}):(l=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,bizagi.referrerParams={urlParameters:r,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX}),e.publish("changeWidget",{widgetName:l,smartfoldersParameters:{urlParameters:r},referrerParams:{}})}}),$(".editButton","#queries").click(function(a){a.stopPropagation(),e.editFolder($(this).parent())}),$(".deleteButton","#queries").click(function(t){t.stopPropagation();var i=$.tmpl(a),o=$(this).data("id"),r=$(this).data("idparent");$(i).dialog({resizable:!0,modal:!0,title:e.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:e.getResource("workportal-widget-queries-confirm-delete"),click:function(){e.dataService.deleteSmartFolder({idSmartFolder:o,idUser:bizagi.currentUser.idUser||0}),$(this).dialog("close"),e.renderFolders(r)}},{text:e.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})})},configureBackButton:function(){var e=this,a=e.getContent(),t=$("#bt-back",a),i=$("#categoryTree",a);t.click(function(){if($("li",i).length>1){$("li:last-child",i).remove();var a=$("li:last-child").children("#idParent").val();e.renderFolders(a)}})},makeFolder:function(){var e=this.dataService.getUrl({endPoint:"smartfolders-integration"})+"?ParentQueryId=-1";this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:e,modalParameters:{title:this.getResource("workportal-widget-folders-new"),width:"1020px"}})},editFolder:function(e){var a=$(e).find("h3").html(),t=$(e).data("id"),i=this.dataService.getUrl({endPoint:"smartfolders-integration"})+"?iQueryFormId="+t;this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:i,modalParameters:{title:a,width:"1020px"}})},configureTreeNavigation:function(e){var a=this,t=a.getContent(),i=$("#categoryTree",t);$("li:last-child",i).click(function(){e=e||$(this).children("#idParent").val(),a.params.options.onlyFolderMode&&""==e&&a.renderFolders(-1),$(this).nextAll().remove(),a.renderFolders(e)})},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})}});
//# sourceMappingURL=../../../../Maps/desktop/inbox.desktop.production.js.map
