bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.activity.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ACTIVITY_LOG},renderContent:function(){var e=this,t=e.getTemplate("activity.log");return e.idCase=e.params.idCase,e.idWorkflow=e.params.idWorkflow,e.content=$.tmpl(t,{idCase:e.idCase})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.authentication.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_AUTHENTICATION_LOG},renderContent:function(){var e=this.getTemplate("authentication.log");return this.content=$.tmpl(e,{})}}),bizagi.workportal.widgets.activity.log.extend("bizagi.workportal.widgets.activity.log",{},{init:function(e,t,i){var a=this;a.totalPages=0,a.maxRows=10,a.maxPages=10,a.currentPage=1,a._super(e,t,i),a.loadTemplates({"activity.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log"),"activity.log.general.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-general-content"),"activity.log.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-header"),"activity.log.detail.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-header"),"activity.log.detail.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-content"),useNewEngine:!1})},postRender:function(){var e=this;e.generalContentTmpl=e.getTemplate("activity.log.general.content"),e.generalHeaderContentTmpl=e.getTemplate("activity.log.header"),e.detailHeaderTmpl=e.getTemplate("activity.log.detail.header"),e.detailContentTmpl=e.getTemplate("activity.log.detail.content"),e.logCategories={ACTIVITIES:{id:"ActivityLog",serviceMethod:"getActivityLog",detailServiceMethod:"getActivityDetailLog",selectedDetailId:0},ENTITIES:{id:"EntityLog",serviceMethod:"getEntityLog",detailServiceMethod:"getEntityDetailLog",selectedDetailId:0},USERS:{id:"UserLog",serviceMethod:"getUserLog",detailServiceMethod:"getUserDetailLog",selectedDetailId:0},ADMINISTRATION:{id:"AdminLog",serviceMethod:"getAdminLog"}},e.containtersID={GENERAL:"general",DETAIL:"detail"};var t=null!=typeof e.dataService.serviceLocator.proxyPrefix?e.dataService.serviceLocator.proxyPrefix:"";new bizagi.render.services.service({proxyPrefix:t}).getCaseNumber({idCase:e.idCase}).done(function(t){var i=t.caseNumber;e.caseNumber=i||e.idCase,e.initWidget()})},initWidget:function(){this.displayNoResults(!1),this.setupHeader()},setupHeader:function(){var e=this;content=e.getContent();var t=$("#activity-log-data-header-wrapper",content);$.when(e.dataService.supportedLogTypes()).done(function(i){$.tmpl(e.generalHeaderContentTmpl,{supportedLogTypes:i.Supported}).appendTo(t);var a=e.getFirstAvailableLogTypes(i.Supported);e.currentPage=1,e.getActivityLogByCategory(e.logCategories[a]),e.bindHeaderElementInteraction($("#LnkActivities",e.content),e.logCategories.ACTIVITIES),e.bindHeaderElementInteraction($("#LnkEntities",e.content),e.logCategories.ENTITIES),e.bindHeaderElementInteraction($("#LnkUsers",e.content),e.logCategories.USERS),e.bindHeaderElementInteraction($("#LnkAdmin",e.content),e.logCategories.ADMINISTRATION)}).fail(function(e){})},getFirstAvailableLogTypes:function(e){for(var t in this.logCategories)for(var i in e)if(this.logCategories[t].id==i&&("true"==e[i]||1==e[i]))return t;return""},bindHeaderElementInteraction:function(e,t){var i=this;e.click(function(){$(this).hasClass("active")||($(".active",i.content).removeClass("active"),$(this).addClass("active"),i.currentPage=1,i.getActivityLogByCategory(t))})},getActivityLogByCategory:function(e){var t,i=this;i.selectedCategoryObj=$.isEmptyObject(e)?i.selectedCategoryObj:$.extend({},e),t={idCase:i.idCase,idActualPage:i.currentPage,pageSize:i.maxRows},$("#activity-log-data-general-wrapper",content).addClass("ui-bizagi-component-loading"),$.when(i.dataService[i.selectedCategoryObj.serviceMethod](t)).done(function(e){i.totalPages=e.total,i.generalActivityDataValidator(e)}).fail(function(e){bizagi.showErrorAlertDialog=!1,bizagi.showMessageBox(JSON.parse(e.responseText).message,"Bizagi","Error")})},generalActivityDataValidator:function(e){var t=this,i=t.getContent();$("#activity-log-data-general-wrapper",i);if(e.rows){if(t.selectedCategoryObj.id==t.logCategories.ADMINISTRATION.id)for(var a,n=e.rows.length;n-- >0;)a=-1!==e.rows[n][3].indexOf("--\x3e")?[].concat(e.rows[n][3].split("--\x3e")[0].split(":").concat(e.rows[n][3].split("--\x3e")[1].split(": :"))):[].concat(e.rows[n][3].split("--\x3e")[0].split(":")),e.rows[n][3]=[].concat(a);t.currentLogData=[].concat(e.rows)}else t.currentLogData=[];t.renderContentByCategory()},renderContentByCategory:function(){var e=this,t=e.getContent(),i=$("#activity-log-data-general-wrapper",t);$("#activity-log-data-detail-wrapper",t);i.removeClass("ui-bizagi-component-loading"),i.empty(),e.switchContent(e.containtersID.GENERAL);var a=e.getPaginationData();$.tmpl(e.generalContentTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,logItems:e.currentLogData,pagData:a}).appendTo(i),e.setUpPagination($("#biz-wp-activitylog-category-pager ul",e.content),"getActivityLogByCategory"),e.currentLogData.length>0?(e.displayNoResults(!1),$(".activity-log-table",i).show()):(e.displayNoResults(!0),$(".activity-log-table",i).hide()),$(".detail-item",i).click(function(t){t.preventDefault(),e.selectedLogItemIndex=$($(t.currentTarget).closest("tr")[0]).index()-1,e.currentPage=1,e.preprocessDetailRender($(this))}),$(".listHeaderLinks",i).click(function(e){e.preventDefault()})},getPaginationData:function(){for(var e=this,t=e.totalPages>1,i={page:e.currentPage,pagesArray:[],pagination:t},a=e.maxPages>e.totalPages?e.totalPages:e.maxPages,n=0;n<a;n++)i.pagesArray.push(n+1);return i},setUpPagination:function(e,t){var i=this;e.bizagiPagination({maxElemShow:i.maxRows,totalPages:i.totalPages,actualPage:i.currentPage,listElement:e,clickCallBack:function(a){i.currentPage=parseInt(a.page),i[t]({},e)}})},preprocessDetailRender:function(e){var t=this,i=(t.getContent(),t.getDetailRenderParams(e));t.selectedCategoryObj.detailServiceMethod&&$.when(t.dataService[t.selectedCategoryObj.detailServiceMethod](i)).done(function(e){t.totalPages=e.total,t.switchContent(t.containtersID.DETAIL),e.rows?t.currentDetailLogData=[].concat(e.rows):t.currentDetailLogData=[],t.renderLogDetail(e)}).fail(function(e){})},getDetailRenderParams:function(e){var t,i,a=this;switch(a.selectedCategoryObj.id){case a.logCategories.ACTIVITIES.id:$.isEmptyObject(e)?i=a.logCategories.ACTIVITIES.selectedDetailId:a.logCategories.ACTIVITIES.selectedDetailId=i=e.attr("data-id"),t={idCase:a.idCase,idWorkItemFrom:i};break;case a.logCategories.ENTITIES.id:$.isEmptyObject(e)?i=a.logCategories.ENTITIES.selectedDetailId:a.logCategories.ENTITIES.selectedDetailId=i=e.attr("data-id"),t={idCase:a.idCase,idEntity:i};break;case a.logCategories.USERS.id:$.isEmptyObject(e)?i=a.logCategories.USERS.selectedDetailId:a.logCategories.USERS.selectedDetailId=i=e.attr("data-id"),t={idCase:a.idCase,idUser:i}}return $.extend(t,{idActualPage:a.currentPage,pageSize:a.maxRows}),t},renderLogDetail:function(e){var t=this,i=t.getContent(),a=$("#activity-log-data-detail-wrapper",i);a.empty(),a.removeClass("ui-bizagi-component-loading"),$.when(t.renderDetailContent()).done(function(){var e=$("#log-filter-wrapper",i);t.showDetailResultMessage(),$("#back-general-content",a).click(function(e){e.preventDefault(),t.displayNoResults(!1),t.switchContent(t.containtersID.GENERAL)}),$("#apply-filter",e).click(function(e){e.preventDefault(),t.currentPage=1,t.applyDetailFilter()}),$("#remove-filter",e).click(function(i){i.preventDefault(),$("input",e).val(""),t.currentPage=1,t.applyDetailFilter()}),$(".listHeaderLinks",a).click(function(e){e.preventDefault()})})},showDetailResultMessage:function(){var e=$("#activity-log-data-detail-wrapper",this.getContent());this.currentDetailLogData.length>0?(this.displayNoResults(!1),$(".activity-log-table",e).show()):(this.displayNoResults(!0),$(".activity-log-table",e).hide())},applyDetailFilter:function(){var e=this,t=e.getFilterParams(),i=e.getContent();e.selectedCategoryObj.detailServiceMethod&&$.when(e.dataService[e.selectedCategoryObj.detailServiceMethod](t)).done(function(t){e.totalPages=t.total,t.rows?e.currentDetailLogData=[].concat(t.rows):e.currentDetailLogData=[];var a=e.getPaginationData(),n=$.tmpl(e.detailContentTmpl,{logCategory:e.selectedCategoryObj.id,title:e.selectedCategoryObj.title,detailItems:e.currentDetailLogData,pagData:a});$("#bz-workportal-activitylog-detailcontent-wrapper",i).remove(),$(n).insertAfter("#activity-log-data-detail-header-wrapper",i),e.showDetailResultMessage(),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",i),"applyDetailFilter")})},getFilterParams:function(){var e,t,i,a=this,n=a.getContent(),s=$("#log-filter-wrapper",n),r=a.getDetailRenderParams();return a.selectedCategoryObj.id==a.logCategories.ENTITIES.id?e=$("#filterUser",s).val().toLowerCase():a.selectedCategoryObj.id==a.logCategories.USERS.id&&(i=$("#filterEntity",s).val().toLowerCase()),t=$("#filterAttribute",s).val().toLowerCase(),$.extend(r,{userFullName:e,attribDisplayName:t,entDisplayName:i}),r},renderDetailContent:function(){var e=this,t=e.getContent(),i=$.Deferred(),a=$("#activity-log-data-detail-wrapper",t),n=e.getPaginationData();return $.when($.tmpl(e.detailHeaderTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,data:e.currentLogData[e.selectedLogItemIndex]}),$.tmpl(e.detailContentTmpl,{logCategory:e.selectedCategoryObj.id,title:e.selectedCategoryObj.title,detailItems:e.currentDetailLogData,pagData:n})).done(function(t,n){a.append(t),n.insertAfter("#activity-log-data-detail-header-wrapper",a),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",e.content),"preprocessDetailRender"),i.resolve()}),i.promise()},switchContent:function(e){var t=this.getContent(),i=$("#activity-log-data-general-wrapper",t),a=$("#activity-log-data-detail-wrapper",t);this.containtersID.DETAIL==e?(i.hide(),a.show()):(i.show(),a.hide())},displayNoResults:function(e){var t=this.getContent();e?$("#activity-log-no-results",t).show():$("#activity-log-no-results",t).hide()}}),bizagi.injector.register("bizagi.workportal.widgets.activity.log",["workportalFacade","dataService",bizagi.workportal.widgets.activity.log],!0),bizagi.workportal.widgets.authentication.log.extend("bizagi.workportal.widgets.authentication.log",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"authentication.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log"),"authentication.log.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-fields"),"authentication.log.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-button"),"authentication.log.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-result"),"authentication.log.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-pagination"),useNewEngine:!1})},postRender:function(){var e=this;e.maxElemShow=10,e.maxPageToShow=5,e.generalContentTmpl=e.getTemplate("authentication.log"),e.fieldsContentTmpl=e.getTemplate("authentication.log.fields"),e.buttonContentTmpl=e.getTemplate("authentication.log.button"),e.resultContentTmpl=e.getTemplate("authentication.log.result"),e.paginationTmpl=e.getTemplate("authentication.log.pagination"),e.setupInitialData()},setupInitialData:function(){var e=this,t=e.getContent(),i=[{dataType:"domains"},{dataType:"events"},{dataType:"subEvents"}];$.when(e.dataService.getAuthenticationLogData(i[0]),e.dataService.getAuthenticationLogData(i[1]),e.dataService.getAuthenticationLogData(i[2])).done(function(i,a,n){e.eventTypeList=a[0].response,e.subEventTypeList=n[0].response;var s=$.tmpl(e.fieldsContentTmpl,{domainList:i[0],eventTypeList:a[0].response,subEvenTypes:n[0].response});t.append(s),e.setupDatePicker(),e.setupFooterButtons()}).fail(function(e){bizagi.log(e)})},setupDatePicker:function(){var e=this.getContent(),t=bizagi.localization.getResource("dateFormat").replaceAll("yyyy","yy").replaceAll("MM","mm").replaceAll("M","m"),i=bizagi.localization.getResource("timeFormat");$(".biz-wp-form-datepicker",e).datetimepicker({controlType:"select",dateFormat:t,timeFormat:i,currentText:bizagi.localization.getResource("render-timeentry-now"),closeText:bizagi.localization.getResource("workportal-general-button-label-done"),timeText:bizagi.localization.getResource("workportal-project-plan-time-title"),hourText:bizagi.localization.getResource("reports-general-hour").capitalize(),minuteText:bizagi.localization.getResource("reports-general-minute").capitalize()})},setupFooterButtons:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i);var a=$("#authentication-log-data-buttonset",t);$("#btn-authentication-search",a).click(function(i){$(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove();var a=e.validateData(),n=$("#sinceDate",t).val(),s=$("#toDate",t).val();if(""!=n&&(n=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(n,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")),""!=s&&(s=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(s,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")),a.fieldsAreEmpty||""!=a.errorMessage)bizagi.showMessageBox(a.errorMessage,"Bizagi","warning");else{var r={action:"AuthLog",domain:"none"!=$("#domainList",t).val()?$("#domainList",t).val():"",userName:$("#auth-log-user",t).val(),dtFrom:n,dtTo:s,eventSubType:$("#subEventType",t).val()!=e.subEventTypeList[0].displayName?$("#subEventType",t).val():"",eventType:$("#eventType",t).val()!=e.eventTypeList[0].displayName?$("#eventType",t).val():"",pagSize:e.maxElemShow};e.findResults(t,r)}})},validateData:function(){var e=this,t=e.getContent(),i={fieldsAreEmpty:!1,errorMessage:""},a="",n="",s=$("#sinceDate",t).val(),r=$("#toDate",t).val();return"none"==$("#domainList",t).val()&&""==$("#user",t).val()&&$("#eventType",t).val()==e.eventTypeList[0].id&&$("#subEventType",t).val()==e.subEventTypeList[0].id&&""==$("#sinceDate",t).val()&&""==$("#toDate",t).val()?(i.fieldsAreEmpty=!0,i.errorMessage=bizagi.localization.getResource("workportal-widget-authentication-log-emptyfields-message")):""!=s&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(s,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")?(n=bizagi.localization.getResource("workportal-widget-authentication-log-datesince"),a=(a=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",n),i.errorMessage=a):""!=r&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(r,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")&&(n=bizagi.localization.getResource("workportal-widget-authentication-log-dateto"),a=(a=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",n),i.errorMessage=a),i},findResults:function(e,t,i){var a=this;t.pag=i||1,$.when(a.dataService.getAuthenticationLogResult(t)).done(function(i){if($(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),a.totalRecords=i.records,a.totalPages=i.total,i.rows.length>0){var n=$.tmpl(a.resultContentTmpl,{resultList:i.rows});e.append(n);var s,r=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,o=$("#biz-wp-table-pager-wrapper"),l={};l.pagination=a.totalPages>1,l.page=i.page,l.pages={};for(var d=1;d<=r;d++)l.pages[d]={pageNumber:d};s=$.tmpl(a.paginationTmpl,l).html(),o.append(s),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){a.findResults(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")}).fail(function(e){bizagi.log(e)})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.encrypt.passwords",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ENCRYPT_PASSWORDS},renderContent:function(){var e=this.getTemplate("encrypt.passwords");return this.content=$.tmpl(e,{})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.users.requests",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_REQUESTS},renderContent:function(){var e=this.getTemplate("users.requests");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.defaults.assignation.user",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_DEFAULTS_ASSIGNATION_USER},renderContent:function(){var e,t=this.getTemplate("defaults.assignation.user");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.user.profiles",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_PROFILES},renderContent:function(){var e=this.getTemplate("user.profiles"),t=this.content=$.tmpl(e,{});return this.loadtemplates(),t},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.dimensions",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_DIMENSIONS},renderContent:function(){var e,t=this.getTemplate("dimensions");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.alarms",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ALARMS},renderContent:function(){var e=this.getTemplate("alarms");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.user.licenses",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_LICENSES},renderContent:function(){var e,t=this.getTemplate("user.licenses");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.document.templates",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_DOCUMENT_TEMPLATES},renderContent:function(){var e,t=this.getTemplate("admin.document.templates");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.processes",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PROCESSES},renderContent:function(){var e,t=this,i=t.getTemplate("admin.processes.wrapper");return t.comboProcess=t.getTemplate("admin.processes.combo.process"),t.processEditTmpl=t.getTemplate("admin.processes.proc.edit"),t.taskEditTmpl=t.getTemplate("admin.processes.task.edit"),e=t.content=$.tmpl(i,{}),t.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES},renderContent:function(){var e,t=this,i=t.getTemplate("admin.business.policies.wrapper");return t.generalContentTmpl=t.getTemplate("admin.business.policies.content"),e=t.content=$.tmpl(i,{}),t.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.decision.table",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_DECISION_TABLE},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.rules",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_RULES},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.tabs",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_TABS},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.politics",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_POLITICS},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.vocabularies",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_VOCABULARIES},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.language",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_LANGUAGE},renderContent:function(){var e,t=this,i=t.getTemplate("admin.language.wrapper");return t.panelWrapper=$.tmpl(t.getTemplate("admin.language.panel.wrapper")),t.generalTemplateListTmpl=t.getTemplate("admin.language.template.list"),t.fileCultureName=t.getTemplate("admin.language.upload.file.culturename"),t.bizagiObjectsList=t.getTemplate("admin.language.bizagi.objects.list"),t.entitiesListTmpl=t.getTemplate("admin.language.entities.list"),e=t.content=$.tmpl(i,{}),t.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.preferences",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PREFERENCES},renderContent:function(){var e,t=this.getTemplate("admin.preferences.wrapper");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.entities",{},{renderContent:function(){var e=this.getTemplate("admin.entity.wrapper");return this.content=$.tmpl(e,{}),this.loadtemplates(),this.content},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ENTITIES},getFormEntity:function(e){var t=this;t.currentGuidForm=e.guidForm,t.currentIdRow=e.idRow,bizagi.loader.start("rendering").then(function(){var i=new bizagi.rendering.facade;$.when(t.dataService.getAdminEntitiesForm(e)).done(function(a){a.form.contextType="entity",$.when(i.execute({data:a,contexttype:"entity",canvas:$("#detailEntity",t.panelWrapper),isEntityForm:!0})).done(function(i){"stakeholder"===t._referrer&&(t._associatedUser=bizagi.util.isEmpty(i.getRender("associatedUser").value)?bizagi.util.isEmpty(t._associatedUser)?void 0:t._associatedUser:i.getRender("associatedUser").value),e.idRow&&(i.surrogatekey=e.idRow),i.unbind("refresh"),i.bind("refresh",function(e,t){}),i.internalSubmitOnChange=function(e){var a=$.Deferred();return $.when(t.internalSubmitOnChangeEntity(i)).done(function(e){if(e){var n=t.getSelectedItem();n.idPageCache=i.idPageCache,n.guidForm=t.currentGuidForm,n.guid=n.guidEntity,n.idRow=t.currentIdRow,n.isStakeholder="stakeholder"===t._referrer,t.getFormEntity(n),a.resolve()}}).fail(function(){a.reject()}),a.promise()},i.processButton=function(e){if(i.endLoading(),"save"==e.action){if(i.validateForm())return $.when(t.saveFormEntity(i)).done(function(e){e&&t.drawSimpleGrid(t.getSelectedItem())})}else"cancel"===e.action&&t.drawSimpleGrid(t.getSelectedItem())}})})})},internalSubmitOnChangeEntity:function(e){var t=$.Deferred(),i=(this.getSelectedItem(),new bizagi.render.services.service),a={};return e.collectRenderValues(a),$.when(i.multiactionService.submitData({action:"SUBMITONCHANGE",contexttype:"entity",data:a,surrogatekey:void 0!==e.surrogatekey&&e.surrogatekey,idPageCache:e.idPageCache})).done(function(e){"success"==e.type?t.resolve(!0):t.reject()}).fail(function(e){bizagi.showMessageBox(e.message),t.reject()}),t.promise()}}),bizagi.workportal.widgets.admin.encrypt.passwords.extend("bizagi.workportal.widgets.admin.encrypt.passwords",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"encrypt.passwords":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.encrypt.passwords").concat("#ui-bizagi-workportal-widget-admin-encrypt-passwords"),useNewEngine:!1})},postRender:function(){var e=this;e.generalContentTmpl=e.getTemplate("encrypt.passwords"),e.setupFooterButtons(),$("#encryp-password-data-text",e.getContent()).on("paste",e.handlePaste),$("#encryp-password-data-text-confirm",e.getContent()).on("paste",e.handlePaste)},setupFooterButtons:function(){var e,t,i=this,a=i.getContent(),n={},s=$("#encryp-password-data-buttonset",a);$("#btn-encrypt",s).click(function(s){n.entry=$("#txtTextToEncrypt").val(),e=i.validateData(),t=i.comparePasswords(),e&&t?$.when(i.dataService.encryptString(n)).done(function(e){$("#txtEncryptedText",a).val(e.encryptedPassword)}).fail(function(e){}):e?t||bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-encrypt-passwords-emptyfields-message-equals"),"Bizagi","warning"):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-encrypt-passwords-emptyfields-message"),"Bizagi","warning")})},comparePasswords:function(){var e=this.getContent();return $("#txtTextToEncrypt",e).val()==$("#txtConfirmTextToEncrypt",e).val()},validateData:function(){var e=this.getContent(),t=!1;return""!=$("#txtTextToEncrypt",e).val()?t=!0:""!=$("#txtConfirmTextToEncrypt",e).val()&&(t=!0),t},handlePaste:function(e){e.stopPropagation(),e.preventDefault(),clipboardData=e.originalEvent.clipboardData||window.clipboardData,pastedData=clipboardData.getData("Text");var t=pastedData.replace(/\r?\n|\r/g,"");e.target.value=t}}),bizagi.workportal.widgets.admin.users.requests.extend("bizagi.workportal.widgets.admin.users.requests",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"users.requests":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests"),"users.requests.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-list"),"users.requests.detail":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-detail"),"users.requests.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-pagination"),"users.requests.email":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-email"),useNewEngine:!1})},postRender:function(){var e=this,t=e.getContent();e.maxElemShow=10,e.maxPageToShow=5,e.currentPage=1,e.userRequest=e.getTemplate("users.requests"),e.userRequestList=e.getTemplate("users.requests.list"),e.userRequestDetail=e.getTemplate("users.requests.detail"),e.userRequestpaginationTmpl=e.getTemplate("users.requests.pagination"),e.userRequestemailTmpl=e.getTemplate("users.requests.email"),e.userRequestListWrapper=$("#users-request-list-wrapper",t),e.userRequestDetailWrapper=$("#users-request-detail-wrapper",t),e.containtersID={LIST:"list",DETAIL:"detail"},e.setupInitialData()},setupInitialData:function(e){var t=this;t.switchContent(t.containtersID.LIST),e&&(t.currentPage=e);var i={pag:t.currentPage,pagSize:t.maxElemShow};$.when(t.dataService.userPendingRequests(i)).done(function(e){t.renderUserRequestList(e)})},authenticationInfo:function(e){var t=this,i={idUser:e};$.when(t.dataService.userAuthenticationInfo(i)).done(function(e){t.renderUserRequestDetails(e)})},renderUserRequestList:function(e){var t=this,i=t.getContent();t.userRequestListWrapper.empty();var a=$.tmpl(t.userRequestList,{userData:e.rows});bizagi.util.formatInvariantDate(a,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),t.userRequestListWrapper.append(a);var n=$("#users-requests-pager-wrapper",i);if(t.totalRecords=e.records,t.totalPages=e.total,e.rows.length>0){var s,r=t.maxPageToShow>t.totalPages?t.totalPages:t.maxPageToShow,o={};o.pagination=t.totalPages>1,o.page=e.page,o.pages={},$("#biz-wp-userrequest-norequest").css("display","none"),$("#users-request-list-wrapper .biz-wp-window ").css("display","block"),$("#users-request-list-wrapper .biz-wp-table ").css("display","table");for(var l=1;l<=r;l++)o.pages[l]={pageNumber:l};s=$.tmpl(t.userRequestpaginationTmpl,o).html(),n.append(s),$("ul").bizagiPagination({maxElemShow:t.maxElemShow,totalPages:t.totalPages,actualPage:e.page,listElement:$("#users-requests-pager-wrapper"),clickCallBack:function(e){t.setupInitialData(e.page)}})}else $("#biz-wp-userrequest-norequest").show("500"),$("#users-request-list-wrapper .biz-wp-window ").css("display","none"),$("#users-request-list-wrapper .biz-wp-table ").css("display","none");$(".selectLink",i).click(function(e){t.authenticationInfo(e.currentTarget.id)})},renderUserRequestDetails:function(e){var t,i=this,a=i.getContent(),n=$.tmpl(i.userRequestDetail,{resultAuthentication:e});i.switchContent(i.containtersID.DETAIL),i.userRequestDetailWrapper.empty(),i.userRequestDetailWrapper.append(n),i.idUser=e.idUser,i.password=e.password,i.enabled=e.Enabled,i.isExpired=e.expired,i.isLocked=e.locked,$("#btn-passwordRandom",a).click(function(){$.when(i.dataService.generateRandomPassword()).done(function(e){$("#txtPasswordRequest",a).val(e.randomPassword)})}),$("#btn-updateRequest",a).click(function(){var e=$("#txtPasswordRequest").val();t=i.validateKey(),i.password=e,t?i.dataService.generateDataToSendByEmail({idUser:i.idUser}).done(function(e){i.showEmailtPopup(e),i.updateUser()}):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-request-emptyfields-message"),"Bizagi","warning")}),$("#btn-cancelRequest",a).click(function(){i.setupInitialData()})},switchContent:function(e){var t=this;t.containtersID.DETAIL==e?(t.userRequestListWrapper.hide(),t.userRequestDetailWrapper.show()):(t.userRequestListWrapper.show(),t.userRequestDetailWrapper.hide())},updateUser:function(){var e=this.getContent(),t=1==$("#chkExpired",e).length?$("#chkExpired",e).is(":checked"):$("label[data-expired]",e).data("expired"),i={idUser:this.idUser,password:this.password,enabled:$("#chkActive").is(":checked"),expired:t,locked:$("#chkBlocked").is(":checked")};$.when(this.dataService.updateUserAuthenticationInfo(i)).done(function(e){}).fail(function(e){bizagi.log(e)})},setupFooterButtons:function(){var e=this,t=e.getContent(),i=$("#users-request-data-buttonset-Password",t);$("#btn-passwordRandom",i).click(function(){$.when(e.dataService.generateRandomPassword()).done(function(e){$("#txtPasswordRequest",t).val(e.randomPassword)})})},showEmailtPopup:function(e){var t=this,i=window.document,a=t.getTemplate("users.requests.email"),n=t.dialogBoxEmail=$("<div class= users-requests-email/>");n.empty(),n.appendTo("body",i);var s={};s[t.getResource("workportal-widget-admin-users-requests-button-label-send")]=function(){var e={eMailTo:$("#txtTextTo",n).val(),subject:$("#txtSubject",n).val(),body:$("#txtBody",n).val(),userSecret:t.getUserSecret(t.password)};$.when(t.dataService.sendUserEmail(e)).done(function(){t.closeUploadDialogEmail()}),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-request-Send-message"),"Bizagi","warning")},s[t.getResource("workportal-widget-admin-users-requests-button-label-notSend")]=function(){t.closeUploadDialogEmail()},e.body=e.body.replace(/\\n/g,"\n").replace(/\\/g,""),$.tmpl(a,{messageResponse:e}).appendTo(n),$(".ui-bizagi-loading-message").remove(),n.dialog({width:500,title:t.getResource("workportal-widget-admin-users-request-subtitle-email"),modal:!0,buttons:s,close:function(){t.closeUploadDialogEmail()},resizeStop:function(e,i){t.form&&t.form.resize(i.size)}})},closeUploadDialogEmail:function(){this.dialogBoxEmail.dialog("destroy"),this.dialogBoxEmail.remove(),this.setupInitialData()},validateKey:function(){var e=this.getContent(),t=!1;return""!==$("#txtPasswordRequest",e).val()&&(t=!0),t},getUserSecret:function(e){var t=CryptoJS,i=t.enc.Utf8.parse("pc30n84e15lvdD68"),a=CryptoJS.enc.Latin1.parse("1v00628X62bJE2mi"),n=t.algo.AES.createEncryptor(i,{mode:t.mode.CBC,padding:t.pad.Pkcs7,iv:a}).finalize(e);return t.enc.Base64.stringify(n)}}),bizagi.workportal.widgets.admin.defaults.assignation.user.extend("bizagi.workportal.widgets.admin.defaults.assignation.user",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"defaults.assignation.user":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user"),"defaults.assignation.user.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user-fields"),"defaults.assignation.user.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user-search"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.generalContent=e.getTemplate("defaults.assignation.user"),e.fieldsContent=e.getTemplate("defaults.assignation.user.fields"),e.searchContent=e.getTemplate("defaults.assignation.user.search")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.processNavigation=[],this.setupData()},setupData:function(){this.setupInitialData(),this.setupProcessTree()},setupInitialData:function(){var e=this.getContent();this.processTree="";var t=$.tmpl(this.fieldsContent,{});$("#defaults-assignation-user-home",e).append(t),this.setupSearchusersButton()},setupProcessTree:function(){var e=this,t=e.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove(),$("#processTree",t).bind("processSelected",function(){e.setupAssignationToProcess()}),e.processTree=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#processTree",t),authorizationContext:"DefaultUser"})),e.processTree.render()},setupAssignationToProcess:function(){content=this.getContent();var e={},t=this.processTree.getTreeRouteSelected();t.length>0&&(e.idWfClass=t[0]),$.when(this.dataService.getDefaultAssignationUserToProcess(e)).done(function(e){$("#txtTextUserAssignation",content).val(e.user)})},setupUsersSearchForm:function(){var e=this,t=e.getContent(),i=$.Deferred();$("#defaults-assignation-user-home").hide(),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#dinamicContent",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:i,showBackButton:!0})),e.usersTable.render(),$.when(i).done(function(i,a){$("#dinamicContent",t).html(""),$("#defaults-assignation-user-home",t).show(),a&&$("#txtTextUserAssignation",t).val(a),i&&(e.selectedUserId=i)})},saveAssignation:function(){var e=this,t=e.getContent(),i=e.processTree.getTreeRouteSelected(),a={idWfClass:i.length>0?i[0]:-1,idUser:""!=$("#txtTextUserAssignation",t).val()?e.selectedUserId:-1};-1==a.idWfClass?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail-select-process"),"Bizagi","warning"):-1==a.idUser?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail-select-user"),"Bizagi","warning"):$.when(e.dataService.setDefaultAssignationUserToProcess(a)).done(function(i){"true"===i.assigned||!0===i.assigned?(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-ok"),"Bizagi","warning"),$("#txtTextUserAssignation",t).val(""),e.setupProcessTree()):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail"),"Bizagi","warning")}).fail(function(i){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail"),"Bizagi","warning"),$("#txtTextUserAssignation",t).val(""),e.setupProcessTree(),bizagi.log(i)})},setupSearchusersButton:function(){var e=this,t=e.getContent();$("#btn-searchUser",t).click(function(){e.setupUsersSearchForm()}),$("#btn-clearUser",t).click(function(){$("#txtTextUserAssignation",t).val("")}),$("#btn-saveUser",t).click(function(){e.saveAssignation()})}}),bizagi.workportal.widgets.admin.user.profiles.extend("bizagi.workportal.widgets.admin.user.profiles",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"user.profiles":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles"),"user.profiles.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-fields"),"user.profiles.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-table"),"user.profiles.table.administrator":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-table-administrator"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.userProfilesFields=e.getTemplate("user.profiles.fields"),e.userProfilesTable=e.getTemplate("user.profiles.table"),e.userProfilesTableAdministrator=e.getTemplate("user.profiles.table.administrator")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.setupData()},setupData:function(){this.setupInitialData()},setupInitialData:function(){var e=this,t=e.getContent();$.when(e.dataService.getProfilesTypes({dataType:"profiles"}),e.dataService.getOrganizationsList()).done(function(i,a){var n=$.tmpl(e.userProfilesFields,{profileList:i[0].response,orgList:a[0].response});e.comboDefaultValue=i[0].response[0].id,$("#general-content",t).html(""),$("#general-content",t).append(n),e.setupMainButtons(),e.setupProfileComboEvent(),$("#dinamicContent",t).html(""),$("#dinamicContent2",t).html(""),$("#general-content",t).show()}).fail(function(e){bizagi.log(e)})},exportToExcel:function(){var e={filterType:this.profileTypeId,guidValueFilter:this.profileId,orgId:this.organizationId};this.dataService.exportToExcelProfiles(e)},searchProfiles:function(){var e=this,t=e.getContent(),i=$("#txtTextnameProfile",t).val();e.profileTypeId=$("#profileTypeList").val(),e.profileTypeName=$("#profileTypeList option:selected").text(),"8"==e.profileTypeId?e.organizationId=$("#organizationList",t).val():e.organizationId="";var a={action:"searchProfiles",profileName:i,profileType:e.profileTypeId,orgId:e.organizationId};$.when(e.dataService.searchProfiles(a)).done(function(i){var a=$.tmpl(e.userProfilesTable,{profileList:i.response});$("#profilesTableId").remove(),$("#general-content",t).append(a),e.setupManageLink()}).fail(function(e){bizagi.log(e)})},getUserByProfileId:function(e){var t=this,i=t.getContent();params={action:"getUsersByProfile",idProfile:e,profileType:t.profileTypeId},t.profileId=e,$("#general-content").hide(),$.when(t.dataService.getUsersByProfile(params)).done(function(e){var a=$.tmpl(t.userProfilesTableAdministrator,{userList:e.users});$("#dinamicContent",i).hide(),$("#dinamicContent2",i).html(""),$("#dinamicContent2",i).append(a),t.setupManageButtons()}).fail(function(e){bizagi.log(e)})},removeUserFromProfile:function(e){var t=this;t.getContent();params={action:"removeUserFromProfile",idProfile:t.profileId,profileType:t.profileTypeId,idUser:e},$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-user-profiles-invalidate-confirm-msg"),"Bizagi","warning")).done(function(){$.when(t.dataService.removeUserFromProfile(params)).done(function(e){e.removed?t.getUserByProfileId(t.profileId):bizagi.showMessageBox(t.getResource("workportal-widget-admin-user-profiles-message-cant-delete-user-from-organization"),t.getResource("workportal-general-word-message"),"hidden")}).fail(function(e){bizagi.log(e)})})},setupUsersSearchForm:function(){var e=this,t=e.getContent(),i=$.Deferred();$("#dinamicContent2").html(""),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#dinamicContent2",t),userLinkLabel:[bizagi.localization.getResource("workportal-general-select")],parentDef:i})),e.usersTable.render(),$.when(i).done(function(t,i){e.addUserToProfile(t)})},addUserToProfile:function(e){var t=this,i=(t.getContent(),{idProfile:t.profileId,profileType:t.profileTypeId,idUser:e});$.when(t.dataService.addUserToProfile(i)).done(function(e){t.getUserByProfileId(t.profileId)}).fail(function(e){bizagi.log(e)})},setupMainButtons:function(){var e=this,t=e.getContent();$("#btn-searchUserProfiles",t).click(function(){e.searchProfiles()}),$("#btn-clearUserProfiles",t).click(function(){$("#txtTextnameProfile",t).val(""),$("#profileTypeList").val(e.comboDefaultValue),$("#profilesTableId",t).remove(),e.setupProfileComboEvent()})},setupManageLink:function(){var e=this,t=e.getContent();$(".manageLink",t).click(function(){var t=this.getAttribute("id");e.profileId=t,e.getUserByProfileId(e.profileId)})},setupManageButtons:function(){var e=this,t=e.getContent();$("#btn-returnUserProfiles",t).click(function(){e.setupData()}),$("#btn-downloadUserProfiles",t).click(function(){e.exportToExcel()}),$("#btn-newUserProfiles",t).click(function(){e.setupUsersSearchForm()}),$(".deleteLink",t).click(function(){e.removeUserFromProfile($(this)[0].getAttribute("id"))})},setupProfileComboEvent:function(){var e=this.getContent(),t=$("#profileTypeList",e).find("option:selected").val();"8"==t&&$("#organizationListDiv").show(),$("#profileTypeList",e).change(function(){"8"==(t=$(this).find("option:selected").val())?$("#organizationListDiv").show():$("#organizationListDiv").hide()})}}),bizagi.workportal.widgets.admin.dimensions.extend("bizagi.workportal.widgets.admin.dimensions",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({dimensions:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions"),"dimensions.administrable":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-administrable"),"dimensions.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-properties"),"dimensions.edit.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-edit-properties"),"dimensions.process.tree":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-process-tree"),useNewEngine:!1}),this.isInitialLoad=!0},loadtemplates:function(){var e=this;e.generalContent=e.getTemplate("dimensions"),e.listContent=e.getTemplate("dimensions.administrable"),e.detailsContent=e.getTemplate("dimensions.properties"),e.detailsEditContent=e.getTemplate("dimensions.edit.properties"),e.detailsProcessTreeContent=e.getTemplate("dimensions.process.tree")},postRender:function(){this.setupData()},setupData:function(){this.setupInitialData()},setupInitialData:function(){var e=this,t=e.getContent(),i=$("#column-dimensions-admin-wrapper",t),a=$("#column-dimensions-properties-wrapper",t),n=$.tmpl(e.listContent,{}),s=$.tmpl(e.detailsContent,{});i.html(n),a.html(s),e.setupListProcessPanel1(),e.setupListProcessPanel2(),e.setupMainButtonsleft(),e.setupMainButtonsRight()},setupDimensionsPanel1:function(e){var t=this,i=t.getContent(),a=$.Deferred();return $.when(t.dataService.getDimensions()).done(function(n){t.dimensions=n;var s=$("#DimenListAdmin",i),r=$("#DimenListFixed",i);s.find("dt").hide(),$("dd",s).remove(),$("dd",r).remove(),$.each(n.dimensions,function(e,i){var a,n=t.isInitialLoad?"ddDimensionsSelect hiddenDimensionsSelect":"ddDimensionsSelect";bizagi.util.parseBoolean(i.administrable)?(a=s.find("dt#admin_"+i.idWfClass)).append('<dd id="'+i.id+'" class="'+n+'"><span>'+i.displayName+"</span></dd>"):(a=r.find("dt#fixed_"+i.guidWfClass.toLowerCase())).append('<dd id="'+i.guid+'" class="'+n+'"><span>'+i.displayName+"</span></dd>");a.show()}),t.isInitialLoad&&setTimeout(function(){s.find("dd").removeClass("hiddenDimensionsSelect"),r.find("dd").removeClass("hiddenDimensionsSelect")},500),t.isInitialLoad=!1,t.setupManageLink(),e&&t.setupDimensionsPanel2(),a.resolve()}),a.promise()},getProcessEntityPath:function(e){return e.split(".")[0]},getNameEntityPath:function(e){return(e=e.split(".")).shift(),e.join(".")},setupDimensionsPanel2:function(){var e=this;e.getContent();if(e.dimensions.dimensions.length>0){var t,i=e.dimensions.dimensions[0],a=i.description,n=i.displayName,s=i.id,r=i.guid||"",o=i.idWfClass,l=i.guidWfClass||"",d=i.administrable,c=i.name,p=i.entityPath;e.fullPath=p,t=e.getNameEntityPath(p),$("#lblNameRead").text(c),$("#lblDisplayNameRead").text(n),$("#lblProcessRead").text(e.getProcessEntityPath(p)),$("#lblDescriptionRead").text(a),$("#lblPhatRead").text(t),d?($("#lblId").val(s),$("#lblidWfClass").val(o)):($("#lblId").val(r),$("#lblidWfClass").val(l)),$("#lblIsAdministrable").val(d),bizagi.util.parseBoolean(d)||($("#btn-deleteDimensions").hide(),$("#btn-editDimensions").hide())}else $("#content-table-dimensions-admin").hide()},setupListProcessPanel1:function(){var e=this,t=e.getContent();$.when(e.dataService.getActiveWFClasses()).done(function(i){e.processList=i;var a=$("#DimenListAdmin",t),n=$("#DimenListFixed",t);$.each(i.WFClasses,function(e,t){a.append("<dt id=admin_"+t.id+' class="titleDimensionProcess">'+t.displayName+"</dt>"),n.append("<dt id=fixed_"+t.guid+' class="titleDimensionProcess">'+t.displayName+"</dt>")}),e.setupDimensionsPanel1(!0)})},setupListProcessPanel2:function(){this.getContent();$.when(this.dataService.getActiveWFClasses()).done(function(e){$.each(e,function(e,t){$.each(t,function(e,t){var i=t.displayName;$("#lblProcessRead").text(i)})})})},displayDimensionsById:function(e){var t=this;t.getContent();$.each(t.dimensions.dimensions,function(i,a){return void 0!==a.guid&&a.guid.toLowerCase()===e.toLowerCase()?(t.fillFieldsWithSelectedDimension(a,e),!1):void 0===a.guid&&a.id==e?(t.fillFieldsWithSelectedDimension(a,e),!1):void 0}),$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").show()},fillFieldsWithSelectedDimension:function(e,t){var i,a=this,n=(a.getContent(),e.description),s=e.displayName,r=e.name,o=e.entityPath,l=e.idWfClass,d=e.administrable;a.fullPath=o,i=a.getNameEntityPath(o),$("#lblNameRead").text(r),$("#lblDisplayNameRead").text(s),$("#lblDescriptionRead").text(n),$("#lblProcessRead").text(a.getProcessEntityPath(o)),$("#lblPhatRead").text(i),$("#lblId").val(t),$("#lblIsAdministrable").val(d),$("#lblidWfClass").val(l),a.displayProcessById(l),bizagi.util.parseBoolean(d)?($("#btn-deleteDimensions").show(),$("#btn-editDimensions").show(),$("#img_select_path").focus()):($("#btn-deleteDimensions").hide(),$("#btn-editDimensions").hide())},displayProcessById:function(e){this.getContent();$.when(this.dataService.getActiveWFClasses()).done(function(t){$.each(t,function(t,i){$.each(i,function(t,i){var a=i,n=a.Id||a.id;if(e==n){var s=a.displayName;return $("#lblProcessRead").text(s),!1}})})})},newDimensionAdmin:function(){var e=this,t=$.tmpl(e.detailsEditContent,{processList:e.processList.WFClasses});e.action="create",$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").hide(),$("#column-dimensions-properties-wrapper").append(t),e.setupManageButtons(),e.processComboOnChange(),$("#btn-newDimensions").unbind("click"),e.setupPathLink()},validateData:function(){var e,t=/[`~!@#$%^&*()|+\-=?;:..’“'"<>,€£¥•،٫؟»«\{\}\[\]\\\/]+/gi,i=this.getContent();if(""==$.trim($("#txtNameEdit",i).val())?e=bizagi.localization.getResource("workportal-widget-admin-dimensions-text-name"):""==$.trim($("#txtDisplayNameEdit",i).val())?e=bizagi.localization.getResource("workportal-widget-admin-dimensions-text-displayName"):""==$("#txtPhatEdit",i).val()&&(e=bizagi.localization.getResource("workportal-widget-admin-dimensions-text-path")),e)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-comfirm-message")+": "+e,"Bizagi","warning");else if(t.test($("#txtNameEdit",i).val()))bizagi.showMessageBox(bizagi.localization.getResource("bz-rp-sensorsedt-formvalidation-invalidcharts")+": "+bizagi.localization.getResource("workportal-widget-admin-dimensions-text-name"));else{if(!t.test($("#txtDisplayNameEdit",i).val()))return"true";bizagi.showMessageBox(bizagi.localization.getResource("bz-rp-sensorsedt-formvalidation-invalidcharts")+": "+bizagi.localization.getResource("workportal-widget-admin-dimensions-text-displayName"))}},applyDimensionsAdmin:function(){var e=this,t=(e.getContent(),$("#txtDisplayNameEdit").val()),i=$("#txtNameEdit").val(),a=$("#processTypeList").val(),n=$("#txtDescriptionEdit").val(),s={displayName:t,name:i,idWfClass:a,entityPath:e.fullPath,description:n};"true"==e.validateData()&&$.when(e.dataService.createAdministrableDimension(s)).done(function(t){t.id?(e.setupMainButtonsleft(),$("#content-table-dimensions-edit").hide(),$("#content-table-dimensions-admin").show(),$.when(e.setupDimensionsPanel1(!1)).done(function(){e.displayDimensionsById(t.id)})):bizagi.showMessageBox(t.message,"Bizagi","warning")}).fail(function(e){var t=jQuery.parseJSON(e.responseText);bizagi.showMessageBox(t.message,"Bizagi","warning")})},cancelDimensionsAdmin:function(){this.getContent();$("#content-table-dimensions-edit").remove(),this.dimensions.dimensions.length>0&&$("#content-table-dimensions-admin").show(),this.setupMainButtonsleft()},deleteDimensionsAdmin:function(e){var t=this,i=(t.getContent(),{id:$("#lblId").val(),administrable:$("#lblIsAdministrable").val()});$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-invalidate-confirm-msg"),"Bizagi","warning")).done(function(){$.when(t.dataService.deleteDimension(i)).done(function(e){t.setupData()}).fail(function(e){bizagi.log(e)})})},showEditInfo:function(){var e=this,t=$.tmpl(e.detailsEditContent,{processList:e.processList.WFClasses});e.action="edit",$("#content-table-dimensions-admin").hide(),$("#column-dimensions-properties-wrapper").append(t),$("#processTypeList").val($("#lblidWfClass").val()),$("#txtNameEdit").val($("#lblNameRead").text()),$("#txtDisplayNameEdit").val($("#lblDisplayNameRead").text()),$("#txtDescriptionEdit").val($("#lblDescriptionRead").text()),$("#txtPhatEdit").val($("#lblPhatRead").text()),e.setupManageButtons(),e.processComboOnChange(),e.setupMainButtonsleft(),e.setupPathLink(),$("#img_select_path.iconSelectPath").focus()},editDimensionsAdmin:function(){var e=this,t=(e.getContent,$("#lblId").val()),i=$("#txtDisplayNameEdit").val(),a=$("#txtNameEdit").val(),n=$("#processTypeList").val(),s=$("#txtDescriptionEdit").val(),r={id:t,displayName:i,name:a,idWfClass:n,entityPath:e.fullPath,description:s},o=e.validateData(),l=e.getNameEntityPath(e.fullPath);"true"==o&&$.when(e.dataService.editDimension(r)).done(function(r){r.id?($("#lblidWfClass").val(n),$("#lblNameRead").text(a),$("#lblDisplayNameRead").text(i),$("#lblDescriptionRead").text(s),$("#lblPhatRead").text(l),$("#lblProcessRead").text($("#processTypeList option[value="+$("#processTypeList").val()+"]").text()),$("#lblId").val(t),$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").show(),e.setupDimensionsPanel1(!1)):bizagi.showMessageBox(r.message,"Bizagi","warning")}).fail(function(e){var t=jQuery.parseJSON(e.responseText);bizagi.showMessageBox(t.message,"Bizagi","warning")})},displayPath:function(){var e=this.getContent;$("#entities-tree-wrapper",e).show(),$("#entities-tree-wrapper").draggable(),$("#shadow-panel").css({width:$(".ui-dialog").width(),height:$(".ui-dialog").height(),"background-color":"grey",opacity:.1}),this.setupEntitiesTree(),this.setupEntitiesTreeButtons()},setupEntitiesTree:function(){var e=this,t=e.getContent();e.entitiesTree=new bizagi.workportal.widgets.entitiestree(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#tree-content",t),idWfClass:$("#lblidWfClass").val()})),e.entitiesTree.render()},setupMainButtonsleft:function(){var e=this,t=e.getContent();$("#btn-newDimensions",t).click(function(){e.newDimensionAdmin()})},setupMainButtonsRight:function(){var e=this,t=e.getContent();$("#btn-editDimensions",t).click(function(){e.showEditInfo()}),$("#btn-deleteDimensions",t).click(function(){e.deleteDimensionsAdmin()})},setupManageButtons:function(){var e=this,t=e.getContent();$("#btn-applyDimensions",t).click(function(){"create"==e.action?e.applyDimensionsAdmin():e.editDimensionsAdmin()}),$("#btn-cancelDimensions",t).click(function(){e.cancelDimensionsAdmin()})},setupManageLink:function(){var e=this,t=e.getContent();$(".ddDimensionsSelect",t).click(function(){var t=this.getAttribute("id");e.dimensionId=t,e.displayDimensionsById(e.dimensionId),e.setupMainButtonsleft()})},setupPathLink:function(){var e=this,t=e.getContent();$("#img_select_path").focus(),$("#img_select_path",t).click(function(){e.displayPath()})},processComboOnChange:function(){this.getContent();$("#processTypeList").click(function(){$("#txtPhatEdit").val("")})},setupEntitiesTreeButtons:function(){var e=this,t=e.getContent();$("#btn-close-tree",t).unbind("click").bind("click",function(){$("#entities-tree-wrapper",t).hide(),$("#tree-content",t).html(""),$("#shadow-panel").removeAttr("style")}),$("#btn-cancel-tree",t).unbind("click").bind("click",function(){$("#entities-tree-wrapper",t).hide(),$("#tree-content",t).html(""),$("#shadow-panel").removeAttr("style")}),$("#btn-save-tree",t).unbind("click").bind("click",function(){var i=e.entitiesTree.getTreeRouteSelected();e.fullPath=i.path,$("#txtPhatEdit",t).val(i.name),$("#entities-tree-wrapper",t).hide(),$("#tree-content",t).html(""),$("#shadow-panel").removeAttr("style")})}}),bizagi.workportal.widgets.admin.alarms.extend("bizagi.workportal.widgets.admin.alarms",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({alarms:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms"),"alarms.task.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-list"),"alarms.task.list.item":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-list-item"),"alarms.task.detail":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail"),"alarms.task.detail.alarm.editor":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-alarm-editor"),"alarms.task.detail.list.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-list-table"),"alarms.task.detail.alarm.recipients":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-alarm-recipients"),"alarms.task.detail.alarm.recipients.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-alarm-recipients-table"),useNewEngine:!1})},postRender:function(){var e=this;e.containtersID={GENERAL:"general",DETAIL:"detail"},e.listID={APPLICATION:{name:"ListBoxApplication",update:"WORKFLOW",serviceMethod:"getApplicationCategoriesList"},WORKFLOW:{name:"ListBoxWFClass",update:"VERSION",serviceMethod:"getApplicationProcesses"},VERSION:{name:"ListBoxWFVersion",update:"TASKS",serviceMethod:"getProcessVersion"},TASKS:{name:"ListBoxWorkFlow",update:"",serviceMethod:"getProcessTasks"}},e.widgetMode={VIEW_MODE:"viewMode",EDIT_MODE:"editMode"},e.alertData={},e.taskListTmpl=e.getTemplate("alarms.task.list"),e.taskListItemTmpl=e.getTemplate("alarms.task.list.item"),e.taskDetailTmpl=e.getTemplate("alarms.task.detail"),e.taskDetailAlarmEditor=e.getTemplate("alarms.task.detail.alarm.editor"),e.taskListTableTmpl=e.getTemplate("alarms.task.detail.list.table"),e.taskDetailAlarmRecipientsTmpl=e.getTemplate("alarms.task.detail.alarm.recipients"),e.taskDetailAlarmRecipientsTableTmpl=e.getTemplate("alarms.task.detail.alarm.recipients.table"),e.initRenderTaskList()},initRenderTaskList:function(){var e=this;e.switchContent(e.containtersID.GENERAL);$.when(e.dataService.getApplicationCategoriesList({action:"Applications"})).done(function(t){e.renderTaskList(t)})},renderTaskList:function(e){var t=this,i=this.getContent(),a=$("#form-alarm-task-list",i);a.empty(),$.tmpl(t.taskListTmpl).appendTo(a),t.fillTaskListColumnByID("APPLICATION",e),$("#btn-alarms",a).click(function(e){t.alertData&&t.alertData.idTask&&""!=t.alertData.idTask&&$.when(t.dataService.getTaskAlarms({idTask:t.alertData.idTask}),t.dataService.getLapseMode(),t.dataService.getRecurrMode(),t.dataService.getScheduleType(),t.dataService.getBossList()).done(function(e,i,a,n,s,r){t.renderTaskDetail(),t.renderTaskListTable(e[0]),t.renderAlarmEditor(i[0],a[0],n[0]),t.renderAlarmRecipients(s[0],!0),t.switchContent(t.containtersID.DETAIL),t.switchWidgetMode(t.widgetMode.VIEW_MODE)})})},renderTaskDetail:function(){var e=this,t=this.getContent(),i=$("#form-alarm-task-detail",t);i.empty();var a=e.alertData.idAppText,n=e.alertData.idWFClassText,s=e.alertData.versionText,r=e.alertData.idTaskText,o=e.getTemplate("alarms.task.detail"),l=$.tmpl(o,{application:a,workflow:n,version:s,task:r});i.append(l).show(),$("#btn-alarm-browser",i).click(function(){e.alertData={},e.initRenderTaskList()}),$("#btn-disable-alarms",i).click(function(){e.callEnableDisableAlarmsService()}),$("#btn-enable-alarms",i).click(function(){e.callEnableDisableAlarmsService()}),$("#btn-save-changes",i).click(function(){var t=e.validateAlarmEditor();""==t?e.sendAlarmEditorData(!0):bizagi.showMessageBox(t,"Bizagi","warning")}),$("#btn-back",i).click(function(){e.switchWidgetMode(e.widgetMode.VIEW_MODE),e.clearSelectedAlarm(),e.resetAlarmEditor(),e.resetAlarmRecipientsTable()}),$("#btn-add-alarm",i).click(function(){var t=e.validateAlarmEditor();""==t?e.sendAlarmEditorData():bizagi.showMessageBox(t,"Bizagi","warning")})},renderAlarmEditor:function(e,t,i){var a=this,n=this.getContent(),s=$("#form-alarm-task-detail",n),r=$("#alarm-editor-form-wrapper",s);r.empty(),a.alarmEditorData||(a.localizateScheduleType(i.scheduleType),a.alarmEditorData={lapseModeList:e.lapseMode,recurrModeList:t.recurrMode,scheduleTypeList:i.scheduleType}),$.tmpl(a.taskDetailAlarmEditor,{lapseModeList:a.alarmEditorData.lapseModeList,recurrModeList:a.alarmEditorData.recurrModeList,scheduleTypeList:a.alarmEditorData.scheduleTypeList}).appendTo(r),$("input:radio[name=RadioButtonListLapseMode]",s).on("change",function(e){a.handleRadioButtonFields(e.currentTarget)}),$("input:radio[name=RadioButtonListRecurMode]",s).on("change",function(e){a.handleRadioButtonFields(e.currentTarget)}),$("#TextBoxAlarmTime",s).on("change",function(e){a.validateInputFields(e.currentTarget)}),$("#TextBoxRecurTime",s).on("change",function(e){a.validateInputFields(e.currentTarget)})},localizateScheduleType:function(e){for(var t=0;t<e.length;t+=1)e[t].displayName=bizagi.localization.getResource("workportal-general-word-time-"+e[t].displayName.toLowerCase())},sendAlarmEditorData:function(e){var t,i=this,a=this.getContent(),n=$("#form-alarm-task-detail",a),s=$("#alarm-editor-form-wrapper",n),r=$("#CheckBoxToCurrentAssignee",s).is(":checked"),o={};o.idTask=i.alertData.idTask,o.idRecurrMode=$("input:radio[name=RadioButtonListRecurMode]:checked").val(),o.idLapseMode=$("input:radio[name=RadioButtonListLapseMode]:checked").val(),o.scheduleType=$("#DropDownListRecurTime",s).val(),o.alarmTime=$("#TextBoxAlarmTime",s).val(),o.alarmRecurrTime=$("#TextBoxRecurTime",s).val(),""==o.alarmTime&&(o.alarmTime=0),""==o.alarmRecurrTime&&(o.alarmRecurrTime=0),!0===r?o.sendToCurrentAssignee=1:!1===r&&(o.sendToCurrentAssignee=0),e?(o.idAlarm=i.selectedAlarm.idAlarm,t="editAlarm"):t="addAlarm",$.when(i.dataService[t](o)).done(function(e){e.response&&i.refreshTaskListTable()})},refreshTaskListTable:function(){var e=this;e.clearSelectedAlarm(),e.resetAlarmEditor(),e.switchWidgetMode(e.widgetMode.VIEW_MODE),$.when(e.dataService.getTaskAlarms({idTask:e.alertData.idTask})).done(function(t){e.renderTaskListTable(t)})},refreshAlarmRecipientsTable:function(){var e=this,t={idAlarm:e.selectedAlarm.idAlarm};$.when(e.dataService.getAlarmRecipients(t)).done(function(t){e.renderAlarmRecipientsTable(t)})},renderTaskListTable:function(e){var t=this,i=this.getContent(),a=$("#form-alarm-task-detail",i),n=$("#alarm-list-table-wrapper",a);n.empty(),$.tmpl(t.taskListTableTmpl,{alarmList:e.alarms}).appendTo(n),t.alarmsList=[].concat(e.alarms),t.alarmsList.length>0&&"true"==t.alarmsList[0].active?t.switchEnableAlarms(!0):t.switchEnableAlarms(!1),t.selectedAlarm=void 0,$(".edit",n).click(function(e){t.switchWidgetMode(t.widgetMode.EDIT_MODE),t.clearSelectedAlarm(),$($(e.currentTarget).closest("tr")[0]).addClass("selected"),t.fillAlarmDetailForm($(e.currentTarget).data("idalarm"));var i={idAlarm:$(e.currentTarget).data().idalarm};$.when(t.dataService.getAlarmRecipients(i)).done(function(e){t.renderAlarmRecipientsTable(e)})}),$(".delete",n).click(function(e){var i=$(e.currentTarget).data("idalarm");$.when(t.dataService.deleteAlarm({idAlarm:i})).done(function(e){!0===e.response&&(t.switchWidgetMode(t.VIEW_MODE),t.refreshTaskListTable())})})},clearSelectedAlarm:function(){var e=this.getContent(),t=$("#alarm-list-table-wrapper",e);$("tr",t).removeClass("selected"),this.selectedAlarm=void 0},resetAlarmEditor:function(){for(var e=this.getContent(),t=$("#alarm-editor-form-wrapper",e),i=$("input[name = RadioButtonListLapseMode]",t).length+1;i-- >1;)$("input[name=RadioButtonListLapseMode][value="+i+"]",t)[0].checked=!1,$("input[name=RadioButtonListRecurMode][value="+i+"]",t)[0].checked=!1;$("#TextBoxAlarmTime",t).val(""),$("#TextBoxRecurTime",t).val(""),$("#DropDownListRecurTime",t).val("1"),$("#CheckBoxToCurrentAssignee",t).attr("checked",!1),this.resetAlarmRecipientsTable()},resetAlarmRecipientsTable:function(){var e=this.getContent();$("#alarm-recipients-table-wrapper",e).empty(),$("#DropDownListRecipients",e).val(0)},renderAlarmRecipients:function(e,t){var i=this,a=this.getContent(),n=$("#form-alarm-task-detail",a),s=$("#alarm-recipients-form-wrapper",n);$.tmpl(i.taskDetailAlarmRecipientsTmpl,{bossList:e.bosses}).appendTo(s),$("#btn-add-recipient",s).click(function(){if(i.currentWidgetMode==i.widgetMode.EDIT_MODE){var e={idRecipient:$("#DropDownListRecipients",s).val(),idAlarm:i.selectedAlarm.idAlarm};e.idRecipient?$.when(i.dataService.addRecipientToAlarm(e)).done(function(e){!0===e.response?i.refreshAlarmRecipientsTable():bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-error"),"Bizagi","warning")}):bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-word-select-one-option"),"Bizagi","warning")}}),$("#btn-delete-recipient",s).click(function(){if(i.currentWidgetMode==i.widgetMode.EDIT_MODE){var e=$("#alarm-recipients-table-wrapper",n),t=$("input:checked",e);if(t.length>0){for(var a=[],s=t.length;s-- >0;)a.push($(t[s]).data("idrecipient"));var r={idRecipients:JSON.stringify({recipients:a})};$.when(i.dataService.deleteRecipientsFromAlarm(r)).done(function(e){e.deletedRecipients.length>0&&i.refreshAlarmRecipientsTable()})}}})},renderAlarmRecipientsTable:function(e){var t=this.getContent(),i=$("#form-alarm-task-detail",t),a=$("#alarm-recipients-table-wrapper",i);a.empty(),$.tmpl(this.taskDetailAlarmRecipientsTableTmpl,{recipientsList:e.recipients}).appendTo(a)},fillAlarmDetailForm:function(e){for(var t,i=this.getContent(),a=$("#form-alarm-task-detail",i),n=$("#alarm-editor-form-wrapper",a),s=this.alarmsList.length;s-- >0;)if(this.alarmsList[s].idAlarm==e){t=this.alarmsList[s];break}this.selectedAlarm=t,$("input[name=RadioButtonListLapseMode][value="+t.idLapseMode+"]",n)[0].checked=!0,$("input[name=RadioButtonListRecurMode][value="+t.idRecurrMode+"]",n)[0].checked=!0,$("#TextBoxAlarmTime",n).val(t.alarmTime),$("#TextBoxRecurTime",n).val(t.alarmRecurrTime),$("#DropDownListRecurTime",n).val(t.idScheduleType),$("#CheckBoxToCurrentAssignee",n).prop("checked",t.sendToCurrAssignee)},handleRadioButtonFields:function(e){var t=this.getContent(),i=$("#alarm-editor-form-wrapper",t),a=e.value;"RadioButtonListLapseMode"==e.name?2!=a?$("#TextBoxAlarmTime",i).attr("disabled",!1):($("#TextBoxAlarmTime",i).val(""),$("#TextBoxAlarmTime",i).attr("disabled",!0)):"RadioButtonListRecurMode"==e.name&&(1!=a?($("#TextBoxRecurTime",i).attr("disabled",!0),$("#TextBoxRecurTime",i).val("")):$("#TextBoxRecurTime",i).attr("disabled",!1))},validateInputFields:function(e){var t=2147483647,i=this.getContent(),a=($("#alarm-editor-form-wrapper",i),parseInt(e.value));if(isNaN(a))e.value="";else if(a<0)e.value=-1*a;else if(a>t)e.value=t;else if("TextBoxAlarmTime"==e.id){var n=$($("input:radio[name=RadioButtonListLapseMode][checked=checked]")[0]).val(),s=a;2!=n&&a>0||"Unless the selected lapse mode is On Expiration the alarm time cannot be empty"}else if("TextBoxRecurTime"==e.id){$($("input:radio[name=RadioButtonListRecurMode][checked=checked]")[0]).val();1==n&&s>0||"Please review the Alarm Editor fields, the folowing are empty or unselected"}},validateAlarmEditor:function(){var e=this.getContent(),t="",i=$("#alarm-editor-form-wrapper",e),a=$("input:radio[name=RadioButtonListLapseMode]:checked").val(),n=$("#TextBoxAlarmTime",i).val(),s=$("input:radio[name=RadioButtonListRecurMode]:checked").val(),r=$("#TextBoxRecurTime",i).val();return a?2!=a&&n>0||2==a&&(""==n||0==n)||(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-on-expiration")+"</li>"):(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-lapse")+"</li>",""==n&&(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-timing")+" - "+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-lapse")+"</li>")),s?1!=s&&(""==r||0==r)||1==s&&r>0||(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-each-recurr")+"</li>"):(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-alarm-recur")+"</li>",""==r&&(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-timing")+" - "+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-alarm-recur-time")+"</li>")),""!=t&&(t=bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-review")+"</br></br> <ul>"+t+"</ul>"),t},fillTaskListColumnByID:function(e,t){var i=this,a=this.getContent(),n=i.listID[e],s=$("#form-alarm-task-list",a),r=$("#"+n.name,s);switch(e){case"APPLICATION":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.items}).appendTo(r);break;case"WORKFLOW":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.processes}).appendTo(r);break;case"VERSION":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.versions}).appendTo(r);break;case"TASKS":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.tasks}).appendTo(r)}r.unbind("change"),r.bind("change",function(e){i.updateListsContent(e.currentTarget)})},updateListsContent:function(e){var t=this,i=t.getListCategoryByID(e.id);t.captureSelectedData(i,e);var a=t.getElementToUpdate(e.id);if(""!=a){var n;t.processLists(e.id),n=t.setupParametersbyListID(a),$.when(t.dataService[t.listID[a].serviceMethod](n)).done(function(e){t.fillTaskListColumnByID(a,e)})}},captureSelectedData:function(e,t){var i=this;switch(e){case"APPLICATION":i.alertData.idApp=$(t.options[t.selectedIndex]).val(),i.alertData.idAppText=t.options[t.selectedIndex].text;break;case"WORKFLOW":i.alertData.idWFClass=$(t.options[t.selectedIndex]).val(),i.alertData.idWFClassText=t.options[t.selectedIndex].text;break;case"VERSION":i.alertData.version=$(t.options[t.selectedIndex]).val(),i.alertData.versionText=t.options[t.selectedIndex].text;break;case"TASKS":i.alertData.idTask=$(t.options[t.selectedIndex]).val(),i.alertData.idTaskText=t.options[t.selectedIndex].text}},setupParametersbyListID:function(e){var t={};switch(e){case"APPLICATION":t={action:"getApplications"};break;case"WORKFLOW":t.idApp=this.alertData.idApp;break;case"VERSION":t.idWFClass=this.alertData.idWFClass;break;case"TASKS":t.idWFClass=this.alertData.idWFClass,t.version=this.alertData.version}return t},resetParametersbyListID:function(e){switch(e){case"APPLICATION":this.alertData.idApp="";break;case"WORKFLOW":this.alertData.idWFClass="";break;case"VERSION":this.alertData.version="";break;case"TASKS":this.alertData.idTask=""}},processLists:function(e){var t=this,i=t.getContent(),a=$("#form-alarm-task-list",i),n=t.getElementToUpdate(e);if(""!=n)for($("#"+t.listID[n].name,a).empty(),t.resetParametersbyListID(n);""!=n;)""!=(n=t.getElementToUpdate(t.listID[n].name))&&($("#"+t.listID[n].name,a).empty(),$("#"+t.listID[n].name,a).empty())},getElementToUpdate:function(e){var t=this.getListCategoryByID(e);return this.listID[t].update},getListCategoryByID:function(e){for(var t in this.listID)if(e==this.listID[t].name)return t;return""},callEnableDisableAlarmsService:function(){var e=this,t={idTask:e.alertData.idTask};$.when(e.dataService.enableAlarm(t)).done(function(t){!0===t.response&&(e.switchEnableAlarms(),e.refreshTaskListTable())})},switchEnableAlarms:function(e){var t=this.getContent(),i=$("#form-alarm-task-detail",t);e?($("#btn-enable-alarms",i).hide(),$("#btn-disable-alarms",i).show()):($("#btn-enable-alarms",i).show(),$("#btn-disable-alarms",i).hide())},switchContent:function(e){var t=this.getContent(),i=$("#form-alarm-task-list",t),a=$("#form-alarm-task-detail",t);this.containtersID.DETAIL==e?(i.hide(),a.show()):(i.show(),a.hide())},switchWidgetMode:function(e){var t=this.getContent(),i=($("#form-alarm-task-list",t),$("#form-alarm-task-detail",t));switch(e){case this.widgetMode.VIEW_MODE:$("#btn-save-changes",i).hide(),$("#btn-back",i).hide(),$("#btn-delete-recipient",i).show(),$("#alarm-recipients-table-content",i).show(),$("#btn-add-recipient",i).show(),$("#btn-add-alarm",i).show();break;case this.widgetMode.EDIT_MODE:$("#btn-save-changes",i).show(),$("#btn-back",i).show(),$("#btn-delete-recipient",i).show(),$("#alarm-recipients-table-content",i).show(),$("#btn-add-recipient",i).show(),$("#btn-add-alarm",i).hide()}this.currentWidgetMode=e}}),bizagi.workportal.widgets.admin.user.licenses.extend("bizagi.workportal.widgets.admin.user.licenses",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"user.licenses":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.licenses").concat("#ui-bizagi-workportal-widget-admin-user-licenses"),useNewEngine:!1}),this.serviceLocator=t.serviceLocator},loadtemplates:function(){this.generalContent=this.getTemplate("user.licenses")},postRender:function(){this.setupData()},setupData:function(){this.setupInitialData(),this.setupButton()},setupInitialData:function(){this.getContent();$.when(this.dataService.licenses()).done(function(e){if("none"==e.licenseType)$("#licenseAlert").show(),$("#licenseContent").hide();else{if($("#licenseContent").show(),$("#licenseAlert").hide(),""==e.expirationDate)var t="12/31/9999";else t=e.expirationDate.substring(0,11);"Volume"==e.licenseType?$("#users").text(e.activeUsers+" "+bizagi.localization.getResource("workportal-widget-admin-user-licenses-titles-usersLicenses-text")):$("#users").text(e.activeUsers+"/"+e.licensedUsersAccount+"  "+bizagi.localization.getResource("workportal-widget-admin-user-licenses-titles-usersLicenses-text")),$("#licenses").text(e.customerName),$("#date").text(t),$("#licenseType").text(e.licenseType),$("#licenseCluster").text(e.clustered)}$("#cases-tabs").tabs()})},setupButton:function(){var e=this,t=e.getContent();$("#btn-buyNowLicenses",t).click(function(e){window.open("http://www.bizagi.com/","name","height=600,width=1000,resizable=yes")}),$("#btn-auditLicenses",t).click(function(t){$.when(e.dataService.getAuditLicense()).done(function(e){}).fail(function(e){})}),e.downloadBPUs()},downloadBPUs:function(){var e=this,t=e.getContent();$("#btn-download-bpus",t).click(function(t){var i=e.serviceLocator.getUrl("downloadBPUsReport");bizagi.util.downloadFile(i,!0)})}}),bizagi.workportal.widgets.admin.document.templates.extend("bizagi.workportal.widgets.admin.document.templates",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.document.templates":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates"),"admin.document.templates.upload.template":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates-upload-template"),"admin.document.templates.uploaded.templates.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates-uploaded-template-list"),useNewEngine:!1})},postRender:function(){var e=this;e.uploadTemplateTmpl=e.getTemplate("admin.document.templates.upload.template"),e.uploadedTemplatesTmpl=e.getTemplate("admin.document.templates.uploaded.templates.list"),e.lockedInteractions=!1,e.config={maxSize:"31457280",validExtensions:".bdt",xpath:"documentTemplates",uploadDialogTemplateName:"upload.template.dialog"},e.renderUploadForm(),e.initUploadedTemplates()},initUploadedTemplates:function(){var e=this,t=e.getContent();$("#uploaded-template-list-wrapper",t).empty(),$.when(e.dataService.storeDocumentTemplates()).done(function(t){e.renderUploadedTemplates(t)})},renderUploadForm:function(){var e=this,t=e.getContent(),i=$("#template-upload-form-wrapper",t);$.tmpl(e.uploadTemplateTmpl).appendTo(i);var a=null!=typeof e.dataService.serviceLocator.proxyPrefix?e.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then(function(){var t=new bizagi.rendering.facade({proxyPrefix:a});e.dialogTemplate=t.deviceFactory.cachedFactory.getTemplate(e.config.uploadDialogTemplateName),e.dialogTemplate?e.addFormInteractions():$.when(t.deviceFactory.getRenderFactory()).done(function(){e.dialogTemplate=t.deviceFactory.cachedFactory.getTemplate(e.config.uploadDialogTemplateName),e.addFormInteractions()})})},renderUploadedTemplates:function(e){var t=this,i=t.getContent(),a=$("#uploaded-template-list-wrapper",i);a.empty(),$.tmpl(t.uploadedTemplatesTmpl,{documentTemplates:e.documentTemplate}).appendTo(a),$(".template-to-recover",a).click(function(e){if(e.preventDefault(),!t.lockedInteractions){t.lockedInteractions=!0;var i={Guid:$(e.currentTarget).data("guid")};$.when(t.dataService.restoreDocumentTemplates(i)).done(function(e){t.lockedInteractions=!1,e.DocumentTemplateRestored&&(t.initUploadedTemplates(),t.displayMessage(e))})}})},addFormInteractions:function(){var e=this,t=e.getContent(),i={};i.addUrl=e.dataService.serviceLocator.getUrl("admin-document-templates-uploadDocumentTemplate"),i.xpath=e.config.xpath,i.idRender="",i.xpathContext="",i.idPageCache="",i.sessionId="",i.validExtensions=e.config.validExtensions,i.maxSize=e.config.maxSize,i.contexttype="",i.maxfiles="1",i.filesCount="";var a=$("#template-upload-form-wrapper",t);$(".ui-bizagi-render-upload-wrapper",a).bizagiUpload({renderReference:this,dialogTemplate:e.dialogTemplate,properties:{url:i.addUrl,xpath:i.xpath,idRender:i.idRender,xpathContext:i.xpathContext,idPageCache:i.idPageCache,idSession:i.sessionId,validExtensions:i.validExtensions,maxSize:i.maxSize,contexttype:i.contexttype},onUploadFileCompletedCallback:function(t,i){e.displayMessage(JSON.parse(i)),e.initUploadedTemplates()},maxAllowedFiles:i.maxfiles,uploadedFiles:i.filesCount,dialogTitle:e.getResource("render-upload-link-label")})},displayMessage:function(e){var t=this.getContent(),i=$("#message-container",t);i.show(),1==e.DocumentTemplateRestored?($("#template-uploaded",i).hide(),$("#template-recovered",i).show(),$("#template-no-results",i).hide()):1==e.DocumentTemplateUploaded?($("#template-uploaded",i).show(),$("#template-recovered",i).hide(),$("#template-no-results",i).hide()):($("#template-uploaded",i).hide(),$("#template-recovered",i).hide(),$("#template-no-results",i).show())}}),bizagi.workportal.widgets.admin.processes.extend("bizagi.workportal.widgets.admin.processes",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.processes.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-wrapper"),"admin.processes.combo.process":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-combo-process"),"admin.processes.proc.edit":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-process-edit"),"admin.processes.task.edit":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-task-edit"),useNewEngine:!1})},postRender:function(){var e=this;e.formType={TASK_FORM:"task",PROCESS_FORM:"process"},e.containersMode={VIEW_MODE:"viewMode",EDIT_MODE:"editMode"},$.when(e.dataService.getWorkFlowClasses()).done(function(t){e.processesData=t,e.renderSections()})},renderSections:function(){var e=this,t=(e.getContent(),$("#processes-header-wrapper",e.content));$.tmpl(e.comboProcess).appendTo(t);var i=$("#admin-processes-map-wrapper",e.content),a=$("#ui-process-name",e.content);e.renderProcessesCombo(a),e.renderProcessesEditWrapper(),e.loadProcessData("1"),e.renderTaskEditWrapper(),e.displayTaskEdit(!1),e.renderProcessViewer(i)},loadProcessData:function(e){var t=this,i=t.processesData.processes.length;for(t.currentSelectedProcessData={};i-- >0;)if(e==t.processesData.processes[i].id){t.currentSelectedProcessData=t.processesData.processes[i];break}t.bindProcessDetail();var a={idWorkflow:e};$.when(t.dataService.getTaskByWorkFlow(a)).done(function(e){t.processTaskData=e})},renderProcessViewer:function(e){var t=this,i="processId="+t.currentSelectedProcessData.id;t.viewerPlugin&&t.viewerPlugin.processviewer("destroy");t.dataService;$.when(t.dataService.processDefinition(i),t.dataService.graphicInfo(i)).done(function(i,a){t.processTaskDefinition=i[0].flowElements,t.viewerPlugin=e.processviewer({height:400,width:"100%",jsonBizagi:{processDefinition:i[0],processGraphicsInfo:a[0]},zoomRange:5}),setTimeout(function(){$(".processviewer-hotspot").click(function(e){e.preventDefault(),t.preprocessBindTaskDetail(this.id)})},150)})},renderProcessesCombo:function(e){var t=this,i=(t.getContent(),$.Deferred()),a={combo:[],id:"processName"};return $.each(t.processesData.processes,function(e,t){a.combo.push({id:t.id,name:t.name})}),e.empty(),e.uicombo({isEditable:!1,data:a,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){i.resolve()},onChange:function(e){t.loadProcessData(e.ui.data("value")),t.loadSelectedTask(e.ui.data("value"),-1)},initValue:a.combo[0]}),i},renderProcessesEditWrapper:function(){var e=this,t=e.getContent(),i=$("#process-edit-wrapper",t);$.tmpl(e.processEditTmpl).appendTo(i),e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE),$("#btn-process-edit",i).click(function(){e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.EDIT_MODE)}),$("#btn-process-apply",i).click(function(){e.saveProcess(),e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE)}),$("#btn-process-cancel",i).click(function(){e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE)}),$("#txt-process-duration-edit-days",i).on("change",function(t){$(this).val(e.correctIntegerInInput($(this).val(),0,1e3,0))}),$("#txt-process-duration-edit-hours",i).on("change",function(t){$(this).val(e.correctIntegerInInput($(this).val(),0,23,0))}),$("#txt-process-duration-edit-minutes",i).on("change",function(t){$(this).val(e.correctIntegerInInput($(this).val(),0,59,0))})},renderTaskEditWrapper:function(){var e=this,t=e.getContent(),i=$("#task-edit-wrapper",t);$.tmpl(e.taskEditTmpl).appendTo(i),e.switchFormState(e.formType.TASK_FORM,e.containersMode.VIEW_MODE),$("#btn-task-edit",i).click(function(){e.switchFormState(e.formType.TASK_FORM,e.containersMode.EDIT_MODE)}),$("#btn-task-apply",i).click(function(){e.saveTask(),e.switchFormState(e.formType.TASK_FORM,e.containersMode.VIEW_MODE)}),$("#btn-task-cancel",i).click(function(){e.switchFormState(e.formType.TASK_FORM,e.containersMode.VIEW_MODE)}),$("#txt-task-duration-edit-days",i).on("change",function(t){$(this).val(e.correctIntegerInInput($(this).val(),0,1e3,0))}),$("#txt-task-duration-edit-hours",i).on("change",function(t){$(this).val(e.correctIntegerInInput($(this).val(),0,23,0))}),$("#txt-task-duration-edit-minutes",i).on("change",function(t){$(this).val(e.correctIntegerInInput($(this).val(),0,59,0))})},bindProcessDetail:function(){var e=this,t=e.getContent(),i=$("#process-edit-wrapper",t);e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE),e.parseObjectTime(e.currentSelectedProcessData),$("#process-name",i).text(e.currentSelectedProcessData.name),$("#process-description",i).text(e.currentSelectedProcessData.description),$("#process-duration",i).text(e.currentSelectedProcessData.durationText),$("#txt-process-duration-edit-days",i).val(e.currentSelectedProcessData.durationDays),$("#txt-process-duration-edit-hours",i).val(e.currentSelectedProcessData.durationHours),$("#txt-process-duration-edit-minutes",i).val(e.currentSelectedProcessData.durationMinutes),e.currentSelectedTaskData=void 0,e.displayTaskEdit(!1)},preprocessBindTaskDetail:function(e){var t=this.getTaskByID(e);t?this.bindTaskDetail(t):this.displayTaskEdit(!1)},bindTaskDetail:function(e){var t=this,i=t.getContent(),a=$("#task-edit-wrapper",i),n=e;t.shouldShowTaskProperties(n)?(t.displayTaskEdit(!0),t.switchFormState(t.formType.PROCESS_FORM,t.containersMode.VIEW_MODE),t.switchFormState(t.formType.TASK_FORM,t.containersMode.VIEW_MODE),t.parseObjectTime(n),t.currentSelectedTaskData=n,$("#task-name",a).text(t.currentSelectedTaskData.name),$("#task-description",a).text(t.currentSelectedTaskData.description),$("#task-duration",a).text(t.currentSelectedTaskData.durationText),$("#txt-task-duration-edit-days",a).val(t.currentSelectedTaskData.durationDays),$("#txt-task-duration-edit-hours",a).val(t.currentSelectedTaskData.durationHours),$("#txt-task-duration-edit-minutes",a).val(t.currentSelectedTaskData.durationMinutes)):(t.currentSelectedTaskData=void 0,t.displayTaskEdit(!1))},getTaskByID:function(e){for(var t=this.processTaskData.Tasks.length;t-- >0;)if(e==this.processTaskData.Tasks[t].guid)return this.processTaskData.Tasks[t]},shouldShowTaskProperties:function(e){return e.idTaskType&&(2==e.idTaskType||7==e.idTaskType||14==e.idTaskType||21==e.idTaskType||38==e.idTaskType||39==e.idTaskType||41==e.idTaskType)},displayTaskEdit:function(e){var t=this.getContent(),i=$("#task-edit-wrapper",t);e?i.show():i.hide()},switchFormState:function(e,t){var i=this,a=i.getContent();switch(t){case i.containersMode.VIEW_MODE:e==i.formType.PROCESS_FORM?($("#process-view-fields-wrapper",a).show(),$("#process-edit-fields-wrapper",a).hide()):e==i.formType.TASK_FORM&&($("#task-view-fields-wrapper",a).show(),$("#task-edit-fields-wrapper",a).hide());break;case i.containersMode.EDIT_MODE:"process"==e?($("#process-view-fields-wrapper",a).hide(),$("#process-edit-fields-wrapper",a).show()):e==i.formType.TASK_FORM&&($("#task-view-fields-wrapper",a).hide(),$("#task-edit-fields-wrapper",a).show())}},loadSelectedTask:function(e,t){this.getContent();var i=$("#admin-processes-map-wrapper",this.content);this.renderProcessViewer(i)},correctIntegerInInput:function(e,t,i,a){var n=this.tryParseInt(e,a);return n<t?t:n>i?i:n},tryParseInt:function(e,t){var i=t;return null!=e&&jQuery.trim(new String(e)).length>0&&(isNaN(e)||(i=parseInt(e))),i},saveProcess:function(){var e=this,t=e.getContent(),i=$("#process-edit-wrapper",t),a=e.getMinutesFromTimeUnits($("#txt-process-duration-edit-days",i).val(),$("#txt-process-duration-edit-hours",i).val(),$("#txt-process-duration-edit-minutes",i).val()),n={};n.idWorkflow=e.currentSelectedProcessData.id,n.duration=a,NaN!=a&&$.when(e.dataService.modifyProcessDuration(n)).done(function(t){t.workflow&&(e.currentSelectedProcessData.duration=t.workflow.duration,e.bindProcessDetail())})},saveTask:function(){var e=this,t=e.getContent(),i=$("#task-edit-wrapper",t),a=e.getMinutesFromTimeUnits($("#txt-task-duration-edit-days",i).val(),$("#txt-task-duration-edit-hours",i).val(),$("#txt-task-duration-edit-minutes",i).val()),n={};n.idTask=e.currentSelectedTaskData.id,n.duration=a,NaN!=a&&$.when(e.dataService.modifyTaskDuration(n)).done(function(t){t.task&&(e.currentSelectedTaskData.duration=t.task.duration,e.bindTaskDetail(e.currentSelectedTaskData))})},getMinutesFromTimeUnits:function(e,t,i){return 480*parseInt(e)+60*parseInt(t)+parseInt(i)},parseObjectTime:function(e){var t=this.getTimeArrayFromMinutes(e.duration);e.durationText=this.getDurationStringFromMinutes(e.duration),e.durationDays=t[0],e.durationHours=t[1],e.durationMinutes=t[2]},getTimeArrayFromMinutes:function(e){return[(e=this.tryParseInt(e,0))/480|0,e%480/60|0,e%60]},getDurationStringFromMinutes:function(e){var t=this.getTimeArrayFromMinutes(e),i=t[0]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-day")+" ";return i+=t[1]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-hour")+":",i+=t[2]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-minute")},displayTaskEdit:function(e){var t=this.getContent(),i=$("#task-edit-wrapper",t);e?i.show():i.hide()}}),bizagi.workportal.widgets.admin.business.policies.extend("bizagi.workportal.widgets.admin.business.policies",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-wrapper"),"admin.business.policies.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-content"),useNewEngine:!1})},postRender:function(){this.setupData()},setupData:function(){var e=this.getContent(),t=$.tmpl(this.generalContentTmpl,{});e.append(t)},setupPoliciesTree:function(){var e=this,t=e.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove(),e.processTree=new bizagi.workportal.widgets.tree(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#processTree",t)})),e.processTree.render()}}),bizagi.workportal.widgets.admin.business.policies.decision.table.extend("bizagi.workportal.widgets.admin.business.policies.decision.table",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.decision.table.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-decision-table-wrapper"),"admin.business.policies.decision.table.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-decision-table-content"),useNewEngine:!1})},renderContent:function(){var e,t=this,i=t.getTemplate("admin.business.policies.decision.table.wrapper");return t.decisionTableContent=t.getTemplate("admin.business.policies.decision.table.content"),e=t.content=$.tmpl(i,{}),t.params.canvas&&(e=$(t.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.business.policies.rules.extend("bizagi.workportal.widgets.admin.business.policies.rules",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.rules.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-rules-wrapper"),"admin.business.policies.rules.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-rules-content"),useNewEngine:!1})},renderContent:function(){var e,t=this,i=t.getTemplate("admin.business.policies.rules.wrapper");return t.decisionTableContent=t.getTemplate("admin.business.policies.rules.content"),e=t.content=$.tmpl(i,{}),t.params.canvas&&(e=$(t.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.business.policies.tabs.extend("bizagi.workportal.widgets.admin.business.policies.tabs",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.tabs.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-tabs-wrapper"),"admin.business.policies.tabs.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-tabs-content"),useNewEngine:!1})},renderContent:function(){var e,t=this,i=t.getTemplate("admin.business.policies.tabs.wrapper");return t.decisionTableContent=t.getTemplate("admin.business.policies.tabs.content"),e=t.content=$.tmpl(i,{}),t.params.canvas&&(e=$(t.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.business.policies.politics.extend("bizagi.workportal.widgets.admin.business.policies.politics",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.politics.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-politics-wrapper"),"admin.business.policies.politics.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-politics-content"),useNewEngine:!1})},renderContent:function(){var e,t=this,i=t.getTemplate("admin.business.policies.politics.wrapper");return t.decisionTableContent=t.getTemplate("admin.business.policies.politics.content"),e=t.content=$.tmpl(i,{}),t.params.canvas&&(e=$(t.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.language.extend("bizagi.workportal.widgets.admin.language",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.language.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-wrapper"),"admin.language.panel.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-panel-wrapper"),"admin.language.template.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-template-list"),"admin.language.upload.file.culturename":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-combo-culturename"),"admin.language.bizagi.objects.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-bizagi-objects-list"),"admin.language.entities.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-entities-list"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.config={maxSize:"10000000",validExtensions:".xlsx",uploadFormTemplateName:"bizagi.workportal.desktop.fileupload.form",cultureName:"en"},e.generalUploadFile=e.workportalFacade.getTemplate("admin.language.upload.file"),e.formTemplate1=e.workportalFacade.getTemplate(e.config.uploadFormTemplateName),e.formTemplate2=e.workportalFacade.getTemplate(e.config.uploadFormTemplateName),e.formTemplate3=e.workportalFacade.getTemplate(e.config.uploadFormTemplateName),e.formTemplate4=e.workportalFacade.getTemplate(e.config.uploadFormTemplateName)},postRender:function(){var e=this,t=e.getContent();e.startTab="entities",e.loadtemplates(),e.setupData(),$.when(e.initLanguageTemplatesList(e.startTab)).done(function(i){e.renderUploadForm(),e.initBizagiObjectsList(),e.initEntities(),t.html(e.panelWrapper),session.isProduction||$("#tab_reset").parent().addClass("hidden"),$("#admin-language-wrapper").tabs(),$("#entities_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),$("#entities-accordion").accordion({heightStyle:"content"}),e.activeTab=e.startTab,e.handleTabEvents(),e.keyEntityValidation(e.panelWrapper)})},setupData:function(){this.getContent()},renderUploadForm:function(){this.getContent();var e=$("#languages-upload-form-wrapper",this.panelWrapper),t=$("#massive-resources-upload-form-wrapper",this.panelWrapper);e.empty(),t.empty()},initLanguageTemplatesList:function(e){var t=$.Deferred(),i=this,a=(i.getContent(),$("#"+e+"-language-list-wrapper",i.panelWrapper));return a.empty(),$.when(i.dataService.getStoreLanguageTemplates()).done(function(n){var s;n.result.sort(function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}),i.templateList=n,s="all"===e?i.getResource("workportal-widget-admin-language-all-language-list"):i.getResource("workportal-widget-admin-language-current-language-settings"),$.tmpl(i.generalTemplateListTmpl,{languageTemplates:n.result,listTitle:s,source:e}).appendTo(a),i.downloadTemplateEvent(e),t.resolve(),i.addUploadMassiveResources(),"reset"===e&&i.initReset()}),t.promise()},initBizagiObjectsList:function(){var e,t=this;e=$("#bizagi-objects-list-wrapper",t.panelWrapper),$.when(this.dataService.getBizagiObjects()).done(function(i){i.result.sort(function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}),t.bizagiObjects=i.result,$.tmpl(t.bizagiObjectsList,{elementList:t.bizagiObjects}).appendTo(e),t.bizagiObjectsEvents()})},bizagiObjectsEvents:function(){var e=this;$("table tr",".objects-container").bind("selectstart",function(e){e.preventDefault()}),$(".ui-bizagi-object").click(function(){$("td",this).hasClass("bizagi-objects-object-selected")?$("td",this).removeClass("bizagi-objects-object-selected"):$("td",this).addClass("bizagi-objects-object-selected")}),$(".objects-buttons").click(function(e){e.preventDefault()}),$("#move-all-objects-right").click(function(){$("#table-objects-selected tbody").append($("#table-bizagi-ojects-list td").closest("tr")),$("#table-objects-selected tbody tr td").removeClass("bizagi-objects-object-selected"),$("#table-objects-selected tbody tr").show(),e.readyToDownload("bizagi_objects")}),$("#move-objects-right").click(function(){$("#table-objects-selected tbody").append($("#table-bizagi-ojects-list .bizagi-objects-object-selected").closest("tr")),$("#table-objects-selected tbody tr td").removeClass("bizagi-objects-object-selected"),e.readyToDownload("bizagi_objects")}),$("#move-objects-left").click(function(){$("#table-bizagi-ojects-list tbody").append($("#table-objects-selected .bizagi-objects-object-selected").closest("tr")),$("#table-bizagi-ojects-list tbody tr td").removeClass("bizagi-objects-object-selected"),e.readyToDownload("bizagi_objects")}),$("#move-all-objscts-left").click(function(){$("#table-bizagi-ojects-list tbody").append($("#table-objects-selected td").closest("tr")),$("#table-bizagi-ojects-list tbody tr td").removeClass("bizagi-objects-object-selected"),e.readyToDownload("bizagi_objects")})},initEntities:function(){var e,t=this;e=$("#entities-list-wrapper",t.panelWrapper),$.when(this.dataService.getEntitiesList()).done(function(i){i.entities.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),t.entitiesList=i.entities,$.tmpl(t.entitiesListTmpl,{elementList:t.entitiesList}).appendTo(e),t.entitiesEvents()})},entitiesEvents:function(){var e=this;$("table tr",".entities-container").bind("selectstart",function(e){e.preventDefault()}),$("#ui-entities-filter").keyup(function(){var e=$(this).val();$("#table-entities-list .ui-bizagi-entity").show(),e&&$("#table-entities-list .ui-bizagi-entity").not(":FilterEntity("+e+")").hide()}),$.expr[":"].FilterEntity=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$(".ui-bizagi-entity").click(function(){$("td",this).hasClass("bizagi-entities-entity-selected")?$("td",this).removeClass("bizagi-entities-entity-selected"):$("td",this).addClass("bizagi-entities-entity-selected")}),$(".entities-buttons").click(function(e){e.preventDefault()}),$("#move-all-right").click(function(){$("#table-entities-selected tbody").append($("#table-entities-list td").closest("tr")),$("#table-entities-selected tbody tr td").removeClass("bizagi-entities-entity-selected"),$("#table-entities-selected tbody tr").show(),e.readyToDownload("entities")}),$("#move-right").click(function(){$("#table-entities-selected tbody").append($("#table-entities-list .bizagi-entities-entity-selected").closest("tr")),$("#table-entities-selected tbody tr td").removeClass("bizagi-entities-entity-selected"),e.readyToDownload("entities")}),$("#move-left").click(function(){$("#table-entities-list tbody").append($("#table-entities-selected .bizagi-entities-entity-selected").closest("tr")),$("#table-entities-list tbody tr td").removeClass("bizagi-entities-entity-selected"),e.readyToDownload("entities")}),$("#move-all-left").click(function(){$("#table-entities-list tbody").append($("#table-entities-selected td").closest("tr")),$("#table-entities-list tbody tr td").removeClass("bizagi-entities-entity-selected"),e.readyToDownload("entities")})},getEntitiesSelected:function(){var e=$("#table-entities-selected tbody tr"),t=[];return $.each(e,function(e,i){t.push($(i).data("id"))}),t},getObjectsSelected:function(){var e=$("#table-objects-selected tbody tr"),t=[];return $.each(e,function(e,i){t.push($(i).data("value"))}),t},initAllLangs:function(){this.allLangsEvents()},allLangsEvents:function(){var e=this;$("input.ui-all-languages-filter").keyup(function(){var e=$(this).val();$(".ui-bizagi-grid-table .ui-bizagi-language").show(),e&&$(".ui-bizagi-grid-table .ui-bizagi-language").not(":FilterLanguage("+e+")").hide()}),$.expr[":"].FilterLanguage=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},e.modifiedLangs={},$("#all-language-list-wrapper .ui-bizagi-cell-readonly").find("input[type=checkbox]").on("change",function(){var t,i=$(this);t=i.attr("value"),$.each(e.modifiedLangs,function(i,a){var n;for(n in a)n===t&&delete e.modifiedLangs[t]}),e.modifiedLangs[t]=!!i.is(":checked")}),$("#all-language-list-wrapper #save-lang-list-btn").on("click",function(){e.saveLangsList()})},saveLangsList:function(){var e,t=this;e={languages:this.modifiedLangs},$.when(this.dataService.setLanguages(JSON.stringify(e))).done(function(e){var i;e.result?$("#tab_all_languages").click():((i=$("#all-language-list-wrapper .multilang-error-msg")).removeClass("dp-hidden"),setTimeout(function(){i.addClass("dp-hidden")},5e3),$.each(t.modifiedLangs,function(e,t){var i=$("#all-language-list-wrapper .ui-bizagi-cell-readonly").find("input[value="+e+"]");t?i.removeAttr("checked"):i.prop("checked",!0)})),t.modifiedLangs={}})},initReset:function(){this.resetEvents(),$("#message-container").hide(),$("#template-reset").hide()},resetEvents:function(){var e=this;$("button#lang-reset-btn").on("click",function(){e.loadingOption(),$("#message-container").hide(),$("#template-reset").hide();var t=bizagi.localization.getResource("workportal-widget-admin-language-reset-confirmation");$.when(bizagi.showConfirmationBox(t,"Bizagi","warning")).done(function(){$.when(e.dataService.resetPersonalization()).done(function(e){e.result&&($("#message-container").show(),$("#template-reset").show())})}),e.notLoading()})},loadingOption:function(){$("div.ui-dialog").append("<div class='loading-language ui-bizagi-loading-icon'><div class='loading-language-icon'></div></div>")},notLoading:function(){$("div.loading-language").remove(),$("body").removeClass("cursor-loading")},addUploadMassiveResources:function(){var e=this,t=$("#internals",e.panelWrapper),i=$("#extended",e.panelWrapper),a=$("#bizagi_objects",e.panelWrapper),n=$("#entities_localization ",e.panelWrapper),s=e.dataService.serviceLocator.getUrl("admin-language-entities"),r=e.dataService.serviceLocator.getUrl("admin-language-resource");e.renderUploadPlugin(t,e.formTemplate1,r,"internals"),e.renderCultureCombo(t,e.panelWrapper),e.renderUploadPlugin(i,e.formTemplate2,r,"extended"),e.renderCultureCombo(i,e.panelWrapper),e.renderUploadPlugin(a,e.formTemplate3,r,"objects"),e.renderCultureCombo(a),e.renderUploadPlugin(n,e.formTemplate4,s,"entities"),e.renderCultureCombo(n)},renderUploadPlugin:function(e,t,i,a){var n=this,s={};s.addUrl=i,s.validExtensions=n.config.validExtensions,s.maxSize=n.config.maxSize,s.maxfiles="1",s.filesCount="",$("#massive-resources-upload-form-wrapper",e).bizagiFileUpload({showLoading:!0,alerFailtAfterUpload:n.getResource("workportal-widget-admin-language-alert-fail-after-upload"),formTemplate:t,properties:{cultureName:n.config.cultureName,url:s.addUrl,validExtensions:s.validExtensions,maxSize:s.maxSize,xpath:a},onUploadFileCompletedCallback:function(e,t){var i=n.validateEntitiesModified(t);bizagi.showMessageBox(bizagi.localization.getResource(i.messageKey)+i.entities,"Bizagi","info"),n.handleResponse("alert-upload-massive-resources-template",t),$("div.loading-language").remove(),$("body").removeClass("cursor-loading")},onUploadFileFailCallback:function(e){console.log(e),$("div.loading-language").remove(),$("body").removeClass("cursor-loading")},onUploadFileProcess:function(){$("div.ui-dialog").append("<div class='loading-language ui-bizagi-loading-icon'><div class='loading-language-icon'></div></div>")},maxAllowedFiles:s.maxfiles,uploadedFiles:s.filesCount})},validateEntitiesModified:function(e){var t=JSON.parse(e),i="",a="workportal-widget-admin-language-alert-after-upload";switch(t.message){case"success":if(""!=t.detail){var n=""==t.detail?[]:JSON.parse(t.detail);a="workportal-widget-admin-language-alert-no-access-rights-after-upload",n.length>0&&(i=": "+n.join(", "),a="workportal-widget-admin-language-alert-entities-authorized-after-upload")}break;case"unauthorized":a="workportal-widget-admin-language-alert-no-access-rights-after-upload"}return{messageKey:a,entities:i}},renderCultureCombo:function(e){var t=this,i=(t.getContent(),$.Deferred()),a={combo:[],id:"cultureName"};a.combo.push({id:"default",name:""}),$.each(t.templateList.result,function(e,t){t.enabled&&a.combo.push({id:t.key,name:t.value})});var n=$(".ui-bizagi-culturecombo",e);return n.empty(),n.uicombo({isEditable:!1,data:a,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){$("[name='cultureName']",e).val(a.combo[0].id),i.resolve()},onChange:function(i){var a=$("button#upload-file","#"+t.activeTab+"_upload_file"),n=i.ui.data("value");"default"!==n?a.prop("disabled",!1):a.prop("disabled",!0),$("[name='cultureName']",e).val(n)},initValue:a.combo[0]}),i},handleResponse:function(e,t){var i,a="Error";0==t.length?this.initLanguageTemplatesList(this.startTab):(response=JSON.parse(t),void 0!==response.detail&&(a=response.detail.length>200?response.detail.substring(0,197)+" ...":response.detail),i=bizagi.localization.getResource(response.message),$("#"+e).html(i+" : "+a),$("#"+e).parent().removeClass("ui-hidden"))},downloadTemplateEvent:function(e){var t=this,i=$("#"+e+"-language-list-wrapper .ui-bizagi-grid-table",t.panelWrapper),a=$(".lang-list-button button#"+e+"-tmpl-download-btn",t.panelWrapper);i.find('input[type="radio"]').click(function(n){t.readyToDownload(e,i,a)}),a.click(function(a){var n,s,r,o;a.preventDefault(),o={cultureName:i.find('input[type="radio"]:checked').data("guid")},"bizagi_objects"===e?(n={elements:t.getObjectsSelected()},o.elements=JSON.stringify(n)):"entities"===e?(s={entities:t.getEntitiesSelected()},o.entities=JSON.stringify(s)):"extended"===e&&(r={elements:["extended"]},o.elements=JSON.stringify(r)),t.dataService.getLanguageTemplate(o)})},readyToDownload:function(e,t,i){var a=!1,n=!1;t||(t=$("#"+e+"-language-list-wrapper .ui-bizagi-grid-table",this.panelWrapper)),i||(i=$(".lang-list-button button#"+e+"-tmpl-download-btn",this.panelWrapper)),"internals"===e?a=!0:"extended"===e?a=!0:"bizagi_objects"===e?a=this.getObjectsSelected().length>0:"entities"===e&&(a=this.getEntitiesSelected().length>0),t.find('input[type="radio"]:checked').length>0&&(n=!0),a&&n?i.removeAttr("disabled"):i.attr("disabled",!0)},keyEntityValidation:function(e){bizagi.menuSecurity.MultilanguageEntities&&!bizagi.menuSecurity.Multilanguage&&$("#admin-language-wrapper-tabs > li:not(:has(#tab_entities_localization))",e).hide()},handleTabEvents:function(){var e=this,t=!1,i=$("#admin-language-wrapper");e.getContent(),$(".ui-tabs-anchor","#admin-language-wrapper").click(function(){$("#message-container").hide(),$("#template-reset").hide(),$("input.ui-all-languages-filter").val("")}),$("#tab_internals").click(function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("internals")).done(function(a){$("#internals_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),e.activeTab="internals",i.tabs("enable"),t=!1}))}),$("#tab_extended").click(function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("extended")).done(function(a){$("#extended_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),e.activeTab="extended",i.tabs("enable"),t=!1}))}),$("#tab_bizagi_objects").click(function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("bizagi_objects")).done(function(a){$("#bizagi_objects_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),$("#bizagi-objects-accordion").accordion({heightStyle:"content"}),e.activeTab="bizagi_objects",i.tabs("enable"),t=!1}))}),$("#tab_entities_localization").click(function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("entities")).done(function(a){$("#entities_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),$("#entities-accordion").accordion({heightStyle:"content"}),e.activeTab="entities",i.tabs("enable"),t=!1}))}),$("#tab_all_languages").click(function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("all")).done(function(a){e.initAllLangs(),e.activeTab="all",i.tabs("enable"),t=!1}))}),$("#tab_reset").click(function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("reset")).done(function(a){e.allLangsEvents(),e.activeTab="reset",i.tabs("enable"),t=!1}))}),$(".tab_upload_file").click(function(t){e.addUploadMassiveResources()}),$("#tab_reset").parent().hide(),$("#tab_internals").parent().show()}}),bizagi.workportal.widgets.admin.preferences.extend("bizagi.workportal.widgets.admin.preferences",{},{init:function(e,t,i){var a=this;a.bizagiUserPreferences=new bizagi.services.preferences,a.guidForm,a.isNewForm,a.notifier=bizagi.injector.get("notifier"),a.notifier=bizagi.injector.get("notifier"),a._super(e,t,i),a.loadTemplates({"admin.preferences.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-admin-preferences-wrapper"),"admin.preferences.container":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-container"),"admin.preferences.buttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preference-buttons"),"admin.preferences.iframe":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preference-iframe"),"admin.preferences.error":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-errormessage"),"admin.preferences.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-properties"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.container=e.getTemplate("admin.preferences.container"),e.buttons=e.getTemplate("admin.preferences.buttons"),e.iframe=e.getTemplate("admin.preferences.iframe"),e.errorMessage=e.getTemplate("admin.preferences.error"),e.propertiesTmpl=e.getTemplate("admin.preferences.properties")},postRender:function(){var e=this;$.when(e.dataService.getPreferenceFormParams()).done(function(t){e.guidForm="-1"!==t.id?t.id:"",!0===t.errorMessage?e.renderErrorMessage():!0===t.isNewForm?e.renderPreferences():e.renderPreferencesOldForm()})},renderErrorMessage:function(){var e=this.getResource("workportal-widget-admin-entities-message-migrate");e=e.replace("{build}",bizagi.loader.productBuildToAbout);var t=$.tmpl(this.errorMessage,{errorMessage:e});this.content.html(t)},setupData:function(){this.getContent()},renderPreferencesOldForm:function(){var e=this.getContent(),t=this.dataService.getUrl({endPoint:"PreferenceFormOld"})+"?idForm="+this.guidForm+"&referer=userPreferences",i=$.tmpl(this.iframe,{url:t}),a=$("iframe",i);i.addClass("loading-iframe"),a.hide(),a.load(function(){$(this).fadeIn()}),e.html(i)},renderPreferences:function(){var e=this,t=new $.Deferred,i=e.getContent();e.currentUser=bizagi.currentUser.idUser;var a={h_action:"LOADUSERPREFERENCESFORM",h_contexttype:"entity",h_guidForm:e.guidForm},n=$.tmpl(e.container);return bizagi.loader.start("rendering").then(function(){var s=new bizagi.rendering.facade;e.dataService.getPreferencesForm(a).done(function(a){var r={canvas:n,data:a,type:""};s.execute(r).done(function(a){$("#preferences-tabs").tabs(),$("#properties",i).html($.tmpl(e.propertiesTmpl,e.bizagiUserPreferences.getFormatValues(),{formatTime:e.bizagiUserPreferences.formatTime}));var r=!0;1==bizagi.menuSecurity.OpenWindowsMaximized&&($("#displayoptions_OpenWindowsMaximized",i).show(),r=!1),1==bizagi.menuSecurity.AlwaysCollapseActivitySidebars&&($("#displayoptions_collapseSidebars",i).show(),r=!1),r&&$("#noPermission",i).show(),$("#preferences-tabs-ul").show(),e.preferenceForm=s.form,e.preferenceForm&&e.preferenceForm.properties&&(!e.preferenceForm.properties.contexttype&&(e.preferenceForm.properties.contexttype="entity")),$("#preferences",i).html(n),i.find("#preferences-buttons").css("display","block"),e.handleEvents(),t.resolve()})})}),t},handleEvents:function(){var e=this,t=e.getContent();$("#preferences-buttons",t).html($.tmpl(e.buttons)),$("#update-preferences",t).click(function(t){e.updateData()})},updatePreferences:function(){var e=this.getResource("workportal-widget-admin-preferences-error-same-value"),t=(this.getContent(),{}),i=$(".preferences-properties").serialize()||"";(i=decodeURIComponent(i.replace(/\+/g,"%20"))).split("&").map(function(e,i){var a=e.split("=");""!=a[1]&&(t[a[0]]=a[1])}),t.numberRows=bizagi.services.preferences().getValue("numberRows"),","!==t.decimalSeparator||t.thousandSeparator||(t.thousandSeparator="."),"."!==t.thousandSeparator||t.decimalSeparator||(t.decimalSeparator=","),t.decimalSeparator&&t.decimalSeparator===t.thousandSeparator?bizagi.showMessageBox(e,"Error"):(this.bizagiUserPreferences.setValues(t),this.notifier.showSucessMessage(bizagi.localization.getResource("workportal-widget-admin-displayoptions-success"),bizagi.localization.getResource("workportal-menu-preferences"),""))},updateData:function(){var e=this;if(e.preferenceForm.validateForm()){var t=new bizagi.render.services.service,i=e.preferenceForm.collectRenderValuesForSubmit(),a=e.getContent();e.startLoading(a),$.when(t.multiactionService.submitData({action:"SAVEUSERPREFERENCES",contexttype:"entity",data:i,surrogatekey:e.currentUser,idPageCache:e.preferenceForm.idPageCache})).done($.proxy(function(t){i.language?$.when(e.dataService.getCurrentUser()).done(function(t){$.when(assignLanguage(t.language)).done(function(){bizagi.util.changeData({language:t.language}),e.executeRender()}).fail(function(){})}).fail(function(){}):e.executeRender(),e.updatePreferences()},i)).fail(function(t){var i=bizagi.localization.getResource("workportal-general-word-message");bizagi.showMessageBox(t.message,i),e.executeRender()})}else $("#preferences-tabs").tabs({active:0})},executeRender:function(){var e=this.getContent();$.when(this.renderPreferences()).done(function(){e.removeClass("loading-iframe")}).fail(function(){})},startLoading:function(e){e.find("#preferences-main-container").css("display","none"),e.find("#preferences-buttons").css("display","none"),e.addClass("loading-iframe")}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.displayOptions",{},{init:function(e,t,i){this.notifier=bizagi.injector.get("notifier"),this.notifier=bizagi.injector.get("notifier"),this._super(e,t,i),this.loadTemplates({"admin.displayOptions.container":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.displayOptions").concat("#ui-bizagi-workportal-widget-admin-display-options-container")})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PREFERENCES},renderContent:function(){var e;return e=this.content=$("<div></div>"),this.loadtemplates(),e},loadtemplates:function(){this.containerTemplate=this.getTemplate("admin.displayOptions.container").markup},postRender:function(){var e=this,t=e.containerTemplate;e.displayOptionsInstance=new Vue({template:t,data:{maximizeModals:{label:"",value:!1,hover:!1},startPage:{label:"",input:"-------------",selected:"",focus:!1,values:[{value:"",displayName:"render-combo-empty-value"},{value:"1",displayName:"workportal-widget-admin-displayoptions-startpage-auto"},{value:"2",displayName:"workportal-widget-admin-displayoptions-startpage-me"},{value:"3",displayName:"workportal-widget-admin-displayoptions-startpage-inbox"}]},defaultTitle:"",updatetTitle:"",OpenWindowsMaximized:!1,showStartPageControl:!1},computed:{activeIndex:function(){return this.findIndex(this.startPage.input,this.startPage)}},methods:{getResource:function(e){return window.bizagi.localization.getResource(e)},setHover:function(e){this.maximizeModals.hover=e},setFocus:function(e){this.startPage.focus=e},chooseValue:function(e){this.startPage.input=e.displayName,this.startPage.selected=e.value,this.setFocus(!1)},debounce:bizagi.util.debounce(function(e,t){e.apply(this,[t])},200),keyup:function(e){switch(e.keyCode){case 13:this.chooseEnter();break;case 38:case 40:this.changeOffset(e.keyCode-39);default:this.setFocus(!0)}},chooseEnter:function(){var e=this.activeIndex,t=this.startPage.values[e];this.startPage.input=t.displayName,this.startPage.selected=t.value,this.startPage.focus=!1},changeOffset:function(e){var t=this.activeIndex;(t+=e)>-1&&t<this.startPage.values.length&&(this.startPage.input=this.startPage.values[t].displayName)},findIndex:function(e){var t,i=-1;return(t=this.findMatches(e))&&(i=this.startPage.values.findIndex(function(e){return e.value===t.value})),i},findMatches:function(e){return this.startPage.values.find(function(t){return t.displayName.toLowerCase().indexOf(e.toLowerCase())>-1})},defaultConfigurations:function(){this.startPage.selected="",this.startPage.input="-------------",this.maximizeModals.value=!1},getRowValueCookie:function(){var e="";return bizagi.cookie("bizagiUserDisplayOptions")&&(e=JSON.parse(bizagi.cookie("bizagiUserDisplayOptions"))),e},updateConfigurations:function(){var t="10";this.getRowValueCookie()&&this.getRowValueCookie().numberRows&&(t=this.getRowValueCookie().numberRows);var i={startPage:"",maximizeModals:"",numberRows:t};this.showStartPageControl?""!==this.startPage.selected&&(i.startPage=this.startPage.selected):i.startPage="",this.OpenWindowsMaximized?i.maximizeModals=this.maximizeModals.value?"yes":"no":i.maximizeModals="no",bizagi.cookie("bizagiUserDisplayOptions",JSON.stringify(i)),e.notifier.showSucessMessage(bizagi.localization.getResource("workportal-widget-admin-displayoptions-success"),bizagi.localization.getResource("workportal-menu-display-options"),"")}},components:{},created:function(){this.maximizeModals.label=this.getResource("workportal-widget-admin-displayoptions-maxmodals"),this.startPage.label=this.getResource("workportal-widget-admin-displayoptions-startpage"),this.defaultTitle=this.getResource("workportal-widget-admin-displayoptions-default"),this.updatetTitle=this.getResource("workportal-widget-admin-displayoptions-update"),this.startPage.values.forEach($.proxy(function(e){e.displayName=this.getResource(e.displayName)},this));var e="";if(bizagi.cookie("bizagiUserDisplayOptions")){e=JSON.parse(bizagi.cookie("bizagiUserDisplayOptions"));var t=this.startPage.values.find(function(t){return t.value===e.startPage});this.startPage.selected=t.value,this.startPage.input=t.displayName,this.maximizeModals.value="yes"===e.maximizeModals}},mounted:function(){},destroyed:function(){}}),e.renderingDeferred.then($.proxy(e.mountView,e))},mountView:function(){var e=this,t=e.getContent();e.security=new bizagi.workportal.command.security(e.dataService),$.when(e.security.getSecurity()).done(function(i){!1===bizagi.override.enableMaximizeModalsOption&&(i.OpenWindowsMaximized=!1),e.displayOptionsInstance.OpenWindowsMaximized=i.OpenWindowsMaximized,e.displayOptionsInstance.showStartPageControl=bizagi.override.enableStartPageDisplayOption,setTimeout(function(){e.displayOptionsInstance.$mount(t[0])},100)})},dispose:function(){this._super(),this.displayOptionsInstance.$destroy()}}),bizagi.workportal.widgets.admin.entities.extend("bizagi.workportal.widgets.admin.entities",{},{init:function(e,t,i){var a=this,n="bizagi.workportal.desktop.widgets.admin.entities";a._super(e,t,i),a._referrer="entity",a.loadTemplates({"admin.entity.wrapper":bizagi.getTemplate(n).concat("#ui-bizagi-workportal-widget-admin-entity-wrapper"),"admin.entity.panel.wrapper":bizagi.getTemplate(n).concat("#ui-bizagi-workportal-widget-admin-entity-panel-wrapper"),"admin.entity.list":bizagi.getTemplate(n).concat("#ui-bizagi-workportal-widget-admin-entity-list"),"admin.entity.error":bizagi.getTemplate(n).concat("#ui-bizagi-workportal-widget-admin-entity-error"),useNewEngine:!1}),a._state={},a.setInitialState()},loadtemplates:function(){var e=this;e.panelWrapper=$.tmpl(e.getTemplate("admin.entity.panel.wrapper")),e.entitiesList=e.getTemplate("admin.entity.list"),e.entitiesError=e.getTemplate("admin.entity.error")},postRender:function(){var e=this,t=e.getContent();t.empty(),$.when(e.dataService.getAdminEntitiesList()).done(function(i){if(i.length>0){e.entities=i;var a=$("#admin-entity-list-wrapper",e.panelWrapper);t.html(e.panelWrapper),$.tmpl(e.entitiesList,{entitiesList:e.entities}).appendTo(a),$("#entitiesList option:first",a).attr("selected","selected"),e.configureHandlers()}else{var n=e.getResource("workportal-general-first-line-no-records-found");t.html($.tmpl(e.entitiesError,{errorMessage:n}))}}).fail(function(i){e.entities=void 0;var a=e.getResource("workportal-widget-admin-entities-error");t.html($.tmpl(e.entitiesError,{errorMessage:a}))})},configureHandlers:function(){var e=this,t=$("#admin-entity-list-wrapper",e.panelWrapper);$("#searchEntity",t).keyup(function(){var i=$(this).val().toLowerCase();$.each(e.entities,function(){var e=$('#entitiesList option[value="'+this.guid+'"]',t);i.length>1?-1!=this.displayName.toLowerCase().indexOf(i)?$(e).parent("span.toggleOption").length&&$(e).unwrap():0==$(e).parent("span.toggleOption").length&&$(e).wrap('<span class="toggleOption" style="display: none;" />'):$(e).parent("span.toggleOption").length&&$(e).unwrap()})}),$("#entitiesList",t).change(function(){$("#entitiesList>span>option:selected",e.panelWrapper).prop("selected",!1),e.setInitialState(),e.drawSimpleGrid({page:1})}).trigger("change")},drawSimpleGrid:function(e){var t=this,i=$.extend(t.getSelectedItem(),e);if(i.idDisplayForm&&"00000000-0000-0000-0000-000000000000"!=i.idDisplayForm){var a={guid:i.guidEntity,guidForm:i.idDisplayForm,isStakeholder:!1};$.when(t.dataService.getAdminEntitiesForm(a)).done(function(e){t.performSimpleGrid(i,e)})}else t.performSimpleGrid(i)},resolveEntityForm:function(e){var t,i,a,n,s,r,o,l,d,c=this,p=new $.Deferred,g={},u=function(e){var t=[];return e=e||{},$.each(e,function(e,i){i.container?t.push.apply(t,u(i.container.elements)):t.push(i.render.properties)}),t},m=function(t,i){var a=[];return t=u(t||{}),$.each(t,function(t,n){var s,r,o=n.dataType,l=(s=n,r="",$.each(e.header,function(e,t){t.fieldValue==s.xpath&&(t.entity||t.relatedEntity)&&(r=t.entity||t.relatedEntity)}),r),d={};switch(n.type){case"upload":o=1002;break;case"image":o=1003}d=$.extend(n,{guidAttribute:h(i,n.xpath),fieldValue:n.xpath,attributeType:o}),l&&(d.relatedEntity=l),a.push(d)}),a},h=function(e,t){var i=e.filter(function(e){return t==e.fieldValue});return i.length>0?i[0].guidAttribute:void 0},w=(a=[],(i=(i=e)||{}).row&&$.each(i.row,function(e,t){a.push(t[0])}),a);return $.when((n=w,s=new $.Deferred,r=[],o=[],l=c.getSelectedItem(),d={guid:l.guidEntity,guidForm:l.idDisplayForm,isStakeholder:!1},0==(n=n||[]).length?$.when(c.dataService.getAdminEntitiesForm(d)).done(function(e){t||(t=e),s.resolve([])}):($.each(n,function(e,t){var i=bizagi.clone(d);i.idRow=t,o.push(c.dataService.multiaction().getAdminEntitiesForm(i))}),$.when.apply($,o).done(function(){var e=Array.prototype.slice.call(arguments);$.map(e,function(e,i){t||(t=e);var a=u(e.form.elements),o=[n[i]];$.each(a,function(e,t){var i=t.value;switch(t.type){case"image":case"upload":i="...";break;case"boolean":i=t.value?"X":"";break;case"combo":i="object"==typeof t.value&&t.value.length>0?"object"==typeof t.value[0].value?t.value[0].value.join(","):t.value[0].value:""}o.push(i)}),r.push(o),r.length==n.length&&s.resolve(r)})})),s.promise())).done(function(i){var a=[e.header[0]];a.push.apply(a,m(t.form.elements,e.header)),g={header:a,entity:e.entity,row:i,total:e.total,page:e.page,records:e.records},p.resolve(g)}),p.promise()},performSimpleGrid:function(e,t){var i=this,a={allowAdd:e.allowAdd,allowEdit:e.allowEdit,displayName:e.displayName,page:i.getCurrentPageToSimpleGrid(),pageSize:10,page:parseInt(e.page)||1,orderField:e.orderField||"",orderType:e.orderType||"asc",filters:e.filters,onDataBinding:function(a){a.pag=a.pag||i.getCurrentPageToSimpleGrid();var n=$.Deferred();return a.pag&&i.setSelectedItem("page",a.pag),$.when(i.dataService.getAdminEntitiesRowData($.extend(a,{guidEntity:e.guidEntity}))).done(function(a){if(e.guidEntity==i.getSelectedItem().guidEntity)if(t){a.relatedEntity=e.guidEntity;i.reshapeEntity(a,t);$.when(i.resolveEntityForm(a)).done(function(e){n.resolve(e)})}else n.resolve(a)}).fail(function(e){var t=i.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:t}))}),n.promise()},onLoadFilter:function(e){if("Entity"===e.type)return i.dataService.getAdminEntityData(e)},onFilterChanged:function(){i.setInitialState()},onPageChanging:function(e,t){i.setCurrentPageToSimpleGrid(t)},onAdd:function(e,t){i.validateVersionForm(this,"New")},onEdit:function(e,t){i.validateVersionForm(t,"Edit")},getResource:function(e){i.getResource(e)}};$("#admin-entity-instances-wrapper",i.panelWrapper).simpleGrid(i,a).render()},getSelectedItem:function(){var e=$("#entitiesList option:selected",this.panelWrapper);return{guidEntity:e.val(),displayName:e.text(),allowAdd:"true"===e.attr("data-allowAdd").toLowerCase(),allowEdit:"true"===e.attr("data-allowEdit").toLowerCase(),idDisplayForm:e.attr("data-idDisplayForm"),page:e.attr("data-page"),row:this.currentIdRow,orderField:e.data("orderField"),orderType:e.data("orderType"),filters:e.data("filters")}},setSelectedItem:function(e,t){$("#entitiesList option:selected",this.panelWrapper).attr("data-"+e,t)},validateVersionForm:function(e,t){var i=this,a=$("#entitiesList option:selected",i.panelWrapper),n=i.entities.find(function(e){return e.guid===a.val()}),s={guid:a.val()};"New"===t?s.guidForm=void 0!==n.idAddForm?n.idAddForm:"00000000-0000-0000-0000-000000000000":"Edit"==t&&(s.idRow=$(e).attr("data-idrowentity"),s.guidForm=void 0!==n.idEditForm?n.idEditForm:"00000000-0000-0000-0000-000000000000"),$("#detailEntity",i.panelWrapper).empty(),"00000000-0000-0000-0000-000000000000"===s.guidForm?i.getFormEntity(s):$.when(i.dataService.getAdminEntityMigrated(s.guidForm)).done(function(e){if(0==e.result||10==e.result)i.getFormEntity(s);else if(-9==e.result){var a=i.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:a}))}else{"New"==t&&(s.idRow=-1);var n="App/Admin/Entity.aspx?giudEntity="+s.guid+"&idSurrogateKey="+s.idRow+"&referer=entityadmin&Action="+t+"&idForm="+s.idForm;i.loadIframeForm(n,"otherForm")}})},saveFormEntity:function(e){var t=$.Deferred(),i=(this.getSelectedItem(),new bizagi.render.services.service),a={};return e.collectRenderValues(a),$.when(i.multiactionService.submitData({action:"SAVE",contexttype:"entity",data:a,surrogatekey:void 0!==e.surrogatekey&&e.surrogatekey,idPageCache:e.idPageCache})).done(function(e){"success"==e.type?t.resolve(!0):t.reject()}).fail(function(e){bizagi.showMessageBox(e.message),t.reject()}),t.promise()},reshapeEntity:function(e,t){var i=this,a={};a.entity=e.entity,a.page=e.page,a.records=e.records,a.total=e.total,a.header=[],a.row=[];var n=[];$.each(t.form.elements,function(t,s){i.mergeFormAndTable(s,a,n,e)}),n.push(e.header.length-1);var s=e.header.slice(-1).pop();if(a.header.push(s),-1==n.indexOf(0)){e.header[0].dataType=-11;var r=e.header[0];a.header.unshift(r),n.unshift(0)}var o=0;return $.each(e.row,function(e,t){for(var i=[],s=0;s<n.length;s++)o=n[s],i[s]=t[o];a.row[e]=i}),a},renderTable:function(e,t,i,a){if(e.container)for(var n=0;n<e.container.elements.length;n++)this.renderTable(e.container.elements[n],t,i,a);else $.each(a.header,function(a,n){e.render.properties.xpath&&e.render.properties.xpath.toUpperCase()==n.fieldValue.toUpperCase()&&(t.header.push($.extend(n,e.render.properties)),i.push(a))})},mergeFormAndTable:function(e,t,i,a){if(e.container)for(var n=0;n<e.container.elements.length;n++)this.renderTable(e.container.elements[n],t,i,a);else $.each(a.header,function(a,n){e.render.properties.xpath&&e.render.properties.xpath.toUpperCase()==n.fieldValue.toUpperCase()&&(t.header.push($.extend(n,e.render.properties)),i.push(a))})},getCurrentPageToSimpleGrid:function(){return this._state.currentPageGrid},setCurrentPageToSimpleGrid:function(e){this._state.currentPageGrid=e},setInitialState:function(){this.setCurrentPageToSimpleGrid("1")}}),bizagi.workportal.widgets.admin.entities.extend("bizagi.workportal.widgets.admin.stakeholders",{},{init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.stakeholders";this._super(e,t,i),this._referrer="stakeholder",this.loadTemplates({"admin.entity.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-wrapper"),"admin.stakeholder.panel.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-panel-wrapper"),"admin.stakeholder.list":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-list"),"admin.stakeholder.error":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-error"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.panelWrapper=$.tmpl(e.getTemplate("admin.stakeholder.panel.wrapper")),e.stakeholdersList=e.getTemplate("admin.stakeholder.list"),e.stakeholdersError=e.getTemplate("admin.stakeholder.error")},postRender:function(){var e=this,t=e.getContent();t.empty(),$.when(e.dataService.getAdminStakeholdersList()).done(function(i){if(i.length>0){e.stakeholders=i;var a=$("#admin-stakeholder-list-wrapper",e.panelWrapper);t.html(e.panelWrapper),$.tmpl(e.stakeholdersList,{stakeholdersList:e.stakeholders}).appendTo(a),$("#stakeholdersList option:first",a).attr("selected","selected"),e.configureHandlers()}else{var n=e.getResource("workportal-general-first-line-no-records-found");t.html($.tmpl(e.stakeholdersError,{errorMessage:n}))}}).fail(function(i){e.stakeholders=void 0;var a=e.getResource("workportal-widget-admin-stakeholders-error");t.html($.tmpl(e.stakeholdersError,{errorMessage:a}))})},configureHandlers:function(){var e=this,t=$("#admin-stakeholder-list-wrapper",e.panelWrapper);$("#searchStakeholder",t).keyup(function(){var i=$(this).val().toLowerCase();$.each(e.stakeholders,function(){var e=$('#stakeholdersList option[value="'+this.guid+'"]',t);i.length>1?-1!=this.displayName.toLowerCase().indexOf(i)?$(e).parent("span.toggleOption").length&&$(e).unwrap():0==$(e).parent("span.toggleOption").length&&$(e).wrap('<span class="toggleOption" style="display: none;" />'):$(e).parent("span.toggleOption").length&&$(e).unwrap()})}),$("#stakeholdersList",t).change(function(){$("#stakeholdersList>span>option:selected",e.panelWrapper).prop("selected",!1),e.setInitialState(),e.drawSimpleGrid()}).trigger("change")},drawSimpleGrid:function(){var e=this,t=e.getSelectedItem();if(t.idDisplayForm&&"00000000-0000-0000-0000-000000000000"!=t.idDisplayForm){var i={guid:t.guidEntity,guidForm:t.idDisplayForm,isStakeholder:!1};$.when(e.dataService.getAdminEntitiesForm(i)).done(function(t){e.performSimpleGrid(t)})}else e.performSimpleGrid()},performSimpleGrid:function(e){var t=this,i=t.getSelectedItem(),a={allowAdd:i.allowAdd,allowEdit:i.allowEdit,displayName:i.displayName,page:t.getCurrentPageToSimpleGrid(),pageSize:7,orderField:i.orderField||"",orderType:i.orderType||"asc",filters:i.filters,onDataBinding:function(a){a.pag=t.getCurrentPageToSimpleGrid();var n=$.Deferred();return $.when(t.dataService.getAdminEntitiesRowData($.extend(a,{guidEntity:i.guidEntity}))).done(function(i){if(e){var a=t.reshapeEntity(i,e);n.resolve(a)}else n.resolve(i)}).fail(function(e){var i=t.getResource("workportal-widget-admin-stakeholders-instances-error");$("#admin-stakeholder-instances-wrapper",t.getContent()).html($.tmpl(t.stakeholdersError,{errorMessage:i}))}),n.promise()},onLoadFilter:function(e){if("Entity"===e.type)return t.dataService.getAdminEntityData(e)},onFilterChanged:function(){t.setInitialState()},onPageChanging:function(e,i){t.setCurrentPageToSimpleGrid(i)},onAdd:function(e,i){t.validateVersionForm(this,"New")},onEdit:function(e,i){t.validateVersionForm(i,"Edit")},getResource:function(e){t.getResource(e)}};$("#admin-stakeholder-instances-wrapper",t.panelWrapper).simpleGrid(t,a).render()},getSelectedItem:function(){var e=$("#stakeholdersList option:selected",this.panelWrapper);return{guidEntity:e.val(),displayName:e.text(),allowAdd:"true"===e.attr("data-allowAdd").toLowerCase(),allowEdit:"true"===e.attr("data-allowEdit").toLowerCase(),idDisplayForm:e.attr("data-idDisplayForm"),row:this.currentIdRow,orderField:e.data("orderField"),orderType:e.data("orderType"),filters:e.data("filters")}},validateVersionForm:function(e,t){var i=this,a=$("#stakeholdersList option:selected",i.panelWrapper),n=i.stakeholders.find(function(e){return e.guid===a.val()}),s={guid:a.val(),isStakeholder:!0};"New"===t?s.guidForm=void 0!==n.idAddForm?n.idAddForm:"00000000-0000-0000-0000-000000000000":"Edit"==t&&(s.idRow=$(e).attr("data-idrowentity"),s.guidForm=void 0!==n.idEditForm?n.idEditForm:"00000000-0000-0000-0000-000000000000"),$("#detailEntity",i.panelWrapper).empty(),"00000000-0000-0000-0000-000000000000"===s.guidForm?i.getFormEntity(s):$.when(i.dataService.getAdminEntityMigrated(s.guidForm)).done(function(e){if(0==e.result||10==e.result)i.getFormEntity(s);else if(-9==e.result){var a=i.getResource("workportal-widget-admin-stakeholders-instances-error");$("#admin-stakeholder-instances-wrapper",i.getContent()).html($.tmpl(i.stakeholdersError,{errorMessage:a}))}else{"New"==t&&(s.idRow=-1);var n="App/Admin/Entity.aspx?giudEntity="+s.guid+"&idSurrogateKey="+s.idRow+"&referer=entityadmin&Action="+t+"&idForm="+s.idForm;i.loadIframeForm(n,"otherForm")}})},saveFormEntity:function(e){var t=this,i=$.Deferred(),a=t.getSelectedItem(),n={};return e.collectRenderValues(n),t.associatedUserHasChange(n)?$.when(t.dataService.getUserStakeholders({idUser:n.associatedUser.id})).done(function(s){if(s.length>0)if(void 0!==s.find(function(e){return e.idEntity===a.guidEntity})){var r=bizagi.localization.getResource("render-stakeholder-delete-associate-instance-other-user-confirm-msg");$.when(bizagi.showConfirmationBox(r,"Bizagi","warning")).done(function(){t.submitFormData(e,n,i)}).fail(function(){i.reject()})}else t.submitFormData(e,n,i);else t.submitFormData(e,n,i)}).fail(function(e){bizagi.showMessageBox(e.message),i.reject()}):t.submitFormData(e,n,i),i.promise()},submitFormData:function(e,t,i){var a=new bizagi.render.services.service;$.when(a.multiactionService.submitData({action:"SAVE",contexttype:"entity",data:t,surrogatekey:void 0!==e.surrogatekey&&e.surrogatekey,idPageCache:e.idPageCache})).done(function(e){"success"==e.type?i.resolve(!0):i.reject()}).fail(function(e){bizagi.showMessageBox(e.message),i.reject()})},associatedUserHasChange:function(e){var t=!1;return void 0!==this._associatedUser?void 0!==e.associatedUser&&this._associatedUser.id!==e.associatedUser.id&&(t=!0):void 0!==e.associatedUser&&(t=!0),t}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.oauth2Applications",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_OAUTH2APPLICATIONS},init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.oauth2.applications";this._super(e,t,i),this.loadTemplates({"admin.oauth2applications":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-oauth2applications"),"admin.edit.oauth2applications":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-edit-oauth2applications"),"admin.add.oauth2applications":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-add-oauth2applications"),useNewEngine:!1}),this.CurrentClientData={}},renderContent:function(){return this.content=$.tmpl(this.getTemplate("admin.oauth2applications")),this.content},loadtemplates:function(){this.contentOauth=$.tmpl(this.getTemplate("admin.oauth2applications"))},postRender:function(){this.getContent().html(this.contentOauth),this.performSimpleGrid()},performSimpleGrid:function(){var e=this,t={allowAdd:!0,allowEdit:!0,allowDelete:!0,allow:!0,orderEnabled:!1,displayName:"Oauth",pageSize:10,onDataBinding:function(t){var i=$.Deferred();return $.when(e.dataService.getOAuth2Applications().done(function(t,a){var n=["Id","Name","Description","ClientId","ClientSecret","AuthorizationGrantType","AccessTokenLifetimeInMinutes","AllowedScope","DefaultUserDomain","DefaultUserName","RedirectUri","RedirectUriStrategy","Website"];t.data.map(function(e){return n.forEach(function(t){void 0===e[t]&&(e[t]="")}),e});var s={};t.data.length&&(s.header=$.map($(n),function(e){return{attributeType:1004,dataType:2,displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-"+e.toLowerCase()),fieldValue:"idGuestSH",xpath:"GuestSH"}})),e.namesApplications=[],s.row=$.map(t.data,function(i){return e.namesApplications.push(i.Name),[$.map($(n).filter(Object.keys(t.data[0])),function(e){var t=i[e];return"AllowedScope"==e&&(t=(i[e][0]+" "+i[e][1]).replace("openid","").trim()),t})]}),i.resolve(s)}).fail(function(e){bizagi.log(e)})),$.when(e.dataService.getCurrentUser()).done(function(t,i){e.userFullName=t.user}).fail(function(){}),i.promise()},onAdd:function(t,i){e.addApplication(this,"New")},onEdit:function(t,i){e.editApplication($(i).attr("data-idrowentity"))},onDelete:function(t,i){e.deleteApplication($(i).attr("data-idrowentity"))},getResource:function(e){}};$("#admin-oauth2-applications-table",e.getContent()).simpleGrid(e,t).render()},addApplication:function(e,t){$.tmpl(this.getTemplate("admin.add.oauth2applications"),{}).appendTo("#admin-oauth2-add-application"),$("#admin-oauth2-applications-wrapper").hide(),$("#admin-oauth2-add-application").show(),this.setupAddApplicationEvents(),this.setupCombos("add")},setupAddApplicationEvents:function(){var e=this;$("#btn-admin-oauth2-add").click(function(){e.save()}),$("#btn-admin-oauth2-cancel").click(function(){e.cancel("add")}),e.setupUserSuggest()},setupUserSuggest:function(e){var t="";e&&(t="edit-");var i=this,a=null,n=$("#biz-wp-oauth2-"+t+"user-domain-input"),s=$("#biz-wp-oauth2-default-"+t+"user-name-input"),r=$("#biz-wp-oauth2-default-"+t+"user-name-options");$(s).focus(function(e){$(this).length>0&&r[0].children.length>0?$(r).css("display","block"):$(r).css("display","none")}),$(s).keyup(function(e){var o,l,d=this,c=0;switch(e.keyCode){case 13:o=$("#biz-wp-oauth2-default-"+t+"user-name-options .selected:first").attr("data-target0"),l=$("#biz-wp-oauth2-default-"+t+"user-name-options .selected:first").attr("data-target1"),$(d).val(o),$(n).val(l),$(r).html(""),$(r).css("display","none");break;case 38:p("up");break;case 40:p("down");break;default:!function(){$(n).val(""),$(r).fadeIn(),null!==a&&clearTimeout(a);a=setTimeout(function(e){if(""!=e){var t={userName:e};i.dataService.searchUsers(t).done(function(e){e.users&&Array.isArray(e.users)&&e.users.length>0?i.createOptionsArray(e.users.filter(function(e,t){return t<5}),r,[{element:s,value:"userName"},{element:n,value:"domain"}]):$(r).html('<div class="user-no-option">'+bizagi.localization.getResource("workportal-widget-admin-oauth2-user-search-no-results")+" </div>")}).fail(function(){$(r).html("")})}else $(r).css("display","none")},400,e.currentTarget.value)}()}function p(e){return $.each($(".user-option"),function(t){if($(this).hasClass("selected"))switch(e){case"down":c+=t+1;break;case"up":c=t-1}}),c!=$(".user-option").length&&(!(c<0)&&void $.each($(".user-option"),function(e){$(this).removeClass("selected"),e===c&&$(this).addClass("selected")}))}}).closest(".biz-wp-form-cell").focusout(function(){$(r).fadeOut()})},createOptionsArray:function(e,t,i){var a=this;$(t).html(""),e.forEach(function(e){$(t).append(a.createOption(e,i,t))})},createOption:function(e,t,i){var a=t.reduce(function(t,i,a){return t+"data-target"+a+'="'+e[i.value]+'" '},"");return $('<div class="user-option" '+a+"></div>").click({targets:t},function(e){var t=this;e.data.targets.forEach(function(e,i){$(e.element).val($(t).data("target"+i))}),$(i).html("")}).html(e.domain+" \\ "+e.userName)},setupCombos:function(e){var t=[{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-authorization-code"),id:"authorization_code"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-client-credentials"),id:"client_credentials"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-all"),id:"any"}],i=[{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-web-application"),id:"WebApplication"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-bar"),id:"MobileTitleBarBrowser"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-port"),id:"MobileLocalhostPort"}];if("add"===e){var a=$("#biz-wp-oauth2-grant-type-input"),n=($("#biz-wp-oauth2-allowed-scope-input"),$("#biz-wp-oauth2-redirect-uri-strategy-input"));this.setupCombo(a,t,"grantType"),this.setupCombo(n,i,"RedirectUri")}if("edit"===e){var s=$("#biz-wp-oauth2-edit-grant-type-input"),r=($("#biz-wp-oauth2-edit-allowed-scope-input"),$("#biz-wp-oauth2-edit-redirect-uri-strategy-input"));this.setupCombo(s,t,"editGrantType"),this.setupCombo(r,i,"editRedirectUri")}},setupCombo:function(e,t,i){var a=this;"grantType"===i&&(a.grantType=t[0].id),"RedirectUri"===i&&(a.RedirectUri=t[0].id),a.pos=0,"editGrantType"===i&&(a.editGrantType=a.editGrantType||t[0].id,$.each(t,function(e){t[e].id===a.editGrantType&&(a.pos=e)})),"editRedirectUri"===i&&(a.editRedirectUri=a.editRedirectUri||t[0].id,$.each(t,function(e){t[e].id===a.editRedirectUri&&(a.pos=e)})),e.uicombo({data:{combo:t},initValue:t[a.pos],itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onChange:function(e){"grantType"!==i&&"editGrantType"!==i||("grantType"===i&&(a.grantType=e.ui.data("value")),"editGrantType"===i&&(a.editGrantType=e.ui.data("value")),"client_credentials"===e.ui.data("value")?($(".bz-oauth2-only-edit-authorization-code").hide(),$(".bz-oauth2-only-authorization-code").hide(),$(".bz-oauth2-only-edit-client-credentials").show(),$(".bz-oauth2-only-client-credentials").show()):"authorization_code"===e.ui.data("value")?($(".bz-oauth2-only-client-credentials").hide(),$(".bz-oauth2-only-authorization-code").show(),$(".bz-oauth2-only-edit-client-credentials").hide(),$(".bz-oauth2-only-edit-authorization-code").show()):($(".bz-oauth2-only-client-credentials").show(),$(".bz-oauth2-only-authorization-code").show(),$(".bz-oauth2-only-edit-client-credentials").show(),$(".bz-oauth2-only-edit-authorization-code").show())),"RedirectUri"!==i&&"editRedirectUri"!==i||("RedirectUri"===i&&(a.RedirectUri=e.ui.data("value")),"editRedirectUri"===i&&(a.editRedirectUri=e.ui.data("value")),"WebApplication"===e.ui.data("value")?($("#bz-oauth2-only-MobileLocalhostPort").hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort").hide(),$("#bz-oauth2-only-WebApplication").show(),$("#bz-oauth2-edit-only-WebApplication").show()):"MobileTitleBarBrowser"===e.ui.data("value")?($("#bz-oauth2-only-WebApplication").hide(),$("#bz-oauth2-only-MobileLocalhostPort").hide(),$("#bz-oauth2-edit-only-WebApplication").hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort").hide()):($("#bz-oauth2-only-WebApplication").hide(),$("#bz-oauth2-edit-only-WebApplication").hide(),$("#bz-oauth2-only-MobileLocalhostPort").show(),$("#bz-oauth2-edit-only-MobileLocalhostPort").show())),"AllowedScope"===i&&(a.AllowedScope=e.ui.data("value")),"editAllowedScope"===i&&(a.editAllowedScope=e.ui.data("value"))}})},showErrors:function(e,t){e.show(),e.html(bizagi.localization.getResource(t))},dataValidating:function(e){var t=this,i="";"edit"===e&&(i="edit-");var a=$("#bz-oauth2-applications-errors-board");a.hide(),$("#bz-oauth2-applications-"+i+"error-scope-required").hide();var n=$("#biz-wp-oauth2-"+i+"name-input").val();if((n=n.trim()).length<1)return t.showErrors(a,"workportal-widget-admin-oauth2-error-app-name-required"),!1;if(t.namesApplications.findIndex(function(e){return e===n})>=0&&("edit"!==e||t.CurrentClientData.Name!==n))return t.showErrors(a,"workportal-widget-admin-oauth2-error-name-duplicated"),!1;if(!$("#biz-wp-oauth2-"+i+"scope-api-input").is(":checked")&&!$("#biz-wp-oauth2-"+i+"scope-login-input").is(":checked"))return t.showErrors(a,"workportal-widget-admin-oauth2-error-atleastone-allowed-scope"),$("#bz-oauth2-applications-"+i+"error-scope-required").show(),!1;var s="save"===e?t.grantType:t.editGrantType,r=$("#biz-wp-oauth2-"+i+"user-domain-input").val().trim(),o=$("#biz-wp-oauth2-default-"+i+"user-name-input").val().trim();if(("client_credentials"===s||"any"===s)&&(r.length<1||o.length<1))return t.showErrors(a,"workportal-widget-admin-oauth2-user-domain-required"),!1;var l="save"===e?t.RedirectUri:t.editRedirectUri,d=$("#biz-wp-oauth2-"+i+"redirect-uri-input").val().trim(),c=$("#biz-wp-oauth2-"+i+"mobile-host-port").val().trim();if("authorization_code"===s||"any"===s)if("WebApplication"===l){if(d.length<1||!/^(ftp|http|https):\/\/[^ "]+$/.test(d))return t.showErrors(a,"workportal-widget-admin-users-request-url-invalid"),!1}else if("MobileLocalhostPort"===l&&(c.length<1||isNaN(c)||Math.floor(c)!==parseFloat(c)))return t.showErrors(a,"workportal-widget-admin-oauth2-error-port-invalid"),!1;var p=$("#biz-wp-oauth2-"+i+"access-token-input").val().trim();return!(p.length<1||isNaN(p)||Math.floor(p)!==parseFloat(p))||(t.showErrors(a,"workportal-widget-admin-oauth2-error-time-invalid"),!1)},save:function(){var e=this;if(!0===e.dataValidating("save")){var t="";$("#biz-wp-oauth2-scope-api-input").is(":checked")&&(t+="api"),$("#biz-wp-oauth2-scope-login-input").is(":checked")&&(t+=" login");var i={};i.authorization_grant_type=e.grantType,i.allowed_scope=t,i.username_creator=e.userFullName,i.redirect_uri_strategy=e.RedirectUri,"client_credentials"===e.grantType&&(i.redirect_uri="http://localhost--");for(var a=$("#formAddOAuthApp :input").serializeArray(),n=0;n<a.length;n++)a[n].value&&("redirect_uri_port"===a[n].name&&"MobileLocalhostPort"===e.RedirectUri?i.redirect_uri=a[n].value:i[a[n].name]=a[n].value);e.dataService.createOAuth2Application(i).done(function(){e.performSimpleGrid(),e.cancel("add")})}},getGrantType:function(e){return{authorization_code:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-authorization-code"),client_credentials:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-client-credentials"),any:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-all")}[e]},getRedirectStrategy:function(e){return{WebApplication:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-web-application"),MobileTitleBarBrowser:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-bar"),MobileLocalhostPort:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-port")}[e]},getMobileLocalhostPort:function(e,t){if("MobileLocalhostPort"===t){var i=e.match(/:([0-9]+)/)[1];return parseInt(i)}return""},editApplication:function(e){var t=this,i=t.getContent();i=i[4]?i[4]:i[2],$.when(t.dataService.getOAuth2Application(e)).done(function(e){if(e.success){function a(e){return $.grep(t.CurrentClientData.AllowedScope,function(t){return t===e}).length}t.CurrentClientData=e.data,"WebApplication"!=t.CurrentClientData.RedirectUriStrategy?t.CurrentClientData.uri="":t.CurrentClientData.uri=t.CurrentClientData.RedirectUri,$.tmpl(t.getTemplate("admin.edit.oauth2applications"),{editGrantType:t.CurrentClientData.AuthorizationGrantType,data:t.CurrentClientData},{getGrantType:t.getGrantType,getRedirectStrategy:t.getRedirectStrategy,getMobileLocalhostPort:t.getMobileLocalhostPort}).appendTo(i),t.ActualNameForEdit=t.CurrentClientData.Name,t.DataAllowedScope=t.CurrentClientData.AllowedScope,t.editGrantType=t.CurrentClientData.AuthorizationGrantType,t.editRedirectUri=t.CurrentClientData.RedirectUriStrategy,a("api")>0&&$("#biz-wp-oauth2-edit-scope-api-input",i).prop("checked",!0),a("login")>0&&$("#biz-wp-oauth2-edit-scope-login-input",i).prop("checked",!0),t.CurrentClientData.IsNative?($("#biz-wp-oauth2-edit-scope-api-input",i).attr("disabled",!0),$("#biz-wp-oauth2-edit-scope-login-input",i).attr("disabled",!0)):(t.setupCombos("edit"),"client_credentials"===t.editGrantType?($(".bz-oauth2-only-edit-client-credentials",i).show(),$(".bz-oauth2-only-edit-authorization-code",i).hide()):"authorization_code"===t.editGrantType?($(".bz-oauth2-only-edit-client-credentials",i).hide(),$(".bz-oauth2-only-edit-authorization-code",i).show()):($(".bz-oauth2-only-edit-client-credentials",i).show(),$(".bz-oauth2-only-edit-authorization-code",i).show()),"WebApplication"===t.CurrentClientData.RedirectUriStrategy?($("#bz-oauth2-edit-only-WebApplication",i).show(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).hide()):"MobileTitleBarBrowser"===t.CurrentClientData.RedirectUriStrategy?($("#bz-oauth2-edit-only-WebApplication",i).hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).hide()):($("#bz-oauth2-edit-only-WebApplication",i).hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).show()))}$("#admin-oauth2-applications-wrapper").hide(),$(i).show(),$("#btn-admin-oauth2-update-keys",i).click(function(){t.updateApplicationKeys()}),$("#btn-admin-edit-oauth2-cancel",i).click(function(){t.cancel("edit")}),t.CurrentClientData.IsNative?$("#btn-admin-edit-oauth2-add",i).click(function(){t.updateNaviteApplication()}):$("#btn-admin-edit-oauth2-add",i).click(function(){t.updateApplication()}),t.setupUserSuggest(!0)}).fail(function(){})},updateNaviteApplication:function(){var e=this,t={accessTokenLifetimeInMinutes:""};t.accessTokenLifetimeInMinutes=parseInt($("#biz-wp-oauth2-edit-access-token-input").val(),10),!isNaN(t.accessTokenLifetimeInMinutes)&&t.accessTokenLifetimeInMinutes>0?e.dataService.updateOAuth2Application(t,e.CurrentClientData.Id).done(function(){e.performSimpleGrid(),e.cancel("edit")}):$("#bz-oauth2-applications-error-time-invalid").show()},updateApplication:function(){var e=this;if(!0===e.dataValidating("edit")){var t=$("#biz-wp-oauth2-edit-id-input").val(),i="";$("#biz-wp-oauth2-edit-scope-api-input").is(":checked")&&(i+="api"),$("#biz-wp-oauth2-edit-scope-login-input").is(":checked")&&(i+=" login");var a={};a.authorization_grant_type=e.editGrantType,a.allowed_scope=i,a.username_creator=e.userFullName,a.redirect_uri_strategy=e.editRedirectUri,"client_credentials"===e.editGrantType&&(a.redirect_uri="http://localhost--");for(var n=$("#formEditOAuthApp :input").serializeArray(),s=0;s<n.length;s++)n[s].value&&("redirect_uri_port"===n[s].name&&"MobileLocalhostPort"===e.editRedirectUri?a.redirect_uri="http://localhost:"+n[s].value:a[n[s].name]=n[s].value);e.dataService.updateOAuth2Application(a,t).done(function(){e.performSimpleGrid(),e.cancel("edit")})}},updateApplicationKeys:function(){var e=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-update-keys-confirmation"),"Bizagi","warning")).done(function(){var t=$("#biz-wp-oauth2-edit-id-input").val(),i={client_id:e.CurrentClientData.ClientId,client_secret:e.CurrentClientData.ClientSecret};e.dataService.updateClientSecretKeysOAuth2Application(i,t).done(function(t){t.success?(e.performSimpleGrid(),e.cancel("edit")):$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-error-update-keys"),null,"warning")).done(function(){e.performSimpleGrid(),e.cancel("edit")})}).fail(function(t){$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-error-update-keys"),null,"warning")).done(function(){e.performSimpleGrid(),e.cancel("edit")})})})},deleteApplication:function(e){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-grid-delete-confirmation"),"Bizagi","warning")).done(function(){t.dataService.deleteOAuth2Application(e).done(function(e){t.performSimpleGrid()})})},cancel:function(e){"add"===e&&$("#admin-oauth2-add-application").children().remove(),"edit"===e&&$("#admin-oauth2-edit-application").children().remove(),$("#admin-oauth2-applications-wrapper").show(),this.cleanData()},cleanData:function(){self.AllowedScope=null,self.editAllowedScope=null,self.userFullName=null,self.grantType=null,self.editGrantType=null,self.RedirectUri=null,self.editRedirectUri=null,$(".biz-wp-input-text").val(""),$(".biz-wp-oauth2-select-control").children().remove(),self.CurrentClientData={}},destroy:function(){}}),bizagi.workportal.widgets.admin.business.policies.vocabularies.extend("bizagi.workportal.widgets.admin.business.policies.vocabularies",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.vocabularies.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-vocabularies-wrapper"),"admin.business.policies.vocabularies.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-vocabularies-content"),useNewEngine:!1})},renderContent:function(){var e,t=this,i=t.getTemplate("admin.business.policies.vocabularies.wrapper");return t.decisionTableContent=t.getTemplate("admin.business.policies.vocabularies.content"),e=t.content=$.tmpl(i,{}),t.params.canvas&&(e=$(t.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.async.activities",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ASYNC_ACTIVITIES},renderContent:function(){var e,t=this.getTemplate("admin.async.activities");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.admin.cases.extend("bizagi.workportal.widgets.admin.cases",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.cases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-cases"),useNewEngine:!1})},postRender:function(){var e=this;e.userTableConf={pageSize:10},$.when(e.dataService.getOrganizationInfo("Skill"),e.dataService.getOrganizationInfo("Location"),e.dataService.getOrganizationInfo("Role")).done(function(t,i,a){e.renderSearchCaseForm(a[0],t[0],i[0])})},renderSearchCaseForm:function(e,t,i){var a=this,n=a.getContent(),s=a.getTemplate("admin.search.cases");$.tmpl(s,{skill:t.profiles.length,role:e.profiles.length,location:i.profiles.length}).appendTo($("#form-search-cases",n)),t.profiles.length&&(a.skillInput=$("#skill-wrapper",n),a.skillInput.searchList({list:t.profiles,cases:[]})),e.profiles.length&&(a.roleInput=$("#role-wrapper",n),a.roleInput.searchList({list:e.profiles,cases:[]})),i.profiles.length&&(a.locationInput=$("#location-wrapper",n),a.locationInput.searchList({list:i.profiles,cases:[]})),a.searchCasesForm=$(".admin-form-search-cases",n),a.searchCaseFormEventHandler()},renderSearchUserForm:function(e){var t=this.getContent(),i=this.getTemplate("admin.search.users");$.tmpl(i).appendTo($("#form-search-users",t)),$("#cases-found-message-wrapper .message",t).text(printf(this.resources.getResource("workportal-widget-admincase-casesfound"),e)),this.eventHandlerSearchUserForm()},showSearchCaseForm:function(e){var t=this.getContent();e?($("#form-search-cases",t).show(),this.searchCasesForm.show()):$("#form-search-cases",t).hide()},showSearchUsersForm:function(e){var t=this.getContent();e?this.renderSearchUserForm():$("#form-search-users",t).html("")},eventHandlerSearchUserForm:function(){var e=this,t=e.getContent();$("#search-user",t).bind("click",function(i){i.preventDefault();var a=$("#admin-form-search-users-wrapper",t);e.showConfirmAssignCasesForm(!1);var n={};n.userName=$("#txtSAMAccount",a).val(),n.fullname=$("#txtFullName",a).val(),n.domain=$("#txtDomain",a).val(),n.skills=$("#skill",t).val(),n.locations=$("#location",t).val(),n.roles=$("#role",t).val(),e.showLoaderAtContainer($("#user-list-wrapper")),$.when(e.dataService.searchUsers(n)).done(function(t){e.closeLoader(),e.updateTotalUsersForm(t)})}),$("#back-search-case-form",t).bind("click",function(t){t.preventDefault(),e.showSearchUsersForm(!1),e.showSearchCaseForm(!0)}),$("#confirm-assign-cases",t).bind("click",function(i){i.preventDefault();for(var a=$("#admin-form-search-users-wrapper",t),n={},s=$("#user-list-wrapper .user-list-item label",a).filter(".ui-radio-state-checked").parent(),r=[],o=s.length;o-- >0;)r.push(Number($("input",s[o]).val()));n.user=r,n.skills=e.getCasesSearchParams().skills,n.locations=e.getCasesSearchParams().locations,n.roles=e.getCasesSearchParams().roles,$.when(e.dataService.reassignCases(n)).done(function(t){e.showConfirmAssignCasesMessage(!0)}).fail(function(e){})}),$("#cancel-assign-cases",t).bind("click",function(t){t.preventDefault(),e.showConfirmAssignCasesForm(!1)})},searchCaseFormEventHandler:function(){var e=this,t=e.getContent();$("li[name=role], li[name=skill], li[name=location]",t).bind("click",function(){var e=$(this).find("span.ui-icon");"uncheck"==e.attr("data-state")?e.attr("data-state","check"):e.attr("data-state","uncheck")}),$("#search-case",t).bind("click",function(t){t.preventDefault();var i=e.skillInput?e.skillInput.searchList("option","cases"):[],a=e.roleInput?e.roleInput.searchList("option","cases"):[],n={skills:i,locations:e.locationInput?e.locationInput.searchList("option","cases"):[],roles:a};e.searchCasesForm.hide(),e.showLoaderAtContainer(e.searchCasesForm),$.when(e.dataService.getCasesByOrganization(n)).done(function(t){e.closeLoader(),e.updateTotalCasesFound(n,t)})})},showLoaderAtContainer:function(e){self.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),e.after(self.dialogBox)},closeLoader:function(){self.dialogBox.remove()},setCasesSearchParams:function(e){this.caseSearchParams=e},getCasesSearchParams:function(e){return this.caseSearchParams},updateTotalCasesFound:function(e,t){var i=this,a=i.getContent(),n=$("#no-cases-found-message-wrapper",a);i.setCasesSearchParams(e),t.totalCases>0?(n.hide(),i.showSearchCaseForm(!1),i.renderSearchUserForm(t.totalCases)):(i.showSearchCaseForm(!0),n.show())},updateTotalUsersForm:function(e){var t=this.getContent(),i=$("#no-users-found-message-wrapper",t);e.users.length>0?(i.hide(),this.userList={data:e.users},this.createPage(1)):i.show()},createPage:function(e){var t,i=this,a=i.getContent(),n=$("#user-list-wrapper",a),s=i.getTemplate("admin.table.users"),r=Math.ceil(i.userList.data.length/i.userTableConf.pageSize),o=new Array(r),l=[],d=i.userTableConf.pageSize*(e-1);t=i.userTableConf.pageSize+d<=i.userList.data.length?i.userTableConf.pageSize:i.userList.data.length-d,$(".user-list-item",n).remove(),t+=d;for(var c=0;c<r;c++)o[c]=c+1;l=(l=[].concat(i.userList.data)).splice(d,t);var p=$.tmpl(s,{users:l,pages:o});n.html(p),i.tableUsersHandlers(),i.updateTableUsersPager(e),$("ul").bizagiPagination({maxElemShow:10,totalPages:r,actualPage:e,listElement:$("#user-list-footer-wrapper",a),clickCallBack:function(e){i.createPage(e.page),i.showConfirmAssignCasesForm(!1)}})},tableUsersHandlers:function(){var e=this,t=e.getContent(),i=$("#user-list-wrapper",t);$(".user-list-item",i).click(function(t){$("label",this).toggleClass("ui-radio-state-checked");var a=$(".ui-radio label",i).filter(".ui-radio-state-checked").length>0;e.showConfirmAssignCasesForm(a),e.showConfirmAssignCasesMessage(!a)}),$(".user-list-item",i).hover(function(){$(this).attr("data-value")||$("label",this).addClass("ui-radio-state-hover")},function(){$(this).attr("data-value")||$("label",this).removeClass("ui-radio-state-hover")}),$("tbody tr",i).each(function(){$(this).index()%2<1&&$(this).addClass("biz-ui-even")})},updateTableUsersPager:function(e){var t=this.getContent(),i=$("#table",t);$("#user-list span[data-value="+e+"]",i).addClass("current-page")},showConfirmAssignCasesForm:function(e){var t=this.getContent();e?$("#assing-cases-confirm-form-wrappper",t).show():$("#assing-cases-confirm-form-wrappper",t).hide()},showConfirmAssignCasesMessage:function(e){var t=this.getContent();e?($("#assing-cases-confirm-form",t).hide(),$("#assign-cases-message-wrapper",t).show()):($("#assing-cases-confirm-form",t).show(),$("#assign-cases-message-wrapper",t).hide()),$("#users-found-message-wrapper",t).hide()}}),bizagi.workportal.widgets.admin.caseSearch.extend("bizagi.workportal.widgets.admin.caseSearch",{},{init:function(e,t,i){var a=this;a.adhocIds=[],a._super(e,t,i),a.selectedCaseAdmin=[],a.selectedWorkItemAdmin=[],a.columnsID={caseNumber:"I_radNumber",process:"I_wfClsDisplayName",task:"I_tskDisplayName",processCreationDate:"I_casCreationDate",taskDueDate:"I_wiEstimatedSolutionDate",processDueDate:"I_casSolutionDate",userName:"I_userName",userfullName:"I_fullName",userLocation:"I_locName"},a.loadTemplates({"admin.case.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search"),"admin.case.search.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-fields"),"admin.case.search.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-buttons"),"admin.case.search.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-result"),"admin.case.search.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-pagination"),"admin.case.search.invalidate":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-invalidate"),"admin.case.search.reassign":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign"),"admin.case.search.reassign.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign-form"),"admin.case.search.action.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-action-result"),"admin.case.search.loader":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-loader"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.generalContentTmpl=e.getTemplate("admin.case.search"),e.fieldsContentTmpl=e.getTemplate("admin.case.search.fields"),e.buttonContentTmpl=e.getTemplate("admin.case.search.button"),e.resultContentTmpl=e.getTemplate("admin.case.search.result"),e.paginationTmpl=e.getTemplate("admin.case.search.pagination"),e.invalidateContentTmpl=e.getTemplate("admin.case.search.invalidate"),e.reassignContentTmpl=e.getTemplate("admin.case.search.reassign"),e.reassignFormTmpl=e.getTemplate("admin.case.search.reassign.form"),e.actionResultContentTmpl=e.getTemplate("admin.case.search.action.result"),e.loaderTmpl=e.getTemplate("admin.case.search.loader"),e.loader=$.tmpl(e.loaderTmpl,{})},postRender:function(){var e=this;e.defaultMaxRows=10,e.maxElemShow=e.defaultMaxRows,e.maxPageToShow=5,e.processNavigation=[],e.setupData()},showNotifier:function(){window.parent.bizagi.injector.get("notifier").showSucessMessage(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidation-message"),"")},showConfirmationMessage:function(){var e=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admincasesearch-action-invalidation-confirmation"),bizagi.localization.getResource("workportal-general-word-information"),"info")).done(function(){e.showLoading(),e.invalidateSelectedCase(e.paramsToInvalidateSelectedCases())})},initPositionsCombo:function(){var e=this;$.when(e.dataService.getUserPositions()).done(function(t){var i={combo:[],id:"positions"};i.combo.push({id:"",name:"........."}),$.each(t.positions,function(e,t){i.combo.push({id:t.idPosition,name:t.displayName})}),e.renderPositionsCombo(i)}).fail(function(e){bizagi.log(e)})},renderPositionsCombo:function(e){var t=this.getContent(),i=$.Deferred(),a=$("#userPositionInput",t);return a.empty(),a.uicombo({isEditable:!1,data:e,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){i.resolve()},onChange:function(e){var i=e.ui.data("value");$("#userPositionInput",t).val(i)},initValue:e.combo[0]}),i},setupData:function(){var e=this;e.setupInitialData(),e.setupDatePicker(),e.setupProcessTree(),e.setupCaseSecurity(),e.setupMainButtons(),e.initPositionsCombo()},setupInitialData:function(){var e,t=this,i=t.getContent();t.buttonBackAction="backToMainForm",t.selectedUserId="",t.selectedUserName="",t.selectedTasks="",t.selectedTasksToShow="",t.searchParams="",t.processTree="",t.processTreeDelete="",t.caseSecurity="",$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle")),$("#mainForm",i).remove(),$("#dinamicContent",i).remove(),$("#case-search-log-data-buttonset",i).remove(),e=$.tmpl(t.fieldsContentTmpl,{}),i.html(e),$("#cases-tabs",i).tabs({activate:function(e,a){"deleteCasesTab"===a.newTab[0].id?(t.isOut=!1,t.showLoading(),t.getProcessRunningInvalidateCases()&&($("#tree",i).hide(),$("#invalidateMessage",i).show())):(clearTimeout(t.timer),t.isOut=!0)}});var a=$("#cases-tabs-ul",i);$("#li-deleteCases",a).click(function(){$("#case-search-log-data-buttonset",i).hide()}),$("#li-case-search",a).click(function(){$("#case-search-log-data-buttonset",i).show()}),bizagiConfig.isProduction&&($("#deleteCases",i).remove(),$("#deleteCasesTab",i).remove())},setupDatePicker:function(){var e=this.getContent(),t=bizagi.localization.getResource("dateFormat").replaceAll("yyyy","yy").replaceAll("MM","mm");$(".biz-wp-form-datepicker",e).datepicker({controlType:"select",dateFormat:t})},setupProcessTree:function(){var e=this,t=e.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove();var i=$.extend({},e.params);i.svgIconsMode=!0,i.canvas=$("#processTree",t),e.processTree=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,i),e.processTree.render().done(function(){var i=$.extend({},e.params);i.canvas=$("#processTreeDelete",t),i.svgIconsMode=!0,i.searchKeyResource="workportal-widget-admincasesearch-cancel-cases-for",i.newDesign=!0,e.processTreeDelete=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,i),e.processTreeDelete.render()})},setupCaseSecurity:function(){var e=this,t=e.getContent();$("#treeLinksId").remove();var i=$.extend({},e.params);i.content=$("#caseSecurity",t),e.caseSecurity=new bizagi.workportal.widgets.admin.transfer.case.security.permissions(e.workportalFacade,e.dataService,i),e.caseSecurity.render()},setupUsersSearchForm:function(){var e=this,t=e.getContent(),i=$.Deferred();$("#biz-wp-users-table-form").html(""),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#biz-wp-users-table-form",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admincasesearch-reassign")],parentDef:i})),e.usersTable.render(),$.when(i).done(function(t,i){e.assignEventReassignLinks(t,i)})},findResults:function(e,t,i){var a=this;t.Page=i||1,$.when(a.dataService.getAdminCasesList(t)).done(function(i){if($(i.rows).each(function(e,t){t.isAdhocProcess||(t.isAdhocProcess=!1),t.isAdhocProcess&&a.adhocIds.push({caseId:t.idCase,processId:t.idAdhocProcess})}),$("#generalTitle").show(),$(".biz-wp-table").remove(),$(".case-search-action-wrapper").remove(),$("#biz-wp-table-summary-wrapper").remove(),a.totalRecords=i.records,a.totalPages=i.total,i.rows.length>0){a.showCasesSearchResultFrame(e,i),a.setupActionsButton(e);var n,s=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,r=$("#biz-wp-table-pager-wrapper"),o={};o.pagination=a.totalPages>1,o.page=i.page,o.pages={};for(var l=1;l<=s;l++)o.pages[l]={pageNumber:l};n=$.tmpl(a.paginationTmpl,o).html(),r.append(n),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){a.findResults(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),bizagi.localization.getResource("workportal-general-word-information"),"warning")}).fail(function(e){bizagi.log(e)})},showCasesSearchResultFrame:function(e,t){var i=this,a=!!bizagi.override.disableAbortCases,n=i.preprocessResultList(t.headers,t),s=$.tmpl(i.resultContentTmpl,{headers:t.headers,rows:n,groupByCaseNumber:bizagiConfig.groupByCaseNumber,securityGraphicQuery:bizagi.menuSecurity.GraphicQuery,resultList:t},{getRadNumberColumnIndex:function(){for(var e=this.data,t=-1,i=0,a=e.headers.length;i<a;i++)"I_radNumber"==e.headers[i].fieldName&&(t=i);return t},showColumn:function(e){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==e?" hidden ":""},createGroupedHeader:function(e){var t=this.data.resultList,i=!1,a=this.getRadNumber(t.rows[e]);this.data.groupByCaseNumber&&(0==e?i=!0:a!=this.getRadNumber(t.rows[e-1])&&(i=!0));return i},getRadNumber:function(e){var t=this.getRadNumberColumnIndex();return t>=0?e.data[t]:""}}),r=$.tmpl(i.invalidateContentTmpl,{}),o=$.tmpl(i.reassignContentTmpl,{});$("#mainForm",e).hide(),$("#dinamicContent",e).html(s),a||$(".case-search-action-wrapper",e).append(r),$(".case-search-action-wrapper",e).append(o),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title")),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide(),$("#btn-admin-case-back",e).css("display","inline"),i.setupActivitiesLink(e),i.setupGraphicQueryEvent(e),i.selectedItemsPersistence(e)},selectedItemsPersistence:function(e){var t="";$.each(this.selectedCaseAdmin,function(i,a){t="input:checkbox[name=CaseAdmin][value="+a+"]",$(t,e).prop("checked",!0)}),$.each(this.selectedWorkItemAdmin,function(i,a){t="input:checkbox[name=workItemAdmin][value='"+a+"']",$(t,e).prop("checked",!0)})},preprocessResultList:function(e,t){for(var i=[],a=t.rows.length,n=0;n<a;n++)i.push(this.processResultItem(e,t.rows[n]));return i},processResultItem:function(e,t){var i,a,n,s,r=this,o=t.data,l=t.idCase,d=t.idWorkFlow,c=t.radNumber,p=t.idParentCase,g=t.isSubprocess,u=[],m=[],h=[],w=-1,b=0,f=!1;for(m.push({id:"checkCaseAdmin",value:l,radNumber:c,idParentCase:p,isSubProcess:g});w++<e.length-1;)switch(e[w].fieldName){case r.columnsID.caseNumber:m.push({id:"caseNumber",value:{idCase:l,caseNumber:o[b]}}),b++;break;case r.columnsID.process:m.push({id:"idWorkItem",value:o[b]}),b++;break;case r.columnsID.userName:case r.columnsID.userfullName:case r.columnsID.task:case r.columnsID.taskDueDate:if(void 0===i){for(var v=o.length;v-- >0;)if(Array.isArray(o[v])){i=o[v],f=!0;break}b++}f?(n=i[0],r.columnsID.userName==e[w].fieldName?(m=m.concat(r.processTaskObjectUser(n)),-1==h.indexOf(r.columnsID.userName)&&h.push(r.columnsID.userName)):r.columnsID.userfullName==e[w].fieldName?(m=m.concat(r.processTaskObjectUser(n)),-1==h.indexOf(r.columnsID.userfullName)&&h.push(r.columnsID.userfullName)):r.columnsID.task==e[w].fieldName?(m=m.concat(r.processTaskObject(n,l)),-1==h.indexOf(r.columnsID.task)&&h.push(r.columnsID.task)):r.columnsID.taskDueDate==e[w].fieldName&&(m=m.concat(r.processTaskObjectDate(n)),-1==h.indexOf(r.columnsID.taskDueDate)&&h.push(r.columnsID.taskDueDate))):e[w].fieldName==r.columnsID.taskDueDate&&(m=m.concat({estimatedSolutionDate:o[w]}),-1==h.indexOf(r.columnsID.taskDueDate)&&h.push(r.columnsID.taskDueDate));break;case r.columnsID.processCreationDate:m.push({id:"processCreationDate",value:o[b]}),b++;break;case r.columnsID.processDueDate:m.push({id:"processDueDate",value:o[b]}),b++;break;default:var $=bizagi.util.formatValueByDataType(o[b],e[w].type);m.push({id:"customField",value:$}),b++}if(m.push({id:"viewProcess",value:{idCase:l,idworkflow:d}}),u.push({attr:"first_row",data:m}),(a=i?i.length:0)>1){s=h.length;for(var k=1;k<a;k++){var z=[];for(v=-1;v++<s-1;)h[v]==r.columnsID.task?z.push(r.processTaskObject(i[k],l)):h[v]==r.columnsID.taskDueDate?z.push(r.processTaskObjectDate(i[k])):h[v]==r.columnsID.userName?z.push(r.processTaskObjectUser(i[k])):h[v]==r.columnsID.userfullName&&z.push(r.processTaskObjectUser(i[k]));u.push({attr:"next_row",data:z})}}return{data:u,totalTask:a}},processTaskObject:function(e,t){var i={taskName:e.taskName,colorState:e.colorState,taskType:e.taskType,idCase:t,idWorkItem:e.idWorkItem,idTask:e.idTask};return"Wait"===e.taskType&&(i.skip=!0),i},processTaskObjectDate:function(e){var t={};return e.estimatedSolutionDate?t.estimatedSolutionDate=e.estimatedSolutionDate:t.estimatedSolutionDate="","Wait"===e.taskType&&(t.skip=!0),t},processTaskObjectUser:function(e){var t={};return e.assignee?t.userName=e.assignee:t.userName="",t},invalidateCases:function(e){var t=this,i="",a="",n={cases:[]};if($("input:checkbox[name=CaseAdmin]:checked",e).each(function(){var e=$(this).val();$(this).data("subprocess")&&(i=i+" "+$(this).data("parentcase")+","),n.cases.push({idCase:e})}),0==n.cases.length)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-empty-msg"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else{a=bizagi.util.isEmpty(i)?bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-confirm-msg"):bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-subprocess-confirm-msg")+i.substring(0,i.length-1);$.when(bizagi.showConfirmationBox(a,bizagi.localization.getResource("workportal-general-word-information"),"warning",null,{dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400})).done(function(){var i=$("#txtReason",e).val(),a={action:"abort",cases:JSON.stringify(n),reason:i};$.when(t.dataService.abortReassignItems(a)).done(function(i){t.showActionResultFrame(e,i.response,"invalidate")}).fail(function(e){bizagi.log(e)})})}},showReassignTasksFrame:function(e){var t={cases:[]},i=[];$.each(this.selectedWorkItemAdmin,function(e,a){a=a.split("|"),t.cases.push({idCase:a[0],idWorkItem:a[1]}),i.push({taskItem:a[0]+": "+a[2],idWorkItem:a[1]})}),0==i.length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-empty-msg"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):(this.selectedTasks=t,this.selectedTasksToShow=i,this.showReassignForm(e,i))},showReassignForm:function(e,t){this.buttonBackAction="backToCases";var i=$.tmpl(this.reassignFormTmpl,{tasks:t});$("#dinamicContent",e).hide(),$("#dinamicContent2",e).html(i),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide(),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-title")),this.setupUsersSearchForm()},reassignTasks:function(){var e=this,t=e.getContent(),i={action:"reassignItems",cases:JSON.stringify(e.selectedTasks),idNewUser:e.selectedUserId};$.when(e.dataService.abortReassignItems(i)).done(function(i){e.showActionResultFrame(t,i.response,"reassign")}).fail(function(e){bizagi.log(e)})},showActionResultFrame:function(e,t,i){var a=t.length>1?"-several":"",n="",s="",r=[];if("invalidate"==(a=i+a))for(var o=0;o<t.length;o++)1==t[o].deleted?(n=t[o].idCase,n+=o+1<t.length?", ":"",r[0]=!0):(s=t[o].idCase,s+=o+1<t.length?", ":"",r[1]=!1);else if("invalidate-several"==a)for(o=0;o<t.length;o++)1==t[o].deleted?(n+=t[o].idCase,n+=o+1<t.length?", ":"",r[0]=!0):(s+=t[o].idCase,s+=o+1<t.length?", ":"",r[1]=!1);else if("reassign"==a)for(o=0;o<t.length;o++)1==t[o].reassigned?(n+=t[o].idCase,n+=o+1<t.length?", ":"",r[0]=!0):(s=t[o].idCase,s+=o+1<t.length?", ":"",r[1]=!1);else if("reassign-several"==a){n+="<br/><br/>",s+="<br/><br/>";for(o=0;o<t.length;o++)1==t[o].reassigned?(n+=t[o].idCase+"<br/>",r[0]=!0):(s+=t[o].idCase+"<br/>",r[1]=!1);n+="<br/>",s+="<br/>"}var l=$.tmpl(this.actionResultContentTmpl,{action:a,resultStatus:r,exceptionMessage:s.substring(s.indexOf("|")+1)});l=l[0].innerHTML.replace("{0}","<strong>"+n+"</strong>");var d=s.substring(0,-1===s.indexOf("|")?void 0:s.indexOf("|"));l=(l=(l=l.replace("{3}","<strong>"+d+"</strong>")).replace("{1}",this.selectedUserName)).replace("{1}",this.selectedUserName),"invalidate"==i&&$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-result-title")),$("#mainForm",e).html(""),$("#dinamicContent",e).css("display","inline"),$("#dinamicContent",e).html(l),$("#dinamicContent2",e).remove(),$("#usersTable",e).remove(),$("#btn-admin-case-back",e).css("display","none"),$("#btn-admin-case-search-clear",e).css("display","none"),$("#btn-admin-case-search",e).css("display","none"),$("#btn-admin-case-finish",e).css("display","inline")},setupMainButtons:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i);var a=$("#case-search-log-data-buttonset",t);$("#btn-admin-case-search-clear",a).click(function(){$(".biz-wp-input-text",t).val(""),$(".biz-wp-form-datepicker",t).val(""),$("#userPositionInput",t).val(""),$("#userPositionInput",t).find(".biz-wp-combo-input").val("........."),e.setupProcessTree()}),$("#btn-admin-case-search",a).click(function(){var i="",a="",n="",s="",r="",o=e.processTree.getTreeRouteSelected();o.length>0&&(2==o.length?(i=o[1],n=o[0],a=""):(i=o[o.length-1],a="",n=o[0]));var l=parseInt($("#resultsNumber").val());bizagi.util.isNumeric(l)?e.maxElemShow=l:e.maxElemShow=e.defaultMaxRows;var d=$("#sinceDate");d=(d=d.datepicker("getDate"))?bizagi.util.dateFormatter.formatInvariant(d,!1):"";var c=$("#toDate");c=(c=c.datepicker("getDate"))?bizagi.util.dateFormatter.formatInvariant(c,!1):"";var p={h_action:"getCases",I_ProcessState:"Running",h_idApp:"",I_Users:"ALL",eventAsTask:!0,orderType:1,order:"",orderField:"",group:bizagiConfig.groupByCaseNumber?"T_RADNUMBER":null,I_radNumber:$.trim($("#caseInput").val()),I_idWFClass:n,I_USERNAME:$("#userNameInput").val(),I_USERFULLNAME:$("#userFullNameInput").val(),I_USERPOSITION:$("#userPositionInput").val(),I_From__CreationDate:d||$("#sinceDate").val(),I_To__CreationDate:c||$("#toDate").val(),h_idWFClassAuth:"",I_idCategory:a,I_idApplication:i,PageSize:e.maxElemShow};""==p.I_From__CreationDate||bizagi.util.isDate(p.I_From__CreationDate)?""==p.I_To__CreationDate||bizagi.util.isDate(p.I_To__CreationDate)?(e.searchParams=p,e.selectedCaseAdmin=[],e.selectedWorkItemAdmin=[],e.findResults(t,p)):(s=bizagi.localization.getResource("workportal-general-invalid-date"),r=bizagi.localization.getResource("workportal-widget-admincasesearch-to-date"),s=s.replace("{0}",r),bizagi.showMessageBox(s,bizagi.localization.getResource("workportal-general-word-information"),"warning")):(s=bizagi.localization.getResource("workportal-general-invalid-date"),r=bizagi.localization.getResource("workportal-widget-admincasesearch-date-since"),s=s.replace("{0}",r),bizagi.showMessageBox(s,bizagi.localization.getResource("workportal-general-word-information"),"warning"))}),$("#btn-admin-case-back",a).click(function(){"backToMainForm"==e.buttonBackAction?e.backToMainForm():"backToCases"==e.buttonBackAction&&e.backToCases()}),$("#btn-admin-case-finish",a).click(function(){e.setupData()}),$("#resultsNumber",t).bind("keypress",function(e){var t=e.charCode?e.charCode:e.keyCode;if(8!=t&&(t<48||t>57))return!1}),$("#btn-admin-cases-invalidate",t).click(function(){!1===$("#allAppsLinkSelected",t).data("allAppSelected")&&0===e.processTreeDelete.getTreeRouteSelected().length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-processTree-no-selected-process"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):e.showConfirmationMessage(),$(e.loader).remove()})},getDateInvariantByControlIDSelector:function(e){var t="",i=$(e).datepicker("getDate");if(null!==i)try{t=bizagi.util.dateFormatter.formatInvariant(i,!1)}catch(i){t="",$(e).val("")}return t},backToCases:function(){var e=this.getContent();this.buttonBackAction="backToMainForm",$("#dinamicContent",e).show(),$("#dinamicContent2",e).html(""),$("#usersTable").remove(),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title")),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide()},backToMainForm:function(){var e=this.getContent();$("#mainForm",e).show(),$("#dinamicContent",e).html(""),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle")),$("#btn-admin-case-search-clear",e).show(),$("#btn-admin-case-search",e).show(),$("#btn-admin-case-back",e).css("display","none")},assignEventReassignLinks:function(e,t){this.selectedUserId=e,this.selectedUserName=t,this.reassignTasks()},setupActionsButton:function(e){var t=this;$("input:checkbox[name=CaseAdmin]",e).click(function(){var e=$(this).val();$(this).is(":checked")?t.selectedCaseAdmin.push(e):t.selectedCaseAdmin.splice($.inArray(e,t.selectedCaseAdmin),1)}),$("input:checkbox[name=workItemAdmin]",e).click(function(){var e=$(this).val();$(this).is(":checked")?t.selectedWorkItemAdmin.push(e):t.selectedWorkItemAdmin.splice($.inArray(e,t.selectedWorkItemAdmin),1)}),$("#btn-admin-case-invalidate",e).click(function(){t.invalidateCases(e)}),$("#btn-admin-case-reassign",e).click(function(){t.showReassignTasksFrame(e)})},setupActivitiesLink:function(e){var t=this;$(".activityClicked",e).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:$(this)[0].getAttribute("data-idworkItem"),idTask:$(this)[0].getAttribute("data-idTask")}),t.publish("closeCurrentDialog")}),$(".caseClicked",e).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:"",idTask:""}),t.publish("closeCurrentDialog")}),$(".cases-column-header",e).click(function(){var i=$(this)[0].getAttribute("data-columnorder"),a=$(this)[0].getAttribute("data-ordertype"),n=$(this)[0].getAttribute("data-columnOrderName");a="1"==a?0:1,t.searchParams.order=i,t.searchParams.orderType=a,t.searchParams.orderField=n,t.findResults(e,t.searchParams,t.searchParams.Page)})},setupGraphicQueryEvent:function(e){var t=this;$(".biz-wp-diagram-view-icon",e).click(function(){for(var e=$(this).data("idcase"),i=$(this).data("idworkflow"),a=!1,n=null,s=0;s<t.adhocIds.length;s++)parseInt(e)==t.adhocIds[s].caseId&&(a=!0,n=t.adhocIds[s].processId);a?t.showGraphicQuery({idCase:e,idWorkflow:i,isAdhoc:a,idProcess:n}):t.showGraphicQuery({idCase:e,idWorkflow:i})})},paramsToInvalidateSelectedCases:function(){var e=this.processTreeDelete.getTreeRouteSelected(),t="",i="";return e.length>0&&(2==e.length?(t=e[1],i=e[0]):(t=e[e.length-1],i=e[0])),{idProcess:i,idApplication:t}},invalidateSelectedCase:function(e){var t=this;$.when(t.dataService.postAdminInvalidateCase(e)).done(function(){t.last_showSuccessToastInvalidate=!0,t.getProcessRunningInvalidateCases()}).fail(function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(e)})},getProcessRunningInvalidateCases:function(){var e=this;return e.resp=!1,$.when(e.dataService.getResponseProcessRunningInvalidateCases()).done(function(t){var i=e.getContent();if("InProgress"===t.status){var a=e;a.isOut?e.resp=!1:($("#btn-admin-cases-invalidate").fadeOut(10),$("#invalidateMessage",i).fadeIn(10),$("#tree",i).fadeOut(10),e.timer=setTimeout(function(){a.getProcessRunningInvalidateCases()},1e4))}else $("#btn-admin-cases-invalidate").fadeIn(10),$("#tree",i).fadeIn(10),$("#invalidateMessage",i).fadeOut(10),e.resp=!1,!0===e.last_showSuccessToastInvalidate&&e.showNotifier();e.isOut?$(e.loader).remove():(e.last_showSuccessToastInvalidate=!1,"InProgress"===t.status&&(e.last_showSuccessToastInvalidate=!0),e.endLoading())}).fail(function(t){var i=e.getContent();bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),$("#btn-admin-cases-invalidate").fadeIn(10),$("#tree",i).fadeIn(10),$("#invalidateMessage",i).fadeOut(10),e.resp=!1,e.endLoading(),bizagi.log(t)}),e.resp},showLoading:function(){var e=this.getContent();$("#deleteCasesWrapper",e).fadeOut(10),$("#case-search-log-data-buttonset",e).fadeOut(10),$("#deleteCases",e).append(this.loader)},endLoading:function(){var e=this.getContent();$("#deleteCasesWrapper",e).fadeIn(10),$("#case-search-log-data-buttonset",e).fadeIn(10),$(this.loader).remove()},dispose:function(){clearTimeout(this.timer)}}),bizagi.workportal.widgets.admin.async.activities.extend("bizagi.workportal.widgets.admin.async.activities",{ASYNC_CHECK_TIMER:3e3},{init:function(e,t,i){this.selectedTab=0,this._super(e,t,i),this.loadTemplates({async:bizagi.getTemplate("bizagi.workportal.desktop.widget.async"),"admin.async.activities":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities"),"admin.async.activities.tabs":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tabs"),"admin.async.activities.tab1":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab1"),"admin.async.activities.tab2":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab2"),"admin.async.activities.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-log"),"admin.async.activities.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-pagination"),"admin.async.activities.error.page":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-error-page"),"admin.async.activities.processing":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-processing"),useNewEngine:!1})},loadtemplates:function(){var e=this;e.tabsTmpl=e.getTemplate("admin.async.activities.tabs"),e.tab1Tmpl=e.getTemplate("admin.async.activities.tab1"),e.tab2Tmpl=e.getTemplate("admin.async.activities.tab2"),e.logTmpl=e.getTemplate("admin.async.activities.log"),e.paginatorTmpl=e.getTemplate("admin.async.activities.pagination"),e.errorPage=e.getTemplate("admin.async.activities.error.page"),e.processingPage=e.getTemplate("admin.async.activities.processing")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.setupData()},setupData:function(){this.setupInitialData(),this.setupTabs()},setupInitialData:function(){var e=this.getContent(),t=$(".async-act-main-content",e);$("#generalTitle",e).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),t.html(""),$("#main-screen",e).show(),$("#dinamic-screen",e).html("");var i=$.tmpl(this.tabsTmpl,{});t.append(i),this.loadTabsContent()},loadTabsContent:function(){var e,t,i=this,a=i.getContent();e={action:"getActivities",page:1,pageSize:i.maxElemShow},t={action:"getActivitiesByTask",page:1,pageSize:i.maxElemShow},i.renderTab1Table(a,e),i.renderTab2Table(a,t)},setupTabs:function(){var e=this,t=e.getContent();$("#async-tabs",t).tabs({activate:function(t,i){e.selectedTab=i.newTab.index(),e.loadTabsContent()},active:e.selectedTab||0})},renderTab1Table:function(e,t,i){var a=this,n=$("#main-screen",e);t.page=i||1,$("#async-loading-activities").show(),$.when(a.dataService.asyncActivitiesServices(t)).done(function(i){if($("#async-loading-activities").hide(),$("#async-tabs-1").remove(),a.totalRecords=i.records,a.totalPages=i.total,a.asyncActRefresh(),i.rows.length){var s=$.tmpl(a.tab1Tmpl,{rows:i.rows,selectedTab:a.selectedTab});bizagi.util.formatInvariantDate(s,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),$("#async-tabs",e).append(s),a.setupTab1ActivitiesLink(),a.setupActionsButton();var r,o=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,l=$("#async-table-pager-wrapper"),d={};d.pagination=a.totalPages>1,d.page=i.page,d.pages={},d.additionalparameters=!0,d.totalPages=a.totalPages,d.totalRecords=a.totalRecords;for(var c=1;c<=o;c++)d.pages[c]={pageNumber:c};r=$.tmpl(a.paginatorTmpl,d).html(),l.append(r),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$(".pager-content",n),clickCallBack:function(i){a.renderTab1Table(e,t,i.page)}})}else $("#async-tabs",e).hide(),$("#tabs-wrapper",e).append(bizagi.localization.getResource("workportal-general-no-records-found"))}).fail(function(e){bizagi.log(e)})},renderTab2Table:function(e,t){var i=this;$("#async-loading-activities").show(),$.when(i.dataService.asyncActivitiesServices(t)).done(function(t){if($("#async-loading-activities").hide(),$("#async-tabs-2").remove(),t.rows.length){for(var a=[],n=t.rows,s=[],r=0,o=0;o<n.length;o++){var l=n[o].idWfClass,d=Number(n[o].count);if(s.indexOf(l)<0){s.push(l),a[r]={wfClsDisplayName:n[o].wfClsDisplayName,idWfClass:n[o].idWfClass,childs:[{idTask:n[o].idTask,tskDisplayName:n[o].tskDisplayName,count:n[o].count}]};for(var c=o+1;c<n.length;c++)l==n[c].idWfClass&&(d+=Number(n[c].count),a[r].childs.push({idTask:n[c].idTask,tskDisplayName:n[c].tskDisplayName,count:n[c].count}));a[r].count=d,r+=1}}var p=$.tmpl(i.tab2Tmpl,{rows:a,selectedTab:i.selectedTab});$("#async-tabs",e).append(p),i.setupTab2ActivitiesLink()}}).fail(function(e){bizagi.log(e)})},executeActivity:function(e){var t=this,i=t.getContent(),a=($("#main-screen",i),$("#dinamic-screen",i)),n="",s="";$.when(t.dataService.asyncActivitiesServices(e)).done(function(i){if(i.executed){var r=$.Deferred();$.when(t.checkAsycnExecutionState(1,e.idCase,e.idAsynchWorkitem,r)).done(function(){t.goToCase(e.idCase)}).fail(function(){n=bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-message"),s=$.tmpl(t.errorPage,{errorMessage:n}),a.html(""),a.append(s),t.setupErrorPageLink("#go-to-pending")})}else n=bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-retry"),s=$.tmpl(t.errorPage,{errorMessage:n})}).fail(function(e){bizagi.log(e)})},getRetryStatus:function(e,t,i){var a=this;return setTimeout(function(){$.when(a.dataService.getAsynchExecutionState({idCase:t,idAsynchWorkitem:idAsynchWorkitem})).done(function(e){"error"!=e.status&&i.resolve()}).fail(function(n){e<=3?(e+=1,a.getRetryStatus(e,t,idAsynchWorkitem,i)):i.reject()})},1e3),i.promise()},checkAsycnExecutionState:function(e,t,i,a){var n=this,s=n.getContent(),r=$("#main-screen",s),o=$("#dinamic-screen",s),l="";$("#ui-bizagi-wp-async-box",s);return $.when(n.dataService.getAsynchExecutionState({idCase:t,idAsynchWorkitem:i})).done(function(d){var c=n.getTemplate("async");"Error"==d.state&&void 0===d.errorMessage&&(d.errorMessage=bizagi.localization.getResource("render-async-error")),l=$.tmpl(c,d),r.hide(),o.html(""),o.append(l),$("#ui-bizagi-wp-async-box",s).css({top:0,left:0,"margin-top":0,"margin-left":0,"padding-top":0,"margin-right":0,width:"96%","max-height":"80",height:"80"}),n.setupErrorPageLink($("#link-go-to-inbox").find("a")),$("#link-back").css("display","inline"),n.setupBackToMainPage(),"Processing"==d.state?0==d.errorMessage.length&&setTimeout(function(){e+=1,n.checkAsycnExecutionState(e,t,i,a)},n.Class.ASYNC_CHECK_TIMER):"Finished"==d.state&&a.resolve(n.content)}),a.promise()},showLog:function(e,t,i){var a=this,n=a.getContent();e.page=i||1,$.when(a.dataService.asyncActivitiesServices(e)).done(function(i){if(a.totalRecords=i.records,a.totalPages=i.total,i.response.length){var s=$.tmpl(a.logTmpl,{rows:i.response,data:t});bizagi.util.formatInvariantDate(s,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),$("#dinamic-screen",n).html(""),$("#dinamic-screen",n).append(s),a.setupLogButtons();var r,o=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,l=$("#log-table-pager-wrapper"),d={};d.pagination=a.totalPages>1,d.page=i.page,d.pages={},d.additionalparameters=!0,d.totalPages=a.totalPages,d.totalRecords=a.totalRecords;for(var c=1;c<=o;c++)d.pages[c]={pageNumber:c};r=$.tmpl(a.paginatorTmpl,d).html(),l.append(r),$("ul",l).bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$(".pager-content",l),clickCallBack:function(i){a.showLog(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-no-records-found"),"Bizagi","warning").then(function(){$("#generalTitle",n).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),$("#main-screen",n).show()})}).fail(function(e){bizagi.log(e),$("#generalTitle",n).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),$("#main-screen",n).show()})},enableActivities:function(e,t){var i=this,a={action:"enableExecution",idTask:t,idWfClass:e};$.when(i.dataService.asyncActivitiesServices(a)).done(function(e){i.setupData()}).fail(function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")})},enableMultipleActivities:function(e){var t=this,i={action:"enableMultiple",cases:JSON.stringify(e)};$.when(t.dataService.asyncActivitiesServices(i)).done(function(e){e.executed?t.setupData():bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")}).fail(function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")})},goToCase:function(e){this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e,idWorkItem:"",idTask:""}),this.publish("closeCurrentDialog")},asyncActRefresh:function(){var e=this,t=e.getContent();$("#async-act-refresh-link",t).unbind(),$("#async-act-refresh-link",t).click(function(t){e.setupData(),e.selectedTab&&$("#async-tabs li:eq("+e.selectedTab+") a").click()})},setupActionsButton:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i),e.asyncActRefresh(t),$(".async-act-log-link",t).click(function(i){var a={action:"asyncExecutionLog",idCase:this.getAttribute("data-idCase"),idWorkItem:this.getAttribute("data-idWorkItem"),pageSize:e.maxElemShow,idAsynchWorkitem:this.getAttribute("data-idAsynchWorkitem")},n={idCase:this.getAttribute("data-idCase"),radNumber:this.getAttribute("data-radNumber"),taskName:this.getAttribute("data-taskName"),processName:this.getAttribute("data-processName")};$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-activitieslog")),$("#main-screen",t).hide(),e.showLog(a,n)}),$(".async-act-retry-link",t).click(function(t){var i={action:"retryNow",idCase:this.getAttribute("data-idCase"),idWorkitem:this.getAttribute("data-idWorkItem"),processName:this.getAttribute("data-processName"),idAsynchWorkitem:this.getAttribute("data-idAsynchWorkitem"),taskName:this.getAttribute("data-taskName")};e.executeActivity(i)}),$("#async-act-enable-checks",t).click(function(){for(var t=document.getElementsByName("enableChecks"),i={cases:[]},a=0,n=t.length;a<n;a++)if(t[a].checked){var s=t[a].value,r=t[a].getAttribute("data-idWorkItem"),o=t[a].getAttribute("data-idAsynchWorkitem");o=t[a].getAttribute("data-idAsynchWorkitem");i.cases.push({idCase:s,idWorkItem:r,idAsynchWorkitem:o})}e.enableMultipleActivities(i)})},setupLogButtons:function(){var e=this.getContent();$("#async-act-button-back",e).click(function(t){$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),$("#main-screen",e).show(),$("#dinamic-screen",e).html("")})},setupTab1ActivitiesLink:function(e){var t=this;$(".async-activity-click",e).click(function(){t.goToCase($(this)[0].getAttribute("data-idCase"))})},setupTab2ActivitiesLink:function(e){var t=this;$(".async-act-process-tree-link",e).click(function(){$("div",this).hasClass("biz-wp-tree-expand-icon")?($("div",this).removeClass("biz-wp-tree-expand-icon"),$("div",this).addClass("biz-wp-tree-collapse-icon"),$(this).closest("tr").find(".async-act-childs").css("display","block"),$(this).closest("tr").find(".async-act-childs").addClass("clearfix")):($("div",this).removeClass("biz-wp-tree-collapse-icon"),$("div",this).addClass("biz-wp-tree-expand-icon"),$(this).closest("tr").find(".async-act-childs").css("display","none"),$(this).closest("tr").find(".async-act-childs").removeClass("clearfix"))}),$(".async-act-enable-link").click(function(){var e=this.getAttribute("data-idWfClass"),i=this.getAttribute("data-idTask")?this.getAttribute("data-idTask"):0;t.enableActivities(e,i)})},setupErrorPageLink:function(e){var t=this;$(e).click(function(){var e,i=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,a=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID;switch($.isFunction(bizagi.cookie)?bizagi.cookie("bizagiDefaultWidget"):a){case i:e=i;break;case a:default:e=a}t.publish("changeWidget",{widgetName:e}),t.publish("closeCurrentDialog")})},setupBackToMainPage:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-wp-async-box",t);$("#link-back",i).click(function(){e.setupData()})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersAdministration",{},{init:function(e,t,i){var a=this;a.maxRows=18,a.maxPages=10,a.currentPage=1,a.orderType="ASC",a.orderField="",a.totalPages=0,a.userData={},a.allowCreation=!0,a.userLinks=[{name:"downloadReport",label:bizagi.localization.getResource("workportal-gdpr-download-report"),icon:"icon-download-report-user",typeSVG:!0},{name:"anonymize",label:bizagi.localization.getResource("workportal-gdpr-anonymize"),icon:"icon-anonymize",typeSVG:!0},{name:"edition",label:bizagi.localization.getResource("bz-rp-components-dimension-edit"),icon:"bz-icon-pencil-outline",typeSVG:!1},{name:"log",label:bizagi.localization.getResource("render-actions-log"),icon:"bz-icon-log-outline",typeSVG:!1}],a._super(e,t,i),a.loadTemplates({"admin.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users"),"admin.users.formbuttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-formbuttons"),"admin.users.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-log"),"admin.users.licenses":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-licenses"),"admin.users.email":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-email"),"admin.users.anonymize":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-anonymize"),"admin.search.cases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-search-cases"),"admin.search.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-search-users"),"admin.table.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-table-users"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_ADMINISTRATION},renderContent:function(){var e=this.getTemplate("admin.users");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.admin.usersAdministration.extend("bizagi.workportal.widgets.admin.usersAdministration",{},{postRender:function(){var e=this;e.dateFormat=e.getResource("dateFormat")+" "+e.getResource("timeFormat"),e.$userTable=$("#bz-wp-widget-adminuser-usertable",e.content),e.$renderForm=$("#bz-wp-widget-adminuser-renderform",e.content),e.$buttonsContainer=$("#bz-wp-widget-adminuser-buttonset",e.content),e.$usersLicenses=$("#bz-wp-widget-adminuser-licenses",e.content),$.when(e.queryUserPermissions()).done(function(){e.renderUsersTable()}),e.addEventsHandler(),e.notifier=bizagi.injector.get("notifier")},renderUsersTable:function(){var e=this;e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:e.$userTable,userLinkLabel:e.userLinks})),e.usersTable.render()},queryUserPermissions:function(){var e=this,t=$.Deferred();return $.when(e.queryLicenses(),e.dataService.createUserAdministrationForm()).done(function(i,a){e.allowCreation=!(!i||!a[0].createUser||"Ldap"===bizagiConfig.authenticationType),t.resolve()}),t.promise()},queryLicenses:function(){var e=this,t=$.Deferred();return $.when(e.dataService.queryUsersLicenses()).done(function(i){e.showLicensesMessage(i),t.resolve(i.canAddNewUser)}),t.promise()},showLicensesMessage:function(e){if(!e.canAddNewUser||e.areLicensedUsersLimitNear){var t=this.getTemplate("admin.users.licenses");this.$usersLicenses.html($.tmpl(t,{users:e.activeUsers,licenses:e.licensedUsersAccount}))}},addEventsHandler:function(){var e=this;e.$userTable.on("clickUserLink",function(t,i){switch(e.userData=i,i.type){case"log":e.resetLogValues(),e.getUsersLogData();break;case"edition":e.renderForm();break;case"downloadReport":e.downloadReport();break;case"anonymize":e.anonymize()}}),e.$userTable.on("completeUserForm",function(){e.renderFormButtons("query")}),e.$userTable.on("click","#bz-wp-widget-adminuser-createbutton-wrapper",function(){e.userData={},e.renderForm()}),$("#bz-wp-widget-adminuser-buttonset",e.content).on("click","button",function(){e.returnToUserTable()}),e.$renderForm.on("click","table .sortColumnsData",function(){var t=$(this).data("orderfield"),i=$(this).data("ordertype");e.getUsersLogData({orderType:i,orderField:t})}),e.$renderForm.on("click","#js-btn-anonymize",function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.anonymizeUser(e.userData.id)).done(function(t){$.when(e.queryUserPermissions()).done(function(){e.showHideNewUser(e.allowCreation),e.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-general-word-action-successfully"),"")),e.returnToUserTable(),e.usersTable.getUsersTableData()})}).fail(function(t,i,a){e.notifier.showErrorMessage(printf(bizagi.util.processFailMessage(t.responseText),""))})}),e.$renderForm.on("click","#js-btn-anonymize-cancel",function(){e.returnToUserTable()}),e.$usersLicenses.on("click","button",function(t){switch($(this).data("type")){case"buy":e.buyLicense();break;case"licenses":e.renderLicensesWidgets()}t.stopPropagation()})},showHideNewUser:function(e){var t=$("#bz-wp-widget-adminuser-createbutton-wrapper",self.content);e?t.show():t.hide()},resetLogValues:function(){this.currentPage=1,this.orderType="ASC",this.orderField=""},renderLicensesWidgets:function(){this.publish("showDialogWidget",{widgetName:"userlicenses",data:{idCase:"Licenses"},modalParameters:{title:this.getResource("workportal-menu-submenu-Licenses"),width:"907px",showCloseButton:!0,id:"Licenses"}})},buyLicense:function(){window.open("http://www.bizagi.com","_black")},returnToUserTable:function(){this.toggleForm(!0),this.removeButtons(),this.$renderForm.empty()},getUsersLogData:function(e){var t=this;e=e||{};t.orderType=e.orderType||t.orderType,t.orderField=e.orderField||t.orderField,$.when(t.dataService.getUsersAdministrationLog({idUser:t.userData.id,Pag:t.currentPage,pagSize:t.maxRows,orderField:t.orderField,orderType:t.orderType})).done(function(e){t.totalPages=e.total,t.renderUserLogTable(e)})},removeButtons:function(){this.$buttonsContainer.empty()},renderUserLogTable:function(e){var t=this,i=t.getTemplate("admin.users.log"),a=(t.$renderForm,t.totalPages>1),n=t.getPagesArray();t.toggleForm(!1);var s=$.tmpl(i,e,{userName:t.userData.name,page:t.currentPage,pagination:a,pagesArray:n,orderType:t.orderType,orderField:t.orderField});bizagi.util.formatInvariantDate(s,t.dateFormat),t.$renderForm.html(s),t.setUpPagination(),t.renderFormButtons("back")},setUpPagination:function(){var e=this,t=$("#biz-wp-usersadministration-pager ul",e.content);t.bizagiPagination({maxElemShow:e.maxRows,totalPages:e.totalPages,actualPage:e.currentPage,listElement:t,clickCallBack:function(t){e.currentPage=parseInt(t.page),e.getUsersLogData()}})},getPagesArray:function(){for(var e=this.maxPages>this.totalPages?this.totalPages:this.maxPages,t=[],i=0;i<e;i++)t.push(i+1);return t},renderFormButtons:function(e){var t=this.getTemplate("admin.users.formbuttons"),i=$.tmpl(t,{type:e,allowCreation:this.allowCreation});"query"===e?$("#bz-wp-widget-adminuser-usertable #users-table-buttonset",this.content).append(i):this.$buttonsContainer.html(i)},toggleForm:function(e){switch(e){case!0:this.$userTable.show(),this.$renderForm.hide();break;case!1:this.$userTable.hide(),this.$renderForm.show()}},getPages:function(){for(var e=this.maxPages>this.totalPages?this.totalPages:this.maxPages,t=[],i=0;i<e;i++)t.push(i+1);return t},renderForm:function(){var e=this;bizagi.loader.start("rendering").then(function(){var t=e.$renderForm,i=new bizagi.rendering.facade,a=e.userData.id||0,n=e.userData.id?"edit":"add",s=e.getLoadFormParams(a);e.toggleForm(!1),e.removeButtons(),e.dataService.getUsersForm(s).done(function(s){var r={canvas:t,data:s,type:"usersForm",userId:a,action:n};i.execute(r).done(function(){e.userForm=i.form,e.userForm.bind("endUsersForm",function(t,i){e.performActionsAfterSave(i)})})})})},getLoadFormParams:function(e){var t={h_action:"LOADUSERADMINFORM",h_contexttype:"entity"};return e?$.extend(t,{h_xpathContext:"@Context.Users[id == "+e+"]",h_optionform:"edit"}):$.extend(t,{h_optionform:"add"}),t},performActionsAfterSave:function(e){var t=this,i=e.userId||t.userData.id;e.sendMail&&t.sendMail(i,e.password),"save"===e.formAction||"cancel"===e.formAction?(void 0!==t.usersTable&&(t.usersTable.afterSave=!0),$.when(t.queryUserPermissions()).done(function(){t.usersTable.excecuteQuery(),t.showHideNewUser(t.allowCreation),e.error||(t.userForm.endLoading(),t.returnToUserTable())})):t.returnToUserTable()},sendMail:function(e,t){var i=this;i.dataService.generateDataToSendByEmail({idUser:e}).done(function(e){i.showEmailPopup(e,t)})},showEmailPopup:function(e,t){var i=this,a=window.document,n=i.getTemplate("admin.users.email"),s=i.dialogBoxEmail=$("<div class= admin-users-email/>");s.empty(),s.appendTo("body",a);var r={};r[i.getResource("workportal-widget-admin-users-button-label-send")]=function(){if(""!==$("#txtTextTo",s).val()){var e={eMailTo:$("#txtTextTo",s).val(),subject:$("#txtSubject",s).val(),body:$("#txtBody",s).val(),userSecret:t};$.when(i.dataService.sendUserEmail(e)).done(function(e){i.closeUploadDialogEmail();var t=bizagi.localization.getResource("workportal-widget-admin-users-Send-message");e.logOff&&"false"==e.logOff&&(t=bizagi.localization.getResource("workportal-widget-admin-users-Not-Send-message")),bizagi.showMessageBox(t,"Bizagi","warning")})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-empty-email-to"),"Bizagi","warning")},r[i.getResource("workportal-widget-admin-users-button-label-notSend")]=function(){i.closeUploadDialogEmail()},e.body=e.body.replace(/\\n/g,"\n").replace(/\\/g,""),$.tmpl(n,{messageResponse:e}).appendTo(s),$(".ui-bizagi-loading-message").remove(),s.dialog({width:500,title:i.getResource("workportal-widget-admin-users-subtitle-email"),modal:!0,maximize:!1,resizable:!1,draggable:!1,buttons:r,close:function(){i.closeUploadDialogEmail()},resizeStop:function(e,t){i.form&&i.form.resize(t.size)},maximize:function(e){i.userForm&&i.userForm.triggerHandler("maximazedForm")},unmaximize:function(e){i.userForm&&i.userForm.triggerHandler("unmaximazedForm")}})},closeUploadDialogEmail:function(){this.dialogBoxEmail.dialog("destroy"),this.dialogBoxEmail.remove()},downloadReport:function(){this.dataService.downloadReportUser(this.userData.id)},anonymize:function(){var e=this,t=e.getTemplate("admin.users.anonymize");e.$renderForm;e.toggleForm(!1);var i=bizagi.localization.getResource("workportal-gdpr-anonymize-description-sure").replaceAll("%s",e.userData.fullName),a=$.tmpl(t,{descriptionTranslated:i});e.$renderForm.html(a),e.renderFormButtons("back")}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersDelegation",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.userdelegation":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#ui-bizagi-workportal-widget-admin-userdelegation"),"admin.userdelegationListTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-configurations-tmpl"),"admin.userdelegationDeleteConfirmationTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-delete-confirmation-tmpl"),"admin.userdelegationFormTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-form-tmpl"),"admin.userdelegationEmptyMessageTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-configurations-message-tmpl"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_DELEGATION},renderContent:function(){var e=this.getTemplate("admin.userdelegation");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersDelegation.searchUser",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_DELEGATION_SEARCH_USER},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.admin.usersDelegation.extend("bizagi.workportal.widgets.admin.usersDelegation",{},{postRender:function(){var e=this;e.maxPages=10,e.maxRows=10,e.currentPage=1,e.showTable=!0,e.orderType="ASC",e.orderField="",e.dateFormat=e.getResource("dateFormat")+" "+e.getResource("timeFormat"),e.$delegationFormWrapper=$("#widget-userdelegation__form-wrapper",e.content),e.$DelegationListWrapper=$("#widget-userdelegation__configurations-wrapper",e.content),e.tableHeaders=[{displayName:e.getResource("workportal-widget-userdelegation-process"),fieldValue:"processName"},{displayName:e.getResource("workportal-widget-userdelegation-username"),fieldValue:"userName"},{displayName:e.getResource("workportal-widget-userdelegation-delegatedname"),fieldValue:"delegatedName"},{displayName:e.getResource("workportal-widget-userdelegation-init-date"),fieldValue:"startDate"},{displayName:e.getResource("workportal-widget-userdelegation-end-date"),fieldValue:"endDate"}],e.renderDelegationForm(),e.initDelegationTable(),e.addEventsHandler()},renderDelegationForm:function(){var e=this,t=e.getTemplate("admin.userdelegationFormTmpl");$.tmpl(t,{currentUser:"TestUser"}).appendTo(e.$delegationFormWrapper);var i=$("#widget-userdelegation__start-date",e.content),a=$("#widget-userdelegation__end-date",e.content),n=new Date;i.datepicker({minDate:n}),a.datepicker({minDate:n}),e.configureProcessCombo(),$("#widget-userdelegation__start-date-btn",e.content).click(function(){i.datepicker("show")}),$("#widget-userdelegation__end-date-btn",e.content).click(function(){a.datepicker("show")})},configureProcessCombo:function(){var e=this,t={idUser:bizagi.currentUser.idUser};$.when(e.dataService.getProcessToDelegate(t)).done(function(t){var i=$(".widget-userdelegation__delegated-process-combo-wrapper",e.content),a={combo:[],id:"widget-userdelegation__process-to-delegate-combo"};a.combo=a.combo.concat(t.process),i.empty(),e.processComponent=e.setupMultiselector(i,t.process)})},setupMultiselector:function(e,t){var i=this,a={options:t,element:e,values:[]};return e.uicombo({data:{combo:t},isEditable:!0,isSearchable:!0,initValue:"tetetet",itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onComplete:function(){var t=bizagi.localization.getResource("workportal-widget-userdelegation-please-select-your-process");$(".biz-wp-combo-input",e).addClass("widget-user-delegation__multiselector-input"),$(".biz-wp-combo-input").attr("placeholder",t),e.prepend('<div class="widget-user-delegation__multiselector"></div>')},onComboDropDown:function(){i.markChoicesMultiselector(a)},onChange:function(e){var t=e.ui.val()||"",n=e.ui.data("value");i.filterOptionsMultiselector(a,t),i.addChoiceMultiselector(a,n,!0)}}),a},markChoicesMultiselector:function(e){$("li",e.element).removeClass("widget-user-delegation__multiselector__option--selected"),$("li",e.element).prepend('<i class="widget-user-delegation__multiselector__option__icon"></i>'),$.each(e.values,function(t,i){$('li[data-value="'+i+'"]',e.element).addClass("widget-user-delegation__multiselector__option--selected")})},filterOptionsMultiselector:function(e,t){var i=e.options.filter(function(e){return 0==e.displayName.toLowerCase().indexOf(t.toLowerCase())});$("li",e.element).hide(),$.each(i,function(t,i){$('li[data-value="'+i.id+'"]',e.element).show()})},addChoiceMultiselector:function(e,t,i){if(t){var a=e.options.find(function(e){return e.id==t}).displayName;if(-1===e.values.indexOf(t+"")){var n='<div class="widget-user-delegation__multiselector__item" data-value ='+t+">"+a+' | <i class="widget-user-delegation__multiselector__item-clear-btn bz-icon bz-icon-close"></i></div>';$(".widget-user-delegation__multiselector",e.element).append(n),$(".biz-wp-combo-input",e.element).css({"box-shadow":"none"}),$(".widget-user-delegation__multiselector-input",e.element).val(""),e.values.push(t+""),i&&$(".widget-user-delegation__multiselector__item-clear-btn",e.element).click(function(){var t=$(this).parent(),i=e.values.indexOf(t.data().value+"");i>=0&&(e.values.splice(i,1),t.remove(),e.values.length&&e.values.length<1&&$(".biz-wp-combo",e.element).show())})}}},initDelegationTable:function(e){var t=this,i=e||{pag:1,pagSize:t.maxRows};i.idUser=bizagi.currentUser.idUser;var a=t.getTemplate("admin.userdelegationListTmpl");t.$DelegationListWrapper.html(""),$.when(t.dataService.queryDelegations(i)).done(function(e){if(e.delegations.length>0){var i=e.records>1,n=Math.ceil(e.records/t.maxRows),s=t.getPagesArray(n);$.tmpl(a,{headers:t.tableHeaders,orderField:t.orderField,orderType:t.orderType,delegationList:e.delegations,page:e.page,pagination:i,pagesArray:s}).appendTo(t.$DelegationListWrapper),t.setUpPagination(n),t.setUpSortColumnLinks(),$(".widget-userdelegation__separator__btn-icon",t.content).addClass("widget-userdelegation__separator__btn-icon--opened")}else{var r=t.getTemplate("admin.userdelegationEmptyMessageTmpl"),o=bizagi.localization.getResource("workportal-widget-userdelegation-empty-list-message");t.$DelegationListWrapper.html($.tmpl(r,{message:o}))}t.addTableEventsHandler(),t.delegatedAssignment={element:$("#widget-userdelegation__delegated-assignment-user",t.content),value:""}})},getPagesArray:function(e){for(var t=this.maxPages>e?e:this.maxPages,i=[],a=0;a<t;a++)i.push(a+1);return i},setUpPagination:function(e){var t=this,i=$("#widget-userdelegation__delegation-list__table-pager ul",t.content);i.bizagiPagination({maxElemShow:t.maxRows,totalPages:e,actualPage:t.currentPage,listElement:i,clickCallBack:function(e){var i={pag:t.currentPage=parseInt(e.page),pagSize:t.maxRows,orderField:t.orderField,orderType:t.orderType};t.initDelegationTable(i)}})},setUpSortColumnLinks:function(){var e=this;$(".biz-wp-table-head th",e.content).click(function(){e.orderField=$(this).data("orderfield"),e.orderType=$(this).data("ordertype")||e.orderType;var t={orderType:e.orderType,orderField:e.orderField,pagSize:e.maxRows,pag:e.currentPage};e.initDelegationTable(t)})},addTableEventsHandler:function(){var e=this,t=e.getContent();$(".widget-userdelegation__delegation-list__edit-btn",e.content).click(function(){e.selectedDelegation=$(this).parent().data(),e.delegatedAssignment.element.val(e.selectedDelegation.delegatedName),e.delegatedAssignment.value=e.selectedDelegation.idDelegate,$(".biz-wp-combo",e.processComponent.element).hide(),e.clearMultiselector(e.processComponent),e.addChoiceMultiselector(e.processComponent,e.selectedDelegation.idProcess,!1),$(".widget-userdelegation__delegated-assignment--edition",e.content).show(),$(".widget-userdelegation__delegated-assignment",e.content).hide(),$(".widget-userdelegation__delegated-assignment--edition__value",e.content).text(e.selectedDelegation.delegatedName),$("#widget-userdelegation__start-date",e.content).datepicker("setDate",new Date(Date.parse(e.selectedDelegation.startDate,"MM/DD/YYYY"))),$("#widget-userdelegation__end-date",e.content).datepicker("setDate",new Date(Date.parse(e.selectedDelegation.endDate,"MM/DD/YYYY"))),$(".widget-user-delegation__multiselector__item-clear-btn",e.content).hide(),$("#widget-userdelegation__delegated-startdate--edition",e.content).show(),$(".widget-userdelegation__delegated-startdate--edition__value",e.content).text(e.selectedDelegation.startDate),$("#widget-userdelegation__form-input_date_startdate",e.content).hide()}),$(".widget-userdelegation__delegation-list__delete-btn",e.content).click(function(){var t=$(this).parent().data();e.openDeleteConfirmation(t)}),$(".widget-userdelegation__separator__btn",t).click(function(){var i=$(".widget-userdelegation__delegation-list",t);e.showTable=!e.showTable,e.showTable?($(".widget-userdelegation__separator__btn-icon",t).addClass("widget-userdelegation__separator__btn-icon--opened"),i.show()):($(".widget-userdelegation__separator__btn-icon",t).removeClass("widget-userdelegation__separator__btn-icon--opened"),i.hide())})},openDeleteConfirmation:function(e){var t=this,i=$.tmpl(t.getTemplate("admin.userdelegationDeleteConfirmationTmpl"),{delegation:e});i.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:e.processName,maximize:!1,close:function(){i.dialog("destroy"),i.detach()},buttons:[{text:t.getResource("workportal-general-button-label-ok"),click:function(){$(this).dialog("destroy"),t.deleteDelegation(e)}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("destroy")}}]})},deleteDelegation:function(e){var t=this;$.when(t.dataService.deleteDelegation(e)).done(function(e){t.initDelegationTable()})},addEventsHandler:function(){var e=this,t=e.getContent();$(".widget-userdelegation__bread-crumbs__link-1",e.content).click(function(){var e=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-1");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(e),$(".widget-userdelegation__wrapper",t).show(),$(".widget-userdelegation__bread-crumbs",t).hide(),$("#widget-userdelegation__getuser-wrapper",t).html(""),$("#widget-userdelegation__getuser-wrapper",t).hide()}),$(".widget-userdelegation__bread-crumbs__link-2",e.content).click(function(){var i=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-2");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(i),$(".widget-userdelegation__wrapper",t).hide(),$(".widget-userdelegation__bread-crumbs",t).show(),$(".widget-userdelegation__bread-crumbs__link-3",e.content).hide(),$("#widget-userdelegation__getuser-wrapper",t).html(""),e.setupUsersSearchForm(e.delegatedAssignment)}),$("#widget-userdelegation__delegated-assignment-user",t).focus(function(){e.setupUsersSearchForm(e.delegatedAssignment)}),$("#widget-userdelegation__delegated-assignment-search-btn",t).click(function(){var t=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-2");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(t),e.setupUsersSearchForm(e.delegatedAssignment)}),$("#widget-userdelegation__delegated-assignment-clear-btn",t).click(function(){$("#widget-userdelegation__delegated-assignment-user",t).val(""),e.delegatedAssignment.value=""}),$("#widget-userdelegation__new-assignment-save-btn",t).click(function(){e.selectedDelegation?e.updateDelegation():e.saveDelegation()}),$("#widget-userdelegation__new-assignment-clear-btn",t).click(function(){e.clearForm()})},setupUsersSearchForm:function(e){var t=this,i=t.getContent(),a=$.Deferred();$(".widget-userdelegation__bread-crumbs",i).show(),$(".widget-userdelegation__wrapper",i).hide(),$("#widget-userdelegation__getuser-wrapper",i).show(),t.usersTable=new bizagi.workportal.widgets.admin.usersDelegation.searchUser(t.workportalFacade,t.dataService,$.extend(t.params,{canvas:$("#widget-userdelegation__getuser-wrapper",i),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:a})),t.usersTable.render(),$.when(a).done(function(t,a){$("#widget-userdelegation__getuser-wrapper",i).html(""),$("#widget-userdelegation__getuser-wrapper",i).hide(),e.element.val(a),e.value=t,$(".widget-userdelegation__wrapper",i).show(),$(".widget-userdelegation__bread-crumbs",i).hide(),$(".widget-userdelegation__bread-crumbs li:last-child",i).hide()})},updateDelegation:function(){var e=this,t=$("#widget-userdelegation__start-date",e.content).datepicker("getDate"),i=$("#widget-userdelegation__end-date",e.content).datepicker("getDate"),a={idDelegation:e.selectedDelegation.idDelegation,idUser:bizagi.currentUser.idUser,idDelegate:e.delegatedAssignment.value,idsProcess:JSON.stringify(e.processComponent.values),startDate:bizagi.util.dateFormatter.formatDate(t,"yyyy-MM-dd"),endDate:bizagi.util.dateFormatter.formatDate(i,"yyyy-MM-dd"),enableSub:1};e.validateSaveUpdateParams(a)&&$.when(e.dataService.updateDelegation(a)).done(function(){e.clearForm(),e.initDelegationTable(),e.selectedDelegation=null}).fail(function(t){for(var i=t.responseJSON.messages,a=[],n=0;n<i.length;n++){var s=i[n][n].error,r=i[n][n].message;a.push(bizagi.localization.getResource(s)+" <br /> <b>"+r+"</b> <br /> ")}$("#widget-userdelegation__assignation--error",e.content).show(),$("#widget-userdelegation__assignation--error_value",e.content).html(a.toString())})},saveDelegation:function(){var e=this,t=$("#widget-userdelegation__start-date",e.content).datepicker("getDate"),i=$("#widget-userdelegation__end-date",e.content).datepicker("getDate"),a={idUser:bizagi.currentUser.idUser,idDelegate:e.delegatedAssignment.value,idsProcess:JSON.stringify(e.processComponent.values),startDate:bizagi.util.dateFormatter.formatDate(t,"yyyy-MM-dd"),endDate:bizagi.util.dateFormatter.formatDate(i,"yyyy-MM-dd"),enableSub:1};e.validateSaveUpdateParams(a)&&$.when(e.dataService.saveDelegation(a)).done(function(){e.clearForm(),e.initDelegationTable(),e.selectedDelegation=null}).fail(function(t){for(var i=t.responseJSON.messages,a=[],n=0;n<i.length;n++){var s=i[n][n].error,r=i[n][n].message;a.push(bizagi.localization.getResource(s)+" <br /> <b>"+r+"</b> <br /> ")}$("#widget-userdelegation__assignation--error",e.content).show(),$("#widget-userdelegation__assignation--error_value",e.content).html(a.toString())})},validateSaveUpdateParams:function(e){var t=this.getContent(),i=new Date(Date.parse(e.startDate,"MM/DD/YYYY HH:mm:ss")),a=new Date(Date.parse(e.endDate,"MM/DD/YYYY HH:mm:ss"));return $("#widget-userdelegation__delegated-process-combo-alert",t).hide(),$("#widget-userdelegation__delegated-assignment-user-alert",t).hide(),$("#widget-userdelegation__start-date-alert",t).hide(),$("#widget-userdelegation__end-date-alert",t).hide(),$("#widget-userdelegation__delegation-period-alert",t).hide(),"[]"==e.idsProcess&&$("#widget-userdelegation__delegated-process-combo-alert",t).show(),bizagi.util.isEmpty(e.idDelegate)&&$("#widget-userdelegation__delegated-assignment-user-alert",t).show(),e.startDate||$("#widget-userdelegation__start-date-alert",t).show(),e.endDate||$("#widget-userdelegation__end-date-alert",t).show(),a<i&&$("#widget-userdelegation__delegation-period-alert",t).show(),e.idUser&&e.idsProcess&&!bizagi.util.isEmpty(e.idDelegate)&&e.startDate&&e.endDate&&a>=i},clearForm:function(){var e=this;e.clearMultiselector(e.processComponent),e.delegatedAssignment.element.val(""),$(".biz-wp-combo",e.processComponent.element).show(),$(".workportal-widget-userdelegation__sub-delegation__checkbox").prop("checked",!1),$("#widget-userdelegation__process-to-delegate-combo",e.content).val(""),$("#widget-userdelegation__start-date",e.content).val(""),$("#widget-userdelegation__end-date",e.content).val(""),$("#widget-userdelegation__getuser-wrapper",e.content).html(""),$(".widget-userdelegation__delegated-assignment--edition",e.content).hide(),$(".widget-userdelegation__delegated-assignment",e.content).show(),$("#widget-userdelegation__delegated-startdate--edition",e.content).hide(),$(".widget-user-delegation__multiselector__item-clear-btn",e.content).show(),$("#widget-userdelegation__form-input_date_startdate",e.content).show(),$("#widget-userdelegation__assignation--error",e.content).hide()},clearMultiselector:function(e){e.element.val(""),$(".widget-user-delegation__multiselector",e.element).html(""),e.values=[]}}),bizagi.workportal.widgets.admin.usersDelegation.searchUser.extend("bizagi.workportal.widgets.admin.usersDelegation.searchUser",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.filterData={},a.maxRows=8,a.maxPages=10,a.$canvas=i.canvas,a.users=[],a.totalPages=0,a.currentPage=1,a.orderType="ASC",a.orderField="",a.tableHeaders=[{displayName:a.getResource("workportal-widget-usertable-id"),fieldValue:"idUser"},{displayName:a.getResource("workportal-widget-usertable-user"),fieldValue:"fullName"},{displayName:a.getResource("workportal-widget-usertable-name"),fieldValue:"userName"},{displayName:a.getResource("workportal-widget-usertable-domain"),fieldValue:"domain"},{displayName:a.getResource("workportal-widget-usertable-email"),fieldValue:"contactEmail"},{displayName:a.getResource("workportal-widget-usertable-active-assign"),fieldValue:"enabledForAssignation"},{displayName:a.getResource("workportal-widget-usertable-active"),fieldValue:"enabled"}],a.loadTemplates({searchUser:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-tmpl"),"searchUser.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-form-tmpl"),"searchUser.message":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-message-tmpl"),"searchUser.table.wrapper.final":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-table-wrapper-final-tmpl"),useNewEngine:!1}),bizagi.templateService.getTemplateWidget(bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-table-final-tmpl")).done(function(e){a.tmpl["searchUser.table.final"]=e.markup})},renderContent:function(){var e,t=this.getTemplate("searchUser");return e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){this.loadtemplates(),this.setupData()},loadtemplates:function(){var e=this;e.usersTableFormTmpl=e.getTemplate("searchUser.form"),e.usersTableMessage=e.getTemplate("searchUser.message"),e.usersTableTmpl=e.getTemplate("searchUser.table.wrapper.final"),e.usersTableTmplFinal=e.getTemplate("searchUser.table.final")},setupData:function(){var e=this,t=$.tmpl(e.usersTableFormTmpl,{}),i=[],a=[],n=[],s=[];$.when(e.dataService.getPreferencesCurrentUser()).done(function(e){i=e.sRoles||[],a=e.sSkills||[],n=e.sPositions||[],s=e.sOrganizations||[]}).fail(function(e){bizagi.log(e)});var r=[$.when(e.getValuesMultiple("LOCATION")),$.when(e.getValuesMultiple("ROLE")),$.when(e.getValuesMultiple("SKILL")),$.when(e.getValuesMultiple("ORGPOSITION")),$.when(e.getValuesMultiple("ORG"))];$.when.apply($,r).then(function(r,o,l,d,c){$("#ui-bizagi-workportal-widget-search-user__form-wrapper",e.content).html(""),$("#ui-bizagi-workportal-widget-search-user__form-wrapper",e.content).html(t),e.locationsComponent=e.configureProcessCombo(r);var p=$("#widget-search-user__roles");e.rolesComponent=e.setupMultiselector(p,o,i);var g=$("#widget-search-user__skills");e.skillsComponent=e.setupMultiselector(g,l,a);var u=$("#widget-search-user__positions");e.positionsComponent=e.setupMultiselector(u,d,n);var m=$("#widget-search-user__organizations");e.organizationsComponent=e.setupMultiselector(m,c,s),e.setupEventsHandler(),e.$canvas.trigger("completeUserForm"),$("#ui-bizagi-workportal-widget-search-user__backfilters-btn",e.content).click(function(){$(".widget-userdelegation__bread-crumbs__link-1").click()})})},getValuesMultiple:function(e){var t=this,i=$.Deferred(),a='{"select":[{"type":"Entity","children": [{"type":"EntityValue","data":"*"}],"data":"*","where":{"name":"'+e+'"}}]}';return $.when(t.dataService.getValuesFromCQL(a)).done(function(e){var a=[];if(e&&e[0]){var n=JSON.parse(e[0].content).displayAttribute.baref.ref;$.each(e[0].children,function(){var e=JSON.parse(this.content).idEntityValue,i=t.allKeysToUpperCase(JSON.parse(this.content).fields)[n.toUpperCase()];a.push({id:e,displayName:i})}),a.sort(function(e,t){return e.displayName>t.displayName?1:t.displayName>e.displayName?-1:0})}i.resolve(a)}).fail(function(e){bizagi.log(e)}),i.promise()},allKeysToUpperCase:function(e){var t={};for(var i in e)"[object Object]"===Object.prototype.toString.apply(e[i])?t[i.toUpperCase()]=this.allKeysToUpperCase(e[i]):t[i.toUpperCase()]=e[i];return t},configureProcessCombo:function(e){var t=this,i=$("#widget-search-user__locations",t.content),a={combo:[],id:"widget-search-user__locations-to-delegate-combo"};return a.combo=a.combo.concat(e),i.empty(),i.uicombo({isEditable:!1,data:a,itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onComplete:function(){},onChange:function(e){var a=e.ui.data("value");t.idProcess=a,$(".biz-wp-combo-input",i).css({"box-shadow":"none"})}}),i},setupMultiselector:function(e,t,i){var a=this,n={element:e,options:t,values:[]};return e.uicombo({data:{combo:t},itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onComplete:function(){},onChange:function(e){var t=e.ui.data("value");n=a.addChoiceMultiselector(n,t)},onComboDropDown:function(){a.markChoicesMultiselector(n)}}),$(".biz-wp-combo-input",e).addClass("widget-search-user__multiselector-input"),$(e).prepend('<div class="widget-search-user__multiselector"></div>'),$.each(i,function(){n=a.addChoiceMultiselector(n,this.id)}),n},addChoiceMultiselector:function(e,t){var i=e.options.filter(function(e){return e.id==t})[0];if(-1===e.values.indexOf(t+"")&&null!=i){var a=i.displayName;$(".widget-search-user__multiselector",e.element).append('<div class="widget-search-user__multiselector__item" data-value ='+t+">"+a+' | <i class="widget-search-user__multiselector__item-clear-btn bz-icon bz-icon-close"></i></div>'),$(".biz-wp-combo-input",e.element).css({"box-shadow":"none",color:"white"}),e.values.push(t+""),$(".widget-search-user__multiselector__item-clear-btn",e.element).click(function(){var t=$(this).parent(),i=e.values.indexOf(t.data().value+"");i>=0&&(e.values.splice(i,1),t.remove(),e.values.length<=0&&$(".biz-wp-combo",e.element).show())})}return e},markChoicesMultiselector:function(e){$("li",e.element).removeClass("widget-search-user__multiselector__option--selected"),$("li",e.element).prepend('<i class="widget-search-user__multiselector__option__icon"></i>'),$.each(e.values,function(t,i){$('li[data-value="'+i+'"]',e.element).addClass("widget-search-user__multiselector__option--selected")})},setupEventsHandler:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-workportal-widget-search-user__form-wrapper form",t);i.on("submit",function(t){t.preventDefault(),e.currentPage=1,e.orderType="ASC",e.orderField="";var i=[],a=$(this.elements["widget-search-user__locations-to-delegate-combo"]).data("value");null!=a&&""!=a&&i.push(a),e.filterData={domain:this.elements.domainInput.value,userName:this.elements.userFullName.value,fullName:this.elements.userNameReassignInput.value,locations:JSON.stringify(i),pag:e.currentPage,pagSize:e.maxRows,orderField:e.orderField,orderType:e.orderType},e.getUsersTableData({idUser:bizagi.currentUser.idUser,organization:JSON.stringify(e.organizationsComponent.values),roles:JSON.stringify(e.rolesComponent.values),skills:JSON.stringify(e.skillsComponent.values),locations:JSON.stringify(i),positions:JSON.stringify(e.positionsComponent.values)})}),i.on("keyup keypress",function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),i.submit(),!1}),i.on("reset",function(i){i.preventDefault(),$(this.elements["widget-search-user__locations-to-delegate-combo"]).data("value","").val(""),this.elements.domainInput.value="",this.elements.userFullName.value="",this.elements.userNameReassignInput.value="",e.cleanForm(),$("#ui-bizagi-workportal-widget-search-user__list-wrapper",t).empty()})},cleanForm:function(){var e=this;$("#widget-search-user__locations",e.content).val(""),e.clearMultiselector(e.organizationsComponent),e.clearMultiselector(e.rolesComponent),e.clearMultiselector(e.skillsComponent),e.clearMultiselector(e.positionsComponent)},clearMultiselector:function(e){e.element.val(""),$(".widget-search-user__multiselector",e.element).html(""),e.values=[]},getUsersTableData:function(e){var t=this;e=e||{},t.orderType=e.orderType||t.orderType,t.orderField=e.orderField||t.orderField,$.when(t.dataService.getUsersForDelegation($.extend(t.filterData,e))).done(function(e){t.showUsersTable(e)}).fail(function(e){bizagi.log(e)})},showUsersTable:function(e){var t=this;t.users=e.users;var i=$("#ui-bizagi-workportal-widget-search-user__list-wrapper",t.content),a=$("#ui-bizagi-workportal-widget-search-user__form-wrapper",t.content),n=$(".widget-userdelegation__bread-crumbs li:last-child");if(t.users.length>0){var s=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-3");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(s),i.empty(),i.show();var r=$.tmpl(t.usersTableTmpl,{});i.html(r),t.tableFinal=new Vue({el:$("#table",i)[0],template:t.usersTableTmplFinal,data:{users:t.users,headers:t.tableHeaders,orderField:t.orderField,orderType:t.orderType,renderBooleanYes:t.getResource("render-boolean-yes"),renderBooleanNo:t.getResource("render-boolean-no"),selectedUser:""},methods:{selectUser:function(e){this.selectedUser=e}}}),a.hide(),n.show(),$("#ui-bizagi-workportal-widget-search-user__selected-btn",t.content).click(function(){if(""!==t.tableFinal.selectedUser){var e=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-1");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(e),t.params.parentDef.resolve(t.tableFinal.selectedUser.idUser,t.tableFinal.selectedUser.userName),"usersDelegation"==t.params.widgetName&&bizagi.workportal.desktop.dialogStack.length>0&&bizagi.workportal.desktop.dialogStack[bizagi.workportal.desktop.dialogStack.length-1].dialogBox.on("dialogbeforeclose",function(){!0===t.resultStatus&&t.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView})}),t.tableFinal.$destroy(),$(this).unbind("click"),$("#ui-bizagi-workportal-widget-search-user__back-btn",t.content).unbind("click")}else t.$canvas.trigger("clickUserLink",{id:this.id,name:this.name,type:$(this).data("linkname")})}),$("#ui-bizagi-workportal-widget-search-user__back-btn",t.content).click(function(){var e=$("#ui-bizagi-workportal-widget-search-user__list-wrapper",t.content),i=$("#ui-bizagi-workportal-widget-search-user__form-wrapper",t.content),a=$(".widget-userdelegation__bread-crumbs li:last-child"),n=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-2");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(n),e.empty(),i.show(),e.hide(),a.hide(),t.tableFinal.$destroy(),$(this).unbind("click"),$("#ui-bizagi-workportal-widget-search-user__selected-btn",t.content).unbind("click")})}else{s=bizagi.localization.getResource("workportal-widget-usertable-empty");$(".bz-wp-table-centermessage",t.content).find("h3").text(s),setTimeout(function(){$(".bz-wp-table-centermessage",t.content).find("h3").text("")},3e3)}}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.holidays",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_HOLIDAYS},init:function(e,t,i){this.holidaysObj={calendarSelector:null,activeCalendar:"",schemas:[],schema:{},holidays:{},holidaysInServer:{}},this._super(e,t,i),this.loadTemplates({"admin.holidays":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.holidays").concat("#ui-bizagi-workportal-widget-admin-holidays"),"admin.holidays.calendar.schema":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.holidays").concat("#ui-bizagi-workportal-widget-admin-holidays-calendar-schema"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("admin.holidays");return this.content=$.tmpl(e)},postRender:function(){var e=this;$.when(e.dataService.getHolidaysSchemas()).done(function(t){e.holidaysObj.schemas=t,$.each(t,function(t,i){e.holidaysObj.schema[i.id]={}}),e.renderHolidaysSchema(t)}).fail(function(e){console.log("ERROR",e)})},_getSchemas:function(e){e=e||[];var t={};return $.each(e,function(e,i){t[i.id]=i}),t},_getDaysBySchema:function(e,t){return(t=t||{})[e=e||""]||[]},_calendarHasChanges:function(){var e=!1;return""!=this.holidaysObj.activeCalendar&&this.holidaysObj.schema[this.holidaysObj.activeCalendar].modified&&(e=!0),e},_getChanges:function(e){var t=this,i=[],a=[],n=[];if(e){var s=function(e,t){var i=-1;return e=e||new Date,$.each(t,function(t,a){new Date(a.date).getTime()==e.getTime()&&(i=t)}),i},r=function(e,r,o){var l="add"==o?a:i,d="add"==o?i:a;$.each(e,function(e,i){var a=s(new Date(i.date),r);a>=0?(-1==s(new Date(i.date),n)&&n.push(i),r[a].description!=i.description&&-1==s(new Date(r[a].date),d)&&(r[a].date=t.formatDateStringToISO8601(r[a].date),i.date=t.formatDateStringToISO8601(i.date),d.push(r[a]),l.push(i))):(i.date=t.formatDateStringToISO8601(i.date),l.push(i),n.push(i))})};return r(t.holidaysObj.holidays[e],t.holidaysObj.holidaysInServer[e],"add"),r(t.holidaysObj.holidaysInServer[e],t.holidaysObj.holidays[e],"delete"),{delete:i,add:a,actually:n}}},formatDateStringToISO8601:function(e){return bizagi.util.dateFormatter.isFormatISO8601(e)||(e=this._formatDateFromInvariantToISO8601(e)),e},saveSchema:function(e,t){var i=this,a=i.getContent(),n=$(".bz-ui-save-status",a);$.when(i._saveSchema(e,t)).done(function(){i.showSuccess(bizagi.localization.getResource("workportal-general-success"),n)}).fail(function(e){i.showError(bizagi.localization.getResource("workportal-general-error")+" : "+e.toString(),n)})},_saveSchema:function(e,t){var i=this,a=i._getChanges(e),n=new $.Deferred,s={add:a.add,delete:a.delete};return i.holidaysObj.calendarSelector.startLoading({overlay:!0}),$.when(i.dataService.saveHolidaysBySchema({schema:e,data:JSON.encode(s)})).done(function(a){i._resetSchemaChanges(e),setTimeout(function(){t||i._changeSchema(e),i.holidaysObj.calendarSelector.endLoading(),n.resolve()},1e3)}).fail(function(e){i.holidaysObj.calendarSelector.endLoading(),n.reject(e.toString())}),n.promise()},showError:function(e,t){var i='<i class="bz-icon bz-icon-error"></i>&nbsp; Error:'+e;t.empty(),t.show(),t.removeClass("status-success"),t.addClass("status-error"),t.html(i)},showSuccess:function(e,t){var i='<i class="bz-icon bz-icon-test"></i>&nbsp;'+e;t.empty(),t.show(),t.removeClass("status-error"),t.addClass("status-success"),t.html(i),window.setTimeout(function(){t.fadeOut(600)},5e3)},_resetSchemaChanges:function(e){if(e){this.holidaysObj.schema[e].modified=!1,this.holidaysObj.holidays[e]={}}},renderHolidaysSchema:function(e){e=e||[];var t=this,i=t.getTemplate("admin.holidays.calendar.schema"),a=(t.getContent(),t._getSchemas(e)),n=$.tmpl(i,{schemas:a});t.holidaysObj.calendarSelector=$("#biz-wp-admin-holidays-calendar",n),$("#biz-wp-admin-holidays-schemas").append(n),t.holidaysSchemaHandlers(),t.renderHolidaysCalendar(),$("[name='save']",n).on("click",function(){t._calendarHasChanges()?t.saveSchema(t.holidaysObj.activeCalendar,!1):t.holidaysObj.activeCalendar?(toastr.remove(),bizagi.injector.get("notifier").showWarningMessage(bizagi.localization.getResource("workportal-admin-holidays-no-changes"))):console.log("There is no selected calendar")}),$("[name='cancel']",n).on("click",function(){t.params.dialogBox.dialog("close")}),$("button",n).button()},_changeSchema:function(e){var t=this;t.holidaysObj.activeCalendar=e,""==e?t.renderHolidaysCalendar():(t.holidaysObj.calendarSelector.startLoading(),$.when(t.dataService.getHolidaysBySchema({schema:e})).done(function(i){t.holidaysObj.holidaysInServer[e]=JSON.parse(JSON.encode(i)),t.holidaysObj.holidays[e]=i,t.renderHolidaysCalendar({dates:t.holidaysObj.holidays[e]||[]})}).always(function(){t.holidaysObj.calendarSelector.endLoading()}))},holidaysSchemaHandlers:function(){var e=this;$("#biz-wp-admin-holidays-schemas select").change(function(t){e.holidays=[];var i=t.currentTarget.value;e._calendarHasChanges()?$.when(bizagi.showSaveBox(e.getResource("confirmation-savebox-message1"),e.getResource("confirmation-box-title"),"warning")).done(function(){$.when(e.saveSchema(e.holidaysObj.activeCalendar,!0)).done(function(t){e._changeSchema(i)})}).fail(function(t){e._resetSchemaChanges(e.holidaysObj.activeCalendar),e._changeSchema(i)}):e._changeSchema(i)})},renderHolidaysCalendar:function(e){e=e||{};var t=this,i=t.getContent(),a=e.dates||[],n=($("#biz-wp-admin-holidays-calendar",i),(new Date).getFullYear()),s=e.datePickerOptions||{},r=$.extend({minDate:"-5y",maxDate:"+10y",stepMonths:12,numberOfMonths:[3,4],defaultDate:"1/1/"+n,dateFormat:"mm/dd/yy",onSelect:function(e,t){l(e)},beforeShowDay:function(e){if(t.holidaysObj&&""==t.holidaysObj.activeCalendar)return[!1,"ui-datepicker-notselected"];var i=new Date,a=o(e),n=!(i.getTime()>new Date(e).getTime());return a.position>-1?[n,"ui-datepicker-selected",a.description]:[n,"ui-datepicker-notselected",bizagi.localization.getResource("workportal-general-no-selected")]}},s),o=function(e){for(var t="yy/mm/dd",i=0,n=a.length;i<n;i++){var s=a[i].date.split("T")[0].replace(/-/g,"/");if($.datepicker.formatDate(t,new Date(e))==$.datepicker.formatDate(t,new Date(s)))return{position:i,description:a[i].description}}return{position:-1,description:""}},l=function(e){var i,n,s=o(e);s.position>-1?(n=s.position,a.splice(n,1)):((i={date:e,description:""}).date=new Date(i.date),i.date.setHours(0),i.date.setMinutes(0),i.date.setSeconds(0),i.date=bizagi.util.dateFormatter.formatISO8601(i.date,!0),a.push(i)),t.holidaysObj.schema[t.holidaysObj.activeCalendar].modified=!0};t.holidaysObj.calendarSelector.data("datepicker")&&t.holidaysObj.calendarSelector.datepicker("destroy"),t.holidaysObj.calendarSelector.datepicker(r)},_showNotification:function(e,t,i){var a=new NotificationMessage(e,{body:t,iconType:_NOTIFICATION_ICON_TYPE.CSS});a.onClick=function(e){return e.preventDefault(),this.close(),!1},this.publish("notification",{notification:a,type:i})},_formatDateFromInvariantToISO8601:function(e){var t=bizagi.util.dateFormatter.getDateFromInvariant(e,!1);return bizagi.util.dateFormatter.formatISO8601(t,!0)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.projectName",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PROJECTNAME},init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.projectname":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.projectname").concat("#ui-bizagi-workportal-widget-admin-projectname"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("admin.projectname"),t=this.content=$.tmpl(e);return $("button",t).button(),t},showError:function(e,t){var i='<i class="bz-icon bz-icon-error"></i>&nbsp; Error:'+e;t.empty(),t.show(),t.removeClass("status-success"),t.addClass("status-error"),t.html(i)},showSuccess:function(e,t){var i='<i class="bz-icon bz-icon-test"></i>&nbsp;'+e;t.empty(),t.show(),t.removeClass("status-error"),t.addClass("status-success"),t.html(i)},postRender:function(){var e=this,t=e.getContent(),i=$(".projectname-message-status",t);$("input",t).on("keypress",function(){i.hide(),$(this).val().length>=0&&$("input",t).removeClass("status-error")}),$.when(e.dataService.getProjectName()).done(function(e){$("input",t).val(e.projectName)}).fail(function(e){console.log("ERROR",e)}),$("[name='cancel']",t).on("click",function(){e.params.dialogBox.dialog("close")}),$("[name='save']",t).on("click",function(){var a=$("input",t).val();if($(t).startLoading({overlay:!0}),0==a.length)return $("input",t).addClass("status-error"),void $(t).endLoading();$.when(e.dataService.setProjectName(a)).done(function(a){$(t).endLoading(),e.showSuccess(bizagi.localization.getResource("workportal-widget-admin-projectname-success"),i)}).fail(function(a){a.responseText=a.responseText||{message:bizagi.localization.getResource("workportal-general-error")};var n=JSON.parse(a.responseText);console.log("Error:",a),$(t).endLoading(),e.showError(n.message,i)})})}}),function(e){e.fn.bizagiSearchUser=function(t){var i=this,a={},n=[],s=1,r=0,o={},l=(t=t||{}).editingUser,d={init:function(){d.bindElements()},bindElements:function(){i.click(function(){d.openUploadDialog()})},openUploadDialog:function(){window.document;var i=this.dialogBox=e("<div class='ui-bizagi-component-search-user'/>");o=i.dialog({width:950,maximize:!1,resize:!1,draggable:!1,height:650,title:t.title,modal:!0}),d.showFilters(),d.showButtons(),d.addHandlers()},showFilters:function(){var i=e("<div id='filtersContainer' class='filters-container clearfix'></div>");e.each(t.filters,function(a,n){e(i,o).append("<div class='filters-row clearfix'><div class='filters-cell'><span>"+t.displayNames[a]+"</span></div><div class='filters-cell'><input id="+n+" type='text'> </input></div></div>")}),i.appendTo(o)},showButtons:function(){var i=e("<div id='buttonsContainer'class='biz-wp-buttonset'></div>");if(e(i,o).append("<button id='btnSearchUsers' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+t.searchButtonName+"</span></button>"),e(i,o).append("<button id='btnClear' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+t.clearButtonName+"</span></button>"),t.allowAddUser){var a="<button id='btnNew' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+bizagi.localization.getResource("workportal-widget-admin-user-profiles-button-label-newUserProfiles")+"</span></button>";e(i,o).append(a),i.appendTo(o),e("#btnNew",o).bizagiCreateUser(t.dataService,t.renderFactory,{canvas:e(o),onCreate:t.selectItem(),onCancel:function(){e(o).dialog("option","title",t.title),e(o).empty(),d.showFilters(),d.showButtons(),d.addHandlers()}})}else i.appendTo(o)},addHandlers:function(){return e("#btnSearchUsers",o).click(function(){d.getUsersTableData()}),e("#btnClear",o).click(function(){d.clickClearPluginValues()}),this},clickClearPluginValues:function(){e.each(t.filters,function(t,i){e("#"+i,o).val("")}),e("#searchResults",o).remove()},getUsersTableData:function(){d.updateFiltersInformation();var i=t.searchUsers(a);e.when(i).done(function(e){Array.isArray(e.users)?(n=e.users,r=e.total,d.showUsersTable()):bizagi.showMessageBox(e.message,e.status,"","warning")}).fail(function(e){t.showError(e)})},updateFiltersInformation:function(){e.each(t.filters,function(t,i){a[i]=e("#"+i,o).val()}),a.pag=s,a.pagSize=9,void 0!==l&&""!==l&&(a.editingUser=l)},showUsersTable:function(){if(n.length>0){var i=r>1,a=d.getPagesArray();e("#searchResults",o).remove();var l=t.getTableTemplate(n,s,i,a);e(o).append(l),d.addTableHandlers(),d.setUpPagination()}else t.showMessageBox("workportal-widget-usertable-empty"),e("#searchResults",o).remove()},addTableHandlers:function(){e("table :button",o).click(function(){var i=e(this),a={};e.each(t.valuesToSelect,function(e,t){a[t]=i.data(t)}),t.selectItem().resolve(a),o.remove()})},getPagesArray:function(){for(var e=10>r?r:10,t=[],i=0;i<e;i++)t.push(i+1);return t},setUpPagination:function(){var t=this,i=e("#biz-wp-userstable-pager ul",o);i.bizagiPagination({maxElemShow:9,totalPages:r,actualPage:s,listElement:i,clickCallBack:function(e){a.pag=s=parseInt(e.page),t.getUsersTableData()}})}};return d.init(),d}}(jQuery),function(e){e.fn.bizagiCreateUser=function(t,i,a){var n=this,s=(a=a||{}).canvas;onCreate=a.onCreate||function(){},onCancel=a.onCancel||function(){},displayName=bizagi.localization.getResource("workportal-widget-admin-user-profiles-button-label-newUserProfiles");var r={init:function(){r.addHandlers()},addHandlers:function(){n.on("click",function(){r.newUser()})},newUser:function(){var i=this;s.empty(),e.tmpl("<div {{loading}}></div>").appendTo(s),t.getUsersForm({h_action:"LOADUSERADMINFORM",h_contexttype:"entity",h_optionform:"add"}).done(function(e){var t=new bizagi.rendering.facade,n={canvas:s,data:e,type:"usersForm",userId:0,action:"add"};s.dialog("option","title",displayName),t.execute(n).done(function(e){t.form.bind("endUsersForm",function(t,n){void 0===n.error&&("save"===n.formAction?(n.sendMail&&i.sendEmail(n.userId,n.password),a.onCreate.resolve({iduser:n.userId,user:n.fullName}),s.remove()):"cancel"===n.formAction&&a.onCancel(),e.endLoading())})})})},sendEmail:function(e,i){var a=this;t.generateDataToSendByEmail({idUser:e,password:i}).done(function(e){a.showEmailPopup(e,i)})},showEmailPopup:function(a,n){var s=this,r=window.document,o=i.getTemplate("render-user-email"),l=s.dialogBoxEmail=e("<div class= admin-users-email/>"),d={};l.empty(),l.appendTo("body",r),d[bizagi.localization.getResource("workportal-widget-admin-users-button-label-send")]=function(){if(""!=e("#txtTextTo",l).val()){var i={eMailTo:e("#txtTextTo",l).val(),subject:e("#txtSubject",l).val(),body:e("#txtBody",l).val(),userSecret:n};e.when(t.sendUserEmail(i)).done(function(e){s.closeUploadDialogEmail(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-Send-message"),"Bizagi","warning")})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-empty-email-to"),"Bizagi","warning")},d[bizagi.localization.getResource("workportal-widget-admin-users-button-label-notSend")]=function(){s.closeUploadDialogEmail()},l.dialog({width:500,height:400,title:bizagi.localization.getResource("workportal-widget-admin-users-subtitle-email"),modal:!0,maximize:!1,resizable:!1,draggable:!1,buttons:d,close:function(){s.closeUploadDialogEmail()},resizeStop:function(e,t){s.form&&s.form.resize(t.size)}}),a.body=a.body.replace(/\\n/g,"\n").replace(/\\/g,""),e.tmpl(o,{messageResponse:a}).appendTo(l)},closeUploadDialogEmail:function(){this.dialogBoxEmail.dialog("destroy"),this.dialogBoxEmail.remove()}};return r.init(),r}}(jQuery),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.polices",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"widgets-admin-business-polices":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.polices").concat("#business-polices-wrapper")})},renderContent:function(){var e=this.getTemplate("widgets-admin-business-polices");return this.content=e.render({build:bizagi.loader.build}),console.log("renderizar",this.content),this.content},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.admin.business.polices",["workportalFacade","dataService",bizagi.workportal.widgets.admin.business.polices]),function(e){e.fn.simpleGrid=function(t,i){if(void 0===t)throw"Debe pasar como parametro el widget de bizagi, para la carga del template";var a=this,n=e.extend({allowAdd:!1,allowEdit:!1,allowDelete:!1,displayName:"",dateFormat:bizagi.localization.getResource("dateFormat"),filters:[],maxPageToShow:5,orderType:"ASC",orderField:"",orderEnabled:!0,page:1,pageSize:10,onDataBinding:function(){},onFilterChanged:function(){},onPageChanging:function(){},onLoadFilter:function(){},onAdd:function(){},onEdit:function(){},getResource:function(){}},i);a.grid={internalData:{}};var s={render:r};function r(){a.empty(),e.when(a.initialized).done(function(){var i,s=[{pag:n.page,pagSize:n.pageSize,orderType:n.orderType,orderField:n.orderField,filters:(i=n.filters,Object.keys(i).map(function(e){return i[e]}).filter(function(e){if("is-null"===e.key||"is-null"!==e.key&&void 0!==e.value&&null!==e.value)return!0}))}],c=a.data("numRequest");a.data("numRequest",c?c+=1:1),void 0!==a.prev&&void 0!==n&&(e("option:selected",a.prev()).data("orderField",n.orderField),e("option:selected",a.prev()).data("orderType",n.orderType),e("option:selected",a.prev()).data("filters",n.filters)),c=a.data("numRequest"),e.when(n.onDataBinding.apply(a.get(0),s)).done(e.proxy(function(i){c===a.data("numRequest")&&(a.append(e.tmpl(a.panelWrapper)),a.grid.totalRecords=i.records,a.grid.totalPages=i.total,function(i){var s=i.row||[];s=s.map(function(e){return(e=e||[]).map(function(e){if("object"==typeof e&&null!==e){var t=e.label;return e.additionallabel&&(t+=", "+e.additionallabel),t}return e})});var c=e(".ui-bizagi-simple-grid-wrapper",a).html(e.tmpl(a.panelContent,{displayName:n.displayName,headers:i.header,rows:s,orderType:n.orderType,orderField:n.orderField,orderEnabled:n.orderEnabled,guidForms:i.entity,allowAdd:n.allowAdd,allowEdit:n.allowEdit,allowDelete:n.allowDelete,filterApplied:n.filters,attributeSupportFilter:o,attributeSupportOrder:l}));(function(t){var i=e("a[data-type='1']",t),s=e("a[data-type='2'][data-attributeType='2']",t),o=e("a[data-type='3']",t),l=e("a[data-type='4']",t),c=e("a[data-type='5']",t),p=e("a[data-type='6']",t),g=e("a[data-type='7']",t),u=e("a[data-type='8']",t),m=e("a[data-type='10']",t),h=e("a[data-type='11']",t),w=e("a[data-type='12']",t),b=e("a[data-type='29']",t),f=void 0!==bizagi.currentUser.symbol?bizagi.currentUser:n.getResource("numericFormat"),v=bizagi.clone(f);v.decimalDigits=0,e.each(w,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index"));e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")").find("span:contains(':')").addClass("formatDate")}}),bizagi.util.formatInvariantDate(t,n.dateFormat),e.each(u,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")"),r=!a.getAttribute("data-allowdecimals")||bizagi.util.parseBoolean(a.getAttribute("data-allowdecimals"));a.setAttribute("data-allowdecimals",r),s.find("span").addClass("formatMoney");var o=d(a,v),l=bizagi.util.parseBoolean(a.getAttribute("data-showsymbol"));o.symbol=null===l||l?"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:v.symbol:"",bizagi.util.formatInvariantMoney(s,o)}}),e.each(m,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")"),r=!a.getAttribute("data-allowdecimals")||bizagi.util.parseBoolean(a.getAttribute("data-allowdecimals"));a.setAttribute("data-allowdecimals",r),s.find("span").addClass("formatMoney");var o=d(a,v);o.allowDecimals&&0===o.decimalDigits&&(o.decimalDigits="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2),bizagi.util.formatInvariantNumber(s,o)}}),e.each(p,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(s,d(a,v))}}),e.each(h,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney");var r=d(a,v);r.allowDecimals&&0===r.decimalDigits&&(r.decimalDigits="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2),bizagi.util.formatInvariantNumber(s,r)}}),e.each(i,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(s,d(a,v))}}),e.each(s,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(s,d(a,v))}}),e.each(o,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(s,d(a,v))}}),e.each(l,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(s,d(a,v))}}),e.each(g,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")");s.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(s,d(a,v))}}),e.each(c,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")").find("span");n>0&&e.each(s,function(t,i){var a=e.trim(e(i).text()).toLowerCase();"true"!==a&&"1"!==a||e(i).text("X"),"false"!==a&&"0"!==a||e(i).text("")})}}),e.each(b,function(i,a){if("none"!=e(a).parent().css("display")){var n=Number(a.getAttribute("data-index")),s=e(".ui-bizagi-grid-table tr",t).find("td:eq("+n+")").find("span");e.each(s,function(t,i){var a=e.trim(e(i).text());e(i).text(bizagi.util.scientificNotationFormat(a))})}}),e("a[data-type='-11']").length>0&&(e(".admin-entities-rightframe #detailEntity table.ui-bizagi-grid-table td:nth-child(1)").css("display","none"),e(".admin-entities-rightframe #detailEntity table.ui-bizagi-grid-table th:nth-child(1)").css("display","none"));!function(t){n.orderEnabled&&e(".link-order-entity",t).click(function(){n.orderField=e(this).attr("data-columnOrderField"),n.orderType=e(this).attr("data-orderType"),"dsbl"!==n.orderField&&r()});e(".ui-bizagi-grid-body tr",t).click(function(){"ui-bizagi-state-selected"===e(this).attr("class")?(e(this).removeClass("ui-bizagi-state-selected"),a.elementSelected=null,e("option:selected",a.prev()).removeData("idRowSelected")):(e(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),e(this).addClass("ui-bizagi-state-selected"),e("option:selected",a.prev()).data("idRowSelected",e(this).data("idrowentity")),a.elementSelected=this)}),e("#addRowEntity",t).click(function(e){n.onAdd.apply(this,new Array(e,{context:a.get(0)}))}),e("#editRowEntity",t).click(function(i){null==a.elementSelected?bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row")):(n.onEdit.apply(this,new Array(i,a.elementSelected)),e(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),a.elementSelected=null)}),e("#deleteRowEntity",t).click(function(i){null==a.elementSelected?bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row")):(n.onDelete.apply(this,new Array(i,a.elementSelected)),e(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),a.elementSelected=null)})}(t)})(c),p=c,g=i.header,u=n.filters,m=p.find(".ui-bizagi-grid-header .ui-bizagi-render-icon-filter"),e.each(m,function(i,s){var l,d,c=e(s),p=c.parent(),m=c.data("index"),h=g[m];o(h)&&(d=(l=h).fieldValue,c.bizagi_filters({guidAttribute:l.guidAttribute,type:l.dataType,attributeType:l.attributeType,parent:p,templates:{filterWrapper:t.getTemplate("filter-wrapper"),filterString:t.getTemplate("filter-string"),filterNumber:t.getTemplate("filter-number"),filterDate:t.getTemplate("filter-date"),filterBoolean:t.getTemplate("filter-boolean")},data:u[d],attribute:l.guidAttribute,entity:l.relatedEntity,dataService:{getAdminEntityData:function(t){return e.when(a.grid.internalData[d]||n.onLoadFilter.apply(n,new Array(e.extend(t,{type:"Entity"})))).then(function(e){return a.grid.internalData[d]=e,e})}}}),c.on("bizagi_filterschange",function(t,i){e.isEmptyObject(i)?delete u[d]:(i.dataType=l.dataType,i.field=d,void 0!==l.relatedEntity&&(i.entity=l.relatedEntity),u[d]=i),n.onFilterChanged.apply(a),r()}),u[d]&&c.addClass("ui-bizagi-column-filter-applied"))});var p,g,u,m;var h=e("option:selected",a.prev()).data("idRowSelected");if(void 0!==h){var w=e("tr[data-idrowentity='"+h+"']",c);w.addClass("ui-bizagi-state-selected"),a.elementSelected=w}}(i),i.records>n.pageSize&&(a.grid.page=i.page,function(){for(var t=n.maxPageToShow>a.grid.totalPages?a.grid.totalPages:n.maxPageToShow,i=e(".bz-rn-grid-footer-pagination",a),s={pagination:a.grid.totalPages>1,page:a.grid.page,pages:{}},o=1;o<=t;o++)s.pages[o]={pageNumber:o};i.append(e.tmpl(a.panelPaginator,s)),e("ul#bz-widget-simple-grid-pager-wrapper",a).bizagiPagination({totalPages:a.grid.totalPages,actualPage:a.grid.page,listElement:e("#biz-wp-table-pager-wrapper"),clickCallBack:function(e){n.onPageChanging.apply(a,new Array(n.page,e.page)),n.page=e.page,r()}})}()))},c))})}function o(e){var t=e.attributeType,i=e.dataType,a=e.xpath||"";return!e.masterEntity&&(!(i<0)&&(!(a.indexOf(".")>-1)&&(1003!=t&&(1002!=t&&(1004!=t&&1005!=t)))))}function l(e){var t=e.attributeType,i=e.dataType,a=e.xpath||"";return!(i<0)&&(!(a.indexOf(".")>-1)&&(1003!=t&&1002!=t))}function d(e,t){var i={decimalDigits:0,decimalSeparator:t.decimalSeparator},a=e.getAttribute("data-allowdecimals")||!1,n=e.getAttribute("data-numdecimals")||0,s=e.getAttribute("data-percentage")||!1,r=e.getAttribute("data-thousands")||!0;return a=bizagi.util.parseBoolean(a),r=bizagi.util.parseBoolean(r),i.allowDecimals=a,i.decimalDigits=n,i.thousands=r,i.groupSeparator=r?t.groupSeparator:"",i.percentage=s,i}return a.initialized=t.loadTemplates({"bizagi.simpleGrid.wrapper":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid"),"bizagi.simpleGrid.content":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid-content"),"bizagi.simpleGrid.paginator":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid-paginator"),"filter-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-wrapper"),"filter-string":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-string"),"filter-number":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-number"),"filter-date":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-date"),"filter-boolean":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-boolean"),useNewEngine:!1}).then(function(){a.panelWrapper=t.getTemplate("bizagi.simpleGrid.wrapper"),a.panelContent=t.getTemplate("bizagi.simpleGrid.content"),a.panelPaginator=t.getTemplate("bizagi.simpleGrid.paginator")}),s}}(jQuery),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.transfer.case.security.permissions",{},{init:function(e,t,i){var a=this;a.selectedUsers=["",""],a.allProcess=!1,a.haveProcess=!1,a._super(e,t,i),a.loadTemplates({"admin-case-security-improvement":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement"),"admin-case-security-improvement-fields":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement-fields"),"security-improvement-loader":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement-loader"),"security-improvement-emptyTree":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement-emptyTree"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_TRANSFER_CASE_SECURITY_PERMISSIONS},loadtemplates:function(){var e=this;e.fieldsContent=e.getTemplate("admin-case-security-improvement-fields"),e.loaderTmpl=e.getTemplate("security-improvement-loader"),e.emptyTreeTmpl=e.getTemplate("security-improvement-emptyTree")},postRender:function(){this.setupData()},setupData:function(){this.setupInitialData()},setupInitialData:function(){var e=this,t=$.tmpl(e.fieldsContent,{});$("#defaults-admin-case-security-home",e.content).append(t),e.setupSearchusersButton(),$(".security-message-danger",e.content).hide(),$("#title-process-revoke",e.content).hide();var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").append(i)},renderContent:function(){var e,t=this;return t.generalContent=t.getTemplate("admin-case-security-improvement"),e=t.content=$.tmpl(t.generalContent,{}),t.params.content&&(e=t.params.content.html(e)),t.loadtemplates(),e},setupProcessTreePermissions:function(e){var t=this,i=t.getContent(),a=$.extend({},t.params);a.canvas=$("#processTreePermissions",i),a.svgIconsMode=!0,a.searchKeyResource=" ",a.byUser=!0,a.userId=e,a.showTitle=!1,a.newDesign=!0,$("#processTreePermissions",i).removeClass("disableColor"),t.processTreePermissions=new bizagi.workportal.widgets.processtree(t.workportalFacade,t.dataService,a),t.processTreePermissions.render()},setupUsersSearchForm:function(e,t){var i=this,a=i.getContent(),n=$.Deferred();$("#defaults-admin-case-security-home").hide(),i.usersTable=new bizagi.workportal.widgets.userstable(i.workportalFacade,i.dataService,$.extend(i.params,{canvas:$("#dinamicContent",a),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:n,showBackButton:!0})),i.usersTable.render(),$.when(n).done(function(n,s){var r={action:"Applications",userId:n};0==t&&$.when(i.dataService.getApplicationCategoriesList(r)).done(function(e){if(i.endLoading(),e.items.length>0){i.allProcess=!0,i.haveProcess=!0;var t=$("div.big-input > input[type='radio']:checked").val(),a=bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-transfer-permissions-of");"revoke"==t&&(a=bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-revoke-permissions-of")),i.setupProcessTreePermissions(n,a)}else i.initializeTree(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes")),i.allProcess=!1,i.haveProcess=!1}).fail(function(){i.endLoading(),i.initializeTree(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes"))}),$("#dinamicContent",a).html(""),$("#defaults-admin-case-security-home",a).show(),s&&($(e,a).val(s),i.showHideClearIcon(e,"block")),n&&(i.selectedUsers[t]=n)})},initializeTree:function(e){var t=$.tmpl(self.emptyTreeTmpl,{emptyTreeText:e});$("#processTreePermissions",self.content).addClass("disableColor").empty(),$("#processTreePermissions",self.content).append(t)},showHideClearIcon:function(e,t){self=this;var i=self.getContent();$(e+" ~ span",i).css("display",t)},transferCaseSecuritypermissions:function(){var e=this;e.loader=$.tmpl(e.loaderTmpl,{});var t={};if(e.haveProcess&&(t=e.paramsToInvalidateSelectedCases()),t.allProcess=e.allProcess,t.idUserSource=""!=e.selectedUsers[0]?e.selectedUsers[0]:-1,t.idUserTarget=""!=e.selectedUsers[1]?e.selectedUsers[1]:-1,-1==t.idUserSource||-1==t.idUserTarget)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-both-users-to-continue"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else if(t.idUserSource==t.idUserTarget)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-users-must-be-different"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else if(e.haveProcess){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-confirmation-message"),bizagi.localization.getResource("workportal-general-word-information"),"warning",[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve"}],{dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400})).done(function(){e.showLoading(),$.when(e.dataService.transferCaseSecuritypermissions(t)).done(function(t){e.endLoading(),"true"===t.status||!0===t.status?e.showNotifier(printf(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-ok"),t.quantityModifiedCases)):(e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"))}).fail(function(t){e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(t)})})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes"),bizagi.localization.getResource("workportal-general-word-information"),"warning")},revokeCaseSecuritypermissions:function(){var e=this;e.loader=$.tmpl(e.loaderTmpl,{});var t={};if(e.haveProcess&&(t=e.paramsToInvalidateSelectedCases()),t.allProcess=e.allProcess,t.idUserSource=""!=e.selectedUsers[0]?e.selectedUsers[0]:-1,-1==t.idUserSource||-1==t.idUserTarget)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-the-current-user-to-continue"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else if(e.haveProcess){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-confirmation-message"),bizagi.localization.getResource("workportal-general-word-information"),"warning",[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve"}],{dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400})).done(function(){e.showLoading(),$.when(e.dataService.revokeCaseSecuritypermissions(t)).done(function(t){e.endLoading(),"true"===t.status||!0===t.status?e.showNotifier(printf(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-revoke-ok"),t.quantityModifiedCases)):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning")}).fail(function(t){e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(t)})}).fail(function(e){console.log("error",e)})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes"),bizagi.localization.getResource("workportal-general-word-information"),"warning")},paramsToInvalidateSelectedCases:function(){var e=this.processTreePermissions.getTreeRouteSelected(),t="",i="";return e.length>0&&(2==e.length?(t=e[1],i=e[0]):(t=e[e.length-1],i=e[0])),this.allProcess=""==i,{idProcess:i,idApplication:t}},showNotifier:function(e){window.parent.bizagi.injector.get("notifier").showSucessMessage(e,"")},showLoading:function(){$("#defaults-admin-case-security-home").append(this.loader)},endLoading:function(){$(this.loader).remove()},clearInput:function(e,t){var i="#txtTextUserSource"==e?0:1;this.showHideClearIcon(e,"none"),$(e,t).val(""),this.selectedUsers[i]=""},setupSearchusersButton:function(){var e=this,t=e.getContent();$("#btn-searchUserSource",t).click(function(){e.showLoading(),e.setupUsersSearchForm("#txtTextUserSource",0)}),$("#btn-searchUserTarget",t).click(function(){e.setupUsersSearchForm("#txtTextUserTarget",1)}),$("#btn-clearUserSource",t).click(function(){e.clearInput("#txtTextUserSource",t);var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").empty(),$("#processTreePermissions",e.content).append(i)}),$("#btn-clearUserTarget",t).click(function(){e.clearInput("#txtTextUserTarget",t)}),$("#btn-copyPermissions",t).click(function(){!1===$("#allAppsLinkSelected",t).data("allAppSelected")&&0===e.processTreePermissions.getTreeRouteSelected().length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-processTree-no-selected-process"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):e.transferCaseSecuritypermissions()}),$("#btn-revokePermissions",t).click(function(){!1===$("#allAppsLinkSelected",t).data("allAppSelected")&&0===e.processTreePermissions.getTreeRouteSelected().length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-processTree-no-selected-process"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):e.revokeCaseSecuritypermissions()}),$("#transferPermissions",t).click(function(){$("input[value='copy']").attr("checked",!0),$(".security-message-information",t).show(),$(".security-message-danger",t).hide(),$("#btn-copyPermissions",t).show(),$("#btn-revokePermissions",t).hide(),$(".user-label:has(#txtTextUserTarget)").show(),$("#title-process-copy",t).show(),$("#title-process-revoke",t).hide(),$("#revokePermissions",t).removeClass("ui-rubik-button-accept").addClass("ui-rubik-button-cancel"),$("#transferPermissions",t).removeClass("ui-rubik-button-cancel").addClass("ui-rubik-button-accept"),e.clearInput("#txtTextUserSource",t),e.clearInput("#txtTextUserTarget",t);var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").empty(),$("#processTreePermissions",e.content).append(i)}),$("#revokePermissions",t).click(function(){$("input[value='revoke']").attr("checked",!0),$(".security-message-information",t).hide(),$(".security-message-danger",t).show(),$("#btn-copyPermissions",t).hide(),$("#btn-revokePermissions",t).show(),$(".user-label:has(#txtTextUserTarget)").hide(),$("#title-process-copy",t).hide(),$("#title-process-revoke",t).show(),$("#transferPermissions",t).removeClass("ui-rubik-button-accept").addClass("ui-rubik-button-cancel"),$("#revokePermissions",t).removeClass("ui-rubik-button-cancel").addClass("ui-rubik-button-accept"),e.clearInput("#txtTextUserSource",t),e.clearInput("#txtTextUserTarget",t);var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").empty(),$("#processTreePermissions",e.content).append(i)})}});
//# sourceMappingURL=../../../../Maps/desktop/admin.desktop.production.js.map
