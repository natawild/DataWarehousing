bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,a){var i=this;i.params=a||{},i._super(e,t,a),i.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this;a.params=$.extend(a.params,t.args),a.params.plan.idActivitySelected=void 0,a.clean();var i=a.getContent().empty();void 0!==e.type&&(a.params.showContextByMenuDashboard=e.type);var o={showFormOverview:a.params.menuDashboard.showFormOverview,showFormActivity:a.params.menuDashboard.showFormActivity,showCommentsOptionMenu:a.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:a.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:a.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:a.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:a.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:a.params.menuDashboard.contextFormActivityOptionMenu,isAdhocProcess:a.params.isAdhocProcess};a.getTemplate("project-dashboard-menu").render(o).appendTo(i),a.params.showContextByMenuDashboard&&$("li[data-context='"+a.params.showContextByMenuDashboard.toUpperCase()+"']",a.content).addClass("active").siblings().removeClass("active"),a.handlerEvents()},loadContentById:function(e){var t=this;e.preventDefault();var a=$(e.target).closest("li");if(!a.hasClass("active")){var i=a.data("context");i&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var e=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),a=parseInt(e[0]),o="",r=a;"PLANACTIVITIES"==i&&(r=a+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),t.params.refreshLastItemBreadcrumb=!1,t.pub("notify",{type:i.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:i,histName:o,level:r})}),$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")})}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),a=$("[data-context='FILES']",e),i=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",function(){t.toggle(),a.toggle(),i.toggle()})},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)})},clean:function(){var e=this,t=e.getContent();e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))}),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this,t=e.getTemplate("project-content-dashboard");return e.content=t.render({}),e.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processMap",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-processmap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-wrapper"),"project-process-diagram":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-process-diagram"),"project-activity-map":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-activity-map"),"project-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-subprocess")})},renderContent:function(){var e=this,t=e.getTemplate("project-processmap"),a=e.viewOptions={processDiagram:null===bizagi.util.parseBoolean(e.params.showProcessDiagram)||bizagi.util.parseBoolean(e.params.showProcessDiagram),activityMap:null===bizagi.util.parseBoolean(e.params.showActivityMap)||bizagi.util.parseBoolean(e.params.showActivityMap),processMap:null===bizagi.util.parseBoolean(e.params.showProcessMap)||bizagi.util.parseBoolean(e.params.showProcessMap)};return e.viewOptions.showTabs=Number(a.processDiagram)+Number(a.activityMap)+Number(a.processMap)>1,e.content=t.render(e.viewOptions),e.content},postRender:function(){var e=this,t=$(".ui-bizagi-wp-project-processmap-content",e.getContent());$(t).is(":empty")&&(e.viewOptions.processDiagram?e.onProcessDiagram():e.viewOptions.activityMap?e.onActivityMap():e.viewOptions.processMap&&e.onSupprocess()),e.configureHandlers(),e.resize()},configureHandlers:function(){var e=this,t=e.getContent(),a=$(".ui-bizagi-wp-project-processmap-process-diagram",t),i=$(".ui-bizagi-wp-project-processmap-activity-map",t),o=$(".ui-bizagi-wp-project-processmap-subprocess",t),r=function(e){$(".selected",t).removeClass("selected"),$(e).addClass("selected")};a.on("click",function(){r(this),e.onProcessDiagram()}),i.on("click",function(){r(this),e.onActivityMap()}),o.on("click",function(){r(this),e.onSupprocess()})},onProcessDiagram:function(){this.navigationManager(this.getTemplate("project-process-diagram")),this.renderProcessDiagram()},onActivityMap:function(){this.navigationManager(this.getTemplate("project-activity-map")),this.renderActivityMap()},onSupprocess:function(){var e=this,t=e.getContent();e.navigationManager(e.getTemplate("project-subprocess"));var a={diagram:"subprocess",$container:$(".ui-bizagi-wp-project-processmap-subprocess-content",t),tooltipClass:"bz-gq-subprocess-tooltip-wrapper",items:".subprocess-tooltip",radNumber:bizagi.context.radNumber};e.renderSubProcessMap(),e.bindTooltip(a),e.appendSubprocessZoom(),e.appendSubprocessDragScroll()},navigationManager:function(e){var t=$(".ui-bizagi-wp-project-processmap-content",this.getContent());$(t).empty(),$(t).append(e.render(this.viewOptions))},renderProcessDiagram:function(){var e,t=this,a=$(".ui-bizagi-wp-project-processmap-content",t.getContent()),i=t.params.idCase||bizagi.context.idCase||0,o=t.params.idWorkflow||bizagi.context.idWorkflow||0;t.params&&t.params.plan&&t.params.plan.idActivitySelected&&(i=t.params.plan.firstParent.idCase,o=t.params.plan.firstParent.idWorkflow||0);var r={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_PROCESS_DIAGRAM_HELPER,data:{idCase:i,idWorkflow:o}},s=r.widgetInstance?r.widgetInstance:t.workportalFacade.getWidget(r.widgetName,r);$.when(s).pipe(function(t){return(e=t).render(r)}).done(function(){var i=e.getContent(),o=$(".ui-bizagi-wp-project-processmap-process-diagram-content",a);$(o).append(i),t.resize()})},resize:function(){$(".ui-bizagi-wp-project-processmap-content",this.getContent()),$(window).height()},renderActivityMap:function(){var e=this,t=e.getContent(),a=bizagi.context.radNumber||null,i=bizagi.context.idCase||null;$.when(e.dataService.getActivityMap({radNumber:a})).done(function(a){if($("#bz-activity-map",t).empty(),void 0===a.activities||0===a.activities.length)$("#bz-activity-map",t).append(bizagi.util.errorMessage(bizagi.localization.getResource("workportal-general-first-line-no-records-found"))),$(".bz-zoom-container",t).hide();else{$("#bz-activity-map",t).activityMap({data:a,width:"100%",height:"100%",currentActivity:i});var o={diagram:"activityMap",$container:$(".ui-bizagi-wp-project-processmap-activity-map-content",t),tooltipClass:"bz-gq-activity-map-tooltip-wrapper",items:".activity-map-tooltip",radNumber:bizagi.context.radNumber};e.bindTooltip(o),$(".bz-zoom-container",t).show(),e.appendActivityMapZoom(),e.resize()}})},renderSubProcessMap:function(){var e=this,t=e.getContent(),a=bizagi.context.radNumber||null,i=$("#bz-subprocess-map",t);$.when(e.dataService.getSubProcessMap({radNumber:a})).done(function(a){if(i.height($(window).height()-250),0==a.length)i.append(bizagi.util.errorMessage(bizagi.localization.getResource("workportal-access-denied")));else{i.processMap({data:a});var o={diagram:"subprocess",$container:$(".ui-bizagi-wp-project-processmap-subprocess-content"),tooltipClass:"bz-gq-subprocess-tooltip-wrapper",items:".subprocess-tooltip",radNumber:bizagi.context.radNumber};e.bindTooltip(o),$(".bz-zoom-container",t).show(),e.appendProcessMapZoom(),e.resize()}})},appendActivityMapZoom:function(){var e=$(".ui-bizagi-wp-project-processmap-content",this.getContent());$(".bz-activity-map-zoom-wrapper",e).zoom({onZoom:function(e){$("#bz-activity-map").trigger("zoom",[e/100])}})},appendProcessMapZoom:function(){var e=$(".ui-bizagi-wp-project-processmap-content",this.getContent());$(".bz-processmap-zoom-wrapper",e).zoom({onZoom:function(e){$("#bz-subprocess-map").trigger("zoom",[e/100])}})},appendSubprocessZoom:function(){$(".ui-bizagi-wp-project-processmap-subprocess-content",this.getContent());var e=$("#bz-subprocess-map",this.getContent());$(".bz-subprocess-zoom-wrapper").zoom({onZoom:function(t){e.processMap("scale",t/100)}})},appendSubprocessDragScroll:function(){var e=$(".ui-bizagi-wp-project-processmap-subprocess-content",this.getContent());$content=$("#bz-subprocess-map",this.getContent()),$content.dragScroll({$scrollable:e})},bindTooltip:function(e){var t,a={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_ACTIVITY_MAP_TOOLTIP,radNumber:e.radNumber},i=a.widgetInstance?a.widgetInstance:this.workportalFacade.getWidget(a.widgetName,a);$.when(i).pipe(function(e){return(t=e).render(a)}).done(function(){t.bindTooltip(e)})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.processMap]),bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.project.processDiagram.helper",{},{getPVHeight:function(){var e=$(window).height()-50,t=this.$header.height()+180;return($(".ui-bizagi-wp-project-tab-content").height()||e)-t}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(e,t,a){var i=this;i._super(e,t,a),i.contextsSidebarActivity=a.contextsSidebarActivity,i.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),i.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")}),i.releaseDialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.releaseDialogBox.formContent=this.getTemplate("project-caseState-popup-release").render({}),this.content},postRender:function(){var e=this;(e.contextsSidebarActivity||[]).forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.plugins={},e.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",e.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",e.releaseDialogBox.formContent)}},e.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(e.onClickAcceptRelease,e)),e.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(e.onClickCancelRelease,e))},updateView:function(e,t){var a=this;$.extend(a.params,t.args);var i=t.args;a.getContent().empty();var o={isFavoriteCase:"off"};if(i.isFavorite&&JSON.parse(i.isFavorite)?o.isFavoriteCase="bz-icon-star":o.isFavoriteCase="bz-icon-star-outline",a.showCaseNumber(i,o),i.creationDate){var r="MM/dd/yyyy H:mm",s=i.creationDate,n=bizagi.util.dateFormatter.getDateFromFormat(s,r);o.creationDateFormat=a.getFormattedDate(n);var c=bizagi.util.dateFormatter.getDateFromFormat(i.solutionDate,r);o.solutionDateFormat=a.getFormattedDate(c);var p=new Date;a.calculateDataForTemplate(o,n,p,c,i)}$(a.getContent()).on("click",".show-diagram-case",function(){!(!a.params.isAdhocProcess||void 0===a.params.isAdhocProcess)?a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow,isAdhoc:!0,idProcess:a.params.idAdhocProcess}):a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow})}),$(a.getContent()).on("click",".show-process-help",function(){a.showHelpUrl(a.params.helpUrl)})},calculateDataForTemplate:function(e,t,a,i,o){var r=this.getContent(),s={};s.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(o.isOpen)?(s.fromDate=t.getTime(),s.toDate=a.getTime()):(s.fromDate=i.getTime(),s.toDate=a.getTime());var n=s.toDate-s.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n),null,!1);bizagi.util.parseBoolean(o.isOpen)?(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),e.colorStateCase="Opened"):(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),e.colorStateCase="Closed"),e.percentCompleteBar=100,e.isOpen=bizagi.util.parseBoolean(o.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(o,e)).appendTo($("#ui-bizagi-remaining",r)),o.currentState.length>0&&this.initilizeActionMenu(o.currentState)},showCaseNumber:function(e,t){var a=this,i=a.getContent(),o=a.getTemplate("project-caseState"),r=!1;r=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,a.params.helpUrl=bizagi.util.validateUrlWellFormed(a.params.helpUrl),o.render($.extend(e,t,{security:bizagi.menuSecurity,isAdhocProcess:r,urlHelp:!bizagi.util.isEmpty(a.params.helpUrl)})).appendTo(i),$(".case-summary-favorite",i).on("click",$.proxy(a.onClickFavorite,a)),$(".case-summary-back",a.content).on("click",$.proxy(a.goToCase,a,"back")),$(".case-summary-next",a.content).on("click",$.proxy(a.goToCase,a,"next")),a.showBackNextNavigation()},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},onClickFavorite:function(e){e.preventDefault();var t=this,a={};$(e.target).hasClass("bz-icon-star-outline")?(a={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(a)).done(function(a){t.params.guidFavorite=a.idFavorites,$(e.target).removeClass("bz-icon-star-outline"),$(e.target).addClass("bz-icon-star")})):(a={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(a)).done(function(){$(e.target).addClass("bz-icon-star-outline"),$(e.target).removeClass("bz-icon-star")}))},showHelpUrl:function(e){window.open(e)},initilizeActionMenu:function(e){var t=this,a=!1,i=!1;if(e&&e.length>0)for(j=0;j<e.length;++j)e[j]&&t.params&&e[j].idWorkItem==t.params.idWorkitem&&(a=bizagi.util.parseBoolean(e[j].allowsReassign)||!1,i=bizagi.util.parseBoolean(e[j].allowReleaseActivity)||!1);var o=$("#bt-case-action-reassing",t.content),r=$("#bt-case-action-release",t.content);a&&o.show();var s=t.params.assignationEveryone||{},n=i&&!(s.enabledReadOnlyForAsigneeToEveryone&&s.isAssignationMethodEveryone);n&&r.show(),(a||n)&&($(".ui-bizagi-wp-project-plan-action-menu",t.content).show(),$(".ui-bizagi-wp-project-plan-action-menu",t.content).menu({select:$.proxy(t.onSelectMenu,t)}).removeClass("ui-widget-content"))},onSelectMenu:function(e,t){if(0===$(e.currentTarget).find("i").length)switch($(t.item).data("item")){case"reassing":this.onClickMenuReasign();break;case"release":this.onClickMenuRelease()}},onClickMenuReasign:function(){var e=this.params.idCase,t=this.params.idWorkitem;$.when(this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:t},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))},onClickMenuRelease:function(){var e=this;e.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var e=this,t={idCase:e.params.idCase,idWorkItem:e.params.idWorkitem};$.when(e.dataService.releaseActivity(t)).done(function(a){var i;switch(a.status?a.status:""){case"Success":e.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":i=e.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:i=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var a=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(a,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}),e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){this.releaseDialogBox.formContent.dialog("destroy"),this.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(e){var t=$.Deferred();return e.fromDate?$.when(this.dataService.getEffectiveDuration(e)).done(function(e){t.resolve(e)}):t.resolve(null),t.promise()},clean:function(){var e=this;$(".show-diagram-case",e.getContent()).off();var t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},goToCase:function(e){var t="back"==e?this.getBackCase():this.getNextCase();t>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var e=0;e<bizagi.lstIdCases.length;e++)if(this.params.idCase==bizagi.lstIdCases[e])return e;return-1},getNextCase:function(){var e=this.getListKey();return bizagi.lstIdCases.length==e+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[e+1]},getBackCase:function(){var e=this.getListKey();return 0==e?-1:bizagi.lstIdCases[e-1]||-1},showBackNextNavigation:function(){var e=this,t=e.getNextCase(),a=e.getBackCase();t<=0?$(".case-summary-next",e.content).hide():$(".case-summary-next",e.content).show(),a<=0?$(".case-summary-back",e.content).hide():$(".case-summary-back",e.content).show(),t<=0&&a<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.params=i,a.getContent();var o={},r=(i.currentState||[]).filter(function(e){return e.idWorkItem==i.idWorkitem})[0];if(r){o.activityName=r.state,o.activityIsEvent=bizagi.util.parseBoolean(r.isEvent);var s="MM/dd/yyyy H:mm",n=bizagi.util.dateFormatter.getDateFromFormat(r.entryDateWorkItem,s);n.getTime&&(o.initDateFormat=a.getFormattedDate(n));var c=new Date,p=bizagi.util.dateFormatter.getDateFromFormat(r.estimatedSolutionDate,s);o.estimatedSolutionDateFormat="",n.getTime&&p.getTime&&r?a.calculateDataForTemplate(r,o,n,c,p):a.updateTemplateWidget(o)}},calculateDataForTemplate:function(e,t,a,i,o){new Date(Date.now()-a.getTime());var r=i.getTime()-o.getTime(),s=a.getTime()-o.getTime(),n=(bizagi.currentUser.idUser,a.getTime()),c=Date.now(),p=!1,d={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:o.getTime()},l={};r>0?(d.fromDate=o.getTime(),d.toDate=i.getTime(),p=!0):(l.idUser=bizagi.currentUser.idUser,l.fromDate=a.getTime(),l.toDate=o.getTime());var u=c-n,g=d.toDate-d.fromDate,m=r>0?0:l.toDate-l.fromDate,b=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-u),null,!1);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",b),t.percentCompleteBar=100,0===s)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===p){var h=this.getPercentBar(m/1e3/60,g/1e3/60);t.percentCompleteBar=h.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent)),t.estimatedSolutionDateFormat=this.getFormattedDate(o),this.updateTemplateWidget(t)},getPercentBar:function(e,t){var a={};return a.percent=Math.round(100*(1-t/e)),a},updateTemplateWidget:function(e){var t=this.getContent().empty();this.getTemplate("project-activityState-wrapper").render(e).appendTo(t)},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},clean:function(){var e=this,t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},callGetEffectiveDuration:function(e){var t=this,a=$.Deferred();return setTimeout(function(){e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){a.resolve(e)}):a.resolve(null)},200),a.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var e=this.getTemplate("project-process-state");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,o=a.getContent().empty();a.params=i;var r={};r.showParentProcess=i.idParentCase>=1,r.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:"0"==i.idTask?"":i.idTask,idWorkflow:i.idWorkflowParentCase},a.getTemplate("project-process-state").render($.extend(i,r)).appendTo(o),$("#go-to-parent-case",o).on("click",$.proxy(a.onClickGoToParentCase,a))},onClickGoToParentCase:function(e){e.preventDefault();this.routingExecute($(e.target).closest("#go-to-parent-case"))},clean:function(){var e=this;e.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(e,t,a,i){var o=this;o.relatedusers=a,o._super(e,t,i),o.contextsSidebarActivity=i.contextsSidebarActivity,o.plugins={},o.users=[],o.loadedUsers=!1,o.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.sub("ON_RENDER_FINISH",$.proxy(e.onRenderFinish,e))},updateView:function(e,t){var a=this;a.params=t,setTimeout(function(){!1===a.loadedUsers&&a.onRenderFinish()},500)},onRenderFinish:function(){var e=this,t=e.params.args,a=e.getContent().empty();e.loadedUsers=!0,e.getTemplate("project-users").render().appendTo(a);var i=[{id:t.createdBy.userId,typeName:"owner"}];t.idCase>0&&e.relatedusers.render(e.content,".relatedusers-wrapper",t.idCase,i)},clean:function(){var e=this;e.loadedUsers=!1,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(e){return e&&(responseSubprocessState=e),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(e){return e?jQuery.isArray(e)&&0===e.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(e):this.auxArrayListSubprocessesState}},{init:function(e,t,a){this._super(e,t,a),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(e){var t=this,a=t.getContent();$(e,a).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var e,a,i,o=$(this).closest("li").find("#idCase").val(),r=t.Class.auxArrayListSubprocesses().filter(function(e){return e.idCase==o});if(r.length>0)return e=r[0].indexSubprocess,a=r[0].idCustData,i=$(this).text(),t.getContentTooltip(e,a,i,t.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(e,t){if(void 0===e.originalEvent)return!1;var a=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+a).remove()},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(e,t,a,i){"-1"==t&&(t="0");var o=function(e,t){return{nameProperty:e,valueProperty:t}},r=[],s="",n=this.getSubprocessData(e,t),c=n.custData,p=n.custDataTypes,d=n.custFields,l=n.displayName;if(r.push(new o(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),l)),c.length)for(var u=0;u<c.length;u+=1)s=c[u],p&&("Money"==p[u]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==p[u]?s=bizagi.util.formatBoolean(s):"Float"==p[u]||"Real"==p[u]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),r.push(new o(d[u],s));var g={};g.arrayCustomsProperties=r,g.nameSubprocess=a;var m=i,b=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(g).appendTo(b),b.html()},getSubprocessData:function(e,t){var a={},i=this.Class.responseSubprocess().subProcesses,o=this.Class.responseSubprocess().subProcPersonalized;if(i&&i.length>0){a.custData=i[e].custData,a.custDataTypes=i[e].custDataTypes;var r=this.Class.responseSubprocess().CustFields[t];a.custFields=r[Object.keys(r)[0]],a.displayName=i[e].displayName}else o&&Object.keys(o).length>0&&(a.custData=o[0].subProcesses[e].custData,a.custDataTypes=o[0].subProcesses[e].custDataTypes,a.custFields=o[0].CustFields[0],a.displayName=o[0].subProcesses[e].displayName);return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var e=this.getTemplate("project-events");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,o=a.getContent().empty();a.params=i,$.when(a.getArgsTemplate(i)).done(function(e){a.getTemplate("project-events").render($.extend(i,e)).appendTo(o),$(".list-events li.event a",o).on("click",$.proxy(a.onClickGoEvent,a)),a.initializeTooltip(".list-events li")})},getArgsTemplate:function(e){var t=$.Deferred(),a={};if(e.countEvents>=1)for(var i=0;i<e.currentState.length;i++)"true"==e.currentState[i].isEvent&&e.currentState[i].idWorkItem==e.idWorkitem&&(e.countEvents=e.countEvents-1);return a.showEvents=e.countEvents>=1,a.showEvents?$.when(this.callSummaryCaseEvents(e.idCase)).done(function(i){e.showEvents=i.events.length>=1,e.showEvents&&(a.events=[],i.events.forEach(function(e){a.events.push($.extend(e[Object.keys(e)[0]],{idWorkFlow:i.idWorkFlow}))})),t.resolve(a)}):t.resolve(a),t.promise()},onClickGoEvent:function(e){e.preventDefault();var t=this;$.when(bizagi.util.autoSave()).done(function(){t.routingExecute($(e.target).closest("li"))})},callSummaryCaseEvents:function(e){var t=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:e})).done(function(e){t.resolve(e)}),t.promise()},clean:function(){var e=this;this.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(e){return this._super(e)},auxArrayListSubprocesses:function(e){return this._super(e)}},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.getContent().empty();a.params=i,a.params.idCase>0&&$.when(a.dataService.summarySubProcess({idCase:a.params.idCase})).done(function(e){a.Class.responseSubprocess(e),a.organizeDataForSubprocesses(a.params)})},organizeDataForSubprocesses:function(e){var t=this;if(t.Class.responseSubprocess().showSubProcess){$.each(t.Class.responseSubprocess().subProcesses,function(e){var a=t.Class.responseSubprocess().subProcesses[e].custData;if(a&&a.length)for(var i=0;i<a.length;i+=1)null===a[i]&&(a[i]="")});var a=t.Class.responseSubprocess().subProcesses||t.Class.responseSubprocess().subProcPersonalized;t.Class.auxArrayListSubprocesses([]);for(var i=0;i<Object.keys(a).length;i+=1){var o=a[i];t.Class.auxArrayListSubprocesses({isOpen:o.isOpen,radNumber:o.radNumber,displayName:o.displayName,idCase:o.idCase,indexSubprocess:i,idCustData:o.idCustData}),o.subProcesses&&Object.keys(o).forEach(function(e){t.Class.auxArrayListSubprocesses({isOpen:o[e].isOpen,radNumber:o[e].radNumber,displayName:o[e].displayName,idCase:o[e].idCase,indexSubprocess:i,idCustData:o[e].idCustData})})}t.renderWidget()}},renderWidget:function(){var e=this,t=e.getContent();e.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:e.Class.auxArrayListSubprocesses()}).appendTo(t),$(".list-subprocesses a",t).on("click",$.proxy(e.onClickGoSubprocess,e)),e.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(e){e.preventDefault();this.routingExecute($(e.target).closest("li"))},clean:function(){var e=this;e.params={},e.pluginTooltip=null,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap",{},{init:function(e,t,a){this.radNumber=a.radNumber,this._super(e,t,a),this.loadTemplates({"project-activityMap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityMap").concat("#project-activityMap-wrapper")})},renderContent:function(){var e=this.getTemplate("project-activityMap");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.sub("HOME",$.proxy(e.updateView,e)),e.sub("OVERVIEW",$.proxy(e.updateView,e)),e.sub("COMMENTS",$.proxy(e.updateView,e)),e.sub("PROCESSMAP",$.proxy(e.updateView,e)),e.sub("LOG",$.proxy(e.updateView,e)),e.sub("PLANCREATE",$.proxy(e.updateView,e)),e.sub("PLANCOMMENTS",$.proxy(e.updateView,e))},updateView:function(e,t){var a=t.args,i=this.getContent().empty(),o={actualState:""};a.currentState[0]&&(o.actualState=a.currentState[0].state),this.getTemplate("project-activityMap").render($.extend(a,o)).appendTo(i),this.params=a}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityMap],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap.tooltip",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-tooltip":bizagi.getTemplate("bizagi.workportal.desktop.widget.activityMap.tooltip").concat("#project-processmap-tooltip")}),this.cache={},this.radNumber=a.radNumber},renderContent:function(){},postRender:function(){this.dateFormat=this.getResource("dateFormat")+" "+this.getResource("timeFormat")},configureHandlers:function(e,t){e.find(".ui-bizagi-wp-project-processmap-process").on("click",$.proxy(this.onProcess,this,t)),e.find(".ui-bizagi-wp-project-processmap-tooltip-title").on("click",$.proxy(this.onIdCase,this,t))},onProcess:function(e,t){this.showGraphicQuery(e)},onIdCase:function(e,t){var a=$(t.currentTarget).data("idcase"),i=$(t.currentTarget).data("idworkitem"),o=$(t.currentTarget).data("idtask"),r=$(t.currentTarget).data("idworkflow");this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:a,idWorkItem:i,idTask:o,idWorkflow:r})},bindTooltip:function(e){var t=this;t.tooltipClass=e.tooltipClass,e.$container.tooltip({items:e.items,content:function(a){if(!(e.$container.data("clicked")||!1)){if("activityMap"==e.diagram){if(!$(this).is("circle"))return;if(this.className.baseVal.indexOf("activity-map-activity-highlight")<0)return;$.when(t.getActivityMapTooltipContent($(this))).done(function(e){a(e)})}else{var i=t.getSubprocessTooltipContent($(this));a(i)}return"loading.."}},open:function(e,t){for(var a=0;a<$(".ui-tooltip").length-1;a++)$("#"+$(".ui-tooltip")[a].id).remove()},show:{duration:60,effect:"none"},tooltipClass:t.tooltipClass,hide:{delay:60,duration:60},position:{my:"left+20 top+20"},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(120,1)},function(){$(this).fadeOut(20,function(){$(this).remove()})})}})},getActivityMapTooltipContent:function(e){var t=this,a=new $.Deferred,i=e.data("guidWorkitem"),o={guidWorkitem:i,gqData:{idCase:e.data("idCase"),idWorkflow:e.data("idWorkflow")}};if(t.guidWorkitem=i,t.isCached(o.guidWorkitem)){var r=t.cache[o.guidWorkitem];a.resolve(t.buildContent(r,o.gqData))}else $.when(t.dataService.getActivitySummary(o)).done(function(e){a.resolve(t.buildContent(e,o.gqData)),t.appendToCache(o.guidWorkitem,e)});return a.promise()},getSubprocessTooltipContent:function(e){var t={gqData:{idCase:e.data("idcase"),idWorkflow:e.data("idworkflow")}},a={endDate:e.data("enddate"),startDate:e.data("startdate"),process:e.data("process"),idCase:e.data("idcase")};return this.buildContent(a,t.gqData)},appendToCache:function(e,t){this.cache[e]=t},isCached:function(e){return void 0!==this.cache[e]},buildContent:function(e,t){var a=this,i=$("<div></div>"),o=a.getTemplate("project-tooltip"),r=void 0!==e.assigneeName;return e.assignee=r,e.radNumber=a.radNumber,e.idWorkflow=t.idWorkflow,e.idTask=e.idTask||0,e.idWorkitem=e.idWorkItem||0,e.graphicQuery=bizagi.menuSecurity.GraphicQuery,i=o.render(e),$("."+a.tooltipClass).html(i),bizagi.util.formatInvariantDate(i,a.dateFormat),a.configureHandlers(i,t),i}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(e,t,a){this._super(e,t,a),a=a||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var e=this,t=e.getTemplate("project-activity-description"),a=e.getWorkitemDescription();return e.content=a?t.render({description:a}):$("<div />"),e.content},postRender:function(){},getWorkitemDescription:function(){for(var e=this.params||{},t=e.idWorkitem||0,a=e.currentState||[],i="",o=0;o<a.length;o++)if(t==a[o].idWorkItem){i=a[o].tskDescription;break}return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/processmap.desktop.production.js.map
