bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,a){var i=this;i.params=a||{},i._super(e,t,a),i.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this;a.params=$.extend(a.params,t.args),a.params.plan.idActivitySelected=void 0,a.clean();var i=a.getContent().empty();void 0!==e.type&&(a.params.showContextByMenuDashboard=e.type);var r={showFormOverview:a.params.menuDashboard.showFormOverview,showFormActivity:a.params.menuDashboard.showFormActivity,showCommentsOptionMenu:a.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:a.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:a.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:a.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:a.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:a.params.menuDashboard.contextFormActivityOptionMenu,isAdhocProcess:a.params.isAdhocProcess};a.getTemplate("project-dashboard-menu").render(r).appendTo(i),a.params.showContextByMenuDashboard&&$("li[data-context='"+a.params.showContextByMenuDashboard.toUpperCase()+"']",a.content).addClass("active").siblings().removeClass("active"),a.handlerEvents()},loadContentById:function(e){var t=this;e.preventDefault();var a=$(e.target).closest("li");if(!a.hasClass("active")){var i=a.data("context");i&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var e=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),a=parseInt(e[0]),r="",o=a;"PLANACTIVITIES"==i&&(o=a+1,r=bizagi.localization.getResource("workportal-project-casedashboard-plan")),t.params.refreshLastItemBreadcrumb=!1,t.pub("notify",{type:i.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:i,histName:r,level:o})}),$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")})}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),a=$("[data-context='FILES']",e),i=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",function(){t.toggle(),a.toggle(),i.toggle()})},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)})},clean:function(){var e=this,t=e.getContent();e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))}),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this,t=e.getTemplate("project-content-dashboard");return e.content=t.render({}),e.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.plan",{},{init:function(e,t,a,i){var r=this;r._super(e,t,i),r.params=$.extend(r.params,i),r.planCreate=a,r.loadTemplates({"project-plan":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.plan").concat("#project-plan-wrapper"),"project-plan-popup":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.plan").concat("#project-plan-popup-template")})},renderContent:function(){var e=this,t=e.getTemplate("project-plan");return e.content=t.render({}),e.content},postRender:function(){var e=this,t=e.getContent();e.form={buttonShowPopupPlanToAdd:$("#buttonShowPopupCreatePlan",t)},e.form.buttonShowPopupPlanToAdd.on("click",$.proxy(e.onShowPopupPlan,e))},onShowPopupPlan:function(){var e=this,t=void 0===e.params.plan.contextualized||e.params.plan.contextualized;e.planCreate.showPopupAddPlan(e.params,e.dataService,t),e.planCreate.unsub("planCreated"),e.planCreate.sub("planCreated",function(t,a){var i=a.paramsNewPlan;e.params.planChild={},-1!=e.params.showContextByMenuDashboard.indexOf("ACTIVITYPLAN")&&(e.params.planParent={},e.params.planParent.id=bizagi.clone(e.params.plan.id),e.params.planParent.idActivitySelected=e.params.plan.idActivitySelected),e.params.planChild=bizagi.clone(i),e.pub("notify",{type:"UPDATE_LASTCRUMBPARAMS_INFO",args:{planChild:e.params.planChild}}),e.params.menuDashboard.contextPlanOptionMenu="PLANACTIVITIES";var r=e.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),o=parseInt(r[0],10)+1,s=bizagi.localization.getResource("workportal-project-casedashboard-plan");e.pub("notify",{type:"PLANACTIVITIES",args:$.extend(e.params,{showContextByMenuDashboard:"PLANACTIVITIES",histName:s,level:o})})})}}),bizagi.injector.register("bizagi.workportal.widgets.project.plan",["workportalFacade","dataService","bizagi.workportal.widgets.project.plan.create",bizagi.workportal.widgets.project.plan],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.overview",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-overview":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview"),"project-overview-no-summary-form-found":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview-no-summary-form-found")})},renderContent:function(){var e=this.getTemplate("project-overview");return this.content=e.render({}),this.content},postRender:function(){var e=this,t=e.getContent(),a=$("#ui-bizagi-wp-project-overview-wrapper",t);a.bind("oldrenderintegration",function(t){if(!t.isPropagationStopped()){t.stopPropagation();var i=e.workportalFacade.getTemplate("inbox-common-case-summary-oldrender"),r={};bizagi.oldrenderevent=!0;var o=window.addEventListener?"addEventListener":"attachEvent";(0,window[o])("attachEvent"==o?"onmessage":"message",function(t){t.stopPropagation(),e.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.data})},!1),$.when(e.dataService.getWorkitems({idCase:e.params.idCase,onlyUserWorkItems:!0})).done(function(t){if("object"==typeof t.workItems&&t.workItems.length>=1){var o=t.workItems[0].idWorkItem,s=t.workItems[0].idTask;r.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&idWorkitem="+o+"&idTask="+s+"&isSummary=1"}else r.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&isSummary=1";a.empty(),$.tmpl(i,r).appendTo(a),e.iframeOldRender($("iframe",a))})}});var i={idCase:e.params.idCase};$.when(e.dataService.getCaseFormsRenderVersion(i)).done(function(i){1==i.formsRenderVersion?a.trigger("oldrenderintegration"):e.renderSummaryForm(e.params.idCase,$("#ui-bizagi-wp-project-overview-wrapper",t))})},renderSummaryForm:function(e,t){var a=this,i=null!=typeof a.dataService.serviceLocator.proxyPrefix?a.dataService.serviceLocator.proxyPrefix:"",r=new bizagi.rendering.facade({proxyPrefix:i});r.execute({canvas:t,summaryForm:!0,idCase:e}),r.subscribe("no-data-found",function(){var e=a.getTemplate("project-overview-no-summary-form-found");t.append(e.render())}),a.renderingFacade=r,setTimeout(function(){a.resizeLayout()},1e3)},iframeOldRender:function(e){this.getContent();var t,a=bizagi.readQueryString();$.each(e,function(){$(this).is("iframe")&&(t=$(this))}),t.load(function(){var e=$(this).contents(),t=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";t=t.replace("%theme%",a.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+t+"'>")})}}),bizagi.injector.register("bizagi.workportal.widgets.project.overview",["workportalFacade","dataService",bizagi.workportal.widgets.project.overview],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(e,t,a){var i=this;i._super(e,t,a),i.contextsSidebarActivity=a.contextsSidebarActivity,i.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),i.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")}),i.releaseDialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.releaseDialogBox.formContent=this.getTemplate("project-caseState-popup-release").render({}),this.content},postRender:function(){var e=this;(e.contextsSidebarActivity||[]).forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.plugins={},e.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",e.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",e.releaseDialogBox.formContent)}},e.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(e.onClickAcceptRelease,e)),e.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(e.onClickCancelRelease,e))},updateView:function(e,t){var a=this;$.extend(a.params,t.args);var i=t.args;a.getContent().empty();var r={isFavoriteCase:"off"};if(i.isFavorite&&JSON.parse(i.isFavorite)?r.isFavoriteCase="bz-icon-star":r.isFavoriteCase="bz-icon-star-outline",a.showCaseNumber(i,r),i.creationDate){var o="MM/dd/yyyy H:mm",s=i.creationDate,n=bizagi.util.dateFormatter.getDateFromFormat(s,o);r.creationDateFormat=a.getFormattedDate(n);var c=bizagi.util.dateFormatter.getDateFromFormat(i.solutionDate,o);r.solutionDateFormat=a.getFormattedDate(c);var p=new Date;a.calculateDataForTemplate(r,n,p,c,i)}$(a.getContent()).on("click",".show-diagram-case",function(){!(!a.params.isAdhocProcess||void 0===a.params.isAdhocProcess)?a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow,isAdhoc:!0,idProcess:a.params.idAdhocProcess}):a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow})}),$(a.getContent()).on("click",".show-process-help",function(){a.showHelpUrl(a.params.helpUrl)})},calculateDataForTemplate:function(e,t,a,i,r){var o=this.getContent(),s={};s.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(r.isOpen)?(s.fromDate=t.getTime(),s.toDate=a.getTime()):(s.fromDate=i.getTime(),s.toDate=a.getTime());var n=s.toDate-s.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n),null,!1);bizagi.util.parseBoolean(r.isOpen)?(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),e.colorStateCase="Opened"):(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),e.colorStateCase="Closed"),e.percentCompleteBar=100,e.isOpen=bizagi.util.parseBoolean(r.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(r,e)).appendTo($("#ui-bizagi-remaining",o)),r.currentState.length>0&&this.initilizeActionMenu(r.currentState)},showCaseNumber:function(e,t){var a=this,i=a.getContent(),r=a.getTemplate("project-caseState"),o=!1;o=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,a.params.helpUrl=bizagi.util.validateUrlWellFormed(a.params.helpUrl),r.render($.extend(e,t,{security:bizagi.menuSecurity,isAdhocProcess:o,urlHelp:!bizagi.util.isEmpty(a.params.helpUrl)})).appendTo(i),$(".case-summary-favorite",i).on("click",$.proxy(a.onClickFavorite,a)),$(".case-summary-back",a.content).on("click",$.proxy(a.goToCase,a,"back")),$(".case-summary-next",a.content).on("click",$.proxy(a.goToCase,a,"next")),a.showBackNextNavigation()},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},onClickFavorite:function(e){e.preventDefault();var t=this,a={};$(e.target).hasClass("bz-icon-star-outline")?(a={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(a)).done(function(a){t.params.guidFavorite=a.idFavorites,$(e.target).removeClass("bz-icon-star-outline"),$(e.target).addClass("bz-icon-star")})):(a={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(a)).done(function(){$(e.target).addClass("bz-icon-star-outline"),$(e.target).removeClass("bz-icon-star")}))},showHelpUrl:function(e){window.open(e)},initilizeActionMenu:function(e){var t=this,a=!1,i=!1;if(e&&e.length>0)for(j=0;j<e.length;++j)e[j]&&t.params&&e[j].idWorkItem==t.params.idWorkitem&&(a=bizagi.util.parseBoolean(e[j].allowsReassign)||!1,i=bizagi.util.parseBoolean(e[j].allowReleaseActivity)||!1);var r=$("#bt-case-action-reassing",t.content),o=$("#bt-case-action-release",t.content);a&&r.show();var s=t.params.assignationEveryone||{},n=i&&!(s.enabledReadOnlyForAsigneeToEveryone&&s.isAssignationMethodEveryone);n&&o.show(),(a||n)&&($(".ui-bizagi-wp-project-plan-action-menu",t.content).show(),$(".ui-bizagi-wp-project-plan-action-menu",t.content).menu({select:$.proxy(t.onSelectMenu,t)}).removeClass("ui-widget-content"))},onSelectMenu:function(e,t){if(0===$(e.currentTarget).find("i").length)switch($(t.item).data("item")){case"reassing":this.onClickMenuReasign();break;case"release":this.onClickMenuRelease()}},onClickMenuReasign:function(){var e=this.params.idCase,t=this.params.idWorkitem;$.when(this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:t},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))},onClickMenuRelease:function(){var e=this;e.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var e=this,t={idCase:e.params.idCase,idWorkItem:e.params.idWorkitem};$.when(e.dataService.releaseActivity(t)).done(function(a){var i;switch(a.status?a.status:""){case"Success":e.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":i=e.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:i=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var a=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(a,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}),e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){this.releaseDialogBox.formContent.dialog("destroy"),this.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(e){var t=$.Deferred();return e.fromDate?$.when(this.dataService.getEffectiveDuration(e)).done(function(e){t.resolve(e)}):t.resolve(null),t.promise()},clean:function(){var e=this;$(".show-diagram-case",e.getContent()).off();var t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},goToCase:function(e){var t="back"==e?this.getBackCase():this.getNextCase();t>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var e=0;e<bizagi.lstIdCases.length;e++)if(this.params.idCase==bizagi.lstIdCases[e])return e;return-1},getNextCase:function(){var e=this.getListKey();return bizagi.lstIdCases.length==e+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[e+1]},getBackCase:function(){var e=this.getListKey();return 0==e?-1:bizagi.lstIdCases[e-1]||-1},showBackNextNavigation:function(){var e=this,t=e.getNextCase(),a=e.getBackCase();t<=0?$(".case-summary-next",e.content).hide():$(".case-summary-next",e.content).show(),a<=0?$(".case-summary-back",e.content).hide():$(".case-summary-back",e.content).show(),t<=0&&a<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.params=i,a.getContent();var r={},o=(i.currentState||[]).filter(function(e){return e.idWorkItem==i.idWorkitem})[0];if(o){r.activityName=o.state,r.activityIsEvent=bizagi.util.parseBoolean(o.isEvent);var s="MM/dd/yyyy H:mm",n=bizagi.util.dateFormatter.getDateFromFormat(o.entryDateWorkItem,s);n.getTime&&(r.initDateFormat=a.getFormattedDate(n));var c=new Date,p=bizagi.util.dateFormatter.getDateFromFormat(o.estimatedSolutionDate,s);r.estimatedSolutionDateFormat="",n.getTime&&p.getTime&&o?a.calculateDataForTemplate(o,r,n,c,p):a.updateTemplateWidget(r)}},calculateDataForTemplate:function(e,t,a,i,r){new Date(Date.now()-a.getTime());var o=i.getTime()-r.getTime(),s=a.getTime()-r.getTime(),n=(bizagi.currentUser.idUser,a.getTime()),c=Date.now(),p=!1,d={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:r.getTime()},l={};o>0?(d.fromDate=r.getTime(),d.toDate=i.getTime(),p=!0):(l.idUser=bizagi.currentUser.idUser,l.fromDate=a.getTime(),l.toDate=r.getTime());var u=c-n,g=d.toDate-d.fromDate,m=o>0?0:l.toDate-l.fromDate,b=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-u),null,!1);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",b),t.percentCompleteBar=100,0===s)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===p){var h=this.getPercentBar(m/1e3/60,g/1e3/60);t.percentCompleteBar=h.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent)),t.estimatedSolutionDateFormat=this.getFormattedDate(r),this.updateTemplateWidget(t)},getPercentBar:function(e,t){var a={};return a.percent=Math.round(100*(1-t/e)),a},updateTemplateWidget:function(e){var t=this.getContent().empty();this.getTemplate("project-activityState-wrapper").render(e).appendTo(t)},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},clean:function(){var e=this,t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},callGetEffectiveDuration:function(e){var t=this,a=$.Deferred();return setTimeout(function(){e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){a.resolve(e)}):a.resolve(null)},200),a.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var e=this.getTemplate("project-process-state");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,r=a.getContent().empty();a.params=i;var o={};o.showParentProcess=i.idParentCase>=1,o.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:"0"==i.idTask?"":i.idTask,idWorkflow:i.idWorkflowParentCase},a.getTemplate("project-process-state").render($.extend(i,o)).appendTo(r),$("#go-to-parent-case",r).on("click",$.proxy(a.onClickGoToParentCase,a))},onClickGoToParentCase:function(e){e.preventDefault();this.routingExecute($(e.target).closest("#go-to-parent-case"))},clean:function(){var e=this;e.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(e,t,a,i){var r=this;r.relatedusers=a,r._super(e,t,i),r.contextsSidebarActivity=i.contextsSidebarActivity,r.plugins={},r.users=[],r.loadedUsers=!1,r.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.sub("ON_RENDER_FINISH",$.proxy(e.onRenderFinish,e))},updateView:function(e,t){var a=this;a.params=t,setTimeout(function(){!1===a.loadedUsers&&a.onRenderFinish()},500)},onRenderFinish:function(){var e=this,t=e.params.args,a=e.getContent().empty();e.loadedUsers=!0,e.getTemplate("project-users").render().appendTo(a);var i=[{id:t.createdBy.userId,typeName:"owner"}];t.idCase>0&&e.relatedusers.render(e.content,".relatedusers-wrapper",t.idCase,i)},clean:function(){var e=this;e.loadedUsers=!1,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(e){return e&&(responseSubprocessState=e),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(e){return e?jQuery.isArray(e)&&0===e.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(e):this.auxArrayListSubprocessesState}},{init:function(e,t,a){this._super(e,t,a),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(e){var t=this,a=t.getContent();$(e,a).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var e,a,i,r=$(this).closest("li").find("#idCase").val(),o=t.Class.auxArrayListSubprocesses().filter(function(e){return e.idCase==r});if(o.length>0)return e=o[0].indexSubprocess,a=o[0].idCustData,i=$(this).text(),t.getContentTooltip(e,a,i,t.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(e,t){if(void 0===e.originalEvent)return!1;var a=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+a).remove()},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(e,t,a,i){"-1"==t&&(t="0");var r=function(e,t){return{nameProperty:e,valueProperty:t}},o=[],s="",n=this.getSubprocessData(e,t),c=n.custData,p=n.custDataTypes,d=n.custFields,l=n.displayName;if(o.push(new r(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),l)),c.length)for(var u=0;u<c.length;u+=1)s=c[u],p&&("Money"==p[u]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==p[u]?s=bizagi.util.formatBoolean(s):"Float"==p[u]||"Real"==p[u]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),o.push(new r(d[u],s));var g={};g.arrayCustomsProperties=o,g.nameSubprocess=a;var m=i,b=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(g).appendTo(b),b.html()},getSubprocessData:function(e,t){var a={},i=this.Class.responseSubprocess().subProcesses,r=this.Class.responseSubprocess().subProcPersonalized;if(i&&i.length>0){a.custData=i[e].custData,a.custDataTypes=i[e].custDataTypes;var o=this.Class.responseSubprocess().CustFields[t];a.custFields=o[Object.keys(o)[0]],a.displayName=i[e].displayName}else r&&Object.keys(r).length>0&&(a.custData=r[0].subProcesses[e].custData,a.custDataTypes=r[0].subProcesses[e].custDataTypes,a.custFields=r[0].CustFields[0],a.displayName=r[0].subProcesses[e].displayName);return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var e=this.getTemplate("project-events");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,r=a.getContent().empty();a.params=i,$.when(a.getArgsTemplate(i)).done(function(e){a.getTemplate("project-events").render($.extend(i,e)).appendTo(r),$(".list-events li.event a",r).on("click",$.proxy(a.onClickGoEvent,a)),a.initializeTooltip(".list-events li")})},getArgsTemplate:function(e){var t=$.Deferred(),a={};if(e.countEvents>=1)for(var i=0;i<e.currentState.length;i++)"true"==e.currentState[i].isEvent&&e.currentState[i].idWorkItem==e.idWorkitem&&(e.countEvents=e.countEvents-1);return a.showEvents=e.countEvents>=1,a.showEvents?$.when(this.callSummaryCaseEvents(e.idCase)).done(function(i){e.showEvents=i.events.length>=1,e.showEvents&&(a.events=[],i.events.forEach(function(e){a.events.push($.extend(e[Object.keys(e)[0]],{idWorkFlow:i.idWorkFlow}))})),t.resolve(a)}):t.resolve(a),t.promise()},onClickGoEvent:function(e){e.preventDefault();var t=this;$.when(bizagi.util.autoSave()).done(function(){t.routingExecute($(e.target).closest("li"))})},callSummaryCaseEvents:function(e){var t=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:e})).done(function(e){t.resolve(e)}),t.promise()},clean:function(){var e=this;this.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(e){return this._super(e)},auxArrayListSubprocesses:function(e){return this._super(e)}},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.getContent().empty();a.params=i,a.params.idCase>0&&$.when(a.dataService.summarySubProcess({idCase:a.params.idCase})).done(function(e){a.Class.responseSubprocess(e),a.organizeDataForSubprocesses(a.params)})},organizeDataForSubprocesses:function(e){var t=this;if(t.Class.responseSubprocess().showSubProcess){$.each(t.Class.responseSubprocess().subProcesses,function(e){var a=t.Class.responseSubprocess().subProcesses[e].custData;if(a&&a.length)for(var i=0;i<a.length;i+=1)null===a[i]&&(a[i]="")});var a=t.Class.responseSubprocess().subProcesses||t.Class.responseSubprocess().subProcPersonalized;t.Class.auxArrayListSubprocesses([]);for(var i=0;i<Object.keys(a).length;i+=1){var r=a[i];t.Class.auxArrayListSubprocesses({isOpen:r.isOpen,radNumber:r.radNumber,displayName:r.displayName,idCase:r.idCase,indexSubprocess:i,idCustData:r.idCustData}),r.subProcesses&&Object.keys(r).forEach(function(e){t.Class.auxArrayListSubprocesses({isOpen:r[e].isOpen,radNumber:r[e].radNumber,displayName:r[e].displayName,idCase:r[e].idCase,indexSubprocess:i,idCustData:r[e].idCustData})})}t.renderWidget()}},renderWidget:function(){var e=this,t=e.getContent();e.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:e.Class.auxArrayListSubprocesses()}).appendTo(t),$(".list-subprocesses a",t).on("click",$.proxy(e.onClickGoSubprocess,e)),e.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(e){e.preventDefault();this.routingExecute($(e.target).closest("li"))},clean:function(){var e=this;e.params={},e.pluginTooltip=null,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(e,t,a){this._super(e,t,a),a=a||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var e=this,t=e.getTemplate("project-activity-description"),a=e.getWorkitemDescription();return e.content=a?t.render({description:a}):$("<div />"),e.content},postRender:function(){},getWorkitemDescription:function(){for(var e=this.params||{},t=e.idWorkitem||0,a=e.currentState||[],i="",r=0;r<a.length;r++)if(t==a[r].idWorkItem){i=a[r].tskDescription;break}return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/plancreate.desktop.production.js.map
