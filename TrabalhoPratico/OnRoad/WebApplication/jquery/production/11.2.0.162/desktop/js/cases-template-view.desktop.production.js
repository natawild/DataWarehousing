bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.casestemplate",{},{init:function(e,t,o,i,a,n,r,s){var c=this;c._super(e,t,s),c.loadTemplates({"casestemplate-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-wrapper"),"casestemplate-item":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-item"),"casestemplate-empty-data":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-empty-message")}),c.selectorCheckboxItems=".casetemplate-box-check-selector input:checkbox",c.actionService=o,c.casetoolbar=i,c.usersCasesService=a,c.actionsEventsService=n,c.hasBatchActions=!1,c.sequenceCall=0,c.accumulatedcontext=r},renderContent:function(){var e=this,t=e.getTemplate("casestemplate-container");return e.content=t.render({}),e.content},postRender:function(){var e=this,t=e.getContent();e.sub("CASES-TEMPLATE-VIEW",$.proxy(e.updateCases,e)),e.sub("UPDATE-DATATEMPLATE-VIEW",$.proxy(e.updateCases,e)),e.sub("GET-COMMON-ACTIONS",$.proxy(e.getCommonActions,e)),e.sub("SET-RECORDS",$.proxy(e.updateCases,e)),e.sub("SET-VALUES",function(t,o){return e.setValues(o)}),e.actionService.subscribe("onFormActionExecuted",$.proxy(e.onFormActionExecuted,e)),e.actionService.subscribe("onFormRuleExecuted",$.proxy(e.onFormRuleExecuted,e)),t.find("#casestemplate-dataviewer-list").on("click",e.selectorCheckboxItems,$.proxy(e.onCaseChecked,e));var o=$("#home-navbar").outerHeight(),i=$("#ui-bizagi-wp-menu").height()-o;$("#content-wrapper").scroll(function(){var e=$(".template-sticky-header-tools"),t=e.height();$("#content-wrapper").scrollTop()>=i?(e.addClass("fixed-header-tools"),$(this).css("padding-top",t+"px")):(e.removeClass("fixed-header-tools"),$(this).css("padding-top",""))})},clean:function(){var e=this,t=e.getContent();e.checkAll=!1,e.sequenceCall=0,$("#content-wrapper").unbind("scroll"),t&&(e.actionService.unsubscribe("onFormActionExecuted"),e.actionService.unsubscribe("onFormRuleExecuted"),e.unsub("CASES-TEMPLATE-VIEW"),e.unsub("UPDATE-DATATEMPLATE-VIEW"),e.unsub("GET-COMMON-ACTIONS"),e.sub("SET-VALUES"),t.find("#casestemplate-dataviewer-list").off("click",e.selectorCheckboxItems))},updateCases:function(e,t){var o,i=this,a=t.args,n=new $.Deferred,r=$("#casestemplate-dataviewer-list",i.getContent());return r.empty(),i.actionService.init(),i.casesSelected={},i.sequenceCall++,i.page=a.page||i.page,i.idworkflow=null==a.idworkflow?i.idworkflow:a.idworkflow,i.route=a.route||i.route,i.filter=a.filter||i.filter,i.pageSize=a.pageSize||i.pageSize,o=i.sequenceCall,$.when(i.getCasesData({page:i.page,idworkflow:i.idworkflow,pageSize:i.pageSize})).pipe(function(e){return i.sequenceCall!==o?(n.resolve(),null):(i.pub("notify",{type:"PAGINATOR-UPDATE",args:$.extend(a,e,{event:t.type})}),i.getCasesTemplates(e))}).done(function(e){if(null!==e){var t=(i.casesLength=e.length)>0?"":i.getEmptyDataMessage(),a=null,s=$();i.hasBatchActions=!1;for(var c=0,l=e.length;c<l;c++){if(i.sequenceCall!==o)return void n.resolve();a=i.renderCase(e[c],!1,o),s.push.apply(s,a)}i.hasBatchActions||i.pub("notify",{type:"HIDE-CHECK-ALL",args:{}}),s.length>0?r.append(s):r.append(t),i.checkAll=!1,i.pub("notify",{type:"ENABLE-BATCHS-ACTIONS",args:{commonActions:i.setValues({args:{value:i.checkAll}})}}),n.resolve(e)}}),n.promise()},renderCase:function(e,t,o){var i=this,a=e.actionData,n=a.idCase,r=a.surrogateKey,s=a.guidEntity,c=i.getTemplate("casestemplate-item"),l=new bizagi.workportal.command.security(i.dataService),d=c.render({idCase:n,guidEntity:s,surrogateKey:r});return d.find("#template").append(e.tmpl),$.when(l.checkSecurityPerm("GraphicQuery")).done(function(t){e.casetoolbarData.graphicQuery=t,setTimeout(function(){var t=i.casetoolbar.getCaseToolbar({casetoolbarData:$.extend(e.casetoolbarData,{referrer:"CasesTemplate"})}),a=i.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-element");o===i.sequenceCall&&a.append(t)},0)}),setTimeout(function(){var a=i.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-footer");a.startLoading({delay:0,overlay:!0}),$.when(i.actionService.getActionsView({actionData:e.actionData,loadEvents:!0,isRefresh:t})).done(function(e){var t=e.actionsView,r=e.actionsData,s=0===r.length?[]:i.pub("notify",{type:"BATCH-ACTIONS",args:{actionsData:r}})[0],c=i.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-element .casetemplate-box-footer");t&&o===i.sequenceCall?(c.append(t),s.length>0&&-1!=i.getCheckBox(c).data("surrogatekey")?(i.hasBatchActions=!0,i.showCheckItem(c),i.pub("notify",{type:"SOME-ITEM-ALLOW-SELECT",args:{}})):i.removeCheckItem(c)):i.removeCheckItem(c),a.endLoading()})},0),setTimeout(function(){$.when(i.usersCasesService.getAssignees(n)).done(function(e){e&&o===i.sequenceCall&&i.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-element .casetemplate-box-footer").append(e)})},0),d},getCheckBox:function(e){return e.closest(".casetemplate-box-element").find(this.selectorCheckboxItems)},removeCheckItem:function(e){this.getCheckBox(e).remove()},showCheckItem:function(e){this.getCheckBox(e).show()},onFormActionExecuted:function(e,t){(t=t||{}).refresh&&this.refreshCase(t.idCase)},onFormRuleExecuted:function(e,t){(t=t||{}).refresh&&this.refreshCase(t.idCase)},refreshCase:function(e){var t=this,o="#casetemplate-box-wrapper-"+e,i=$(o),a=i.find(".casetemplate-box-check-selector > input").is(":checked");i.startLoading({delay:250,overlay:!0}),$.when(t.getCasesData({idCase:e})).then(function(e){return t.getCasesTemplates(e,!0)}).done(function(e){var n=null;null!=e[0]&&null!=e[0]&&(n=t.renderCase(e[0],!0,t.sequenceCall),i.replaceWith(n)),i.endLoading(),a&&(i=$(o)).find(".casetemplate-box-check-selector > input").prop("checked",!0)})},getCasesData:function(e){var t=this;return"following"==t.route?t.dataService.getActivitiesData(e):"pendings"==t.route?t.dataService.getPendingsData(e):"Green"==t.route||"Yellow"==t.route||"Red"==t.route?($.extend(e,{taskState:t.route}),t.dataService.getPendingsData(e)):void 0},getCasesTemplates:function(e,t){var o=this,i=[],a=new $.Deferred;return $.when(o.getTemplateEngine()).then(function(t){return $.when.apply($,$.map(e.entities,function(e){return t.render(e)}))}).done(function(){for(var n=$.makeArray(arguments),r=[],s=e.entities.length,c=0;c<s;c++){var l=1===s?n[c]:n[c][0],d=e.entities[c];i.push({tmpl:l,casetoolbarData:{guidFavorite:e.entities[c].guidFavorite,idcase:e.entities[c].idCase,idWorkflow:e.entities[c].idWorkflow},actionData:{guidEntity:d.guid,idCase:d.idCase,radNumber:d.radNumber,surrogateKey:d.surrogateKey}}),r.push(d.idCase)}t||(o.usersCasesService.render(r),o.actionsEventsService.render(r)),a.resolve(i)}),a.promise()},getTemplateEngine:function(){var e=this;if(e.templateEngine)return e.templateEngine;var t={};t.proxyPrefix=bizagi.RPproxyPrefix;var o=new bizagi.render.services.service(t),i=new bizagi.rendering.desktop.factory(o),a=new $.Deferred;return $.when(i.initAsyncStuff()).done(function(){e.templateEngine=new bizagi.templateEngine({renderFactory:i,cache:!0,forcePersonalizedColumns:!0}),e.templateEngine.subscribe("onLoadDataNavigation",function(t,o){var i=o.data||{},a={reference:i.reference,surrogateKey:i.surrogateKey,referenceType:i.referenceType,fromActionLauncher:!1,histName:i.displayName,guidEntityCurrent:i.guidEntityCurrent,page:1};void 0!==i.xpath&&i.xpath&&(a.xpath=i.xpath),e.accumulatedcontext.clean(),e.pubDeadLockDetection("notify",{type:"TEMPLATEENGINE-VIEW",args:a})}),a.resolve(e.templateEngine)}),a.promise()},getEmptyDataMessage:function(){return this.getTemplate("casestemplate-empty-data").render()[0].outerHTML},onCaseChecked:function(e){var t=$(e.target),o=t.data("surrogatekey"),i=t.data("idcase"),a=t.data("guidentity"),n=t.is(":checked");this.casesSelected[i]={surrogateKey:o,guidEntity:a,idCase:i},n||delete this.casesSelected[i],this.pub("notify",{type:"ENABLE-BATCHS-ACTIONS",args:{commonActions:this.getCommonActions()}})},getCommonActions:function(){var e=this,t={};for(var o in t.actions=e.actionService.getCommonActions(e.casesSelected),t.surrogateKeys=[],t.parentsid=[],e.casesSelected){var i=e.casesSelected[o];-1!==i.surrogateKey&&(t.surrogateKeys.push(i.surrogateKey),t.parentsid.push(i.idCase))}return t.guidEntity=void 0!==o?e.casesSelected[o].guidEntity:"",0==t.surrogateKeys.length?(e.checkAll=!1,t.checkAll=!1):t.surrogateKeys.length==e.casesLength&&(e.checkAll=!0,t.checkAll=!0),t.itemsSelected=e.casesSelected,t},setValues:function(e){var t=this,o=t.getContent(),i=(e.args||{}).value;if(o){t.casesSelected={};var a=o.find(t.selectorCheckboxItems);return $.map(a,function(e){if($(e).prop("checked",i),i){var o=$(e).data("surrogatekey"),a=$(e).data("idcase"),n=$(e).data("guidentity");t.casesSelected[a]={surrogateKey:o,guidEntity:n,idCase:a}}}),t.checkAll=i,t.getCommonActions()}}}),bizagi.injector.register("bizagi.workportal.widgets.casestemplate",["workportalFacade","dataService","actionService","casetoolbar","usersCasesService","actionsEventsService","accumulatedcontext",bizagi.workportal.widgets.casestemplate]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.filtercases",{},{init:function(e,t,o){this._super(e,t,o),this.lastIdworkflow,this.loadTemplates({filtercases:bizagi.getTemplate("bizagi.workportal.desktop.widget.filtercases").concat("#filtercases-wrapper")})},renderContent:function(e,t){var o=this.getTemplate("filtercases");return this.content=o.render({}),this.content},postRender:function(e,t){var o=this,i=o.getContent();$("li.ui-bizagi-wp-app-inbox-tab",i).on("click",$.proxy(o.onClickButtonFilter,o)),o.sub("CASES-TEMPLATE-VIEW",$.proxy(o.updateUI,o))},onClickButtonFilter:function(e){var t=$(e.currentTarget);if(!t.hasClass("active")){var o,i=t.attr("id"),a=this.pub("notify",{type:"GETIDWORKFLOW_FROM_PROCESSESLIST"})[0];if(t.addClass("active").siblings().removeClass("active"),"pendings"===i)o=this.pub("notify",{type:"GETHISTNAME_FROM_PROCESSESLIST"})[0];else{var n="workportal-widget-inboxcommon-filter-"+i.toLowerCase();o=bizagi.localization.getResource(n)}this.lastIdworkflow=a,this.pub("notify",{type:"CASES-TEMPLATE-VIEW",args:{histName:o,page:1,refreshLastItemBreadcrumb:!1,route:i,idworkflow:a||""}})}},updateUI:function(e,t){"following"===t.args.route?$(this.content).hide():$(this.content).show(),t.args.idworkflow!=(this.lastIdworkflow||"")&&$(".ui-bizagi-wp-app-inbox-tab:first-child").addClass("active").siblings().removeClass("active")},clean:function(){this.unsub("CASES-TEMPLATE-VIEW")}}),bizagi.injector.register("bizagi.workportal.widgets.filtercases",["workportalFacade","dataService",bizagi.workportal.widgets.filtercases]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.paginator",{},{init:function(e,t,o){this._super(e,t,o),this.loadTemplates({paginator:bizagi.getTemplate("bizagi.workportal.desktop.widget.paginator").concat("#paginator-wrapper"),content:bizagi.getTemplate("bizagi.workportal.desktop.widget.paginator").concat("#paginator-content")})},renderContent:function(){var e=this,t="ENTITY"===e.params.referenceType,o=e.getTemplate("paginator"+e.getSuffixWidget());return e.content=o.render({hide:t}),e.content},postRender:function(){this.sub("PAGINATOR-UPDATE",$.proxy(this.updateView,this)),this.configureHandlers()},getSuffixWidget:function(){return""},updateView:function(e,t){var o=this,i=t.args,a="ENTITY"===i.referenceType,n=o.getContent();function r(){o.getTemplate("content"+o.getSuffixWidget()).render({totalRecords:o.totalRecords,totalPages:o.totalPages,displayName:o.displayName,currentPage:o.currentPage,hide:a}).appendTo(n)}o.setModel(i),n.empty(),i.fromActionLauncher?o.totalRecords>1?r():o.clean():r()},setModel:function(e){var t=this;t.totalRecords=void 0===e.totalRecords?t.totalRecords:e.totalRecords,t.totalPages=e.totalPages||t.totalPages,t.displayName=e.histName||t.displayName,t.currentPage=e.currentPage||t.currentPage,t.action=e.action,t.reference=e.reference||t.reference,t.surrogateKey=e.surrogateKey||t.surrogateKey,t.referenceType=e.referenceType,t.event=e.event,t.guidSearch=e.guidSearch},getModel:function(){var e=this;return{page:e.currentPage,totalRecords:e.totalRecords,action:e.action,reference:e.reference,surrogateKey:e.surrogateKey,referenceType:e.referenceType,stopNavigation:!0,guidSearch:e.guidSearch}},configureHandlers:function(){this.getContent().on("click",$.proxy(this.onPageBreak,this))},onPageBreak:function(e){var t=this,o=$(e.target),i=t.getContent();if(o.hasClass("control-icon")&&!o.hasClass("ui-state-disabled")){var a=o.data("type");"forward"==a?t.currentPage+=1:"rewind"==a?t.currentPage-=1:t.currentPage="fastrewind"==a?1:t.totalPages,t.disabledPaginatorButtonsByLimits(),i.find(".paginator-controls__currentPage").text(t.currentPage),t.pub("notify",{type:"UPDATE-DATATEMPLATE-VIEW",args:t.getModel()})}},disabledPaginatorButtonsByLimits:function(){var e=this,t=$("[data-type='fastrewind']",e.content),o=$("[data-type='rewind']",e.content),i=$("[data-type='forward']",e.content),a=$("[data-type='fastforward']",e.content);1===e.totalPages?(t.addClass("ui-state-disabled"),o.addClass("ui-state-disabled"),i.addClass("ui-state-disabled"),a.addClass("ui-state-disabled")):1===e.currentPage?(t.addClass("ui-state-disabled"),o.addClass("ui-state-disabled"),i.removeClass("ui-state-disabled"),a.removeClass("ui-state-disabled")):e.currentPage===e.totalPages?(t.removeClass("ui-state-disabled"),o.removeClass("ui-state-disabled"),i.addClass("ui-state-disabled"),a.addClass("ui-state-disabled")):(t.removeClass("ui-state-disabled"),o.removeClass("ui-state-disabled"),i.removeClass("ui-state-disabled"),a.removeClass("ui-state-disabled"))},clean:function(){var e=this.getContent();e&&e.empty()}}),bizagi.injector.register("bizagi.workportal.widgets.paginator",["workportalFacade","dataService",bizagi.workportal.widgets.paginator]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.sortbar",{},{init:function(e,t,o,i,a){this._super(e,t,a),this.loadTemplates({sortbar:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-wrapper"),content:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content"),"right-content":bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-right"),addButton:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content-add-button"),sortMenu:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-sort-menu"),actions:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content-actions"),recordsPerPage:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-records-per-page"),recordsMenu:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-records-menu")}),this.processActionService=o,this.accumulatedcontext=i},renderContent:function(){var e=this,t=e.getTemplate("sortbar");return e.content=t.render({enableFilter:!0}),e.$checkAll=e.content.find(".sortbar-left-check-uncheck input"),e.content},postRender:function(){var e=this.getTemplate("right-content");this.configureHandlers(),$(".sortbar-right",this.content).append(e.render()),this.configureAfterPaintHandlers()},configureHandlers:function(){var e=this,t=e.getContent();e.sub("TEMPLATEENGINE-VIEW",$.proxy(e.initializeAndProcessFilterButton,e)),e.sub("SEARCH-ENGINE-VIEW",$.proxy(e.initializeAndProcessFilterButton,e)),e.sub("SET-FILTERS-DATA",$.proxy(e.setFiltersSortData,e)),e.sub("HIDE-FILTER-BUTTONANDBAR",$.proxy(e.hideFilterButtonAndBar,e)),e.sub("HIDE-SORT-BUTTONS",$.proxy(e.hideSortButtons,e)),e.sub("ENABLE-BATCHS-ACTIONS",function(t,o){return e.enableBatchActions(o)}),e.sub("UPDATE-COUNTER-FILTERS-APPLIED",function(t,o){return e.updateCounterByFilterApplied(o)}),e.sub("CASES-TEMPLATE-VIEW",function(t,o){e.showingFiltering=!1,e.setVisibleCheckAll(!1),e.behaviorVisibleSortbar()}),e.sub("SOME-ITEM-ALLOW-SELECT",function(t,o){e.setVisibleCheckAll(!0),e.behaviorVisibleSortbar()}),e.sub("HIDE-CHECK-ALL",function(t,o){e.setVisibleCheckAll(!1)}),e.sub("BATCH-ACTIONS",function(t,o){return e.validActions(o.args.actionsData)}),t.find(".wgd-sortbar-add-button").tooltip(),e.$checkAll.on("click",$.proxy(e.onCheckUncheck,e))},configureAfterPaintHandlers:function(){var e=this,t=e.getContent();t.find(".right-menu").on("click",function(t){e.showSortMenu(t,$(this))}),t.find(".records-menu").on("click",function(t){e.showRecordsMenu(t,$(this))}),t.find(".sortbar-az").on("click",function(){e.sortSelection.attribute&&(e.setIconSortType($(this),e._sortType),e.pub("notify",{type:"SET-ORDERBY",args:{properties:{xpath:e.sortSelection.attribute,orderType:e._sortType,typeSearch:"none"}}}))}),t.find(".filter-icon").on("click",function(){e.pub("notify",{type:"OPENCLOSE-MYSEARCHFILTER",args:{guidSearch:e.params.guidSearch,target:$(this)}})}),$(".remove-selected-items-collections",t).on("click",$.proxy(e.onRemoveSelectedItemsCollections,e))},behaviorVisibleSortbar:function(){var e=this;e.showingFiltering||e.showingSorting||e.showingCheckAll||e._haveAddButton?e.setVisibleSortbar(!0):e.setVisibleSortbar(!1)},setVisibleSortbar:function(e){var t=this.getContent();e?t.show():t.hide()},setVisibleCheckAll:function(e){e?(this.$checkAll.closest(".border-check-uncheck").show(),this.showingCheckAll=!0):(this.$checkAll.closest(".border-check-uncheck").hide(),this.showingCheckAll=!1)},showSelectedItems:function(e){var t=this;if(e&&e>0){t.content.addClass("there-are-actions");var o=t.getResource("workportal-general-word-selected-singular");e>1&&(o=t.getResource("workportal-general-word-selected-plural")),$(".actions-count-selected",t.content).text(e+" "+o+" ")}else t.content.removeClass("there-are-actions")},setIconSortType:function(e,t){"asc"===t?(this._sortType="desc",e.removeClass("bz-icon-order-ascendant-outline").addClass("bz-icon-order-descendant-outline")):(this._sortType="asc",e.removeClass("bz-icon-order-descendant-outline").addClass("bz-icon-order-ascendant-outline"))},onClickBatchAction:function(e){var t=this,o=$(e.target).closest("li"),i=o.data("guid"),a=t.getAction(i);t.requestsInProgressActionGuid[i]||(t.requestsInProgressActionGuid[i]=!0,t.addLoadingButtonAction(o),$.when(t.processActionService.executeBatchAction({action:a,commonActionsmodel:t.commonActionsmodel})).always(function(){o.find(".wdg-tple-button").removeClass("state-loading"),o.find(".ui-bizagi-loading-button").remove(),o.find("i").show(),t.requestsInProgressActionGuid[i]=void 0}))},addLoadingButtonAction:function(e){e.find(".wdg-tple-button").addClass("state-loading"),e.find(".wdg-tple-button").prepend('<div class="ui-bizagi-loading-icon ui-bizagi-loading-button"></div>').find("i").hide()},onRemoveSelectedItemsCollections:function(){var e=this.pub("notify",{type:"SET-VALUES",args:{value:!1}})[0];this.enableBatchActions({args:{commonActions:e}})},showSortMenu:function(e,t){var o=this,i=o.getContent(),a=o.getTemplate("sortMenu").render({filters:o._filters},{displayValue:function(e){return e}});$(".sortbar-box-menu",t).length&&$(".sortbar-box-menu",t).remove(),t.append(a),a.show("fast",function(){a.click(function(e){e.stopPropagation()}),$(document).one("click",function(){a.hide("fast"),a.remove()})}),i.find(".sortbar-option").on("click",function(e){var n=$(e.currentTarget).data(),r=o._filters[n.index];i.find(".sortbar-az").removeClass("disabled"),o.sortSelection!=r&&(o.sortSelection=r,$(".sortbar-selected",t).text(o.sortSelection.display.split(".").pop()),o.pub("notify",{type:"SET-ORDERBY",args:{properties:{xpath:r.attribute,orderType:o._sortType,typeSearch:"none"}}})),a.hide("fast")})},showRecordsMenu:function(e,t){var o=this,i=o.getContent(),a=o.getTemplate("recordsMenu").render({});$(".sortbar-records-box-menu",t).length&&$(".sortbar-records-box-menu",t).remove(),t.append(a),a.show("fast",function(){a.click(function(e){e.stopPropagation()}),$(document).one("click",function(){a.hide("fast"),a.remove()})}),i.find(".sortbar-records-option").on("click",function(e){var i=Number(bizagi.util.trim(this.textContent));$(".sortbar-records-selected",t).text(i),o.pub("notify",{type:"SET-RECORDS",args:{pageSize:i}}),a.hide("fast")})},initializeAndProcessFilterButton:function(e,t){var o=this;o.showingFiltering=!1,o.setVisibleCheckAll(!1),o.behaviorVisibleSortbar(),o.restoreOrderSelected(),o.setIconSortType($(".sortbar-az",o.content),"desc"),o.params=t.args,o.sortSelection={},o.processAddButton(e,t)},processAddButton:function(e,t){var o=this,i=o.getContent(),a=t.args,n=a.action,r=i.find(".sortbar-left .add-button");o._lastReferenceEntity=a.reference,r.children().remove(),$(".wrapper-sortbar-actions",i).remove(),o._haveAddButton=!1,a.reference&&"ENTITY"!==a.referenceType?(r.startLoading({delay:0,overlay:!0}),o.dataService.getProcessAddAction(t).done(function(e){o._lastReferenceEntity===e.referenceEntity&&void 0!==e&&Object.getOwnPropertyNames(e).length>1&&e.guidEntity&&e.id&&o.renderButton(r,e)}).always(function(){r.endLoading()})):n&&o.renderButton(r,n)},renderButton:function(e,t){var o=this,i=o.getTemplate("addButton").render({action:t});e.empty(),i.appendTo(e),o._haveAddButton=!0,o.behaviorVisibleSortbar(),i.on("click",function(){o.clickAddButton(t)})},clickAddButton:function(e){var t=this;$.when(t.dataService.getMapping({guidEntity:e.guidEntity,accumulatedContext:t.accumulatedcontext.getContext({}),xpathContext:"Process"===e.type?e.xpathContext:""})).done(function(o){"Process"===e.type?t.onExecuteProcess(e,o):t.onExecuteForm(e,o)})},onCheckUncheck:function(e){var t=$(e.target).is(":checked"),o=this.pub("notify",{type:"SET-VALUES",args:{value:t}})[0];this.enableBatchActions({args:{commonActions:o}})},enableBatchActions:function(e){var t=this,o=e.args,i=t.commonActionsmodel=o.commonActions,a=t.validActions(i.actions);(a.length>0||t._haveAddButton)&&$(t.getContent()).show(),t.showBatchActions(a,i,"batchAction"),void 0!==i.checkAll&&t.$checkAll.prop("checked",i.checkAll)},showBatchActions:function(e,t,o){var i=this,a=i.getContent(),n=i.getTemplate("actions");i.showSelectedItems(Object.keys(t.itemsSelected).length);var r=e.slice(3,9999),s=n.render({actions:e.slice(0,3),moreActions:r,typeActions:o});$(".wdg-tple-button.batchAction",i.content).off("click",$.proxy(i.onClickBatchAction,i)),$(".wrapper-sortbar-actions",a).remove(),$(".sortbar-left .sortbar-menu",a).append(s),$(".wdg-tple-button.batchAction",i.content).on("click",$.proxy(i.onClickBatchAction,i)),r.length>0&&(i.content.data("ui-tooltip")&&$(i.content).tooltip("destroy"),$(i.content).tooltip({tooltipClass:"sortbar-tooltip-more-actions",items:".bz-actions-showmore",content:$(".template-box-tooltip",i.content).html(),open:function(e,t){$(".wdg-tple-button.batchAction",t.tooltip).on("click",$.proxy(i.onClickBatchAction,i));var o=$("div.ui-tooltip");if(void 0===e.originalEvent)return o.remove(),!1;var a=$(t.tooltip).attr("id");for(var n in o.not("#"+a).remove(),i.requestsInProgressActionGuid)if(i.requestsInProgressActionGuid[n]){var r=$("li[data-guid='"+n+"']",t.tooltip);i.addLoadingButtonAction(r)}},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(".wdg-tple-button.batchAction",this).off("click",$.proxy(i.onClickBatchAction,i)),$(this).remove()})})}}))},setFiltersSortData:function(e,t){var o=this,i=t.args.filtersAppliedCounter,a=t.args.totalRecords;if(o._filters=t.args.calculateFilters?t.args.filters:o._filters,t.args.calculateFilters){for(var n,r=-1,s=0,c=0;n=o._filters[++r];)"Text"!=n.type&&"Link"!==n.type&&n.data&&(n.data.defaultValues&&n.data.defaultValues.length>0||n.data.min&&n.data.max)&&s++,""!==n.display&&c++;a>0?(s>0?o.showFilterButton():o.hideFilterButton(),c>0?o.showSortButtons():o.hideSortButtons()):0===i&&(o.hideFilterButton(),o.hideSortButtons())}o.updateCounter(i)},showFilterButton:function(){$(".filter-icon",this.getContent()).show()},hideFilterButton:function(){$(".filter-icon",this.getContent()).hide(),this.showingFiltering=!1,this.behaviorVisibleSortbar()},showSortButtons:function(){var e=this;$(".sortbar-text",e.getContent()).show(),$(".sortbar-icon",e.getContent()).show(),$(".sortbar-az",e.getContent()).show(),e.showingSorting=!0,e.showingFiltering=!0,e.behaviorVisibleSortbar()},hideSortButtons:function(){var e=$(".sortbar-az",this.getContent());$(".sortbar-text",this.getContent()).hide(),e.addClass("disabled"),e.removeClass("bz-icon-order-ascendant-outline"),e.removeClass("bz-icon-order-descendant-outline"),e.addClass("bz-icon-order-ascendant-outline"),e.hide(),this.showingSorting=!1,this.behaviorVisibleSortbar()},restoreOrderSelected:function(){$(".sortbar-selected",this.getContent()).text(this.getResource("workportal-my-search-order-by"))},updateCounterByFilterApplied:function(e){e.args.filtersApplied&&this.updateCounter(e.args.filtersApplied.length)},updateCounter:function(e){var t=this.getContent(),o=$(".counter-filters-applied",t);e>0?(o.html(e),o.show()):o.hide()},hideFilterButtonAndBar:function(){this.showingFilter=!1,$(".filter-icon",this.getContent()).hide(),this.pub("notify",{type:"CLOSE-MYSEARCHFILTER",args:{show:!1,$target:null}})},onExecuteProcess:function(e,t){var o=this;e.startForm&&(e.hasStartForm=e.startForm),$.when(o.processActionService.executeProcessAction({action:e,mappingData:t})).done(function(t){(t=t||{})&&!1!==t.refreshTemplateData&&o.loadTemplateData(e)})},loadTemplateData:function(e){this.pub("notify",{type:"TEMPLATEENGINE-VIEW",args:{action:e,isRefresh:!0}})},onExecuteForm:function(e,t){var o=this;$.when(o.processActionService.executeFormAction({action:e,mappingData:t})).done(function(t){t.refresh&&o.pub("notify",{type:"UPDATE-DATATEMPLATE-VIEW",args:{action:e,isRefresh:!0,calculateFilters:!0}})})},getAction:function(e){return this.commonActionsmodel.actions.filter(function(t){return t.id==e})[0]},validActions:function(e){return $.grep(e,function(e){return 2==e.multiplicity||"Collection"!=e.mode&&("Form"!=e.type&&(!e.isEvent&&("Process"!=e.type||!e.hasStartForm)))})},clean:function(){var e=this,t=e.getContent();e.requestsInProgressActionGuid={},t&&(e.unsub("TEMPLATEENGINE-VIEW"),e.unsub("ENABLE-BATCHS-ACTIONS"),e.unsub("SEARCH-ENGINE-VIEW"),e.unsub("SET-FILTERS-DATA"),e.unsub("HIDE-FILTER-BUTTONANDBAR"),e.unsub("HIDE-SORT-BUTTONS"),e.$checkAll.off("click"),t.find(".right-menu").off("click"),t.find(".sortbar-az").off("click"),t.find(".filter-icon").off("click"),t.find(".sortbar-action").off("click"),$(".wdg-tple-button.batchAction",t).off("click",$.proxy(e.onClickBatchAction,e)),$(".remove-selected-items-collections",t).off("click",$.proxy(e.onRemoveSelectedItemsCollections,e)))}}),bizagi.injector.register("bizagi.workportal.widgets.sortbar",["workportalFacade","dataService","processActionService","accumulatedcontext",bizagi.workportal.widgets.sortbar]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.processeslist",{},{init:function(e,t,o){var i=this;i.params=o,i._super(e,t,o),i.idworkflow=o.idworkflow,i.histName=o.histName,i.loadTemplates({processeslist:bizagi.getTemplate("bizagi.workportal.desktop.widget.processeslist").concat("#processeslist-wrapper"),processeslistEmptyData:bizagi.getTemplate("bizagi.workportal.desktop.widget.processeslist").concat("#processeslist-empty-message")})},renderContent:function(){var e=this,t=e.getTemplate("processeslist");return $.when(e.getData()).done(function(o){e.content=o.length>0?t.render({processes:o}):e.getEmptyDataMessage().render({}),e.setSelectedList($(".wdg-process-card:first",e.getContent()))})},postRender:function(){var e=this;e.configureHandlers(),e.sub("GETIDWORKFLOW_FROM_PROCESSESLIST",function(){return e.getIdworkflow()}),e.sub("GETHISTNAME_FROM_PROCESSESLIST",function(){return e.getHistname()})},configureHandlers:function(){var e=this.getContent();$(".wdg-process-card",e).on("click",$.proxy(this.onClickProcess,this))},getData:function(){var e=this,t={},o=e.params.route;switch(o){case"pendings":t={taskState:"all",myPendings:!0};break;case"following":t={taskState:"all",myActivities:!0,onlyFavorites:!0};break;case"Green":case"Red":case"Yellow":t={taskState:o}}return e.dataService.getAllProcesses(t).then(function(t){return e.getInfoToProcessesList(t)})},getInfoToProcessesList:function(e){for(var t=e.categories,o=[],i=[],a=0,n=t.length;a<n;a++)for(var r=0,s=(o=t[a].workflows).length;r<s;r++)i.push({process:o[r].name,idworkflow:o[r].idworkflow});return i},onClickProcess:function(e){var t=this,o=bizagi.clone(t.params),i=$(e.target).closest(".wdg-process-card");t.setSelectedList(i),t.idworkflow=i.data("idworkflow"),t.histName=i.data("title"),t.pubDeadLockDetection("notify",{type:"CASES-TEMPLATE-VIEW",args:$.extend(o,{histName:t.histName,level:3,idworkflow:t.idworkflow})})},getIdworkflow:function(){return this.idworkflow},getHistname:function(){return this.histName},setSelectedList:function(e){$(e).addClass("wdg-plst-selected").siblings().removeClass("wdg-plst-selected")},getEmptyDataMessage:function(){return this.getTemplate("processeslistEmptyData")},clean:function(){var e=this.getContent();e&&$(".wdg-process-card",e).off("click"),this.unsub("GETIDWORKFLOW_FROM_PROCESSESLIST"),this.unsub("GETHISTNAME_FROM_PROCESSESLIST")}}),bizagi.injector.register("bizagi.workportal.widgets.processeslist",["workportalFacade","dataService",bizagi.workportal.widgets.processeslist],!0);
//# sourceMappingURL=../../../../Maps/desktop/cases-template-view.desktop.production.js.map
