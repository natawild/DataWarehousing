bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.activities.sidebar",{},{init:function(e,t,a){this._super(e,t,a),a=a||{},this.loadTemplates({"project-plan-activities-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.project.plan.activities.sidebar").concat("#project-plan-activities-sidebar")})},renderContent:function(){var e=this,t=e.getTemplate("project-plan-activities-sidebar");return e.content=t.render({}),e.content}}),bizagi.injector.register("bizagi.workportal.widgets.project.plan.activities.sidebar",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.activities.sidebar],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.create",{},{init:function(e,t,a,i){var o=this;o.params=i,o.contextualized,o._super(e,t,i),o.notifier=a,o.loadTemplates({"plan-create":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.plan.create").concat("#plan-create")}),o.dialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){this.initPlugins()},initPlugins:function(){var e=this,t=e.getTemplate("plan-create");e.dialogBox.formContent=t.render({}),e.dialogBox.elements={inputName:$("#input-name-plan",e.dialogBox.formContent),inputTemplate:$("#templates-plan",e.dialogBox.formContent),buttonSave:$("#button-accept-create-plan",e.dialogBox.formContent),buttonCancel:$("#button-cancel-create-plan",e.dialogBox.formContent)},e.dialogBox.elements.buttonSave.on("click",$.proxy(e.onClickSavePlan,e)),e.dialogBox.elements.buttonCancel.on("click",$.proxy(e.closeDialogBox,e)),e.notifier=bizagi.injector.get("notifier")},closeDialogBox:function(){var e=this;e.dialogBox.formContent.dialog("destroy"),e.dialogBox.formContent.detach(),e.dialogBox.templateGuid=""},showPopupAddPlan:function(e,t,a){var i=this;i.params=e,i.dataService=t,i.contextualized=a,i.content=$("<div></div>"),i.initPlugins(),i.dialogBox.elements.inputTemplate.html(""),i.dataService.getTemplatesByParentWorkItem({parentWorkItem:e.guidWorkItem}).done(function(e){var t={combo:[],id:"templates"};t.combo=e,i.dialogBox.elements.inputTemplate.uicombo({isEditable:!1,data:t,itemValue:function(e){return e.id},itemText:function(e){return e.name},onChange:function(e){var t=e.ui.data("value");i.dialogBox.elements.inputTemplate.val(t),i.dialogBox.templateGuid=t},css:"display: none"}),i.dialogBox.elements.inputTemplate.keydown(function(){8!=event.keyCode&&46!=event.keyCode||(event.preventDefault(),i.dialogBox.templateGuid="",i.dialogBox.elements.inputTemplate.val(""),$("input",i.dialogBox.elements.inputTemplate).val(""))}),e.length>0?$(".field-template",i.dialogBox.formContent).show():$(".field-template",i.dialogBox.formContent).hide()}).fail(function(){$(".field-template",i.dialogBox.formContent).hide()}),i.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-popup-title-add-plan"),maximize:!1,close:function(){i.dialogBox.formContent.dialog("destroy"),i.dialogBox.formContent.detach()}})},onClickSavePlan:function(e){e.preventDefault();this.validateParams()&&this.createNewPlan()},createNewPlan:function(){var e=this,t=e.params.guidWorkItem||null,a={idUserCreator:bizagi.currentUser.idUser,id:void 0,startDate:null,creationDate:null,parentWorkItem:t,description:null,currentState:"PENDING",name:e.dialogBox.elements.inputName.val(),waitForCompletion:!0,dueDate:null,contextualized:e.contextualized,idTemplate:e.dialogBox.templateGuid};$.when(e.sendDataInsertPlan(a)).then(function(t){(a=$.extend(a,{id:t.id})).activities=[],a.users=[];var i=new bizagi.workportal.services.behaviors.projectDashboard(e.dataService);e.params.menuPlanDashboard={},e.params.menuPlanDashboard.showCommentsOptionMenu=i.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonComments,e.params.menuPlanDashboard.showFilesOptionMenu=i.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonFiles,e.params.menuPlanDashboard.showTimeLineOptionMenu=i.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonTimeLine,a.name=bizagi.util.encodeHtml(a.name),$.when(i.getRadNumberForPlanDashboard(a.id,a.contextualized)).done(function(t){e.pub("planCreated",{paramsNewPlan:a,radNumber:t}),e.closeDialogBox(),e.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-project-plan-created"),""))})})},validateParams:function(){var e=this.dialogBox.elements.inputName;if(e.val()&&""!==e.val())return!0;var t=bizagi.localization.getResource("workportal-project-plan-popup-field-name-required");return e.next().find("span").html(t),!1},sendDataInsertPlan:function(e){var t=$.Deferred();return $.when(this.dataService.postPlan(e)).always(function(e,a,i){201===i.status?t.resolve(e):t.reject()}),t.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.plan.create",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.plan.create]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.edit",{},{init:function(e,t,a,i){var o=this;o.params=i,o.planToEdit,o._super(e,t,i),o.notifier=a,o.loadTemplates({"plans.manager.popup.edit.plan":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.plan.edit").concat("#plans-manager-popup-edit-plan")}),o.editDialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){},closeEditDialogBox:function(){var e=this;e.editDialogBox.elements.inputDueDate.datepicker("destroy"),e.editDialogBox.formContent.dialog("destroy"),e.editDialogBox.formContent.detach()},showPopup:function(e,t,a){var i=this,o=$.Deferred();return i.planToEdit=a,i.initEditDialogBox(a),i.editDialogBox.elements.inputName.val(bizagi.util.decodeHtmlEntities(a.name)),i.editDialogBox.elements.inputDesc.val(bizagi.util.decodeHtmlEntities(a.description)),i.editDialogBox.elements.inputWaitForCompletion.prop("checked",a.waitForCompletion),i.editDialogBox.elements.inputDueDate.datepicker(),i.editDialogBox.elements.inputDueDate.datepicker("option","dateFormat",bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI()),a.dueDate&&i.editDialogBox.elements.inputDueDate.datepicker("setDate",new Date(a.dueDate)),i.editDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-editplan"),maximize:!0,close:function(e,t){i.editDialogBox.elements.inputDueDate.datepicker("destroy"),i.editDialogBox.formContent.dialog("destroy"),i.editDialogBox.formContent.detach(),o.resolve()}}),o.promise()},initEditDialogBox:function(e){var t=this,a=t.getTemplate("plans.manager.popup.edit.plan");t.editDialogBox.formContent=a.render(e),t.editDialogBox.elements={inputName:$("#input-name-plan",t.editDialogBox.formContent),inputDesc:$("#input-desc-plan",t.editDialogBox.formContent),inputDueDate:$("#input-dueDate-plan",t.editDialogBox.formContent),inputWaitForCompletion:$("#input-waitForCompletion",t.editDialogBox.formContent),buttonSave:$("#button-accept-edit-plan",t.editDialogBox.formContent),buttonCancel:$("#button-cancel-edit-plan",t.editDialogBox.formContent)},t.editDialogBox.elements.buttonSave.on("click",$.proxy(t.saveEditedPlan,t)),t.editDialogBox.elements.buttonCancel.on("click",$.proxy(t.closeEditDialogBox,t))},saveEditedPlan:function(e){e.preventDefault();var t=this;t.validateEditDialogBoxParams()&&$.when(t.getParamsUpdatePlan()).done(function(e){$.when(t.dataService.updatePlan(e)).done(function(){t.closeEditDialogBox(),t.pub("planEditedSuccess",{paramsEditPlan:e})}).fail(function(){t.pub("planEditedFailed")})})},getParamsUpdatePlan:function(){var e=this,t=$.Deferred(),a={};(a=e.planToEdit).name=e.editDialogBox.elements.inputName.val(),a.description=e.editDialogBox.elements.inputDesc.val(),0!==e.editDialogBox.elements.inputWaitForCompletion.length&&(a.waitForCompletion=e.editDialogBox.elements.inputWaitForCompletion.prop("checked"));var i=e.editDialogBox.elements.inputDueDate.datepicker("getDate");if(i){var o={idUser:bizagi.currentUser.idUser,date:i.getTime()};$.when(e.dataService.getEndHourWorkingByDate(o)).done(function(e){a.dueDate=e.dateTime,t.resolve(a)})}else t.resolve(a);return t.promise()},validateEditDialogBoxParams:function(){var e=this.editDialogBox.elements.inputName;if(e.val()&&""!==e.val())return!0;var t=bizagi.localization.getResource("workportal-project-plan-popup-field-name-required");return e.next().find("span").html(t),!1}}),bizagi.injector.register("bizagi.workportal.widgets.project.plan.edit",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.plan.edit],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.plan.template.create",{},{init:function(e,t,a){var i=this;i.params=a,i.contextualized,i.idPlanSelected,i._super(e,t,a),i.loadTemplates({"plan-template-create":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.plan.template.create").concat("#plan-template-create")}),i.dialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){this.initPlugins()},initPlugins:function(){var e=this,t=e.getTemplate("plan-template-create");e.dialogBox.formContent=t.render({}),e.dialogBox.elements={inputName:$("#input-name-template",e.dialogBox.formContent),buttonSave:$("#button-accept-create-template",e.dialogBox.formContent),buttonCancel:$("#button-cancel-create-template",e.dialogBox.formContent)},e.dialogBox.elements.buttonSave.on("click",$.proxy(e.onClickSaveTemplate,e)),e.dialogBox.elements.buttonCancel.on("click",$.proxy(e.closeDialogBox,e))},closeDialogBox:function(){this.dialogBox.formContent.dialog("destroy"),this.dialogBox.formContent.detach()},showPopupAddTemplatePlan:function(e,t,a,i){var o=this;o.params=e,o.dataService=t,o.contextualized=a,o.idPlanSelected=i,o.content=$("<div></div>"),o.initPlugins(),o.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:bizagi.localization.getResource("workportal-project-plan-action-popup-save-as-template"),maximize:!1,close:function(e,t){o.dialogBox.formContent.dialog("destroy"),o.dialogBox.formContent.detach()}})},onClickSaveTemplate:function(e){e.preventDefault();var t=this;if(t.validateSaveDialogBoxParams()){var a={idPlan:t.idPlanSelected,name:t.dialogBox.elements.inputName.val()};$.when(t.dataService.createTemplateByPlan(a)).done(function(){t.closeDialogBox(),t.pub("planTemplateCreatedSuccess",{})}).fail(function(){t.pub("planTemplateCreatedFailed",{})})}},validateSaveDialogBoxParams:function(){var e=this.dialogBox.elements.inputName;if(e.val()&&""!==e.val())return!0;var t=bizagi.localization.getResource("workportal-project-plan-popup-field-name-required");return e.next().find("span").html(t),!1}}),bizagi.injector.register("bizagi.workportal.widgets.project.plan.template.create",["workportalFacade","dataService",bizagi.workportal.widgets.project.plan.template.create]),bizagi.workportal.widgets.admin.caseSearch.extend("bizagi.workportal.widgets.reassigncase",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"admin.case.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search"),"admin.case.search.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-fields"),"admin.case.search.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-buttons"),"admin.case.search.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-result"),"admin.case.search.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-pagination"),"admin.case.search.invalidate":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-invalidate"),"admin.case.search.reassign":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign"),"admin.case.search.reassign.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign-form"),"admin.case.search.action.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-action-result"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE},renderContent:function(){var e,t=this.getTemplate("admin.case.search");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){var e=this;e.generalContentTmpl=e.getTemplate("admin.case.search"),e.fieldsContentTmpl=e.getTemplate("admin.case.search.fields"),e.buttonContentTmpl=e.getTemplate("admin.case.search.button"),e.resultContentTmpl=e.getTemplate("admin.case.search.result"),e.paginationTmpl=e.getTemplate("admin.case.search.pagination"),e.invalidateContentTmpl=e.getTemplate("admin.case.search.invalidate"),e.reassignContentTmpl=e.getTemplate("admin.case.search.reassign"),e.reassignFormTmpl=e.getTemplate("admin.case.search.reassign.form"),e.actionResultContentTmpl=e.getTemplate("admin.case.search.action.result")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.processNavigation=[],this.setupData()},setupData:function(){var e=this,t={cases:[]},a=[];e.setupInitialData(),e.setupDatePicker(),e.setupProcessTree(),e.setupMainButtons(),t.cases.push({idCase:e.params.data.idCase,idWorkItem:e.params.data.idWorkItem}),a.push({taskItem:e.params.data.idCase+": "+e.params.data.idtask,idWorkItem:e.params.data.idWorkItem}),e.selectedTasks=t,e.selectedTasksToShow=a,e.showReassignForm(e.content,e.selectedTasksToShow)},setupInitialData:function(){var e,t=this,a=t.getContent();t.buttonBackAction="backToMainForm",t.selectedUserId="",t.selectedUserName="",t.selectedTasks="",t.selectedTasksToShow="",t.searchParams="",t.processTree="",$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle")),$("#mainForm",a).remove(),$("#dinamicContent",a).remove(),$("#case-search-log-data-buttonset",a).remove(),e=$.tmpl(t.reassignFormTmpl,{}),a.append(e)},setupDatePicker:function(){var e=this.getContent();$(".biz-wp-form-datepicker",e).datepicker({controlType:"select",dateFormat:"dd/mm/yy"})},setupProcessTree:function(){var e=this,t=e.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove(),e.processTree=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#processTree",t)})),e.processTree.render()},setupUsersSearchForm:function(){var e=this,t=e.getContent(),a=$.Deferred();$("#biz-wp-users-table-form").html(""),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#biz-wp-users-table-form",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admincasesearch-reassign")],parentDef:a})),e.usersTable.render(),$.when(a).done(function(t,a){e.assignEventReassignLinks(t,a)})},findResults:function(e,t,a){var i=this;t.Page=a||1,$.when(i.dataService.getAdminCasesList(t)).done(function(a){if($(".biz-wp-table").remove(),$(".case-search-action-wrapper").remove(),$("#biz-wp-table-summary-wrapper").remove(),i.totalRecords=a.records,i.totalPages=a.total,a.rows.length>0){i.showCasesSearchResultFrame(e,a),i.setupActionsButton(e);var o,r=i.maxPageToShow>i.totalPages?i.totalPages:i.maxPageToShow,s=$("#biz-wp-table-pager-wrapper"),n={};n.pagination=i.totalPages>1,n.page=a.page,n.pages={};for(var c=1;c<=r;c++)n.pages[c]={pageNumber:c};o=$.tmpl(i.paginationTmpl,n).html(),s.append(o),$("ul").bizagiPagination({maxElemShow:i.maxElemShow,totalPages:i.totalPages,actualPage:a.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(a){i.findResults(e,t,a.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")}).fail(function(e){bizagi.log(e)})},showCasesSearchResultFrame:function(e,t){var a=this,i=a.preprocessResultList(t.headers,t),o=$.tmpl(a.resultContentTmpl,{headers:t.headers,rows:i}),r=$.tmpl(a.invalidateContentTmpl,{}),s=$.tmpl(a.reassignContentTmpl,{});$("#mainForm",e).hide(),$("#dinamicContent",e).html(o),$(".case-search-action-wrapper",e).append(r),$(".case-search-action-wrapper",e).append(s),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title")),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide(),$("#btn-admin-case-back",e).css("display","inline"),a.setupActivitiesLink(e),a.setupGraphicQueryEvent(e)},preprocessResultList:function(e,t){for(var a=[],i=t.rows.length,o=0;o<i;o++)a.push(this.processResultItem(e,t.rows[o]));return a},processResultItem:function(e,t){var a,i,o,r,s=this,n=t.data,c=t.idCase,l=t.idWorkFlow,d=[],p=[],u=[],g=-1,m=0,h=!1;for(p.push({id:"checkCaseAdmin",value:c});g++<e.length-1;)switch(e[g].fieldName){case s.columnsID.caseNumber:p.push({id:"caseNumber",value:{idCase:c,caseNumber:n[m]}}),m++;break;case s.columnsID.process:p.push({id:"idWorkItem",value:n[m]}),m++;break;case s.columnsID.userName:case s.columnsID.task:case s.columnsID.taskDueDate:if(void 0===a){for(var b=n.length;b-- >0;)if(Array.isArray(n[b])){a=n[b],h=!0;break}m++}h?(e[g].fieldName==s.columnsID.taskDueDate&&n.splice(g,1),o=a[0],s.columnsID.userName==e[g].fieldName?(p=p.concat(s.processTaskObjectUser(o)),-1==u.indexOf(s.columnsID.userName)&&u.push(s.columnsID.userName)):s.columnsID.task==e[g].fieldName?(p=p.concat(s.processTaskObject(o,c)),-1==u.indexOf(s.columnsID.task)&&u.push(s.columnsID.task)):s.columnsID.taskDueDate==e[g].fieldName&&(p=p.concat(s.processTaskObjectDate(o)),-1==u.indexOf(s.columnsID.taskDueDate)&&u.push(s.columnsID.taskDueDate))):e[g].fieldName==s.columnsID.taskDueDate&&(p=p.concat({estimatedSolutionDate:n[g]}),-1==u.indexOf(s.columnsID.taskDueDate)&&u.push(s.columnsID.taskDueDate));break;case s.columnsID.processCreationDate:p.push({id:"processCreationDate",value:n[m]}),m++;break;case s.columnsID.processDueDate:p.push({id:"processDueDate",value:n[m]}),m++;break;default:p.push({id:"customField",value:n[m]}),m++}if(p.push({id:"viewProcess",value:{idCase:c,idworkflow:l}}),d.push({attr:"first_row",data:p}),(i=a?a.length:0)>1){r=u.length;for(var w=1;w<i;w++){var v=[];for(b=-1;b++<r-1;)u[b]==s.columnsID.task?v.push(s.processTaskObject(a[w],c)):u[b]==s.columnsID.taskDueDate?v.push(s.processTaskObjectDate(a[w])):u[b]==s.columnsID.userName&&v.push(s.processTaskObjectUser(a[w]));d.push({attr:"next_row",data:v})}}return{data:d,totalTask:i}},processTaskObject:function(e,t){return{taskName:e.taskName,colorState:e.colorState,idCase:t,idWorkItem:e.idWorkItem,idTask:e.idTask}},processTaskObjectDate:function(e){var t={};return e.estimatedSolutionDate?t.estimatedSolutionDate=e.estimatedSolutionDate:t.estimatedSolutionDate="",t},processTaskObjectUser:function(e){var t={};return e.assignee?t.userName=e.assignee:t.userName="",t},invalidateCases:function(e){var t=this,a={cases:[]};$("input:checkbox[name=CaseAdmin]:checked",e).each(function(){var e=$(this).val();a.cases.push({idCase:e})}),0==a.cases.length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-empty-msg"),"Bizagi","warning"):$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-confirm-msg"),"Bizagi","warning")).done(function(){var i=$("#txtReason",e).val(),o={action:"abort",cases:JSON.stringify(a),reason:i};$.when(t.dataService.abortReassignItems(o)).done(function(a){t.showActionResultFrame(e,a.response,"invalidate")}).fail(function(e){bizagi.log(e)})})},showReassignTasksFrame:function(e){var t={cases:[]},a=[];$("input:checkbox[name=workItemAdmin]:checked",e).each(function(){var e=$(this).val();e=e.split("|"),t.cases.push({idCase:e[0],idWorkItem:e[1]}),a.push({taskItem:e[0]+": "+e[2],idWorkItem:e[1]})}),0==a.length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-empty-msg"),"Bizagi","warning"):(this.selectedTasks=t,this.selectedTasksToShow=a,this.showReassignForm(e,a))},showReassignForm:function(e,t){this.buttonBackAction="backToCases";var a=$.tmpl(this.reassignFormTmpl,{tasks:t});$("#dinamicContent",e).hide(),$("#dinamicContent2",e).html(a),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide(),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-title")),this.setupUsersSearchForm()},reassignTasks:function(){var e=this,t=e.getContent(),a={action:"reassignItems",cases:JSON.stringify(e.selectedTasks),idNewUser:e.selectedUserId};$.when(e.dataService.reassignCurrent(a)).done(function(a){e.showActionResultFrame(t,a.response,"reassign")}).fail(function(e){bizagi.log(e)})},showActionResultFrame:function(e,t,a){var i=t.length>1?"-several":"",o="",r="",s=[];if("invalidate"==(i=a+i))for(var n=0;n<t.length;n++)1==t[n].deleted?(o=t[n].idCase,o+=n+1<t.length?", ":"",s[0]=!0):(r=t[n].idCase,r+=n+1<t.length?", ":"",s[1]=!1);else if("invalidate-several"==i)for(n=0;n<t.length;n++)1==t[n].deleted?(o+=t[n].idCase,o+=n+1<t.length?", ":"",s[0]=!0):(r+=t[n].idCase,r+=n+1<t.length?", ":"",s[1]=!1);else if("reassign"==i)for(n=0;n<t.length;n++)1==t[n].reassigned?(o+=t[n].idCase,o+=n+1<t.length?", ":"",s[0]=!0):(r=t[n].idCase,r+=n+1<t.length?", ":"",s[1]=!1);else if("reassign-several"==i){o+="<br/><br/>",r+="<br/><br/>";for(n=0;n<t.length;n++)1==t[n].reassigned?(o+=t[n].idCase+"<br/>",s[0]=!0):(r+=t[n].idCase+"<br/>",s[1]=!1);o+="<br/>",r+="<br/>"}var c=$.tmpl(this.actionResultContentTmpl,{action:i,resultStatus:s});c=(c=(c=(c=c[0].innerHTML.replace("{0}","<strong>"+o+"</strong>")).replace("{3}","<strong>"+r+"</strong>")).replace("{1}",this.selectedUserName)).replace("{1}",this.selectedUserName),"invalidate"==a&&$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-result-title")),$("#mainForm",e).html(""),$("#dinamicContent",e).css("display","inline"),$("#dinamicContent",e).html(c),$("#dinamicContent2",e).remove(),$("#usersTable",e).remove(),$("#btn-admin-case-back",e).css("display","none"),$("#btn-admin-case-search-clear",e).css("display","none"),$("#btn-admin-case-search",e).css("display","none"),$("#btn-admin-case-finish",e).css("display","inline"),$("#biz-wp-userstable-wrapperform").hide(),$("#biz-wp-userstable-wrapperlist").hide(),this.usersTable.resultStatus=-1==s.indexOf(!1)},setupMainButtons:function(){var e=this,t=e.getContent(),a=$.tmpl(e.buttonContentTmpl,{});t.append(a);var i=$("#case-search-log-data-buttonset",t);$("#btn-admin-case-search-clear",i).click(function(a){$(".biz-wp-input-text",t).val(""),$(".biz-wp-form-datepicker",t).val(""),e.setupProcessTree()}),$("#btn-admin-case-search",i).click(function(a){var i="",o="",r="",s="",n="",c=e.processTree.getTreeRouteSelected();c.length>0&&(2==c.length?(i=c[1],r=c[0],o=""):(i=c[c.length-1],o=c[1],r=c[0]));var l={h_action:"getCases",I_ProcessState:"Running",h_idApp:"",I_Users:"ALL",eventAsTask:!0,orderType:1,order:"",orderField:"",I_radNumber:$("#caseInput").val(),I_idWFClass:r,I_USERFULLNAME:$("#userNameInput").val(),I_USERPOSITION:$("#userPositionInput").val(),I_From__CreationDate:$("#sinceDate").val(),I_To__CreationDate:$("#toDate").val(),h_idWFClassAuth:"",I_idCategory:o,I_idApplication:i,PageSize:e.maxElemShow};""==$("#sinceDate").val()||bizagi.util.isDate($("#sinceDate").val())?""==$("#toDate").val()||bizagi.util.isDate($("#toDate").val())?(e.searchParams=l,e.findResults(t,l)):(s=bizagi.localization.getResource("workportal-general-invalid-date"),n=bizagi.localization.getResource("workportal-widget-admincasesearch-to-date"),s=s.replace("{0}",n),bizagi.showMessageBox(s,"Bizagi","warning")):(s=bizagi.localization.getResource("workportal-general-invalid-date"),n=bizagi.localization.getResource("workportal-widget-admincasesearch-date-since"),s=s.replace("{0}",n),bizagi.showMessageBox(s,"Bizagi","warning"))}),$("#btn-admin-case-back",i).click(function(t){"backToMainForm"==e.buttonBackAction?e.backToMainForm():"backToCases"==e.buttonBackAction&&e.backToCases()}),$("#btn-admin-case-finish",i).click(function(t){e.publish("closeCurrentDialog")})},backToCases:function(){var e=this.getContent();this.buttonBackAction="backToMainForm",$("#dinamicContent",e).show(),$("#dinamicContent2",e).html(""),$("#usersTable").remove(),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title")),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide()},backToMainForm:function(){var e=this.getContent();$("#mainForm",e).show(),$("#dinamicContent",e).html(""),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle")),$("#btn-admin-case-search-clear",e).show(),$("#btn-admin-case-search",e).show(),$("#btn-admin-case-back",e).css("display","none")},assignEventReassignLinks:function(e,t){this.selectedUserId=e,this.selectedUserName=t,this.reassignTasks()},setupActionsButton:function(e){var t=this;$("#btn-admin-case-invalidate",e).click(function(a){t.invalidateCases(e)}),$("#btn-admin-case-reassign",e).click(function(a){t.showReassignTasksFrame(e)})},setupActivitiesLink:function(e){var t=this;$(".activityClicked",e).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:$(this)[0].getAttribute("data-idworkItem"),idTask:$(this)[0].getAttribute("data-idTask")}),t.publish("closeCurrentDialog")}),$(".caseClicked",e).click(function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:"",idTask:""}),t.publish("closeCurrentDialog")}),$(".cases-column-header",e).click(function(){var a=$(this)[0].getAttribute("data-columnorder"),i=$(this)[0].getAttribute("data-ordertype"),o=$(this)[0].getAttribute("data-columnOrderName");i="1"==i?0:1,t.searchParams.order=a,t.searchParams.orderType=i,t.searchParams.orderField=o,t.findResults(e,t.searchParams,t.searchParams.Page)})},setupGraphicQueryEvent:function(e){var t=this;$(".biz-wp-diagram-view-icon",e).click(function(){var e=$(this).data("idcase"),a=$(this).data("idworkflow");t.showGraphicQuery({idCase:e,idWorkflow:a})})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this.getTemplate("project-content-dashboard");return this.content=e.render({}),this.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,a){this.params=a||{},this._super(e,t,a),this.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this;a.params=$.extend(a.params,t.args),a.params.plan.idActivitySelected=void 0,a.clean();var i=a.getContent().empty();void 0!==e.type&&(a.params.showContextByMenuDashboard=e.type);var o={showFormOverview:a.params.menuDashboard.showFormOverview,showFormActivity:a.params.menuDashboard.showFormActivity,showCommentsOptionMenu:a.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:a.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:a.params.menuDashboard.showTimeLineOptionMenu,showPlanOptionMenu:a.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:a.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:a.params.menuDashboard.contextFormActivityOptionMenu,isAdhocProcess:a.params.isAdhocProcess};a.getTemplate("project-dashboard-menu").render(o).appendTo(i),a.params.showContextByMenuDashboard&&$("li[data-context='"+a.params.showContextByMenuDashboard.toUpperCase()+"']",a.content).addClass("active").siblings().removeClass("active"),a.handlerEvents()},loadContentById:function(e){var t=this;e.preventDefault();var a=$(e.target).closest("li");if(!a.hasClass("active")){var i=a.data("context");i&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var e=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),a=parseInt(e[0]),o="",r=a;"PLANACTIVITIES"==i&&(r=a+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),t.params.refreshLastItemBreadcrumb=!1,t.pub("notify",{type:i.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:i,histName:o,level:r})}),$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")})}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),a=$("[data-context='FILES']",e),i=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",function(){t.toggle(),a.toggle(),i.toggle()})},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)})},clean:function(){var e=this,t=e.getContent();e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))}),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.activity",{},{init:function(e,t,a){this._super(e,t,a),this.loadTemplates({"project-activity":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity").concat("#project-activity-wrapper")})},renderContent:function(){var e=this.getTemplate("project-activity");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.renderForm({idCase:e.params.idCase,idWorkitem:e.params.idWorkitem,idTask:e.params.idTask,radNumber:e.params.radNumber,withOutGlobalForm:e.params.withOutGlobalForm||!1,isClosed:e.params.isClosed,belongCurrentUser:e.params.belongCurrentUser,hasGlobalForm:bizagi.util.parseBoolean(e.params.hasGlobalForm),showForm:bizagi.util.parseBoolean(e.params.showForm),isOfflineForm:e.params.isOfflineForm||!1,messageForm:e.params.messageForm||""})},renderForm:function(e){var t=this,a=t.getContent(),i=!e.isClosed&&!e.belongCurrentUser;if(i&&(i=!0,e.hasGlobalForm||(e.withOutGlobalForm=!0)),e.withOutGlobalForm){var o=t.workportalFacade.getTemplate("info-message"),r=""!==e.messageForm?e.messageForm:t.resources.getResource("render-without-globalform");void 0!==t.params&&void 0!==t.params.isOfflineForm&&1==t.params.isOfflineForm&&(r=bizagi.util.getMessageFromNetworkState(t.dataService.online)),$.tmpl(o,{message:r}).appendTo(a),$.Deferred().fail()}else{var s=null!=typeof t.dataService.serviceLocator.proxyPrefix?t.dataService.serviceLocator.proxyPrefix:"",n=null!=typeof t.dataService.database?t.dataService.database:"",c=t.rendering=new bizagi.rendering.facade({proxyPrefix:s,database:n});bizagi.util.setContext(e),t.rendering.subscribe("onLoadDataItemsFromFormActivityPlan",function(e,a){t.pub("notify",{type:"UPDATE_ITEMS_FROM_FORMRENDER",args:a})}),t.rendering.subscribe("rendering-formRendered",function(e,a){t.pub("notify",{type:"ON_RENDER_FINISH",args:a})});c.execute($.extend(e,{canvas:a,menu:t.menu}));a.bind("routing",function(e,a){var i={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.params.idCase,fromTask:t.params.fromTask||t.params.idTask,fromWorkItemId:t.params.fromWorkItemId||t.params.idWorkitem,isOfflineForm:t.params.isOfflineForm,formsRenderVersion:t.params.formsRenderVersion,onClose:function(){t.publish("changeWidget",{widgetName:bizagi.cookie("bizagiDefaultWidget")})}};i=$.extend(i,a),t.publish("executeAction",i)})}t.renderingFacade=c,t.resizeLayout()},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.plan.sidebar",{},{init:function(e,t,a){this._super(e,t,a),(a=a||{}).supportNav=!1,this.loadTemplates({"project-activity-plan-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.plan.sidebar").concat("#project-activity-plan-sidebar")})},renderContent:function(){var e=this,t=!1,a=e.getTemplate("project-activity-plan-sidebar");return t=!(!e.params.isAdhocProcess||void 0===e.params.isAdhocProcess)&&e.params.isAdhocProcess,e.content=a.render({hasRelatedPlan:e.params.planChild,showPlanAction:e.params.menuDashboard.showPlanOptionMenu,isAdhocProcess:t}),e.content},postRender:function(){var e=this.getContent(),t=this.params.assignationEveryone||{};t.enabledReadOnlyForAsigneeToEveryone&&t.isAssignationMethodEveryone&&t.canWorkOnThisTask?t.currentUserIsCurrentAsignee?this.handlerEvent():$(e).hide():this.handlerEvent()},handlerEvent:function(){var e=this.getContent();$(".ui-bizagi-wp-project-activity-plan-sidebar-action-add > a",e).on("click",$.proxy(this.loadPlanForm,this))},loadPlanForm:function(){var e=this;$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var t=!e.params.planChild||"EXECUTING"!==e.params.planChild.currentState&&"CLOSED"!==e.params.planChild.currentState&&"PENDING"!==e.params.planChild.currentState?e.params.menuDashboard.contextPlanOptionMenu:"PLANACTIVITIES",a=e.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),i=parseInt(a[0]),o="",r=i;"PLANOVERVIEW"!==t&&"PLANACTIVITIES"!==t||(r=i+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),e.params.refreshLastItemBreadcrumb=!1,e.pub("notify",{type:t.toUpperCase(),args:$.extend(e.params,{showContextByMenuDashboard:t,histName:o,level:r})})})},clean:function(){$(".ui-bizagi-wp-project-activity-plan-sidebar-action-add > a",this.getContent()).off("click",$.proxy(this.loadPlanForm,this))}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.plan.sidebar",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.plan.sidebar],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(e,t,a){var i=this;i._super(e,t,a),i.contextsSidebarActivity=a.contextsSidebarActivity,i.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),i.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")}),i.releaseDialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.releaseDialogBox.formContent=this.getTemplate("project-caseState-popup-release").render({}),this.content},postRender:function(){var e=this;(e.contextsSidebarActivity||[]).forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.plugins={},e.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",e.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",e.releaseDialogBox.formContent)}},e.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(e.onClickAcceptRelease,e)),e.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(e.onClickCancelRelease,e))},updateView:function(e,t){var a=this;$.extend(a.params,t.args);var i=t.args;a.getContent().empty();var o={isFavoriteCase:"off"};if(i.isFavorite&&JSON.parse(i.isFavorite)?o.isFavoriteCase="bz-icon-star":o.isFavoriteCase="bz-icon-star-outline",a.showCaseNumber(i,o),i.creationDate){var r="MM/dd/yyyy H:mm",s=i.creationDate,n=bizagi.util.dateFormatter.getDateFromFormat(s,r);o.creationDateFormat=a.getFormattedDate(n);var c=bizagi.util.dateFormatter.getDateFromFormat(i.solutionDate,r);o.solutionDateFormat=a.getFormattedDate(c);var l=new Date;a.calculateDataForTemplate(o,n,l,c,i)}$(a.getContent()).on("click",".show-diagram-case",function(){!(!a.params.isAdhocProcess||void 0===a.params.isAdhocProcess)?a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow,isAdhoc:!0,idProcess:a.params.idAdhocProcess}):a.showGraphicQuery({idCase:a.params.idCaseForGraphicQuery||a.params.idCase,idWorkflow:a.params.idWorkFlow})}),$(a.getContent()).on("click",".show-process-help",function(){a.showHelpUrl(a.params.helpUrl)})},calculateDataForTemplate:function(e,t,a,i,o){var r=this.getContent(),s={};s.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(o.isOpen)?(s.fromDate=t.getTime(),s.toDate=a.getTime()):(s.fromDate=i.getTime(),s.toDate=a.getTime());var n=s.toDate-s.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n),null,!1);bizagi.util.parseBoolean(o.isOpen)?(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),e.colorStateCase="Opened"):(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),e.colorStateCase="Closed"),e.percentCompleteBar=100,e.isOpen=bizagi.util.parseBoolean(o.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(o,e)).appendTo($("#ui-bizagi-remaining",r)),o.currentState.length>0&&this.initilizeActionMenu(o.currentState)},showCaseNumber:function(e,t){var a=this,i=a.getContent(),o=a.getTemplate("project-caseState"),r=!1;r=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,a.params.helpUrl=bizagi.util.validateUrlWellFormed(a.params.helpUrl),o.render($.extend(e,t,{security:bizagi.menuSecurity,isAdhocProcess:r,urlHelp:!bizagi.util.isEmpty(a.params.helpUrl)})).appendTo(i),$(".case-summary-favorite",i).on("click",$.proxy(a.onClickFavorite,a)),$(".case-summary-back",a.content).on("click",$.proxy(a.goToCase,a,"back")),$(".case-summary-next",a.content).on("click",$.proxy(a.goToCase,a,"next")),a.showBackNextNavigation()},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},onClickFavorite:function(e){e.preventDefault();var t=this,a={};$(e.target).hasClass("bz-icon-star-outline")?(a={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(a)).done(function(a){t.params.guidFavorite=a.idFavorites,$(e.target).removeClass("bz-icon-star-outline"),$(e.target).addClass("bz-icon-star")})):(a={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(a)).done(function(){$(e.target).addClass("bz-icon-star-outline"),$(e.target).removeClass("bz-icon-star")}))},showHelpUrl:function(e){window.open(e)},initilizeActionMenu:function(e){var t=this,a=!1,i=!1;if(e&&e.length>0)for(j=0;j<e.length;++j)e[j]&&t.params&&e[j].idWorkItem==t.params.idWorkitem&&(a=bizagi.util.parseBoolean(e[j].allowsReassign)||!1,i=bizagi.util.parseBoolean(e[j].allowReleaseActivity)||!1);var o=$("#bt-case-action-reassing",t.content),r=$("#bt-case-action-release",t.content);a&&o.show();var s=t.params.assignationEveryone||{},n=i&&!(s.enabledReadOnlyForAsigneeToEveryone&&s.isAssignationMethodEveryone);n&&r.show(),(a||n)&&($(".ui-bizagi-wp-project-plan-action-menu",t.content).show(),$(".ui-bizagi-wp-project-plan-action-menu",t.content).menu({select:$.proxy(t.onSelectMenu,t)}).removeClass("ui-widget-content"))},onSelectMenu:function(e,t){if(0===$(e.currentTarget).find("i").length)switch($(t.item).data("item")){case"reassing":this.onClickMenuReasign();break;case"release":this.onClickMenuRelease()}},onClickMenuReasign:function(){var e=this.params.idCase,t=this.params.idWorkitem;$.when(this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:t},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))},onClickMenuRelease:function(){var e=this;e.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var e=this,t={idCase:e.params.idCase,idWorkItem:e.params.idWorkitem};$.when(e.dataService.releaseActivity(t)).done(function(a){var i;switch(a.status?a.status:""){case"Success":e.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":i=e.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:i=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var a=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(a,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}),e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){this.releaseDialogBox.formContent.dialog("destroy"),this.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(e){var t=$.Deferred();return e.fromDate?$.when(this.dataService.getEffectiveDuration(e)).done(function(e){t.resolve(e)}):t.resolve(null),t.promise()},clean:function(){var e=this;$(".show-diagram-case",e.getContent()).off();var t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},goToCase:function(e){var t="back"==e?this.getBackCase():this.getNextCase();t>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var e=0;e<bizagi.lstIdCases.length;e++)if(this.params.idCase==bizagi.lstIdCases[e])return e;return-1},getNextCase:function(){var e=this.getListKey();return bizagi.lstIdCases.length==e+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[e+1]},getBackCase:function(){var e=this.getListKey();return 0==e?-1:bizagi.lstIdCases[e-1]||-1},showBackNextNavigation:function(){var e=this,t=e.getNextCase(),a=e.getBackCase();t<=0?$(".case-summary-next",e.content).hide():$(".case-summary-next",e.content).show(),a<=0?$(".case-summary-back",e.content).hide():$(".case-summary-back",e.content).show(),t<=0&&a<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.params=i,a.getContent();var o={},r=(i.currentState||[]).filter(function(e){return e.idWorkItem==i.idWorkitem})[0];if(r){o.activityName=r.state,o.activityIsEvent=bizagi.util.parseBoolean(r.isEvent);var s="MM/dd/yyyy H:mm",n=bizagi.util.dateFormatter.getDateFromFormat(r.entryDateWorkItem,s);n.getTime&&(o.initDateFormat=a.getFormattedDate(n));var c=new Date,l=bizagi.util.dateFormatter.getDateFromFormat(r.estimatedSolutionDate,s);o.estimatedSolutionDateFormat="",n.getTime&&l.getTime&&r?a.calculateDataForTemplate(r,o,n,c,l):a.updateTemplateWidget(o)}},calculateDataForTemplate:function(e,t,a,i,o){new Date(Date.now()-a.getTime());var r=i.getTime()-o.getTime(),s=a.getTime()-o.getTime(),n=(bizagi.currentUser.idUser,a.getTime()),c=Date.now(),l=!1,d={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:o.getTime()},p={};r>0?(d.fromDate=o.getTime(),d.toDate=i.getTime(),l=!0):(p.idUser=bizagi.currentUser.idUser,p.fromDate=a.getTime(),p.toDate=o.getTime());var u=c-n,g=d.toDate-d.fromDate,m=r>0?0:p.toDate-p.fromDate,h=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-u),null,!1);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",h),t.percentCompleteBar=100,0===s)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===l){var b=this.getPercentBar(m/1e3/60,g/1e3/60);t.percentCompleteBar=b.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent)),t.estimatedSolutionDateFormat=this.getFormattedDate(o),this.updateTemplateWidget(t)},getPercentBar:function(e,t){var a={};return a.percent=Math.round(100*(1-t/e)),a},updateTemplateWidget:function(e){var t=this.getContent().empty();this.getTemplate("project-activityState-wrapper").render(e).appendTo(t)},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,a=e.getMonth(),i=BIZAGI_LANGUAGE;return null!=i&&null!=i&&i.length>0&&"fr"==i.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[a]:t[a]+" "+$.datepicker.formatDate("dd",e)},clean:function(){var e=this,t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},callGetEffectiveDuration:function(e){var t=this,a=$.Deferred();return setTimeout(function(){e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){a.resolve(e)}):a.resolve(null)},200),a.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var e=this.getTemplate("project-process-state");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,o=a.getContent().empty();a.params=i;var r={};r.showParentProcess=i.idParentCase>=1,r.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:"0"==i.idTask?"":i.idTask,idWorkflow:i.idWorkflowParentCase},a.getTemplate("project-process-state").render($.extend(i,r)).appendTo(o),$("#go-to-parent-case",o).on("click",$.proxy(a.onClickGoToParentCase,a))},onClickGoToParentCase:function(e){e.preventDefault();this.routingExecute($(e.target).closest("#go-to-parent-case"))},clean:function(){var e=this;e.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(e,t,a,i){var o=this;o.relatedusers=a,o._super(e,t,i),o.contextsSidebarActivity=i.contextsSidebarActivity,o.plugins={},o.users=[],o.loadedUsers=!1,o.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.sub("ON_RENDER_FINISH",$.proxy(e.onRenderFinish,e))},updateView:function(e,t){var a=this;a.params=t,setTimeout(function(){!1===a.loadedUsers&&a.onRenderFinish()},500)},onRenderFinish:function(){var e=this,t=e.params.args,a=e.getContent().empty();e.loadedUsers=!0,e.getTemplate("project-users").render().appendTo(a);var i=[{id:t.createdBy.userId,typeName:"owner"}];t.idCase>0&&e.relatedusers.render(e.content,".relatedusers-wrapper",t.idCase,i)},clean:function(){var e=this;e.loadedUsers=!1,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(e){return e&&(responseSubprocessState=e),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(e){return e?jQuery.isArray(e)&&0===e.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(e):this.auxArrayListSubprocessesState}},{init:function(e,t,a){this._super(e,t,a),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(e){var t=this,a=t.getContent();$(e,a).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var e,a,i,o=$(this).closest("li").find("#idCase").val(),r=t.Class.auxArrayListSubprocesses().filter(function(e){return e.idCase==o});if(r.length>0)return e=r[0].indexSubprocess,a=r[0].idCustData,i=$(this).text(),t.getContentTooltip(e,a,i,t.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(e,t){if(void 0===e.originalEvent)return!1;var a=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+a).remove()},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(e,t,a,i){"-1"==t&&(t="0");var o=function(e,t){return{nameProperty:e,valueProperty:t}},r=[],s="",n=this.getSubprocessData(e,t),c=n.custData,l=n.custDataTypes,d=n.custFields,p=n.displayName;if(r.push(new o(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),p)),c.length)for(var u=0;u<c.length;u+=1)s=c[u],l&&("Money"==l[u]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==l[u]?s=bizagi.util.formatBoolean(s):"Float"==l[u]||"Real"==l[u]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),r.push(new o(d[u],s));var g={};g.arrayCustomsProperties=r,g.nameSubprocess=a;var m=i,h=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(g).appendTo(h),h.html()},getSubprocessData:function(e,t){var a={},i=this.Class.responseSubprocess().subProcesses,o=this.Class.responseSubprocess().subProcPersonalized;if(i&&i.length>0){a.custData=i[e].custData,a.custDataTypes=i[e].custDataTypes;var r=this.Class.responseSubprocess().CustFields[t];a.custFields=r[Object.keys(r)[0]],a.displayName=i[e].displayName}else o&&Object.keys(o).length>0&&(a.custData=o[0].subProcesses[e].custData,a.custDataTypes=o[0].subProcesses[e].custDataTypes,a.custFields=o[0].CustFields[0],a.displayName=o[0].subProcesses[e].displayName);return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var e=this.getTemplate("project-events");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args,o=a.getContent().empty();a.params=i,$.when(a.getArgsTemplate(i)).done(function(e){a.getTemplate("project-events").render($.extend(i,e)).appendTo(o),$(".list-events li.event a",o).on("click",$.proxy(a.onClickGoEvent,a)),a.initializeTooltip(".list-events li")})},getArgsTemplate:function(e){var t=$.Deferred(),a={};if(e.countEvents>=1)for(var i=0;i<e.currentState.length;i++)"true"==e.currentState[i].isEvent&&e.currentState[i].idWorkItem==e.idWorkitem&&(e.countEvents=e.countEvents-1);return a.showEvents=e.countEvents>=1,a.showEvents?$.when(this.callSummaryCaseEvents(e.idCase)).done(function(i){e.showEvents=i.events.length>=1,e.showEvents&&(a.events=[],i.events.forEach(function(e){a.events.push($.extend(e[Object.keys(e)[0]],{idWorkFlow:i.idWorkFlow}))})),t.resolve(a)}):t.resolve(a),t.promise()},onClickGoEvent:function(e){e.preventDefault();var t=this;$.when(bizagi.util.autoSave()).done(function(){t.routingExecute($(e.target).closest("li"))})},callSummaryCaseEvents:function(e){var t=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:e})).done(function(e){t.resolve(e)}),t.promise()},clean:function(){var e=this;this.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(e){return this._super(e)},auxArrayListSubprocesses:function(e){return this._super(e)}},{init:function(e,t,a){this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var a=this,i=t.args;a.getContent().empty();a.params=i,a.params.idCase>0&&$.when(a.dataService.summarySubProcess({idCase:a.params.idCase})).done(function(e){a.Class.responseSubprocess(e),a.organizeDataForSubprocesses(a.params)})},organizeDataForSubprocesses:function(e){var t=this;if(t.Class.responseSubprocess().showSubProcess){$.each(t.Class.responseSubprocess().subProcesses,function(e){var a=t.Class.responseSubprocess().subProcesses[e].custData;if(a&&a.length)for(var i=0;i<a.length;i+=1)null===a[i]&&(a[i]="")});var a=t.Class.responseSubprocess().subProcesses||t.Class.responseSubprocess().subProcPersonalized;t.Class.auxArrayListSubprocesses([]);for(var i=0;i<Object.keys(a).length;i+=1){var o=a[i];t.Class.auxArrayListSubprocesses({isOpen:o.isOpen,radNumber:o.radNumber,displayName:o.displayName,idCase:o.idCase,indexSubprocess:i,idCustData:o.idCustData}),o.subProcesses&&Object.keys(o).forEach(function(e){t.Class.auxArrayListSubprocesses({isOpen:o[e].isOpen,radNumber:o[e].radNumber,displayName:o[e].displayName,idCase:o[e].idCase,indexSubprocess:i,idCustData:o[e].idCustData})})}t.renderWidget()}},renderWidget:function(){var e=this,t=e.getContent();e.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:e.Class.auxArrayListSubprocesses()}).appendTo(t),$(".list-subprocesses a",t).on("click",$.proxy(e.onClickGoSubprocess,e)),e.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(e){e.preventDefault();this.routingExecute($(e.target).closest("li"))},clean:function(){var e=this;e.params={},e.pluginTooltip=null,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(e,t,a){this._super(e,t,a),a=a||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var e=this,t=e.getTemplate("project-activity-description"),a=e.getWorkitemDescription();return e.content=a?t.render({description:a}):$("<div />"),e.content},postRender:function(){},getWorkitemDescription:function(){for(var e=this.params||{},t=e.idWorkitem||0,a=e.currentState||[],i="",o=0;o<a.length;o++)if(t==a[o].idWorkItem){i=a[o].tskDescription;break}return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/activity.desktop.production.js.map
