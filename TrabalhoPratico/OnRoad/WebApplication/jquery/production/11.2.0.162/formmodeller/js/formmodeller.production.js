for(var key in $.extend($.ui.tabs.prototype,{paging:function(e){var t={tabsPerPage:0,nextButton:"&#187;",prevButton:"&#171;",follow:!1,cycle:!1,selectOnAdd:!1,followOnSelect:!1};t=$.extend(t,e);var o,r,n,a,s,l,d,c=this,u=!1,p=null,m=$(window).height(),h=$(window).width();function g(){x(),a=0,o=0,l=0,r=0,d=new Array,s=new Array,selectedTabWidths=new Array,n=c.element.width();var e=0;if(c.lis.each(function(t){t==c.options.selected?(selectedTabWidths[t]=$(this).outerWidth({margin:!0}),s[t]=c.lis.eq(t).removeClass("ui-tabs-selected").outerWidth({margin:!0}),c.lis.eq(t).addClass("ui-tabs-selected"),e=Math.min(e,Math.abs(selectedTabWidths[t]-s[t])),a+=s[t]):(s[t]=$(this).outerWidth({margin:!0}),selectedTabWidths[t]=c.lis.eq(t).addClass("ui-tabs-selected").outerWidth({margin:!0}),c.lis.eq(t).removeClass("ui-tabs-selected"),e=Math.max(e,Math.abs(selectedTabWidths[t]-s[t])),a+=s[t])}),(a+=e+($.browser.msie?4:0)+9)>n){li=$("<li></li>").addClass("ui-state-default ui-tabs-paging-next").append($('<a href="#"></a>').click(function(){return f("next"),!1}).html(t.nextButton)),c.lis.eq(c.length()-1).after(li),r=li.outerWidth({margin:!0}),li=$("<li></li>").addClass("ui-state-default ui-tabs-paging-prev").append($('<a href="#"></a>').click(function(){return f("prev"),!1}).html(t.prevButton)),c.lis.eq(0).before(li),r+=li.outerWidth({margin:!0}),r+=19;for(var i=0,p=0,m=0,h=0;h<s.length;h++)(0==p||selectedTabWidths[h]-s[h]>m)&&(m=selectedTabWidths[h]-s[h]),null==d[i]?d[i]={start:h}:(h>0&&h%t.tabsPerPage==0||s[h]+p+r+12>n)&&(p+m>l&&(l=p+m),d[++i]={start:h},p=0),d[i].end=h+1,p+=s[h],h==c.options.selected&&(o=i);p+m>l&&(l=p+m),c.lis.hide().slice(d[o].start,d[o].end).show(),o!=d.length-1||t.cycle||b("next"),0!=o||t.cycle||b("prev"),buttonPadding=n-l-r,buttonPadding>0&&$(".ui-tabs-paging-next",c.element).css({paddingRight:buttonPadding+"px"}),u=!0}else x();$(window).bind("resize",y)}function f(e){o+="prev"==e?-1:1,"prev"==e&&o<0&&t.cycle||"next"==e&&o>=d.length&&!t.cycle?o=d.length-1:("prev"==e&&o<0||"next"==e&&o>=d.length&&t.cycle)&&(o=0);var i=d[o].start,r=d[o].end;c.lis.hide().slice(i,r).show(),"prev"==e?(v("next"),t.follow&&(c.options.selected<i||c.options.selected>r-1)&&c.select(r-1),!t.cycle&&i<=0&&b("prev")):(v("prev"),t.follow&&(c.options.selected<i||c.options.selected>r-1)&&c.select(i),!t.cycle&&r>=c.length()&&b("next"))}function b(e){$(".ui-tabs-paging-"+e,c.element).addClass("ui-tabs-paging-disabled")}function v(e){$(".ui-tabs-paging-"+e,c.element).removeClass("ui-tabs-paging-disabled")}function y(){p&&clearTimeout(p),m==$(window).height()&&h==$(window).width()||(p=setTimeout(z,100))}function z(){m=$(window).height(),h=$(window).width(),g()}function x(){$(".ui-tabs-paging-next",c.element).remove(),$(".ui-tabs-paging-prev",c.element).remove(),c.lis.show(),u=!1,$(window).unbind("resize",y)}var C=c.add;c.add=function(e,i,o){u&&x(),C.apply(this,[e,i,o]),t.selectOnAdd&&(null==o&&(o=this.lis.length-1),this.select(o)),g()};var w=c.remove;c.remove=function(e){u&&x(),w.apply(this,[e]),g()};var P=c.select;c.select=function(e){if(P.apply(this,[e]),u&&t.followOnSelect)for(i in d){var r=d[i].start,n=d[i].end;if(e>=r&&e<n){i!=o&&(c.lis.hide().slice(r,n).show(),0==(o=parseInt(i))?(v("next"),!t.cycle&&r<=0&&b("prev")):(v("prev"),!t.cycle&&n>=c.length()&&b("next")));break}}},$.extend($.ui.tabs.prototype,{pagingDestroy:function(){x()}}),g()}}),function(e){e.timeago=function(o){return t.settings={refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:bizagi.localization.getResource("bizagi-editor-form-timeago-ago"),suffixFromNow:bizagi.localization.getResource("bizagi-editor-form-timeago-from-now"),seconds:bizagi.localization.getResource("bizagi-editor-form-timeago-seconds"),minute:bizagi.localization.getResource("bizagi-editor-form-timeago-minute"),minutes:bizagi.localization.getResource("bizagi-editor-form-timeago-minutes"),hour:bizagi.localization.getResource("bizagi-editor-form-timeago-hour"),hours:bizagi.localization.getResource("bizagi-editor-form-timeago-hours"),day:bizagi.localization.getResource("bizagi-editor-form-timeago-day"),days:bizagi.localization.getResource("bizagi-editor-form-timeago-days"),month:bizagi.localization.getResource("bizagi-editor-form-timeago-month"),months:bizagi.localization.getResource("bizagi-editor-form-timeago-months"),year:bizagi.localization.getResource("bizagi-editor-form-timeago-year"),years:bizagi.localization.getResource("bizagi-editor-form-timeago-years"),wordSeparator:" ",numbers:[]}},o instanceof Date?i(o):i("string"==typeof o?e.timeago.parse(o):"number"==typeof o?new Date(o):e.timeago.datetime(o))};var t=e.timeago;function i(e){return t.inWords((i=e,(new Date).getTime()-i.getTime()));var i}e.extend(e.timeago,{inWords:function(t){var i=this.settings.strings,o=i.prefixAgo,r=i.suffixAgo;this.settings.allowFuture&&t<0&&(o=i.prefixFromNow,r=i.suffixFromNow);var n=Math.abs(t)/1e3,a=n/60,s=a/60,l=s/24,d=l/365;function c(o,r){var n=e.isFunction(o)?o(r,t):o,a=i.numbers&&i.numbers[r]||r;return n.replace(/%d/i,a)}var u=n<45&&c(i.seconds,Math.round(n))||n<90&&c(i.minute,1)||a<45&&c(i.minutes,Math.round(a))||a<90&&c(i.hour,1)||s<24&&c(i.hours,Math.round(s))||s<42&&c(i.day,1)||l<30&&c(i.days,Math.round(l))||l<45&&c(i.month,1)||l<365&&c(i.months,Math.round(l/30))||d<1.5&&c(i.year,1)||c(i.years,Math.round(d)),p=i.wordSeparator||"";return void 0===i.wordSeparator&&(p=" "),e.trim([o,u,r].join(p))},parse:function(t){var i=e.trim(t);return i=(i=(i=(i=(i=i.replace(/\.\d+/,"")).replace(/-/,"/").replace(/-/,"/")).replace(/T/," ").replace(/Z/," UTC")).replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2")).replace(/([\+\-]\d\d)$/," $100"),new Date(i)},datetime:function(i){var o=t.isTime(i)?e(i).attr("datetime"):e(i).attr("title");return t.parse(o)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}})}(jQuery),function($){function Timepicker(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",ampm:!1,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm tt",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",timezoneText:"Time Zone"},this._defaults={showButtonPanel:!0,timeOnly:!1,showHour:!0,showMinute:!0,showSecond:!1,showMillisec:!1,showTimezone:!1,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,showTimepicker:!0,timezoneIso8609:!1,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null},$.extend(this._defaults,this.regional[""])}function extendRemove(e,t){for(var i in $.extend(e,t),t)null!==t[i]&&void 0!==t[i]||(e[i]=t[i]);return e}$.ui.timepicker=$.ui.timepicker||{},$.ui.timepicker.version||($.extend($.ui,{timepicker:{version:"1.0.0"}}),$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_newInst:function($input,o){var tp_inst=new Timepicker,inlineSettings={};for(var attrName in this._defaults){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(e){inlineSettings[attrName]=attrValue}}if(tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(e,t){if($.isFunction(o.beforeShow))return o.beforeShow(e,t,tp_inst)},onChangeMonthYear:function(e,t,i){tp_inst._updateDateTime(i),$.isFunction(o.onChangeMonthYear)&&o.onChangeMonthYear.call($input[0],e,t,i,tp_inst)},onClose:function(e,t){!0===tp_inst.timeDefined&&""!=$input.val()&&tp_inst._updateDateTime(t),$.isFunction(o.onClose)&&o.onClose.call($input[0],e,t,tp_inst)},timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(e){return e.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(e){return e.toUpperCase()}),null===tp_inst._defaults.timezoneList){for(var timezoneList=[],i=-11;i<=12;i++)timezoneList.push((i>=0?"+":"-")+("0"+Math.abs(i).toString()).slice(-2)+"00");tp_inst._defaults.timezoneIso8609&&(timezoneList=$.map(timezoneList,function(e){return"+0000"==e?"Z":e.substring(0,3)+":"+e.substring(3)})),tp_inst._defaults.timezoneList=timezoneList}return tp_inst.hour=tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec,tp_inst.ampm="",tp_inst.$input=$input,o.altField&&(tp_inst.$altInput=$(o.altField).css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})),0!=tp_inst._defaults.minDate&&0!=tp_inst._defaults.minDateTime||(tp_inst._defaults.minDate=new Date),0!=tp_inst._defaults.maxDate&&0!=tp_inst._defaults.maxDateTime||(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst},_addTimePicker:function(e){var t=this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(t),this._limitMinMaxDateTime(e,!1),this._injectTimePicker()},_parseTime:function(e,t){var i,o=this._defaults.timeFormat.toString().replace(/h{1,2}/gi,"(\\d?\\d)").replace(/m{1,2}/gi,"(\\d?\\d)").replace(/s{1,2}/gi,"(\\d?\\d)").replace(/l{1}/gi,"(\\d?\\d?\\d)").replace(/t{1,2}/gi,this._getPatternAmpm()).replace(/z{1}/gi,"(z|[-+]\\d\\d:?\\d\\d)?").replace(/\s/g,"\\s?")+this._defaults.timeSuffix+"$",r=this._getFormatPositions(),n="";if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),t||!this._defaults.timeOnly){var a=$.datepicker._get(this.inst,"dateFormat"),s=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");o="^.{"+a.length+",}?"+this._defaults.separator.replace(s,"\\$&")+o}if(i=e.match(new RegExp(o,"i"))){if(-1!==r.t&&(void 0===i[r.t]||0===i[r.t].length?(n="",this.ampm=""):(n=-1!==$.inArray(i[r.t].toUpperCase(),this.amNames)?"AM":"PM",this.ampm=this._defaults["AM"==n?"amNames":"pmNames"][0])),-1!==r.h&&("AM"==n&&"12"==i[r.h]?this.hour=0:"PM"==n&&"12"!=i[r.h]?this.hour=(parseFloat(i[r.h])+12).toFixed(0):this.hour=Number(i[r.h])),-1!==r.m&&(this.minute=Number(i[r.m])),-1!==r.s&&(this.second=Number(i[r.s])),-1!==r.l&&(this.millisec=Number(i[r.l])),-1!==r.z&&void 0!==i[r.z]){var l=i[r.z].toUpperCase();switch(l.length){case 1:l=this._defaults.timezoneIso8609?"Z":"+0000";break;case 5:this._defaults.timezoneIso8609&&(l="0000"==l.substring(1)?"Z":l.substring(0,3)+":"+l.substring(3));break;case 6:this._defaults.timezoneIso8609?"00:00"==l.substring(1)&&(l="Z"):l="Z"==l||"00:00"==l.substring(1)?"+0000":l.replace(/:/,"")}this.timezone=l}return!0}return!1},_getPatternAmpm:function(){var e=[],t=this._defaults;return t.amNames&&$.merge(e,t.amNames),t.pmNames&&$.merge(e,t.pmNames),"("+(e=$.map(e,function(e){return e.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")})).join("|")+")?"},_getFormatPositions:function(){var e=this._defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),t={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(e)for(var i=0;i<e.length;i++)-1==t[e[i].toString().charAt(0)]&&(t[e[i].toString().charAt(0)]=i+1);return t},_injectTimePicker:function(){var e=this.inst.dpDiv,t=this._defaults,i=this,o=parseInt(t.hourMax-(t.hourMax-t.hourMin)%t.stepHour,10),r=parseInt(t.minuteMax-(t.minuteMax-t.minuteMin)%t.stepMinute,10),n=parseInt(t.secondMax-(t.secondMax-t.secondMin)%t.stepSecond,10),a=parseInt(t.millisecMax-(t.millisecMax-t.millisecMin)%t.stepMillisec,10),s=this.inst.id.toString().replace(/([^A-Za-z0-9_])/g,"");if(0===e.find("div#ui-timepicker-div-"+s).length&&t.showTimepicker){var l=' style="display:none;"',d='<div class="ui-timepicker-div" id="ui-timepicker-div-'+s+'"><dl><dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+s+'"'+(t.showTime?"":l)+">"+t.timeText+'</dt><dd class="ui_tpicker_time" id="ui_tpicker_time_'+s+'"'+(t.showTime?"":l)+'></dd><dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+s+'"'+(t.showHour?"":l)+">"+t.hourText+"</dt>",c=0,u=0,p=0,m=0,h=null;if(d+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+s+'"'+(t.showHour?"":l)+"></div>",t.showHour&&t.hourGrid>0){d+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var g=t.hourMin;g<=o;g+=parseInt(t.hourGrid,10)){c++;var f=t.ampm&&g>12?g-12:g;f<10&&(f="0"+f),t.ampm&&(0==g?f="12a":f+=g<12?"a":"p"),d+="<td>"+f+"</td>"}d+="</tr></table></div>"}if(d+="</dd>",d+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+s+'"'+(t.showMinute?"":l)+">"+t.minuteText+'</dt><dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_'+s+'"'+(t.showMinute?"":l)+"></div>",t.showMinute&&t.minuteGrid>0){d+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var b=t.minuteMin;b<=r;b+=parseInt(t.minuteGrid,10))u++,d+="<td>"+(b<10?"0":"")+b+"</td>";d+="</tr></table></div>"}if(d+="</dd>",d+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+s+'"'+(t.showSecond?"":l)+">"+t.secondText+'</dt><dd class="ui_tpicker_second"><div id="ui_tpicker_second_'+s+'"'+(t.showSecond?"":l)+"></div>",t.showSecond&&t.secondGrid>0){d+='<div style="padding-left: 1px"><table><tr>';for(var v=t.secondMin;v<=n;v+=parseInt(t.secondGrid,10))p++,d+="<td>"+(v<10?"0":"")+v+"</td>";d+="</tr></table></div>"}if(d+="</dd>",d+='<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_'+s+'"'+(t.showMillisec?"":l)+">"+t.millisecText+'</dt><dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_'+s+'"'+(t.showMillisec?"":l)+"></div>",t.showMillisec&&t.millisecGrid>0){d+='<div style="padding-left: 1px"><table><tr>';for(var y=t.millisecMin;y<=a;y+=parseInt(t.millisecGrid,10))m++,d+="<td>"+(y<10?"0":"")+y+"</td>";d+="</tr></table></div>"}d+="</dd>",d+='<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_'+s+'"'+(t.showTimezone?"":l)+">"+t.timezoneText+"</dt>",d+='<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_'+s+'"'+(t.showTimezone?"":l)+"></dd>",d+="</dl></div>",$tp=$(d),!0===t.timeOnly&&($tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+t.timeOnlyTitle+"</div></div>"),e.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),this.hour_slider=$tp.find("#ui_tpicker_hour_"+s).slider({orientation:"horizontal",value:this.hour,min:t.hourMin,max:o,step:t.stepHour,slide:function(e,t){i.hour_slider.slider("option","value",t.value),i._onTimeChange()}}),this.minute_slider=$tp.find("#ui_tpicker_minute_"+s).slider({orientation:"horizontal",value:this.minute,min:t.minuteMin,max:r,step:t.stepMinute,slide:function(e,t){i.minute_slider.slider("option","value",t.value),i._onTimeChange()}}),this.second_slider=$tp.find("#ui_tpicker_second_"+s).slider({orientation:"horizontal",value:this.second,min:t.secondMin,max:n,step:t.stepSecond,slide:function(e,t){i.second_slider.slider("option","value",t.value),i._onTimeChange()}}),this.millisec_slider=$tp.find("#ui_tpicker_millisec_"+s).slider({orientation:"horizontal",value:this.millisec,min:t.millisecMin,max:a,step:t.stepMillisec,slide:function(e,t){i.millisec_slider.slider("option","value",t.value),i._onTimeChange()}}),this.timezone_select=$tp.find("#ui_tpicker_timezone_"+s).append("<select></select>").find("select"),$.fn.append.apply(this.timezone_select,$.map(t.timezoneList,function(e,t){return $("<option />").val("object"==typeof e?e.value:e).text("object"==typeof e?e.label:e)})),this.timezone_select.val(void 0!==this.timezone&&null!=this.timezone&&""!=this.timezone?this.timezone:t.timezone),this.timezone_select.change(function(){i._onTimeChange()}),t.showHour&&t.hourGrid>0&&(h=100*c*t.hourGrid/(o-t.hourMin),$tp.find(".ui_tpicker_hour table").css({width:h+"%",marginLeft:h/(-2*c)+"%",borderCollapse:"collapse"}).find("td").each(function(e){$(this).click(function(){var e=$(this).html();if(t.ampm){var o=e.substring(2).toLowerCase(),r=parseInt(e.substring(0,2),10);e="a"==o?12==r?0:r:12==r?12:r+12}i.hour_slider.slider("option","value",e),i._onTimeChange(),i._onSelectHandler()}).css({cursor:"pointer",width:100/c+"%",textAlign:"center",overflow:"hidden"})})),t.showMinute&&t.minuteGrid>0&&(h=100*u*t.minuteGrid/(r-t.minuteMin),$tp.find(".ui_tpicker_minute table").css({width:h+"%",marginLeft:h/(-2*u)+"%",borderCollapse:"collapse"}).find("td").each(function(e){$(this).click(function(){i.minute_slider.slider("option","value",$(this).html()),i._onTimeChange(),i._onSelectHandler()}).css({cursor:"pointer",width:100/u+"%",textAlign:"center",overflow:"hidden"})})),t.showSecond&&t.secondGrid>0&&$tp.find(".ui_tpicker_second table").css({width:h+"%",marginLeft:h/(-2*p)+"%",borderCollapse:"collapse"}).find("td").each(function(e){$(this).click(function(){i.second_slider.slider("option","value",$(this).html()),i._onTimeChange(),i._onSelectHandler()}).css({cursor:"pointer",width:100/p+"%",textAlign:"center",overflow:"hidden"})}),t.showMillisec&&t.millisecGrid>0&&$tp.find(".ui_tpicker_millisec table").css({width:h+"%",marginLeft:h/(-2*m)+"%",borderCollapse:"collapse"}).find("td").each(function(e){$(this).click(function(){i.millisec_slider.slider("option","value",$(this).html()),i._onTimeChange(),i._onSelectHandler()}).css({cursor:"pointer",width:100/m+"%",textAlign:"center",overflow:"hidden"})});var z=e.find(".ui-datepicker-buttonpane");if(z.length?z.before($tp):e.append($tp),this.$timeObj=$tp.find("#ui_tpicker_time_"+s),null!==this.inst){var x=this.timeDefined;this._onTimeChange(),this.timeDefined=x}var C=function(){i._onSelectHandler()};if(this.hour_slider.bind("slidestop",C),this.minute_slider.bind("slidestop",C),this.second_slider.bind("slidestop",C),this.millisec_slider.bind("slidestop",C),this._defaults.addSliderAccess){var w=this._defaults.sliderAccessArgs;setTimeout(function(){if(0==$tp.find(".ui-slider-access").length){$tp.find(".ui-slider:visible").sliderAccess(w);var e=$tp.find(".ui-slider-access:eq(0)").outerWidth(!0);e&&$tp.find("table:visible").each(function(){var t=$(this),i=t.outerWidth(),o=t.css("marginLeft").toString().replace("%",""),r=i-e,n=o*r/i+"%";t.css({width:r,marginLeft:n})})}},0)}}},_limitMinMaxDateTime:function(e,t){var i=this._defaults,o=new Date(e.selectedYear,e.selectedMonth,e.selectedDay);if(this._defaults.showTimepicker){if(null!==$.datepicker._get(e,"minDateTime")&&void 0!==$.datepicker._get(e,"minDateTime")&&o){var r=$.datepicker._get(e,"minDateTime"),n=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);null!==this.hourMinOriginal&&null!==this.minuteMinOriginal&&null!==this.secondMinOriginal&&null!==this.millisecMinOriginal||(this.hourMinOriginal=i.hourMin,this.minuteMinOriginal=i.minuteMin,this.secondMinOriginal=i.secondMin,this.millisecMinOriginal=i.millisecMin),e.settings.timeOnly||n.getTime()==o.getTime()?(this._defaults.hourMin=r.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=r.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=r.getSeconds()):this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=r.getMilliseconds()):(this.millisec<this._defaults.millisecMin&&(this.millisec=this._defaults.millisecMin),this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)}if(null!==$.datepicker._get(e,"maxDateTime")&&void 0!==$.datepicker._get(e,"maxDateTime")&&o){var a=$.datepicker._get(e,"maxDateTime"),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);null!==this.hourMaxOriginal&&null!==this.minuteMaxOriginal&&null!==this.secondMaxOriginal||(this.hourMaxOriginal=i.hourMax,this.minuteMaxOriginal=i.minuteMax,this.secondMaxOriginal=i.secondMax,this.millisecMaxOriginal=i.millisecMax),e.settings.timeOnly||s.getTime()==o.getTime()?(this._defaults.hourMax=a.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=a.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=a.getSeconds()):this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=a.getMilliseconds()):(this.millisec>this._defaults.millisecMax&&(this.millisec=this._defaults.millisecMax),this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)}if(void 0!==t&&!0===t){var l=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),d=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),c=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),u=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10);this.hour_slider&&this.hour_slider.slider("option",{min:this._defaults.hourMin,max:l}).slider("value",this.hour),this.minute_slider&&this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:d}).slider("value",this.minute),this.second_slider&&this.second_slider.slider("option",{min:this._defaults.secondMin,max:c}).slider("value",this.second),this.millisec_slider&&this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:u}).slider("value",this.millisec)}}},_onTimeChange:function(){var e=!!this.hour_slider&&this.hour_slider.slider("value"),t=!!this.minute_slider&&this.minute_slider.slider("value"),i=!!this.second_slider&&this.second_slider.slider("value"),o=!!this.millisec_slider&&this.millisec_slider.slider("value"),r=!!this.timezone_select&&this.timezone_select.val(),n=this._defaults;"object"==typeof e&&(e=!1),"object"==typeof t&&(t=!1),"object"==typeof i&&(i=!1),"object"==typeof o&&(o=!1),"object"==typeof r&&(r=!1),!1!==e&&(e=parseInt(e,10)),!1!==t&&(t=parseInt(t,10)),!1!==i&&(i=parseInt(i,10)),!1!==o&&(o=parseInt(o,10));var a=n[e<12?"amNames":"pmNames"][0],s=e!=this.hour||t!=this.minute||i!=this.second||o!=this.millisec||this.ampm.length>0&&e<12!=(-1!==$.inArray(this.ampm.toUpperCase(),this.amNames))||r!=this.timezone;s&&(!1!==e&&(this.hour=e),!1!==t&&(this.minute=t),!1!==i&&(this.second=i),!1!==o&&(this.millisec=o),!1!==r&&(this.timezone=r),this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0)),n.ampm&&(this.ampm=a),this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults),this.$timeObj&&this.$timeObj.text(this.formattedTime+n.timeSuffix),this.timeDefined=!0,s&&this._updateDateTime()},_onSelectHandler:function(){var e=this._defaults.onSelect,t=this.$input?this.$input[0]:null;e&&t&&e.apply(t,[this.formattedDateTime,this])},_formatTime:function(e,t){e=e||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var i=(t||this._defaults.timeFormat).toString();if(i=$.datepicker.formatTime(i,e,this._defaults),arguments.length)return i;this.formattedTime=i},_updateDateTime:function(e){e=this.inst||e;var t=$.datepicker._daylightSavingAdjust(new Date(e.selectedYear,e.selectedMonth,e.selectedDay)),i=$.datepicker._get(e,"dateFormat"),o=$.datepicker._getFormatConfig(e),r=null!==t&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(i,null===t?new Date:t,o);var n=this.formattedDate;void 0!==e.lastVal&&e.lastVal.length>0&&0===this.$input.val().length||(!0===this._defaults.timeOnly?n=this.formattedTime:!0!==this._defaults.timeOnly&&(this._defaults.alwaysSetTime||r)&&(n+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=n,this._defaults.showTimepicker?this.$altInput&&!0===this._defaults.altFieldTimeOnly?(this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate)):this.$altInput?(this.$altInput.val(n),this.$input.val(n)):this.$input.val(n):this.$input.val(this.formattedDate),this.$input.trigger("change"))}}),$.fn.extend({timepicker:function(e){var t=arguments;return"object"==typeof(e=e||{})&&(t[0]=$.extend(e,{timeOnly:!0})),$(this).each(function(){$.fn.datetimepicker.apply($(this),t)})},datetimepicker:function(e){return e=e||{},tmp_args=arguments,"string"==typeof e?"getDate"==e?$.fn.datepicker.apply($(this[0]),tmp_args):this.each(function(){var e=$(this);e.datepicker.apply(e,tmp_args)}):this.each(function(){var t=$(this);t.datepicker($.timepicker._newInst(t,e)._defaults)})}}),$.datepicker.formatTime=function(e,t,i){i=i||{},i=$.extend($.timepicker._defaults,i),t=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:"+0000"},t);var o=e,r=i.amNames[0],n=parseInt(t.hour,10);return i.ampm&&(n>11&&(r=i.pmNames[0],n>12&&(n%=12)),0===n&&(n=12)),o=o.replace(/(?:hh?|HH?|mm?|ss?|[tT]{1,2}|[lz])/g,function(e){switch(e.toLowerCase()){case"hh":return("0"+n).slice(-2);case"h":return n;case"mm":return("0"+t.minute).slice(-2);case"m":return t.minute;case"ss":return("0"+t.second).slice(-2);case"s":return t.second;case"l":return("00"+t.millisec).slice(-3);case"z":return t.timezone;case"t":case"tt":return i.ampm?(1==e.length&&(r=r.charAt(0)),"T"==e.charAt(0)?r.toUpperCase():r.toLowerCase()):""}}),o=$.trim(o)},$.datepicker._base_selectDate=$.datepicker._selectDate,$.datepicker._selectDate=function(e,t){var i=this._getInst($(e)[0]),o=this._get(i,"timepicker");o?(o._limitMinMaxDateTime(i,!0),i.inline=i.stay_open=!0,this._base_selectDate(e,t),i.inline=i.stay_open=!1,this._notifyChange(i),this._updateDatepicker(i)):this._base_selectDate(e,t)},$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(e){var t=e.input[0];if(!($.datepicker._curInst&&$.datepicker._curInst!=e&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=t||"boolean"==typeof e.stay_open&&!1!==e.stay_open)){this._base_updateDatepicker(e);var i=this._get(e,"timepicker");i&&i._addTimePicker(e)}},$.datepicker._base_doKeyPress=$.datepicker._doKeyPress,$.datepicker._doKeyPress=function(e){var t=$.datepicker._getInst(e.target),i=$.datepicker._get(t,"timepicker");if(i&&$.datepicker._get(t,"constrainInput")){var o=i._defaults.ampm,r=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),n=i._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,o?"APM":"").replace(/Tt/g,o?"AaPpMm":"").replace(/tT/g,o?"AaPpMm":"").replace(/T/g,o?"AP":"").replace(/tt/g,o?"apm":"").replace(/t/g,o?"ap":"")+" "+i._defaults.separator+i._defaults.timeSuffix+(i._defaults.showTimezone?i._defaults.timezoneList.join(""):"")+i._defaults.amNames.join("")+i._defaults.pmNames.join("")+r,a=String.fromCharCode(void 0===e.charCode?e.keyCode:e.charCode);return e.ctrlKey||a<" "||!r||n.indexOf(a)>-1}return $.datepicker._base_doKeyPress(e)},$.datepicker._base_doKeyUp=$.datepicker._doKeyUp,$.datepicker._doKeyUp=function(e){var t=$.datepicker._getInst(e.target),i=$.datepicker._get(t,"timepicker");if(i&&i._defaults.timeOnly&&t.input.val()!=t.lastVal)try{$.datepicker._updateDatepicker(t)}catch(e){$.datepicker.log(e)}return $.datepicker._base_doKeyUp(e)},$.datepicker._base_gotoToday=$.datepicker._gotoToday,$.datepicker._gotoToday=function(e){var t=this._getInst($(e)[0]),i=t.dpDiv;this._base_gotoToday(e);var o=new Date,r=this._get(t,"timepicker");if(r&&r._defaults.showTimezone&&r.timezone_select){var n=o.getTimezoneOffset(),a=n>0?"-":"+",s=(n=Math.abs(n))%60;n=a+("0"+(n-s)/60).slice(-2)+("0"+s).slice(-2),r._defaults.timezoneIso8609&&(n=n.substring(0,3)+":"+n.substring(3)),r.timezone_select.val(n)}this._setTime(t,o),$(".ui-datepicker-today",i).click()},$.datepicker._disableTimepickerDatepicker=function(e,t,i){var o=this._getInst(e),r=this._get(o,"timepicker");$(e).datepicker("getDate"),r&&(r._defaults.showTimepicker=!1,r._updateDateTime(o))},$.datepicker._enableTimepickerDatepicker=function(e,t,i){var o=this._getInst(e),r=this._get(o,"timepicker");$(e).datepicker("getDate"),r&&(r._defaults.showTimepicker=!0,r._addTimePicker(o),r._updateDateTime(o))},$.datepicker._setTime=function(e,t){var i=this._get(e,"timepicker");if(i){var o=i._defaults,r=t?t.getHours():o.hour,n=t?t.getMinutes():o.minute,a=t?t.getSeconds():o.second,s=t?t.getMilliseconds():o.millisec;(r<o.hourMin||r>o.hourMax||n<o.minuteMin||n>o.minuteMax||a<o.secondMin||a>o.secondMax||s<o.millisecMin||s>o.millisecMax)&&(r=o.hourMin,n=o.minuteMin,a=o.secondMin,s=o.millisecMin),i.hour=r,i.minute=n,i.second=a,i.millisec=s,i.hour_slider&&i.hour_slider.slider("value",r),i.minute_slider&&i.minute_slider.slider("value",n),i.second_slider&&i.second_slider.slider("value",a),i.millisec_slider&&i.millisec_slider.slider("value",s),i._onTimeChange(),i._updateDateTime(e)}},$.datepicker._setTimeDatepicker=function(e,t,i){var o,r=this._getInst(e),n=this._get(r,"timepicker");n&&(this._setDateFromField(r),t&&("string"==typeof t?(n._parseTime(t,i),(o=new Date).setHours(n.hour,n.minute,n.second,n.millisec)):o=new Date(t.getTime()),"Invalid Date"==o.toString()&&(o=void 0),this._setTime(r,o)))},$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker,$.datepicker._setDateDatepicker=function(e,t){var i=this._getInst(e),o=t instanceof Date?new Date(t.getTime()):t;this._updateDatepicker(i),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(e,o,!0)},$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker,$.datepicker._getDateDatepicker=function(e,t){var i=this._getInst(e),o=this._get(i,"timepicker");if(o){this._setDateFromField(i,t);var r=this._getDate(i);return r&&o._parseTime($(e).val(),o.timeOnly)&&r.setHours(o.hour,o.minute,o.second,o.millisec),r}return this._base_getDateDatepicker(e,t)},$.datepicker._base_parseDate=$.datepicker.parseDate,$.datepicker.parseDate=function(e,t,i){var o;try{o=this._base_parseDate(e,t,i)}catch(r){if(!(r.indexOf(":")>=0))throw r;o=this._base_parseDate(e,t.substring(0,t.length-(r.length-r.indexOf(":")-2)),i)}return o},$.datepicker._base_formatDate=$.datepicker._formatDate,$.datepicker._formatDate=function(e,t,i,o){var r=this._get(e,"timepicker");return r?(r._updateDateTime(e),r.$input.val()):this._base_formatDate(e)},$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker,$.datepicker._optionDatepicker=function(e,t,i){var o=this._getInst(e),r=this._get(o,"timepicker");if(r){var n=null,a=null,s=null;"string"==typeof t?"minDate"===t||"minDateTime"===t?n=i:"maxDate"===t||"maxDateTime"===t?a=i:"onSelect"===t&&(s=i):"object"==typeof t&&(t.minDate?n=t.minDate:t.minDateTime?n=t.minDateTime:t.maxDate?a=t.maxDate:t.maxDateTime&&(a=t.maxDateTime)),n?(n=0==n?new Date:new Date(n),r._defaults.minDate=n,r._defaults.minDateTime=n):a?(a=0==a?new Date:new Date(a),r._defaults.maxDate=a,r._defaults.maxDateTime=a):s&&(r._defaults.onSelect=s)}return void 0===i?this._base_optionDatepicker(e,t):this._base_optionDatepicker(e,t,i)},$.timepicker=new Timepicker,$.timepicker.version="1.0.0")}(jQuery),function(e,t,i){var o={beforeShow:c,move:c,change:c,show:c,hide:c,color:!1,flat:!1,showInput:!1,showButtons:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",theme:"sp-light",palette:["fff","000"],selectionPalette:[]},r=[],n=t.browser.msie,a=["<div class='sp-replacer'>","<div class='sp-preview'></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),s=function(){var e="";if(n)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf  biz-actions-bar'>","<a class='sp-cancel biz-btn biz-action-btn' href='#'></a>","<a class='sp-choose biz-btn biz-action-btn' href='#'></a>","</div>","</div>","</div>"].join("")}(),l=function(e,t,i){for(var o=[],r=0;r<e.length;r++){var n=tinycolor(e[r]),a="";tinycolor.equals(t,e[r])&&(a+="sp-thumb-active ");var s="";"transparent"===e[r]?(s=n.toRgbString(),nTitle=e[r],a+="sp-thumb-transparent sp-thumb-light "):(s=nTitle=n.toHexString(),a+=n.toHsl().l<.5?"sp-thumb-dark ":"sp-thumb-light "),o.push('<span title="'+nTitle+'" data-color="'+s+'" style="background-color:'+n.toRgbString()+';" class="'+a+'"></span>')}return"<div class='sp-cf "+i+"'>"+o.join("")+"</div>"};function d(i,d){var c,h,g,f,b,v,y,z=(b=d,v=i,(y=t.extend({},o,b)).callbacks={move:p(y.move,v),change:p(y.change,v),show:p(y.show,v),hide:p(y.hide,v),beforeShow:p(y.beforeShow,v)},y),x=z.flat,C=z.showPaletteOnly,w=z.showPalette||C,P=z.showInitial&&!x,E=z.showInput,$=z.showSelectionPalette,T=z.localStorageKey,_=z.theme,R=z.callbacks,M=(c=Re,h=10,function(){var e=this,t=arguments;g&&clearTimeout(f),!g&&f||(f=setTimeout(function(){f=null,c.apply(e,t)},h))}),S=!1,k=0,V=0,I=0,N=0,D=0,F=0,A=0,O=0,B=0,L=z.palette.slice(0),G=t.isArray(L[0])?L:[L],X=z.selectionPalette.slice(0),q="sp-dragging",H=!!z.cancelResponse&&z.cancelResponse,U=i.ownerDocument,j=U.body,W=t(i),Y=t(s,U).addClass(_),K=Y.find(".sp-color"),J=Y.find(".sp-dragger"),Z=Y.find(".sp-hue"),Q=Y.find(".sp-slider"),ee=Y.find(".sp-input"),te=Y.find(".sp-palette"),ie=Y.find(".sp-initial"),oe=Y.find(".sp-cancel"),re=Y.find(".sp-choose"),ne=W.is("input"),ae=ne&&!x,se=ae?t(a).addClass(_):t([]),le=ae?se:W,de=se.find(".sp-preview"),ce=z.color||ne&&W.val(),ue=!1,pe=z.preferredFormat,me=pe,he=!z.showButtons;function ge(t){$&&(X.push(tinycolor(t).toHexString()),T&&e.localStorage&&(e.localStorage[T]=X.join(",")))}function fe(){var e=Pe(),i=t.map(G,function(t,i){return l(t,e,"sp-palette-row sp-palette-row-"+i)});X&&i.push(l(function(){var e=[],t=X,i={};if(w){for(var o=0;o<G.length;o++)for(var r=0;r<G[o].length;r++)i[n=tinycolor(G[o][r]).toHexString()]=!0;for(o=0;o<t.length;o++){var n=tinycolor(t[o]).toHexString();i.hasOwnProperty(n)||(e.push(t[o]),i[n]=!0)}}return e.reverse().slice(0,z.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection")),te.html(i.join(""))}function be(){if(P){var e=ue,t=Pe();ie.html(l([e,t],t,"sp-palette-row-initial"))}}function ve(){0!==V&&0!==k&&0!==N||Re(),Y.addClass(q)}function ye(){Y.removeClass(q)}function ze(){var e=tinycolor(ee.val());e.ok?we(e):ee.addClass("sp-validation-error")}function xe(){S?Re():!1!==R.beforeShow(Pe())&&(!function(){for(var e=0;e<r.length;e++)r[e]&&r[e].hide()}(),S=!0,t(U).bind("click.spectrum",Ce),t(e).bind("resize.spectrum",M),se.addClass("sp-active"),Y.show(),w&&fe(),Re(),$e(),ue=Pe(),be(),R.show(ue))}function Ce(){S&&!x&&(S=!1,t(U).unbind("click.spectrum",Ce),t(e).unbind("resize.spectrum",M),se.removeClass("sp-active"),Y.hide(),!tinycolor.equals(Pe(),ue)&&(he?_e(!0):we(ue,!0)),R.hide(Pe()))}function we(e,i){if(t(".sp-thumb-active").removeClass("sp-thumb-active"),!tinycolor.equals(e,Pe())){var o=tinycolor(e),r=o.toHsv();F=r.h,A=r.s,O=r.v,B=r.a,$e(),i||(me=pe||o.format)}}function Pe(){return tinycolor.fromRatio({h:F,s:A,v:O,a:B})}function Ee(){$e(),R.move(Pe())}function $e(){ee.removeClass("sp-validation-error"),Te();var e=tinycolor({h:F,s:"1.0",v:"1.0",a:B});K.css("background-color",e.toHexString());var t=Pe(),i=0!==B?t.toHexString():"transparent";de.css("background-color",i),E&&ee.val(t.toString(me)),w&&fe(),be()}function Te(){var e=A*k,t=V-O*V;e=Math.max(-I,Math.min(k-I,e-I)),t=Math.max(-I,Math.min(V-I,t-I)),J.css({top:t,left:e});var i=F*N;Q.css({top:i-D})}function _e(e){var t=Pe();ne&&W.val(t.toString(me)).change();var i=!tinycolor.equals(t,ue);ue=t,ge(t),e&&i&&R.change(t)}function Re(){var e,i,o,r,n,a,s,l,d,c;k=K.width(),V=K.height(),I=J.height(),Z.width(),N=Z.height(),D=Q.height(),x||Y.offset((i=le,o=(e=Y).outerWidth(),r=e.outerHeight(),i.outerWidth(),n=i.outerHeight(),a=e[0].ownerDocument,s=a.documentElement,l=s.clientWidth+t(a).scrollLeft(),d=s.clientHeight+t(a).scrollTop(),(c=i.offset()).top+=n,c.left-=Math.min(c.left,c.left+o>l&&l>o?Math.abs(c.left+o-l):0),c.top-=Math.min(c.top,c.top+r>d&&d>r?Math.abs(r+n-0):0),c)),Te()}function Me(){W.show(),le.unbind("click.spectrum touchstart.spectrum"),Y.remove(),se.remove(),r[Se.id]=null}re.text(z.chooseText),oe.text(z.cancelText),function(){if(n&&Y.find("*:not(input)").attr("unselectable","on"),Y.toggleClass("sp-flat",x),Y.toggleClass("sp-input-disabled",!E),Y.toggleClass("sp-buttons-disabled",!z.showButtons),Y.toggleClass("sp-palette-disabled",!w),Y.toggleClass("sp-palette-only",C),Y.toggleClass("sp-initial-disabled",!P),Y.addClass(z.className),ae&&W.hide().after(se),x?W.after(Y).hide():t(j).append(Y.hide()),T&&e.localStorage)try{X=e.localStorage[T].split(",")}catch(e){}function i(e){return e.data&&e.data.ignore?(we(t(this).data("color")),Ee()):(we(t(this).data("color")),_e(!0),Ee(),Ce()),!1}le.bind("click.spectrum touchstart.spectrum",function(e){S?Ce():xe(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),Y.click(u),ee.change(ze),ee.bind("paste",function(){setTimeout(ze,1)}),ee.keydown(function(e){13==e.keyCode&&ze()}),oe.bind("click",function(e){e.stopPropagation(),e.preventDefault(),H?(x=!1,H.apply(this,[{instance:this,destroy:Me,hide:Ce}])):Ce()}),re.bind("click",function(e){e.stopPropagation(),e.preventDefault(),ee.hasClass("sp-validation-error")||(_e(!0),Ce()),oe.trigger("click")}),m(Z,function(e,t){F=t/N,Ee()},ve,ye),m(K,function(e,t){A=e/k,O=(V-t)/V,Ee()},ve,ye),ce?(we(ce),$e(),me=pe||tinycolor(ce).format,ge(ce)):$e(),x&&xe();var o=n?"mousedown.spectrum":"click.spectrum touchstart.spectrum";te.delegate("span",o,i),ie.delegate("span::nth-child(1)",o,{ignore:!0},i)}();var Se={show:xe,hide:Ce,set:function(e){we(e),_e()},get:Pe,destroy:Me,container:Y};return Se.id=r.push(Se)-1,Se}function c(){}function u(e){e.stopPropagation()}function p(e,t){var i=Array.prototype.slice,o=i.call(arguments,2);return function(){return e.apply(t,o.concat(i.call(arguments)))}}function m(i,o,r,n){o=o||function(){},r=r||function(){},n=n||function(){};var a=i.ownerDocument||document,s=!1,l={},d=0,c=0,u=t.browser.msie,p="ontouchstart"in e,m={};function h(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function g(e){if(s){if(u&&!(document.documentMode>=9)&&!e.button)return f();var t=e.originalEvent.touches,r=t?t[0].pageX:e.pageX,n=t?t[0].pageY:e.pageY,a=Math.max(0,Math.min(r-l.left,c)),m=Math.max(0,Math.min(n-l.top,d));p&&h(e),o.apply(i,[a,m])}}function f(){s&&(t(a).unbind(m),t(a.body).removeClass("sp-dragging"),n.apply(i,arguments)),s=!1}m.selectstart=h,m.dragstart=h,m[p?"touchmove":"mousemove"]=g,m[p?"touchend":"mouseup"]=f,t(i).bind(p?"touchstart":"mousedown",function(e){var o=e.which?3==e.which:2==e.button;e.originalEvent.touches,o||s||!1!==r.apply(i,arguments)&&(s=!0,d=t(i).height(),c=t(i).width(),l=t(i).offset(),t(a).bind(m),t(a.body).addClass("sp-dragging"),p||g(e),h(e))})}var h="spectrum.id";t.fn.spectrum=function(e,i){return"string"==typeof e?"get"==e?r[this.eq(0).data(h)].get():"container"==e?r[t(this).data(h)].container:this.each(function(){var o=r[t(this).data(h)];o&&("show"==e&&o.show(),"hide"==e&&o.hide(),"set"==e&&o.set(i),"destroy"==e&&(o.destroy(),t(this).removeData(h)))}):this.spectrum("destroy").each(function(){var i=d(this,e);t(this).data(h,i.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=m,t.fn.spectrum.processNativeColorInputs=function(){"color"===t("<input type='color' />")[0].type||t("input[type=color]").spectrum({preferredFormat:"hex6"})},t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}(this,jQuery),function(e){var t=/^[\s,#]+/,i=/\s+$/,o=0,r=Math,n=r.round,a=r.min,s=r.max,l=r.random,d=e.parseFloat;function c(e,l){if("object"==typeof e&&e.hasOwnProperty("_tc_id"))return e;var c=function(e){var o={r:0,g:0,b:0},l=1,d=!1,c=!1;"string"==typeof e&&(e=function(e){e=e.replace(t,"").replace(i,"").toLowerCase();var o,r=!1;if(h[e])e=h[e],r=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0};if(o=C.rgb.exec(e))return{r:o[1],g:o[2],b:o[3]};if(o=C.rgba.exec(e))return{r:o[1],g:o[2],b:o[3],a:o[4]};if(o=C.hsl.exec(e))return{h:o[1],s:o[2],l:o[3]};if(o=C.hsla.exec(e))return{h:o[1],s:o[2],l:o[3],a:o[4]};if(o=C.hsv.exec(e))return{h:o[1],s:o[2],v:o[3]};if(o=C.hex6.exec(e))return{r:v(o[1]),g:v(o[2]),b:v(o[3]),format:r?"name":"hex"};if(o=C.hex3.exec(e))return{r:v(o[1]+""+o[1]),g:v(o[2]+""+o[2]),b:v(o[3]+""+o[3]),format:r?"name":"hex"};return!1}(e));if("object"==typeof e){if(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b"))u=e.r,p=e.g,m=e.b,o={r:255*f(u,255),g:255*f(p,255),b:255*f(m,255)},d=!0,c="rgb";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v"))o=function(e,t,i){e=6*f(e,360),t=f(t,100),i=f(i,100);var o=r.floor(e),n=e-o,a=i*(1-t),s=i*(1-n*t),l=i*(1-(1-n)*t),d=o%6;return{r:255*[i,s,a,a,l,i][d],g:255*[l,i,i,s,a,a][d],b:255*[a,a,l,i,i,s][d]}}(e.h,e.s,e.v),d=!0,c="hsv";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")){var o=function(e,t,i){var o,r,n;function a(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(e=f(e,360),t=f(t,100),i=f(i,100),0==t)o=r=n=i;else{var s=i<.5?i*(1+t):i+t-i*t,l=2*i-s;o=a(l,s,e+1/3),r=a(l,s,e),n=a(l,s,e-1/3)}return{r:255*o,g:255*r,b:255*n}}(e.h,e.s,e.l);d=!0,c="hsl"}e.hasOwnProperty("a")&&(l=e.a)}var u,p,m;o.r=a(255,s(o.r,0)),o.g=a(255,s(o.g,0)),o.b=a(255,s(o.b,0)),o.r<1&&(o.r=n(o.r));o.g<1&&(o.g=n(o.g));o.b<1&&(o.b=n(o.b));return{ok:d,format:e&&e.format||c,r:o.r,g:o.g,b:o.b,a:l}}(e),b=c.r,y=c.g,z=c.b,x=d(c.a),w=c.format;return{ok:c.ok,format:w,_tc_id:o++,alpha:x,toHsv:function(){var e=p(b,y,z);return{h:e.h,s:e.s,v:e.v,a:x}},toHsvString:function(){var e=p(b,y,z),t=n(360*e.h),i=n(100*e.s),o=n(100*e.v);return 1==x?"hsv("+t+", "+i+"%, "+o+"%)":"hsva("+t+", "+i+"%, "+o+"%, "+x+")"},toHsl:function(){var e=u(b,y,z);return{h:e.h,s:e.s,l:e.l,a:x}},toHslString:function(){var e=u(b,y,z),t=n(360*e.h),i=n(100*e.s),o=n(100*e.l);return 1==x?"hsl("+t+", "+i+"%, "+o+"%)":"hsla("+t+", "+i+"%, "+o+"%, "+x+")"},toHex:function(){return m(b,y,z)},toHexString:function(e){return"#"+m(b,y,z,e)},toRgb:function(){return{r:n(b),g:n(y),b:n(z),a:x}},toRgbString:function(){return 1==x?"rgb("+n(b)+", "+n(y)+", "+n(z)+")":"rgba("+n(b)+", "+n(y)+", "+n(z)+", "+x+")"},toName:function(){return g[m(b,y,z)]||!1},toFilter:function(){var e=m(b,y,z),t=Math.round(255*d(x)).toString(16);return"progid:DXImageTransform.Microsoft.gradient(startColorstr=#"+t+e+",endColorstr=#"+t+e+")"},toString:function(e){var t=!1;return"rgb"===(e=e||this.format)&&(t=this.toRgbString()),"hex"===e&&(t=this.toHexString()),"hex6"===e&&(t=this.toHexString(!0)),"name"===e&&(t=this.toName()),"hsl"===e&&(t=this.toHslString()),"hsv"===e&&(t=this.toHsvString()),t||this.toHexString()}}}function u(e,t,i){e=f(e,255),t=f(t,255),i=f(i,255);var o,r,n=s(e,t,i),l=a(e,t,i),d=(n+l)/2;if(n==l)o=r=0;else{var c=n-l;switch(r=d>.5?c/(2-n-l):c/(n+l),n){case e:o=(t-i)/c+(t<i?6:0);break;case t:o=(i-e)/c+2;break;case i:o=(e-t)/c+4}o/=6}return{h:o,s:r,l:d}}function p(e,t,i){e=f(e,255),t=f(t,255),i=f(i,255);var o,r,n=s(e,t,i),l=a(e,t,i),d=n,c=n-l;if(r=0==n?0:c/n,n==l)o=0;else{switch(n){case e:o=(t-i)/c+(t<i?6:0);break;case t:o=(i-e)/c+2;break;case i:o=(e-t)/c+4}o/=6}return{h:o,s:r,v:d}}function m(e,t,i,o){function r(e){return 1==e.length?"0"+e:""+e}var a=[r(n(e).toString(16)),r(n(t).toString(16)),r(n(i).toString(16))];return o||a[0].charAt(0)!=a[0].charAt(1)||a[1].charAt(0)!=a[1].charAt(1)||a[2].charAt(0)!=a[2].charAt(1)?a.join(""):a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)}c.fromRatio=function(e){if("object"==typeof e)for(var t in e)1===e[t]&&(e[t]="1.0");return c(e)},c.equals=function(e,t){return!(!e||!t)&&(c.validateTransparentColor(e,t)?c(e).toRgbString()===c(t).toRgbString():c(e).toHex()==c(t).toHex())},c.random=function(){return c.fromRatio({r:l(),g:l(),b:l()})},c.validateTransparentColor=function(e,t){return"transparent"===e||"transparent"===t||0===e.alpha||0===t.alpha||"rgba(0, 0, 0, 0)"===e||"rgba(0, 0, 0, 0)"===t},c.desaturate=function(e,t){var i=c(e).toHsl();return i.s-=(t||10)/100,i.s=b(i.s),c(i)},c.saturate=function(e,t){var i=c(e).toHsl();return i.s+=(t||10)/100,i.s=b(i.s),c(i)},c.greyscale=function(e){return c.desaturate(e,100)},c.lighten=function(e,t){var i=c(e).toHsl();return i.l+=(t||10)/100,i.l=b(i.l),c(i)},c.darken=function(e,t){var i=c(e).toHsl();return i.l-=(t||10)/100,i.l=b(i.l),c(i)},c.complement=function(e){var t=c(e).toHsl();return t.h=(t.h+.5)%1,c(t)},c.triad=function(e){var t=c(e).toHsl(),i=360*t.h;return[c(e),c({h:(i+120)%360,s:t.s,l:t.l}),c({h:(i+240)%360,s:t.s,l:t.l})]},c.tetrad=function(e){var t=c(e).toHsl(),i=360*t.h;return[c(e),c({h:(i+90)%360,s:t.s,l:t.l}),c({h:(i+180)%360,s:t.s,l:t.l}),c({h:(i+270)%360,s:t.s,l:t.l})]},c.splitcomplement=function(e){var t=c(e).toHsl(),i=360*t.h;return[c(e),c({h:(i+72)%360,s:t.s,l:t.l}),c({h:(i+216)%360,s:t.s,l:t.l})]},c.analogous=function(e,t,i){t=t||6,i=i||30;var o=c(e).toHsl(),r=360/i,n=[c(e)];for(o.h*=360,o.h=(o.h-(r*t>>1)+720)%360;--t;)o.h=(o.h+r)%360,n.push(c(o));return n},c.monochromatic=function(e,t){t=t||6;for(var i=c(e).toHsv(),o=i.h,r=i.s,n=i.v,a=[],s=1/t;t--;)a.push(c({h:o,s:r,v:n})),n=(n+s)%1;return a},c.readable=function(e,t){var i=c(e).toRgb(),o=c(t).toRgb();return(o.r-i.r)*(o.r-i.r)+(o.g-i.g)*(o.g-i.g)+(o.b-i.b)*(o.b-i.b)>10404};var h=c.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},g=c.hexNames=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}(h);function f(e,t){var i;"string"==typeof(i=e)&&-1!=i.indexOf(".")&&1===d(i)&&(e="100%");var o,n="string"==typeof(o=e)&&-1!=o.indexOf("%");return e=a(t,s(0,d(e))),n&&(e*=t/100),r.abs(e-t)<1e-6?1:e>=1?e%t/d(t):e}function b(e){return a(1,s(0,e))}function v(e){return parseInt(e,16)}var y,z,x,C=(z="[\\s|\\(]+("+(y="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+y+")[,|\\s]+("+y+")\\s*\\)?",x="[\\s|\\(]+("+y+")[,|\\s]+("+y+")[,|\\s]+("+y+")[,|\\s]+("+y+")\\s*\\)?",{rgb:new RegExp("rgb"+z),rgba:new RegExp("rgba"+x),hsl:new RegExp("hsl"+z),hsla:new RegExp("hsla"+x),hsv:new RegExp("hsv"+z),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});e.tinycolor=c}(this),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";var t=e.scrollTo=function(t,i,o){return e(window).scrollTo(t,i,o)};function i(t){return!t.nodeName||-1!==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])}function o(t){return e.isFunction(t)||e.isPlainObject(t)?t:{top:t,left:t}}return t.defaults={axis:"xy",duration:0,limit:!0},e.fn.scrollTo=function(r,n,a){"object"==typeof n&&(a=n,n=0),"function"==typeof a&&(a={onAfter:a}),"max"===r&&(r=9e9),a=e.extend({},t.defaults,a),n=n||a.duration;var s=a.queue&&a.axis.length>1;return s&&(n/=2),a.offset=o(a.offset),a.over=o(a.over),this.each(function(){if(null!==r){var l,d=i(this),c=d?this.contentWindow||window:this,u=e(c),p=r,m={};switch(typeof p){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(p)){p=o(p);break}p=d?e(p):e(p,c);case"object":if(0===p.length)return;(p.is||p.style)&&(l=(p=e(p)).offset())}var h=e.isFunction(a.offset)&&a.offset(c,p)||a.offset;e.each(a.axis.split(""),function(e,i){var o="x"===i?"Left":"Top",r=o.toLowerCase(),n="scroll"+o,f=u[n](),b=t.max(c,i);if(l)m[n]=l[r]+(d?0:f-u.offset()[r]),a.margin&&(m[n]-=parseInt(p.css("margin"+o),10)||0,m[n]-=parseInt(p.css("border"+o+"Width"),10)||0),m[n]+=h[r]||0,a.over[r]&&(m[n]+=p["x"===i?"width":"height"]()*a.over[r]);else{var v=p[r];m[n]=v.slice&&"%"===v.slice(-1)?parseFloat(v)/100*b:v}a.limit&&/^\d+$/.test(m[n])&&(m[n]=m[n]<=0?0:Math.min(m[n],b)),!e&&a.axis.length>1&&(f===m[n]?m={}:s&&(g(a.onAfterFirst),m={}))}),g(a.onAfter)}function g(t){var i=e.extend({},a,{queue:!0,duration:n,complete:t&&function(){t.call(c,p,a)}});u.animate(m,i)}})},t.max=function(t,o){var r="x"===o?"Width":"Height",n="scroll"+r;if(!i(t))return t[n]-e(t)[r.toLowerCase()]();var a="client"+r,s=t.ownerDocument||t.document,l=s.documentElement,d=s.body;return Math.max(l[n],d[n])-Math.min(l[a],d[a])},e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={get:function(t){return e(t.elem)[t.prop]()},set:function(t){var i=this.get(t);if(t.options.interrupt&&t._last&&t._last!==i)return e(t.elem).stop();var o=Math.round(t.now);i!==o&&(e(t.elem)[t.prop](o),t._last=this.get(t))}},t}),function(e){function t(t,i,o){var r;this.element=e(t),this.options=e.extend({pickerClass:"wpd",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayShort:2,monthShort:3,startDay:0,timePicker:!1,timePickerOnly:!1,yearPicker:!0,militaryTime:!1,yearsPerPage:20,format:"d-m-Y",allowEmpty:!1,inputOutputFormat:"U",animationDuration:400,useFadeInOut:!e.browser.msie,startView:"month",positionOffset:{x:0,y:0},minDate:null,maxDate:null,debug:!1,toggleElements:null,onShow:e.noop,onClose:e.noop,onSelect:e.noop},o),null!=this.options.toggleElements&&this.options.toggleElements.jquery&&(this.toggler=this.options.toggleElements.eq(i),document.keydown(e.proxy(function(e){9==e.which&&this.close(null,!0)},this))),this.formatMinMaxDates(),e(document).mousedown(e.proxy(this.close,this)),this.options.timePickerOnly&&(this.options.timePicker=!0,this.options.startView="time"),(r=this.element.val())?r=this.format(new Date(this.unformat(r,this.options.inputOutputFormat)),this.options.format):this.options.allowEmpty?r="":(r=this.format(new Date,this.options.format),this.element.val(this.format(new Date,this.options.inputOutputFormat))),this.display=this.element.css("display"),this.clone=this.element.css("display",this.options.debug?this.display:"none").data("will_pickdate",!0).clone(!0).data("will_pickdate",!0).removeAttr("name").attr("id",this.element.attr("id")+"_display").css("display",this.display).val(r),this.element.before(this.clone),this.toggler?(this.toggler.css("cursor","pointer").click(e.proxy(function(e){this.onFocus(this.element,this.clone)},this)),this.clone.blur(e.proxy(function(){this.element.val(this.clone.val())},this))):this.clone.bind({keydown:e.proxy(function(t){!this.options.allowEmpty||46!=t.which&&8!=t.which?9==t.which||27==t.which?this.close(null,!0):t.preventDefault():(this.element.val(""),e(t.target).val(""),this.close(null,!0))},this),focus:e.proxy(function(e){this.onFocus(this.element,this.clone)},this)})}e.fn.will_pickdate=function(i){return this.each(function(o){e.data(this,"will_pickdate")||new t(this,o,i)})},t.prototype={onFocus:function(e,t){var i;(i=e.val())?i=this.unformat(i,this.options.inputOutputFormat).valueOf():(i=new Date,this.options.maxDate&&i.valueOf()>this.options.maxDate.valueOf()&&(i=new Date(this.options.maxDate.valueOf())),this.options.minDate&&i.valueOf()<this.options.minDate.valueOf()&&(i=new Date(this.options.minDate.valueOf()))),this.input=e,this.visual=t,this.show(i)},dateToObject:function(e){return{year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()}},dateFromObject:function(t){var i,o=new Date;return o.setDate(1),e.each(["year","month","day","hours","minutes","seconds"],e.proxy(function(e,r){if((i=t[r])||0===i)switch(r){case"day":o.setDate(i);break;case"month":o.setMonth(i);break;case"year":o.setFullYear(i);break;case"hours":o.setHours(i);break;case"minutes":o.setMinutes(i);break;case"seconds":o.setSeconds(i)}},this)),o},pickerPosition:function(){var t={left:this.visual.offset().left+this.options.positionOffset.x,top:this.visual.offset().top+this.options.positionOffset.y},i=e(window).height(),o=e(window).scrollTop(),r=this.picker.outerHeight(),n=Math.abs(i-t.top+this.visual.outerHeight())>r;return t.top+o>r||n?n?t.top+=this.visual.outerHeight():t.top-=r:(t.top=i/2-r/2,i+o<r&&console.warn("will_pickdate: Not enough room to display date picker.")),t},show:function(t){this.formatMinMaxDates(),this.working_date=t?new Date(t):new Date,this.today=new Date,this.choice=this.dateToObject(this.working_date),this.mode="time"!=this.options.startView||this.options.timePicker?this.options.startView:"month",this.render(),this.picker.css(this.pickerPosition()),e.isFunction(this.options.onShow)&&this.options.onShow()},render:function(e){if(this.picker){var t=this.oldContents;this.oldContents=this.newContents,this.newContents=t,this.newContents.empty()}else this.constructPicker();var i=new Date(this.working_date.getTime());switch(this.limit={right:!1,left:!1},this.mode){case"decades":this.renderDecades();break;case"year":this.renderYear();break;case"time":this.renderTime(),this.limit={right:!0,left:!0};break;default:this.renderMonth()}this.picker.find(".previous").toggleClass("disabled",this.limit.left),this.picker.find(".next").toggleClass("disabled",this.limit.right),this.picker.find(".title").css("cursor",this.allowZoomOut()?"pointer":"default"),this.working_date=i,this.options.useFadeInOut&&this.picker.fadeIn(this.options.animationDuration),e&&this.fx(e)},fx:function(e){"right"==e?(this.oldContents.css("left",0).show(),this.newContents.css("left",this.bodyWidth).show(),this.slider.css("left",0).animate({left:-this.bodyWidth})):"left"==e?(this.oldContents.css("left",this.bodyWidth).show(),this.newContents.css("left",0).show(),this.slider.css("left",-this.bodyWidth).animate({left:0})):"fade"==e&&(this.slider.css("left",0),this.oldContents.css("left",0).fadeOut(this.options.animationDuration>>1),this.newContents.css("left",0).hide().fadeIn(this.options.animationDuration))},constructPicker:function(){var t,i,o;e(document.body).append(this.picker=e('<div class="'+this.options.pickerClass+'" />')),this.options.useFadeInOut&&this.picker.hide(),this.picker.append(t=e('<div class="header"/>')),t.append(i=e('<div class="title"/>').click(e.proxy(this.zoomOut,this))),t.append(e('<div class="previous">&larr;</div>').click(e.proxy(this.previous,this))),t.append(e('<div class="next">&rarr;</div>').click(e.proxy(this.next,this))),t.append(e('<div class="closeButton">x</div>').click(e.proxy(this.close,this))),i.append(e('<span class="titleText"/>')),this.picker.append(o=e('<div class="body"/>')),this.bodyHeight=o.outerHeight(),this.bodyWidth=o.outerWidth(),o.append(this.slider=e('<div style="position:absolute;top:0;left:0;width:'+2*this.bodyWidth+"px;height:"+2*this.bodyHeight+'px" />')),this.slider.append(this.oldContents=e('<div style="position:absolute;top:0;left:'+this.bodyWidth+"px;width:"+this.bodyWidth+"px;height:"+this.bodyHeight+'px" />')),this.slider.append(this.newContents=e('<div style="position:absolute;top:0;left:0;width:'+this.bodyWidth+"px;height:"+this.bodyHeight+'px" />'))},renderDecades:function(){for(;this.working_date.getFullYear()%this.options.yearsPerPage>0;)this.working_date.setFullYear(this.working_date.getFullYear()-1);this.renderTitle(this.working_date.getFullYear()+"-"+(this.working_date.getFullYear()+this.options.yearsPerPage-1));var t,i,o,r,n=!1;for(this.newContents.append(r=e('<div class="years"/>')),this.options.minDate&&this.working_date.getFullYear()<=this.options.minDate.getFullYear()&&(this.limit.left=!0),t=0;t<this.options.yearsPerPage;t++)i=this.working_date.getFullYear(),r.append(o=e('<div class="year year'+t+(i==this.today.getFullYear()?" today":"")+(i==this.choice.year?" selected":"")+'">'+i+"</>")),this.limited("year")?(o.addClass("unavailable"),n?this.limit.right=!0:this.limit.left=!0):(n=!0,o.click({year:i},e.proxy(function(e){this.working_date.setFullYear(e.data.year),this.mode="year",this.render("fade")},this))),this.working_date.setFullYear(this.working_date.getFullYear()+1);(!n||this.options.maxDate&&this.working_date.getFullYear()>=this.options.maxDate.getFullYear())&&(this.limit.right=!0)},renderYear:function(){var t,i,o,r=this.today.getMonth(),n=this.working_date.getFullYear()==this.today.getFullYear(),a=this.working_date.getFullYear()==this.choice.year,s=!1;for(this.renderTitle(this.working_date.getFullYear()),this.working_date.setMonth(0),this.newContents.append(t=e('<div class="months"/>')),i=0;i<=11;i++)t.append(o=e('<div class="month month'+(i+1)+(i==r&&n?" today":"")+(i==this.choice.month&&a?" selected":"")+'">'+(this.options.monthShort?this.options.months[i].substring(0,this.options.monthShort):this.options.months[i])+"</div>")),this.limited("month")?(o.addClass("unavailable"),s?this.limit.right=!0:this.limit.left=!0):(s=!0,o.click({month:i},e.proxy(function(e){this.working_date.setDate(1),this.working_date.setMonth(e.data.month),this.mode="month",this.render("fade")},this))),this.working_date.setMonth(i);s||(this.limit.right=!0)},renderTime:function(){var t;this.newContents.append(t=e('<div class="time"/>')),this.options.timePickerOnly?this.renderTitle("Select a time"):this.renderTitle(this.format(this.working_date,"j M, Y")),t.append(e('<input type="text" class="hour"'+(this.options.militaryTime?' style="left:30px"':"")+' maxlength="2" value="'+this.leadZero(this.options.militaryTime?this.working_date.getHours():this.working_date.getHours()>12?this.working_date.getHours()-12:this.working_date.getHours())+'"/>').mousewheel(e.proxy(function(t,i,o,r){t.preventDefault(),t.stopPropagation();var n=e(t.target),a=parseInt(n.val(),10);if(n.focus(),this.options.militaryTime)r>0?a=a<23?a+1:0:r<0&&(a=a>0?a-1:23);else{var s=this.picker.find(".ampm");r>0?11==a?(a=12,s.val("AM"==s.val()?"PM":"AM")):a<12?a++:a=1:r<0&&(12==a?(a=11,s.val("AM"==s.val()?"PM":"AM")):a>1?a--:a=12)}n.val(this.leadZero(a))},this))),t.append(e('<input type="text" class="minutes"'+(this.options.militaryTime?' style="left:110px"':"")+' maxlength="2" value="'+this.leadZero(this.working_date.getMinutes())+'"/>').mousewheel(e.proxy(function(t,i,o,r){t.preventDefault(),t.stopPropagation();var n=e(t.target),a=parseInt(n.val(),10);n.focus(),r>0?a=a<59?a+1:0:r<0&&(a=a>0?a-1:59),n.val(this.leadZero(a))},this))),t.append(e('<div class="separator"'+(this.options.militaryTime?' style="left:91px"':"")+">:</div>")),this.options.militaryTime||t.append(e('<input type="text" class="ampm" maxlength="2" value="'+(this.working_date.getHours()>=12?"PM":"AM")+'"/>').mousewheel(e.proxy(function(t,i,o,r){t.preventDefault(),t.stopPropagation();var n=e(t.target);n.focus(),(r>0||r<0)&&n.val("AM"==n.val()?"PM":"AM")}))),t.append(e('<input type="submit" value="OK" class="ok"/>').click(e.proxy(function(t){t.stopPropagation();var i=parseInt(this.picker.find(".hour").val(),10);this.options.militaryTime||(i=12===i?0:i),this.select(e.extend(this.dateToObject(this.working_date),{hours:i+(this.options.militaryTime||"PM"!=this.picker.find(".ampm").val()?0:12),minutes:parseInt(this.picker.find(".minutes").val(),10)}))},this)))},renderMonth:function(){var t,i,o,r,n,a=this.working_date.getMonth(),s=e('<div class="days"/>'),l=e('<div class="titles"/>'),d=!1,c=this.today.toDateString(),u=this.dateFromObject(this.choice).toDateString();for(this.renderTitle(this.options.months[a]+" "+this.working_date.getFullYear()),this.working_date.setDate(1);this.working_date.getDay()!=this.options.startDay;)this.working_date.setDate(this.working_date.getDate()-1);for(this.newContents.append(s.append(l)),t=this.options.startDay;t<this.options.startDay+7;t++)l.append(e('<div class="title day day'+t%7+'">'+this.options.days[t%7].substring(0,this.options.dayShort)+"</div>"));for(i=0;i<42;i++)o=["day","day"+this.working_date.getDay()],this.working_date.toDateString()==c&&o.push("today"),this.working_date.toDateString()==u&&o.push("selected"),this.working_date.getMonth()!=a&&o.push("otherMonth"),i%7==0&&s.append(n=e('<div class="week week'+Math.floor(i/7)+'"/>')),n.append(r=e('<div class="'+o.join(" ")+'">'+this.working_date.getDate()+"</div>")),this.limited("date")?(r.addClass("unavailable"),d?this.limit.right=!0:this.working_date.getMonth()==a&&(this.limit.left=!0)):(d=!0,r.click({day:this.working_date.getDate(),month:this.working_date.getMonth(),year:this.working_date.getFullYear()},e.proxy(function(e){this.options.timePicker?(this.working_date.setDate(e.data.day),this.working_date.setMonth(e.data.month),this.mode="time",this.render("fade")):this.select(e.data)},this))),this.working_date.setDate(this.working_date.getDate()+1);d||(this.limit.right=!0)},renderTitle:function(e){this.allowZoomOut()?this.picker.find(".title").removeClass("disabled"):this.picker.find(".title").addClass("disabled"),this.picker.find(".titleText").text(e)},limited:function(e){var t=!!this.options.minDate,i=!!this.options.maxDate;if(!t&&!i)return!1;switch(e){case"year":return t&&this.working_date.getFullYear()<this.options.minDate.getFullYear()||i&&this.working_date.getFullYear()>this.options.maxDate.getFullYear();case"month":var o=parseInt(""+this.working_date.getFullYear()+this.leadZero(this.working_date.getMonth()),10);return t&&o<parseInt(""+this.options.minDate.getFullYear()+this.leadZero(this.options.minDate.getMonth()),10)||i&&o>parseInt(""+this.options.maxDate.getFullYear()+this.leadZero(this.options.maxDate.getMonth()),10);case"date":return t&&this.working_date<this.options.minDate||i&&this.working_date>this.options.maxDate}},allowZoomOut:function(){return("time"!=this.mode||!this.options.timePickerOnly)&&("decades"!=this.mode&&!("year"==this.mode&&!this.options.yearPicker))},zoomOut:function(){if(this.allowZoomOut()){switch(this.mode){case"year":this.mode="decades";break;case"time":this.mode="month";break;default:this.mode="year"}this.render("fade")}},previous:function(){switch(this.mode){case"decades":this.working_date.setFullYear(this.working_date.getFullYear()-this.options.yearsPerPage);break;case"year":this.working_date.setFullYear(this.working_date.getFullYear()-1);break;case"month":this.working_date.setMonth(this.working_date.getMonth()-1)}"time"!=this.mode&&this.render("left")},next:function(){switch(this.mode){case"decades":this.working_date.setFullYear(this.working_date.getFullYear()+this.options.yearsPerPage);break;case"year":this.working_date.setFullYear(this.working_date.getFullYear()+1);break;case"month":this.working_date.setMonth(this.working_date.getMonth()+1)}"time"!=this.mode&&this.render("right")},close:function(t,i){this.picker&&!this.closing&&(i||t&&t.target!=this.picker&&0==this.picker.has(t.target).size()&&t.target!=this.visual)&&(this.element.blur(),this.options.useFadeInOut?(this.closing=!0,this.picker.fadeOut(this.options.animationDuration>>1,e.proxy(this.destroy,this))):this.destroy())},destroy:function(){this.picker.remove(),this.picker=null,this.closing=!1,e.isFunction(this.options.onClose)&&this.options.onClose()},select:function(t){this.working_date=this.dateFromObject(e.extend(this.choice,t)),this.input.val(this.format(this.working_date,this.options.inputOutputFormat)).change(),this.visual.val(this.format(this.working_date,this.options.format)),e.isFunction(this.options.onSelect)&&this.options.onSelect(this.working_date),this.close(null,!0)},formatMinMaxDates:function(){this.options.minDate&&this.options.minDate.format&&(this.options.minDate=this.unformat(this.options.minDate.date,this.options.minDate.format)),this.options.maxDate&&this.options.maxDate.format&&(this.options.maxDate=this.unformat(this.options.maxDate.date,this.options.maxDate.format),this.options.maxDate.setHours(23),this.options.maxDate.setMinutes(59),this.options.maxDate.setSeconds(59))},leadZero:function(e){return e<10?"0"+e:e},format:function(e,t){for(var i="",o=e.getHours(),r=e.getMonth(),n=0;n<t.length;n++)switch(t.charAt(n)){case"\\":n++,i+=t.charAt(n);break;case"y":i+=(100+e.getYear()+"").substring(1);break;case"Y":i+=e.getFullYear();break;case"m":i+=this.leadZero(r+1);break;case"n":i+=r+1;break;case"M":i+=this.options.months[r].substring(0,this.options.monthShort);break;case"F":i+=this.options.months[r];break;case"d":i+=this.leadZero(e.getDate());break;case"j":i+=e.getDate();break;case"D":i+=this.options.days[e.getDay()].substring(0,this.options.dayShort);break;case"l":i+=this.options.days[e.getDay()];break;case"G":i+=o;break;case"H":i+=this.leadZero(o);break;case"g":i+=o%12?o%12:12;break;case"h":i+=this.leadZero(o%12?o%12:12);break;case"a":i+=o>11?"pm":"am";break;case"A":i+=o>11?"PM":"AM";break;case"i":i+=this.leadZero(e.getMinutes());break;case"s":i+=this.leadZero(e.getSeconds());break;case"U":i+=Math.floor(e.valueOf()/1e3);break;default:i+=t.charAt(n)}return i},unformat:function(e,t){var i,o,n,a=new Date,s={};e=e.toString();for(var l=0;l<t.length;l++){switch(i=t.charAt(l)){case"\\":r=null,l++;break;case"y":r="[0-9]{2}";break;case"Y":r="[0-9]{4}";break;case"m":r="0[1-9]|1[012]";break;case"n":r="[1-9]|1[012]";break;case"M":r="[A-Za-z]{"+this.options.monthShort+"}";break;case"F":r="[A-Za-z]+";break;case"d":r="0[1-9]|[12][0-9]|3[01]";break;case"j":r="[1-9]|[12][0-9]|3[01]";break;case"D":r="[A-Za-z]{"+this.options.dayShort+"}";break;case"l":r="[A-Za-z]+";break;case"G":case"H":case"g":case"h":r="[0-9]{1,2}";break;case"a":r="(am|pm)";break;case"A":r="(AM|PM)";break;case"i":case"s":r="[012345][0-9]";break;case"U":r="-?[0-9]+$";break;default:r=null}if(r){if(!(o=e.match("^"+r)))return this.options.debug&&alert("Fatal Error in will_pickdate\n\nUnexpected format at: '"+e+"' expected format character '"+i+"' (pattern '"+r+"')"),a;s[i]=o[0],e=e.substring(s[i].length)}else e=e.substring(1)}for(i in s)switch(n=s[i],i){case"y":a.setFullYear(n<30?2e3+parseInt(n,10):1900+parseInt(n,10));break;case"Y":a.setFullYear(n);break;case"m":case"n":a.setMonth(n-1);break;case"M":n=this.options.months.filter(function(e){return this.substring(0,this.options.monthShort)==n})[0];case"F":a.setMonth(options.months.indexOf(n));break;case"d":case"j":a.setDate(n);break;case"G":case"H":a.setHours(n);break;case"g":case"h":"pm"==s.a||"PM"==s.A?a.setHours(12==n?0:parseInt(n,10)+12):a.setHours(n);break;case"i":a.setMinutes(n);break;case"s":a.setSeconds(n);break;case"U":a=new Date(1e3*parseInt(n,10))}return a}}}(jQuery),function(e){var t=e.makeArray,i=e.isArray,o=e.isFunction,r=e.extend,n=e.String,a=e.each,s="prototype",l="constructor",d=Array[s].slice,c=function(t,i,r,n){return n?(p=n,m=i,h=r,(g=(u=t).delegate&&u.undelegate?u:e(o(u)?[u]:u)).delegate(p,m,h),function(){g.undelegate(p,m,h),g=u=m=h=p=null}):(s=i,l=r,c=(a=t).bind&&a.unbind?a:e(o(a)?[a]:a),0===s.indexOf(">")&&(s=s.substr(1),d=function(e){e.target===a&&l.apply(this,arguments)}),c.bind(s,d||l),function(){c.unbind(s,d||l),a=s=l=d=null});var a,s,l,d,c,u,p,m,h,g},u=function(t,i){var o="string"==typeof i?t[i]:i;return function(){return t.called=i,o.apply(t,[this.nodeName?e(this):this].concat(d.call(arguments,0)))}},p=/\./g,m=/_?controllers?/gi,h=function(e){return n.underscore(e.replace("jQuery.","").replace(p,"_").replace(m,""))},g=/[^\w]/,f=/\{([^\}]+)\}/g,b=/^(?:(.*?)\s)?([\w\.\:>]+)$/,v=function(t,i){return e.data(t,"controllers",i)};e.Class("jQuery.Controller",{setup:function(){if(this._super.apply(this,arguments),this.shortName&&"jQuery.Controller"!=this.fullName){this._fullName=h(this.fullName),this._shortName=h(this.shortName);var i,r=this,n=this.pluginName||this._fullName;for(i in e.fn[n]||(e.fn[n]=function(e){var i=t(arguments),a="string"==typeof e&&o(r[s][e]),l=i[0];return this.each(function(){var e=v(this),t=e&&e[n];t?a?t[l].apply(t,i.slice(1)):t.update.apply(t,i):r.newInstance.apply(r,[this].concat(i))})}),this.actions={},this[s])"constructor"!=i&&o(this[s][i])&&this._isAction(i)&&(this.actions[i]=this._action(i))}},hookup:function(e){return new this(e)},_isAction:function(t){return!!g.test(t)||(e.inArray(t,this.listensTo)>-1||e.event.special[t]||y[t])},_action:function(e,t){if(f.lastIndex=0,!t&&f.test(e))return null;var o=t?n.sub(e,[t,window]):e,r=i(o),a=(r?o[1]:o).match(b),s=a[2];return{processor:y[s]||z,parts:a,delegate:r?o[0]:void 0}},processors:{},listensTo:[],defaults:{}},{setup:function(t,i){var o=this[l];t=t.jquery?t[0]:t;var n=o.pluginName||o._fullName;return this.element=e(t).addClass(n),(v(t)||v(t,{}))[n]=this,this.options=r(r(!0,{},o.defaults),i),this.called="init",this.bind(),this.element},bind:function(t,i,o){if(void 0===t){this._bindings=[];var r=this[l],n=this._bindings,a=r.actions,s=this.element;for(funcName in a)a.hasOwnProperty(funcName)&&(ready=a[funcName]||r._action(funcName,this.options),n.push(ready.processor(ready.delegate||s,ready.parts[2],ready.parts[1],funcName,this)));var d=u(this,"destroy");return s.bind("destroyed",d),n.push(function(t){e(t).unbind("destroyed",d)}),n.length}return"string"==typeof t&&(o=i,i=t,t=this.element),this._binder(t,i,o)},_binder:function(e,t,i,o){return"string"==typeof i&&(i=u(this,i)),this._bindings.push(c(e,t,i,o)),this._bindings.length},_unbind:function(){var e=this.element[0];a(this._bindings,function(t,i){i(e)}),this._bindings=[]},delegate:function(e,t,i,o){return"string"==typeof e&&(o=i,i=t,t=e,e=this.element),this._binder(e,i,o,t)},update:function(e){r(this.options,e),this._unbind(),this.bind()},destroy:function(){if(this._destroyed)throw this[l].shortName+" controller already deleted";var t=this[l].pluginName||this[l]._fullName;this._destroyed=!0,this.element.removeClass(t),this._unbind(),delete this._actions,delete this.element.data("controllers")[t],e(this).triggerHandler("destroyed"),this.element=null},find:function(e){return this.element.find(e)},_set_called:!0});var y=e.Controller.processors,z=function(e,t,i,o,r){return c(e,t,u(r,o),i)};a("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset resize scroll select submit focusin focusout mouseenter mouseleave".split(" "),function(e,t){y[t]=z});var x,C=function(e,t){for(x=0;x<t.length;x++)if("string"==typeof t[x]?e[l]._shortName==t[x]:e instanceof t[x])return!0;return!1};e.fn.extend({controllers:function(){var i,o,r,n=t(arguments),a=[];return this.each(function(){for(r in i=e.data(this,"controllers"))i.hasOwnProperty(r)&&(o=i[r],n.length&&!C(o,n)||a.push(o))}),a},controller:function(e){return this.controllers.apply(this,arguments)[0]}})}(jQuery),Array.prototype.move=function(e,t){var i,o;if((e=parseInt(e,10))!==(t=parseInt(t,10))&&0<=e&&e<=this.length&&0<=t&&t<=this.length){if(o=this[e],e<t)for(i=e;i<t;i++)this[i]=this[i+1];else for(i=e;i>t;i--)this[i]=this[i-1];this[t]=o}},$.Class.extend("bizagi.editor.utilities",{resolveResource:function(e){var t=bizagi.localization.getResource(e);return t===e&&(t=void 0),t},buildComplexReference:function(e,t){var i={},o={};return"string"==typeof e?(o.ref=e,i.baref=o,t&&(i.displayName=t),i):e},resolveComplexReference:function(e){return bizagi.editor.utilities.isObject(e)?e.baref.ref:e},buildComplexXpath:function(e,t,i,o){var r={},n={};return"object"==typeof e&&e.xpath&&e.xpath.baxpath?e:"string"==typeof e&&e.length>0?(n.xpath=e,bizagi.editor.utilities.isGuidEmpty(t)||("true"===i?n.scopedefinition=t:n.contextentity=t),r.baxpath=n,o=void 0!==o&&"00000000-0000-0000-0000-000000000000"!=o?o:void 0,{xpath:r,relatedentity:bizagi.editor.utilities.buildComplexReference(o)}):void 0},resolveComplexXpath:function(e){return bizagi.editor.utilities.isObject(e)?e.xpath.baxpath.xpath:e},resolveContextEntityFromXpath:function(e){if(bizagi.editor.utilities.isObject(e))return e.xpath.baxpath.contextentity},resolveScopeContextFromXpath:function(e){if(bizagi.editor.utilities.isObject(e))return e.xpath.baxpath.scopedefinition},resolveRelatedEntityFromXpath:function(e){return bizagi.editor.utilities.isObject(e)&&e.relatedentity?e.relatedentity.baref.ref:null},getXpathObject:function(e){if(!e)return e;if(bizagi.editor.utilities.isObject(e))return e.xpath;if("string"==typeof e&&e.indexOf("<design")>-1)return null;throw"xpath parameter must be a complex xpath object"},buildComplexFilter:function(e,t){var i={filter:e};return"true"===t.isScopeAttribute?(i.scopedefinition=t.contextScope,i.contextentity=t.guidRelatedEntity):i.contextentity=t.guidRelatedEntity,i.globalcontextentity=t.contextScope,{bafilter:i}},resolvefilterExpression:function(e){if(bizagi.editor.utilities.isObject(e)){if(e.rule&&e.rule.displayName)return e.rule.displayName;if(e.rule)return e.rule.baref.ref;if(e.bafilter)return e.bafilter.filter}return e},resolveProperty:function(e,t){for(var i=t.split("."),o=e,r=0;r<i.length;r++)if(void 0===(o=o[i[r]]))return;return o},assignProperty:function(e,t,i,o){var r=t.split("."),n=e,a=r[0];if(!o||(n[a]=void 0,void 0!==i)){if(r.length>1)for(var s=0;s<r.length-1;s++)bizagi.util.isEmpty(n[a])&&(n[a]={}),n=n[a],a=r[s+1];n[a]=i}},objectEquals:function(e,t){if(typeof e!=typeof t)return!1;if("function"==typeof e)return e.toString()===t.toString();if(e instanceof Object&&t instanceof Object){if(bizagi.editor.utilities.countProps(e)!==bizagi.editor.utilities.countProps(t))return!1;for(k in e)if(!bizagi.editor.utilities.objectEquals(e[k],t[k]))return!1;return!0}return e===t},countProps:function(e){var t=0;for(k in e)e.hasOwnProperty(k)&&t++;return t},buildComplexLocalizable:function(e,t,i){var o={},r={};return"string"==typeof e?(r.languages={},r.default=e,r.uri=t+":"+i,o.i18n=r,o):e},resolveComplexLocalizable:function(e){return"object"==typeof e?e.i18n.default:e},resolveInternalResource:function(e){if(!e)return"";if("string"==typeof e)return e;var t=bizagi.language.split("-").shift();return function(e){var i=!1;if($.isArray(e)&&e.length>0&&t.length>0)for(var o=0,r=e.length;o<r;o+=1)if(e[o][t]){i=e[o][t];break}return i}(e.languages)||e.default},resolvei18n:function(e){var t=bizagi.editorLanguage.key;if("string"==typeof e)return e;if(t&&"default"!=t){var i=e.i18n.languages&&e.i18n.languages[t];if(i)return i}return e.i18n.default},isObject:function(e){return null!=e&&"object"==typeof e},isBoolean:function(e){return null!=e&&(!0===e||"true"===e.toString().toLowerCase()||(!1===e||"false"===e.toString().toLowerCase()))},isGuidEmpty:function(e){return!e||"00000000-0000-0000-0000-000000000000"===e},getGuidEmpty:function(){return"00000000-0000-0000-0000-000000000000"},getXPathByDisplayName:function(e){return e.replace(/[\W^_]/gi,"")},normalizeString:function(e){return e.replace(/[^a-zA-Z]/g,"")},camelCase:function(e){return e.toLowerCase().replace(/\s+(.)/g,function(e,t){return t.toUpperCase()})}},{}),$.Class.extend("bizagi.editor.observableClass",{},{init:function(){this.observableElement=$({})},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)}}),$.Controller.extend("bizagi.editor.observableController",{},{init:function(){this.observableElement=$({})},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)}}),$.Controller("bizagi.editor.component.controller",{init:function(){this.observableElement=$({}),this.tmpl={}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){this.observableElement.triggerHandler.apply(this.observableElement,arguments)},loadTemplate:function(e,t){var i=this,o=new $.Deferred;return i.tmpl[e]?(o.resolve(),o.promise()):bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[e]=t})},loadTemplates:function(e){var t=this,i=new $.Deferred,o=[];return $.each(e,function(e,i){var r=t.loadTemplate(e,i);o.push(r)}),$.when.apply($,o).done(function(){i.resolve()}),i.promise()},getTemplate:function(e){return this.tmpl[e]?this.tmpl[e]:null}}),bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.elementValidations={validRequiredProperties:function(){var e=this,t=!0;return e.formValidations=[],e.messageValidation="",e.isVisible()?(e.requiredProperties&&$.each(e.requiredProperties,function(i,o){if(e.requiredProperties[i]&&!e.propertyValueIsValid(i)){var r=bizagi.localization.getResource("formmodeler-editor-contextmenu-caption-property-required").replace("{0}",e.propertyModel.getCaption(i));e.messageValidation+=r+"</br>",e.formValidations.push({name:i,message:[r]}),t=!1}}),t):t},validRequiredDependentProperties:function(){var e=this,t=!0;return e.formValidations=e.formValidations||[],e.messageValidation=e.messageValidation||"",e.isVisible()?(e.requiredDependentProperties&&$.each(e.requiredDependentProperties,function(i,o){if(e.matchValue(o)&&(void 0===e.resolveProperty(i)||null===e.resolveProperty(i))){var r=bizagi.localization.getResource("formmodeler-editor-contextmenu-caption-property-required").replace("{0}",e.propertyModel.getCaption(i));e.messageValidation+=r+"</br>",e.formValidations.push({name:i,message:[r]}),t=!1}}),t):t},validSameXpath:function(e){var t=bizagi.localization.getResource("bizagi-editor-form-validation-samexpath");t="string"==typeof t?t.replace("{0}",e):"",this.messageValidation=this.messageValidation||"",this.messageValidation+=t+"</br>"},validSameXpathAdhoc:function(e){var t=bizagi.localization.getResource("bizagi-editor-form-validation-samexpath-adhoc");t="string"==typeof t?t.replace("{0}",e):"",this.messageValidation=this.messageValidation||"",this.messageValidation+=t+"</br>"},validSameXpathDatasourceAdhoc:function(e){var t=bizagi.localization.getResource("bizagi-editor-form-validation-samexpath-adhoc-datasource");t="string"==typeof t?t.replace("{0}",e):"",this.messageValidation=this.messageValidation||"",this.messageValidation+=t+"</br>"},validAttributesAdministrables:function(e){var t=this,i=!0;if(t.isEditable()&&t.isParametricAttribute(e)){if(["searchlist","multiselect"].includes(t.type))return!0;var o="parameter"==t.triggerGlobalHandler("getContextEntityType")?bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-parameter-entity"):bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-entity");t.messageValidation=t.messageValidation||"",t.messageValidation+=o+"</br>",i=!1}return i},validLayoutPlaceholder:function(e){var t=this,i=!0;return t.isVisible()?("layoutPlaceholder"==t.type&&-1==$.inArray(t.guid,e)&&(t.messageValidation=t.messageValidation||"",t.messageValidation+=bizagi.localization.getResource("bizagi-editor-form-validation-layoutplaceholder")+"</br>",i=!1),i):i},validAttributesNoEditables:function(){return!0},validEntitiesNoEditables:function(){var e=this,t=new $.Deferred;return result=!0,e.isFormLink()&&e.isEditable()?$.when(e.isParameterEntity()).done(function(i){if(i){var o=bizagi.localization.getResource("bizagi-editor-form-validation-parameter-entity");e.messageValidation=e.messageValidation||"",e.messageValidation+=o+"</br>",t.resolve(!1)}else t.resolve(!0)}):t.resolve(!0),t.promise()},propertyValueIsValid:function(e){var t=this.resolveProperty(e);switch(e){case"xpathAdhoc":return!!t.xpath;case"displayName":return t&&bizagi.editor.utilities.resolvei18n(t).length>0;default:return!!t}},matchValue:function(e){var t=this,i=e.property,o=t.resolveProperty(i);return"adhoccombo"!==t.type&&"adhocsuggest"!==t.type&&"adhoccolumncombo"!==t.type||"datasource"!=i?!(!o||"anyValue"!=e.value)||null!=o&&o.toString()==e.value.toString():t.properties.data&&t.properties.data.datasource&&"bizagi"===t.properties.data.datasource.type}},bizagi.editor.observableClass.extend("bizagi.editor.base.element",{exclusiveProperty:/[^.]*/},$.extend({},bizagi.editor.base.elementValidations,{init:function(e,t,i){var o=this;this.elementFactory=t,this._super(),this.resourcesLoaded=new $.Deferred,this.properties=e&&e.properties?JSON.parse(JSON.encode(e.properties)):{},this.originalLoadedProperties=bizagi.clone(this.properties),e&&e.guid?i?(this.oldGuid=e.guid,this.guid=Math.guid()):this.guid=e.guid:this.guid=Math.guid(),i=i||!1,setTimeout(function(){o.updateLocalizableProperties(i),o.resourcesLoaded.resolve()},0),o.propertyModel={},o.decoratorModel={},o.contextMenuModel={},o.convertToModel=[],o["widget-guid"]=null,o.messageValidation="",o.defaultDisplayName={},o.channel=bizagi.editor.communicationprotocol.factory},ready:function(){return this.resourcesLoaded.promise()},setParent:function(e){this.parent=e,this.subscribe("refresh",function(){e.publish("refresh")})},getParent:function(){return this.parent},getProperties:function(){return this.properties},getOriginalLoadedProperties:function(){return this.originalLoadedProperties},getRenderingModel:function(){var e=$.Deferred();return $.when(this.getRenderingProperties()).done(function(t){t=t||{},e.resolve({properties:t})}),e.promise()},getRibbonProperties:function(){return[]},getRenderingProperties:function(){var e={};return e.guid=this.guid,e.id=this.guid,e.messageValidation=this.messageValidation,e},getPropertiesModel:function(){return this.propertyModel?this.propertyModel.process(this):{}},getIndexedProperties:function(){return this.propertyModel&&this.propertyModel.indexedProperties||{}},getPropertiesExternal:function(){return this.propertyModel&&this.propertyModel.externalProperties?this.propertyModel.externalProperties:{}},getPersistenceModel:function(){var e=this,t={type:e.type,guid:e.guid,properties:e.removeLocalization(e.filterDefaultValues(e.properties))};return e["widget-guid"]&&(t["widget-guid"]=bizagi.editor.utilities.buildComplexReference(e["widget-guid"])),t},updateSubmitVersionProperty:function(){this.isSearch()&&this.assignProperty("submitversion",2)},getContentResourceObject:function(e,t){var i,o=[];for(i in e.languages)o.push({code:i,value:e.languages[i]});return{category:"bizagiObjects.form",uri:e.uri,field:t,languages:o,defaultValue:e.default}},getChangesetResourceObject:function(e,t,i){var o=this.triggerGlobalHandler("getResourceByUri",e),r="object"==typeof o&&null!==o?o.Id:Math.guid(),n=this.getContentResourceObject(e,t);return{action:"merge",deployOnParent:!0,id:r,name:"Resources_"+r,type:"Resource",parentId:i,content:JSON.stringify(n),modifiedByUser:BIZAGI_USER}},getPropertiesLocalizables:function(){var e=this.propertyModel.indexedProperties,t=[];for(var i in e)this.isLocalizableProperty(i)&&t.push(i);return(e=this.getLocalizableProperties()||[]).forEach(function(e){t.indexOf(e)<0&&t.push(e)}),t},getLocalizablePropertiesModel:function(e){var t=this,i=[];e=e||t.triggerGlobalHandler("getIdForm",{element:t});for(var o=t.getPropertiesLocalizables(),r=(t.properties,0),n=o.length;r<n;r++){var a=o[r],s=t.resolveProperty(a);if(s&&"object"==typeof s){var l=s.i18n;"object"==typeof l&&i.push(t.getChangesetResourceObject(l,a,e))}}return i},getGridColumnModel:function(){var e=this,t=$.Deferred(),i=e.getPersistenceModel();return $.when(e.resolveDisplayNameProperty()).done(function(o){e.resolveProperty("displayName")?i.properties.displayName=e.resolveProperty("displayName"):i.properties.displayName=o,t.resolve(i)}),t.promise()},getContextMenuModel:function(){var e=this.contextMenuModel,t=e.getProperties();for(var i in t)e.assignProperty(i,this.resolveProperty(i));return e},getConvertToModel:function(){return bizagi.clone(this.convertToModel)},resolveType:function(e){return this.Class.renderTypeMapping[e]?this.Class.renderTypeMapping[e]:e},getDecoratorModel:function(){return this.decoratorModel},getExclusiveProperty:function(e){if(e)return this.Class.exclusiveProperty.exec(e)[0]},removeLocalization:function(e){var t=this;return t.getPropertiesLocalizables().forEach(function(i){var o=bizagi.editor.utilities.resolveProperty(e,i);if(o&&o.i18n&&o.i18n.uri){var r={i18n:{uri:o.i18n.uri}};t.isForm()&&"displayName"==i&&(r.i18n.default=o.i18n.default),bizagi.editor.utilities.assignProperty(e,i,r)}else bizagi.editor.utilities.assignProperty(e,i,void 0)}),e},filterDefaultValues:function(){var e=this,t=bizagi.clone(e.properties);return e.defaultValues&&$.each(e.defaultValues,function(i,o){var r=e.resolveProperty(i);bizagi.editor.utilities.isBoolean(r)&&(r=bizagi.util.parseBoolean(r),o=bizagi.util.parseBoolean(o)),bizagi.editor.utilities.objectEquals(r,o)&&bizagi.editor.utilities.assignProperty(t,i,void 0)}),t},getControlType:function(){},getGuid:function(){return this.guid},getXpath:function(){var e=this.properties;return e&&e.xpath?bizagi.editor.utilities.resolveComplexXpath(e.xpath):null},getXpathAdhoc:function(){var e=this.properties;return e&&e.xpathAdhoc?e.xpathAdhoc.xpath:null},getFilter:function(){return bizagi.editor.utilities.resolvefilterExpression(this.resolveProperty("data.filter"))||""},getDisplayName:function(){var e=this.properties;return bizagi.editor.utilities.resolvei18n(e.displayName)},assignDefaultProperty:function(e,t){void 0!==this.resolveProperty(e)&&null!==this.resolveProperty(e)||this.assignProperty(e,t)},assignProperty:function(e,t,i){bizagi.editor.utilities.assignProperty(this.properties,e,t,i),"xpath"===e&&(t||this.removeDefaultDisplayName(),this.xpathProperties.length>0&&this.cleanXpathProperties())},propertiesOverrides:function(e){$.extend(this.properties,e)},requiredPropertiesOverrides:function(e){var t=this.getIndexedProperties();for(var i in $.extend(this.requiredProperties,e),e){if(e.hasOwnProperty(i))(t[i]||{}).required=e[i]}},setProperty:function(e,t){this.assignProperty(e,t)},resolveProperty:function(e){return bizagi.editor.utilities.resolveProperty(this.properties,e)},resolveDisplayNameProperty:function(){var e=this,t=new $.Deferred;return e.asyncProperties=e.asyncProperties||[],e.resolveProperty("displayName")?e.resolveI18nProperty("displayName"):e.defaultDisplayName&&e.defaultDisplayName[bizagi.editorLanguage.key]?e.defaultDisplayName[bizagi.editorLanguage.key]:(e.asyncProperties.push($.when(e.triggerGlobalHandler("getDefaultDisplayName",{element:e})).pipe(function(i){i?"string"==typeof i?(e.defaultDisplayName=e.defaultDisplayName||{},e.defaultDisplayName.default=i,t.resolve(i)):(e.defaultDisplayName=e.defaultDisplayName||{},e.defaultDisplayName=i,t.resolve(i.displayName)):t.resolve("")})),t.promise())},getProperty:function(e){return this.resolveProperty(e)},getFormatProperties:function(){var e,t,i=[],o=["displaytype","labelalign","valuealign","layout.labelwidth","layout.layouttype","orientation","format","formatvalue","layout.valuewidth"];for(e=0;e<o.length;e++)t={property:o[e],value:this.resolveProperty(o[e])},i.push(t);return i},resolveFixedValueProperty:function(e){var t=this.resolveProperty(e);return void 0===t||void 0===t.fixedvalue||t.fixedvalue},resolveI18nProperty:function(e){var t=this.resolveProperty(e),i=t;return t&&t.i18n&&(i="default"===bizagi.editorLanguage.key?t.i18n.default:t.i18n.languages&&t.i18n.languages[bizagi.editorLanguage.key]||t.i18n.default),i},resolveIsRightToLeftProperty:function(){return this.isDefaultValueinHierarchicalChain(this,"orientation")||(bizagi.editorLanguage&&bizagi.util.parseBoolean(bizagi.editorLanguage.IsRightToLeft)?"rtl":"ltr")},isDefaultValueinHierarchicalChain:function(e,t){var i=!1;return e&&"function"==typeof e.getDefaultValueProperty?i=e.getDefaultValueProperty(t)===e.getProperty(t)?this.isDefaultValueinHierarchicalChain(e.getParent(),t):e.getProperty(t):i},getDefaultValueProperty:function(e){var t=this.properties.xpath;return t?(t=bizagi.editor.utilities.resolveComplexXpath(t),this.defaultValues[e]||this.triggerGlobalHandler("getNodeInfo",{property:e,xpath:t,callback:function(t){return"maxlength"===e?t.getMaxLength():null}})):this.defaultValues[e]},getDefaultLocalizableProperty:function(e){return"displayName"===e?this.defaultDisplayName.default:""},hasDesignValue:function(e){return this.designValueProperties[e]||!1},isVisualProperty:function(e){return("label"!==this.type||"xpath"!==e)&&(this.propertyModel.indexedProperties&&this.propertyModel.indexedProperties[e]||!1)},isLocalizableProperty:function(e){var t=this.propertyModel.indexedProperties[e];return!(!t||!t["bas-type"])&&("localizable-string"===t["bas-type"]||"localizablestring"===t["bas-type"])},isInternal:function(){return!1},isRequiredProperty:function(e){if(!this.requiredProperties)return!1;for(var t=e.split("."),i=t[0],o=0;o<t.length;o++){if(this.requiredProperties[i])return!0;t[o+1]&&(i=i+"."+t[o+1])}return!1},isDependentProperty:function(e){if(!this.requiredDependentProperties)return!1;for(var t in this.requiredDependentProperties)if(this.requiredDependentProperties[t].property===e||t===e)return!0;return!1},isEditable:function(){var e=this;function t(){return!1!==e.resolveProperty("editable.fixedvalue")&&"false"!==e.resolveProperty("editable.fixedvalue")}return null!=e.parent?e.parent.isEditable()&&t():t()},isParametricAttribute:function(e){e=e||"",e+=bizagi.editor.utilities.resolveComplexXpath(this.properties.xpath);var t=this.triggerGlobalHandler("getNodeInfo",{xpath:e});return!!t&&(t.parentIsParametricEntity()&&-1==$.inArray(t.renderType,["cascadingcombo","combo","suggest"]))},isParameterEntity:function(){var e=new $.Deferred,t=this.resolveProperty("xpath");if(bizagi.editor.utilities.isObject(t)){var i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(t);if("string"==typeof i){var o=this.channel.createProtocol({protocol:"getentitytype",entityGuid:i});$.when(o.processRequest()).done(function(t){var i="Parameter"===t.entityType||"Enum"===t.entityType;e.resolve(i)})}else e.resolve(!1)}else e.resolve(!1);return e.promise()},isText:function(){return"text"===this.type||"columntext"===this.type||"offlinetext"===this.type},isHidden:function(){return"hidden"===this.type||"columnhidden"===this.type||"offlinehidden"===this.type},isGrid:function(){return"grid"===this.type||"adhocgrid"===this.type||"groupedgrid"===this.type||"offlinegrid"===this.type},isFormLink:function(){return"formlink"===this.type||"columnformlink"===this.type},isForm:function(){return"form"===this.type||"queryform"===this.type||"searchform"===this.type||"offlineform"===this.type||"startform"===this.type||"template"===this.type},isSearch:function(){return"search"===this.type||"columnsearch"===this.type},restoreDefaultDisplayName:function(){this.properties.displayName&&"string"==typeof this.properties.displayName&&this.assignProperty("displayName",void 0)},removeDefaultDisplayName:function(){this.defaultDisplayName={}},getFormValidations:function(){return this.formValidations},getFormParent:function(){return this.parent.getFormParent()},getValidations:function(){return this.validations},removeValidations:function(){this.messageValidation="",this.propertyModel.model.validations=void 0},triggerGlobalHandler:function(e,t){return this.parent?this.parent.triggerGlobalHandler(e,t):null},cleanXpathProperties:function(){var e=this,t=e.defaultValues||{};$.each(e.xpathProperties,function(i,o){bizagi.editor.utilities.assignProperty(e.properties,o,t[o])})},isContainedInNestedForm:function(){return!!this.parent&&("nestedform"===this.parent.type?this.parent.getXpath()||!0:this.parent.isContainedInNestedForm())},getXpathNestedForm:function(){return!!this.parent&&("nestedform"===this.parent.type?this.parent.properties.xpath:this.parent.getXpathNestedForm())},getNestedFormContainer:function(){return!!this.parent&&("nestedform"===this.parent.type?this.parent:this.parent.getNestedFormContainer())},getHierarchicalXpathNestedForm:function(e){var t;return e=e||"",this.parent?("nestedform"===this.parent.type&&(t=this.parent.getXpath()||"").length>0&&(e=e.length>0?t+"."+e:t),this.parent.getHierarchicalXpathNestedForm(e)):e},updateLocalizableProperties:function(e){var t=this;t.getPropertiesLocalizables().forEach(function(i){var o=t.resolveProperty(i);if("object"==typeof o&&"object"==typeof o.i18n){var r=o.i18n;if(t.isContainedInNestedForm())r=t.getNestedFormContainer().getLocalizationObject(r);else r=t.triggerGlobalHandler("getLocalizationObject",{i18n:r,newUri:t.guid+":"+i,regenerateGuid:e});t.assignProperty(i,{i18n:r})}})},isVisible:function(){return!0},isSaved:function(){var e=this.triggerGlobalHandler("getOriginalModel");this.triggerGlobalHandler("getModel");if(e.changeSet&&e.changeSet.length>0&&e.changeSet[0].content){var t=JSON.parse(e.changeSet[0].content);if(t.elements)return t.elements.map(function(e){return e.guid}).indexOf(this.guid)>-1}return!0}})),bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.renderBehaviour={findPositionOfElementInFormById:function(e,t){var i={position:t,found:!1};return this.guid===e&&(i={position:t,found:!0}),i}},bizagi.editor.base.element.extend("bizagi.editor.base.render",{},$.extend({},bizagi.editor.base.renderBehaviour,{init:function(e,t,i){this.elementType="render",this._super(e,t,i)},getRenderingModel:function(e){return e=e||"render",$.when(this._super()).pipe(function(t){var i={};return i[e]=t,i})},getControlType:function(){return this.controlType||this.properties.renderType},getControlAttributes:function(){var e=$.Deferred();return $.when(this.triggerGlobalHandler("findXpathAttributes",{element:this,xpath:this.properties.xpath})).done(function(){e.resolve()}),e.promise()},getInherentValidations:function(e){var t=this,i=t.properties;return e=e||[],i.required&&1==i.required.fixedvalue&&e.push({guid:Math.guid(),conditions:{operator:"and",expressions:[{simple:{operator:"is-empty",xpath:t.getXpath(i.xpath)}}]},validationCommand:{message:"The field "+t.resolveDisplayNameProperty()+" cannot be empty"},inherent:!0}),i.minValue&&e.push({guid:Math.guid(),conditions:{operator:"and",expressions:[{simple:{operator:"is-less-than",xpath:t.getXpath(i.xpath),argument:i.minValue,argumentType:"const"}}]},validationCommand:{message:"The field "+t.resolveDisplayNameProperty()+" cannot be less than "+i.minValue},inherent:!0}),i.maxValue&&e.push({guid:Math.guid(),conditions:{operator:"and",expressions:[{simple:{operator:"is-greater-than",xpath:t.getXpath(i.xpath),argument:i.maxValue,argumentType:"const"}}]},validationCommand:{message:"The field "+t.resolveDisplayNameProperty()+" cannot be less than "+i.maxValue},inherent:!0}),e}})),bizagi.editor.base.render.extend("bizagi.editor.render.generic",{},{init:function(e,t){this.type="label",this._super(e,t)},getRenderingProperties:function(){var e=this.properties,t=this._super();return t.type="label",e.displayName&&(t.displayName="string"==typeof e.displayName?e.displayName:e.displayName.i18n.default),t}}),bizagi.editor.base.render.extend("bizagi.editor.column.generic",{},{init:function(e,t){this.type="columnReadonly",this._super(e,t)},getRenderingProperties:function(){var e=this.properties,t=this._super();return t.type="columnReadonly",e.displayName&&(t.displayName="string"==typeof e.displayName?e.displayName:e.displayName.i18n.default),t}}),bizagi.editor.base.render.extend("bizagi.editor.base.actionlauncher",{},{getPersistenceModel:function(){var e=this._super();return e.properties.customxpath="@KeyValue.Action_"+this.guid,e}}),bizagi.editor.base.render.extend("bizagi.editor.base.polymorphiclauncher",{},{getPersistenceModel:function(){var e=this._super();return e.properties.customxpath="@KeyValue.Constructor_"+this.guid,e}}),bizagi.editor.base.render.extend("bizagi.editor.base.entitytemplate",{},{getPersistenceModel:function(){var e=this._super();return e.properties.customxpath="@KeyValue.Action_"+this.guid,e}}),bizagi.editor.base.element.extend("bizagi.editor.base.renderLayout",{},{init:function(e,t,i){this.elementType="render",this._super(e,t,i)},getRenderingModel:function(e){var t=this;e=e||"render";return $.when(t._super()).pipe(function(i){i.properties.value=t.getValue();var o={};return o[e]=i,o})},getPersistenceModel:function(){var e=this;return{type:e.type,guid:e.guid,properties:e.removeLocalization(e.filterDefaultValues(e.properties))}},getValue:function(){var e=this.properties,t=e.link||e.xpath,i=e.displayName;if(t)return this.getDesignValue(t);if(null!=i)return bizagi.editor.utilities.resolvei18n(i);if(e.type){var o=e.type.replace(/[:\s]*/g,"").toLowerCase();return"label"!=o&&"value"!=o||(o="drophere"),bizagi.localization.getResource("bizagi-editor-templates-labels-controls-"+o)}},hasValue:function(){var e=this.properties;return!(!e.link&&!e.xpath)||null!=e.displayName},getControlType:function(){return this.controlType},getDesignValue:function(e){this.type;var t=e.xpath.baxpath.xpath.split(".");return t.length>1?t[t.length-1]:bizagi.editor.utilities.resolveComplexXpath(e)},isVisible:function(){return!this.resolveProperty("hide")}}),bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.containerValidations={validRequiredProperties:function(){var e=this._super();return $.each(this.elements,function(t,i){e&=i.validRequiredProperties()}),e},validRequiredDependentProperties:function(){var e=this._super();return $.each(this.elements,function(t,i){e&=i.validRequiredDependentProperties()}),e},validElementsInContainer:function(){var e=this,t=!0;if(e.isEditable()){if(e.isContainerToValidate()&&!(t=e.elements.length>0)){var i="grid"===e.type?bizagi.localization.getResource("bizagi-editor-form-validation-elementsingrid"):bizagi.localization.getResource("bizagi-editor-form-validation-elementsincontainer");"string"!=typeof i&&(i=""),e.messageValidation=e.messageValidation||"",e.messageValidation+=i+"</br>"}$.each(e.elements,function(e,i){"function"==typeof i.validElementsInContainer&&(t&=i.validElementsInContainer())})}return t},validAttributesAdministrables:function(){var e=!0;if(this.isEditable())for(var t=0,i=this.elements.length;t<i;t++)e&=this.elements[t].validAttributesAdministrables();return e},isContainerToValidate:function(){var e=this.type;return this.isGrid()||"group"===e||"tabitem"===e||"contentpanel"===e},validLayoutPlaceholder:function(e){for(var t=!0,i=0,o=this.elements.length;i<o;i++)t&=this.elements[i].validLayoutPlaceholder(e);return t},validAttributesNoEditables:function(){var e=$.Deferred();return this.elements.length>0?$.when.apply($,$.map(this.elements,function(e){return e.validAttributesNoEditables()})).done(function(){var t=$.makeArray(arguments).filter(function(e){return!e}).length>0;e.resolve(!t)}):e.resolve(!0),e.promise()},validEntitiesNoEditables:function(){var e=$.Deferred();return this.elements.length>0?$.when.apply($,$.map(this.elements,function(e){return e.validEntitiesNoEditables()})).done(function(){var t=$.makeArray(arguments).filter(function(e){return!e}).length>0;e.resolve(!t)}):e.resolve(!0),e.promise()},removeValidations:function(){this._super(),$.each(this.elements,function(e,t){t.removeValidations()})}},bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.containerBehaviour={addElement:function(e,t){var i=t?this.getElement(t):this;return e.position=i.elements.length,i.elements.push(e),e.setParent(i),e},removeLastElement:function(e){return(e?this.getElement(e):this).elements.pop()},getElement:function(e){var t=this;if(t.guid==e)return t.position=0,t;for(var i=0,o=t.elements.length;i<o;i+=1){var r=t.elements[i];if(r.guid==e)return r.position=t.elements.indexOf(r),r;if(r.elements){var n=r.getElement(e);if(n)return n}}return null},getElementByOldGuid:function(e){var t=this;if(t.oldGuid==e)return t.position=0,t;for(var i=0,o=t.elements.length;i<o;i+=1){var r=t.elements[i];if(r.oldGuid==e)return r.position=t.elements.indexOf(r),r;if(r.elements){var n=r.getElementByOldGuid(e);if(n)return n}}return null},moveElement:function(e,t,i,o){var r=this.getElement(i);return null==r?null:(r.elements.move(e,t),r)},removeElement:function(e,t){var i=t?this.getElement(t):this;return null==i?null:(i.elements.splice(e,1),i)},removeElementById:function(e){var t=this.getElement(e);if(null==t)return null;var i=this.getElement(t.parent.guid);return null==i?null:(i.elements.splice(t.position,1),t)},findElementByPosition:function(e,t){var i=this.getElement(t);return null==i?null:i.elements[e]},insertElement:function(e,t,i){var o=this.getElement(t);return null==o?null:(o.elements.splice(e,0,i),i.setParent(o),i)},changeProperty:function(e,t,i){var o;return null==(o=this.getElement(e))?null:(o.assignProperty(t,i),o)},updateElementByPosition:function(e,t,i){var o=this.getElement(t);if(null==o)return null;var r=o.elements.splice(e,1);return o.elements.splice(e,0,i),r},findPositionOfElementInFormById:function(e,t){var i={position:t,found:!1};if(this.guid===e)return!0;for(var o=0;o<this.elements.length&&(t+=1,!(i=this.elements[o].findPositionOfElementInFormById(e,t)).found);o++)t=i.position;return i},replaceElement:function(e,t){var i=this.removeElementById(e),o=i.parent;this.insertElement(i.position,o.guid,t)}},bizagi.editor.base.element.extend("bizagi.editor.base.container",{},$.extend({},bizagi.editor.base.containerBehaviour,bizagi.editor.base.containerValidations,{init:function(e,t,i){this.elements=[],this.elementType="container",this._super(e,t,i),this.initialize(e,i)},initialize:function(e,t){var i=this,o=i.elements;e&&e.elements&&$.each(e.elements,function(e,r){var n=i.elementFactory.createElement(r.type,r,t);n.setParent(i),o.push(n)})},ready:function(){var e=$.Deferred(),t=this._super();return $.when.apply($,$.map(this.elements,function(e){return e.ready()})).done(function(){$.when(t).done(function(){e.resolve(!0)})}),e.promise()},getRenderingModel:function(){var e=$.Deferred(),t=this._super();return $.when.apply($,$.map(this.elements,function(e){return e.getRenderingModel()})).done(function(){var i=$.makeArray(arguments);$.when(t).done(function(t){t.elements=i,e.resolve({container:t})})}),e.promise()},getPersistenceModel:function(){var e=this._super();return e.elements=[],$.each(this.elements,function(t,i){e.elements.push(i.getPersistenceModel())}),e},getPersitenceValidationsModel:function(){return bizagi.clone(this.validations).map(function(e){var t={i18n:{uri:e.validationCommand.message.i18n.uri}};return e.validationCommand.message=t,e})},getRenderingValidationsModel:function(){var e=this;return e.validations.map(function(t){var i=t.validationCommand.message.i18n;return i=e.triggerGlobalHandler("getLocalizationObject",{i18n:i,regenerateGuid:!1,newUri:i.uri}),t.validationCommand.message.i18n=i,t})},getLocalizableValidationMessagesModel:function(){return[]},getLocalizablePropertiesModel:function(){var e=this._super();return $.each(this.elements,function(t,i){e=e.concat(i.getLocalizablePropertiesModel())}),e},getControlType:function(){return this.controlType},getFormParent:function(){return this.parent.getFormParent()},getChildren:function(){return this.elements},getInherentValidations:function(e){return e=e||[],$.each(this.elements,function(t,i){i.getInherentValidations(e)}),e},scopeDefinitionCanBeAdded:function(e){var t=!1;return"string"==typeof e?t=!bizagi.editor.utilities.isGuidEmpty(e):bizagi.editor.utilities.isObject(e)&&(t=!bizagi.editor.utilities.isGuidEmpty(bizagi.editor.utilities.resolveComplexReference(e))),t},updateSubmitVersionProperty:function(){(this.elements||[]).forEach(function(e){e.updateSubmitVersionProperty()})}})),bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.formBehaviour={isButtonElement:function(e){return!(!e||!e.type)&&"formbutton"==e.type},addButton:function(e){return e.position=this.buttons.length,this.buttons.push(e),e.setParent(this),e},moveElement:function(e,t,i,o){return"button"!=o?this._super(e,t,i):(this.buttons.move(e,t),this)},getElement:function(e){var t=this,i=t._super(e);if(!i&&t.buttons)for(var o=0;o<t.buttons.length;o++){var r=t.buttons[o];if(r.guid==e)return r.position=t.buttons.indexOf(r),r}return i},removeElementById:function(e){var t=this.getElement(e);return null==t?null:this.isButtonElement(t)?(this.buttons.splice(t.position,1),t):this._super(e)},removeElement:function(e,t,i){return this.isButtonElement(i)?(this.buttons.splice(e,1),i):this._super(e,t)}},bizagi.editor.base.container.extend("bizagi.editor.base.form",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(e,t,i){var o=this;e=e||{},o.type="form",this._super(e,t,i),o.elementFactory=t,this.validationsResourcesLoaded=new $.Deferred,o.actions=e.actions?e.actions:[],o.actions=i?o.regenerateGuidsActions():o.actions,o.validations=e.validations?e.validations:[],o.validations=i?o.regenerateGuidsValidations():o.validations,o.buttons=[],o.loadButtons(e.buttons),setTimeout(function(){o.validations=o.getRenderingValidationsModel(),o.validationsResourcesLoaded.resolve()},0),o.contextentity=e.contextentity,o.scopedefinition=e.scopedefinition,o.isActivityForm=null==e.isActivityForm?e.isActivityForm:!!e.buttons,o.version=e.version},loadButtons:function(e){var t=this;(e=e||[]).forEach(function(e){var i=t.elementFactory.createElement(e.type,e);i.setParent(t),t.buttons.push(i)})},getFormParent:function(){return this},getRenderingModel:function(){var e=this,t=$.Deferred(),i=e._super();return $.when(i).done(function(i){i.container.properties.isReadOnly=e.triggerGlobalHandler("isReadOnlyForm"),t.resolve({form:i.container})}),t.promise()},getPersistenceModel:function(){var e=this,t=this._super();return e.buttons=e.buttons||[],t.actions=e.actions,t.validations=e.getPersitenceValidationsModel(),e.hasCustomButtons()&&(t.buttons=e.getPersistenceButtonsModel()),t.contextentity="string"==typeof e.contextentity?bizagi.editor.utilities.buildComplexReference(e.contextentity):e.contextentity,e.scopeDefinitionCanBeAdded()&&(t.scopedefinition="string"==typeof e.scopedefinition?bizagi.editor.utilities.buildComplexReference(e.scopedefinition):e.scopedefinition),t.version=e.version,t},getPersistenceButtonsModel:function(){return this.buttons.reduce(function(e,t){return e.push(t.getPersistenceModel()),e},[])},getLocalizableValidationMessagesModel:function(e){var t=this;return t.validations.map(function(i){var o=i.validationCommand.message.i18n,r=t.triggerGlobalHandler("getResourceByUri",o),n="object"==typeof r?r.Id:Math.guid(),a=function(e,t){var i,o=[];for(i in e.languages)o.push({code:i,value:e.languages[i]});return{category:"bizagiObjects.form",uri:e.uri,field:t,languages:o,defaultValue:e.default}}(o,"message");return{action:"merge",deployOnParent:!0,id:n,name:"Resources_"+n,type:"Resource",parentId:e,content:JSON.stringify(a),modifiedByUser:BIZAGI_USER}})},getLocalizablePropertiesModel:function(){var e=this._super();return this.hasCustomButtons()?this.buttons.reduce(function(e,t){return e=e.concat(t.getLocalizablePropertiesModel())},e):e},scopeDefinitionCanBeAdded:function(){return"string"==typeof this.scopedefinition?!bizagi.editor.utilities.isGuidEmpty(this.scopedefinition):!!bizagi.editor.utilities.isObject(this.scopedefinition)&&!bizagi.editor.utilities.isGuidEmpty(bizagi.editor.utilities.resolveComplexReference(this.scopedefinition))},hasCustomButtons:function(){return void 0!==this.properties.usecustombuttons&&this.properties.usecustombuttons},getSearchResultRenderingModel:function(){},getButtonRenderingModel:function(){return $.when.apply($,$.map(this.buttons,function(e){return $.when(e.ready()).pipe(function(){return e.getRenderingModel("button")})})).pipe(function(){return $.makeArray(arguments)})},getCommandsModel:function(){var e=this,t=$.Deferred(),i={},o=[],r=e.getCommandsControls(e,i,o);return o.length>0?$.when(e.getCommandsSpecialControls(o,i)).done(function(){t.resolve({actions:e.getActions(),validations:e.getValidations(),controls:r,enableReverse:e.verifyFormHasReverse()})}):t.resolve({actions:e.getActions(),validations:e.getValidations(),controls:r,enableReverse:e.verifyFormHasReverse()}),t.promise()},ready:function(){var e=this,t=$.Deferred(),i=e._super();return $.when(e.validationsResourcesLoaded,i).done(function(){$.when.apply($,$.map(e.buttons,function(e){return e.ready()})).done(function(){t.resolve()})}),t.promise()},getValidations:function(){var e=bizagi.clone(this.validations);return $.merge(e,this.getInherentValidations()),e},getActions:function(){return $.each(this.actions,function(e,t){for(var i=$.grep(t.commands,function(e){return"execute-rule"===e.command||"execute-gridrule"===e.command}),o=0,r=i.length;o<r;o++){var n=i[o].argument;bizagi.editor.utilities.isObject(n)||(n={rule:n,label:"Rule"}),n.guid&&(n.rule=bizagi.editor.utilities.buildComplexReference(n.guid),delete n.guid),function(e,t,i){var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",rule:e});$.when(o.processRequest()).done(function(e){t.label=e?e.displayName:t.label,i.argument=t})}(n.rule,n,i[o])}}),this.actions},getActionValidationsModel:function(){return{actions:this.actions,validations:this.validations,mapXpaths:this.getMapControls(this,{})}},setCommandsModel:function(e){this.actions=e.actions||[],this.validations=e.validations?$.grep(e.validations,function(e){return!e.inherent}):[]},getCommandsControls:function(e,t,i){var o=this,r=["actionlauncher"];t=t||{},i=i||[];for(var n=0;n<e.elements.length;n++){var a=e.elements[n];if("container"==a.elementType&&"nestedform"!==a.type&&o.getCommandsControls(a,t,i),!(r.includes(a.type)||"boolean"===a.controlType&&"check"===a.properties.display&&bizagi.util.parseBoolean(a.properties.isexclusive))){var s=a.getControlType(),l=a.isVisualProperty("xpath");if(!a.isHidden()||s||bizagi.util.isEmpty(a.properties.xpath)){if("offlinegrid"!=a.type){if(s&&!bizagi.util.isEmpty(a.properties.xpath)&&"container"!==a.elementType){var d,c=a.isContainedInNestedForm(),u=c?c+"."+a.getXpath():a.getXpath();if(u=e.isGrid()?e.getXpath()+"[]."+a.getXpath():u,e.isGrid()||c)if("object"==typeof e.properties.xpath)d=o.buildCompositeXpath({originalXpath:e.properties.xpath,resolved:u});else{var p=a.getXpathNestedForm();d=o.buildCompositeXpath({originalXpath:p,resolved:u})}else d=a.properties.xpath;var m=bizagi.editor.utilities.resolveRelatedEntityFromXpath(a.properties.xpath);t[u]={label:e.isGrid()?(bizagi.util.trim(e.resolveDisplayNameProperty())||e.getXpath())+"."+e.elements[n].resolveDisplayNameProperty():e.elements[n].resolveDisplayNameProperty(),type:a.getControlType(a),render:"render"==a.elementType||null,container:"container"==a.elementType||null,baxpath:d,xpathContainer:e.isGrid()?e.getXpath():null,controlType:a.type,style:a.style,relatedEntity:m}}else if(s&&"container"===a.elementType){t[h=a.guid]={label:a.resolveDisplayNameProperty()||s+" "+h,type:a.getControlType(a),render:!1,container:!0,containerId:h,propertyToUpdate:"container",controlType:a.type,style:a.style}}else!l&&s&&"container"!==a.elementType&&(t[h=e.isGrid()?e.getXpath()+"[]."+a.guid:a.guid]={label:e.isGrid()?(e.resolveDisplayNameProperty()||e.getXpath())+"."+a.resolveDisplayNameProperty()||s+" "+h:a.resolveDisplayNameProperty()||s+" "+h,type:s,render:"render"==a.elementType||null,container:"container"==a.elementType||null,renderId:h,propertyToUpdate:"renderId",xpathContainer:e.isGrid()?e.getXpath():null,controlType:a.type,style:a.style});a.isGrid()&&!bizagi.util.isEmpty(a.properties.xpath)&&o.getCommandsControls(a,t,i)}}else i.push(a)}}if(o.properties.usecustombuttons)for(n=0;n<o.getFormParent().buttons.length;n++){var h,g=o.getFormParent().buttons[n];t[h=g.guid]={label:g.properties.caption.i18n.default,type:"activityFlowButton",render:"render"==g.elementType||null,container:null,renderId:g.guid,propertyToUpdate:"renderId",xpathContainer:null,controlType:"activityFlowButton"}}return t},getCommandsSpecialControls:function(e,t){var i=this,o=new $.Deferred;return $.when.apply($,$.map(e,function(e){return e.getControlAttributes()})).done(function(){i.getCommandsControls({elements:e,isGrid:function(){return!1}},t),o.resolve()}),o.promise()},getMapControls:function(e,t){t=t||{};for(var i=0;i<e.elements.length;i++){var o=e.elements[i];if(("container"==o.elementType||o.isGrid())&&this.getMapControls(o,t),"nestedform"!=e.elements[i].type&&"formlink"!=e.elements[i].type&&"hidden"!=e.elements[i].type&&"offlinehidden"!=e.elements[i].type&&!bizagi.util.isEmpty(e.elements[i].properties.xpath)){var r=e.elements[i].isContainedInNestedForm(),n=r?r+"."+e.elements[i].getXpath()+e.elements[i].getFilter():e.elements[i].getXpath()+e.elements[i].getFilter();t[n=e.isGrid()?e.getXpath()+e.getFilter()+"."+n:n]||(t[n]={elements:[]}),t[n].elements.push({guid:e.elements[i].guid}),r&&(t[n].elements[t[n].elements.length-1].nestedForm=!0)}}return t},getMapXpath:function(e,t){t=t||{};for(var i=0;i<e.elements.length;i++){var o=e.elements[i];if(("container"==o.elementType||o.isGrid())&&e.elements[i].isEditable()&&this.getMapXpath(o,t),"nestedform"!=e.elements[i].type&&"formlink"!=e.elements[i].type&&"hidden"!=e.elements[i].type&&"offlinehidden"!=e.elements[i].type&&!bizagi.util.isEmpty(e.elements[i].properties.xpath)){var r=e.elements[i].isContainedInNestedForm(),n=r?r+"."+e.elements[i].getXpath()+e.elements[i].getFilter():e.elements[i].getXpath()+e.elements[i].getFilter();t[n=e.isGrid()?e.getXpath()+e.getFilter()+"."+n:n]||(t[n]={editables:0,elements:[]});var a=bizagi.editor.utilities.resolveProperty(e.elements[i].properties,"editable.fixedvalue")||!0;t[n].editables=bizagi.util.parseBoolean(a)?t[n].editables+1:t[n].editables,t[n].elements.push({editable:!a||bizagi.util.parseBoolean(a),guid:e.elements[i].guid}),r&&(t[n].elements[t[n].elements.length-1].nestedForm=!0)}}return t},getMapXpathAdhoc:function(e,t){t=t||{};for(var i=0;i<e.elements.length;i++){var o=e.elements[i];if(("container"==o.elementType||o.isGrid())&&this.getMapXpathAdhoc(o,t),"nestedform"!=e.elements[i].type&&"formlink"!=e.elements[i].type&&"hidden"!=e.elements[i].type&&"offlinehidden"!=e.elements[i].type){var r=e.elements[i].properties,n=r&&r.xpathAdhoc&&r.xpathAdhoc.xpath;if(n){t[n=e.isGrid()?e.getXpathAdhoc()+"."+n:n]||(t[n]={editables:0,elements:[]});var a=bizagi.editor.utilities.resolveProperty(e.elements[i].properties,"editable.fixedvalue")||!0;t[n].editables=bizagi.util.parseBoolean(a)?t[n].editables+1:t[n].editables,t[n].elements.push({editable:!a||bizagi.util.parseBoolean(a),guid:e.elements[i].guid})}}}return t},getMapDisplayNameAdhoc:function(e,t){t=t||{};for(var i=0;i<e.elements.length;i++){var o=e.elements[i];if(("container"==o.elementType||o.isGrid())&&this.getMapDisplayNameAdhoc(o,t),"nestedform"!=e.elements[i].type&&"formlink"!=e.elements[i].type&&"hidden"!=e.elements[i].type&&"offlinehidden"!=e.elements[i].type){var r=e.elements[i].properties,n=r&&r.xpathAdhoc&&r.xpathAdhoc.xpath;n&&(t[n]=!0)}}return t},getMapXpathDatasourceAdhoc:function(e,t){t=t||{};for(var i=0;i<e.elements.length;i++)if(e.elements[i].properties.data&&e.elements[i].properties.data.datasource&&e.elements[i].properties.data.datasource.type&&"bizagi"===e.elements[i].properties.data.datasource.type){var o=e.elements[i].properties.data.datasource.guid;if(o){t[o]||(t[o]={editables:0,elements:[]});var r=bizagi.editor.utilities.resolveProperty(e.elements[i].properties,"editable.fixedvalue")||!0;t[o].editables=bizagi.util.parseBoolean(r)?t[o].editables+1:t[o].editables,t[o].elements.push({editable:!r||bizagi.util.parseBoolean(r),guid:e.elements[i].guid})}}return t},buildxpathColumn:function(e){return buildCompositeXpath(e)},buildCompositeXpath:function(e){if("object"==typeof e.originalXpath){var t=bizagi.clone(e.originalXpath);return t.xpath.baxpath.xpath=e.resolved,t}},addAction:function(e){this.actions.push(e)},deleteAction:function(e){for(var t=-1,i=0;i<this.actions.length;i++)if(this.actions[i].guid==e){t=i;break}t>=0&&this.actions.splice(t,1)},addValidation:function(e){this.validations.push(e)},deleteValidation:function(e){for(var t=-1,i=0;i<this.validations.length;i++)if(this.validations[i].guid==e){t=i;break}t>=0&&this.validations.splice(t,1)},triggerGlobalHandler:function(e,t){return this.publish(e,t)},verifyFormHasReverse:function(){for(var e=this.actions,t=!1,i=0;i<e.length;i++)if(e[i].elseAction&&"automatic"==e[i].elseAction){t=!0;break}return t},regenerateGuidsActions:function(){for(var e=this,t=0,i=e.actions.length;t<i;t++){var o=e.actions[t],r=[];e.getExpressions(o.conditions.expressions,r);for(var n=0,a=r.length;n<a;n++){var s=r[n];if(s.renderId)if(e.isGridContext(s.renderId)){var l=e.processGridContext(s.renderId),d=e.getElementByOldGuid(l.guidControl),c=d?d.guid:l.guidControl,u=l.gridXpath+"[]."+c;s.renderId=u}else d=e.getElementByOldGuid(s.renderId),s.renderId=d?d.guid:s.renderId}if(o.commands)for(n=0,a=o.commands.length;n<a;n++){var p=o.commands[n];(p.renderId||p.container)&&(d=e.getElementByOldGuid(p.renderId||p.container),p.renderId?p.renderId=d?d.guid:p.renderId:p.container=d?d.guid:p.container)}if(o.elseCommands)for(n=0,a=o.elseCommands.length;n<a;n++){var m=o.elseCommands[n];(m.renderId||m.container)&&(d=e.getElementByOldGuid(m.renderId||m.container),m.renderId?m.renderId=d?d.guid:m.renderId:m.container=d?d.guid:m.container)}if(o.dependencies)for(n=0,a=o.dependencies.length;n<a;n++){var h=o.dependencies[n];"string"==typeof h&&(e.isGridContext(h)?(l=e.processGridContext(h),c=(d=e.getElementByOldGuid(l.guidControl))?d.guid:l.guidControl,u=l.gridXpath+"[]."+c,o.dependencies[n]=u):(d=e.getElementByOldGuid(h),o.dependencies[n]=d?d.guid:h))}}return e.actions},getExpressions:function(e,t){for(var i=0,o=e.length;i<o;i++){var r=e[i];r.complex?this.getExpressions(r.complex.conditions.expressions,t):r.simple&&t.push(r.simple)}},regenerateGuidsValidations:function(){for(var e=this,t=0,i=e.validations.length;t<i;t++){var o=e.validations[t],r=[];e.getExpressions(o.conditions.expressions,r);for(var n=0,a=r.length;n<a;n++){var s=r[n];if(s.renderId)if(e.isGridContext(s.renderId)){var l=e.processGridContext(s.renderId),d=e.getElementByOldGuid(l.guidControl),c=d?d.guid:l.guidControl,u=l.gridXpath+"[]."+c;s.renderId=u}else d=e.getElementByOldGuid(s.renderId),s.renderId=d?d.guid:s.renderId}}return e.validations},isGridContext:function(e){return!!(e&&e.indexOf("[]")>0)},processGridContext:function(e){var t,i,o=new RegExp(/([\w\.]*)\[\]\.([\w\.|\w-\.]*)/g).exec(e);return o?(i=o[1],t=o[2]):(t="",i=""),{guidControl:t,gridXpath:i}},createDefaultButtons:function(e){var t=this;t.buttons=[];var i=Math.guid(),o=t.elementFactory.createElement("formbutton",{guid:i,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-save"),i,"caption"),actions:["submitData","refresh"]}});o.setParent(t);var r=Math.guid(),n=t.elementFactory.createElement("formbutton",{guid:r,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-next"),r,"caption"),actions:["validate","submitData","next"]}});n.setParent(t),t.buttons.push(o),t.buttons.push(n)}})),bizagi.editor.base.form.extend("bizagi.editor.base.startform",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(e,t){this._super(e,t),this.type="startform"},getPersistenceModel:function(){var e=this;if(e.triggerGlobalHandler("getControllerInfo",{type:"isNewForm"})){var t="displayName";if(!e.resolveProperty(t)){var i=bizagi.editor.utilities.resolveResource("bizagi-editor-startform-display-name"),o=bizagi.editor.utilities.buildComplexLocalizable(i,e.guid,t);e.assignProperty(t,o)}}return e._super()},createDefaultButtons:function(){this.buttons=[];var e=Math.guid(),t=this.elementFactory.createElement("formbutton",{guid:e,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-create"),e,"caption"),actions:["validate","createnewcase"]}});t.setParent(this),this.buttons.push(t)},hasCustomButtons:function(){return!0}})),bizagi.editor.base.form.extend("bizagi.editor.base.adhocform",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(e,t){this._super(e,t),this.type="adhocform"}})),bizagi.editor.base.form.extend("bizagi.editor.base.template",{},{init:function(e,t,i){this._super(e,t,i),this.type="template"},getFormParent:function(){return this},getLayout:function(){return this.elements[0]}}),bizagi.editor.base.container.extend("bizagi.editor.base.layout",{},{init:function(e,t,i){this.type="layout",this.repeaters={},this._super(e,t,i)},initialize:function(e){for(var t=this,i=t.properties,o=t.elements,r=/\{\{(placeholder(\:\w*)?)\}\}/g,n=/{{(repeater( {"id":"([\w-]+)"})?)}}\s*({{repeater:item}}([\w\W]+){{\/repeater:item}})/g,a=/{{repeater:item}}(<\w{2,10}\s*(class="[a-z]*")?([\sa-z0-9-="]*style="display: none;")>[\w\W]+){{\/repeater:item}}/,s=i.html.split("{{/repeater}}"),l=0,d=s.length;l<d;l++){var c=s[l];c=(c=c.replace(n,function(){var e=null!=arguments[3]?arguments[3]:Math.guid(),i=arguments[5],o=arguments[4],r={},n=arguments[0];if(null!=arguments[3]){var s=a.exec(o);i=s[1],i.replace(/({{placeholder(:\w*)?)(\s*\{"id":"([\w-]+)"\})?/gm,function(){var e=arguments[4];return e&&(r[e]=!0),arguments[1]}),o=s[0].replace(s[3],"")}else n=n.replace(i,$(i).attr("id",Math.guid())[0].outerHTML);return t.repeaters[e]={content:i,item:o,elements:r},(n=null!=arguments[3]?n:n.replace("{{repeater}}","{{repeater "+JSON.stringify({id:e})+"}}"))+"{{/repeater}}"})).replace(r,function(e,i,r,n,a){var s=Math.guid(),l="layoutPlaceholder";":image"==r&&(l="layoutImage");var d=t.elementFactory.createElement(l,{guid:s,properties:{type:r||"Value"}},!1);return d.setParent(t),o.push(d),"{{placeholder "+JSON.stringify({id:s})+"}}"}),s[l]=c}return i.html=s.join(""),t._super(e)},getRenderingModel:function(){for(var e=this,t=e.properties,i=e.elements,o=/({{placeholder(:\w*)?(\s*\{"id":"([\w-]+)"\})?)/g,r=/\{\{repeater \{"id":"([a-zA-Z0-9-]+)"\}\}\}\s*\{\{repeater:item\}\}[\w\W]+/g,n=t.html.split("{{/repeater}}"),a=0,s=n.length;a<s;a++){var l=n[a];l=l.replace(r,function(t,r,n,a){var s=r,l=e.repeaters[s];if(l&&e.addAditionalItem(l)){t=(t=t.replace('noshow="true"',"")).replace('style="display: none;"',""),l.elements={};var d=$(e.repeaters[s].content).css({display:"none"}).attr("noShow",!0).attr("id",Math.guid());return t+(d=(d="{{separator}}{{repeater:item}}"+(d=d[0].outerHTML)+"{{/repeater:item}}").replace(o,function(t,o,r,n,a){var s=Math.guid(),d=e.elementFactory.createElement("layoutPlaceholder",{guid:s,properties:{type:r||"Value",repeaterId:s}},!1);return l.elements[s]=!0,d.setParent(e),i.push(d),null!=arguments[3]?t.replace(arguments[3],JSON.stringify({id:s})):t+" "+JSON.stringify({id:s})}))+"{{/repeater}}"}return t+"{{/repeater}}"}),n[a]=l}return t.html=n.join(""),e._super()},addAditionalItem:function(e){if($.isEmptyObject(e.elements))return!0;for(var t in e.elements){var i=this.getElement(t);if(!i)return!0;if(i.hasValue())return!0}return!1}}),bizagi.editor.base.render.extend("bizagi.editor.base.formbutton",{},{init:function(e,t,i){this._super(e,t,i),this.fixProperties()},fixProperties:function(){var e=this.properties;e.buttonrule&&this.fixButtonRuleProperty(e.buttonrule)},fixButtonRuleProperty:function(e){e.baref&&(e={rule:e},this.assignProperty("buttonrule",e))}}),bizagi.editor.base.form.extend("bizagi.editor.base.offlineform",{},$.extend({},bizagi.editor.base.formBehaviour,{init:function(e,t){this._super(e,t),this.type="offlineform"}})),bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.searchFormBehaviour={isResultElement:function(e){return e.type.indexOf("columnResult")>=0},addElement:function(e,t){var i=this;return i.isResultElement(e)?(e.position=i.result.length,i.result.push(e),e.setParent(i),e):i._super(e,t)},insertElement:function(e,t,i){return this.isResultElement(i)?(this.result.splice(e,0,i),i.setParent(this),i):this._super(e,t,i)},getElement:function(e){var t=this._super(e);if(!t)for(var i=0;i<this.result.length;i++){var o=this.result[i];if(o.guid==e)return o.position=this.result.indexOf(o),o}return t},moveElement:function(e,t,i,o){return"searchresult"!=o?this._super(e,t,i):(this.result.move(e,t),this)},removeElementById:function(e){var t=this.getElement(e);return null==t?null:this.isResultElement(t)?(this.result.splice(t.position,1),t):this._super(e)}},bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.queryFormBehaviour={isResultElement:function(e){return e.type.indexOf("columnResult")>=0},addElement:function(e,t){var i=this;return i.isResultElement(e)?(e.position=i.result.length,i.result.push(e),e.setParent(i),e):i._super(e,t)},insertElement:function(e,t,i){return this.isResultElement(i)?(this.result.splice(e,0,i),i.setParent(this),i):this._super(e,t,i)},getElement:function(e){return this._super(e)},moveElement:function(e,t,i,o){return"searchresult"!=o?this._super(e,t,i):(this.result.move(e,t),this)},removeElementById:function(e){var t=this.getElement(e);return null==t?null:this.isResultElement(t)?(this.result.splice(t.position,1),t):this._super(e)}},bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.searchFormValidations={validRequiredProperties:function(){return this._super()},validRequiredDependentProperties:function(){return!0},validAttributesAdministrables:function(){return!0},validElementsInContainer:function(){var e;if(this.resultValidations="",!(e=this.result.length>0)){var t=bizagi.localization.getResource("bizagi-editor-form-validation-elementsincontainer");"string"!=typeof t&&(t=""),this.resultValidations=t}return e},removeValidations:function(){this._super(),this.resultValidations=null}},bizagi.editor=bizagi.editor||{},bizagi.editor.base=bizagi.editor.base||{},bizagi.editor.base.queryFormValidations={validRequiredProperties:function(){return this._super()},validRequiredDependentProperties:function(){return!0},validAttributesAdministrables:function(){return!0},validElementsInContainer:function(){return this._super()},removeValidations:function(){this._super(),this.resultValidations=null}},bizagi.editor.base.container.extend("bizagi.editor.base.searchform",{},$.extend({},bizagi.editor.base.searchFormBehaviour,bizagi.editor.base.searchFormValidations,{init:function(e,t,i){var o=this;o.type="searchform",this._super(e,t,i),o.contextentity=e.contextentity,o.scopedefinition=e.scopedefinition,o.version=e.version,o.result=[],e.result&&$.each(e.result,function(e,t){var i=o.elementFactory.createElement(t.type,t);i.setParent(o),o.result.push(i)})},getFormParent:function(){return this},getRenderingModel:function(){var e=$.Deferred(),t=this._super();return $.when(t).done(function(t){t.container&&t.container.properties&&(t.container.properties.type="form"),e.resolve({form:t.container})}),e.promise()},getPersistenceModel:function(){var e=this,t=this._super();return(t=$.extend(t,{result:e.getSearchResultPersistenceModel(),resultValidations:e.resultValidations})).contextentity="string"==typeof e.contextentity?bizagi.editor.utilities.buildComplexReference(e.contextentity):e.contextentity,e.scopeDefinitionCanBeAdded(e.scopedefinition)&&(t.scopedefinition="string"==typeof e.scopedefinition?bizagi.editor.utilities.buildComplexReference(e.scopedefinition):e.scopedefinition),t.version=e.version,t},getSearchResultPersistenceModel:function(){var e=[];return $.each(this.result,function(t,i){e.push(i.getPersistenceModel())}),e},getLocalizablePropertiesModel:function(){var e=this._super();return $.each(this.result,function(t,i){e=e.concat(i.getLocalizablePropertiesModel())}),e},getSearchResultRenderingModel:function(){var e=this,t=$.Deferred();return $.when.apply($,$.map(e.result,function(e){return e.getGridColumnModel()})).done(function(){t.resolve({result:$.makeArray(arguments),resultValidations:e.resultValidations})}),t.promise()},resolveDisplayNameProperty:function(){return this.resolveProperty("displayName")?this.resolveI18nProperty("displayName"):void 0},getMapXpath:function(e,t){},getMapControls:function(e,t){},triggerGlobalHandler:function(e,t){return this.publish(e,t)}})),bizagi.editor.base.container.extend("bizagi.editor.base.queryform",{},$.extend({},bizagi.editor.base.queryFormValidations,{init:function(e,t,i){var o=this;o.type="queryform",this._super(e,t,i),o.actions=e&&e.actions?e.actions:[],o.actions=i?o.regenerateGuidsActions():o.actions,o.validations=e&&e.validations?e.validations:[],o.validations=i?o.regenerateGuidsValidations():o.validations,o.contextentity=e.contextentity,o.scopedefinition=e.scopedefinition,o.version=e.version},getFormParent:function(){return this},getRenderingModel:function(){var e=$.Deferred(),t=this._super();return $.when(t).done(function(t){e.resolve({form:t.container})}),e.promise()},getPersistenceModel:function(){var e=this,t=this._super(),i=e.triggerGlobalHandler("getContextEntityType");return t.actions=e.actions,t.validations=e.validations,t.properties.onlynested=t.properties.onlynested||!1,t.contextentity="string"==typeof e.contextentity?bizagi.editor.utilities.buildComplexReference(e.contextentity):e.contextentity,e.scopeDefinitionCanBeAdded(e.scopedefinition)&&(t.scopedefinition="string"==typeof e.scopedefinition?bizagi.editor.utilities.buildComplexReference(e.scopedefinition):e.scopedefinition),t.version=e.version,t.queryType="application"==i?"application":"entity",t},resolveDisplayNameProperty:function(){return this.resolveProperty("displayName")?this.resolveI18nProperty("displayName"):void 0},getCommandsModel:function(){var e=this,t=$.Deferred(),i={},o=[],r=e.getCommandsControls(e,i,o);return o.length>0?$.when(e.getCommandsSpecialControls(o,i)).done(function(){t.resolve({actions:e.getActions(),validations:e.getValidations(),controls:r,enableReverse:e.verifyFormHasReverse()})}):t.resolve({actions:e.getActions(),validations:e.getValidations(),controls:r,enableReverse:e.verifyFormHasReverse()}),t.promise()},getValidations:function(){var e=bizagi.clone(this.validations);return $.merge(e,this.getInherentValidations()),e},getActions:function(){return $.each(this.actions,function(e,t){for(var i=$.grep(t.commands,function(e){return"execute-rule"===e.command||"execute-gridrule"===e.command}),o=0,r=i.length;o<r;o++){var n=i[o].argument;bizagi.editor.utilities.isObject(n)||(n={rule:n,label:"Rule"}),n.guid&&(n.rule=bizagi.editor.utilities.buildComplexReference(n.guid),delete n.guid),function(e,t,i){var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",rule:e});$.when(o.processRequest()).done(function(e){t.label=e?e.displayName:t.label,i.argument=t})}(n.rule,n,i[o])}}),this.actions},getActionValidationsModel:function(){return{actions:this.actions,validations:this.validations,mapXpaths:this.getMapControls(this,{})}},setCommandsModel:function(e){this.actions=e.actions||[],this.validations=e.validations?$.grep(e.validations,function(e){return!e.inherent}):[]},getCommandsControls:function(e,t,i){t=t||{},i=i||[];for(var o=0;o<e.elements.length;o++){"container"==e.elements[o].elementType&&"nestedform"!==e.elements[o].type&&this.getCommandsControls(e.elements[o],t,i);var r=e.elements[o].getControlType(),n=e.elements[o].isVisualProperty("xpath");if(!e.elements[o].isHidden()||r||bizagi.util.isEmpty(e.elements[o].properties.xpath)){if(!e.elements[o].isInternal())if(r&&!bizagi.util.isEmpty(e.elements[o].properties.xpath)&&"container"!==e.elements[o].elementType){var a=e.isGrid()?e.getXpath()+"[]."+e.elements[o].getXpath():e.elements[o].getXpath();t[a]={label:e.isGrid()?(bizagi.util.trim(e.resolveDisplayNameProperty())||e.getXpath())+"."+e.elements[o].resolveDisplayNameProperty():e.elements[o].resolveDisplayNameProperty(),type:e.elements[o].getControlType(e.elements[o]),render:"render"==e.elements[o].elementType||null,container:"container"==e.elements[o].elementType||null,baxpath:e.isGrid()?this.buildxpathColumn({originalXpath:e.properties.xpath,resolved:a}):e.elements[o].properties.xpath,xpathContainer:e.isGrid()?e.getXpath():null,controlType:e.elements[o].type,style:e.elements[o].style}}else if(r&&"container"===e.elements[o].elementType){var s=e.elements[o].guid;t[s]={label:e.elements[o].resolveDisplayNameProperty()||r+" "+s,type:e.elements[o].getControlType(e.elements[o]),render:!1,container:!0,containerId:s,propertyToUpdate:"container",controlType:e.elements[o].type,style:e.elements[o].style}}else!n&&r&&"container"!==e.elements[o].elementType&&(t[s=e.isGrid()?e.getXpath()+"[]."+e.elements[o].guid:e.elements[o].guid]={label:e.isGrid()?(e.resolveDisplayNameProperty()||e.getXpath())+"."+e.elements[o].resolveDisplayNameProperty()||r+" "+s:e.elements[o].resolveDisplayNameProperty()||r+" "+s,type:r,render:"render"==e.elements[o].elementType||null,container:"container"==e.elements[o].elementType||null,renderId:s,propertyToUpdate:"renderId",xpathContainer:e.isGrid()?e.getXpath():null,controlType:e.elements[o].type,style:e.elements[o].style})}else i.push(e.elements[o])}return t},getCommandsSpecialControls:function(e,t){var i=this,o=new $.Deferred;return $.when.apply($,$.map(e,function(e){return e.getControlAttributes()})).done(function(){i.getCommandsControls({elements:e,isGrid:function(){return!1}},t),o.resolve()}),o.promise()},verifyFormHasReverse:function(){for(var e=this.actions,t=!1,i=0;i<e.length;i++)if(e[i].elseAction&&"automatic"==e[i].elseAction){t=!0;break}return t},getMapXpath:function(){},getMapControls:function(){},triggerGlobalHandler:function(e,t){return this.publish(e,t)}})),$.Class.extend("bizagi.editor.base.elementFactory",{designValueRegex:/<\w+:([\w:]+)>/},{init:function(e){var t=this;t.classes={};var i=t.controls=e.controls;$.each(e.definitions.controls,function(e,o){var r=i.getControlsToConvert(o.name),n=t.createClassForControl(o,r);t.classes[o.name]=n})},createClassForControl:function(control,controlsToConvert){var self=this,type=control.type||"render",extendingClass="container"==type||"offlinecontainer"==type||"adhoccontainer"==type?"bizagi.editor.base.container":"bizagi.editor.base.render";"queryInternal"==type?extendingClass="bizagi.editor.base.internal":"grid"===control.name||"groupedgrid"===control.name||"offlinegrid"===control.name||"adhocgrid"===control.name?extendingClass="bizagi.editor.base.grid":"panel"===control.name||"horizontal"===control.name?extendingClass="bizagi.editor.base.container":"nestedform"===control.name||"querynestedform"===control.name?extendingClass="bizagi.editor.base.nestedform":"form"===control.name?extendingClass="bizagi.editor.base.form":"mobileform"===control.name?extendingClass="bizagi.editor.base.form":"template"===control.name?extendingClass="bizagi.editor.base.template":"layout"===control.name?extendingClass="bizagi.editor.base.layout":"offlineform"===control.name?extendingClass="bizagi.editor.base.offlineform":"adhocform"===control.name?extendingClass="bizagi.editor.base.adhocform":"searchform"===control.name?extendingClass="bizagi.editor.base.searchform":"queryform"===control.name?extendingClass="bizagi.editor.base.queryform":"startform"==control.name?extendingClass="bizagi.editor.base.startform":"formbutton"===control.name?extendingClass="bizagi.editor.base.formbutton":"collectionnavigator"===control.name?extendingClass="bizagi.editor.base.collectionnavigator":"actionlauncher"===control.name?extendingClass="bizagi.editor.base.actionlauncher":"polymorphiclauncher"===control.name?extendingClass="bizagi.editor.base.polymorphiclauncher":"entitytemplate"===control.name?extendingClass="bizagi.editor.base.entitytemplate":"template"===type&&(extendingClass="bizagi.editor.base.renderLayout");var className="bizagi.editor."+control.name,code=extendingClass+'.extend("'+className+'" , {}, {\ninit: function ( data, elementFactory, regenerateGuid ) {\nvar self = this;\nself.type = "'+control.name+'";\nself.style = "'+control.style+'";\nthis._super(data, elementFactory, regenerateGuid);\nthis.propertyModel = this.Class.propertyModel;\nthis.decoratorModel = this.Class.decoratorModel;\nthis.contextMenuModel = this.Class.contextMenuModel;\nthis.convertToModel = this.Class.convertToModel;\nthis["widget-guid"] = this.Class["widget-guid"];\nthis.context = this.Class.decoratorModel;\nthis.defaultValues = {};\nthis.asyncProperties = [];\nthis.requiredProperties = {};\nthis.xpathProperties = [];\nthis.requiredDependentProperties = {};\nthis.designValueProperties = {};\nthis.controlType = '+(control["data-type"]?'"'+control["data-type"]+'"':"null")+";\n"+self.buildCodeForDefaultProperties(control.design.properties)+self.buildCodeForDesignValueProperties(control)+self.buildCodeForRequiredProperties(control.design.properties)+self.buildCodeForRequiredDependentProperties(control.design.properties)+"}, \n\ngetRenderingProperties: function ( ) {\nvar self = this;\nvar defer = $.Deferred();\nvar result = this._super();\n"+self.buildCodeForRenderingModel(control)+"$.when.apply($, self.asyncProperties).done(function(){ defer.resolve(result);}) \nreturn defer.promise();\n},\n\ngetRibbonProperties: function ( ) {\nvar self = this;\nvar result = [];\n"+self.buildCodeForRibbonProperties(control)+"return result;\n},\n\ngetLocalizableProperties: function ( ) {\nvar self = this;\nvar result = [];\n"+self.buildCodeForLocalizableProperties(control)+"return result;\n},\n\n})\n";try{eval(code),eval(className).propertyModel=new bizagi.editor.component.properties.model(control),eval(className).decoratorModel=bizagi.editor.component.decorator.model.getSpecificModel(control),eval(className).contextMenuModel=new bizagi.editor.component.contextmenu.model(control.design.visual["context-menu"],controlsToConvert),eval(className).convertToModel=controlsToConvert,eval(className)["widget-guid"]="userfield"===control.rendertype?control.guid:null}catch(e){return console.warn(e),"bizagi.editor.label"}return className},addWidgetsControls:function(e){var t=this;$.each(e,function(e,i){var o=t.createClassForControl(i,[]);t.classes[i.name]=o})},buildCodeForRenderingModel:function(e){var t="";for(var i in e.runtime.properties){var o=e.runtime.properties[i];if(o.designvalue){var r=o.designvalue,n=this.Class.designValueRegex.exec(r);if(n){var a=n[1].replace(/:/g,".");this.isLocalizableProperty(e,a)?t+=this.resolvePropertyLocalizable(e,o.name,a):this.isOrientationProperty(e,o.name)?t+=this.resolveOrientationProperty(e,o.name,a):t+='result["'+o.name+'"] = self.resolveProperty("'+a+'");\n'}else"object"==typeof o.designvalue?t+='result["'+o.name+"\"] = JSON.parse('"+JSON.encode(o.designvalue)+"');\n":"string"==typeof o.designvalue&&-1!==o.designvalue.indexOf('"')?t+='result["'+o.name+'"] = '+JSON.encode(o.designvalue)+";\n":t+='result["'+o.name+'"] = "'+o.designvalue+'";\n'}}return t},buildCodeForRibbonProperties:function(e){var t="";return $.each(["visible","editable","required"],function(i,o){e.design.properties[o]&&(t+='result.push("'+o+'");\n')}),t},buildCodeForLocalizableProperties:function(e){var t="";for(var i in e.design.properties){var o=e.design.properties[i];"localizable-string"!==o["bas-type"]&&"localizablestring"!==o["bas-type"]&&"displayName"!==o["bas-type"]||(t+='result.push("'+i+'");\n')}return t},buildCodeForDesignValueProperties:function(e){var t="",i={};for(var o in e.runtime.properties){var r=e.runtime.properties[o].designvalue;if(r){var n=this.Class.designValueRegex.exec(r);if(n){var a=n[1].split(":")[0];i[a]||(t+='self.designValueProperties["'+a+'"] = true;\n',i[a]=!0)}}}return t},isLocalizableProperty:function(e,t){var i;return void 0!==(i=e.design.properties[t])&&("localizable-string"===i["bas-type"]||"localizablestring"===i["bas-type"]||"displayName"===i["bas-type"])},isOrientationProperty:function(e,t){var i;return void 0!==(i=e.design.properties[t])&&"orientation"===i["bas-type"]},resolvePropertyLocalizable:function(e,t,i){return"displayName"===t?'$.when(self.resolveDisplayNameProperty("'+i+'")).done(function(value){result["'+t+'"] = value;}); \n':'result["'+t+'"] = self.resolveI18nProperty("'+i+'"); \n'},resolveOrientationProperty:function(e,t,i){return'result["'+t+'"] = self.resolveIsRightToLeftProperty("'+i+'"); \n'},buildCodeForDefaultProperties:function(e,t){var i="";for(var o in e){var r=e[o],n=t?t+"."+o:o;r.default&&("object"==typeof r.default?i+='self.defaultValues["'+n+"\"] =  JSON.parse('"+this.getDefaultValueProperty(r.default)+"');\n":i+='self.defaultValues["'+n+"\"] = '"+r.default+"';\n",i+='self.assignDefaultProperty("'+n+'",  self.defaultValues["'+n+'"]);\n'),r.subproperties&&(i+=this.buildCodeForDefaultProperties(r.subproperties,n))}return i},buildCodeForRequiredProperties:function(e,t){var i="";for(var o in e){var r=e[o];r.required&&(i+='self.requiredProperties["'+(o=t?t+"."+o:o)+"\"] = '"+r.required+"';\n"),r.subproperties&&(i+=this.buildCodeForRequiredProperties(r.subproperties,o))}return i},buildCodeForRequiredDependentProperties:function(e,t){var i="";for(var o in e){var r=e[o];if(r.dependencies&&this.isRequiredDependentProperty(r)&&(i+='self.requiredDependentProperties["'+(o=t?t+"."+o:o)+"\"] = JSON.parse('"+JSON.encode(r.dependencies.conditions)+"');\n"),r["editor-parameters"]){var n=r["editor-parameters"];for(var a in n){var s=n[a];n.hasOwnProperty(a)&&("string"==typeof s&&s.indexOf("<design:xpath")>-1&&(i+=t?'self.xpathProperties.push("'+t+"."+o+'");\n':'self.xpathProperties.push("'+o+'");\n'))}}r.subproperties&&(i+=this.buildCodeForRequiredDependentProperties(r.subproperties,o))}return i},getDefaultValueProperty:function(e){return"object"==typeof e?JSON.encode(e):e},createElement:function(name,data,regenerateGuid){var self=this;if(!self.classes[name])return console.warn("No control definition found for type: "+name),new bizagi.editor.render.generic(data,this);var fn=eval("var bafn = function(data, elementFactory, regenerateGuid) {  var element = new "+self.classes[name]+"(data, elementFactory, regenerateGuid); return element;};bafn");return fn(data,this,regenerateGuid)},createColumnElement:function(e,t,i){return this.classes[e]?this.createElement(e,t,i):(console.warn("No control definition found for column type: "+e),new bizagi.editor.column.generic(t,this,i))},isRequiredDependentProperty:function(e){var t=!1,i=e.dependencies;return i&&i.actions&&i.actions.required&&(t=!0),t}}),bizagi.editor.base.render.extend("bizagi.editor.base.grid",{relatedEntityType:{entityType:void 0}},$.extend({},bizagi.editor.base.containerBehaviour,bizagi.editor.base.containerValidations,{init:function(e,t,i){var o=this,r=o.elements=[];this._super(e,t,i),e&&e.elements&&$.each(e.elements,function(e,t){var n=o.elementFactory.createColumnElement(t.type,t,i);n.setParent(o),r.push(n)})},getRenderingModel:function(){var e=$.Deferred(),t=this._super();return $.when.apply($,$.map(this.elements,function(e){return e.getRenderingModel()})).done(function(){var i=$.makeArray(arguments);$.when(t).done(function(t){t.render.elements=i,e.resolve(t)})}),e.promise()},ready:function(){return $.when.apply($,$.map(this.elements,function(e){return e.ready()}).concat(this._super()))},getPersistenceModel:function(){var e=this._super();return e.elements=[],$.each(this.elements,function(t,i){e.elements.push(i.getPersistenceModel())}),e},getGridColumnModel:function(){var e,t=$.Deferred(),i=this._super();return $.when.apply($,$.map(this.elements,function(e){return e.getGridColumnModel()})).done(function(){e=arguments,$.when(i).done(function(i){i.elements=$.makeArray(e),t.resolve(i)})}),t.promise()},removeLocalization:function(e){var t=(e=this._super(e)).gridvalidations;if("object"==typeof t){var i=t.validations;i=i.map(function(e){return e.message={i18n:{uri:e.message.i18n.uri}},e}),t.validations=i,e.gridvalidations=t}return e},getLocalizablePropertiesModel:function(e){var t=this,i=this._super();e=e||t.triggerGlobalHandler("getIdForm",{element:t});t.properties;var o=t.resolveProperty("gridvalidations");o&&"object"==typeof o&&(bizagi.clone(o.validations)||[]).forEach(function(o){var r=o.message.i18n;"object"==typeof r&&i.push(t.getChangesetResourceObject(r,"message",e))});return $.each(t.elements,function(e,t){i=i.concat(t.getLocalizablePropertiesModel())}),i},updateLocalizableProperties:function(e){var t=this;t._super(e);t.properties;var i="gridvalidations",o=t.resolveProperty(i);if("object"==typeof o){var r=o.validations||[];r=r.map(function(o){var r=o.message&&o.message.i18n;return"object"==typeof r&&(r=t.triggerGlobalHandler("getLocalizationObject",{i18n:r,newUri:t.guid+":"+i,regenerateGuid:e}),o.message.i18n=r),o}),o.validations=r,t.assignProperty(i,o)}},restoreDefaultDisplayName:function(){this._super(),$.each(this.elements,function(e,t){t.restoreDefaultDisplayName()})},deleteColumns:function(){this.elements=[]},validAttributesAdministrables:function(e){var t=this,i=!0;if(t.isEditable())if(t.isParametricAttribute(e)){var o="parameter"==t.triggerGlobalHandler("getContextEntityType")?bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-parameter-entity"):bizagi.localization.getResource("bizagi-editor-form-validation-parameter-attribute-entity");t.messageValidation=t.messageValidation||"",t.messageValidation+=o+"</br>",i=!1}else{e=bizagi.editor.utilities.resolveComplexXpath(t.properties.xpath)+".";for(var r=0,n=t.elements.length;r<n;r++)i&=t.elements[r].validAttributesAdministrables(e)}return i},validAttributesNoEditables:function(){var e=this,t=new $.Deferred;if("adhocgrid"==e.type)return t.resolve(!0),t.promise();var i,o=e.resolveProperty("xpath");if(e.isEditable()){var r="system"==e.triggerGlobalHandler("getContextEntityType"),n=e.triggerGlobalHandler("getNodeInfo",{root:!0})||{};if(r&&"WFUSER"==n.xpath){var a=bizagi.localization.getResource("bizagi-editor-form-validation-attribute-no-administrable");e.messageValidation=e.messageValidation||"",e.messageValidation+=a+"</br>",t.resolve(!1)}else if(o){$.when((i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getentitytype",entityGuid:bizagi.editor.utilities.resolveRelatedEntityFromXpath(o)}),null!=e.Class.relatedEntityType.entityType?e.Class.relatedEntityType:i.processRequest())).done(function(i){e.Class.relatedEntityType.entityType=i.entityType;var o="Parameter"===i.entityType||"Enum"===i.entityType;if(o){var r=bizagi.localization.getResource("bizagi-editor-form-validation-attribute-no-editable");e.messageValidation=e.messageValidation||"",e.messageValidation+=r+"</br>"}t.resolve(!o)})}else t.resolve(!0)}else t.resolve(!0);return t.promise()},updateSubmitVersionProperty:function(){(this.elements||[]).forEach(function(e){e.updateSubmitVersionProperty()})}})),bizagi.editor.base.render.extend("bizagi.editor.base.internal",{},{init:function(e,t,i){this._super(e,t,i)},getRenderingProperties:function(){var e=this._super();return e.isInternal=!0,e},isInternal:function(){return!0}}),bizagi.editor.base.container.extend("bizagi.editor.base.nestedform",{},{init:function(e,t,i){this._super(e,t,i),this.elementFactory=t,this.initilizeData()},initilizeData:function(){var e=this;e.loadDeferred=new $.Deferred,e.loading=!0,e.message="loading...",e.elements=[],e.formdisplayName=e.properties.displayName,e.loadNestedFormElements()},loadNestedFormElements:function(){var e,t=this;e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadform",form:t.properties.form}),$.when(e.processRequest()).done(function(e){t.hashResources={};var i=e.form;(e.resources||[]).forEach(function(e){t.hashResources[e.uri]=e}),t.formdisplayName=t.getDisplayNameForm(i),t.processNestedFormElements(i)})},getDisplayNameForm:function(e){var t=e.properties.displayName,i="Form_"+e.guid;if(t&&t.i18n&&t.i18n.uri){var o=this.hashResources[t.i18n.uri];i=o&&o.DefaultValue||i}return i},getLocalizablePropertiesModel:function(){return[]},processNestedFormElements:function(e){var t=this;e&&e.elements&&$.each(e.elements,function(e,i){var o=t.elementFactory.createElement(i.type,i);o.setParent(t),t.elements.push(o)}),$.when(t.loadDeferred).done(function(){t.loading=!1,$.when(t.getRenderingModel()).done(function(e){setTimeout(function(){$.when(t.triggerGlobalHandler("formIsLoaded",null)).done(function(){t.triggerGlobalHandler("refreshElement",e)})},100)})}),setTimeout(function(){t.loadDeferred.resolve()},100)},getResourceByUri:function(e){return self.hashResources[e.uri]},getLocalizationObject:function(e){var t=this.hashResources[e.uri];if(!t)return e;var i={};return(t.languages||[]).forEach(function(e){i[e.Code]=e.Value}),{uri:t.uri,default:t.DefaultValue,languages:i}},ready:function(){var e=this._super();return $.when(e,this.loadDeferred)},getRenderingModel:function(){var e=this,t=$.Deferred();return $.when(this._super()).done(function(i){i.container.properties.loading=e.loading,i.container.properties.message=e.message,t.resolve(i)}),t.promise()},getPersistenceModel:function(){return{elements:[],type:this.type,guid:this.guid,properties:this.filterDefaultValues(this.properties)}},getRenderingProperties:function(){var e=this._super();return e.formDisplayName=this.formdisplayName,e},resolveDisplayNameProperty:function(){return"Nested form : "+this.formdisplayName},validAttributesAdministrables:function(){var e=!0;if(this.isEditable())for(var t=bizagi.editor.utilities.resolveComplexXpath(this.properties.xpath)+".",i=0,o=this.elements.length;i<o;i++)e&=this.elements[i].validAttributesAdministrables(t);return e}}),bizagi.editor.base.render.extend("bizagi.editor.base.collectionnavigator",{},{init:function(e,t,i){var o=this;o.validateData(e),o._super(e,t,i),o.elementFactory=t,o.form=null,o.defer=new $.Deferred,o.properties.navigationform&&o.loadForm()},loadForm:function(){var e,t=this;e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadform",form:t.properties.navigationform}),$.when(e.processRequest()).done(function(e){t.form=t.elementFactory.createElement("form",e),t.form.subscribe("getDefaultDisplayName",function(e,i){return t.triggerGlobalHandler("getDefaultDisplayName",i)}),t.defer.resolve()})},refreshControl:function(e){var t=this,i=e.canvas;$.when(t.form.getRenderingModel()).done(function(e){t.addRenderingModelProperties(e);var o=t.getRenderingFacade();$.when(o.execute({mode:"design",canvas:i,data:e})).done(function(){t.triggerGlobalHandler("resizeHeigthCanvas")})})},getRenderingModel:function(){var e=this,t=$.Deferred();return $.when(this._super()).done(function(i){i.render.properties.navigationform=e.properties.navigationform,t.resolve(i)}),t.promise()},getPersistenceModel:function(){return{elements:[],type:this.type,guid:this.guid,properties:this.filterDefaultValues(this.properties)}},getRenderingFacade:function(){return this.rendering=this.rendering||new bizagi.rendering.facade,this.rendering},addRenderingModelProperties:function(e){return e.form.properties.isNavigationForm=!0,e},validateData:function(e){e.elements&&delete e.elements}}),bizagi.editor.observableClass.extend("bizagi.editor.base.protocol.base",{},{init:function(e){var t=this;t._super(),t.args=e,t.context=e.context,t.parameters=[],t.answerParameters=[],t._ResourcesServices=bizagi.editor.base.services.resourcesServices,t._editorInfo=bizagi.editor.base.info},processRequest:function(){var e,t=this,i=new $.Deferred;t.buildRequest(),t.parameters.push(t.createParameterItem("guidContext",BIZAGI_IDENTIFIER_MODEL)),t.parameters.push(t.createParameterItem("user",BIZAGI_USER)),e=t.requestForBAS();var o=t.callRestService(e)||bizagi.editor.base.HostFacade.executeBasActions(e);return $.when(o).done(function(e){i.resolve(t.processBasAnswer(e))}).fail(function(e){bizagi.showMessageBox(bizagi.localization.getResource("confirmation-savebox-message-error")),i.reject()}),i.promise()},processBasAnswer:function(e){return e},createParameterItem:function(e,t){var i={};return i.key=e,i.value=t,i},requestForBAS:function(){var e={};return e.actiontype=this.actiontype,e.parameters=this.parameters,e},buildRequest:function(){this.parameters=[]},callRestService:function(e){return"adhocform"==this.context?this._ResourcesServices.getResource(e):!this._editorInfo.isCloud()&&this._ResourcesServices.getResource(e)},findKeyInParameters:function(e){for(var t=null,i=0,o=this.answerParameters.length;i<o;i+=1)this.answerParameters[i].key===e&&(t=this.answerParameters[i]);return t}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.ruleexpression",{},{init:function(e){var t=this;t._super(e),t.rule=t.args.data.rule||t.args.data,t.actiontype="LoadExpression"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("categorytype",e.args.categorytype)),e.isNewExpression()||e.parameters.push(e.createParameterItem("id",e.rule.baref.ref)),e.args.idcontextentity&&e.parameters.push(e.createParameterItem("idcontextentity",e.args.idcontextentity))},isNewExpression:function(){return"expression"===this.rule.baref.ref},processBasAnswer:function(e){var t,i=this,o=i.args,r=e.result;if(r.success){if(i.answerParameters=r.parameters,t=i.findKeyInParameters("id"),bizagi.util.isEmpty(t.value))return{isEmpty:!0};var n=i.findKeyInParameters("displayname")&&i.findKeyInParameters("displayname").value||null;return"rule"==o.editor?bizagi.editor.utilities.buildComplexReference(t.value,n):i.buildRuleDefinition(t.value,n)}},buildRuleDefinition:function(e,t){var i={rule:{baref:{ref:e}}};return t&&(i.rule.displayName=t),i}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.localizableresources",{},{init:function(e){this._super(e),this.actiontype="GetLocalizationProperties"},buildRequest:function(){this.parameters=[]},processBasAnswer:function(e){var t,i=e.result;return i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("resources"),JSON.parse(t.value)):i.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadinterface",{},{init:function(e){var t=this;t._super(e),t.interface=t.args.data.interface||t.args.data,t.actiontype="LoadInterface"},buildRequest:function(){var e=this;e.parameters=[],e.isNewExpression()||e.parameters.push(e.createParameterItem("id",e.interface.baref.ref)),e.args.idcontextentity&&e.parameters.push(e.createParameterItem("idcontextentity",e.args.idcontextentity)),e.args.idscopedefinition&&e.parameters.push(e.createParameterItem("idscopedefinition",e.args.idscopedefinition))},isNewExpression:function(){return"expression"===this.interface.baref.ref},processBasAnswer:function(e){var t,i=this,o=e.result;if(o.success){if(i.answerParameters=o.parameters,t=i.findKeyInParameters("id"),bizagi.util.isEmpty(t.value))return{isEmpty:!0};var r=i.findKeyInParameters("displayname")&&i.findKeyInParameters("displayname").value||null;return i.args.type.indexOf("rule")>=0?bizagi.editor.utilities.buildComplexReference(t.value,r):i.buildRuleDefinition(t.value,r)}},buildInterfaceDefinition:function(e,t){var i={baref:{ref:e}};return t&&(i.displayName=t),i}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadtemplate",{},{init:function(e){this._super(e),this.template=this.args.template,this.actiontype="LoadTemplate"},buildRequest:function(){var e=this;e.parameters=[],e.isNewTemplate()||e.parameters.push(e.createParameterItem("id",e.template.baref.ref))},isNewTemplate:function(){return"template"===this.template.baref.ref},processBasAnswer:function(e){var t,i=e.result;return i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("id"),bizagi.util.isEmpty(t.value)?{isEmpty:!0}:bizagi.editor.utilities.buildComplexReference(t.value)):i.sucess}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadsapinterface",{},{init:function(e){var t=this;t._super(e),t.interface=t.args.data.interface||t.args.data,t.actiontype="LoadSapInterface"},buildRequest:function(){var e=this;e.parameters=[],e.isNewExpression()||e.parameters.push(e.createParameterItem("id",e.interface.baref.ref)),e.args.idcontextentity&&e.parameters.push(e.createParameterItem("idcontextentity",e.args.idcontextentity)),e.args.idscopedefinition&&e.parameters.push(e.createParameterItem("idscopedefinition",e.args.idscopedefinition))},isNewExpression:function(){return"expression"===this.interface.baref.ref},processBasAnswer:function(e){var t,i=this,o=e.result;if(o.success){if(i.answerParameters=o.parameters,t=i.findKeyInParameters("id"),bizagi.util.isEmpty(t.value))return{isEmpty:!0};var r=i.findKeyInParameters("displayname")&&i.findKeyInParameters("displayname").value||null;return i.args.type.indexOf("rule")>=0?bizagi.editor.utilities.buildComplexReference(t.value,r):i.buildRuleDefinition(t.value,r)}},buildInterfaceDefinition:function(e,t){var i={baref:{ref:e}};return t&&(i.displayName=t),i}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadconnectorinterface",{},{init:function(e){var t=this;t._super(e),t.connector=t.args.data.connector||t.args.data,t.actiontype="LoadConnectorInterface"},buildRequest:function(){var e=this;e.parameters=[],e.isNewExpression()||e.parameters.push(e.createParameterItem("id",e.connector.baref.ref)),e.args.idcontextentity&&e.parameters.push(e.createParameterItem("idcontextentity",e.args.idcontextentity))},isNewExpression:function(){return"expression"===this.connector.baref.ref},processBasAnswer:function(e){var t,i=this,o=e.result;if(o.success){if(i.answerParameters=o.parameters,t=i.findKeyInParameters("id"),bizagi.util.isEmpty(t.value))return{isEmpty:!0};var r=i.findKeyInParameters("displayname")&&i.findKeyInParameters("displayname").value||null;return i.args.type.indexOf("rule")>=0?bizagi.editor.utilities.buildComplexReference(t.value,r):i.buildRuleDefinition(t.value,r)}},buildInterfaceDefinition:function(e,t){var i={baref:{ref:e}};return t&&(i.displayName=t),i}}),bizagi.editor.base.protocol.loadconnectorinterface.extend("bizagi.editor.base.protocol.loadexcelbotinterface",{},{init:function(e){var t=this;t._super(e),t.connector=t.args.data.connector||t.args.data,t.actiontype="LoadExcelBot"}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadfilter",{},{init:function(e){var t=this;t._super(e),t.actiontype="LoadFilterEditor",t.bafilter=t.args.data.bafilter,t.xpathNode=t.args.xpathNode},buildRequest:function(){var e,t,i=this;i.parameters=[],i.isNewExpression()||(e=i.createParameterItem("filter",bizagi.util.unicode2htmlencode(i.bafilter.filter)),i.parameters.push(e)),i.args.idcontextentity&&i.parameters.push(i.createParameterItem("idcontextentity",i.args.idcontextentity)),t=i.createParameterItem("idrelatedentity",i.xpathNode.guidRelatedEntity),i.parameters.push(t)},isNewExpression:function(){return"filter"===this.bafilter.filter},processBasAnswer:function(e){var t,i=e.result;return i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("filter"),bizagi.util.isEmpty(t.value)?{isEmpty:!0}:t.value):i.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.loadform",{},{init:function(e){this._super(e),this.actiontype="LoadForm",this.params=e},buildRequest:function(){var e=this,t=e.params,i=e.createParameterItem("id",bizagi.editor.utilities.resolveComplexReference(t.form));e.parameters=[],e.parameters.push(i),t.loadByParent&&e.parameters.push(e.createParameterItem("loadByParent",t.loadByParent)),t.adhocProcessId&&t.isAdhocSummaryForm&&(e.parameters.push(e.createParameterItem("adhocProcessId",t.adhocProcessId)),e.parameters.push(e.createParameterItem("isAdhocSummaryForm",t.isAdhocSummaryForm)))},processBasAnswer:function(e){var t=e.result;if(t.success){this.answerParameters=t.parameters;var i=this.findKeyInParameters("resources");return i=i&&JSON.parse(i.value),{form:JSON.parse(this.findKeyInParameters("form").value),resources:i||{}}}return!1}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.gettags",{},{init:function(e){this._super(e),this.actiontype="GetTags"},buildRequest:function(){this.parameters=this.args.parameters||[]},processBasAnswer:function(e){var t=e.result;return t.success?t.parameters:t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getmetadata",{context:/\.(\w+)$/},{init:function(e){this._super(e),this.actiontype="GetMetadata"},buildRequest:function(){this.parameters=[];var e=this.Class.context.exec(this.args.xpath),t=e?e[1]:"";this.parameters.push(this.createParameterItem("context",t))},processBasAnswer:function(e){var t,i=e.result;return i?i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("data"),JSON.parse(t.value)):i.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.opennestedform",{},{init:function(e){this._super(e),this.actiontype="OpenNestedForm",this.refForm=this.args.refForm},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("id",e.refForm.baref.ref)),e.parameters.push(e.createParameterItem("guidRender",e.args.idForm))}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.relatedentity",{},{init:function(e){this._super(e),this.actiontype="LoadEntityValues",this.xpath=bizagi.editor.utilities.resolveComplexXpath(e.xpath)},buildRequest:function(){var e;this.parameters=[],e=this.createParameterItem("xpath",this.replaceFilterCollectionInXpath()),this.parameters.push(e)},processBasAnswer:function(e){var t;if(!e)return{};var i=e.result;return i.success?(this.answerParameters=i.parameters,(t=this.findKeyInParameters("values"))?this.transformResult(JSON.parse(t.value)):{}):i.success},replaceFilterCollectionInXpath:function(){return this.args.xpath.replace("[]","")},transformResult:function(e){for(var t={},i=0,o=e.length;i<o;i+=1)t[e[i].id]=e[i].displayName;return t}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.createform",{},{init:function(e){this._super(e),this.actiontype="CreateForm"},buildRequest:function(){var e=this;e.parameters=[],e.args.xpath&&e.parameters.push(e.createParameterItem("xpath",e.args.xpath)),e.args.relatedEntity&&e.parameters.push(e.createParameterItem("relatedEntity",e.args.relatedEntity)),e.args.isScopeAttribute&&e.parameters.push(e.createParameterItem("isScopeAttribute",e.args.isScopeAttribute)),e.args.showForm&&e.parameters.push(e.createParameterItem("showForm",e.args.showForm)),e.parameters.push(e.createParameterItem("guidRender",e.args.guid)),e.parameters.push(e.createParameterItem("propertyName",e.args.propertyName)),e.parameters.push(e.createParameterItem("context",e.args.context))}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.multilanguage",{},{init:function(e){this._super(e),this.actiontype="LoadLocalizationForm"},buildRequest:function(){var e;this.parameters=[],e=this.createParameterItem("values",bizagi.util.unicode2htmlencode(JSON.stringify(this.args.i18n))),this.parameters.push(e)},processBasAnswer:function(e){var t,i=e.result;return i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("localization"),JSON.parse(t.value)):i.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.relatedforms",{},{init:function(e){this._super(e),this.actiontype="GetReleatedEntityForms"},buildRequest:function(){var e=this;e.parameters=[],e.args.xpath&&e.parameters.push(e.createParameterItem("xpath",e.args.xpath)),e.args.relatedEntity&&e.parameters.push(e.createParameterItem("relatedEntity",e.args.relatedEntity)),e.args.isScopeAttribute&&e.parameters.push(e.createParameterItem("isScopeAttribute",e.args.isScopeAttribute)),e.parameters.push(e.createParameterItem("context",e.args.context))},processBasAnswer:function(e){var t,i=e.result;return i?i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("forms"),JSON.parse(t.value)):i.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.gridvalidations",{},{init:function(e){this._super(e),this.actiontype="LoadGridValidations"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("xpath",e.args.xpath)),e.parameters.push(e.createParameterItem("guidRender",e.args.guidRender)),bizagi.editor.utilities.isObject(e.args.gridValidations)&&e.args.gridValidations.validations&&e.parameters.push(e.createParameterItem("validations",bizagi.util.unicode2htmlencode(JSON.stringify(e.args.gridValidations))))},processBasAnswer:function(e){var t=e.result;if(!t)return e;if(t.success){this.answerParameters=t.parameters;var i=this.findKeyInParameters("validations");return JSON.parse(i.value)}return t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getcontrolsdefinitions",{},{init:function(e){this._super(e),this.actiontype="GetControlDefinitions"},buildRequest:function(){this.parameters=[]},processBasAnswer:function(e){var t=e.result;if(t.success){this.answerParameters=t.parameters;var i=JSON.parse(this.findKeyInParameters("definitions").value);if("startform"===this.context){var o=["actionlauncher","polymorphiclauncher"];i.controls=i.controls.filter(function(e){return!o.includes(e.name)})}return i}return t.success},processRequest:function(){var e=new $.Deferred;return $.when(bizagi.editor.base.protocol.base.prototype.processRequest.apply(this,arguments)).done(function(t){definitions=t,e.resolve(definitions)}),e.promise()}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getlayoutsdefinitions",{},{init:function(e){this._super(e),this.actiontype="GetLayoutDefinitions"},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,JSON.parse(this.findKeyInParameters("layouts").value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getentitytype",{},{init:function(e){this._super(e),this.actiontype="GetEntityType"},buildRequest:function(){this.parameters=[],this.parameters.push(this.createParameterItem("EntityGuid",this.args.entityGuid))},processBasAnswer:function(e){var t=e.result;return t?t.success?(this.answerParameters=t.parameters,{entityType:this.findKeyInParameters("entityType").value}):t.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.entityvaluepicker",{},{init:function(e){this._super(e),this.actiontype="EntityValuePicker",this.contextEntityId=e.contextEntityId,this.xpath=e.xpath},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("contextentityid",e.args.contextEntityId)),e.parameters.push(e.createParameterItem("xpath",e.replaceFilterCollectionInXpath()))},replaceFilterCollectionInXpath:function(){return this.args.xpath.replace("[]","")},processBasAnswer:function(e){var t={};if(e&&e.result&&e.result.parameters.length)if(t.success=e.result.success,this.answerParameters=e.result.parameters,e.result.success){var i=$.parseJSON(this.findKeyInParameters("selectedValue").value);t.key="selectedValue",t.businessKeyValues=i.businesskeyvalues,t.label=i.displaytext,t.contextEntity=i.contextentity,t.surrogateKeyGuid=i.surrogateKeyGuid}else t.key="noParameter",t.value=this.findKeyInParameters("noParameter").value;else t.key="cancel";return t}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getdependency",{},{init:function(e){this._super(e),this.actiontype="GetDependency"},processBasAnswer:function(e){var t=e.result;return t?t.success?(this.answerParameters=t.parameters,bizagi.util.parseBoolean(this.findKeyInParameters("canBeChanged").value)):t.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getfirstload",{},{init:function(e){this._super(e),this.actiontype="XpathNavigatorFirstLoad"},buildRequest:function(){var e=this;e.parameters=[],e.args.adhocProcessId&&e.parameters.push(e.createParameterItem("adhocProcessId",e.args.adhocProcessId))},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,JSON.parse(this.findKeyInParameters("root").value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getchildrennodes",{},{init:function(e){this._super(e),this.actiontype="XpathNavigatorExpandLoad"},buildRequest:function(){var e=this,t=e.args.node,i=t.xpath;t.isRootNode&&(i=""),e.parameters=[],e.parameters.push(e.createParameterItem("contextScope",t.contextScope)),e.parameters.push(e.createParameterItem("guid",t.guidRelatedEntity)),e.parameters.push(e.createParameterItem("xpath",i)),e.parameters.push(e.createParameterItem("style",t.style)),e.parameters.push(e.createParameterItem("isScopeAttribute",t.isScopeAttribute)),t.entityContext&&e.parameters.push(e.createParameterItem("entityContext",t.entityContext)),t.xpathAdhoc&&e.parameters.push(e.createParameterItem("xpathAdhoc",t.xpathAdhoc))},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,JSON.parse(this.findKeyInParameters("children").value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.selectprocess",{},{init:function(e){this._super(e),this.actiontype="SelectProcess"},buildRequest:function(){},processBasAnswer:function(e){}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.editentity",{},{init:function(e){this._super(e),this.actiontype="LoadEditEntity"},buildRequest:function(){var e;this.parameters=[],e=this.createParameterItem("id",this.args.id),this.parameters.push(e)},processBasAnswer:function(e){if(e&&e.result)return e.result.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.openform",{},{init:function(e){this._super(e),this.actiontype="OpenForm"},buildRequest:function(){this.parameters=[],this.parameters.push(this.createParameterItem("id",this.args.idform))}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.saveform",{},{init:function(e){this._super(e),this.actiontype="SaveForm"},buildRequest:function(){var e=this;e.parameters=[],e.args.jsonForm&&e.parameters.push(e.createParameterItem("json",bizagi.util.unicode2htmlencode(JSON.stringify(e.args.jsonForm)))),e.parameters.push(e.createParameterItem("changeset",JSON.stringify(e.args.changeset))),e.parameters.push(e.createParameterItem("idForm",e.args.idForm)),(e.args.adhocTaskId||e.args.isAdhocSummaryForm)&&(e.parameters.push(e.createParameterItem("adhocTaskId",e.args.adhocTaskId)),e.parameters.push(e.createParameterItem("adhocProcessId",e.args.adhocProcessId)),e.parameters.push(e.createParameterItem("isAdhocSummaryForm",e.args.isAdhocSummaryForm)))},processBasAnswer:function(e){var t=this,i=e.result;if(!i)return e;if(i.success){t.answerParameters=i.parameters;var o=t.findKeyInParameters("resources"),r=t.findKeyInParameters("canBeSaved"),n=t.findKeyInParameters("userInfo"),a=t.findKeyInParameters("isInCheckout");return r=!r,{resources:o=o&&JSON.parse(o.value),canBeSaved:r,userInfo:n=n?JSON.parse(n.value):n,isInCheckout:a=!!a&&bizagi.util.parseBoolean(a.value)}}return i.success}}),bizagi.editor=bizagi.editor||{},bizagi.editor.communicationprotocol=bizagi.editor.communicationprotocol||{},bizagi.editor.communicationprotocol.factory=function(){return{setContext:function(e){this.context=e},createProtocol:function(args){if(void 0===args.protocol)throw"The argument must contain a protocol to create the protocol instance";try{var fn=eval("var bafn = function(args) {  return new bizagi.editor.base.protocol."+args.protocol+"(args);};bafn"),arguments=args.context?args:$.extend(args,{context:this.context}),command=fn(arguments);return command}catch(e){throw"Can't create a protocol for "+args.protocol}}}}(),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.copyform",{},{init:function(e){this._super(e),this.actiontype="LoadCopyForm"},processBasAnswer:function(e){var t=e.result;if(t.success){this.answerParameters=t.parameters;var i=JSON.parse(this.findKeyInParameters("form").value),o=JSON.parse(this.findKeyInParameters("resources").value)||[];return{form:i,resources:o=o.map(function(e){var t=JSON.parse(e.Content);return t.languages&&"string"==typeof t.languages&&(t.languages=JSON.parse(t.languages)),t})}}return t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.editentityvalues",{},{init:function(e){this._super(e),this.actiontype="LoadEditEntityValues"},buildRequest:function(){var e;this.parameters=[],e=this.createParameterItem("id",this.args.id),this.parameters.push(e)},processBasAnswer:function(e){if(e&&e.result)return e.result.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.newform",{},{init:function(e){this._super(e),this.actiontype="CreateFormFromXpath"},buildRequest:function(){var e=this,t=e.args.node;e.parameters=[],e.parameters.push(e.createParameterItem("context",t.contextScope)),e.parameters.push(e.createParameterItem("isScopeAttribute",t.isScopeAttribute)),e.parameters.push(e.createParameterItem("idContextEntity",t.guidRelatedEntity)),e.parameters.push(e.createParameterItem("guidForm",t.id))}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.documenttemplates",{},{init:function(e){this._super(e),this.actiontype="LoadDocumentTemplates"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("append",e.args.append)),e.parameters.push(e.createParameterItem("xpath",e.args.xpath)),e.args.idContextEntity&&e.parameters.push(e.createParameterItem("idContextEntity",e.args.idContextEntity)),e.args.groupmapping&&e.parameters.push(e.createParameterItem("groupmapping",bizagi.editor.utilities.resolveComplexReference(e.args.groupmapping)))},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,this.findKeyInParameters("id").value):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.availablelanguages",{},{init:function(e){this._super(e),this.actiontype="GetAvailableLanguages"},processBasAnswer:function(e){var t=e.result;return t.success?t.parameters:t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.installwidget",{},{init:function(e){this._super(e),this.actiontype="InstallWidget"},processBasAnswer:function(e){return e.result.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.openwidgetstore",{},{init:function(e){this._super(e),this.actiontype="OpenWidgetstore"},processBasAnswer:function(e){return e.result.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getwidgets",{},{init:function(e){this._super(e),this.actiontype="GetWidgets"},buildRequest:function(){this.parameters=[]},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,!!this.findKeyInParameters("widgets")&&JSON.parse(this.findKeyInParameters("widgets").value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.closeform",{},{init:function(e){this._super(e),this.actiontype="CloseForm"}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getmultiplerelationship",{},{init:function(e){this._super(e),this.actiontype="GetMultipleRelationship"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("leftEntityId",e.args.leftEntityId)),e.args.rightEntityId&&e.parameters.push(e.createParameterItem("rightEntityId",e.args.rightEntityId))},processBasAnswer:function(e){var t=this,i=e.result;if(i.success){t.answerParameters=i.parameters;var o=[];t.findKeyInParameters("leftfact")&&(o=t.findKeyInParameters("leftfact").value,o=JSON.parse(o));var r=[];return t.findKeyInParameters("rightfact")&&(r=t.findKeyInParameters("rightfact").value,r=JSON.parse(r)),{leftfact:o,rightfact:r}}return i.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getparententities",{},{init:function(e){this._super(e),this.actiontype="GetParentEntities"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("id",e.args.id)),e.parameters.push(e.createParameterItem("xpath",e.args.xpath))},processBasAnswer:function(e){var t;if(!e)return{};var i=e.result;return i.success?(this.answerParameters=i.parameters,t=this.findKeyInParameters("values"),bizagi.util.isEmpty(t.value)?{isEmpty:!0}:JSON.parse(t.value)):i.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getattributedisplayname",{},{init:function(e){this._super(e),this.actiontype="GetAttributeDisplayName"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("xpathattribute",bizagi.editor.utilities.resolveComplexXpath(e.args.xpath))),e.parameters.push(e.createParameterItem("guidentity",e.geGuidEntity()));var t=e.isScope();e.parameters.push(e.createParameterItem("isscope",t)),"default"!==bizagi.editorLanguage.key&&e.parameters.push(e.createParameterItem("language",bizagi.editorLanguage.displayname)),t&&e.parameters.push(e.createParameterItem("scopeDefinition",bizagi.editor.utilities.resolveScopeContextFromXpath(e.args.xpath)))},processBasAnswer:function(e){var t=e.result;return t?t.success?(this.answerParameters=t.parameters,{displayName:this.findKeyInParameters("displayname").value,defaultValue:this.findKeyInParameters("default").value}):t.success:e},geGuidEntity:function(){return bizagi.editor.utilities.resolveContextEntityFromXpath(this.args.xpath)||bizagi.editor.utilities.resolveScopeContextFromXpath(this.args.xpath)},isScope:function(){return!!bizagi.editor.utilities.resolveScopeContextFromXpath(this.args.xpath)}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getmetadataattributedisplayname",{},{init:function(e){this._super(e),this.actiontype="GetMetadataAttributeDisplayName"},buildRequest:function(){var e=this;e.parameters=[];var t=bizagi.editor.utilities.resolveComplexXpath(e.args.xpath);t=t.replace(/\./g,"_").replace("@",""),e.parameters.push(e.createParameterItem("xpathattribute",t)),"default"!==bizagi.editorLanguage.key&&e.parameters.push(e.createParameterItem("language",bizagi.editorLanguage.displayname))},processBasAnswer:function(e){var t=e.result;return t?t.success?(this.answerParameters=t.parameters,{displayName:this.findKeyInParameters("displayname").value,defaultValue:this.findKeyInParameters("default").value}):t.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getruledisplayname",{},{init:function(e){this._super(e),this.actiontype="GetRuleDisplayName"},buildRequest:function(){var e=this;e.parameters=[];var t=e.args.rule?bizagi.editor.utilities.resolveComplexReference(e.args.rule):e.args.guid;e.parameters.push(e.createParameterItem("guidRule",t))},processBasAnswer:function(e){var t=e.result;return t?t.success?(this.answerParameters=t.parameters,{displayName:this.findKeyInParameters("displayname").value}):t.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getformdisplayname",{},{init:function(e){this._super(e),this.actiontype="GetFormDisplayName"},buildRequest:function(){this.parameters=[],this.parameters.push(this.createParameterItem("guidForm",this.args.guid))},processBasAnswer:function(e){var t=e.result;return t?t.success?(this.answerParameters=t.parameters,{displayName:this.findKeyInParameters("displayname").value}):t.success:e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.checkflags",{},{init:function(e){this._super(e),this.actiontype="CheckFlags"},buildRequest:function(){this.parameters=[];var e=this.args.flags;if(e)for(var t in e)this.parameters.push(this.createParameterItem(t,!0))},processBasAnswer:function(e){var t=e.result;if(t.success){for(var i={},o=0,r=t.parameters.length;o<r;o++)i[t.parameters[o].key]=bizagi.util.parseBoolean(t.parameters[o].value);return this.processFlags(i)}return t.success},processFlags:function(e){return void 0!==e.EnableLetters&&(e.letter=e.columnletter=!e.EnableLetters),e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.checkoutform",{},{init:function(e){this._super(e),this.actiontype="CheckoutForm"},buildRequest:function(){var e=this;e.parameters=[],e.args.loadForm&&e.parameters.push(e.createParameterItem("loadForm",!0)),e.args.forceCheckin&&e.parameters.push(e.createParameterItem("forceCheckin",!0))},processBasAnswer:function(e){var t=this,i=e.result;if(i.success){t.answerParameters=i.parameters;var o=!!t.findKeyInParameters("userInfo")&&bizagi.util.parseBoolean(t.findKeyInParameters("isInCheckout").value),r=null;t.findKeyInParameters("userInfo")&&(r=t.findKeyInParameters("userInfo").value,r=JSON.parse(r));var n=null;return t.findKeyInParameters("form")&&(n=t.findKeyInParameters("form").value,n=JSON.parse(n)),{isInCheckout:o,userInfo:r,form:n}}return i.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getstatusform",{},{init:function(e){this._super(e),this.actiontype="GetStatusForm"},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,{isInCheckout:bizagi.util.parseBoolean(this.findKeyInParameters("isInCheckout").value)}):t.success},processFlags:function(e){return void 0!==e.EnableGroupedGridControl&&(e.groupedgrid=!e.EnableGroupedGridControl),void 0!==e.EnableCollectionNavigatorControl&&(e.collectionnavigator=!e.EnableCollectionNavigatorControl),e}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getstakeholders",{},{init:function(e){this._super(e),this.actiontype="GetStakeHolders"},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,itemParameter=this.findKeyInParameters("stakeholders"),JSON.parse(itemParameter.value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.gettemplates",{},{init:function(e){this._super(e),this.actiontype="GetTemplatesByEntity"},buildRequest:function(){this.parameters=[],this.parameters.push(this.createParameterItem("entityGuid",this.args.entityGuid))},processBasAnswer:function(e){var t=e.result;return t.success?(this.answerParameters=t.parameters,itemParameter=this.findKeyInParameters("templates"),JSON.parse(itemParameter.value).filter(function(e){return e.ShowInProcesses&&e.Enable})):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.switchform",{init:function(e){this._super(e),this.actiontype="SwitchForm"},buildRequest:function(){},processBasAnswer:function(e){}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.setuseoffline",{init:function(e){this._super(e),this.actiontype="SetUseOffline"},buildRequest:function(){var e;this.parameters=[],e=this.createParameterItem("value",this.args.value),this.parameters.push(e)},processBasAnswer:function(e){return e.result}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.showwizardtemplates",{},{init:function(e){this._super(e),this.actiontype="OpenWizardTemplates"},buildRequest:function(){var e=this,t=e.args;e.parameters=[],t.xpath&&e.parameters.push(e.createParameterItem("xpath",t.xpath)),t.relatedEntity&&e.parameters.push(e.createParameterItem("relatedEntity",t.relatedEntity)),t.isScopeAttribute&&e.parameters.push(e.createParameterItem("isScopeAttribute",t.isScopeAttribute)),t.guidControl&&e.parameters.push(e.createParameterItem("guidControl",t.guidControl)),t.propertyName&&e.parameters.push(e.createParameterItem("propertyName",t.propertyName))}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getadhocdataschema",{},{init:function(e){this._super(e),this.actiontype="GetAdhocDataSchema"},buildRequest:function(){this.parameters=[],this.parameters.push(this.createParameterItem("adhocProcessId",this.args.adhocProcessId))},processBasAnswer:function(e){var t=e.result;return t.success&&t.parameters.length>0?(this.answerParameters=t.parameters,itemParameter=this.findKeyInParameters("dataSchema"),JSON.parse(itemParameter.value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getadhocdatasources",{},{init:function(e){this._super(e),this.actiontype="GetAdhocDataSources"},buildRequest:function(){this.parameters=[],this.parameters.push(this.createParameterItem("adhocProcessId",this.args.adhocProcessId))},processBasAnswer:function(e){var t=e.result;return t.success&&t.parameters.length>0?(this.answerParameters=t.parameters,itemParameter=this.findKeyInParameters("dataSources"),JSON.parse(itemParameter.value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getadhocentityattribs",{},{init:function(e){this._super(e),this.actiontype="GetAdhocEntityAttribs"},buildRequest:function(){this.parameters=this.args.parameters||[]},processBasAnswer:function(e){var t=e.result;return t.success&&t.parameters.length>0?(this.answerParameters=t.parameters,itemParameter=this.findKeyInParameters("attributes"),JSON.parse(itemParameter.value)):t.success}}),bizagi.editor.base.protocol.base.extend("bizagi.editor.base.protocol.getpredefinedvalues",{},{init:function(e){this._super(e),this.actiontype="GetPredefinedValues"},buildRequest:function(){var e=this;e.parameters=[],e.parameters.push(e.createParameterItem("adhocProcessId",e.args.adhocProcessId)),e.parameters.push(e.createParameterItem("property",e.args.property))},processBasAnswer:function(e){var t=e.result;return t.success&&t.parameters.length>0?(this.answerParameters=t.parameters,itemParameter=this.findKeyInParameters("predefinedValues"),itemParameter.value):t.success}}),bizagi.editor.component.controller("bizagi.editor.component.layout",{init:function(e,t){t=t||{},this._super(e),this.model=t.model,this.canvas=e,this.presenter=t.presenter,this.context=t.context,this.isActivityForm=t.isActivityForm},loadTemplates:function(){var e={frames:bizagi.getTemplate("bizagi.editor.component.layout").concat("#layout-frames"),tabs:bizagi.getTemplate("bizagi.editor.component.layout").concat("#layout-left-tabs")};return this._super(e)},refresh:function(){this.render()},render:function(){var e=this;return $.when(e.loadTemplates()).done(function(){e.renderFrames(e.element),e.leftPanel=e.element.find(".left-panel"),setTimeout(function(){e.applyThemeToLayout()},100),window.myResize=e.applyThemeToLayout,$(window).bind("resize.windowPanel",function(){return e.applyThemeToLayout()}),e.renderTabs(e.leftPanel)})},applyThemeToLayout:function(){var e=this;if(!bizagi.form.modeler.params.reviewMode){var t,i,o,r;e=this;r=$(".left-panel",e.canvas),i=$(".wrapper-left-panel",e.canvas),o=e.canvas.outerHeight()-$(".ribbon-panel",e.canvas).outerHeight(),i.css("height",o),t=parseFloat(r.css("margin-top"))+parseFloat(r.css("margin-bottom")),i.height()-t-(parseFloat(i.css("padding-top"))+parseFloat(i.css("padding-bottom"))),$(".ui-tabs-panel",r).addClass("ui-resized")}},renderFrames:function(e){$.tmpl(this.getTemplate("frames"),{context:this.context,isActivityForm:this.isActivityForm}).appendTo(e)},renderTabs:function(e){$.tmpl(this.getTemplate("tabs")).appendTo(e)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.layout.presenter",{},{init:function(e){this._super(),e=e||{},this.layout=new bizagi.editor.component.layout(e.canvas,{model:e.model,presenter:this,context:e.context,isActivityForm:e.isActivityForm})},render:function(e){return this.layout.render(e)},refresh:function(){this.layout.applyThemeToLayout()}}),bizagi.editor.component.controller("bizagi.editor.component.smartphone.layout",{init:function(e,t){t=t||{},this._super(e),this.model=t.model,this.canvas=e,this.presenter=t.presenter,this.context=t.context,this.isActivityForm=t.isActivityForm},loadTemplates:function(){var e={"smartphone-frames":bizagi.getTemplate("bizagi.editor.component.smartphone.layout").concat("#smartphone-layout-frames"),"smartphone-tabs":bizagi.getTemplate("bizagi.editor.component.smartphone.layout").concat("#smartphone-layout-left-tabs")};return this._super(e)},refresh:function(){this.render()},render:function(){var e=this;return $.when(e.loadTemplates()).done(function(){e.renderFrames(e.element),e.leftPanel=e.element.find(".left-panel"),setTimeout(function(){e.applyThemeToLayout()},100),window.myResize=e.applyThemeToLayout,$(window).bind("resize.windowPanel",function(){return e.applyThemeToLayout()}),e.renderTabs(e.leftPanel)})},applyThemeToLayout:function(){if(!bizagi.form.modeler.params.reviewMode){var e,t,i,o;o=$(".left-panel",this.canvas),t=$(".wrapper-left-panel",this.canvas),i=this.canvas.outerHeight()-$(".ribbon-panel",this.canvas).outerHeight(),t.css("height",i),e=parseFloat(o.css("margin-top"))+parseFloat(o.css("margin-bottom")),t.height()-e-(parseFloat(t.css("padding-top"))+parseFloat(t.css("padding-bottom"))),$(".ui-tabs-panel",o).addClass("ui-resized")}},renderFrames:function(e){$.tmpl(this.getTemplate("smartphone-frames"),{context:this.context,isActivityForm:this.isActivityForm}).appendTo(e)},renderTabs:function(e){$.tmpl(this.getTemplate("smartphone-tabs")).appendTo(e)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.smartphone.layout.presenter",{},{init:function(e){this._super(),e=e||{},this.layout=new bizagi.editor.component.smartphone.layout(e.canvas,{model:e.model,presenter:this,context:e.context,isActivityForm:e.isActivityForm})},render:function(e){return this.layout.render(e)},refresh:function(){this.layout.applyThemeToLayout()}}),bizagi.editor.component.controller("bizagi.editor.component.dialog",{},{init:function(e,t){this._super(),t=t||{},this.canvas=e,this.model=t.model,this.presenter=t.presenter},loadTemplates:function(){var e={"content-dialog":bizagi.getTemplate("bizagi.editor.component.dialog").concat("#dialog-container")};return this._super(e)},render:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.dialogTemplate=e.getTemplate("content-dialog");$.tmpl(i,e.model.getModel()).appendTo(t)})},destroy:function(e){this.element.detach(),this.publish("close",e)},".bz-fm-dialog-button  click":function(e){var t=e.data("key");if(t)var i=this.model.getClickEvent(t);this.destroy(i)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.dialog.model",{},{init:function(e){this._super(),this.events={},this.processData(e)},processData:function(e){var t=this;t.model=e,e.buttons&&$.each(e.buttons,function(e,i){i.icon=i.text?i.text.toLowerCase():"",i.style=i.style?i.style:"","function"==typeof i.click&&(t.events[i.text]=i.click)})},getModel:function(){return this.model},getName:function(){return this.model.name},getTitle:function(){return this.model.title},getStyle:function(){return this.model.style},getClickEvent:function(e){return this.events[e]}}),bizagi.editor.observableClass.extend("bizagi.editor.component.dialog.presenter",{},{init:function(){this._super()},show:function(e){var t=this,i=new $.Deferred,o=new bizagi.editor.component.dialog.model(e.data),r=t.popup=bizagi.createPopup({name:o.getName(),container:"form-modeler",title:o.getTitle(),onClose:function(e){i.resolve(e)}});return t.dialog=new bizagi.editor.component.dialog(r.content,{model:o,presenter:t}),t.dialog.subscribe("close",function(e,i){t.onClose(i)}),t.dialog.render(),i.promise()},onClose:function(e){this.popup.close(e)}}),bizagi.editor.component.controller("bizagi.editor.component.blockedformsdialog",{},{init:function(e,t){this._super(),t=t||{},this.canvas=e,this.model=t.model,this.presenter=t.presenter},loadTemplates:function(){var e={"content-blockedformsdialog":bizagi.getTemplate("bizagi.editor.component.blockedformsdialog").concat("#blockedformsdialog-container")};return this._super(e)},render:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.dialogTemplate=e.getTemplate("content-blockedformsdialog");$.tmpl(i,e.model.getModel()).appendTo(t)})},destroy:function(e){this.element.detach(),this.publish("close",e)},"button.btn-forceCheckout   click":function(e){this.presenter.publish("unlockformevent"),this.destroy()},"button.btn-cancel click":function(e){this.destroy()}}),bizagi.editor.observableClass.extend("bizagi.editor.component.blockedformsdialog.model",{},{init:function(e){this._super(),this.events={},this.processData(e)},processData:function(e){var t=this;t.model=e,e.buttons&&$.each(e.buttons,function(e,i){i.icon=i.text?i.text.toLowerCase():"",i.style=i.style?i.style:"","function"==typeof i.click&&(t.events[i.text]=i.click)})},getModel:function(){return this.model},getName:function(){return this.model.name},getTitle:function(){return this.model.title},getStyle:function(){return this.model.style},getClickEvent:function(e){return this.events[e]}}),bizagi.editor.observableClass.extend("bizagi.editor.component.blockedformsdialog.presenter",{},{init:function(){this._super()},show:function(e){var t=this,i=new $.Deferred,o=new bizagi.editor.component.blockedformsdialog.model(e.data),r=t.popup=bizagi.createPopup({name:o.getName(),container:"form-modeler",title:o.getTitle(),additionalClass:"someClass",onClose:function(e){i.resolve(e)}});return t.dialog=new bizagi.editor.component.blockedformsdialog(r.content,{model:o,presenter:t}),t.dialog.subscribe("close",function(e,i){t.onClose(i)}),t.dialog.render(),i.promise()},onClose:function(e){this.popup.close(e)}}),bizagi.editor.component.controller("bizagi.editor.component.controlsnavigator",{init:function(e,t){var i=this;i._super(),t=t||{},i.model=t.model,i.canvas=e,i.presenter=t.presenter,i.tmpl={}},render:function(e){var t=this;e=e||{},t.isReadOnly="undefined"!=e.isReadOnly&&bizagi.util.parseBoolean(e.isReadOnly),t.isAdhocFormContext=e.isAdhocFormContext,t.element.empty(),$.when(t.loadTemplates()).done(function(){t.renderGroups(t.element,t.model.groups),t.isReadOnly||setTimeout(function(){t.setDraggableItems()},1e3),t.element.data().hasOwnProperty("ui-accordion")&&t.element.accordion("destroy"),t.isAdhocFormContext?t.element.accordion({header:"> .mtool-group > .mtool-group-header",heightStyle:"content",collapsible:!0}):t.element.accordion({header:"> .mtool-group > .mtool-group-header",heightStyle:"content",collapsible:!0,active:!1})})},renderGroups:function(e,t){var i=this;$.each(t,function(t,o){var r=$.tmpl(i.getTemplate("group"),o);i.renderItems(r.find(".mtool-group-items"),o.items),r.appendTo(e)})},renderItems:function(e,t){var i=this;$.each(t,function(t,o){o.name=o.name.replace("column",""),$.when(o.icon).done(function(t){o.icon=t;var r=$.tmpl(i.getTemplate("item"),o);r.data("render",{name:o.id,type:o.type,icon:t,displayName:o.name,style:o.style}),r.appendTo(e)})})},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("group",bizagi.getTemplate("bizagi.editor.component.controlsnavigator").concat("#mtool-group")),this.loadTemplate("item",bizagi.getTemplate("bizagi.editor.component.controlsnavigator").concat("#mtool-item")),this.loadTemplate("helper",bizagi.getTemplate("bizagi.editor.component.controlsnavigator").concat("#mtool-helper"))).done(function(){e.resolve()}),e.promise()},setDraggableItems:function(){var e=this,t=e.presenter.publish("getMainPanel"),i=e.presenter.publish("getMainContainer");$(".mtool-item",i).data("self",e),$(".mtool-item",i).draggable({helper:function(t,i){return e.draggableHelper(t,i)},connectToSortable:".ui-bizagi-container-connectedSortable.ui-bizagi-container",distance:15,start:function(o,r){var n,a,s,l,d;n=$(o.currentTarget),t.addClass("bz-main-dashed-grid"),n.addClass("ui-dragging"),a=$(".wrapper-main-panel",i),s=$(".wrapper-main-scroll",a),t.addClass("ui-start-drag"),e.presenter.publish("controlRefreshCanvas",{}),t.hasClass("biz-auto-height")&&(l=a.position().top+parseFloat(a.css("padding-top"))+parseFloat(a.css("margin-top"))+50,d=s.outerHeight(),bizagi.util.autoScroll(s,l,d,"controlsnavigator"))},stop:function(e,i){var o,r;o=$(e.currentTarget),r=$(this).data("self"),t.removeClass("bz-main-dashed-grid").removeClass("ui-start-drag"),o.removeClass("ui-dragging"),bizagi.util.removeAutoScroll("autoscroll","controlsnavigator"),r.presenter.publish("controlRefreshCanvas",{})},containment:"document"})},draggableHelper:function(e,t){var i,o,r,n,a=$(e.currentTarget),s=this.presenter.publish("getMainContainer");return a.addClass("ui-dragging"),o=a.data("id"),r=a.data("caption"),icon=a.data("render")&&a.data("render").icon,style=a.data("render")&&a.data("render").style,i=a.data("self"),(n=$.tmpl(i.getTemplate("helper"),{id:o,caption:r,icon:icon,style:style})).appendTo(s).css({zIndex:900}),widthLabel=parseFloat(a.find(".mtool-item-name").width()||100),widthIcon=parseFloat($(".biz-ico",n).eq(0).width()),widthTotal=widthLabel+widthIcon+40+"px",n.css("width",widthTotal),n},updateModel:function(e){this.model=e},".mtool-item dblclick":function(e){var t,i,o=e.data("render");this.presenter.publish("controlDoubleClick",{name:o.name,type:o.type,displayName:o.displayName}),i=(t=$(".wrapper-main-scroll"))[0].scrollHeight,t.scrollTop(i),elementLast=$(".ui-bizagi-container-form > div:last",t),bizagi.util.highLightElement(elementLast)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.controlsnavigator.presenter",{},{init:function(e){var t=this;t._super(),e=e||{},t.canvas=e.canvas,t.model=e.model,t.controlsNavigator=new bizagi.editor.component.controlsnavigator(t.canvas,$.extend(e,{presenter:t}))},render:function(e){var t=this;return e=e||{},t.model=e.model||t.model,t.controlsNavigator.updateModel(t.model),t.controlsNavigator.render(e)}}),bizagi.editor.component.controller("bizagi.editor.component.banner",{init:function(e,t){var i=this;t=t||{},i._super(e),i.canvas=e,i.presenter=t.presenter,i.model=t.model,i.data=t.data,i.tmpl={}},updateModel:function(e){this.model=e,this.update()},render:function(){var e=this;$.when(e.loadTemplates()).done(function(){e.element.show(),e.element.empty(),e.renderbanner(e.element,e.model)})},renderbanner:function(e,t){var i,o=t.banner.displayname,r=t.banner.icon,n=t.banner.cite;this.bannerModel=t,t.banner.on&&(i=$.tmpl(this.getTemplate("banner"),{caption:o,icon:r,cite:n}),e.css("position","relative"),e.append(i),$(".ui-tabs-panel",this.data.element).addClass("ui-wbanner-space-show"),(this.visibility="hide")&&this.hide())},remove:function(){this.element.hide(),this.element.empty()},hide:function(){this.visibility="hide",$(".ui-tabs-panel",this.data.element).removeClass("ui-wbanner-space-show").addClass("ui-wbanner-space-hide"),this.element.hide()},show:function(){this.visibility="show",$(".ui-tabs-panel",this.data.element).removeClass("ui-wbanner-space-hide").addClass("ui-wbanner-space-show"),this.element.show("slow"),this.element.css("overflow","visible")},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("banner",bizagi.getTemplate("bizagi.editor.component.banner").concat("#banner-component"))).done(function(){e.resolve()}),e.promise()},destroy:function(){this.element.detach()},".bizagi-editor-banner-container click":function(e,t){t.stopPropagation(),this.presenter.publish("onBannerClick",{model:this.bannerModel,reference:this})}}),bizagi.editor.observableClass.extend("bizagi.editor.component.banner.presenter",{},{init:function(e){var t=this;e=e||{},t._super(),t.canvas=e.canvas,t.model=e.model,t.bannerElement=e.data.element,t.banner=new bizagi.editor.component.banner(t.canvas,$.extend(e,{presenter:t}))},destroy:function(){this.banner.destroy()},remove:function(){this.banner.remove()},getBannerElement:function(){return this.bannerElement},render:function(e){var t=this;return e=e||{},t.model=e.model||t.setModel(),t.banner.updateModel(t.model),t.banner.render(e)},hide:function(){this.banner.hide()},show:function(){this.banner.show()},setModel:function(){var e=(new bizagi.editor.component.banner.model).getBannerModel();return this.banner.updateModel(e),e}}),bizagi.editor.component.controller("bizagi.editor.component.editableLabel",{init:function(e,t){this._super(e),this.canvas=e,this.params=t,this.presenter=t.presenter},loadTemplates:function(){var e={editableLabel:bizagi.getTemplate("bizagi.editor.component.editablelabel")};return this._super(e)},render:function(){var e=this,t=e.params;$.when(e.loadTemplates()).done(function(){var i=e.editablelabel=$.tmpl(e.getTemplate("editableLabel"),{value:t.value});i.width(t.label.width()),t.label.hide(),t.label.after(i);var o=i.find("input"),r=t.value,n=i.width()-50;o.width(n),o.keyup(function(t){e.onInputKeyUp(o,t)}),o.click(function(e){e.stopPropagation()}),o.keydown(function(e){e.stopPropagation()}),o.blur(function(t){t.stopPropagation(),t.stopimmediatepropagation&&"function"==typeof t&&t.stopimmediatepropagation(),e.onInputBlur(o,t)}),$(".ui-bizagi-input-icon",i).mousedown(function(t){e.onIconClicked(o,t)}),o.focus(),o.val(""),o.val(r)})},destroy:function(){this.params.label.show(),this.editablelabel.detach(),this.element.detach()},onInputKeyUp:function(e,t){var i=this,o=e.val();if(13===t.keyCode)return i.params.value===o?(i.presenter.publish("keyup",{value:o,keyCode:t.keyCode}),void i.presenter.destroy()):void i.presenter.publish("change",{value:o});i.presenter.publish("keyup",{value:o,keyCode:t.keyCode})},onIconClicked:function(e,t){var i=e.val();$(".ui-bizagi-input-icon").data("iconClicked",!0),$(t.target).hasClass("ui-bizagi-input-icon-ok")&&this.params.value!==i&&this.presenter.publish("change",{value:i}),this.presenter.destroy()},onInputBlur:function(e,t){if(1!=$(".ui-bizagi-input-icon").data("iconClicked")){var i=e.val();this.presenter.publish("change",{value:i})}}}),bizagi.editor.observableClass.extend("bizagi.editor.component.editableLabel.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />"),this.editableLabel=new bizagi.editor.component.editableLabel(this.canvas,$.extend(e,{presenter:this}))},render:function(){return this.editableLabel.render()},destroy:function(){this.editableLabel&&(this.editableLabel.destroy(),this.editableLabel=null)}}),bizagi.editor.component.controller("bizagi.editor.component.properties",{listensTo:["outEditor"],events:{PROPERTIES_CHANGE_PROPERTY:"PropertyChange",PROPERTIES_CHANGE_LAYOUT:"PropertyChangeLayout",PROPERTIES_SELECT_EXPRESSION:"ShowRuleSelector",PROPERTIES_SHOW_LOCALIZATION:"ShowLocalization",PROPERTIES_CHANGE_MULTIPLE_PROPERTIES:"ChangeMultipleProperties",PROPERTIES_SELECT_EDITOR_DATALIST:"ShowFilterEditor",PROPERTIES_RULE_EDITOR_DEFAULTVALUE:"ShowRuleEditorForDefaultValue",PROPERTIES_SHOW_XPATH_GENERAL:"ShowXPathEditor",PROPERTIES_SHOW_INTERFACE:"ShowInterfaceEditor",PROPERTIES_SELECT_XPATH_FROM_ENTITY:"SelectXpathFromEntity",PROPERTIES_SHOW_GRID_VALIDATIONS:"ShowGridValidationsEditor",PROPERTIES_SELECT_XPATH_TO_SIMPLE:"SelectXpathToSimple",PROPERTIES_SELECT_XPATH_TO_ENTITY:"SelectXpathToEntity",PROPERTIES_SELECT_XPATH_TO_COLLECTION:"SelectXpathToCollection",PROPERTIES_SELECT_XPATH_MULTIPLE:"SelectMultiXpath",PROPERTIES_SELECT_XPATH:"SelectXpath",PROPERTIES_SELECT_FORM_OPTION:"SelectFormOption",PROPERTIES_SELECT_FORM_BUTTON:"SelectFormButton",PROPERTIES_SELECT_FORM_NEW:"SelectFormNew",PROPERTIES_SELECT_FORM_NONE:"SelectFormNone",PROPERTIES_SELECT_TEMPLATE_NONE:"SelectTemplateNone",PROPERTIES_SELECT_TEMPLATE_DEFAULT:"SelectTemplateDefault",PROPERTIES_SELECT_SEARCHFORM_OPTION:"SelectSearchformOption",PROPERTIES_SELECT_SEARCHFORM_BUTTON:"SelectSearchformButton",PROPERTIES_SELECT_SEARCHFORM_NEW:"SelectSearchformNew",PROPERTIES_SELECT_SEARCHFORM_NONE:"SelectSearchformNone",PROPERTIES_SHOW_DOCUMENT_TEMPLATES:"ShowDocumentTemplatesEditor",PROPERTIES_SHOW_ASSOCIATION_EDITOR:"ShowAssociationEditor",PROPERTIES_SHOW_WIZARD_TEMPLATES:"ShowWizardTemplates",PROPERTIES_SELECT_PROCESS:"SelectProcess",PROPERTIES_LOAD_METADATA:"LoadMetadata"}},{init:function(e,t){var i=this;i._super(),t=t||{},i.canvas=e,i.model=t.model,i.presenter=t.presenter,t.adhocProcessId&&(i.adhocProcessId=t.adhocProcessId),void 0!==i.presenter&&i.presenter.subscribe("propertyEditorChanged",function(e,t){return i.onPropertyEditorChanged(t)})},loadTemplates:function(){var e={close:bizagi.getTemplate("bizagi.editor.component.properties").concat("#prop-close"),"frame-header":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-header"),"frame-header-name":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-header-name"),"content-frame":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-content-frame"),"frame-property":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-property"),"frame-group":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-group"),"frame-group-exclusive":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-group-exclusive"),"frame-category-simple":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-frame-category-simple"),"frame-caption":bizagi.getTemplate("bizagi.editor.component.properties").concat("#properties-caption")};return this._super(e)},render:function(e){var t,i=this,o=i.element;e=e||{},i.editorResponses=[],i.refProperties={},i.redraw=!!e.redraw&&e.redraw,i.groupsReferences={},e.model&&i.update(e.model);var r=i.model=e.model||i.model;o.show(),o.empty(),o.data("id",r.idRender),i.propertySelected=void 0!==e.propertySelected?e.propertySelected:null,$.when(i.loadTemplates()).done(function(){i.renderCaption(o,r),i.renderClose(o),i.renderFrame(o,r),i.renderContent(o,r),t=i.getLastActiveTabForRender(e.model.idRender),i.idRender=e.model.idRender,i.scrollPanel=0,o.hasClass("ui-tabs")&&o.tabs("destroy"),o.tabs(),t&&(o.tabs({select:function(e,t){i.scrollPanelDiv=$(t.panel)}}),o.tabs("option","active",t.index)),$(".ui-tabs-panel",o).bind("mousedown.panelselected",function(){var e=$(this).scrollTop();i.scrollPanel=e}),o.tabs({select:function(e,t){i.setLastActiveTabForRender(i.idRender,t.index,i.scrollPanel)}});var n=i.Class.fullName.replace(/\./gi,"_");o.attr("id",n),i.addThemeStyle(),i.configureAutoCloseHandler(),$.when.apply($,i.editorResponses).done(function(){bizagi.form.modeler.params.reviewMode&&($(o).find(".bz-modeldata_16x16_standard").remove(),$(o).find(".bz-undo_16x16_standard").remove(),$(o).find(".ui-editor").css("pointer-events","none").css("-moz-user-select","none").css("-webkit-user-select","none")),bizagi.util.highLightElement(i.element),i.selectOnProperty(),void 0!==r.validations&&r.validations.length>0&&i.highLightOnProperties(r.validations),i.deselectTabLeftPanel(),t.scrollRender>0&&i.scrollPanelDiv&&i.scrollPanelDiv.scrollTop(t.scrollRender),i.postRender()})})},postRender:function(){var e,t;for(e in this.refProperties)void 0!==(t=this.refProperties[e]).postRender&&t.postRender()},highLightOnProperties:function(e){var t,i;for(t=0;t<e.length;t++)i=e[t],this.refProperties[i.name]?this.refProperties[i.name].highLightProperty(i.message):console.error(i.name+" is not a register property")},getLastActiveTabForRender:function(e){var t={index:0,scrollRender:0},i=this.presenter.publish("getRenderElement",{id:e});return(i=i?i.element||i.container:$("[data-id = "+e+"]").length>0?$("[data-id = "+e+"]"):$("[data-container-id = "+e+"]"))&&(t=i.data("last-tab")||t),t},setLastActiveTabForRender:function(e,t,i){var o=this.presenter.publish("getRenderElement",{id:e});(o=o?o.element||o.container:$("[data-id = "+e+"]").length>0?$("[data-id = "+e+"]"):$("[data-container-id = "+e+"]"))&&o.data("last-tab",{index:t,scrollRender:i})},selectOnProperty:function(){null!==this.propertySelected&&void 0!==this.propertyManager&&void 0!==this.propertyManager.selectEditor&&this.propertyManager.selectEditor()},deselectTabLeftPanel:function(){this.lastTabActive&&this.lastTabActive.removeClass("ui-tabs-selected ui-state-active")},selectTabLeftPanel:function(){this.lastTabActive&&this.lastTabActive.addClass("ui-tabs-selected ui-state-active")},configureAutoCloseHandler:function(){this.lastTabActive=$(".left-panel ul.ui-tabs-nav li.ui-tabs-active"),$(document).bind("mousedown.properties",function(e){var t={pickdate:function(e){return!$(".wpd").is(":visible")&&0===e.closest(".wpd").length},colorPicker:function(){return!$(".sp-container").is(":visible")},xpathNavigator:function(){return!$(".bizagi_editor_xpathnavigator_overlay").is(":visible")},properties:function(e){return 0===e.closest(".bizagi_editor_component_properties").length},tooltipProp:function(e){return 0===e.closest(".ui-propertybox-tooltip").length},warningsButton:function(e){return!($(".ribbon-ico-validate",e).length>0)&&!e.hasClass("ribbon-ico-validate")},saveButton:function(e){return!e.hasClass("ribbon-ico-save")},richText:function(e){return 0===e.closest(".bz-fm-localizablestring-richtext-overlay").length},richTextColor:function(e){return 0===e.closest(".mce-container").length}};return function(i){var o=!0,r=$(i.target);for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];if("function"==typeof a&&(o&=a.call(t,r)),!o)break}o&&(e.lastTabActive&&e.selectTabLeftPanel(),e.destroy(),$(document).unbind("mousedown.properties"),$(window).unbind("resize.panel"))}}(this))},renderClose:function(e){$.tmpl(this.getTemplate("close")).appendTo(e)},renderFrame:function(e,t){var i,o,r,n;for(r=null!==(n=t.elements[0].tabs||null)?n.length:-1,i=$.tmpl(this.getTemplate("frame-header"),{}),o=0;o<r;o++)this.performValidationToShowTabOnLiveProcesses(n[o])&&(n[o].machineName=bizagi.editor.utilities.normalizeString(bizagi.editor.utilities.camelCase(n[o].caption))||o,$.tmpl(this.getTemplate("frame-header-name"),n[o]).appendTo(i));i.appendTo(e)},renderCaption:function(e,t){$.tmpl(this.getTemplate("frame-caption"),{caption:t.renderCaption,ico:t.element.type,style:t.element.style}).appendTo(e)},machineName:function(e){return e.toLowerCase().replace(/-/g,"")},renderContent:function(e,t){var i,o,r,n;for(r=null!==(o=t.elements[0].tabs||null)?o.length:-1,i=0;i<r;i++)this.performValidationToShowTabOnLiveProcesses(o[i])&&(o[i].machineName=bizagi.editor.utilities.normalizeString(bizagi.editor.utilities.camelCase(o[i].caption))||i,n=$.tmpl(this.getTemplate("content-frame"),o[i]),this.renderElement(n,o[i].elements),n.appendTo(e))},renderElement:function(e,t){var i;for(i=0;i<t.length;i++)switch(Object.keys(t[i])[0]){case"property":if(void 0!==t[i].property.notShow)break;if(t[i].property.disable){delete t[i].property.disable;break}this.renderProperty(e,t[i].property);break;case"category":this.renderCategory(e,t[i].category);break;case"group":this.renderGroup(e,t[i].group)}this.setAsCollapsible(e)},renderProperty:function(e,t){var i,o,r,n,a,s,l;if(i=$.tmpl(this.getTemplate("frame-property"),{}),t.caption=t.caption?t.caption:"&raquo; "+t.name,this.adhocProcessId&&(t.adhocProcessId=this.adhocProcessId),t["bas-type"]=this.machineName(t["bas-type"]),void 0===t.subproperties)"xpathmultiple"===t["bas-type"]?(r=new bizagi.editor.component.editor[t["bas-type"]](i,t,this.presenter),i.appendTo(e)):/^.*xpath.*$/gi.test(t["bas-type"])?(r=new bizagi.editor.component.editor.xpath(i,t,this.presenter),i.appendTo(e)):(r=new bizagi.editor.component.editor[t["bas-type"]](i,t,this.presenter),i.appendTo(e),null!==this.propertySelected&&this.propertySelected==t.name&&(this.propertyManager=r)),l=r.render(),this.editorResponses.push(l),this.registerProperty(r);else if(/^.*xpath.*$/gi.test(t["bas-type"]))r=new bizagi.editor.component.editor.xpath(i,t,this.presenter),i.appendTo(e),l=r.render(),this.editorResponses.push(l),this.registerProperty(r);else if(void 0===bizagi.editor.component.editor[t["bas-type"]]){for(o=$.tmpl(this.getTemplate("frame-category-simple"),t),s=$(".ui-content",o),n=t.subproperties.length,a=0;a<n;a++)r=t.subproperties[a].property,this.renderProperty(s,r);o.appendTo(e)}else r=new bizagi.editor.component.editor[t["bas-type"]](i,t,this.presenter,{refProperties:this.refProperties}),i.appendTo(e),l=r.render(),this.editorResponses.push(l),this.registerProperty(r)},renderGroup:function(e,t){var i,o,r,n;if(o=t.elements.length,void 0!==t.exclusive){if(2!=t.elements.length)throw"There are more than two exclusives groups";var a=bizagi.clone(t);if(void 0===a.guid){var s=Math.guid();$.extend(a,{guid:s}),this.groupsReferences[s]={data:a}}void 0!==a.visibility&&$.extend(a,{hidden:" properties-group-hidden"});var l=void 0!==a.index,d={};for(l?0===a.index?(d.check1="properties-group-radio-check",d.check2="properties-group-radio-uncheck biz-action-btn"):(d.check1="properties-group-radio-uncheck biz-action-btn",d.check2="properties-group-radio-check"):(d.check1="properties-group-radio-uncheck biz-action-btn",d.check2="properties-group-radio-uncheck biz-action-btn"),$.extend(a,d),i=$.tmpl(this.getTemplate("frame-group-exclusive"),a),n=$(".ui-content-group",i),r=0;r<o;r++)switch(Object.keys(a.elements[r])[0]){case"property":if(void 0!==a.elements[r].property.notShow)break;l?a.index==r&&this.renderProperty(n[r],a.elements[r].property):this.renderProperty(n[r],a.elements[r].property);break;case"group":l?a.index==r&&this.renderGroup(n[r],a.elements[r].group):this.renderGroup(n[r],a.elements[r].group)}i.appendTo(e)}else{for(i=$.tmpl(this.getTemplate("frame-group"),t),n=$(".ui-content",i),r=0;r<o;r++)switch(Object.keys(t.elements[r])[0]){case"property":if(void 0!==t.elements[r].property.notShow)break;this.renderProperty(n,t.elements[r].property);break;case"group":this.renderGroup(n,t.elements[r].group)}$(i).find(".ui-content").children().length>0&&i.appendTo(e)}},renderCategory:function(e,t){var i,o,r,n,a;for(o=t.elements.length,i=$.tmpl(this.getTemplate("frame-category-simple"),t),a=$(".ui-content",i),r=0;r<o;r++)n=t.elements[r].property,this.renderProperty(a,n);i.appendTo(e)},registerProperty:function(e){this.refProperties[e.options.name]=e},setAsCollapsible:function(e){$("h3.ui-legend",e).unbind("click"),$("h3.ui-legend",e).bind("click",function(e){e.stopPropagation();var t=$(this).next();t.is(":visible")?t.slideUp():t.slideDown()})},addThemeStyle:function(){var e=this.element;e.addClass("biz-work-panel"),e.addClass("biz-border-all"),e.addClass("biz-shadow-modal"),e.addClass("biz-border-color"),e.addClass("biz-modal"),e.addClass("ui-corner-bottom"),e.removeClass("ui-corner-all"),$("ul.ui-widget-header",e).addClass("biz-gradient-v")},resizePanel:function(){var e,t;e=this.element,t=.95*$(".left-panel").height(),parseFloat($("> ul",e).height()),e.css({height:t})},destroy:function(){var e=this,t=e.element;if(t.hasClass("ui-tabs")){var i=t.tabs("option","active");e.setLastActiveTabForRender(e.idRender,i,e.scrollPanel),e.selectTabLeftPanel(),$(".sp-container").remove(),e.element.tabs("destroy")}e.element.hide()},onPropertyEditorChanged:function(e){return e.typeEvent=e.typeEvent||bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,this.presenter.publish("propertyChanged",e)},performValidationToShowTabOnLiveProcesses:function(e){if(!this.adhocProcessId)return!0;var t=!1;e.elements&&e.elements.length>0&&(t=e.elements.filter(function(e){return e.group||e.property.show}).length>0);return t},".ui-properties-close .ui-close-btn click":function(){this.destroy()},".bizagi_editor_component_editor click":function(e){$(".bizagi_editor_component_editor",this.element).removeClass("editor-selected"),e.addClass("editor-selected"),e.trigger("outEditor",[e])},outEditor:function(e,t,i){$(".bizagi_editor_component_editor_booleanrule > div > span",e).removeClass("editor-arrow-down-enabled").addClass("editor-arrow-down-disabled"),i.find("> div > span").removeClass("editor-arrow-down-disabled").addClass("editor-arrow-down-enabled"),$(".bizagi_editor_component_editor_booleanrule .editor-options").removeClass("editor-options-enabled").addClass("editor-options-disabled")},".bizagi_editor_component_editor input focus":function(e){$(".bizagi_editor_component_editor",this.element).removeClass("editor-selected"),e.closest(".bizagi_editor_component_editor").addClass("editor-selected")},".properties-category > span click":function(e){var t=e.next();e.toggleClass("close").toggleClass("open"),t.slideToggle()},click:function(e,t){return t.stopPropagation(),!1},".properties-group-exclusive-header click":function(e){var t,i=e.closest(".properties-group-exclusive",e),o=i.parent(),r=$(".properties-group-exclusive-header",o),n=i.attr("data-guid"),a=r.index(e);i.remove(),t=this.groupsReferences[n].data,$.extend(t,{index:a}),this.renderGroup(o,t)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.properties.presenter",{},{init:function(e){var t=this;t._super(),(e=e||{}).mainContainer?t.canvas=$("<div />").appendTo(e.mainContainer):t.canvas=e.canvas||$("<div />").appendTo("form-modeler"),t.propertyBox=new bizagi.editor.component.properties(t.canvas,$.extend(e,{presenter:t}))},destroy:function(){var e=this;e.propertyBox&&e.propertyBox.destroy(),e.canvas&&e.canvas.remove(),e.propertyBox=null,e.canvas=null},render:function(e){this.propertyBox&&this.propertyBox.render(e)}}),bizagi.editor.component.properties.parser=function(e,t){},bizagi.editor.component.properties.processrules=function(e,t,i){var o,r,n={},a=function(e){var o,r,a,l,d="";for(o=e.split(","),r=0;r<o.length;r++)0===r?(l=i[o[r]],a=t.elements[0].tabs[l.tab].elements[l.index].property):r===o.length-1?(d=a[o[r]],n[e]=a):a=s(a,o[r]);return d},s=function(e,t){if(/^.+\[.+\]\(.+\)$/.test(t)){var i=t.replace(/^(.+)\[(.+)\]\((.+)\)$/,"$1:$2:$3").split(":");return e[i[0]][parseInt(i[1])].property}return e[t]};if($.isArray(e)&&e.length>0)for(o=0;o<e.length;o++)r=a(e[o]),e[o],function(e){var t;if(/^<.+:+.+$/.test(e)){var i=e.substring(1,e.length-1).split(":");for(t=0;t<i.length;t++)if(0===t)switch(i[t]){case"design":break;default:return}}}(r)},bizagi.editor.component.properties.hasRule=function(e){var t=void 0,i=-1,o=/^<.*:+.*>$/,r=function(e,o,r){if(void 0===t)(t=[])[++i]=e;else if(void 0===o)t[++i]=e;else if(void 0===r)t[i]=e+","+t[i];else for(var n=0;n<=i;n++)t[n]=e+","+t[n]},n=function(e,t,i){for(var a,s,l=0;l<e.length;l++)if(void 0===(a=e[l]).more)void 0!==t[a.name]&&o.test(t[a.name])&&(r(a.name),i.paint=!0);else if(void 0!==t[a.name])if($.isArray(t[a.name]))for(var d=0;d<t[a.name].length;d++)s={},n(a.more,t[a.name][d].property,s),void 0!==s.paint&&(r(a.name+"["+d+"]("+t[a.name][d].property.name+")",!0),i.paint=!0);else s={},n(a.more,t[a.name],s),void 0!==s.paint&&(r(a.name,!0),i.paint=!0)},a={};return n([{name:"subproperties",more:[{name:"editor-parameters",more:[{name:"entity"}]}]},{name:"editor-parameters",more:[{name:"entity"}]},{name:"subproperties",more:[{name:"default"}]},{name:"subproperties",more:[{name:"editor-parameters",more:[{name:"context"}]}]},{name:"editor-parameters",more:[{name:"showtime",more:[{name:"rule"}]}]},{name:"editor-parameters",more:[{name:"allowdecimals",more:[{name:"rule"}]}]}],e,a),void 0!==a.paint&&r(e.name,!0,!0),t},bizagi.editor=bizagi.editor||{},bizagi.editor.component=bizagi.editor.component||{},bizagi.editor.component.properties=bizagi.editor.component.properties||{},bizagi.editor.component.properties.commands=bizagi.editor.component.properties.commands||{},bizagi.editor.component.properties.commands.factory=function(){return this.createRuleCommand=function(e){return new bizagi.editor.component.properties.commands.rule(e)},this.createCommand=function(args){if(void 0!==args.command)try{args.command=args.command.replace("-","");var fn=eval("var bafn = function(args) {  return new bizagi.editor.component.properties.commands."+args.command+"(args);};bafn"),command=fn(args);return command}catch(e){return null}return null},{createCommand:this.createCommand,createRuleCommand:this.createRuleCommand}}(),bizagi.editor.observableClass.extend("bizagi.editor.component.properties.commands.base",{},{init:function(e){e=e||{},this._super(),this.args=e,this.element=e.element,this.properties=e.element.properties,this.key=e.key,this.indexedProperty=e.indexedProperty,this.communicationProtocol=bizagi.editor.communicationprotocol.factory},execute:function(){}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.rule",{rulePropertiesCache:{}},{execute:function(){var e=bizagi.editor.utilities.resolveProperty(this.properties,this.key);return bizagi.editor.utilities.isObject(e)&&bizagi.editor.utilities.isObject(e.baref)?this.updateRuleDisplayName(e):e},updateRuleDisplayName:function(e){var t=this,i=bizagi.editor.utilities.resolveComplexReference(e);if(t.Class.rulePropertiesCache[i])return e=t.Class.rulePropertiesCache[i],t.element.assignProperty(t.key,e,!1),e;var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",guid:i});return $.when(o.processRequest()).done(function(o){e.displayName=o?o.displayName:rule.displayName,t.element.assignProperty(t.key,e,!1),t.Class.rulePropertiesCache[i]=e}),e}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.groupby",{},{execute:function(){this.parentIsGrid()&&(this.indexedProperty.notShow=!0)},parentIsGrid:function(){return"grid"==this.element.parent.type}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.showcolumn",{},{execute:function(){this.parentIsGrid()&&(this.indexedProperty.notShow=!0)},parentIsGrid:function(){return"grid"==this.element.parent.type}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.displaytype",{},{execute:function(){this.parentIsGrid()&&(this.indexedProperty.notShow=!0)},parentIsGrid:function(){return"grid"==this.element.parent.type}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.isadministrable",{},{execute:function(){"parameter"!=this.element.triggerGlobalHandler("getContextEntityType")&&(this.indexedProperty.notShow=!0)}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.selectProcess",{},{execute:function(){"application"!=this.element.triggerGlobalHandler("getContextEntityType")?this.indexedProperty.notShow=!0:this.indexedProperty.allowClick=this.element.triggerGlobalHandler("getControllerInfo",{type:"isNewForm"})}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.allowdecimals",{},{execute:function(){var e,t=this,i=t.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"})?t.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):t.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"});if(t.properties.xpath){var o=bizagi.editor.utilities.resolveComplexXpath(t.properties.xpath);node=i.getNodeByXpath(o);var r=node&&node.getDataType();("OracleNumber"==(e=r)||"BigInt"==e||"Int"==e||"SmallInt"==e||"TinyInt"==e)&&(t.indexedProperty.notShow=!0,t.properties.allowdecimals=!1)}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.buttonrule",{},{execute:function(){"formbutton"==this.element.type&&(this.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"})&&(this.indexedProperty.notShow=!0))}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.visible",{},{execute:function(){"formbutton"==this.element.type&&(this.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"})&&(this.indexedProperty.notShow=!0))}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.defaultinclude",{},{execute:function(){!this.parentIsGrid()&&this.properties.selectable||(this.indexedProperty.notShow=!0)},parentIsGrid:function(){return"grid"==this.element.parent.type}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.numberrange",{},{execute:function(){var e=this,t=e.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"})?e.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):e.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"});if(e.properties.xpath){var i=bizagi.editor.utilities.resolveComplexXpath(e.properties.xpath);node=t.getNodeByXpath(i),node&&"oracleNumber"==node.getRenderType()&&(e.properties.allowdecimals=!1,e.indexedProperty.notShow=!0)}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.defaultvalue",{},{execute:function(){var e=this,t=e.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"})?e.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):e.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"});if(e.properties.xpath){var i=bizagi.editor.utilities.resolveComplexXpath(e.properties.xpath);node=t.getNodeByXpath(i),node&&"oracleNumber"==node.getRenderType()&&(e.indexedProperty.notShow=!0)}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.actions",{},{execute:function(){"formbutton"==this.element.type&&(this.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"})&&(this.indexedProperty.notShow=!0))}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.maxlines",{},{execute:function(){0==this.element.properties.isextended||"false"==this.element.properties.isextended?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.formatvalue",{},{execute:function(){"label"==this.element.properties.displaytype?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.format",{},{execute:function(){"value"==this.element.properties.displaytype?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.xpath",{},{execute:function(){var e=this;e.element.properties.typedinamic&&("databind"===e.element.properties.typedinamic&&e.properties.allowdinamiclabel?e.indexedProperty.show=!0:e.indexedProperty.show=!1),e.indexedProperty.value}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.xpathAdhoc",{},{execute:function(){var e=this;function t(){var t="";if(!e.element.properties.xpathAdhoc){if(0===(t=e.element.properties.displayName instanceof Object?bizagi.editor.utilities.getXPathByDisplayName(e.element.properties.displayName.i18n.default):bizagi.editor.utilities.getXPathByDisplayName(e.element.properties.displayName)).length){t=e.element.type.replace("adhoc","")+"_"+function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}()}t=t.substr(0,1).toLowerCase()+t.substr(1),e.element.properties.xpathAdhoc={xpath:t,relatedEntity:null}}}e.element.properties.draggedProperty||e.element.isSaved()?(e.element.properties.xpathAdhoc=e.element.properties.xpathAdhoc||e.element.originalLoadedProperties.xpathAdhoc,void 0===e.element.properties.xpathAdhoc&&t()):t()}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.tagslist",{tagsCache:{}},{execute:function(){var e=this;if(e.indexedProperty.show=!0,e.element.properties.xpath){var t=e.Class.tagsCache,i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(e.element.properties.xpath);if(t[i])e.indexedProperty["editor-parameters"].tags=t[i];else{var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"gettags",parameters:[{key:"id",value:i}]});e.indexedProperty["editor-parameters"].tags=o.processRequest(),$.when(o.processRequest()).done(function(e){t[i]=e||[]})}}else e.indexedProperty.show=!1}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.filter",{},{execute:function(){var e=this;e.element.properties.typedinamic&&("databind"===e.element.properties.typedinamic&&e.properties.allowdinamiclabel?e.indexedProperty.show=!0:e.indexedProperty.show=!1)}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.datasource",{},{execute:function(){var e=this;"adhocsuggest"==e.element.properties.type?(e.indexedProperty.showAdhocEntitiesControl=!e.element.propertyModel.designProperties.data.subproperties.datasource.ignoreAdhocEntities,e.indexedProperty.showPredefinedValuesControl=!1,e.indexedProperty.isAdhocSuggestControl=!0):(e.indexedProperty.showPredefinedValuesControl=!0,e.indexedProperty.showAdhocEntitiesControl=!0)}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.displayattrib",{},{execute:function(){var e=this;e.element.properties.typedinamic&&("databind"===e.element.properties.typedinamic&&e.properties.allowdinamiclabel?e.indexedProperty.show=!0:e.indexedProperty.show=!1)}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.sortattribute",{},{execute:function(){}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.data.adhocdisplayattrib",{metadataCache:{}},{execute:function(){var e=this,t=[],i=new $.Deferred;if(e.element.properties.data.datasource&&"adhoc"===e.element.properties.data.datasource.type){var o=e.Class.metadataCache,r=e.element.properties.data.datasource.guid;if(o[r])t=o[r],i.resolve(t);else{var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocentityattribs",parameters:[{key:"guid",value:r}]});$.when(n.processRequest()).done(function(e){o[r]=e,t=e,i.resolve(t)})}e.indexedProperty.show=!0}else e.element.properties.data.datasource&&"bizagi"===e.element.properties.data.datasource.type&&(e.element.properties.data.adhocdisplayattrib=null),e.indexedProperty.show=!1;e.indexedProperty["editor-parameters"].attribs=i.promise()}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.datarule",{},{execute:function(){"ruleexpression"===this.element.properties.typedinamic&&this.properties.allowdinamiclabel?this.indexedProperty.show=!0:this.indexedProperty.show=!1}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.typedinamic",{},{execute:function(){var e=this;e.properties.allowdinamiclabel?e.indexedProperty.show=!0:(e.indexedProperty.show=!1,e.element.requiredPropertiesOverrides({xpath:!1,"data.displayattrib":!1,"data.filter":!1,datarule:!1})),"databind"===e.element.properties.typedinamic&&e.properties.allowdinamiclabel?(e.element.requiredPropertiesOverrides({xpath:!0,"data.displayattrib":!0,"data.filter":!0,datarule:!1}),e.element.setProperty("datarule",void 0)):"ruleexpression"===e.element.properties.typedinamic&&e.properties.allowdinamiclabel&&(e.element.requiredPropertiesOverrides({xpath:!1,"data.displayattrib":!1,"data.filter":!1,datarule:!0}),e.element.setProperty("xpath",void 0),e.element.setProperty("data.displayattrib",void 0),e.element.setProperty("data.filter","")),e.element.validRequiredProperties(),e.element.validRequiredDependentProperties()}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.displayName",{},{execute:function(){this.properties.allowdinamiclabel?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.isexclusive",{},{execute:function(){var e=this,t=e.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"});if("option"==e.properties.display&&t?(e.indexedProperty.show=!1,e.properties.isexclusive=!1):e.indexedProperty.show=!0,"check"===e.properties.display&&e.properties.isexclusive){var i=e.element.triggerGlobalHandler("getControllerInfo",{type:"searchDependencies",guids:[e.args.element.guid],message:bizagi.localization.getResource("formmodeler-command-searchdependencies-error-column-check")});$.when(i).done(function(t){t.result||(e.properties.isexclusive=!1)})}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.required",{},{execute:function(){"check"===this.properties.display&&this.properties.isexclusive?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.totalize",{},{execute:function(){"check"===this.properties.display&&this.properties.isexclusive?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.submitonchange",{},{execute:function(){"check"===this.properties.display&&this.properties.isexclusive?this.indexedProperty.show=!1:this.indexedProperty.show=!0}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.thousands",{},{execute:function(){var e=this,t=e.element.triggerGlobalHandler("getControllerInfo",{type:"isGridContext"})?e.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModelGrid"}):e.element.triggerGlobalHandler("getControllerInfo",{type:"getXpathNavigatorModel"});if(e.properties.xpath){var i=bizagi.editor.utilities.resolveComplexXpath(e.properties.xpath);node=t.getNodeByXpath(i),"TinyInt"==node.getDataType()&&(e.indexedProperty.notShow=!0,e.properties.allowdecimals=!1)}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.enabledby.stakeholders",{stakeholdersPromise:{resolve:!1}},{execute:function(){var e=this,t=e.Class.stakeholdersPromise;if(t.resolve)e.indexedProperty["editor-parameters"].stakeholders=t.resolve;else{var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getstakeholders"});e.indexedProperty["editor-parameters"].stakeholders=i.processRequest(),$.when(i.processRequest()).done(function(t){e.Class.stakeholdersPromise.resolve=t})}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.selecttemplate",{templatesPromise:{},regexParameter:/<\w+:([\w:]+)>/},{execute:function(){var e=this,t=e.Class.templatesPromise;e.indexedProperty["editor-parameters"].templates=null,e.indexedProperty.show=!1;var i=e.getRelatedEntity();if(i){t[i]=t[i]||{},e.indexedProperty.show=!0;var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"gettemplates",entityGuid:i});e.indexedProperty["editor-parameters"].templates=o.processRequest(),e.indexedProperty["editor-parameters"].templatetype=e.getTemplateType()}},getRelatedEntity:function(){if(editorParameters=this.indexedProperty["editor-parameters"]||{},entity=editorParameters.entity,!entity)return!1;var e=/<\w+:([\w:]+)>/.exec(entity)[1].replace(/:/g,"."),t=this.element.resolveProperty(e);return!!t&&bizagi.editor.utilities.resolveComplexReference(t)},getTemplateType:function(){var e=this.Class.regexParameter,t=(this.indexedProperty["editor-parameters"]||{}).type;if(t){var i=e.exec(t)[1].replace(/:/g,".");return this.element.resolveProperty(i)||!1}return!1}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.newrecords",{},{execute:function(){var e=this;if(e.properties.newrecords){if("search"==e.element.type||"columnsearch"==e.element.type){var t=e.element.triggerGlobalHandler("getNodeInfo",{xpath:bizagi.editor.utilities.resolveComplexXpath(e.properties.xpath)});t&&"entity-parametric"==t.nodeSubtype&&(e.indexedProperty.notShow=!0)}bizagi.util.parseBoolean(e.properties.newrecords.allownew)?e.element.requiredPropertiesOverrides({"newrecords.allownewform":!0}):bizagi.util.parseBoolean(e.properties.newrecords.allownew)||e.element.requiredPropertiesOverrides({"newrecords.allownewform":!1})}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.multipleselection",{},{execute:function(){"actionlauncher"==this.element.type&&(bizagi.util.parseBoolean(this.element.resolveProperty("multipleselection"))&&this.element.assignProperty("required",{fixedvalue:"false"},!1))}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.required",{},{execute:function(){if("actionlauncher"==this.element.type){var e=bizagi.util.parseBoolean(this.element.resolveProperty("multipleselection"));this.indexedProperty.show=!e}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.maxitems",{},{execute:function(){"entitytemplate"==this.element.type&&(value=bizagi.util.parseBoolean(this.element.resolveProperty("allowactions")),value?this.indexedProperty.show=!0:this.indexedProperty.show=!1)}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.allowactions",{},{execute:function(){if("entitytemplate"==this.element.type){var e=this.element.triggerGlobalHandler("getControllerInfo",{type:"isStartFormContext"});this.indexedProperty.show=!e}}}),bizagi.editor.component.properties.commands.base.extend("bizagi.editor.component.properties.commands.relatedforms",{relatedFormsCache:{}},{execute:function(){var e=this,t=e.element.resolveProperty("xpath");if(e.properties&&bizagi.editor.utilities.isObject(t)||!e.element.isRequiredProperty("xpath")){var i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(t),o=(t=bizagi.editor.utilities.resolveComplexXpath(t),i+"_"+e.indexedProperty["bas-type"]);if(e.Class.relatedFormsCache[o])e.indexedProperty.relatedForms=e.Class.relatedFormsCache[o];else{var r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"relatedforms",xpath:e.element.triggerGlobalHandler("getContextXpath",{xpath:t}),relatedEntity:i,context:e.indexedProperty["bas-type"],isScopeAttribute:e.element.triggerGlobalHandler("getNodeInfo",{xpath:t,callback:function(e){return e.isScopeAttribute}})});e.indexedProperty.relatedForms=e.Class.relatedFormsCache[o]=r.processRequest(),$.when(e.indexedProperty.relatedForms).done(function(t){e.Class.relatedFormsCache[o]=t||[]})}}else e.indexedProperty.relatedForms=[]}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.navigationform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.form",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.addform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.editform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.detail.detailform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.add.addform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.edit.editform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.newrecords.allownewform",{},{execute:function(){return this._super()}}),bizagi.editor.component.properties.commands.relatedforms.extend("bizagi.editor.component.properties.commands.searchforms",{},{execute:function(){this._super(),this.element.properties.xpath||(this.indexedProperty.notShow=!0)}}),bizagi.editor.component.controller("bizagi.editor.component.decorator",{init:function(e,t){var i=this;t=t||{},i._super(e),i.canvas=e,i.presenter=t.presenter,i.model=t.model,i.data=t.data,i.tmpl={}},updateModel:function(e){this.model=e,this.update()},render:function(){var e=this;$(".ui-decorator-tooltip").remove(),null!=e.targetElement&&e.targetElement.removeClass("container-decorator"),void 0!==e.data.element&&(e.targetElement=e.data.element,e.targetElement.addClass("container-decorator")),$.when(e.loadTemplates()).done(function(){e.element.appendTo(e.targetElement),e.element.addClass("ui-control-decorator"),e.element.show(),e.element.empty(),e.renderDecorator(e.element)})},renderDecorator:function(e){var t=$.tmpl(this.getTemplate("decoratorFrame"),this.model),i=$(".biz-decorator-specific-options",t).clone().addClass("ui-clone");e.parent().outerHeight(!0)>470&&i.appendTo(e),t.appendTo(e),this.setDecoratorPosition(t,e),$(".biz-ico.decorator-image",this.element).tooltip({tooltipClass:"ui-widget-content ui-decorator-tooltip",position:{my:"left top",at:"left bottom",offset:"0 10"}})},setDecoratorPosition:function(e,t){var i=t.parent().closest(".ui-col"),o=$(".biz-decorator-standard-options",e);i.length>0&&(i[0].scrollWidth>i.outerWidth()&&e.addClass("ui-decorator-left"),i.outerWidth()<o.outerWidth()&&e.addClass("ui-decorator-vertical"))},remove:function(){void 0!==this.targetElement&&this.targetElement.removeClass("container-decorator"),$(".ui-decorator-tooltip").remove(),this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("decoratorFrame",bizagi.getTemplate("bizagi.editor.component.decorator").concat("#decorator-frame"))).done(function(){e.resolve()}),e.promise()},destroy:function(){$(".ui-decorator-tooltip").remove(),this.element.detach()},".decorator-gear click":function(e,t){t.stopPropagation(),this.presenter.publish("showProperties",this.data)},".decorator-bind click":function(e,t){t.stopPropagation(),this.presenter.publish("showXpathNavigator",this.data)},".decorator-delete click":function(e,t){t.stopPropagation(),this.presenter.publish("deleteElement",this.data.guid)},".decorator-edit click":function(e,t){t.stopPropagation(),this.presenter.publish("openNestedForm",this.data.guid)},".editor-ui-button-actions click":function(e,t){t.stopPropagation();var i=e.data("id");this.presenter.publish("buttonClicked",{button:i,guid:this.data.guid})}}),bizagi.editor.observableClass.extend("bizagi.editor.component.decorator.presenter",{},{init:function(e){var t=this;e=e||{},t._super(),t.canvas=e.canvas,t.model=e.model,t.decoratedElement=e.data.element,t.decorator=new bizagi.editor.component.decorator(t.canvas,$.extend(e,{presenter:t}))},destroy:function(){this.decorator.destroy()},remove:function(){this.decorator.remove()},getDecoratedElement:function(){return this.decoratedElement},render:function(e){var t=this;return e=e||{},t.model=e.model||t.model,t.decorator.updateModel(t.model),t.decorator.render(e)}}),$.Class.extend("bizagi.editor.component.decorator.model",{getSpecificModel:function(e){var t=this,i=e.type||e.name;if(t.models={grid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},offlinegrid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},adhocgrid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}],standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},groupedgrid:{specificOptions:[{id:"ConfigGrid",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editcolumns"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},nestedform:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}],specificOptions:[{id:"EditNestedForm",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editform"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},querynestedform:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}],specificOptions:[{id:"EditNestedForm",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-editform"),css:"bz-studio bz-extended-table-edit-record_16x16_standard"}]},horizontal:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},container:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},formbutton:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},query:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},adhoc:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},adhoccolumn:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]},adhoccontainer:{standardOptions:[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}]}},t.standardOptions=[{allowProperties:!0,id:"gear",displayName:bizagi.localization.getResource("bizagi-editor-properties-caption"),css:"bz-studio bz-settings_16x16_standard"},{allowXpath:!0,id:"bind",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-bind"),css:"bz-studio bz-boolean-xpath_16x16_standard"},{allowDelete:!0,id:"delete",displayName:bizagi.localization.getResource("bizagi-editor-decorator-model-allowdelete"),css:"bz-studio bz-delete_16x16_standard"}],"queryInternal"==i||"query"==i)var o=t.models.query||{standardOptions:t.standardOptions};else if("template"==i)o={standardOptions:[]};else o=t.models[e.name]||t.models[i]||{standardOptions:t.standardOptions};return o.standardOptions||(o.standardOptions=t.standardOptions),o}},{}),bizagi.editor.component.controller("bizagi.editor.component.readonlyeditor",{},{init:function(e,t){this._super(),t=t||{},this.canvas=e,this.model=t.model,this.presenter=t.presenter},loadTemplates:function(){var e={"readonlyeditor-container":bizagi.getTemplate("bizagi.editor.component.readonlyeditor").concat("#readonlyeditor-container")};return this._super(e)},render:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.readOnlyEditorTemplate=e.getTemplate("readonlyeditor-container");$.tmpl(i,e.model).appendTo(t)})},destroy:function(e){this.element.detach()},".biz-readonlyeditor-container span.bz-user-name click":function(e){this.presenter.publish("showUserInformation",{})}}),bizagi.editor.observableClass.extend("bizagi.editor.component.readonlyeditor.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />"),this.model=e.model||{},this.readonlyeditor=new bizagi.editor.component.readonlyeditor(this.canvas,{presenter:this,model:this.model})},render:function(){return this.readonlyeditor.render()},destroy:function(){this.readonlyeditor&&(this.readonlyeditor.destroy(),this.readonlyeditor=null)}}),bizagi.editor.component.controller("bizagi.editor.component.ribbon",{init:function(e,t){var i=this;i._super(),t=t||{},i.canvas=e,i.model=t.model,i.presenter=t.presenter,i.communicationProtocol=bizagi.editor.communicationprotocol.factory,i.loadAvailableLanguages()},loadTemplates:function(){var e={layout:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-layout",tab:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-tab",group:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-group","group-caption":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-group-caption",button:bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button","button-horizontal":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-horizontal","button-horizontal-item":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#contextmenu-button-horizontal-item","button-vertical":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-vertical","button-with-items":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-with-items","button-subitem":bizagi.getTemplate("bizagi.editor.component.ribbon")+"#ribbon-button-subitem"};return this._super(e)},render:function(e){var t=this;e=e||{},t.model=e.model||t.model,t.itemsPerRow=3,$.when(t.loadTemplates()).done(function(){t.element.empty();var e=t.model.getViewModel();$.when(t.renderGroups(t.element,e.elements)).done(function(){$(".ribbon-group-col .ui-cells > [title].biz-btn-horizontal",t.element).tooltip({tooltipClass:"ui-widget-content ui-ribbon-tooltip ui-ribbon-horizontal-tooltip",position:{my:"left top+10",at:"left bottom"}}),$(".ribbon-group-col > [title].biz-btn-vertical",t.element).tooltip({tooltipClass:"ui-widget-content ui-ribbon-tooltip ui-ribbon-vertical-tooltip",position:{my:"left top+10",at:"left bottom"}})})})},updateModel:function(e){this.model=e},renderLayout:function(e){var t=$.tmpl(this.getTemplate("layout"),{});$.tmpl(this.getTemplate("tab"),{}).appendTo(t),t.appendTo(e)},renderGroups:function(e,t){for(var i,o,r=0;r<t.length;r++)i=$.tmpl(this.getTemplate("group"),{}),o=t[r],this.renderElements(i,o),this.renderGroupCaption(i,o),i.appendTo(e)},renderGroupCaption:function(e,t){$.tmpl(this.getTemplate("group-caption"),t).appendTo(e)},renderElementSubItem:function(e,t){$.tmpl(this.getTemplate("button-subitem"),t).appendTo(e)},renderElement:function(e,t){var i=t.align?t.align.toLowerCase():"horizontal";("value"in t?$.tmpl(this.getTemplate("button-horizontal-item"),t):$.tmpl(this.getTemplate("button-"+i),t)).appendTo(e)},renderElements:function(e,t){var i,o,r,n,a,s=0,l=t.elements.length,d=$.tmpl(this.getTemplate("button"));for(d.appendTo(e),i=0;i<l;i++)i%this.itemsPerRow==0&&(a=$("<div class='ui-cells ui-pos-"+s+"'></div>").appendTo(d),s++),n=(o=t.elements[i]).align?o.align.toLowerCase():"horizontal",o.elements?"horizontal"===n?this.renderElementWithItems(a,o):((r=$.tmpl(this.getTemplate("button"),o)).appendTo(e),this.renderElementWithItems(r,o)):"horizontal"===n?this.renderElement(a,o):((r=$.tmpl(this.getTemplate("button"),o)).appendTo(e),this.renderElement(r,o))},renderElementWithItems:function(e,t){var i,o,r,n=t.elements.length;if(t.disabled)(i=$.tmpl(this.getTemplate("button-horizontal"),t)).appendTo(e);else{(i=$.tmpl(this.getTemplate("button-with-items"),t)).appendTo(e),r=i.find("ul:lt(1)");for(var a=0;a<n;a++)o=t.elements[a],this.renderElement(r,o);this.fixElementsPosition()}},fixElementsPosition:function(){var e=this;setTimeout(function(){$(".biz-dropdown",e.element).each(function(){var e=$(this),t=0;e.children()&&e.children().length>0&&e.children().each(function(){var e=$(this);e.text().trim().length>25&&t<e.width()&&(t=e.width())}),t>0&&e.css("width",t+20+"px")})},500)},remove:function(){this.element.hide(),this.element.empty()},loadAvailableLanguages:function(){var e=this,t=e.communicationProtocol.createProtocol({protocol:"availablelanguages"});$.when(t.processRequest()).done(function(t){if($.isArray(t)){var i=t.map(function(e){var t=JSON.parse(e.value);return{caption:t.displayname,style:t.displayname,property:"language",action:"Language",value:t}}),o=e.model.groups.languages;if("object"==typeof o&&null!==o&&$.isArray(o.elements)){var r=e.model.items[o.elements[0].guid];e.model.addChildren(i,r),e.render()}}})},"div.biz-btn click":function(e){var t=this,i=e.data("guid"),o=t.model.getElement(i);o.items||o.disabled||("save"===o.action&&(t.model.disableAction("save"),t.render()),setTimeout(function(){t.presenter.publish("onItemClicked",{property:o.property,value:o.value,action:o.action})},500))}}),bizagi.editor.observableClass.extend("bizagi.editor.component.ribbon.presenter",{},{init:function(e){var t=this;t._super(),e=e||{},t.canvas=e.canvas,t.model=e.model,t.ribbon=new bizagi.editor.component.ribbon(t.canvas,$.extend(e,{presenter:t}))},getGuid:function(){return this.guid},render:function(e){return e=e||{},this.guid=e.guid||null,this.ribbon.render(e)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.ribbon.model",{},{init:function(e){var t=this;t.model=e,t._super(),t.items={},t.properties={},t.actions={},t.groups={},e.elements&&t.processElements(e.elements,!0)},getViewModel:function(){for(var e={elements:[]},t=0,i=this.model.elements.length;t<i;t++){var o=this.model.elements[t];o.hide||e.elements.push(o)}return e},addChildren:function(e,t){(e=e||[]).forEach(function(e){return t.elements.push(e)}),this.processElements(e)},processElements:function(e,t){for(var i=this,o=0;o<e.length;o++){var r=e[o];if(r.guid=r.guid||Math.guid(),r.caption=bizagi.localization.getResource(r.caption)||"",r.tooltip=r.tooltip?bizagi.localization.getResource(r.tooltip):r.caption,t&&(i.groups[r.name]=r),i.items[r.guid]=r,r.property&&!r.value&&(i.properties[r.property]=r),r.action&&(i.actions[r.action]=r),r.property&&r.value){var n=i.properties[r.property];n.values=n.values||{},n.values[JSON.encode(r.value)]=r}r.disabled=1==r.disabled||"disabled"==r.disabled,r.originalDisabled=r.disabled,r.elements&&i.processElements(r.elements)}},getElementByAction:function(e){return this.actions[e]},processElementsForConvertTo:function(e){this.processElements(e)},getElement:function(e){return this.items[e]},reset:function(){$.each(this.properties,function(e,t){t.disabled=t.originalDisabled}),$.each(this.actions,function(e,t){t.disabled=t.originalDisabled})},enableProperty:function(e,t){var i=this.properties[e];if(i){for(var o in i.disabled=!1,i.values)i.values[o].selected=!1;(t="undefined"!==t&&"boolean"==typeof t?t.toString():t)&&(i.values[JSON.encode(t)]?i.values[JSON.encode(t)].selected=!0:"object"==typeof t.rule&&(i.values[JSON.encode("expression")].selected=!0))}},disableProperty:function(e){var t=this.properties[e];t&&(t.disabled=!0)},enableAction:function(e){var t=this.actions[e];t&&(t.disabled=!1)},disableAction:function(e){var t=this.actions[e];t&&(t.disabled=!0)},checkAction:function(e){var t=this.actions[e];t&&(t.checked=!0)},uncheckAction:function(e){var t=this.actions[e];t&&(t.checked=!1)},showGroup:function(e){var t=this.groups[e];t&&(t.hide=!1)},hideGroup:function(e){var t=this.groups[e];t&&(t.hide=!0)},setCaption:function(e,t){var i,o=this.properties[e];o&&$.isArray(o.elements)&&o.elements.length>0&&(i=$.grep(o.elements,function(e,i){return!(!e.value||!e.value.key)&&e.value.key===t})),i&&i[0]&&i[0].caption&&(o.caption=i[0].caption)}}),bizagi.editor.component.controller("bizagi.editor.component.contextmenu",{init:function(e,t){var i=this;i._super(e),t=t||{},i.canvas=e,i.model=t.model,i.presenter=t.presenter,i.mWidthDropDown=100,i.mainContainer=t.mainContainer},loadTemplates:function(){var e={"context-menu-container":bizagi.getTemplate("bizagi.editor.component.contextmenu")+"#contextmenu-container",button:bizagi.getTemplate("bizagi.editor.component.contextmenu")+"#contextmenu-button","button-separator":bizagi.getTemplate("bizagi.editor.component.contextmenu")+"#contextmenu-button-separator"};return this._super(e)},refresh:function(e){this.render(e)},render:function(e){var t=this;t.model=e.model||t.model,t.model.items&&(t.element.empty(),$.when(t.loadTemplates()).done(function(){var i=$.tmpl(t.getTemplate("context-menu-container"));t.renderItems($(".contextmenu-group",i),t.model.getViewModel()),i.appendTo(t.canvas),t.setDropdownWidth(),e.position&&t.updateContextMenuPosition(e.position),t.configureCloseHandler(),t.fixElementsPosition()}))},fixElementsPosition:function(){var e=this;setTimeout(function(){$(".biz-dropdown",e.element).each(function(){var e=$(this),t=e.outerWidth();t>180&&e.css("right",String(-160-(t-180))+"px")})},500)},setDropdownWidth:function(){var e=this;$(".biz-dropdown",e.element).each(function(){var t=$(this),i=e.mWidthDropDown;$(".contextmenu-group-row",t).each(function(){var e=$(this),t=$(".biz-ico",e).length,o=$(".biz-ico",e).outerWidth(!0)*t+10,r=$(".contextmenu-caption",e).outerWidth(!0)+o;r>i&&(i=r)}),t.width(i)})},configureCloseHandler:function(){$(document).bind("mouseup.contextmenu",function(e){if(0==e.button){var t=$(".contextmenu-container").parent();0===t.has(e.target).length&&(t.hide(),$(document).unbind("mouseup.contextmenu"))}})},updateContextMenuPosition:function(e){var t,i,o,r,n,a,s,l,d;o=this.element,t=e.x,i=e.y,r=this.mainContainer.width(),n=this.mainContainer.height(),a=o.width()+10,s=o.height()+10,l=Math.abs(t+a-r),d=Math.abs(i+s-n),t+a+135>r?(t=t-a-l+a,o.css("left",t),o.addClass("rightToLeft")):(o.css("left",e.x),o.removeClass("rightToLeft")),i+s+120>n?(i=i-s-d+s,o.css("top",i),o.addClass("bottomToTop")):(o.css("top",e.y),o.removeClass("bottomToTop")),o.show()},renderItems:function(e,t){if(t.items)for(var i=0;i<t.items.length;i++){var o=t.items[i];o.separator?this.renderSeparator(e,o):this.renderItem(e,o)}},renderItem:function(e,t){var i=$.tmpl(this.getTemplate("button"),$.extend(t,{hasItems:t.items&&t.items.length>0}));if(t.items){var o=i.find("ul:lt(1)");this.renderItems(o,t)}i.appendTo(e)},renderSeparator:function(e){$.tmpl(this.getTemplate("button-separator")).appendTo(e)},destroy:function(){this.element.detach()},"div.biz-btn click":function(e){var t=e.data("guid"),i=this.model.getItem(t);i.items||(this.presenter.publish("onItemClicked",{property:i.property,value:i.value,action:i.action}),this.destroy())}}),bizagi.editor.observableClass.extend("bizagi.editor.component.contextmenu.presenter",{},{init:function(e){this._super();var t=(e=e||{}).mainContainer||"form-modeler";this.guid=e.guid,this.canvas=e.canvas||$("<div />").appendTo(t),this.contextmenu=new bizagi.editor.component.contextmenu(this.canvas,$.extend(e,{presenter:this,mainContainer:t}))},getGuid:function(){return this.guid},destroy:function(){this.contextmenu.destroy()},render:function(e){return e=e||{},this.contextmenu.render(e)}}),$.Class.extend("bizagi.editor.component.contextmenu.model",{},{init:function(e){var t=this;t.model=e,e&&e.items&&(t.items={},t.actionItems={},t.properties={},t.processItems(e.items))},getViewModel:function(){return this.model},processItems:function(e){for(var t=0;t<e.length;t++)this.processItem(e[t])},processItem:function(e){var t=this;if(e.guid=Math.guid(),t.items[e.guid]=e,e.caption&&(e.caption=bizagi.localization.getResource(e.caption)),e.action&&(t.actionItems[e.action]=e),e.property&&e.value){var i=t.properties[e.property]=t.properties[e.property]||{values:{}};i.values=i.values||{},e.default=e.value,i.values[JSON.encode(e.value)]=e}e.items&&t.processItems(e.items)},getItem:function(e){return this.items[e]},getItemByAction:function(e){return this.actionItems[e]},getProperties:function(){return this.properties},assignProperty:function(e,t){var i=this.properties[e];if(i){for(var o in i.values)i.values[o].selected=!1,i.values[o].value=i.values[o].default;(t="undefined"!==t&&"boolean"==typeof t?t.toString():t)&&(i.values[JSON.encode(t)]?i.values[JSON.encode(t)].selected=!0:"object"==typeof t.rule&&(i.values[JSON.encode("expression")].selected=!0,i.values[JSON.encode("expression")].value=t))}},addConverToItem:function(e){if(this.removeConvertToItem(),$.isArray(e)&&e.length>0){for(var t={caption:"formmodeler-component-contextmenu-caption-convertto",style:"convertTo",items:[],css:"bz-studio bz-convert-to_16x16_standard"},i=0,o=e.length;i<o;i+=1){var r=e[i];t.items.push({caption:r.caption,style:r.controlName,action:"convertTo",value:r.controlName,css:r.style})}this.model.items.push(t),this.currentConvertToModel=t,this.processItem(t)}},removeConvertToItem:function(){this.currentConvertToModel&&this.model.items.splice($.inArray(this.currentConvertToModel,this.model.items),1)}}),$.Controller("bizagi.editor.component.editor",{init:function(e,t,i){this.canvas=e,this.model=t,this.controller=i,this.tmpl={},this.parameters=this.getParams()},render:function(){var e=this,t=new $.Deferred;return e.element.empty(),e.inline=!1,e.callbacks=[],e.element.addClass("ui-editor"),$.isEmptyObject(e.tmpl)?$.when(e.loadInitTemplates(),e.loadTemplates()).done(function(){e.options.show&&(e.renderEditor(e.element,e.options),e.addTooltipEditor()),t.resolve()}):(e.renderEditor(e.element,e.options),e.addTooltipEditor(),t.resolve()),t.promise()},registerCallback:function(e){this.callbacks.push(e)},postRender:function(){var e;for(e=0;e<this.callbacks.length;e++)this.callbacks[e]()},addTooltipEditor:function(){$("i[title]",this.element).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"}),$("div[title]",this.element).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"})},addRequired:function(e,t){var i=this.options.required;if(t&&(i=t.required),bizagi.util.parseBoolean(i)&&e.length>0)for(var o=$(' <span class="biz-ico ui-bizagi-render-required bz-studio bz-required_16x16_standard"/>'),r=0;r<e.length;r++)$(e[r]).hasClass("ui-required")||($(e[r]).addClass("ui-required"),$(e[r]).append(o))},loadTemplate:function(e,t){var i=this,o=new $.Deferred;return i.tmpl.hasOwnProperty(e)?(o.resolve(i.tmpl[e]),o.promise()):bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[e]=t})},loadInitTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("error",bizagi.getTemplate("bizagi.editor.component.editor").concat("#validator-editor")),e.loadTemplate("multiple-error",bizagi.getTemplate("bizagi.editor.component.editor").concat("#validator-multiple-editor")),e.loadTemplate("multiple-error-item",bizagi.getTemplate("bizagi.editor.component.editor").concat("#validator-multiple-editor-item")),e.loadTemplate("modal",bizagi.getTemplate("bizagi.editor.component.editor").concat("#modal-editor")),e.loadTemplate("modal-actions",bizagi.getTemplate("bizagi.editor.component.editor").concat("#modal-actions-editor"))).done(function(){t.resolve()}),t.promise()},getTemplate:function(e){return this.tmpl.hasOwnProperty(e)?this.tmpl[e]:null},hideEditors:function(){var e=this;e.element.addClass("ui-control-select-editor-up"),$(".bizagi_editor_component_properties").append('<div id="blockerProperties" class="blocker-properties ui-block-properties" style="display:none;"></div>'),$("#blockerProperties").fadeIn(),$("#blockerProperties").bind("click",function(){e.hideDialog(),$(this).fadeOut(function(){$(this).remove()})})},showEditors:function(){this.element.removeClass("ui-control-select-editor-up"),$("#blockerProperties").fadeOut(function(){$(this).remove()})},getParams:function(){var e,t={},i=this.model["editor-parameters"];if(!$.isEmptyObject(i))for(e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t},createDialog:function(e,t){var i,o,r,n=this;return n.idDialogEditor=n.options.name+"_DialogModal_"+Math.floor(1e7*Math.random()),r=n.options.name,n.elPopUp=i=$.tmpl(n.getTemplate("modal"),{caption:n.options.caption,id:n.idDialogEditor,style:r}),o=$.tmpl(n.getTemplate("modal-actions")),i.addClass("ui-modal-as-dialog"),i.append(o),n.element.addClass("editor_with_modal"),i.find(".content-modal").append(e),i.find(".modal-editor-buttons").append(t),i.hide(),$(".ui-close-btn",i).click(function(){n.hideDialog()}),i},showDialog:function(e,t){var i,o,r=this,n=$.Deferred();return o=$("#bizagi_editor_component_properties"),$("#"+r.idDialogEditor,o).length<=0&&o.append(r.elPopUp),i=$("#"+r.idDialogEditor,o),r.dialogReference=i,r.dialogPosition={clientY:t.clientY,offsetY:t.offsetY,top:e.position().top},r.hideEditors(),$.when(r.updateDialogPosition("init")).done(function(){i.show("slide",{direction:"left"},function(){$(this).removeClass("ui-modal-close").addClass("ui-modal-open"),n.resolve()})}),n.promise()},updateDialogPosition:function(e){var t,i,o,r,n,a,s,l,d,c=this;r=c.element.parent().parent(),i=$("#"+c.idDialogEditor,r),n=$("body").height(),t=c.dialogPosition.clientY+c.dialogPosition.offsetY-i.height()/2-r.position().top,o=2*parseFloat(c.element.parent().width())+"px",(s=t+i.height()+r.position().top)>n?(a=t-(s-n)-20,i.find("[class*='ui-modal-arrow-']").css("top","83%")):(i.find("[class*='ui-modal-arrow-']").css("top","43%"),a=t-20),"init"!==e?(l={minWidth:o},i.css(l),d={top:a},e?i.animate(l):i.css(d)):(l={top:a,left:"100%",minWidth:o},i.css(l))},hideDialog:function(e){var t,i,o=this;i=$("#bizagi_editor_component_properties"),(t=$("#"+o.idDialogEditor,i)).hasClass("ui-modal-closing")||(t.addClass("ui-modal-closing"),t.hide("slide",{direction:"left"},1e3,function(){$(this).addClass("ui-modal-close").removeClass("ui-modal-open").removeClass("ui-modal-closing"),o.showEditors(),e&&(o.elPopUp.remove(),e())}))},createValidateMessage:function(e,t,i){var o,r,n,a=[];if($.isArray(i)){o=$.tmpl(this.getTemplate("multiple-error"),{typeMessage:"error",style:"bz-studio bz-warning-red_16x16_standard"}),r=$(".editor-validator-message-error",o);for(var s=0;s<i.length;s++)o.attr("id","bizagi_editor_validator_container-"+s),n=$.tmpl(this.getTemplate("multiple-error-item"),{typeMessage:"error",message:i[s],style:"bz-studio bz-warning-red_16x16_standard"}),r.append(n),a.push("bizagi_editor_validator_container-"+s);e.data("error-msg",a),o.addClass("ui-inline-error"),o.insertAfter(e),o.fadeIn()}else{(o=$.tmpl(this.getTemplate("error"),{typeMessage:"error",message:i,style:"bz-studio bz-warning-red_16x16_standard"})).css({left:t.left,top:t.top});var l=o.attr("id")+"-"+this.options.name;o.attr("id",l),e.data("error-msg",o.attr("id")),$(e.parent()).append(o),o.fadeIn()}},showError:function(e,t){var i,o,r;i={left:"0px",top:e.position().top+this.getRealHeight(e)+2+"px"},(o=this.getValidateId(e))&&"object"!=typeof t?(r=$("#"+o),$(".editor-validator-message-error",r).html(t),r.css(i).fadeIn()):this.createValidateMessage(e,i,t)},hideError:function(e){var t;t=this.getValidateId(this.element),$(document.getElementById(t)).fadeOut(function(){$(this).remove()})},getValidateId:function(e){var t,i,o=!1;return i=e.closest(".ui-editor"),(t=$(".bizagi_editor_validator_container",i)).length>0&&(o=t.attr("id")),o},getRealHeight:function(e){var t,i,o=0;t=["padding-top","padding-bottom","margin-top","margin-bottom","border-top","border-bottom"],i=$(e).height();for(var r=0;r<t.length;r++)o+=parseFloat($(e).css(t[r]));return o+i},highLightProperty:function(e){this.element.addClass("ui-editor-highlight"),this.showError(this.element,e)},uiControls:{comboBox:function(e){var t=this;return t.settings={uiPlaceHolderText:"",uiValues:[{label:"true",value:"true"},{label:"false",value:"false"}],uiInline:!1,onChange:function(){}},$.extend(t.settings,arguments[0]),t.editor=t.settings.uiEditor,t.update=function(e){this.methods.update(e)},t.getValue=function(){return this.value},t.getLabel=function(){return this.label},t.methods={instance:this,init:function(){var e=this;e.container=e.settings.uiContainer,$.when(e.methods.loadTemplates.apply(e)).done(function(){e.methods.renderControl.apply(e)})},loadTemplates:function(){var e=new $.Deferred;return $.when(this.editor.loadTemplate("comboSelector",bizagi.getTemplate("bizagi.editor.component.editor").concat("#comboBox-selector")),this.editor.loadTemplate("comboValues",bizagi.getTemplate("bizagi.editor.component.editor").concat("#comboBox-values")),this.editor.loadTemplate("comboOptions",bizagi.getTemplate("bizagi.editor.component.editor").concat("#comboBox-options"))).done(function(){e.resolve()}),e.promise()},renderControl:function(){try{var e,t,i,o=this;if(e=o.settings,i=(t=o.container).hasClass("ui-control-editor")?t:$(".ui-control-editor",t),e.hasOwnProperty("uiInitValue")?o.value=o.editor.uiControls.utils.validateValue(o.settings.uiInitValue):o.value=o.editor.uiControls.utils.validateValue(o.editor.options.value),e.uiPlaceHolderText.length>0){var r={label:e.uiPlaceHolderText,value:"select"};e.uiValues.unshift(r)}o.options=o.editor.uiControls.utils.selectValueOption(o.value,e.uiValues),o.methods.asignValues.apply(o,[{uiContainer:i}])}catch(e){bizagi.log(e.message,e,"error")}},asignValues:function(e){var t,i,o,r,n,a,s,l=this;for(var d in a=$('<div class="ui-bizagi-editor-uiControls-comboBox ui-control-input" tabindex="0"/>'),i=$.tmpl(l.editor.getTemplate("comboValues"),{}),l.options)n=l.options[d].value,(s=l.options[d]).hasOwnProperty("value")&&(s.hasOwnProperty("icon")||(s.icon=s.value),o=$.tmpl(l.editor.getTemplate("comboOptions"),s),$('[class*="-check"]',o).toggleClass("ui-comboBox-image-small-check ui-comboBox-image-small-uncheck"),$('[class*="-check"]',o).addClass("bz-black"),$('[class*="-check"]',o).toggleClass("bz-point_16x16_standard bz-point_16x16_black"),$(".ui-comboBox-value",o).data("value",n),"string"==typeof n&&$(".ui-comboBox-value",o).attr("data-value",n),o.bind("click",function(e){l.methods.changeDropDown.apply(l,[{ui:this,e:e}])}),s.hasOwnProperty("tmpl")&&$(".ui-comboBox-value",o).append(s.tmpl),i.append(o),s.hasOwnProperty("selected")&&($('[class*="-uncheck"]',o).toggleClass("ui-comboBox-image-small-uncheck ui-comboBox-image-small-check"),$('[class*="-uncheck"]',o).removeClass("bz-black"),$('[class*="-uncheck"]',o).toggleClass("bz-point_16x16_black bz-point_16x16_standard"),t=$.tmpl(l.editor.getTemplate("comboSelector"),s),$(".ui-comboBox-value",t).data("value",s.value),$(".ui-comboBox-value",t).data("label",s.label),l.value=s.value,l.label=s.label,s.hasOwnProperty("tmpl")&&t.append(s.tmpl)));void 0===t&&(o=$(".ui-bizagi-editor-comboBox-option",i).eq(0),$('[class*="-uncheck"]',o).toggleClass("ui-comboBox-image-small-uncheck ui-comboBox-image-small-check"),$('[class*="-uncheck"]',o).removeClass("bz-black"),$('[class*="-uncheck"]',o).toggleClass("bz-point_16x16_black bz-point_16x16_standard"),t=$.tmpl(l.editor.getTemplate("comboSelector"),l.options[0]),$(".ui-comboBox-value",t).data("value",l.options[0].value),$(".ui-comboBox-value",t).data("label",l.options[0].label),l.value=l.options[0].value,l.label=l.options[0].label,l.options[0].hasOwnProperty("tmpl")&&$(".ui-comboBox-selector-text",t).append(l.options[0].tmpl)),l.settings.uiInitLabel&&$(".ui-comboBox-value",t).text(l.settings.uiInitLabel),t.bind("click",function(e){l.methods.changeDropDown.apply(l,[{ui:this,e:e}])}),i.addClass("ui-comboBox-close"),a.append(i),a.prepend(t),e.uiContainer.append(a),l.settings.hasOwnProperty("uiWidthIcon")&&(r=l.settings.uiWidthIcon,$('[class*="ui-comboBox-image-large-"]',e.uiContainer).toggleClass("biz-ico biz-ico-"+r))},update:function(e){var t=this.instance,i=t.settings;t.settings.uiValues=[],t.settings.uiValues=e,t.options=e,this.changeDataCombo.apply(t,[i])},changeDataCombo:function(e){var t,i,o=this;if((t=o.settings).uiPlaceHolderText.length>0){var r={label:t.uiPlaceHolderText,value:"select"};e.uiValues.unshift(r)}$.extend(t,e),t.hasOwnProperty("uiInitValue")?o.value=o.editor.uiControls.utils.validateValue(o.settings.uiInitValue):o.value=o.editor.uiControls.utils.validateValue(o.editor.options.value),o.options=o.editor.uiControls.utils.selectValueOption(o.value,t.uiValues),(i=o.container.hasClass("ui-control-editor")?o.container:$(".ui-control-editor",o.container)).empty(),o.methods.asignValues.apply(o,[{uiContainer:i}])},changeDropDown:function(e){var t={};$.extend(t,e);var i,o,r,n=$(t.ui);i=n.hasClass("ui-bizagi-editor-comboBox-option")?n.parent().parent():n.parent(),r=$(".ui-bizagi-editor-comboBox-selector",i),o=$(".ui-bizagi-editor-comboBox-dropDown",i),t.uiSelector=r,t.uiDropDown=o,o.hasClass("ui-comboBox-close")?o.slideDown(function(){$(this).addClass("ui-comboBox-open").removeClass("ui-comboBox-close"),$(".ui-comboBox-arrow-close",r).addClass("ui-comboBox-arrow-open").removeClass("ui-comboBox-arrow-close"),$(document).bind("mouseup",function(){0===o.has(e.ui).length&&o.slideUp(function(){$(this).addClass("ui-comboBox-close").removeClass("ui-comboBox-open"),$(".ui-comboBox-arrow-open",r).addClass("ui-comboBox-arrow-close").removeClass("ui-comboBox-arrow-open")})})}):o.slideUp(function(){$(this).addClass("ui-comboBox-close").removeClass("ui-comboBox-open"),$(".ui-comboBox-arrow-open",r).addClass("ui-comboBox-arrow-close").removeClass("ui-comboBox-arrow-open")}),n.hasClass("ui-bizagi-editor-comboBox-selector")||this.methods.setValue.apply(this,[t])},setValue:function(e){var t,i,o,r,n,a,s=$(e.ui);i=$('[class*="ui-comboBox-image-large-"]',s),t=$(".ui-comboBox-value",s).data("value"),o=$(".ui-comboBox-value",s).text(),r=$(".ui-comboBox-value",e.uiSelector),n=$('[class*="ui-comboBox-image-large-"]',e.uiSelector),$('[class*="-check"]',e.uiDropDown).toggleClass("ui-comboBox-image-small-check ui-comboBox-image-small-uncheck"),$('[class*="-uncheck"]',e.uiDropDown).addClass("bz-black"),a=$('[data-value="'+t+'"]',e.uiDropDown),$('[class*="-uncheck"]',a.parent()).toggleClass("ui-comboBox-image-small-uncheck ui-comboBox-image-small-check"),$('[class*="-check"]',a.parent()).removeClass("bz-black"),r.data("value",t),r.data("label",o),r.text(o),n.attr("class",i.attr("class")),this.value=t,this.label=o,this.settings.onChange(t,e.e)}},t.methods[e]?t.methods[e].apply(t,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e&&"string"!=typeof e?void $.error("Method "+method+" does not exist on bizagi.editor.component.editor.uiControls.comboBox"):t.methods.init.apply(t,arguments)},booleanSwitch:function(e){var t=this;return t.settings={uiValues:[{label:"true",value:"true"},{label:"false",value:"false"}],uiInline:!1,onChange:function(){}},$.extend(t.settings,arguments[0]),t.editor=t.settings.uiEditor,t.update=function(e){t.methods.update(e)},t.getValue=function(){return this.value},t.methods={instance:this,init:function(){var e=this;$.when(e.methods.loadTemplates.apply(e)).done(function(){return e.methods.renderControl.apply(e)})},loadTemplates:function(){var e=new $.Deferred;return $.when(this.editor.loadTemplate("booleanSwitchSelector",bizagi.getTemplate("bizagi.editor.component.editor").concat("#booleanSwitch-selector")),this.editor.loadTemplate("booleanSwitchValues",bizagi.getTemplate("bizagi.editor.component.editor").concat("#booleanSwitch-values")),this.editor.loadTemplate("booleanSwitchOptions",bizagi.getTemplate("bizagi.editor.component.editor").concat("#booleanSwitch-options"))).done(function(){e.resolve()}),e.promise()},renderControl:function(){var e,t,i,o,r,n,a,s,l=this;for(var d in e=l.settings,r=l.container=l.settings.uiContainer,t=$.tmpl(l.editor.getTemplate("booleanSwitchSelector"),{}),n=r.hasClass("ui-control-editor")&&$(".ui-bizagi-editor-uiControls-booleanSwitch",r).length>0?$(".ui-bizagi-editor-uiControls-booleanSwitch",r):r,a=$('<div class="ui-bizagi-editor-uiControls-booleanSwitch ui-control-input biz-btn-horizontal" tabindex="0"/>'),i=$.tmpl(l.editor.getTemplate("booleanSwitchValues"),{}),s=$(".ui-bizagi-editor-booleanSwitch-content",i),e.hasOwnProperty("uiInitValue")?l.value=l.editor.uiControls.utils.validateValue(l.settings.uiInitValue):l.value=l.editor.uiControls.utils.validateValue(l.editor.options.value),l.options=l.editor.uiControls.utils.selectValueOption(l.value,e.uiValues),l.options)l.options[d].hasOwnProperty("value")&&(o=$.tmpl(l.editor.getTemplate("booleanSwitchOptions"),l.options[d]),l.options[d].hasOwnProperty("selected")?o.addClass("ui-booleanSwitch-selected"):o.addClass("ui-booleanSwitch-unselected"),s.append(o));return a.append(i),a.append(t),n.append(a),e.uiContainer=$(".ui-bizagi-editor-booleanSwitch-content",n),e.uiSelector=$(".ui-bizagi-editor-booleanSwitch-selector",n),n.bind("click",function(e){var t=l.settings;$.extend(t,{ui:this,e:e}),l.methods.changeSwitch.apply(l,[t])}),l.editor.inline&&n.addClass("ui-control-editor-inline"),$.extend(e,{ui:null,e:null}),l.methods.changeSwitch.apply(l,[e]),l},update:function(e){var t=this.instance,i=t.settings;t.value=e,$.extend(i,{ui:null,e:null}),this.changeSwitch.apply(t,[i])},changeSwitch:function(e){var t,i,o,r=e,n=this;t=parseFloat($(r.uiContainer).width()),i=parseFloat($(r.uiSelector).width()),o=n.editor.inline?"38":t-i,null!=e.ui&&(n.value=!n.value),n.value?r.animation={selector:{left:o-1+"px",timer:300},container:{left:"0%",timer:300}}:r.animation={selector:{left:"0px",timer:300},container:{left:"-100%",timer:300}},null!=e.ui?n.methods.animateChange.apply(n,[r]):(r.uiSelector.css({left:r.animation.selector.left}),r.uiContainer.css({left:r.animation.container.left}))},animateChange:function(e){var t=this;$(e.uiSelector).stop().animate({left:e.animation.selector.left},e.animation.selector.timer),$(e.uiContainer).stop().animate({left:e.animation.container.left},e.animation.selector.timer,function(){var i=$('[class*="selected"]',e.uiContainer);i.removeClass("ui-booleanSwitch-selected").removeClass("ui-booleanSwitch-unselected"),i.each(function(){$(this).data("value")==t.value?$(this).addClass("ui-booleanSwitch-selected"):$(this).addClass("ui-booleanSwitch-unselected")}),t.methods.setValue.apply(t,[e])})},setValue:function(e){var t;$(e.ui);t=$(".ui-booleanSwitch-selected",e.ui).data("value"),this.value=t,this.settings.onChange(t,e.e)}},t.methods[e]?t.methods[e].apply(t,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e&&"string"!=typeof e?void $.error("Method "+method+" does not exist on bizagi.editor.component.editor.uiControls.booleanSwitch"):t.methods.init.apply(t,arguments)},iconMenu:{},groupUIControls:{},utils:{validateValue:function(e){var t=e;switch(e){case"true":case!0:t=!0;break;case"false":case!1:case null:t=!1;break;default:t=e}return t},selectValueOption:function(e,t){for(var i=0;i<t.length;i++){e!==this.validateValue(t[i].value)||null==e&&null==e||(t[i].selected=!0)}return t},hasHScrollBar:function(e){return e.get(0).scrollWidth>e.width()}}}}),bizagi.editor.component.editor("bizagi.editor.component.editor.string",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n=this;n.inputValue=t.value,n.defaultValue=t.default,n.charLimit=1e3,n.localization=!!t.showLocalization,n.placeholder=!!t["editor-parameters"].placeholder,n.placeholderText=n.placeholder?" "+t["editor-parameters"].placeholder:" ",n.isRegularExpression=t["editor-parameters"].isRegularExpression||!1,n.isReadOnly=void 0!==t["editor-parameters"].readOnly&&bizagi.util.parseBoolean(t["editor-parameters"].readOnly),n.isAdhocProcess=n.controller.propertyBox&&n.controller.propertyBox.adhocProcessId,$.extend(t,{placeholder:n.placeholder,placeholderText:n.placeholderText,isReadOnly:n.isReadOnly}),i=$.tmpl(n.getTemplate("frame"),t),n.isReadOnly||(o=$.tmpl(n.getTemplate("default")),r=$.tmpl(n.getTemplate("localization")),n.localization&&$(".editor-string-input",i).append(r),n.isAdhocProcess||$(".editor-string-input",i).append(o)),i.appendTo(e)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.string").concat("#string-frame")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.string").concat("#string-default-value")),this.loadTemplate("localization",bizagi.getTemplate("bizagi.editor.component.editor.string").concat("#string-localization"))).done(function(){e.resolve()}),e.promise()},renderError:function(e){var t=e;t.hasClass("error")||t.addClass("error"),this.showError(e,this.Error),e.select()},validate:function(e){var t,i,o=!0;return i=(t=$(e)).val(),t.removeClass("error"),this.hideError(e),!this.isLength(e)&&i.length?(o=!1,this.renderError(e)):this.isRegularExpression&&!this.regularExpressionIsValid(e)&&this.renderError(e),o},regularExpressionIsValid:function(e){var t=this,i=$(e).val();try{return new RegExp(i),!0}catch(e){return t.Error=e.message,!1}},isLength:function(e){return this.Error=bizagi.localization.getResource("bizagi-editor-numberrange-error-lenght").replace("$number",this.charLimit),e.val().length<=this.charLimit},"label click":function(e,t){e.next().focus()},"input keydown":function(e,t){if(13==t.keyCode&&this.validate(e)&&this.inputValue!=e.val()){var i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:e.val(),type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.options.hasOwnProperty("exclusive")&&(i=$.extend({},i,{exclusive:this.options.exclusive})),this.controller.publish("propertyEditorChanged",i),this.inputValue=e.val()}},"input blur":function(e,t){var i=this,o=i.element.find('input[type="text"]').parent();if(i.validate(e)&&this.inputValue!=e.val()){var r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:e.val(),type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.options.hasOwnProperty("exclusive")&&(r=$.extend({},r,{exclusive:i.options.exclusive})),i.controller.publish("propertyEditorChanged",r),i.inputValue=e.val()}i.element.find(".editor-string-icon-localization").removeClass("editor_string_fadeIn"),o.toggleClass("editor-string-focus")},"input focus":function(e,t){var i;i=this.element.find(".editor-string-icon-localization"),inputParent=this.element.find('input[type="text"]').parent(),i.addClass("editor_string_fadeIn"),inputParent.toggleClass("editor-string-focus")},"span.editor-string-icon-localization click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_LOCALIZATION,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".editor-string-icon-default-value click":function(e,t){var i,o=this.defaultValue;i=this.element.find('input[type="text"]'),o&&(i.val(o),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:o,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}))},".editor-string-icon-localization mouseenter":function(e,t){e.addClass("editor_string_fadeIn")},".editor-string-icon-localization mouseleave":function(e,t){e.removeClass("editor_string_fadeIn")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.localizablestring",{init:function(e,t,i){this._super(e,t,i),this.focus=null},renderEditor:function(e,t){var i,o,r,n,a=this,s={};t.value||(a.defaultAttributeSelected=!0,t.value=""),n=a.parameters,a.inputValue=t.value,a.defaultValue=t.default?t.default:"",a.localization=!0,$.isEmptyObject(n)||(bizagi.util.parseBoolean(n["show-attribute-default"])&&(a.defaultBindCaption=!0),bizagi.util.parseBoolean(n["show-richtext-editor"])&&(/<\s*\w+[\S\s]*>/im.test(t.value)&&($.extend(s,{value:"HTML",html:!0}),a.isHTML=!0),a.showRichtextEditor=!0)),i=$.tmpl(a.getTemplate("frame"),$.extend({},t,s)),o=$.tmpl(a.getTemplate("localization"));var l=$.tmpl(a.getTemplate("defaultBindCaption"));a.showRichtextEditor&&$(".editor-localizablestring-input",i).append($.tmpl(a.getTemplate("richtext"))),a.localization&&$(".editor-localizablestring-input",i).append(o),a.defaultBindCaption&&($(".editor-localizablestring-input",i).append(l),a.defaultAttributeSelected&&($(".editor-localizablestring-default-bind",i).addClass("bz-studio"),$(".editor-localizablestring-default-bind",i).addClass("bz-checked_16x16_standard"))),i.appendTo(e),r=$("label",i),a.addRequired(r)},selectEditor:function(){$("input",this.element).select()},loadTemplates:function(){var e;return e=new $.Deferred,$.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-frame")),this.loadTemplate("localization",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-localization")),this.loadTemplate("richtext",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-richtext")),this.loadTemplate("richtext-editor",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-richtext-editor")),this.loadTemplate("defaultBindCaption",bizagi.getTemplate("bizagi.editor.component.editor.localizablestring").concat("#localizablestring-default-bind"))).done(function(){e.resolve()}),e.promise()},remove:function(){this.element.hide(),this.element.empty()},publishValue:function(e){this.options.value=e;var t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:e,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.options.hasOwnProperty("exclusive")&&(t=$.extend({},t,{exclusive:this.options.exclusive})),this.controller.publish("propertyEditorChanged",t),this.inputValue=e},"input keyup":function(e,t){var i=e.val()||"";e.hasClass("isHtml")&&"HTML"!==i&&e.removeClass("isHtml"),13==t.keyCode&&i!==this.inputValue&&this.publishValue(i)},"input blur":function(e){var t,i;i=this.element.find('input[type="text"]').parent(),this.showRichtextEditor&&this.element.find(".editor-localizablestring-richtext").removeClass("ui-control-fadeIn"),this.element.find(".editor-localizablestring-localization").removeClass("ui-control-fadeIn"),i.toggleClass("ui-control-focus"),(t=e.val()||"")!==this.inputValue&&"HTML"!==t&&this.publishValue(t)},"input focus":function(){var e,t;this.showRichtextEditor&&this.element.find(".editor-localizablestring-richtext").addClass("ui-control-fadeIn"),e=this.element.find(".editor-localizablestring-localization"),t=this.element.find('input[type="text"]').parent(),e.addClass("ui-control-fadeIn"),t.toggleClass("ui-control-focus")},".editor-localizablestring-richtext click":function(){var e,t,i=this;if(i.showRichtextEditor){(e=i.popup=bizagi.createPopup({name:"bz-fm-localizablestring-richtext",container:"form-modeler",center:!0,title:bizagi.localization.getResource("formmodeler-component-editor-localizablestring-richtext-title")})).content.append($.tmpl(i.getTemplate("richtext-editor")));var o=$(".bz-fm-localizablestring-richtext-content",e.content);t=$(".bz-fm-localizablestring-richtext-buttons",o);var r=o.height()-t.height();o.height(r),$(".bz-fm-localizablestring-richtext-ok",t).click(function(){var t=tinymce.activeEditor.getContent();(t=bizagi.util.trim(t))&&(t="<span>"+t+"</span>",i.publishValue(t)),e.overlay.remove()}),$(".bz-fm-localizablestring-richtext-cancel",t).click(function(){e.overlay.remove()}),tinymce.remove(),tinymce.init({selector:"textarea#richtext-editor",menubar:!1,resize:!1,forced_root_block:!1,plugins:["textcolor autoresize"],toolbar1:"bold italic underline strikethrough | forecolor"}),i.isHTML&&tinymce.activeEditor.setContent(i.inputValue),setTimeout(function(){var e=$(".mce-edit-area.mce-container",o);e.height(r),e.css("overflow-y","auto")},10)}},".editor-localizablestring-localization mouseup":function(){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_LOCALIZATION,value:this.inputValue,oldValue:this.options.value,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".editor-localizablestring-localization mouseenter":function(e,t){e.addClass("editor_localizablestring_fadeIn")},".editor-localizablestring-localization mouseleave":function(e,t){e.removeClass("editor_localizablestring_fadeIn")},".editor-localizablestring-default-bind click":function(e,t){e.hasClass("bz-checked_16x16_standard")?(e.removeClass("bz-checked_16x16_standard"),e.addClass("bz-check_16x16_standard")):(e.removeClass("bz-check_16x16_standard"),e.addClass("bz-checked_16x16_standard"),this.publishValue()),console.log("clicked")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.thumbnail",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i=this;i.inputValue=t.value,i.minLimit=32,i.maxLimit=128,i.firstSubproperty=i.options.subproperties[0],i.secondSubproperty=i.options.subproperties[1];var o,r=$.tmpl(i.getTemplate("frame"),t),n=$.tmpl(i.getTemplate("check"),t);for(var a in i.mapSizes=i.mapForSizes(t),i.actualValue=i.retrieveValueObject(t),i.element.addClass("without-dropdown"),i.mapSizes)o=$.tmpl(i.getTemplate("option"),{name:i.mapSizes[a].name,option:i.mapSizes[a].label,value:{firstSubproperty:i.mapSizes[a].value[i.firstSubproperty.property.name],secondSubproperty:i.mapSizes[a].value[i.secondSubproperty.property.name]}}),n=$.tmpl(i.getTemplate("check"),{}),o.append(n),$(".thumbnail-group-container",r).append(o),"auto"===a&&($(".thumbnail-dimension",o).remove(),$(".thumbnail-value",o).css("margin-top","5px"));r.appendTo(e);var s=$("label",r);i.addRequired(s);var l=$(".thumbnail-image-small-"+i.actualValue.name,i.element).closest(".biz-btn-vertical");l.addClass("biz-btn-checked"),l.find(".thumbnail-image-icon-uncheck").toggleClass("thumbnail-image-icon-uncheck thumbnail-image-icon-check")},retrieveValueObject:function(e){var t={},i=this.mapSizes;switch(parseInt(e.value.width)){case-1:t=i.auto;break;case 32:t=i.small;break;case 64:t=i.medium;break;case 128:t=i.large}return t},mapForSizes:function(e){var t,i=this,o={small:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-small"),value:{},name:"Small"},medium:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-medium"),value:{},name:"Medium"},large:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-large"),value:{},name:"Large"},auto:{label:bizagi.localization.getResource("formmodeler-component-editor-thumbnail-auto"),value:{},name:"Auto"}};switch(o.large.value[i.firstSubproperty.property.name]="128",o.large.value[i.secondSubproperty.property.name]="128",o.medium.value[i.firstSubproperty.property.name]="64",o.medium.value[i.secondSubproperty.property.name]="64",o.small.value[i.firstSubproperty.property.name]="32",o.small.value[i.secondSubproperty.property.name]="32",o.auto.value[i.firstSubproperty.property.name]="-1",o.auto.value[i.secondSubproperty.property.name]="-1",parseInt(e.value.width)){case-1:t="auto";break;case 32:t="small";break;case 64:t="medium";break;case 128:t="large";break;default:return o}return o[t].selected=!0,o[t].value[i.firstSubproperty.property.name]=e.value[i.firstSubproperty.property.name]?e.value[i.firstSubproperty.property.name]:o[t].value[i.firstSubproperty.property.name],o[t].value[i.secondSubproperty.property.name]=e.value[i.secondSubproperty.property.name]?e.value[i.secondSubproperty.property.name]:o[t].value[i.firstSubproperty.property.name],o},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame-option")),this.loadTemplate("values",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame-values")),this.loadTemplate("check",bizagi.getTemplate("bizagi.editor.component.editor.thumbnail").concat("#thumbnail-frame-check"))).done(function(){e.resolve()}),e.promise()},selectOption:function(e,t){var i,o;$(".thumbnail-group",this.element).removeClass("biz-btn-checked"),this.element.hasClass("without-dropdown")?(e.addClass("biz-btn-checked"),$(".thumbnail-image-icon-check",this.element).removeClass("thumbnail-image-icon-check").addClass("thumbnail-image-icon-uncheck"),$(".thumbnail-image-icon-uncheck",e).toggleClass("thumbnail-image-icon-uncheck thumbnail-image-icon-check"),i=e.data("firstsubproperty"),o=e.data("secondsubproperty")):(e.parent().find(".thumbnail-group > i[class^=thumbnail-icon-small-]").removeClass("thumbnail-image-icon-check").addClass("thumbnail-image-icon-uncheck"),$("i:eq(2)",e).toggleClass("thumbnail-image-small-uncheck thumbnail-image-small-check"),i=e.data("firstsubproperty"),o=e.data("secondsubproperty"),$(".thumbnail-container > .thumbnail-group-container .thumbnail-group > i:eq(0)",this.element).removeClass().addClass("thumbnail-icon-small-"+value.toLowerCase()),$(".thumbnail-container > .thumbnail-group-container .thumbnail-group > i:eq(1)",this.element).text(newValue),$(".thumbnail-values",this.element).removeClass("thumbnail-open").addClass("thumbnail-close"));var r=[];r.push({property:this.firstSubproperty.property.name,value:i}),r.push({property:this.secondSubproperty.property.name,value:o}),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_MULTIPLE_PROPERTIES,properties:r,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue={width:i,height:o}},".thumbnail-container > .thumbnail-group-container mouseenter":function(e,t){$(".thumbnail-image-normal-expand",this.element).removeClass("thumbnail-hidden").addClass("thumbnail-show"),e.removeClass("thumbnail-collapsed").addClass("thumbnail-expanded")},".thumbnail-container > .thumbnail-group-container mouseleave":function(e,t){$(".thumbnail-image-normal-expand",this.element).removeClass("thumbnail-show").addClass("thumbnail-hidden"),e.removeClass("thumbnail-expanded").addClass("thumbnail-collapsed")},".ui-editor:not(.without-dropdown) > .thumbnail-group-container click":function(e,t){$(".thumbnail-values",this.element).slideDown(function(){$(this).removeClass("thumbnail-close").addClass("thumbnail-open"),$(document).bind("mouseup",function(){var e=$(".thumbnail-values");0===e.has(t.target).length&&e.slideUp()})})},".thumbnail-group-container .thumbnail-group click":function(e,t){this.selectOption(e,t)},".thumbnail-values > .thumbnail-group click":function(e,t){this.selectOption(e,t)},".thumbnail-values mouseenter":function(e,t){$(".thumbnail-container > .thumbnail-group-container .thumbnail-image-normal-expand",this.element).removeClass("thumbnail-hidden").addClass("thumbnail-show"),$(".thumbnail-container > .thumbnail-group-container .thumbnail-group",this.element).removeClass("thumbnail-collapsed").addClass("thumbnail-expanded")},".thumbnail-values mouseleave":function(e,t){$(".thumbnail-container > .thumbnail-group-container .thumbnail-image-normal-expand").removeClass("thumbnail-show").addClass("thumbnail-hidden"),$(".thumbnail-container > .thumbnail-group-container .thumbnail-group").removeClass("thumbnail-expanded").addClass("thumbnail-collapsed"),e.removeClass("thumbnail-open").addClass("thumbnail-close")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.boolean",{init:function(e,t,i){this._super(e,t,i),this.focus=null},renderEditor:function(e,t){var i,o,r,n,a=this,s=!1,l={};a.isAdhocProcess=a.controller.propertyBox&&a.controller.propertyBox.adhocProcessId,void 0===t.value?t.value=!1:null===t.value||!1===t.value||"false"==t.value?t.value=!1:!0!==t.value&&"true"!=t.value||(t.value=!0),a.inputValue=!!t.value,void 0===t.default?a.defaultValue=!1:null===t.default||!1===t.default||"false"==t.default?a.defaultValue=!1:!0!==t.default&&"true"!=t.default||(a.defaultValue=!0),(n=t["editor-parameters"])&&(s=!!n.tooltip&&bizagi.localization.getResource(n.tooltip),n.labels&&(l.true=bizagi.localization.getResource(n.labels.true.caption),l.false=bizagi.localization.getResource(n.labels.false.caption))),a.inline=!0,$.extend(t,{uiValues:[{label:n.labels?l.true:bizagi.localization.getResource("formmodeler-component-editor-boolean-true"),value:"true"},{label:n.labels?l.false:bizagi.localization.getResource("formmodeler-component-editor-boolean-false"),value:"false"}],tooltip:s}),o=$.tmpl(this.getTemplate("frame"),t),i=$.tmpl(this.getTemplate("default")),a.inline&&o.addClass("bizagi-editor-boolean-inline"),a.isAdhocProcess||o.append(i),o.appendTo(e),r=$("label",o),a.addRequired(r);new a.uiControls.booleanSwitch({uiEditor:a,uiContainer:$(".ui-control-editor",o),uiValues:t.uiValues,uiInline:a.inline,onChange:function(e,t){a.responseChangeSwitch(e,t,a)}});$(".boolean-container.ui-control-container[title]",a.element).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-boolean-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.boolean").concat("#boolean-frame")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.boolean").concat("#boolean-default-action"))).done(function(){e.resolve()}),e.promise()},responseChangeSwitch:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r},".editor-boolean-icon-default-value click":function(e){var t,i;t=this.inputValue,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t,newValue:this.defaultValue,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i),this.inputValue=this.defaultValue}}),bizagi.editor.component.editor("bizagi.editor.component.editor.ruleexpression",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o;this.inline=!0,this.data=t,i=this.createDataSource(),this.inputValue=t.value,o=$.tmpl(this.getTemplate("frame"),t),this.inline&&o.addClass("bizagi-editor-ruleexpression-inline"),o.appendTo(e),this.setInitValue(t.value),this.createUIControls(o,i)},createDataSource:function(){var e=this.data["editor-parameters"],t=null,i=null;return this.data.value&&(i=this.data.value.rule||this.data.value.rule90?{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-expression"),value:this.data.value,icon:"expression",style:"bz-studio bz-expresion-ex_16x16_standard"}:{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-expression"),value:{rule:{baref:{ref:"expression"}}},icon:"expression",style:"bz-studio bz-expresion-ex_16x16_standard"}),$.isEmptyObject(e)||e.type?($.extend(this.data,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-true"),value:{fixedvalue:"true"},icon:"true",style:"bz-studio bz-yes-no_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-ruleexpression-option-false"),value:{fixedvalue:"false"},icon:"false",style:"bz-studio bz-false_16x16_standard"},i],valueCheck:!1}),t=!1):void 0!==e.allowboolean&&("false"!=e.allowboolean&&0!=e.allowboolean||($.extend(this.data,{uiValues:[i],valueCheck:!1}),t=!0)),t},createUIControls:function(e,t){var i=this;i.myCombo=t?new i.uiControls.comboBox({uiEditor:i,uiPlaceHolderText:"-----",uiContainer:$(".ui-control-editor",e),uiValues:i.data.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseChangeCombo(e,t,i)}}):new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor",e),uiValues:i.data.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseChangeCombo(e,t,i)}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.ruleexpression").concat("#ruleexpression-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.ruleexpression").concat("#ruleexpression-frame-option")),this.loadTemplate("edit",bizagi.getTemplate("bizagi.editor.component.editor.ruleexpression").concat("#ruleexpression-frame-edit"))).done(function(){e.resolve()}),e.promise()},setInitValue:function(val){for(var valBoolean,self=this,uiValues=self.data.uiValues,i=0;i<uiValues.length;i++)delete uiValues[i].selected,val.rule&&uiValues[i].value.rule?(uiValues[i].selected="selected",val.rule.displayName&&(uiValues[i].label=val.rule.displayName)):val.rule90&&uiValues[i].value.rule90?(uiValues[i].selected="selected",val.rule90.displayName&&(uiValues[i].label=val.rule90.displayName)):(valBoolean=eval(uiValues[i].value.fixedvalue),eval(val.fixedvalue)===valBoolean&&(uiValues[i].selected="selected"))},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n=bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,(r.rule||r.rule90)&&(n=bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,i.options.name=i.options.name),i.options.value=e,i.setInitValue(r),i.myCombo.update(i.data.uiValues),bizagi.log("PROPERTIES_SELECT_EXPRESSION",r),i.controller.publish("propertyEditorChanged",{typeEvent:n,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Boolean"}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.booleandisplay",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=this;r.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-booleandisplay-option-check"),value:"check",style:"bz-studio bz-yes-no_16x16_standard",icon:"nothing"},{label:bizagi.localization.getResource("formmodeler-component-editor-booleandisplay-option-radio"),value:"option",style:"bz-studio  bz-radio_16x16_standard",icon:"nothing"}],valueCheck:!1}),t.value=t.value?t.value:"expression",r.inputValue=t.value,i=$.tmpl(r.getTemplate("frame"),t),elEditAction=$.tmpl(r.getTemplate("edit"),{}),r.inline&&i.addClass("bizagi-editor-booleandisplay-inline"),i.appendTo(e),o=$("label",i),r.addRequired(o);new r.uiControls.comboBox({uiEditor:r,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:r.inline,onChange:function(e,t){r.responseChangeCombo(e,t,r)}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.booleandisplay").concat("#booleandisplay-frame")),this.loadTemplate("edit",bizagi.getTemplate("bizagi.editor.component.editor.booleandisplay").concat("#booleandisplay-frame-edit"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.typedinamic",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=this;r.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-typedinamic-option-databinding"),value:"databind",icon:"select-box"},{label:bizagi.localization.getResource("formmodeler-component-editor-typedinamic-option-rule"),value:"ruleexpression"}],valueCheck:!1}),t.value=t.value?t.value:"expression",r.inputValue=t.value,i=$.tmpl(r.getTemplate("frame"),t),elEditAction=$.tmpl(r.getTemplate("edit"),{}),r.inline&&i.addClass("bizagi-editor-typedinamic-inline"),i.appendTo(e),o=$("label",i),r.addRequired(o);new r.uiControls.comboBox({uiEditor:r,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:r.inline,onChange:function(e,t){r.responseChangeCombo(e,t,r)}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.typedinamic").concat("#typedinamic-frame")),this.loadTemplate("edit",bizagi.getTemplate("bizagi.editor.component.editor.typedinamic").concat("#typedinamic-frame-edit"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.linktarget",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-linktarget-option-newtab"),value:"newtab"},{label:bizagi.localization.getResource("formmodeler-component-editor-linktarget-option-newwindow"),value:"newwindow"}],valueCheck:!1}),o.inputValue=t.value,(i=$.tmpl(o.getTemplate("frame"),t)).appendTo(e);new o.uiControls.comboBox({uiWidthIcon:0,uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.linktarget").concat("#linktarget-frame"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,options={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",options),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.horizontalalign",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n,a,s,l,d,c,u,p,m,h,g,f,b=this;b.inDropDown=!1,b.inputValue=t.value,"columntitlealign"==t.name?(m=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-right"),h=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-left"),g=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-center"),f=bizagi.localization.getResource("formmodeler-component-editor-columntitlealign-align-justify")):"columnalign"==t.name?(m=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-right"),h=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-left"),g=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-center"),f=bizagi.localization.getResource("formmodeler-component-editor-columnalign-align-justify")):(m=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-right"),h=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-left"),g=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-center"),f=bizagi.localization.getResource("formmodeler-component-editor-horizontalalign-align-justify")),$.extend(t,{labelValues:{optionRight:m,optionLeft:h,optionCenter:g,optionJustify:f},iconValues:["right","left","center","justify"],iconsNew:["bz-studio bz-text-align-right_16x16_standard","bz-studio bz-text-align-left_16x16_standard","bz-studio bz-text-align-center_16x16_standard","bz-studio bz-text-align-justify_16x16_standard"]}),i=$.tmpl(b.getTemplate("frame"),t);var v=$.tmpl(b.getTemplate("values"),t),y=$.tmpl(b.getTemplate("check"),t);if(b.inDropDown){for(a in v.insertAfter($(".horizontalalign-group-container",i)),c=0,t.labelValues){if(t.value===t.labelValues[a]){u=t.iconValues[c];break}c++}(r=$.tmpl(b.getTemplate("option"),{option:t.value,icon:u})).append(y),$(".horizontalalign-group-container",i).append(r)}else b.element.addClass("without-dropdown");for(a in c=0,t.labelValues)d=t.labelValues[a].toLowerCase(),u=t.iconValues[c],p=t.iconsNew[c],l=bizagi.localization.getResource(t.labelValues[a]),n=$.tmpl(b.getTemplate("option"),{option:d,title:l,icon:u,newIcon:p}),y=$.tmpl(b.getTemplate("check"),{}),n.append(y),b.inDropDown?(n.append(y),$(".horizontalalign-values",i).append(n)):$(".horizontalalign-group-container",i).append(n),c++;i.appendTo(e),s=$("label",i),b.addRequired(s),b.inDropDown?$(".horizontalalign-values",i).append(n):(t.value="default"==t.value?"left":t.value,(o=$(".horizontalalign-image-small-"+t.value.toLowerCase(),b.element).parent()).addClass("biz-btn-checked"),o.find(".horizontalalign-image-icon-uncheck").toggleClass("horizontalalign-image-icon-uncheck horizontalalign-image-icon-check")),$(".horizontalalign-group",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-horizontalalign-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame-option")),this.loadTemplate("values",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame-values")),this.loadTemplate("check",bizagi.getTemplate("bizagi.editor.component.editor.horizontalalign").concat("#horizontalalign-frame-check"))).done(function(){e.resolve()}),e.promise()},selectOption:function(e,t){var i,o=this;$(".horizontalalign-group",o.element).removeClass("biz-btn-checked"),o.element.hasClass("without-dropdown")?(e.addClass("biz-btn-checked"),$(".horizontalalign-image-icon-check",o.element).removeClass("horizontalalign-image-icon-check").addClass("horizontalalign-image-icon-uncheck"),$(".horizontalalign-image-icon-uncheck",e).toggleClass("horizontalalign-image-icon-uncheck horizontalalign-image-icon-check"),i=e.find("i:eq(1)").data("value")):(e.parent().find(".horizontalalign-group > i[class^=horizontalalign-icon-small-]").removeClass("horizontalalign-image-icon-check").addClass("horizontalalign-image-icon-uncheck"),$("i:eq(2)",e).toggleClass("horizontalalign-image-small-uncheck horizontalalign-image-small-check"),i=e.find("i:eq(1)").data("value"),$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group > i:eq(0)",o.element).removeClass().addClass("horizontalalign-icon-small-"+value.toLowerCase()),$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group > i:eq(1)",o.element).text(i),$(".horizontalalign-values",this.element).removeClass("horizontalalign-open").addClass("horizontalalign-close")),o.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:i.toLowerCase(),data:i.toLowerCase(),type:o.options.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")}),o.inputValue=i.toLowerCase()},".horizontalalign-group click":function(e,t){this.selectOption(e,t)},".horizontalalign-values > .horizontalalign-group click":function(e,t){this.selectOption(e,t)},".horizontalalign-values mouseenter":function(e,t){$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-image-normal-expand",this.element).removeClass("horizontalalign-hidden").addClass("horizontalalign-show"),$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group",this.element).removeClass("horizontalalign-collapsed").addClass("horizontalalign-expanded")},".horizontalalign-values mouseleave":function(e,t){$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-image-normal-expand").removeClass("horizontalalign-show").addClass("horizontalalign-hidden"),$(".horizontalalign-container > .horizontalalign-group-container .horizontalalign-group").removeClass("horizontalalign-expanded").addClass("horizontalalign-collapsed"),e.removeClass("horizontalalign-open").addClass("horizontalalign-close")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.rendertype",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.clicks=0,o.inputValue=o.options.value,i=$.tmpl(this.getTemplate("frame"),t),$.each(t.data,function(e,t){o.renderOptions(i.find("select"),t)}),i.appendTo(e)},renderOptions:function(e,t){var i="";t.hasOwnProperty("selected")&1==t.selected&&(i=" selected=selected"),$.extend(t,{selected:i}),$.tmpl(this.getTemplate("option"),t).appendTo(e)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.rendertype").concat("#rendertype-frame")),this.loadTemplate("option",bizagi.getTemplate("bizagi.editor.component.editor.rendertype").concat("#rendertype-option"))).done(function(){e.resolve()}),e.promise()},"span focus":function(e,t){e.removeClass("editor-text-rendertype-enabled").addClass("editor-text-rendertype-disabled"),e.next().removeClass("editor-options-disabled").addClass("editor-options-enabled").focus()},"select blur":function(e,t){e.removeClass("editor-options-enabled").addClass("editor-options-disabled"),e.prev().removeClass("editor-text-rendertype-disabled").addClass("editor-text-rendertype-enabled")},"label click":function(e,t){var i=this;i.clicks++,1==i.clicks&&setTimeout(function(){1==i.clicks&&e.next().focus(),i.clicks=0},200)},"label dblclick":function(e,t){var i,o=e.closest(".bizagi_editor_component_editor_rendertype").find("select"),r=o.children().length,n=o.find("option:selected");r-1==o.find("option").index(n)?(o.find("option:first").attr("selected","selected"),i=o.find("option:first").text(),e.next().text(i),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=i):(n.next().attr("selected","selected"),i=n.next().text(),e.next().text(i),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=i)},"select change":function(e,t){e.prev().text(e.find("option:selected").text()),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:e.val(),type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=e.val()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.controlreference",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=this;r.inline=!0,r.retrieveData(t),t.value=t.value?t.value:"isEmpty",r.inputValue=t.value,(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),o=$("label",i),r.addRequired(o),r.myCombo=new r.uiControls.comboBox({uiEditor:r,uiPlaceHolderText:bizagi.localization.getResource("formmodeler-component-editor-all-select-one"),uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:r.inline,onChange:function(e,t){r.responseChangeCombo(e,t,r)}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.controlreference").concat("#controlreference-frame"))).done(function(){e.resolve()}),e.promise()},retrieveData:function(e){var t,i,o,r;if(e["editor-parameters"].hasOwnProperty("elements")){i=e["editor-parameters"].elements.length,r=[];for(var n=0;n<i;n++)(o={}).label=e["editor-parameters"].elements[n].displayname,o.value=e["editor-parameters"].elements[n].guid,t="controlreference-icon-"+e["editor-parameters"].elements[n].displayname.i18n.default.replace(/ /gi,"").toLowerCase(),o.icon="column "+t,r.push(o);$.extend(e,{uiValues:r})}return e},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.displayname",{init:function(e,t,i){this._super(e,t,i),this.focus=null},renderEditor:function(e,t){var i,o;this.inputValue=this.options.value,this.defaultValue=t.default?t.default:"",this.localization=(t.showLocalization,!0),i=$.tmpl(this.getTemplate("frame"),t),elLocalization=$.tmpl(this.getTemplate("localization")),this.localization&&$(".ui-control-input",i).append(elLocalization),i.appendTo(e),o=$("label",i),this.addRequired(o)},loadTemplates:function(){var e;return e=new $.Deferred,$.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.displayname").concat("#displayname-frame")),this.loadTemplate("localization",bizagi.getTemplate("bizagi.editor.component.editor.displayname").concat("#displayname-localization"))).done(function(){e.resolve()}),e.promise()},remove:function(){this.element.hide(),this.element.empty()},"input keyup":function(e,t){var i=e.val();13==t.keyCode&&i!==this.inputValue&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=i)},"input blur":function(e,t){var i=this.element.find('input[type="text"]').parent(),o=e.val();this.element.find(".editor-displayname-localization").removeClass("ui-control-fadeIn"),i.toggleClass("ui-control-focus"),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:o,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=o},"input focus":function(e,t){var i,o;i=this.element.find(".editor-displayname-localization"),inputParent=this.element.find('input[type="text"]').parent(),i.addClass("ui-control-fadeIn"),inputParent.toggleClass("ui-control-focus"),(o=e.val())!==this.inputValue&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:o,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValue=o)},"span.editor-displayname-localization click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_LOCALIZATION,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},"span.editor-displayname-localization mouseenter":function(e,t){e.addClass("ui-control-fadeIn")},"span.editor-displayname-localization mouseleave":function(e,t){e.removeClass("ui-control-fadeIn")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.int",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=this,n="";void 0===t.value?t.value="":null===t.value&&(t.value=""),r.inputValue=t.value,r.defaultValue=void 0!==t.default&&null!==t.default?t.default:"",r.suffix="",t["editor-parameters"].hasOwnProperty("suffix")&&""!=t["editor-parameters"].suffix&&(r.suffix=t["editor-parameters"].suffix,n=r.suffix+" "),i=$.tmpl(this.getTemplate("frame"),$.extend({},t,{templateSuffix:n}));var a=$.tmpl(this.getTemplate("default"));if(i.append(a),i.appendTo(e),t["editor-parameters"].hasOwnProperty("placeholder-type")){var s=t["editor-parameters"]["placeholder-type"];r.setPlaceholder(i),"default"==s&&""!=r.defaultValue&&(r.options["editor-parameters"].max=parseInt(r.defaultValue))}o=$("label",i),r.addRequired(o)},setPlaceholder:function(e){var t=this,i=parseInt(t.defaultValue),o=parseInt(t.options.value),r=e.find("input");isNaN(o)?isNaN(i)||r.attr("placeholder",i):-1!=i&&o>i&&t.registerCallback(function(){t.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-default")+i,t.showError(r,t.Error),r.select()})},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.int").concat("#int-frame")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.int").concat("#int-default-action"))).done(function(){e.resolve()}),e.promise()},remove:function(){this.element.hide(),this.element.empty()},validate:function(e){var t,i,o=!1;return i=(t=$(e)).val(),isNaN(parseInt(i))?(o=!1,""!=i&&(t.hasClass("error")||t.addClass("error"),this.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer"),this.showError(e,this.Error),t.select())):this.isInt(i)&&this.isInRange(i)&&!isNaN(parseInt(i))?(t.removeClass("error"),this.hideError(e),o=!0):(t.hasClass("error")||t.addClass("error"),this.showError(e,this.Error),t.select()),o},isInRange:function(e){var t=!0,i=this.options["editor-parameters"].min,o=this.options["editor-parameters"].max,r=parseInt(e);return null!=i&&""!==i&&(isNaN(parseInt(i))||r<parseInt(i)&&(this.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-rangemin").replace("$0",i),t=!1)),null!=o&&""!==o&&(isNaN(parseInt(o))||-1!=parseInt(o)&&r>parseInt(o)&&(this.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-rangemax").replace("$0",o),t=!1)),t},isInt:function(e){var t;return t=RegExp("^[-+]?[0-9]+"+this.suffix+"$"),this.Error=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer"),t.test(e)||""==e},"input[type='text'] blur":function(e,t){var i,o;(e.val($.trim(e.val())),o=e.val(),""!=this.suffix)&&(RegExp("^[-+]?[0-9]+"+this.suffix+"$").test(o)||/^[-+]?[0-9]+$/.test(o)&&e.val(o+this.suffix));(this.validate(e)||""==o)&&(i=parseInt(o),isNaN(i)&&(i=void 0),this.controller.publish("propertyEditorChanged",{oldValue:this.inputValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}))},"input[type='text'] keydown":function(e,t){var i,o;if(o=e.val(),13==t.keyCode){if(e.val($.trim(e.val())),""!=this.suffix)RegExp("^[-+]?[0-9]+"+this.suffix+"$").test(o)||/^[-+]?[0-9]+$/.test(o)&&e.val(o+this.suffix);(this.validate(e)||""==o)&&(i=parseInt(o),isNaN(i)&&(i=void 0),this.controller.publish("propertyEditorChanged",{oldValue:this.inputValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}))}},".biz-ico.biz-ico-default click":function(e,t){var i,o;(o=this.element.find("input")).val(""),o.hasClass("error")&&(o.removeClass("error"),this.hideError(o)),i={oldValue:this.inputValue,newValue:void 0,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.renderlayout",{listensTo:["innerPropertyChange"]},{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n,a,s=this;s.properties=[],o=t.subproperties.length;var l=t.subproperties[2]?t.subproperties[2].property.value:null,d=t.subproperties[2]?t.subproperties[2].property.default:null;s.layoutType=l||d,n=s.calculateValues(t.subproperties).replace(/\%/gi,""),this.values=s.retrieveValues(n),a=s.retrieveNames(t.subproperties),t.caption=t.caption||"Layout",$.extend(t,{calculatedValues:n},this.values,a),(i=$.tmpl(s.getTemplate("frame"),t)).find(".renderlayout-group").hide().addClass("renderlayout-close");for(var c=0;c<o;c++)r=t.subproperties[c].property,s.renderSubproperty(i.find(".renderlayout-group"),r);i.appendTo(e),s.inputValue=[],"pixels"==s.layoutType?(s.defaultLabelValue=t.subproperties[0].property.default,s.defaultControlValue=t.subproperties[1].property.default,s.defaultPixelValue=s.properties[0].options.value):(s.defaultLabelValue=s.properties[0].options.value,s.defaultControlValue=s.properties[1].options.value,s.defaultPixelValue=""),s.subpropertiesReset=t.subproperties,s.inputValue.push(s.defaultLabelValue),s.inputValue.push(s.defaultControlValue),s.createDialogEditor(t)},createDialogEditor:function(e){var t,i,o,r,n,a,s=this;s.elPopUpContent=t=$.tmpl(s.getTemplate("content-popup"),e),i=$.tmpl(s.getTemplate("actions-popup"),e),$(".renderlayout-box1",t).text(s.defaultLabelValue+"%").attr("data-value",s.defaultLabelValue+"%"),$(".renderlayout-box2",t).text(s.defaultControlValue+"%").attr("data-value",s.defaultControlValue+"%"),$("#renderlayout-px-label",t).val(s.defaultPixelValue),(n=$(".biz-action-btn",i).eq(1)).click(function(e){s.responseOkButton.apply(s,[n,e])}),(r=$(".biz-action-btn",i).eq(2)).click(function(e){s.responseCancelButton.apply(s,[r,e])}),(a=$(".biz-action-btn",i).eq(0)).click(function(e){s.responseApplyButton.apply(s,[a,e])}),$(".renderlayout-split",t).mousemove(function(){s.setBoxesValue($(this).val())}),s.createEditorUIControls(e,t),s.modalReference=s.createDialog(t,i),(o=$(".biz-btn-close",s.modalReference).eq(0)).click(function(e){s.responseCloseButton.apply(s,[o,e])})},setBoxesValue:function(e){var t=e,i=100-t;$(".renderlayout-box1",self.elPopUpContent).text(t+"%").attr("data-value",t),$(".renderlayout-box2",self.elPopUpContent).text(i+"%").attr("data-value",i)},renderSubproperty:function(e,t){var i,o;i=$.tmpl(this.getTemplate("frame-property"),t),t.value=parseFloat(t.value),$.extend(t,{"editor-parameters":{suffix:"%",range:{min:0,max:100}}}),o=new bizagi.editor.component.editor.int(i,t,this.controller),this.properties.push(o),i.appendTo(e),o.render()},calculateValues:function(e){var t,i,o="",r=[50,50];for(t="pixels"==this.layoutType?e.length-2:e.length-1,o+="",i=0;i<t;i++)e[i].property.hasOwnProperty("value")&null!=e[i].property.value?o+=e[i].property.value:e[i].property.hasOwnProperty("default")&null!=e[i].property.default?o+=e[i].property.default:(o+=r[i],e[i].property.value=r[i]),o+=i==t-1?"":", ";return o+=""},retrieveValues:function(e){var t=e.replace(/\[|\]|,/g,"").trim().split(" ");return{per1:t[0],per2:t[1]}},retrieveNames:function(e){var t,i=[],o=e.length;for(t=0;t<o;t++)i[t]=e[t].property.caption;return{caption1:i[0],caption2:i[1]}},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame")),this.loadTemplate("frame-property",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame-property")),this.loadTemplate("content-popup",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame-popup")),this.loadTemplate("actions-popup",bizagi.getTemplate("bizagi.editor.component.editor.renderlayout").concat("#renderlayout-frame-popup-actions"))).done(function(){e.resolve()}),e.promise()},responseCloseDialog:function(){this.element.empty(),this.renderEditor(this.element,this.options)},".renderlayout-value click":function(e,t){this.showDialogBox(e,t)},".renderlayout-data > .biz-ico.ui-control-modal click":function(e,t){this.showDialogBox(e,t)},showDialogBox:function(e,t){var i=this;i.showDialog(e,t).done(function(){var e=$(".renderlayout-split",i.modalReference),t=i.inputValue[0];e.val(t)}),i.responseChangeDefaultFormat(i.layoutType,i.elPopUpContent),$("#renderlayout-px-label",i.modalReference).bind("keypress",function(e){var t=e.charCode?e.charCode:e.keyCode;if(8!=t&&(t<48||t>57))return!1})},responseCloseButton:function(){this.responseCloseDialog(),this.resetDataLayout()},responseOkButton:function(){var e=this,t=$("#renderlayout-px-label",e.modalReference).val(),i=bizagi.localization.getResource("bizagi-editor-px-value-empty");if("pixels"!=e.myCombo.value||""!=t&&"NaN"!=t){e.saveDataLayout({btnClicked:"ok"}),e.hideDialog(function(){e.responseCloseDialog()})}else bizagi.showMessageBox(i,"Bizagi","error")},responseApplyButton:function(){var e=$("#renderlayout-px-label",this.modalReference).val(),t=bizagi.localization.getResource("bizagi-editor-px-value-empty");if("pixels"!=this.myCombo.value||""!=e&&"NaN"!=e){this.saveDataLayout({btnClicked:"apply"})}else bizagi.showMessageBox(t,"Bizagi","error")},saveDataLayout:function(e){var t,i,o,r=this,n=(e=e||{},r.options.subproperties);void 0!==e.subproperties&&(n=e.subproperties),t=n[0],i=n[1],o=n[2],r.layoutType=r.myCombo.value,"pixels"==r.layoutType?(t.property.value=$("#renderlayout-px-label",r.modalReference).val(),i.property.value="1"):(t.property.value=$(".renderlayout-box1",r.modalReference).attr("data-value"),i.property.value=$(".renderlayout-box2",r.modalReference).attr("data-value"));var a=[];a.push({property:t.property.name,value:t.property.value.replace(/\%/gi,"")}),a.push({property:i.property.name,value:i.property.value.replace(/\%/gi,"")}),o&&o.property&&(o.property.value=r.layoutType,a.push({property:o.property.name,value:o.property.value})),r.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_MULTIPLE_PROPERTIES,properties:a,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),void 0!==e.btnClicked&&("ok"!=e.btnClicked&&"apply"!=e.btnClicked||(r.subpropertiesReset=n))},resetDataLayout:function(){var e={subproperties:this.subpropertiesReset};this.saveDataLayout(e)},responseCancelButton:function(){var e=this;e.hideDialog(function(){e.responseCloseDialog()}),e.resetDataLayout()},responseChangeDefaultFormat:function(e,t){var i=$(".renderlayout-names[data-id='percentageData']",this.modalReference),o=$(".renderlayout-names[data-id='pixelData']",this.modalReference),r=$(".ui-bizagi-editor-comboBox-option",t),n=$(".biz-btn",r[0]),a=$(".biz-btn",r[1]),s=$(".biz-ico",n),l=$(".biz-ico",a),d=$(".ui-control-text-box, .ui-comboBox-selector-text",t),c=$("i",d),u=$("span",d),p=this.values.per1;p>100&&(this.values.per1=50);var m=100-p;s.removeClass(),l.removeClass(),"pixels"==e?($(".renderlayout-separator",t).hide(),c.removeClass("ui-comboBox-image-large-percentage biz-ico-0"),c.addClass("ui-comboBox-image-large-pixels biz-ico-0"),u.text(bizagi.localization.getResource("formmodeler-component-editor-renderLayout-pixels-format")),i.addClass("renderlayout-px-active"),o.removeClass("renderlayout-px-active"),s.addClass("biz-ico ui-comboBox-image-small-uncheck"),l.addClass("biz-ico ui-comboBox-image-small-check")):($(".renderlayout-separator",t).show(),c.removeClass("ui-comboBox-image-large-pixels biz-ico-0"),c.addClass("ui-comboBox-image-large-percentage biz-ico-0"),u.text(bizagi.localization.getResource("formmodeler-component-editor-renderLayout-percentage-format")),i.removeClass("renderlayout-px-active"),""!=p&&(this.values.per2=m,$(".renderlayout-box2",t).text(m+"%").attr("data-value",m)),o.addClass("renderlayout-px-active"),s.addClass("biz-ico ui-comboBox-image-small-check"),l.addClass("biz-ico ui-comboBox-image-small-uncheck"))},createEditorUIControls:function(e,t){var i=this;$.extend(e,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-renderLayout-percentage-format"),value:"percentage"},{label:bizagi.localization.getResource("formmodeler-component-editor-renderLayout-pixels-format"),value:"pixels"}]}),i.myCombo=new i.uiControls.comboBox({uiWidthIcon:0,uiEditor:i,uiInitValue:i.layoutType,uiContainer:$(".renderLayout-modal-default-format",t),uiValues:e.uiValues,uiInline:i.inline,onChange:function(e,o){i.responseChangeDefaultFormat(e,t)}})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.displaytype",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=this;r.inline=!0,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-both"),value:"both",style:" bz-studio bz-display-both_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-label"),value:"label",style:"bz-studio bz-text-label_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-value"),value:"value",style:"bz-studio bz-display-value_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-reversed"),value:"reversed",style:"bz-studio bz-display-reversed_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-displaytype-option-vertical"),value:"vertical",style:"bz-studio bz-display-vertical_16x16_standard"}]}),r.removeItems(t),t.value=t.value?t.value:"expression";for(var n=0;n<t.uiValues.length;n++)t.value===t.uiValues[n].value&&(t.uiValues[n].selected=!0);r.inputValue=t.value,(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),o=$("label",i),r.addRequired(o);new r.uiControls.comboBox({uiWidthIcon:32,uiEditor:r,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:r.inline,onChange:function(e,t){r.responseChangeCombo(e,t,r)}})},removeItems:function(e){var t=e["editor-parameters"],i=t&&t.hide,o=e.uiValues;if($.isArray(i)&&i.length>0){o=[];for(var r=0,n=e.uiValues.length;r<n;r++){var a=e.uiValues[r].value;-1==$.inArray(a,i)&&o.push(e.uiValues[r])}}e.uiValues=o},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.displaytype").concat("#displaytype-frame"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.currencysymbol",{init:function(e,t,i){this._super(e,t,i),this.focus=null},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",n),i.inputValue=r;var a=$(".ui-comboBox-value",i.element).html();$(".ui-bizagi-editor-comboBox-selector",i.element).attr("title",a)},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.currencysymbol").concat("#currencysymbol-frame"))).done(function(){e.resolve()}),e.promise()},renderEditor:function(e,t){var i,o=this;$.extend(t,{uiCurrencySymbolValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-separator-main"),value:"-1",unselectable:!0},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DEF"),value:""},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-USD"),value:"US$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-EUR"),value:"€"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GBP"),value:"£"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-INR"),value:"₹"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AUD"),value:"AUD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CAD"),value:"CAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SGD"),value:"SGD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-separator-all"),value:"-1",unselectable:!0},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AED"),value:"AED$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AFN"),value:"AFN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ALL"),value:"ALL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AMD"),value:"AMD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ANG"),value:"ANG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AOA"),value:"AOA$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ARS"),value:"ARS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AUD"),value:"AUD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AWG"),value:"AWG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-AZN"),value:"AZN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BAM"),value:"BAM$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BBD"),value:"BBD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BDT"),value:"BDT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BGN"),value:"BGN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BHD"),value:"BHD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BIF"),value:"BIF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BMD"),value:"BMD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BND"),value:"BND$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BOB"),value:"BOB$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BRL"),value:"R$"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BSD"),value:"BSD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BTN"),value:"BTN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BWP"),value:"BWP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BYR"),value:"BYR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-BZD"),value:"BZD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CAD"),value:"CAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CDF"),value:"CDF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CHF"),value:"CHF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CLP"),value:"CLP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CNY"),value:"元"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-COP"),value:"COP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CRC"),value:"CRC$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CUC"),value:"CUC$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CUP"),value:"CUP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CVE"),value:"CVE$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-CZK"),value:"Kč"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DJF"),value:"DJF "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DKK"),value:"kr"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DOP"),value:"DOP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-DZD"),value:"DZD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-EGP"),value:"EGP£ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ERN"),value:"ERN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ETB"),value:"ETB$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-EUR"),value:"€"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-FJD"),value:"FJD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-FKP"),value:"FKP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GBP"),value:"£"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GEL"),value:"GEL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GGP"),value:"GGP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GHS"),value:"GHS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GIP"),value:"GIP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GMD"),value:"GMD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GNF"),value:"GNF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GTQ"),value:"GTQ$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-GYD"),value:"GYD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HKD"),value:"HKD元 "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HNL"),value:"HNL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HRK"),value:"HRK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HTG"),value:"HTG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-HUF"),value:"Ft"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IDR"),value:"Rp"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ILS"),value:"₪"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IMP"),value:"IMP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-INR"),value:"₹"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IQD"),value:"IQD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-IRR"),value:"IRR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ISK"),value:"ISKkr "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JEP"),value:"JEP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JMD"),value:"J$"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JOD"),value:"JOD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-JPY"),value:"¥"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KES"),value:"KES$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KGS"),value:"KGS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KHR"),value:"KHR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KMF"),value:"KMF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KPW"),value:"KPW$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KRW"),value:"₩"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KWD"),value:"KWD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KYD"),value:"KYD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-KZT"),value:"KZT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LAK"),value:"LAK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LBP"),value:"LBP£ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LKR"),value:"₨"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LRD"),value:"LRD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LSL"),value:"LSL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-LYD"),value:"LYD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MAD"),value:"MAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MDL"),value:"MDL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MGA"),value:"MGA$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MKD"),value:"MKD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MMK"),value:"MMK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MNT"),value:"MNT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MOP"),value:"MOP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MRO"),value:"MRO$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MUR"),value:"MUR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MVR"),value:"MVR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MWK"),value:"MWK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MXN"),value:"MXN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-MZN"),value:"MZN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NAD"),value:"NAD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NGN"),value:"NGN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NIO"),value:"NIO$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NOK"),value:"NOKkr "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NPR"),value:"NPR₨ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-NZD"),value:"NZD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-OMR"),value:"﷼"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PAB"),value:"B/."},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PEN"),value:"PEN$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PGK"),value:"PGK$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PHP"),value:"Ph"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PKR"),value:"PKR₨ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PLN"),value:"zł"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-PYG"),value:"PYG "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-QAR"),value:"QAR﷼ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RON"),value:"le"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RSD"),value:"RSD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RUB"),value:"RUB "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-RWF"),value:"RWF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SAR"),value:"SAR﷼ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SBD"),value:"SBD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SCR"),value:"SCR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SDG"),value:"SDG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SEK"),value:"SEKkr "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SGD"),value:"SGD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SHP"),value:"SHP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SLL"),value:"SLL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SOS"),value:"SOS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SPL"),value:"SPL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SRD"),value:"SRD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-STD"),value:"STD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SVC"),value:"SVC$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SYP"),value:"SYP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-SZL"),value:"SZL$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-THB"),value:"฿"},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TJS"),value:"TJS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TMT"),value:"TMT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TND"),value:"TND$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TOP"),value:"TOP$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TRY"),value:"YTL "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TTD"),value:"TTD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TVD"),value:"TVD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TWD"),value:"TWD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-TZS"),value:"TZS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UAH"),value:"UAH$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UGX"),value:"UGX$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-USD"),value:"US$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UYU"),value:"UYU$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-UZS"),value:"UZS$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-VEF"),value:"VEFBs "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-VND"),value:"VND$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-VUV"),value:"VUV$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-WST"),value:"WST$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XAF"),value:"XAF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XAG"),value:"XAG$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XAU"),value:"XAU$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XBT"),value:"XBT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XCD"),value:"XCD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XDR"),value:"XDR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XOF"),value:"XOF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XPD"),value:"XPD$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XPF"),value:"XPF$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-XPT"),value:"XPT$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-YER"),value:"YER$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ZAR"),value:"ZAR$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ZMW"),value:"ZMW$ "},{label:bizagi.localization.getResource("formmodeler-component-editor-currency-symbol-ZWD"),value:"ZWD$ "}]}),t.uiCurrencySymbolValues.forEach(function(e){$.extend(e,{tooltip:e.label})}),void 0!==typeof t.value&&null!==t.value||(t.value="$"),o.inputValue=t.value,(i=$.tmpl(o.getTemplate("frame"),t)).appendTo(e),void 0===o.options.value&&(t.uiCurrencySymbolValues[1].selected="selected");new o.uiControls.comboBox({uiWidthIcon:32,uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiCurrencySymbolValues,onChange:function(e,t){-1!=e&&o.responseChangeCombo(e,t,o)}})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.totalize",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=this;r.inline=!0,t["editor-parameters"].type&&"number"==t["editor-parameters"].type?$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-none"),value:""},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-sum"),value:"sum"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-max"),value:"max"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-min"),value:"min"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-avg"),value:"avg"},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-count"),value:"count"}]}):$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-none"),value:""},{label:bizagi.localization.getResource("formmodeler-component-editor-totalize-option-count"),value:"count"}]}),t.value=t.value?t.value:"expression";for(var n=0;n<t.uiValues.length;n++)t.value===t.uiValues[n].value&&(t.uiValues[n].selected=!0);r.inputValue=t.value,(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),o=$("label",i),r.addRequired(o);new r.uiControls.comboBox({uiWidthIcon:32,uiEditor:r,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:r.inline,onChange:function(e,t){r.responseChangeCombo(e,t,r)}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.totalize").concat("#totalize-frame"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.daterange",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;t.caption=t.caption||bizagi.localization.getResource("formmodeler-component-editor-daterange-caption"),o.data=t,o.container=e,o.value=t.value?bizagi.clone(t.value):{},o.setEditorParameters(t),t.value=t.value||{},(i=$.tmpl(o.getTemplate("frame"),t)).appendTo(e),o.inputValue=t.value,o.mapSubproperties=o.generateMapSubProperties(t),o.renderMinValue(i),o.renderMaxValue(i)},setEditorParameters:function(e){self.showTime=!0===e["editor-parameters"].showtime.value?"daterange-show-time":"daterange-not-show-time",self.showtime=e["editor-parameters"].showtime.value,self.isOffline=e["editor-parameters"].isOffline||!1,self.isAdhocProcess=e["editor-parameters"].isAdhocProcess||!1},renderMinValue:function(e){var t,i,o=this;for(var r in o.data.min={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-daterange-min-caption"),style:"min-value"},o.mapSubproperties)if(-1!==o.mapSubproperties[r].name.indexOf("min")&&o.mapSubproperties[r].value){t=o.mapSubproperties[r].value,i="date"===o.mapSubproperties[r]["bas-type"]?"min":o.mapSubproperties[r].name.split(".")[1],$.extend(o.data.min,{value:t,type:i});break}null===o.data.min.value&&$.extend(o.data.min,{value:null,type:"min"}),o.data.min.style="daterange-min-value",o.renderTypeEditor(e,o.data.min)},renderMaxValue:function(e){var t,i,o=this;for(var r in o.data.max={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-daterange-max-caption"),style:"max-value"},o.mapSubproperties)if(-1!==o.mapSubproperties[r].name.indexOf("max")&&o.mapSubproperties[r].value){t=o.mapSubproperties[r].value,i="date"===o.mapSubproperties[r]["bas-type"]?"max":o.mapSubproperties[r].name.split(".")[1],$.extend(o.data.max,{value:t,type:i});break}null===o.data.max.value&&$.extend(o.data.max,{value:null,type:"max"}),o.data.max.style="daterange-max-value",o.renderTypeEditor(e,o.data.max)},generateMapSubProperties:function(e){for(var t,i=e.subproperties,o={},r=0;r<i.length;r++)o[t=i[r].property.name]=i[r].property,o[t].value&&("date"===o[t]["bas-type"]?o[t].value||(o[t].value=null):o[t].value.baref.ref||(o[t].value=null));return o},renderTypeEditor:function(e,t){var i,o,r,n,a=this;switch(i=t.type,r=t.value,$.extend(t,{isOffline:a.isOffline,isAdhocProcess:a.isAdhocProcess}),i){case"max":case"min":var s=a.showtime?" daterange-show-time":" daterange-not-show-time",l=t.style.concat(s),d=r||a.value[i];$.extend(t,{style:l,fixedvalue:d}),o=a.renderDefaultDate(e,t),a.showtime?$(".daterange-date-container .daterange-date-value",o).will_pickdate({timePicker:!0,allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y H:i:s",format:"m/d/Y H:i",onSelect:function(e){e=$.datepicker.formatDate("mm/dd/yy",e)+" "+a.retrieveHumanTime(e),t.value=e,n=$(".daterange-date-container .daterange-date-value",o),a.validateAndPublishFixedSubproperties(t,t.value,n)}}):$(".daterange-date-container .daterange-date-value",o).will_pickdate({allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y",format:"m/d/Y",onSelect:function(e){e=$.datepicker.formatDate("mm/dd/yy",e),t.value=e,n=$(".daterange-date-container .daterange-date-value",o),a.validateAndPublishFixedSubproperties(t,t.value,n)}});break;case"maxrule":case"maxrule90":case"minrule":case"minrule90":$.extend(t,{showTime:a.showTime}),t.rule=r||a.value[i].rule,a.renderDefaultRule(e,t)}},redrawRenderEditor:function(e,t,i){for(var o=this.data.subproperties,r=0;r<o.length;r++)if(o[r].property.name===t){o[r].property.value=i,this.options.value[t.split(".")[1]]=i;break}this.renderEditor(e,this.data)},renderDefaultDate:function(e,t){var i,o;return(i=$.tmpl(this.getTemplate("frame-date-fixed"),t)).appendTo(e),t.required=!0===this.mapSubproperties["daterange."+t.type].required,o=$("label",i),this.addRequired(o,t),i},renderDefaultRule:function(e,t){var i,o;return void 0!==t.value.displayName&&""!=t.value.displayName?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-daterange-rule")}),(i=$.tmpl(this.getTemplate("frame-rule"),t)).appendTo(e),t.required=!0===this.mapSubproperties["daterange."+t.type].required,o=$("label",i),this.addRequired(o,t),i},retrieveExculsiveSubProperty:function(e){var t=null;switch(e){case"maxrule":t="max";break;case"minrule":t="min";break;case"min":t="minrule";break;case"max":t="maxrule"}return t},validateAndPublishFixedSubproperties:function(e,t,i){this.isValidRange(t,e.type)?(this.hideError(i),this.mapSubproperties["daterange."+e.type].value=t,this.publishFixedSubproperties(e,t)):this.showError(i,this.error)},isValidRange:function(e,t){var i=!1,o=this.mapSubproperties["daterange.min"].value?this.mapSubproperties["daterange.min"].value:null,r=this.mapSubproperties["daterange.max"].value?this.mapSubproperties["daterange.max"].value:null;return"min"==t?null===r||""==r?i=!0:this.compareDate(r,e)>=0&&(i=!0):null===o||""==o?i=!0:this.compareDate(e,o)>=0&&(i=!0),!1===i&&(this.error=bizagi.localization.getResource("formmodeler-component-editor-daterange-error-range")),i},compareDate:function(e,t){var i=new Date(e),o=new Date(t);return i.valueOf()==o.valueOf()?0:i.valueOf()>o.valueOf()?1:-1},publishFixedSubproperties:function(e,t){var i,o;o="daterange."+e.type;var r=this.retrieveOldValue(e.type);this.value?this.value[o]||(this.value[o]={}):this.value={},this.value[o]=t,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:r,newValue:void 0===t?void 0:t,data:void 0===t?void 0:t,type:o,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i)},publishRuleSubproperties:function(e,t){var i,o,r=this;o="daterange."+e;var n=r.isRule90(e)?"rule90":"rule",a=r.retrieveOldValue(e);if(r.value?r.value[o]||(r.value[o]={}):r.value={},void 0===t)i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:a,newValue:t,data:t,type:o,id:r.element.closest(".bizagi_editor_component_properties").data("id")};else{r.value[o].rule={baref:{ref:t}};var s={};s[n]=r.value[o].rule,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:a,data:s,type:o,id:this.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting",editor:"rule"}}r.controller.publish("propertyEditorChanged",i),r.removeFixedExclusiveProperty(e),void 0===t&&(r.element.empty(),r.redrawRenderEditor(r.container,o,t))},removeFixedExclusiveProperty:function(e){var t;t=this.retrieveExculsiveSubProperty(e),this.publishFixedSubproperties({type:t},void 0)},removeRuleExclusiveProperty:function(e){var t;t=this.retrieveExculsiveSubProperty(e),this.publishRuleSubproperties(t,void 0)},retrieveOldValue:function(e){return this.value[e]?""!=this.value[e]?this.value[e]:"expression"!=this.value[e].rule.baref.ref?{rule:this.value[e].rule}:"":""},retrieveHumanTime:function(e){var t=e.getHours(),i=e.getMinutes();return(t=t<10?"0"+t:t)+":"+(i=i<10?"0"+i:i)+":00"},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.daterange").concat("#daterange-frame")),this.loadTemplate("frame-date-fixed",bizagi.getTemplate("bizagi.editor.component.editor.daterange").concat("#daterange-frame-date-fixed")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.daterange").concat("#daterange-frame-rule"))).done(function(){e.resolve()}),e.promise()},getMinRuleName:function(){var e=this.options.min;return e&&e.rule?e.type:"minrule"},getMaxRuleName:function(){var e=this.options.max;return e&&e.rule?e.type:"maxrule"},isRule90:function(e){return e.indexOf("90")>=0},"i.daterange-rule-external click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("daterange-min-value")?this.getMinRuleName():this.getMaxRuleName(),void 0!==this.options.value[i]&&null!==this.options.value[i]?this.publishRuleSubproperties(i,this.options.value[i].baref.ref):this.publishRuleSubproperties(i,"expression")},".daterange-date-container .daterange-image-rule-delete click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("daterange-min-value")?this.getMinRuleName():this.getMaxRuleName(),this.publishRuleSubproperties(i,void 0)},".daterange-date-container .daterange-image-fixed-delete click":function(e,t){var i,o=e.closest(".ui-control-input");i=o.hasClass("daterange-min-value")?"min":"max",$(".daterange-date-value",o).val(""),this.publishFixedSubproperties({type:i},void 0)},".biz-ico.daterange-image-rule-edit click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("daterange-min-value")?this.getMinRuleName():this.getMaxRuleName(),void 0!==this.options.value[i]&&null!==this.options.value[i]?this.publishRuleSubproperties(i,this.options.value[i].baref.ref):this.publishRuleSubproperties(i,"expression")},".biz-ico.daterange-image-fixed-edit click":function(e,t){var i=e.closest(".ui-control-input");$(".daterange-date-value",i).focus()},".biz-complex-btn.daterange-button-value click":function(e,t){var i=e.closest(".ui-control-input");$(".daterange-date-value",i).focus()},".daterange-rule-value .daterange-button-value click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("daterange-min-value")?this.getMinRuleName():this.getMaxRuleName(),void 0!==this.options.value[i]&&null!==this.options.value[i]?this.publishRuleSubproperties(i,this.options.value[i].baref.ref):this.publishRuleSubproperties(i,"expression")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.numberrange",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i;t.caption=t.caption||bizagi.localization.getResource("formmodeler-component-editor-numberrange-caption"),this.data=t,this.container=e,this.setEditorParameters(t),t.value=t.value||{},(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),this.inputValue=t.value,this.mapSubproperties=this.generateMapSubProperties(t),this.renderMinValue(i),this.renderMaxValue(i)},setEditorParameters:function(e){this.allowdecimals=e["editor-parameters"].allowdecimals.value,this.isOffline=e["editor-parameters"].isOffline||!1},renderMinValue:function(e){var t,i,o=this;for(var r in o.data.min={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-numberrange-min-caption"),style:"min-value"},o.mapSubproperties)if(-1!==o.mapSubproperties[r].name.indexOf("min")&&o.mapSubproperties[r].value){t=o.mapSubproperties[r].value,i="number"===o.mapSubproperties[r]["bas-type"]?"min":o.mapSubproperties[r].name.split(".")[1],$.extend(o.data.min,{value:t,type:i});break}null===o.data.min.value&&$.extend(o.data.min,{value:null,type:"min"}),o.data.min.style="numberrange-min-value",o.renderTypeEditor(e,o.data.min)},renderMaxValue:function(e){var t,i,o=this;for(var r in o.data.max={value:null,caption:bizagi.localization.getResource("formmodeler-component-editor-numberrange-max-caption"),style:"max-value"},o.mapSubproperties)if(-1!==o.mapSubproperties[r].name.indexOf("max")&&o.mapSubproperties[r].value){t=o.mapSubproperties[r].value,i="number"===o.mapSubproperties[r]["bas-type"]?"max":o.mapSubproperties[r].name.split(".")[1],$.extend(o.data.max,{value:t,type:i});break}null===o.data.max.value&&$.extend(o.data.max,{value:null,type:"max"}),o.data.max.style="numberrange-max-value",o.renderTypeEditor(e,o.data.max)},generateMapSubProperties:function(e){for(var t,i=e.subproperties,o={},r=0;r<i.length;r++)o[t=i[r].property.name]=i[r].property,o[t].value&&("number"===o[t]["bas-type"]?o[t].value||(o[t].value=null):o[t].value.baref.ref||(o[t].value=null));return o},renderTypeEditor:function(e,t){var i,o,r,n=this;switch(i=t.type,r=t.value,$.extend(t,{isOffline:n.isOffline}),i){case"max":case"min":var a=n.allowdecimals?" numberrange-show-time":" numberrange-not-show-time",s=t.style.concat(a),l=r||n.data.value[i];$.extend(t,{style:s,fixedvalue:l}),o=n.renderDefaultNumber(e,t),$(".numberrange-"+i+"-value .numberrange-number-value",o).bind("blur",function(){var e=$(this),o=e.val();t.value=n.mapSubproperties["numberrange."+i].value=o,n.validateAndPublish(t,e)}),$(".numberrange-"+i+"-value .numberrange-number-value",o).bind("keyup",function(e){if(13==e.keyCode){var o=$(this),r=o.val();t.value=n.mapSubproperties["numberrange."+i].value=r,n.validateAndPublish(t,o)}});break;case"maxrule":case"maxrule90":case"minrule":case"minrule90":$.extend(t,{allowdecimals:n.allowdecimals}),t.rule=r||n.data.value[i].rule,n.renderDefaultRule(e,t)}},redrawRenderEditor:function(e,t,i){for(var o=this.data.subproperties,r=0;r<o.length;r++)if(o[r].property.name===t){o[r].property.value=i,this.options.value[t.split(".")[1]]=i;break}this.renderEditor(e,this.data)},renderDefaultNumber:function(e,t){var i;return(i=$.tmpl(this.getTemplate("frame-number-fixed"),t)).appendTo(e),i},renderDefaultRule:function(e,t){var i;return void 0!==t.value.displayName&&""!=t.value.displayName?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-numberrange-rule")}),(i=$.tmpl(this.getTemplate("frame-rule"),t)).appendTo(e),i},retrieveExculsiveSubProperty:function(e){var t=null;switch(e){case"maxrule":t="max";break;case"minrule":t="min";break;case"min":t="minrule";break;case"max":t="maxrule"}return t},publishFixedSubproperties:function(e,t){var i,o,r;o="numberrange."+e.type,r=this.retrieveOldValue(e.type),this.data.value?this.data.value[o]||(this.data.value[o]={}):this.data.value={},this.data.value[o]=t,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:r,newValue:void 0===t?void 0:t,data:void 0===t?void 0:t,type:o,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i)},publishRuleSubproperties:function(e,t){var i,o,r,n=this;o="numberrange."+e;var a=n.isRule90(e)?"rule90":"rule";if(r=n.retrieveOldValue(e),n.data.value?n.data.value[o]||(n.data.value[o]={}):n.data.value={},n.data.value[o].rule={baref:{ref:t}},void 0===t)i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:r,newValue:t,data:t,type:o,id:n.element.closest(".bizagi_editor_component_properties").data("id")};else{var s={};s[a]=n.data.value[o].rule,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:r,data:s,type:o,id:this.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting",editor:"rule"}}n.controller.publish("propertyEditorChanged",i),n.removeFixedExclusiveProperty(e),void 0===t&&(n.element.empty(),n.redrawRenderEditor(n.container,o,t))},removeFixedExclusiveProperty:function(e){var t;t=this.retrieveExculsiveSubProperty(e),this.publishFixedSubproperties({type:t},void 0)},removeRuleExclusiveProperty:function(e){var t;t=this.retrieveExculsiveSubProperty(e),this.publishRuleSubproperties(t,void 0)},retrieveOldValue:function(e){var t="";return this.data.value[e]?""!=this.data.value[e]?t=this.data.value[e]:this.data.value[e].rule?"expression"!=this.data.value[e].rule.baref.ref&&(t={rule:this.data.value[e].rule}):t="":t="",t},retrieveHumanTime:function(e){var t=e.getHours(),i=e.getMinutes();return(t=t<10?"0"+t:t)+":"+(i=i<10?"0"+i:i)+":00"},isValidRange:function(e,t){var i=!1,o=this.mapSubproperties["numberrange.max"].value?this.mapSubproperties["numberrange.max"].value:null,r=this.mapSubproperties["numberrange.min"].value?this.mapSubproperties["numberrange.min"].value:null;if("min"==t)if(null===o||""===o)i=!0;else if(""===e)r=null,i=!0;else if(this.allowdecimals)(parseFloat(e)<=o||""===o)&&(i=!0);else{var n=o;""===n||void 0===n?i=!0:parseInt(e)<=parseInt(n)&&(i=!0)}else if(null===r||""===r)i=!0;else if(""===e)o=null,i=!0;else if(this.allowdecimals)(parseFloat(e)>=r||""===r)&&(i=!0);else{var a=r;""===a||void 0===a?i=!0:parseInt(e)>=parseInt(a)&&(i=!0)}return!1===i&&(this.error=bizagi.localization.getResource("formmodeler-component-editor-numberrange-error-range")),i},validateAndPublish:function(e,t){var i,o=e.value,r=e.type;!0===this.allowdecimals?(i=/(^$)|(^-?(0|[1-9][0-9]*)(\.[0-9]+)?$)/,this.error=bizagi.localization.getResource("formmodeler-component-editor-numberrange-error-number")):(i=/(^$)|(^-?(0|[1-9][0-9]*)$)/,this.error=bizagi.localization.getResource("formmodeler-component-editor-numberrange-error-int")),i.test(o)&&this.isValidRange(o,r)?(this.hideError(t),this.publishFixedSubproperties(e,e.value)):(this.showError(t,this.error),t.select())},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.numberrange").concat("#numberrange-frame")),this.loadTemplate("frame-number-fixed",bizagi.getTemplate("bizagi.editor.component.editor.numberrange").concat("#numberrange-frame-number-fixed")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.numberrange").concat("#numberrange-frame-rule"))).done(function(){e.resolve()}),e.promise()},getMinRuleName:function(){var e=this.options.min;return e&&e.rule?e.type:"minrule"},getMaxRuleName:function(){var e=this.options.max;return e&&e.rule?e.type:"maxrule"},isRule90:function(e){return e.indexOf("90")>=0},"i.numberrange-rule-external click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("numberrange-min-value")?this.getMinRuleName():this.getMaxRuleName(),void 0!==this.options.value[i]&&null!==this.options.value[i]?this.publishRuleSubproperties(i,this.options.value[i].baref.ref):this.publishRuleSubproperties(i,"expression")},".numberrange-number-container .numberrange-image-rule-delete click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("numberrange-min-value")?this.getMinRuleName():this.getMaxRuleName(),this.publishRuleSubproperties(i,void 0)},".numberrange-number-container .numberrange-image-fixed-delete click":function(e,t){var i,o=e.closest(".ui-control-input");i=o.hasClass("numberrange-min-value")?"min":"max",$(".numberrange-number-value",o).val(""),this.publishFixedSubproperties({type:i},void 0)},".biz-ico.numberrange-image-rule-edit click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("numberrange-min-value")?this.getMinRuleName():this.getMaxRuleName(),void 0!==this.options.value[i]&&null!==this.options.value[i]?this.publishRuleSubproperties(i,this.options.value[i].baref.ref):this.publishRuleSubproperties(i,"expression")},".biz-ico.numberrange-image-fixed-edit click":function(e,t){var i=e.closest(".ui-control-input");$(".numberrange-number-value",i).focus()},".numberrange-rule-value .numberrange-button-value click":function(e,t){var i;i=e.closest(".ui-control-input").hasClass("numberrange-min-value")?this.getMinRuleName():this.getMaxRuleName(),void 0!==this.options.value[i]&&null!==this.options.value[i]?this.publishRuleSubproperties(i,this.options.value[i].baref.ref):this.publishRuleSubproperties(i,"expression")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.dateformat",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n,a,s,l,d,c,u=this;u.showTime=t["editor-parameters"].showtime.value,s=!0===t["editor-parameters"].showtime.value?"dateformat-show-time":"dateformat-not-show-time",l=u.retrieveValues(t.value),$.extend(t,l,{showTime:s}),(i=$.tmpl(u.getTemplate("frame"),t)).appendTo(e),c=$("label",i),u.addRequired(c),u.data=t,u.inputValue=t.value,u.inline=!0,u.elPopUpContent=o=$.tmpl(u.getTemplate("modal-content"),t),u.elPopUpActions=r=$.tmpl(u.getTemplate("modal-actions-editor"),{}),t.initValueDateFormat=t.initValueShortDate=!1,l.valueDate===bizagi.localization.getResource("formmodeler-component-editor-dateformat-default-format")&&(t.initValueDateFormat=!0),$(".dateformat-options-default-format-false",o).hide(),$(".dateformat-options-short-date-false",o).hide(),u.showTime?($(".dateformat-format .dateformat-modal-item",o).removeClass("dateformat-col1").addClass("dateformat-col2"),$(".dateformat-modal-time-format",o).parent().show()):($(".dateformat-format .dateformat-modal-item",o).removeClass("dateformat-col2").addClass("dateformat-col1"),$(".dateformat-modal-time-format",o).parent().hide()),u.createEditorDataSources(t),d=u.isShortDate(t),u.createEditorUIControls(t,o),u.showTime?u.populate(u.showTime,{dateFormatSelected:l.valueDate,timeFormatSelected:l.valueTime}):u.populate(u.showTime,{dateFormatSelected:t.value}),u.showTime?$(".dateformat-modal-time",u.elPopUpContent).show():$(".dateformat-modal-time",u.elPopUpContent).hide(),n=$(".biz-action-btn",r).eq(0),a=$(".biz-action-btn",r).eq(1),n.click(function(e){u.responseOkButton.apply(u,[n,e])}),a.click(function(e){u.responseCancelButton.apply(u,[a,e])}),u.dialogReference=u.createDialog(u.elPopUpContent,u.elPopUpActions),d&&$(".dateformat-options-short-date-false",u.dialogReference).show()},isShortDate:function(e){var t={value:!1,index:0},i=e.uiSelect.shortDateSeparator.uiValues,o=e.value;if(o)for(var r=0;r<i.length;r++){if(-1!=o.indexOf(i[r].value)){t={value:!0,index:r};break}}return $.extend(e,{shortDate:t}),t.value},createEditorUIControls:function(e,t){var i=this;i.shortDateComboBox=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor.dateformat-short-date",t),uiInitValue:e.uiSelect.shortDateSeparator.uiValues[e.shortDate.index].value,uiValues:e.uiSelect.shortDateSeparator.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseShortDateComboChange(e,t)}}),i.dateFormatComboBox=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor.date-format",t),uiInitValue:e.value,uiValues:e.uiSelect.normalDateFormat.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseDateFormatComboChange(e,t)}}),i.timeFormatComboBox=new i.uiControls.comboBox({uiEditor:i,uiContainer:$(".ui-control-editor.time-format",t),uiValues:e.uiSelect.timesDateFormat.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseTimeFormatComboChange(e,t)}}),i.mySwitchDefaultFormat=new i.uiControls.booleanSwitch({uiEditor:i,uiInitValue:e.initValueDateFormat,uiContainer:$(".dateformat-modal-default-format",t),uiValues:e.dateFormatUIValues.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseChangeDefaultFormat(e,t,i)}}),i.mySwitchShortDate=new i.uiControls.booleanSwitch({uiEditor:i,uiInitValue:e.shortDate.value,uiContainer:$(".dateformat-modal-short-date",t),uiValues:e.shortDateUIValues.uiValues,uiInline:i.inline,onChange:function(e,t){i.responseChangeShortDate(e,t,i)}})},createEditorDataSources:function(e){return $.extend(e,{uiSelect:{shortDateSeparator:{uiValues:[{label:"/",value:"/",icon:"separator"},{label:".",value:".",icon:"separator"},{label:"-",value:"-",icon:"separator"}]},shortDateFormat:{uiValues:[{label:"M*d*yyyy",value:"m*d*yy",icon:"date"},{label:"M*d*yy",value:"m*d*y",icon:"date"},{label:"MM*dd*yy",value:"mm*dd*y",icon:"date"},{label:"MM*dd*yyyy",value:"mm*dd*yy",icon:"date"},{label:"yy*MM*dd",value:"y*mm*dd",icon:"date"},{label:"yyyy*MM*dd",value:"yy*mm*dd",icon:"date"},{label:"dd*MM*yyyy",value:"dd*mm*yy",icon:"date"},{label:"dd*MMM*yy",value:"dd*M*y",icon:"date"},{label:"dd*MM*yy",value:"dd*mm*y",icon:"date"}]},normalDateFormat:{uiValues:[{label:"dddd, MMMM dd, yyyy",value:"DD, MM dd, yy",icon:"date"},{label:"MMMM dd, yyyy",value:"MM dd, yy",icon:"date"},{label:"dddd, dd MMMM, yyyy",value:"DD, dd MM, yy",icon:"date"},{label:"dd MMMM, yyyy",value:"dd MM, yy",icon:"date"}]},timesDateFormat:{uiValues:[{label:"hh:mm:ss tt",value:{format:"hh:mm:ss tt",ampm:!0},icon:"hour"},{label:"h:mm:ss tt",value:{format:"h:mm:ss tt",ampm:!0},icon:"hour"},{label:"H:mm:ss",value:{format:"H:mm:ss",ampm:!1},icon:"hour"},{label:"HH:mm:ss",value:{format:"HH:mm:ss",ampm:!1},icon:"hour"}]}}}),$.extend(e,{dateFormatUIValues:{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-true"),value:"true"},{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-false"),value:"false"}]},shortDateUIValues:{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-true"),value:"true"},{label:bizagi.localization.getResource("formmodeler-component-editor-dateformat-false"),value:"false"}]}}),e},responseShortDateComboChange:function(e){var t,i;i=this.dateFormatComboBox.label,e&&(i=i.replace(/[/.-]/g,e)),this.showTime?(t=this.timeFormatComboBox.value.format,this.populate(this.showTime,{dateFormatSelected:i,timeFormatSelected:t})):this.populate(this.showTime,{dateFormatSelected:i})},responseDateFormatComboChange:function(){var e,t;e=this.dateFormatComboBox.label,this.showTime?(t=this.timeFormatComboBox.value.format,this.populate(this.showTime,{dateFormatSelected:e,timeFormatSelected:t})):this.populate(this.showTime,{dateFormatSelected:e})},responseTimeFormatComboChange:function(){var e,t;t=this.timeFormatComboBox.value.format,e=this.dateFormatComboBox.label,this.populate(this.showTime,{dateFormatSelected:e,timeFormatSelected:t})},changeItems:function(e,t,i,o){var r,n,a,s,l=this;for((s=$('[class*="ui-modal-arrow"]',l.element).position())&&$('[class*="ui-modal-arrow"]',l.element).css("top",s.top),"disabled"==e?(n="dateformat-enabled",a="dateformat-disabled"):(n="dateformat-disabled",a="dateformat-enabled"),o=o||".empty","disabled"==e&&$(o).slideUp({step:function(){l.updateDialogPosition(!1)}}),r=0;r<t.length;r++)(i||"dateformat-modal-short-date-separator"!==t[r])&&$(".dateformat-modal ."+t[r]).parent().removeClass(n).addClass(a);"enabled"===e&&$(o).slideDown({step:function(){l.updateDialogPosition(!1)},complete:function(){$(this).css("overflow","visible")}}),l.createSampleInputText()},populate:function(e,t){var i,o,r,n,a,s,l,d,c=this;if(r=c.mySwitchShortDate.getValue(),s=t.hasOwnProperty("dateFormatSelected"),l=[],r){for(i=c.shortDateComboBox.getValue(),o=0;o<c.data.uiSelect.shortDateFormat.uiValues.length;o++)s&(n={label:c.data.uiSelect.shortDateFormat.uiValues[o].label.replace(/\*/g,i),value:c.data.uiSelect.shortDateFormat.uiValues[o].value.replace(/\*/g,i),icon:"date"}).label===t.dateFormatSelected&&(n.selected="selected"),l.push(n);c.dateFormatComboBox.update(l)}else{for(o=0;o<c.data.uiSelect.normalDateFormat.uiValues.length;o++)s&(n={label:c.data.uiSelect.normalDateFormat.uiValues[o].label,value:c.data.uiSelect.normalDateFormat.uiValues[o].value,icon:"date"}).label===t.dateFormatSelected&&(n.selected="selected"),l.push(n);c.dateFormatComboBox.update(l)}if(c.showTime){for(d=[],o=0;o<c.data.uiSelect.timesDateFormat.uiValues.length;o++)(a={label:c.data.uiSelect.timesDateFormat.uiValues[o].label,value:c.data.uiSelect.timesDateFormat.uiValues[o].value,icon:"date"}).value.format===t.timeFormatSelected&&(a.selected="selected"),d.push(a);c.timeFormatComboBox.update(d)}c.createSampleInputText()},createSampleInputText:function(){var e,t,i,o;o=$(".dateformat-modal-date-sample",this.dialogReference),this.showTime?(t={hour:(e=new Date).getHours(),minute:e.getMinutes(),second:e.getSeconds()},i=this.timeFormatComboBox.getValue(),o.text($.datepicker.formatDate(this.dateFormatComboBox.getValue(),e)+" "+$.datepicker.formatTime(i.format,t,{ampm:i.ampm}))):(e=new Date,o.text($.datepicker.formatDate(this.dateFormatComboBox.getValue(),e)))},retrieveValues:function(e){var t,i,o;return null==e||""===e?(t=bizagi.localization.getResource("formmodeler-component-editor-dateformat-default-format"),i=""):-1==(o=e.search(/h|H/))?(t=bizagi.util.trim(e.slice(0)),i=""):(t=bizagi.util.trim(e.slice(0,o)),i=e.slice(o)),{valueDate:t,valueTime:i}},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-frame")),this.loadTemplate("frame-options",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-frame-options")),this.loadTemplate("modal-content",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-modal")),this.loadTemplate("modal-actions-editor",bizagi.getTemplate("bizagi.editor.component.editor.dateformat").concat("#dateformat-modal-actions"))).done(function(){e.resolve()}),e.promise()},responseChangeDefaultFormat:function(e,t,i){var o,r,n;r=e,n=!!e,o=i.showTime?["dateformat-modal-short-date","dateformat-modal-date-format","dateformat-modal-time-format","dateformat-modal-date-sample"]:["dateformat-modal-short-date","dateformat-modal-date-format","dateformat-modal-date-sample"],r&&o.push("dateformat-modal-short-date-separator"),n?i.changeItems("disabled",o,i.showTime,".dateformat-options-default-format-false"):i.changeItems("enabled",o,i.showTime,".dateformat-options-default-format-false")},responseChangeShortDate:function(e,t,i){if(e?i.changeItems("enabled",["dateformat-modal-short-date-separator"],i.showTime,".dateformat-options-short-date-false"):i.changeItems("disabled",["dateformat-modal-short-date-separator"],i.showTime,".dateformat-options-short-date-false"),e){var o=i.dateFormatComboBox.getLabel();if(i.showTime){var r=i.timeFormatComboBox.value.format;i.populate(i.showTime,{dateFormatSelected:o,timeFormatSelected:r})}else i.populate(i.showTime,{dateFormatSelected:o})}else i.dateFormatComboBox.update(i.data.uiSelect.normalDateFormat.uiValues)},".dateformat-fields > input click":function(e,t){this.openDialog(e,t)},".dateformat-fields > i:eq(1) click":function(e,t){this.openDialog(e,t)},openDialog:function(e,t){var i;this.showDialog(e,t),i=this.retrieveValues(this.options.value).valueDate===bizagi.localization.getResource("formmodeler-component-editor-dateformat-default-format"),this.mySwitchDefaultFormat.update(i),this.responseChangeDefaultFormat(i,null,this)},responseOkButton:function(e,t){var i,o,r,n,a,s=this;i=$(".dateformat-fields .dateformat-field-date",s.element),o=$(".dateformat-fields .dateformat-field-time",s.element),i.val(""),o.val(""),a=s.mySwitchDefaultFormat.getValue(),this.hideDialog(function(){var e;a?(i.val("Default Format"),s.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:s.inputValue,newValue:"",data:"",type:s.options.name,id:s.element.closest(".bizagi_editor_component_properties").data("id")}),s.inputValue=""):(r=s.dateFormatComboBox.getLabel(),s.showTime?(n=s.timeFormatComboBox.getValue(),i.val(r),o.val(n.format),s.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:s.inputValue,newValue:r+" "+n.format,data:r+" "+n.format,type:s.options.name,id:s.element.closest(".bizagi_editor_component_properties").data("id")}),s.inputValue=r+" "+n.format):(i.val(r),e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:s.inputValue,newValue:r,data:r,type:s.options.name,id:s.element.closest(".bizagi_editor_component_properties").data("id")},s.controller.publish("propertyEditorChanged",e),s.inputValue=r))})},responseCancelButton:function(e,t){this.hideDialog()},".editor-modal .header span:eq(0) click":function(e,t){this.hideDialog()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.gridvalidations",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o;(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),o=$("label",i),this.addRequired(o)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.gridvalidations").concat("#gridvalidations-frame"))).done(function(){e.resolve()}),e.promise()},".biz-action-validate click":function(e,t){t.stopPropagation(),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_GRID_VALIDATIONS,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.selectprocess",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i=this.getEditorParameters(t);t.showLabel="undefined"==i.showLabel||i.showLabel,t.disabled=t.allowClick||!1,$.tmpl(this.getTemplate("frame"),t).appendTo(e)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.selectprocess").concat("#selectprocess-frame"))).done(function(){e.resolve()}),e.promise()},getEditorParameters:function(e){return e["editor-parameters"]||{}},".biz-action-select-process click":function(e,t){t.stopPropagation(),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_PROCESS,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.retype",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;if(o.paramsRetype=t["editor-parameters"],o.paramsHide=o.paramsRetype&&t["editor-parameters"].hide?t["editor-parameters"].hide:void 0,o.inline=!1,o.inline&&o.element.addClass("retype-inline"),$.extend(t,{uiValues:[{value:"duplicate",style:"bz-studio bz-duplicate-retype_16x16_standard",label:bizagi.localization.getResource("formmodeler-component-editor-retype-duplicate")},{value:"double",style:"bz-studio bz-double-retype_16x16_standard",label:bizagi.localization.getResource("formmodeler-component-editor-retype-double")},{value:"none",style:"bz-studio bz-none-retype_16x16_standard",label:bizagi.localization.getResource("formmodeler-component-editor-retype-none")}]}),"duplicate"!=t.value&&"double"!=t.value&&"none"!=t.value&&(t.value="none"),null!=o.paramsHide)for(var r=0;r<o.paramsHide.length;r++)"duplicate"===o.paramsHide[r]&&(t.uiValues=t.uiValues.slice(1,3));for(r=0;r<t.uiValues.length;r++)t.value===t.uiValues[r].value&&(t.uiValues[r].selected=!0);(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),this.inputValue=t.value;new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.retype").concat("#retype-frame"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.component.editor("bizagi.editor.component.editor.datalist",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r=t.subproperties.length;for(i=$.tmpl(this.getTemplate("frame"),t),this.inputValues={},o=0;o<r;o++)this.inputValues[t.subproperties[o].property.name]=t.subproperties[o].property.value,"filter"==t.subproperties[o].property["bas-type"]||"xpath-from-entity"==t.subproperties[o].property["bas-type"]||"xpathfromentity"==t.subproperties[o].property["bas-type"]?this.renderExternal(i.find(".datalist-group"),t.subproperties[o].property):this.renderSubproperty(i.find(".datalist-group"),t.subproperties[o].property);i.appendTo(e),this.setAsCollapsible(i)},renderExternal:function(container,dataProperty){var elExternal,property;if("true"==dataProperty["user-editable"]){if(elExternal=$.tmpl(this.getTemplate("external"),{}),dataProperty["bas-type"]=this.machineName(dataProperty["bas-type"]),void 0===bizagi.editor.component.editor[dataProperty["bas-type"]])property=/^.*xpath.*$/gi.test(dataProperty["bas-type"])?new bizagi.editor.component.editor.xpath(elExternal,dataProperty,this.controller):new bizagi.editor.component.editor.lstring(elExternal,dataProperty,this.controller);else{var fn=eval("var bafn = function(elExternal, dataProperty, controller) {  return new bizagi.editor.component.editor."+dataProperty["bas-type"]+"(elExternal, dataProperty, controller);};bafn");property=fn(elExternal,dataProperty,this.controller)}elExternal.appendTo(container),property.render()}},machineName:function(e){return e.toLowerCase().replace(/-/g,"")},setAsCollapsible:function(e){var t=$(".ui-content",e);$("h3",e).bind("click",function(){t.slideToggle()})},renderSubproperty:function(e,t){var i,o;"true"==t["user-editable"]&&((i=$.tmpl(this.getTemplate("subproperty"),t)).appendTo(e),o=$("label",i),self.addRequired(o))},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.datalist").concat("#datalist-frame")),this.loadTemplate("subproperty",bizagi.getTemplate("bizagi.editor.component.editor.datalist").concat("#datalist-subproperty")),this.loadTemplate("external",bizagi.getTemplate("bizagi.editor.component.editor.datalist").concat("#datalist-frame-external"))).done(function(){e.resolve()}),e.promise()},".datalist-group .datalist-subproperty-value keydown":function(e,t){t.stopPropagation(),13==t.keyCode&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValues[e.data("name")],newValue:e.val(),data:e.val(),type:e.data("name"),id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputValues[e.data("name")]=e.val())},".datalist-group .datalist-subproperty-external click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EDITOR_DATALIST,oldValue:this.inputValues[e.parent().find(".datalist-subproperty-value").data("name")],type:e.parent().find(".datalist-subproperty-value").data("name"),id:this.element.closest(".bizagi_editor_component_properties").data("id")})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.multiple",{init:function(e,t,i,o){t=new bizagi.editor.component.editor.multiple.model(t),this._super(e,t,i),void 0!==o.refProperties&&(this.refProperties=o.refProperties)},renderEditor:function(e,t){var i=this;if(i.value=[],i.model.isExclusive()){var o=$.tmpl(i.getTemplate("frame-exclusive"),i.model.getModel());i.renderExclusiveSubproperties(o.find(".multiple-category-group"))}else o=$.tmpl(i.getTemplate("frame"),t),$.each(i.model.getProperties(),function(e,t){i.renderSubproperty(o.find(".multiple-category-group"),t)});o.appendTo(e),i.setAsCollapsible(o),i.hideSubproperties()},renderProperties:function(e,t){for(var i=this.model.getProperties(),o=0,r=i.length;o<r;o++)this.renderSubproperty(e,i[o],t)},renderExclusiveSubproperties:function(e){for(var t=this.model.getSelectedProperty(),i=0,o=t.length;i<o;i++)this.renderSubproperty(e,t[i],!0)},renderSubproperty:function(e,t,i){var o,r;if(void 0===t.notShow)if(o=$.tmpl(this.getTemplate("frame-property"),{}),t["bas-type"]=this.machineName(t["bas-type"]),/^.*xpath.*$/gi.test(t["bas-type"]))r=void 0===i?new bizagi.editor.component.editor.xpath(o,t,this.controller):new bizagi.editor.component.editor.xpath(o,$.extend({},t,{exclusive:!0}),this.controller),o.appendTo(e),r.render(),this.registerSubproperty(r);else{if(void 0===bizagi.editor.component.editor[t["bas-type"]])throw"Editor "+t["bas-type"]+" doesn't exists.";r=void 0===i?new bizagi.editor.component.editor[t["bas-type"]](o,t,this.controller):new bizagi.editor.component.editor[t["bas-type"]](o,$.extend({},t,{exclusive:!0}),this.controller),o.appendTo(e),r.render(),this.registerSubproperty(r)}},registerSubproperty:function(e){this.refProperties[e.options.name]=e},machineName:function(e){return e.toLowerCase().replace(/-/g,"")},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.multiple").concat("#multiple-frame")),this.loadTemplate("frame-property",bizagi.getTemplate("bizagi.editor.component.editor.multiple").concat("#multiple-frame-property")),this.loadTemplate("frame-exclusive",bizagi.getTemplate("bizagi.editor.component.editor.multiple").concat("#multiple-frame-exclusive"))).done(function(){e.resolve()}),e.promise()},setAsCollapsible:function(e){var t=$(".ui-content",e);$("h3",e).bind("click",function(){t.slideToggle(function(){$(this).css("overflow","visible")})})},hideSubproperties:function(){this.model.isExclusive()&&!this.model.hasValue()&&this.element.find(".multiple-category-group").empty()},updatePropertyToNone:function(){this.model.hasValue()&&this.controller.publish("propertyEditorChanged",{newValue:void 0,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".multiple-name click":function(e,t){var i,o;if(i=$(".multiple-name",this.element).index(e),!e.hasClass("selected")){e.hasClass("selected")?($(".multiple-name",this.element).removeClass("selected"),$(".biz-ico",this.element).addClass("multiple-ico-radio-uncheck").removeClass("multiple-ico-radio-check"),$(".biz-ico",e).addClass("multiple-ico-radio-check").removeClass("multiple-ico-radio-uncheck"),$(".biz-ico",this.element).addClass("bz-studio"),$(".biz-ico",this.element).addClass("bz-radio-unselected_16x16_standard").removeClass("bz-radio_16x16_standard"),$(".biz-ico",e).addClass("bz-radio_16x16_standard").removeClass("bz-radio-unselected_16x16_standard"),o=!1):($(".multiple-name",this.element).removeClass("selected"),$(".biz-ico",this.element).addClass("multiple-ico-radio-uncheck").removeClass("multiple-ico-radio-check"),$(".biz-ico",this.element).addClass("bz-studio"),$(".biz-ico",this.element).addClass("bz-radio-unselected_16x16_standard").removeClass("bz-radio_16x16_standard"),e.addClass("selected"),$(".biz-ico",e).addClass("multiple-ico-radio-check").removeClass("multiple-ico-radio-uncheck"),$(".biz-ico",e).addClass("bz-radio_16x16_standard").removeClass("bz-radio-unselected_16x16_standard"),o=!0),this.element.find(".multiple-category-group").empty();var r=this.model.isExclusive(),n=this.element.find(".multiple-category-group");if(o){var a=this.model.getPropertyByIndex(i);a&&this.renderSubproperty(n,a,r)}else this.renderProperties(n,r);e.hasClass("multiple-none-option")&&this.updatePropertyToNone()}}}),$.Class.extend("bizagi.editor.component.editor.multiple.model",{subpropertyRegex:/[^.]*$/},{init:function(e){this.data=e,this.properties={},this.parameters=e&&e["editor-parameters"],this.processData(e)},processData:function(e){if(e.subproperties)for(var t=0,i=e.subproperties.length;t<i;t++){var o=e.subproperties[t];(o=o.property).propertyName=this.Class.subpropertyRegex.exec(o.name)[0],o.selected=this.isMatchValue(o.propertyName),o.selectedcss=o.selected?" selected":"",this.properties[o.name]=o}},getModel:function(){return{caption:this.getCaption(),properties:this.getProperties(),isExclusive:this.isExclusive(),isEmpty:!this.hasValue(),noneCaption:this.getNodeCaption()}},getValue:function(){return this.data.value},isExclusive:function(){return!!this.parameters&&!!bizagi.util.parseBoolean(this.parameters.exclusive)},isOnlyForUpdate:function(e){var t=e["editor-parameters"];return!!t&&!!bizagi.util.parseBoolean(t.onlyforupdate)},isMatchValue:function(e){var t=this.data.value;return!!t&&!!t[e]},hasValue:function(){return!bizagi.util.isEmpty(this.data.value)},getProperties:function(){var e=[];for(var t in this.properties)if(this.properties.hasOwnProperty(t)){var i=this.properties[t];this.isOnlyForUpdate(i)?i.selected&&e.push(i):e.push(i)}return e},getSelectedProperty:function(){var e=this.getProperties();return this.getValue()?$.grep(e,function(e,t){return e.selected}):e},getPropertyByIndex:function(e){return this.getProperties()[e]},getCaption:function(){return this.data.caption||"Multiple"},getNodeCaption:function(){var e=this.data["editor-parameters"]||{};return e.noneCaption?bizagi.editor.utilities.resolveInternalResource(e.noneCaption):bizagi.localization.getResource("formmodeler-component-editor-multiple-none")}}),bizagi.editor.component.editor("bizagi.editor.component.editor.defaultvalue",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i=this;i.Error="",i.setEditorParameters(t),t.value||(t.value=i.getIntialValue()),void 0!==t.value.fixedvalue&&""!==t.value.fixedvalue?i.state=!0:i.isEmptyRule(t.value)?(t.value=i.getIntialValue(),i.state=!0):i.state=!1,i.state=i.state||i.isOffline;var o=$.tmpl(i.getTemplate("frame"),t);o.appendTo(e),i.inputValue=t.value,i.type&&i.renderTypeEditor(o,t)},setEditorParameters:function(e){this.exclusive=void 0!==e["editor-parameters"].exclusive,this.isOffline=e["editor-parameters"].isOffline||!1,this.type=e["editor-parameters"].type,e.isOffline=this.isOffline},getIntialValue:function(){var e={fixedvalue:"",rule:{baref:{ref:"expression"}}};return e},retrieveHumanTime:function(e){var t=e.getHours(),i=e.getMinutes();return(t=t<10?"0"+t:t)+":"+(i=i<10?"0"+i:i)+":00"},renderTypeEditor:function(e,t){var i,o=this;switch(o.type){case"date":var r=!0===t["editor-parameters"].showtime.value?"defaultvalue-show-time":"defaultvalue-not-show-time";$.extend(t,{showTime:r}),o.renderDefaultDate(e,t),!0===t["editor-parameters"].showtime.value?$(".defaultvalue-date-container .defaultvalue-date-value",o.element).will_pickdate({timePicker:!0,allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y H:i:s",format:"m/d/Y H:i",onSelect:function(e){e=$.datepicker.formatDate("mm/dd/yy",e)+" "+o.retrieveHumanTime(e),i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:{fixedvalue:e},data:{fixedvalue:e},type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.inputValue={fixedvalue:e}}}):$(".defaultvalue-date-container .defaultvalue-date-value",o.element).will_pickdate({allowEmpty:!0,militaryTime:!0,inputOutputFormat:"m/d/Y",format:"m/d/Y",onSelect:function(e){e=$.datepicker.formatDate("mm/dd/yy",e),i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:{fixedvalue:e},data:{fixedvalue:e},type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.inputValue={fixedvalue:e}}});break;case"number":var n,a=!0===t["editor-parameters"].allowdecimals.value?"defaultvalue-allowdecimals":"defaultvalue-not-allowdecimals";$.extend(t,{allowDecimals:a}),this.renderDefaultNumber(e,t),!0===t["editor-parameters"].allowdecimals.value?(n=/(^$)|(^-?(0|[1-9][0-9]*)\.[0-9]+$)/,o.Error+=bizagi.localization.getResource("formmodeler-component-editor-int-error-decimal")):(n=/(^$)|(^-?(0|[1-9][0-9]*)$)/,o.Error+=bizagi.localization.getResource("formmodeler-component-editor-int-error-integer")),$(".defaultvalue-number-container .defaultvalue-number-value",o.element).keydown(function(e){13==e.keyCode&&(n.test($(this).val())?(o.hideError($(this)),i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.inputValue={fixedvalue:$(this).val()}):(o.showError($(this),o.Error),$(this).select()))}),$(".defaultvalue-number-container .defaultvalue-number-value",o.element).blur(function(e){n.test($(this).val())?(o.hideError($(this)),i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.inputValue={fixedvalue:$(this).val()}):(o.showError($(this),o.Error),$(this).select())});break;case"string":this.renderDefaultString(e,t),$(".defaultvalue-string-value",o.element).keydown(function(e){13==e.keyCode&&(i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.inputValue={fixedvalue:$(this).val()})}),$(".defaultvalue-string-value",o.element).blur(function(e){i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:{fixedvalue:$(this).val()},data:{fixedvalue:$(this).val()},type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.inputValue={fixedvalue:$(this).val()}});break;case"boolean":void 0!==t.value.fixedvalue&&null!==t.value.fixedvalue||(t.value.fixedvalue="");var s,l="",d="";""===t.value.fixedvalue?s="none":(s=t.value,!0===t.value.fixedvalue||"true"==t.value.fixedvalue?l=" selected":d=" selected"),this.renderDefaultBoolean(e,$.extend(t,{booleanState:s.fixedvalue,selectedYes:l,selectedNo:d})),""!==t.value.fixedvalue&&e.find(".defaultvalue-boolean-value").addClass("active"),$(".defaultvalue-boolean-value > .defaultvalue-boolean-button",o.element).click(function(){i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,type:t.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},$(".defaultvalue-boolean-value > .defaultvalue-boolean-button",o.element).removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("defaultvalue-boolean-button-yes")?($.extend(i,{newValue:{fixedvalue:!0},data:{fixedvalue:!0}}),o.inputValue={fixedvalue:!0}):($.extend(i,{newValue:{fixedvalue:!1},data:{fixedvalue:!1}}),o.inputValue={fixedvalue:!1}),o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i)});break;case"rule":this.renderDefaultRule(e,t)}},renderDefaultDate:function(e,t){(this.state?$.tmpl(this.getTemplate("frame-date-fixed"),t):this.renderRule(t)).appendTo(e)},renderDefaultNumber:function(e,t){(this.state?$.tmpl(this.getTemplate("frame-number-fixed"),t):this.renderRule(t)).appendTo(e)},renderDefaultString:function(e,t){(this.state?$.tmpl(this.getTemplate("frame-string-fixed"),t):this.renderRule(t)).appendTo(e)},renderDefaultBoolean:function(e,t){(this.state?$.tmpl(this.getTemplate("frame-boolean-fixed"),t):this.renderRule(t)).appendTo(e)},renderDefaultRule:function(e,t){(this.state?$.tmpl(this.getTemplate("frame-onlyrule"),t):this.renderRule(t)).appendTo(e)},renderRule:function(e){var t=this.getRuleValue(e.value);return void 0!==t.displayName&&""!=t.displayName?$.extend(e,{nameRule:t.displayName}):$.extend(e,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-defaultvalue-rule")}),$.tmpl(this.getTemplate("frame-rule"),e)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame")),this.loadTemplate("frame-date-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-date-fixed")),this.loadTemplate("frame-number-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-number-fixed")),this.loadTemplate("frame-string-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-string-fixed")),this.loadTemplate("frame-boolean-fixed",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-boolean-fixed")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-rule")),this.loadTemplate("frame-onlyrule",bizagi.getTemplate("bizagi.editor.component.editor.defaultvalue").concat("#defaultvalue-frame-onlyrule"))).done(function(){e.resolve()}),e.promise()},editCreateRule:function(e,t){var i,o,r=this;i=""!=r.options.value.fixedvalue?{fixedvalue:r.options.value.fixedvalue}:r.isEmptyRule(r.options.value)?{fixedvalue:""}:r.options.value,(void 0===r.options.value||null===r.options.value||r.options.value.fixedvalue)&&(r.options.value={rule:{baref:{ref:"expression"}}}),o={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:i,type:r.options.name,data:r.options.value,id:r.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting"},r.exclusive&&$.extend(o,{exclusive:!0}),r.controller.publish("propertyEditorChanged",o),r.inputValue=r.options.value},isEmptyRule:function(e){var t=this.getRuleValue(e);return!t||"expression"===t.baref.ref},getRuleValue:function(e){return e.rule||e.rule90},"i.defaultvalue-rule-external click":function(e,t){this.editCreateRule(e,t)},".defaultvalue-rule-value .defaultvalue-image-rule-delete click":function(e,t){var i,o=this;i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:void 0,data:void 0,type:o.options.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.exclusive&&$.extend(i,{exclusive:!0}),o.controller.publish("propertyEditorChanged",i),o.element.find(".defaultvalue-container div").empty(),o.options.value={fixedvalue:"",rule:{baref:{ref:"expression"}}},o.state=!0,o.renderTypeEditor(o.element.find(".defaultvalue-container"),o.options)},".defaultvalue-image-fixed-delete click":function(e,t){var i;this.element.find("input").length>0?this.element.find("input").val(""):this.element.find(".defaultvalue-boolean-value").removeClass("active"),i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:void 0,data:void 0,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.exclusive&&$.extend(i,{exclusive:!0}),this.controller.publish("propertyEditorChanged",i)},".biz-complex-btn.defaultvalue-button-value click":function(e,t){var i=$(".defaultvalue-"+this.type+"-value",this.element);i.length>0?(i.addClass("active"),i.focus()):this.editCreateRule(e,t)},".biz-ico.defaultvalue-image-edit click":function(e,t){var i;(i="rule"===this.type?[]:$(".defaultvalue-"+this.type+"-value",this.element)).length>0?(i.addClass("active"),i.focus()):this.editCreateRule(e,t)},".defaultvalue-rule-value .defaultvalue-button-value click":function(e,t){"rule"===this.type&&this.editCreateRule(e,t)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.filterexpression",{defaultRule:{rule:{baref:{ref:"expression"}}},defaultFilter:{bafilter:{filter:"filter"}}},{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){this.properties={},this.findSubproperties(t),this.inputValue=t.value;var i=this.getCurrentType(t.value),o={caption:t.caption,currentType:i.replace(/\ /g,"&nbsp;")};$.extend(o,this.properties),$.tmpl(this.getTemplate("frame"),o).appendTo(e)},isRule:function(){return!!this.inputValue&&!!this.inputValue.rule},isFilter:function(){return!!this.inputValue&&!!this.inputValue.bafilter},getCurrentType:function(e){var t=bizagi.localization.getResource("formmodeler-component-filterexpression-empty");return this.isRule()?t=null!=e.rule&&e.rule.displayName?e.rule.displayName:bizagi.localization.getResource("formmodeler-component-filterexpression-rule"):this.isFilter()&&(t=bizagi.localization.getResource("formmodeler-component-filterexpression-filter")),t},findSubproperties:function(e){if(e.subproperties&&$.isArray(e.subproperties))for(var t=0,i=e.subproperties.length;t<i;t++){var o=e.subproperties[t].property;this.properties[o["bas-type"]]=!0}},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.filterexpression").concat("#filterexpression-frame"))).done(function(){e.resolve()}),e.promise()},editCreateRule:function(){var e=this.Class.defaultRule;this.isRule()&&(e=this.inputValue);var t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,type:this.options.name,data:e,id:this.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:"Scripting"};this.controller.publish("propertyEditorChanged",t)},editCreateFilter:function(){var e=this.Class.defaultFilter;this.isFilter()&&(e=this.inputValue);var t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EDITOR_DATALIST,data:e,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",t)},deleteValue:function(){if(this.inputValue){var e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:void 0,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",e)}},"i.filterexpression-rule-external click":function(){this.editCreateRule()},"i.filterexpression-filter-external click":function(){this.editCreateFilter()},"i.filterexpression-delete-filter click":function(){this.deleteValue()},"input.filterexpression-string-value click":function(){this.inputValue&&(this.isRule()?this.editCreateRule():this.isFilter()&&this.editCreateFilter())}}),bizagi.editor.component.editor("bizagi.editor.component.editor.textformat",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n=this,a=t.subproperties.length;for(n.values={},n.palette=[["transparent"],["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7f","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"],["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"]],i=$.tmpl(n.getTemplate("frame"),t),o=0;o<a;o++)n.values[t.subproperties[o].property.name]=t.subproperties[o].property.value,n.renderSubproperty(i,t.subproperties[o].property);if(n.initialValues=bizagi.clone(n.values),i.appendTo(e),n.setFontSize(t.subproperties),r=n.retrieveValueFontSize(t.subproperties),bizagi.util.isEmpty(r))n.refFontSize=parseInt($(".textformat-preview",this.element).css("font-size"));else{if(!/^(\+[1-9][0-9]*|0|-[1-9][0-9]*)$/.test(r))throw"FontSize value error.";n.refFontSize=n.calculateFontSize(r)}},closeSp:function(e,t){var i=$(t.target),o=$(".sp-container",$("body"));0===i.closest(o).length&&(e.spectrum("hide"),$(document).unbind("mousedown.closesp"))},setFontSize:function(e){var t,i,o,r;for(t=0;t<e.length;t++){if("size"==e[t].property.name.split(".").pop()){null==(i=e[t].property.value)?i="0":/^(\+[1-9][0-9]*|0|-[1-9][0-9]*)$/.test(i)&&(o=$(".textformat-preview",this.element),"0"!=i&&(r=parseInt(i.toString().substr(1)),this.registerCallback(function(){/^\+.*$/.test(i)?o.css({"font-size":parseInt(o.css("font-size"))+r+"px"}):o.css({"font-size":parseInt(o.css("font-size"))-r+"px"})}))),$(".textformat-size-value",this.element).text(i);break}}},calculateFontSize:function(e){var t,i,o=parseInt($(".textformat-preview",this.element).css("font-size"));return"0"==e?t=o:(i=parseInt(e.toString().substr(1)),t=/^\+.*$/.test(e)?o-i:o+i),t},retrieveValueFontSize:function(e){var t,i=null;for(t=0;t<e.length;t++){if("size"==e[t].property.name.split(".").pop()){i=e[t].property.value;break}}return i},renderSubproperty:function(e,t){var i,o=this,r=$(".textformat-preview",e);switch(t.name.split(".").pop()){case"bold":""==(i=null===t.value?"":!0===t.value||"true"==t.value?" selected":"")?r.removeClass("bold"):r.addClass("bold"),$.tmpl(this.getTemplate("bold"),{selected:i,property:this.options.name}).appendTo(e.find(".textformat-actions"));break;case"italic":""==(i=null===t.value?"":!0===t.value||"true"==t.value?" selected":"")?r.removeClass("italic"):r.addClass("italic"),$.tmpl(this.getTemplate("italic"),{selected:i,property:this.options.name}).appendTo(e.find(".textformat-actions"));break;case"underline":""==(i=null===t.value?"":!0===t.value||"true"==t.value?" selected":"")?r.removeClass("underline"):r.addClass("underline"),$.tmpl(this.getTemplate("underline"),{selected:i,property:this.options.name}).appendTo(e.find(".textformat-actions"));break;case"strikethru":""==(i=null===t.value?"":!0===t.value||"true"==t.value?" selected":"")?r.removeClass("strikeout"):r.addClass("strikeout"),$.tmpl(this.getTemplate("strikeout"),{selected:i,property:this.options.name}).appendTo(e.find(".textformat-actions"));break;case"color":$.tmpl(this.getTemplate("font"),{property:this.options.name}).appendTo(e.find(".textformat-actions")),t.value&&(t.value=t.value.toLowerCase(),r.css({color:t.value})),$("input.textformat-image-font",e).spectrum({color:t.value,showPaletteOnly:!0,palette:o.palette,change:function(i){var r;r="rgba(0, 0, 0, 0)"===i.toRgbString()?"":i.toHexString(),$(".textformat-preview",e).css({color:r}),o.changeProperty(t.name,r)},beforeShow:function(t){return $(document).bind("mousedown.closesp",function(t){o.closeSp($("input.textformat-image-font",e),t)}),!0}}),$(".sp-preview",e).addClass("biz-ico bz-studio bz-format-text-letter-a_16x16_standard"),$(".sp-replacer",e).find(".sp-dd").remove();break;case"background":$.tmpl(this.getTemplate("background"),{property:this.options.name}).appendTo(e.find(".textformat-actions")),t.value?(t.value=t.value.toLowerCase(),r.css({"background-color":t.value})):(t.value="transparent",r.css({"background-color":"transparent"})),$("input.textformat-image-background",e).spectrum({color:t.value,showPaletteOnly:!0,preferredFormat:"rgb",palette:o.palette,change:function(i){var r;r="rgba(0, 0, 0, 0)"===i.toRgbString()?"":i.toHexString(),$(".textformat-preview",e).css({"background-color":r}),o.changeProperty(t.name,r)},beforeShow:function(t){return $(document).bind("mousedown.closesp",function(t){o.closeSp($("input.textformat-image-background",e),t)}),!0}}),$(".sp-preview",e).addClass("biz-ico bz-studio bz-format-text-color-background_16x16_standard"),$(".sp-replacer",e).find(".sp-dd").remove();break;case"size":$.tmpl(this.getTemplate("size"),{property:this.options.name}).appendTo(e.find(".textformat-actions"))}},resetSubproperty:function(e){var t=$(".textformat-preview",this.element);switch(e.split(".").pop()){case"bold":$(".textformat-actions .textformat-image-bold").removeClass("selected"),t.removeClass("bold");break;case"italic":$(".textformat-actions .textformat-image-italic").removeClass("selected"),t.removeClass("italic");break;case"underline":$(".textformat-actions .textformat-image-underline").removeClass("selected"),t.removeClass("underline");break;case"strikethru":$(".textformat-actions .textformat-image-strikeout").removeClass("selected"),t.removeClass("strikeout");break;case"color":$("input.textformat-image-font",this.element).spectrum("set","black"),t.css("color","black");break;case"background":$("input.textformat-image-background",this.element).spectrum("set",""),t.css("background-color","");break;case"size":t.css("font-size",this.refFontSize+"px"),$(".textformat-size-value",this.element).text("0")}},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame")),this.loadTemplate("bold",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-bold")),this.loadTemplate("italic",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-italic")),this.loadTemplate("underline",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-underline")),this.loadTemplate("strikeout",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-strikeout")),this.loadTemplate("font",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-font")),this.loadTemplate("background",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-background")),this.loadTemplate("size",bizagi.getTemplate("bizagi.editor.component.editor.textformat").concat("#textformat-frame-size"))).done(function(){e.resolve()}),e.promise()},changeProperty:function(e,t){var i;this.values[e]=t,i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.initialValues[e],newValue:t,type:e,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i)},publishReset:function(){var e,t=$(".textformat-preview",this.element);$(".textformat-actions .textformat-image-bold").removeClass("selected"),t.removeClass("bold"),$(".textformat-actions .textformat-image-italic").removeClass("selected"),t.removeClass("italic"),$(".textformat-actions .textformat-image-strikeout").removeClass("selected"),t.removeClass("strikeout"),$(".textformat-actions .textformat-image-underline").removeClass("selected"),t.removeClass("underline"),$("input.textformat-image-background",this.element).spectrum("set",""),t.css("background-color",""),$("input.textformat-image-font",this.element).spectrum("set","black"),t.css("color","black"),t.css("font-size","17px"),$(".textformat-size-value",this.element).text("0"),e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.initialValues,newValue:this.initialValues,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",e)},".textformat-actions i.textformat-primary-control click":function(e){var t=e.data("preview-style"),i=e.data("property");e.toggleClass("selected"),$(".textformat-preview",this.element).toggleClass(t),this.changeProperty(i,!this.values[i])},".textformat-actions i.textformat-tertiary-control click":function(e){var t,i=$(".textformat-preview",this.element),o=$(".textformat-size-value",this.element),r=e.data("property"),n=!0;e.hasClass("textformat-image-size-plus")?(t=parseInt(o.text()),++t<=20?(i.css({"font-size":parseInt(i.css("font-size"))+1+"px"}),o.text(t>0?"+"+t:t)):n=!1):(t=parseInt(o.text()),--t>=-9?(i.css({"font-size":parseInt(i.css("font-size"))-1+"px"}),o.text(t>0?"+"+t:t)):n=!1),n&&this.changeProperty(r,t>0?"+"+t:t)},".textformat-image-reset click":function(){this.publishReset()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.xpath",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n=this;switch(n.map=n.retrieveMapSubproperties(t.subproperties),n.xpathValue=o=bizagi.editor.utilities.getXpathObject(t.value),n.propertiesNames=n.getSubpropertiesNames(t.subproperties,n.map),t.readonly=n.options["editor-parameters"].readonly||!1,t.value=void 0===o?{baxpath:{xpath:""}}:null===o?{baxpath:{xpath:""}}:o,n.inputValue=t.value,t["bas-type"]){case"xpathfromentity":typeof t.subproperties[0].property.value!=typeof t.value&&(t.value.baxpath.xpath=""),n.renderXpathFromEntity(e,t);break;case"xpathtosimple":n.renderXpathToSimple(e,t);break;case"xpathtoentity":n.renderXpathToEntity(e,t);break;case"xpathtocollection":case"xpathtoentitytemplate":n.renderXpathToCollection(e,t);break;case"xpath":n.renderXpath(e,t);break;default:(i=$.tmpl(n.getTemplate("frame"),t)).appendTo(e),r=$("label",i),n.addRequired(r)}""==t.value.baxpath.xpath&&(t.value.baxpath.xpath="xpath")},getSubpropertiesNames:function(e,t){var i,o={};if(!e)return o;for(var r=0;r<e.length;r++)o[(i=e[r].property).name.split(".")[1]]=i.name;return o},retrieveMapSubproperties:function(e){var t,i={};if(!e)return i;for(t=0;t<e.length;t++)i[e[t].property.name]=t;return i},renderXpath:function(e,t){var i,o;(i=$.tmpl(this.getTemplate("xpath"),t)).appendTo(e),o=$("label",i),this.addRequired(o)},renderXpathToCollection:function(e,t){var i,o;(i=$.tmpl(this.getTemplate("xpathtocollection"),t)).appendTo(e),o=$("label",i),this.addRequired(o)},renderXpathToEntity:function(e,t){var i,o;(i=$.tmpl(this.getTemplate("xpathtoentity"),t)).appendTo(e),o=$("label",i),this.addRequired(o)},renderXpathToSimple:function(e,t){var i,o;(i=$.tmpl(this.getTemplate("xpathtosimple"),t)).appendTo(e),o=$("label",i),this.addRequired(o)},renderXpathFromEntity:function(e,t){var i,o;(i=$.tmpl(this.getTemplate("xpathfromentity"),t)).appendTo(e),o=$("label",i),this.addRequired(o)},remove:function(){this.element.hide(),this.element.empty()},positionXpathDialog:function(e){var t=e.offset();return{top:t.top+e.outerHeight(!0),left:t.left}},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-frame")),this.loadTemplate("xpathfromentity",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathfromentity")),this.loadTemplate("xpathtosimple",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathtosimple")),this.loadTemplate("xpathtoentity",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathtoentity")),this.loadTemplate("xpathtocollection",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath-xpathtocollection")),this.loadTemplate("xpath",bizagi.getTemplate("bizagi.editor.component.editor.xpath").concat("#xpath"))).done(function(){e.resolve()}),e.promise()},".xpath.xpath-image-world click":function(e,t){var i=this,o=i.element.find(".xpath-value"),r=i.positionXpathDialog(o),n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH,oldValue:i.inputValue,position:r,type:i.options.name,subproperties:i.propertiesNames,xpathValue:i.options.value,editor:i,editorParameters:i.options["editor-parameters"],id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",n)},".xpath-from-entity.xpath-image-world click":function(e,t){var i=this,o=i.element.find(".xpath-value"),r=i.positionXpathDialog(o),n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_FROM_ENTITY,oldValue:i.inputValue,position:r,type:i.options.name,subproperties:i.propertiesNames,xpathValue:i.options.value,typeEditor:i.options["bas-type"],editor:i,editorParameters:i.options["editor-parameters"],id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",n)},".xpath-to-simple.xpath-image-world click":function(e,t){var i=this,o=i.element.find(".xpath-value"),r=i.positionXpathDialog(o),n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_TO_SIMPLE,oldValue:i.inputValue,position:r,type:i.options.name,subproperties:i.propertiesNames,xpathValue:i.options.value,typeEditor:i.options["bas-type"],editorParameters:i.options["editor-parameters"],id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.options.hasOwnProperty("exclusive")&&(n=$.extend({},n,{exclusive:i.options.exclusive})),i.controller.publish("propertyEditorChanged",n)},".xpath-to-entity.xpath-image-world click":function(e,t){var i=this.element.find(".xpath-value"),o=this.positionXpathDialog(i),r=this.element.closest(".bizagi_editor_component_properties").data("id");this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_TO_ENTITY,oldValue:this.inputValue,position:o,type:this.options.name,subproperties:this.propertiesNames,xpathValue:this.options.value,typeEditor:this.options["bas-type"],id:r})},".xpath-to-collection.xpath-image-world click":function(e,t){var i=this,o=i.element.find(".xpath-value"),r=i.positionXpathDialog(o);i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_TO_COLLECTION,oldValue:i.inputValue,position:r,type:i.options.name,subproperties:i.propertiesNames,xpathValue:i.options.value,typeEditor:i.options["bas-type"],context:i.model["editor-parameters"]&&null!=i.model["editor-parameters"].context?i.model["editor-parameters"].context:null,id:i.element.closest(".bizagi_editor_component_properties").data("id")})},".biz-ico-default click":function(e,t){var i=this,o=i.element.find(".xpath-value"),r=(i.positionXpathDialog(o),!1),n={xpath:{},relatedentity:{}};if(i.options.subproperties)for(var a=0;a<i.model.subproperties.length;a++){if(i.options.subproperties[a].property)if(r=i.options.subproperties[a].property.default)"xpath"==i.options.subproperties[a].property.name.replace("xpath.","")?n.xpath=r:n.relatedentity=r}r||(n=void 0);var s={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:n,data:n,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",s),i.element.empty(),i.options.value=n,i.renderEditor(this.element,i.options)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.editor.xpath.presenter",{},{init:function(e,t){this._super(),this.canvas=e,this.model=t,this.create()},create:function(){this.xpathEditorNavigator=new bizagi.editor.component.xpathnavigator(this.canvas,this.model,this)},render:function(e,t){this.model=void 0!==e?e:this.model,this.xpathEditorNavigator.updateModel(this.model),this.xpathEditorNavigator.render(t)},showXpath:function(e){return this.xpathEditorNavigator.showXpath(e)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.xpathmultiple",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n=this;n.map=n.retrieveMapSubproperties(t.subproperties),n.xpathValue=o=t.value||[],n.propertiesNames=n.getSubpropertiesNames(t.subproperties,n.map),t.hasXpaths=!!(t.value&&t.value.length>0),t.readonly=n.options["editor-parameters"].readonly||!1,n.inputValue=t.value,0==o.length&&(t.value={baxpath:{xpath:""}}),(i=$.tmpl(n.getTemplate("xpathframe"),t)).appendTo(e),r=$("label",i),n.addRequired(r)},getSubpropertiesNames:function(e,t){var i,o={};if(!e)return o;for(var r=0;r<e.length;r++)o[(i=e[r].property).name.split(".")[1]]=i.name;return o},retrieveMapSubproperties:function(e){var t,i={};if(!e)return i;for(t=0;t<e.length;t++)i[e[t].property.name]=t;return i},remove:function(){this.element.hide(),this.element.empty()},positionXpathDialog:function(e){var t=e.offset();return{top:t.top+e.outerHeight(!0),left:t.left}},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("xpathframe",bizagi.getTemplate("bizagi.editor.component.editor.xpathmultiple").concat("#xpathmultiple-xpathframe"))).done(function(){e.resolve()}),e.promise()},".xpath-select click":function(e,t){var i=this,o=i.element.find(".fileprint-item-container"),r=i.positionXpathDialog(o),n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_MULTIPLE,oldValue:i.inputValue,position:r,type:i.options.name,subproperties:i.propertiesNames,xpathValue:i.options.value,typeEditor:i.options["bas-type"],editorParameters:i.options["editor-parameters"],id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.options.hasOwnProperty("exclusive")&&(n=$.extend({},n,{exclusive:i.options.exclusive})),i.controller.publish("propertyEditorChanged",n)},".biz-ico-default click":function(e,t){var i=this,o=i.element.find(".fileprint-item-container"),r=(i.positionXpathDialog(o),!1),n={xpath:{},relatedentity:{}};if(i.options.subproperties)for(var a=0;a<i.model.subproperties.length;a++){if(i.options.subproperties[a].property)if(r=i.options.subproperties[a].property.default)"xpath"==i.options.subproperties[a].property.name.replace("xpath.","")?n.xpath=r:n.relatedentity=r}r||(n=void 0);var s={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:n,data:n,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",s),i.element.empty(),i.options.value=n,i.renderEditor(this.element,i.options)},".interface-image-rule-delete click":function(e,t){var i=this.inputValue,o=e[0].id;o=Number(o.substring(7,8)),i.splice(o,1),0==i.length&&(i=void 0);var r=this.element.find(".fileprint-item-container"),n=(this.positionXpathDialog(r),{xpath:{},relatedentity:{}});n=void 0;var a={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:i,data:n,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",a),this.element.empty(),this.options.value=i,this.renderEditor(this.element,this.options)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.tags",{init:function(e,t,i){this._super(e,t,i)},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("tagsFrame",bizagi.getTemplate("bizagi.editor.component.editor.tags").concat("#tags-tagsframe"))).done(function(){e.resolve()}),e.promise()},renderEditor:function(e,t){var i=this,o=t["editor-parameters"]||{};$.when(o.tags).done(function(o){(o=o||[],i.value=t.value?t.value:[],t.hasValue=i.value.length>0,t.arethereTags=o.length>0,t.hasValue||t.arethereTags)&&(i.container=e,t.tagsSelected=i.value.map(function(e){return{key:e,value:e}}),t.tags=o,$.tmpl(i.getTemplate("tagsFrame"),t).appendTo(e))})},isNewValue:function(e){var t=!0,i=this.value.length;if(0==i)return t;for(var o=0;o<i;o++){var r=this.value[o];if((r.id||r)==e){t=!1;break}}return t},getTagsSelected:function(e){var t=this.value.length,i=[];if(0==t)return i;for(var o=0;o<t;o++)for(var r=this.value[o].id||this.value[o],n=0,a=e.length;n<a;n++){var s=e[n];s.key==r&&i.push(s)}return i},updateProperty:function(){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:this.value,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},showValues:function(e,t){var i=this;$(document).bind("mouseup.tags",function(o){1==o.which&&(0===i.element.has(o.target).length&&(i.hideValues(e,t),$(document).unbind("mouseup.tags")))}),t.slideDown(function(){$(this).addClass("tags-values-open")}),e.addClass("tags-values-open")},refresh:function(e){var t=this.element.find("#tag-values");this.hideValues(e,t),this.container.empty(),this.renderEditor(this.container,this.options)},hideValues:function(e,t){t.slideUp(function(){$(this).removeClass("tags-values-open")}),e.removeClass("tags-values-open")},".tag-select click":function(e,t){var i=this.element.find("#tag-values");t.stopPropagation(),e.hasClass("tags-values-open")?this.hideValues(e,i):this.showValues(e,i)},".tag-item.tag-value click":function(e,t){var i=e.data("key");this.isNewValue(i)&&(this.value.push(e.data("key")),this.options.value=this.value,this.updateProperty()),this.refresh(e)},".item-image-delete-tag click":function(e){var t=e.data("id");this.value.splice(t,1),this.updateProperty(),this.refresh(e)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.stakeholders",{init:function(e,t,i){this._super(e,t,i)},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("stakeholdersFrame",bizagi.getTemplate("bizagi.editor.component.editor.stakeholders").concat("#stakeholders-stakeholdersframe"))).done(function(){e.resolve()}),e.promise()},renderEditor:function(e,t){var i=this,o=(t["editor-parameters"]||{}).stakeholders;$.when(o).done(function(o){i.value=t.value?t.value:[],t.hasValue=i.value.length>0,i.container=e,i.updateProperty(),t.stakeholdersSelected=i.getStakeholdersSelected(o),t.stakeholders=o,$.tmpl(i.getTemplate("stakeholdersFrame"),t).appendTo(e)})},isNewValue:function(e){var t=!0;if(l=this.value.length,0==l)return t;for(var i=0;i<l;i++){if(this.value[i]===e){t=!1;break}}return t},getStakeholdersSelected:function(e){var t=this;return(e=e||[]).reduce(function(e,i){return t.value.includes(i.guid)&&e.push(i),e},[])},refresh:function(e){var t=this.element.find("#stakeholder-values");this.hideValues(e,t),this.container.empty(),this.renderEditor(this.container,this.options)},updateProperty:function(){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:this.value,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},showValues:function(e,t){var i=this;$(document).bind("mouseup.stakeholders",function(o){1==o.which&&(0===i.element.has(o.target).length&&(i.hideValues(e,t),$(document).unbind("mouseup.stakeholders")))}),t.slideDown(function(){$(this).addClass("stakeholders-values-open")}),e.addClass("stakeholders-values-open")},hideValues:function(e,t){t.slideUp(function(){$(this).removeClass("stakeholders-values-open")}),e.removeClass("stakeholders-values-open")},".stakeholder-select click":function(e,t){t.stopPropagation();var i=this.element.find("#stakeholder-values");e.hasClass("stakeholders-values-open")?this.hideValues(e,i):this.showValues(e,i)},".stakeholder-item.stakeholder-value click":function(e,t){var i=e.data("guid");this.isNewValue(i)&&(this.value.push(e.data("guid")),this.options.value=this.value,this.updateProperty()),this.refresh(e)},".item-image-delete-stakeholder click":function(e){var t=e.data("id");this.value.splice(t,1),this.updateProperty(),this.refresh(e)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.resizer",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r="auto",n=this.model.value,a=t["editor-parameters"];this.editorParameters=a,(i=$.tmpl(this.getTemplate("horizontalResize"),t)).appendTo(e),"auto"!=n&&(o=parseInt(n).toString(),r=n.substring(o.length,n.length),i.find("#resizeWidth").val(n)),a.isWidthColumnEditable||(i.find("#resizeWidth").attr("readonly",!0),this.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-editable"),this.showErrorMessage(i.find("#resizeWidth"),this.Error),setTimeout(function(){$("#bizagi_editor_validator_container-columnwidth").css("top",25)},100)),this.widthValue=o,this.measureType=r},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("horizontalResize",bizagi.getTemplate("bizagi.editor.component.editor.resizer").concat("#resizer-horizontal"))).done(function(){e.resolve()}),e.promise()},changeSize:function(e){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:e,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},validateSize:function(e,t){var i=this,o=parseInt(t).toString();if("auto"==t||""==t)return!0;if(isNaN(o))return i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-format"),i.showErrorMessage(e,i.Error),!1;var r=t.substring(o.length,t.length);return"px"!=r&&"%"!=r?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-format"),i.showErrorMessage(e,i.Error),!1):Number(o)<1&&"px"==r?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-minimum"),i.showErrorMessage(e,i.Error),!1):Number(o)>100&&"%"==r?(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-percent"),i.showErrorMessage(e,i.Error),!1):!("%"==r&&Number(o)>i.editorParameters.percentMaxWidth)||(i.Error=bizagi.localization.getResource("formmodeler-component-editor-resizer-error-percent-available"),"string"==typeof i.Error?i.Error=i.Error.replace("{0}",i.editorParameters.percentMaxWidth):caption="",i.showErrorMessage(e,i.Error),!1)},showErrorMessage:function(e,t){var i=$(e);i.hasClass("error")||i.addClass("error"),this.showError(e,t),i.select()},applyColumnWidth:function(e,t){var i=$(e).val(),o=(this.model.value.width,""==i?"auto":i);this.validateSize(e,i)?this.changeSize(o):i="",$("#resizeWidth").val(i)},"input blur":function(e,t){this.applyColumnWidth(e,t)},"input keydown":function(e,t){13==event.keyCode&&this.applyColumnWidth(e,t)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.filter",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o;t.value?t.value.hasOwnProperty("bafilter")||(t.value={bafilter:{filter:bizagi.localization.getResource("formmodeler-component-editor-all-metadata-error"),contextentity:"",scopedefinition:""}}):t.value={bafilter:{filter:""}},this.inputValue=t.value,(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),""==t.value.bafilter.filter&&(t.value.bafilter.filter="filter"),o=$("label",i),this.addRequired(o)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.filter").concat("#filter-frame"))).done(function(){e.resolve()}),e.promise()},".biz-ico-filter-value click":function(e,t){var i;i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EDITOR_DATALIST,data:this.inputValue,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.interface",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o;void 0===t.value?t.value={baref:{ref:bizagi.localization.getResource("formmodeler-component-editor-interface-expression")}}:null===t.value&&(t.value={baref:{ref:bizagi.localization.getResource("formmodeler-component-editor-interface-expression")}}),this.inputValue=t.value,o=t.name.replace(/\./gi,"-"),t.title=bizagi.localization.getResource("formmodeler-component-editor-rule-validation-"+o),t.title==="formmodeler-component-editor-rule-validation-"+o&&(t.title=""),t.value.baref.ref==bizagi.localization.getResource("formmodeler-component-editor-interface-expression")?i=$.tmpl(this.getTemplate("frame-empty"),t):(void 0!==t.value.displayName&&""!=t.value.displayName?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-interface-rule")}),i=$.tmpl(this.getTemplate("frame-rule"),t)),i.appendTo(e),$("input.interface-rule-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}}),$(".interface-rule-value > .defaultvalue-button-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame-empty",bizagi.getTemplate("bizagi.editor.component.editor.interface").concat("#interface-frame-empty")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.interface").concat("#interface-frame-rule"))).done(function(){e.resolve()}),e.promise()},createEditRule:function(e,t){var i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_INTERFACE,oldValue:this.inputValue,data:this.options.value,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.options.hasOwnProperty("exclusive")&&(i=$.extend({},i,{exclusive:this.options.exclusive})),this.controller.publish("propertyEditorChanged",i)},".interface-rule-value .interface-image-rule-delete click":function(e,t){var i;this.element.find(".interface-container").empty(),this.options.value={baref:{ref:bizagi.localization.getResource("formmodeler-component-editor-interface-expression")}},i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:void 0,data:void 0,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.options.hasOwnProperty("exclusive")&&$.extend(i,{exclusive:this.options.exclusive}),this.controller.publish("propertyEditorChanged",i),this.renderEditor(this.element.find(".interface-container"),this.options)},".interface-rule-value .interface-image-rule-edit click":function(e,t){this.createEditRule(e,t)},".defaultvalue-button-value click":function(e,t){this.createEditRule(e,t)},".biz-ico.interface-image-external click":function(e,t){this.createEditRule(e,t)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.formbase",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n,a,s,l,d,c=this;n=void 0===t.allowNewForm||t.allowNewForm,a=void 0===t.allowNone||t.allowNone,void 0===t.value?t.value={baref:{ref:""}}:null===t.value&&(t.value={baref:{ref:""}}),c.inputValue=t.value,c.editorParameters=t["editor-parameters"]||{},$.when(t.relatedForms).done(function(u){r=u||[],d=t.name.replace(/\./g,"-").toLowerCase(),t.icon=d,""!=t.value.baref.ref&&(o=c.updateCaption(t.value,r),t.captionForm=o.caption,o.version&&(t.version=o.version)),i=$.tmpl(c.getTemplate("frame"),t);var p=$("label",i);c.addRequired(p),a&&(l=$.tmpl(c.getTemplate("none"),{}),i.find(".form-menu").prepend(l)),n&&(s=$.tmpl(c.getTemplate("newform"),{}),i.find(".form-menu").prepend(s)),r.length>0&&$.each(r,function(e,t){c.renderParents(i.find(".form-submenu"),t)}),i.appendTo(e),$(".form-button-caption[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})})},updateCaption:function(e,t){var i,o,r="",n="",a=!1,s=e.baref.ref;for(i=0;i<t.length;i++){if(s==t[i].guid){r=t[i].displayname,n=t[i].version;break}if(t[i].children)for(o=0;o<t[i].children.length;o++)if(s==t[i].children[o].guid){r=t[i].children[o].displayname,n=t[i].children[o].version,a=!0;break}if(a)break}return{caption:r,version:n}},renderParents:function(e,t){var i,o=this;o.parentHasChildren(t)?((i=t.guid==o.inputValue.baref.ref?$.tmpl(o.getTemplate("item-parent-children-checked"),t):$.tmpl(o.getTemplate("item-parent-children-unchecked"),t)).data("info",t),$.each(t.children,function(e,t){o.renderChild(i.find("ul"),t)})):(i=t.guid==o.inputValue.baref.ref?$.tmpl(o.getTemplate("item-parent-no-children-checked"),t):$.tmpl(o.getTemplate("item-parent-no-children-unchecked"),t)).data("info",t),i.appendTo(e)},renderChild:function(e,t){var i;t.icon=this.options.icon,(i=t.guid==this.inputValue.baref.ref?$.tmpl(this.getTemplate("item-child-checked"),t):$.tmpl(this.getTemplate("item-child-unchecked"),t)).data("info",t),i.appendTo(e)},parentHasChildren:function(e){var t=!0;return void 0===e.children?t=!1:null===e.children?t=!1:e.children.length<=0&&(t=!1),t},getDataForms:function(){return[{guid:"GUID-FORM-1",displayname:"Group Form 1",version:"1.0",children:[{guid:"GUID-FORM-1-1",displayname:"Form 1, G1",version:"1.0"},{guid:"GUID-FORM-1-2",displayname:"Form 2, G1",version:"1.5",selected:!0}]},{guid:"GUID-GUID",displayname:"Group Form A",version:"3.141592",children:null},{guid:"GUID-FORM-2",displayname:"Group Form 2",version:"1.0",children:[{guid:"GUID-FORM-2-1",displayname:"Form 1, G2",version:"1.0"}]},{guid:"GUID-FORM-3",displayname:"Group Form 3",version:"1.0",children:[{guid:"GUID-FORM-3-1",displayname:"Form 1, G3",version:"2.0"},{guid:"GUID-FORM-3-2",displayname:"Form 2, G3",version:"1.0"}]}]},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-frame")),this.loadTemplate("newform",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-newform")),this.loadTemplate("none",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-none")),this.loadTemplate("item-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-unchecked")),this.loadTemplate("item-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-checked")),this.loadTemplate("item-parent-no-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-no-children-checked")),this.loadTemplate("item-parent-no-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-no-children-unchecked")),this.loadTemplate("item-child-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-child-unchecked")),this.loadTemplate("item-child-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-child-checked")),this.loadTemplate("item-parent-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-children-checked")),this.loadTemplate("item-parent-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.form").concat("#form-item-parent-children-unchecked"))).done(function(){e.resolve()}),e.promise()},closeMenu:function(e,t){t.slideUp(function(){$(this).removeClass("form-open")}),e.removeClass("form-open")},openMenu:function(e,t){var i=this;$(document).bind("mouseup.formbase",function(o){1==o.which&&(0===i.element.has(o.target).length&&(i.closeMenu(e,t),$(document).unbind("mouseup.formbase")))}),t.slideDown(function(){$(this).addClass("form-open")}),e.addClass("form-open")},toggleForm:function(e){var t=e.closest(".form-item-expandable").find("ul");t.is(":visible")?(e.addClass("form-image-plus").removeClass("form-image-minus"),t.hide()):(e.addClass("form-image-minus").removeClass("form-image-plus"),t.show())},".form-button-dropdown click":function(e,t){var i=$(".form-menu",this.element);e.hasClass("form-open")?this.closeMenu(e,i):this.openMenu(e,i),t.stopPropagation()},".form-image-minus click":function(e,t){this.toggleForm(e),t.stopPropagation()},".form-image-plus click":function(e,t){this.toggleForm(e),t.stopPropagation()}}),bizagi.editor.component.editor.formbase("bizagi.editor.component.editor.form",{init:function(e,t,i){this._super(e,t,i)},".form-button-caption click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_BUTTON,value:this.inputValue,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".form-button-dropdown",this.element).hasClass("form-open")&&$(".form-button-dropdown",this.element).removeClass("form-open"),$(".form-menu",this.element).hasClass("form-open")&&$(".form-menu",this.element).removeClass("form-open"),t.stopPropagation()},".form-newform click":function(e,t){var i,o;this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NEW,propertyName:this.model.name,context:"form",id:this.element.closest(".bizagi_editor_component_properties").data("id"),showForm:this.editorParameters.showForm}),i=$(".form-button-dropdown",this.element),o=$(".form-menu",this.element),this.closeMenu(i,o),t.stopPropagation()},".form-none click":function(e,t){var i,o;this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NONE,propertyName:this.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".form-button-dropdown",this.element).removeClass("form-open"),i=$(".form-button-dropdown",this.element),o=$(".form-menu",this.element),this.closeMenu(i,o),t.stopPropagation()},".form-submenu li.form-item-selectable click":function(e,t){var i,o,r,n=e.data("info");r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_OPTION,propertyName:this.model.name,form:n.guid,value:this.inputValue,id:this.element.closest(".bizagi_editor_component_properties").data("id"),showForm:this.editorParameters.showForm},this.controller.publish("propertyEditorChanged",r),this.inputValue={baref:{ref:n.guid}},i=$(".form-button-dropdown",this.element),o=$(".form-menu",this.element),this.closeMenu(i,o),t.stopPropagation()}}),bizagi.editor.observableClass.extend("bizagi.editor.component.editor.form.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />"),this.model=e.model||{},this.formEditor=new bizagi.editor.component.editor.form(this.canvas,this.model,this)},getGuid:function(){return this.model.getGuid()},refresh:function(e){this.gridcolumneditor.refresh(e)},render:function(){this.formEditor.render()},destroy:function(){self.gridcolumneditor.destroy()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.searchformbase",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o,r,n,a,s,l,d,c=this;r=void 0===t.allowNewForm||t.allowNewForm,n=void 0===t.allowNone||t.allowNone,c.values=[],void 0===t.value?t.value=[]:null===t.value?t.value=[]:c.values=c.retrieveSelectedValues(t.value),c.inputValue=t.value,$.when(t.relatedForms).done(function(u){o=u||[],"searchforms"==t.name&&(t.icon="searchform-image-form");var p=[];if(0!==t.value.length)for(p=c.retrieveCaptions(c.values,o),i=$.tmpl(c.getTemplate("frame-empty"),t),l=p.length-1;l>=0;l--)d=$.tmpl(c.getTemplate("caption"),{caption:p[l],version:c.versions[l],icon:"searchforms"==t.name?"searchform-image-form":t.icon}),i.find(".searchform-captions").prepend(d);else i=$.tmpl(c.getTemplate("frame"),t);n&&(s=$.tmpl(c.getTemplate("none"),{}),i.find(".searchform-menu").prepend(s)),r&&(a=$.tmpl(c.getTemplate("newform"),{}),i.find(".searchform-menu").prepend(a)),o.length>0&&$.each(o,function(e,t){c.renderParents(i.find(".searchform-submenu"),t)}),i.appendTo(e)})},retrieveVersion:function(e,t){return null},retrieveSelectedValues:function(e){var t,i=[];for(t=0;t<e.length;t++)i.push(e[t].baref.ref);return i},retrieveCaptions:function(e,t){var i,o,r=[];for(this.versions=[],i=0;i<t.length;i++)if(-1!==$.inArray(t[i].guid,e)&&(r.push(t[i].displayname),this.versions.push(t[i].version)),t[i].hasOwnProperty("children")&&null!==t[i].children)for(o=0;o<t[i].children.length;o++)-1!==$.inArray(t[i].children[o].guid,e)&&(r.push(t[i].children[o].displayname),this.versions.push(t[i].children[o].version));return r},renderParents:function(e,t){var i,o=this;o.parentHasChildren(t)?((i=-1!==$.inArray(t.guid,o.values)?$.tmpl(o.getTemplate("item-parent-children-checked"),t):$.tmpl(o.getTemplate("item-parent-children-unchecked"),t)).data("info",t),$.each(t.children,function(e,t){o.renderChild(i.find("ul"),t)})):(i=-1!==$.inArray(t.guid,o.values)?$.tmpl(o.getTemplate("item-parent-no-children-checked"),t):$.tmpl(o.getTemplate("item-parent-no-children-unchecked"),t)).data("info",t),i.appendTo(e)},renderChild:function(e,t){var i;(i=-1!==$.inArray(t.guid,this.values)?$.tmpl(this.getTemplate("item-child-checked"),t):$.tmpl(this.getTemplate("item-child-unchecked"),t)).data("info",t),i.appendTo(e)},parentHasChildren:function(e){var t=!0;return void 0===e.children?t=!1:null===e.children?t=!1:e.children.length<=0&&(t=!1),t},getDataForms:function(){return[{guid:"GUID-FORM-1",displayname:"Group Form 1",version:"1.0",children:[{guid:"GUID-FORM-1-1",displayname:"Form 1, G1",version:"1.0"},{guid:"GUID-FORM-1-2",displayname:"Form 2, G1",version:"1.5"}]},{guid:"GUID-GUID",displayname:"Group Form A",version:"3.141592",children:null},{guid:"GUID-FORM-2",displayname:"Group Form 2",version:"1.0",children:[{guid:"GUID-FORM-2-1",displayname:"Form 1, G2",version:"1.0"}]},{guid:"GUID-FORM-3",displayname:"Group Form 3",version:"1.0",children:[{guid:"GUID-FORM-3-1",displayname:"Form 1, G3",version:"2.0"},{guid:"GUID-FORM-3-2",displayname:"Form 2, G3",version:"1.0"}]}]},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-frame")),this.loadTemplate("frame-empty",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-frame-empty")),this.loadTemplate("caption",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-caption")),this.loadTemplate("newform",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-newform")),this.loadTemplate("none",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-none")),this.loadTemplate("item-parent-no-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-no-children-checked")),this.loadTemplate("item-parent-no-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-no-children-unchecked")),this.loadTemplate("item-parent-children-checked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-children-checked")),this.loadTemplate("item-parent-children-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-parent-children-unchecked")),this.loadTemplate("item-child-unchecked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-child-unchecked")),this.loadTemplate("item-child-checked",bizagi.getTemplate("bizagi.editor.component.editor.searchform").concat("#searchform-item-child-checked"))).done(function(){e.resolve()}),e.promise()},closeMenu:function(e,t){t.slideUp(function(){$(this).removeClass("searchform-open")}),e.removeClass("searchform-open")},openMenu:function(e,t){var i=this;$(document).bind("mouseup.searchformbase",function(o){1==o.which&&(0===i.element.has(o.target).length&&(i.closeMenu(e,t),$(document).unbind("mouseup.searchformbase")))}),t.slideDown(function(){$(this).addClass("searchform-open")}),e.addClass("searchform-open")},toggleForm:function(e){var t=e.closest(".searchform-item-expandable").find("ul");t.is(":visible")?(e.addClass("searchform-image-plus").removeClass("searchform-image-minus"),t.hide()):(e.addClass("searchform-image-minus").removeClass("searchform-image-plus"),t.show())},".searchform-button-dropdown click":function(e,t){var i=$(".searchform-menu",this.element);e.hasClass("searchform-open")?this.closeMenu(e,i):this.openMenu(e,i),t.stopPropagation()},".searchform-image-minus click":function(e,t){this.toggleForm(e),t.stopPropagation()},".searchform-image-plus click":function(e,t){this.toggleForm(e),t.stopPropagation()}}),bizagi.editor.component.editor.searchformbase("bizagi.editor.component.editor.searchform",{init:function(e,t,i){this._super(e,t,i)},".searchform-button-caption click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_BUTTON,value:this.inputValue,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".searchform-button-dropdown",this.element).hasClass("searchform-open")&&$(".searchform-button-dropdown",this.element).removeClass("searchform-open"),$(".searchform-menu",this.element).hasClass("searchform-open")&&$(".searchform-menu",this.element).removeClass("searchform-open"),t.stopPropagation()},".searchform-newform click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NEW,propertyName:this.model.name,context:"searchform",id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".searchform-button-dropdown",this.element).removeClass("searchform-open"),$(".searchform-menu",this.element).removeClass("searchform-open"),t.stopPropagation()},".searchform-none click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NONE,propertyName:this.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".searchform-button-dropdown",this.element).removeClass("searchform-open"),$(".searchform-menu",this.element).removeClass("searchform-open"),t.stopPropagation()},".searchform-submenu li.searchform-item-selectable click":function(e,t){var i,o=e.data("info");i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_OPTION,propertyName:this.model.name,form:o.guid,value:this.inputValue,context:"searchform",id:this.element.closest(".bizagi_editor_component_properties").data("id")},this.controller.publish("propertyEditorChanged",i);var r=$(".searchform-button-dropdown",this.element),n=$(".searchform-menu",this.element);this.closeMenu(r,n),t.stopPropagation()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.selecttemplate",{types:{NONE:"none",DEFAULT:"default",TEMPLATE:"template"}},{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this,r=o.editorParameters=t["editor-parameters"]||{};$.when(r.templates).done(function(n){var a=o.templates=n||[];o.value=t.value,t.selectedValue=o.getSelectedValue(t.value),i=$.tmpl(o.getTemplate("frame"),$.extend(t,{templates:a}));var s=$.tmpl(o.getTemplate("options"),{disableNoneOption:bizagi.util.parseBoolean(r.disableNoneOption)});i.find(".selecttemplate-menu").prepend(s),i.appendTo(e)})},remove:function(){this.element.hide(),this.element.empty()},getSelectedValue:function(e){var t={};if(!e){var i=this.editorParameters.templatetype||"";return i=i.toUpperCase(),this.Class.types[i]&&(t.displayName=bizagi.localization.getResource("formmodeler-component-editor-selecttemplate-"+this.Class.types[i])),t}if(0==this.templates.length)return t;for(var o=bizagi.editor.utilities.resolveComplexReference(e),r=0,n=this.templates.length;r<n;r++){var a=this.templates[r];if(a.guid==o){t=a;break}}return t},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.selecttemplate").concat("#selecttemplate-frame")),this.loadTemplate("options",bizagi.getTemplate("bizagi.editor.component.editor.selecttemplate").concat("#selecttemplate-options")),this.loadTemplate("default",bizagi.getTemplate("bizagi.editor.component.editor.selecttemplate").concat("#selecttemplate-default"))).done(function(){e.resolve()}),e.promise()},getEditorParameters:function(e){return e["editor-parameters"]||{}},closeMenu:function(e,t){t.slideUp(function(){$(this).removeClass("selecttemplate-open")}),e.removeClass("selecttemplate-open")},isSameItem:function(e){return!!this.value&&bizagi.editor.utilities.resolveComplexReference(this.value)==e},openMenu:function(e,t){var i=this;$(document).bind("mouseup.selecttemplate",function(o){1==o.which&&(0===i.element.has(o.target).length&&(i.closeMenu(e,t),$(document).unbind("mouseup.selecttemplate")))}),t.slideDown(function(){$(this).addClass("selecttemplate-open")}),e.addClass("selecttemplate-open")},setTemplatetype:function(e){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:e,type:"templatetype",id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".selecttemplate-none click":function(e,t){this.setTemplatetype(this.Class.types.NONE),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_TEMPLATE_NONE,propertyName:this.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".selecttemplate-button-dropdown",this.element).removeClass("selecttemplate-open"),$(".selecttemplate-menu",this.element).removeClass("selecttemplate-open"),t.stopPropagation()},".selecttemplate-default click":function(e,t){this.setTemplatetype(this.Class.types.DEFAULT),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_NONE,propertyName:this.model.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),$(".selecttemplate-button-container selecttemplate-button-caption").text(bizagi.localization.getResource("formmodeler-component-editor-selecttemplate-default")),$(".selecttemplate-button-dropdown",this.element).removeClass("selecttemplate-open"),$(".selecttemplate-menu",this.element).removeClass("selecttemplate-open"),t.stopPropagation()},".selecttemplate-button-dropdown click":function(e,t){var i=$(".selecttemplate-menu",this.element);e.hasClass("selecttemplate-open")?this.closeMenu(e,i):this.openMenu(e,i),t.stopPropagation()},".selecttemplate-item click":function(e,t){var i=e.data("guid");this.isSameItem(i)||(this.setTemplatetype(this.Class.types.TEMPLATE),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:bizagi.editor.utilities.buildComplexReference(i),type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}))},".selecttemplate-button-caption click":function(e,t){this.value&&this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_FORM_BUTTON,value:this.value,id:this.element.closest(".bizagi_editor_component_properties").data("id")})},".selecttemplate-newtemplate click":function(e,t){this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_WIZARD_TEMPLATES,propertyName:this.model.name,context:"template",id:this.element.closest(".bizagi_editor_component_properties").data("id")})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.rule",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){void 0===t.value?t.value={baref:{ref:"expression"}}:null===t.value&&(t.value={baref:{ref:"expression"}}),this.subproperties=t.subproperties,this.inputValue=t.value;var i=t.name.replace(/\./gi,"-");t.title=bizagi.localization.getResource("formmodeler-component-editor-rule-validation-"+i),t.title==="formmodeler-component-editor-rule-validation-"+i&&(t.title=""),this.renderRuleEditor(e,t)},renderRuleEditor:function(e,t){var i,o=this.getRuleValue(t.value);"expression"==(o?o.baref:t.value.baref).ref?i=$.tmpl(this.getTemplate("frame-empty"),t):($.extend(t,{nameRule:"",title:""}),t.value.rule&&void 0!==t.value.rule.displayName?""!=t.value.rule.displayName?$.extend(t,{nameRule:t.value.rule.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-rule-expression")}):void 0!==t.value.displayName&&""!=t.value.displayName?$.extend(t,{nameRule:t.value.displayName}):$.extend(t,{nameRule:bizagi.localization.getResource("formmodeler-component-editor-rule-expression")}),i=$.tmpl(this.getTemplate("frame-rule"),t)),i.appendTo(e),$("input.rule-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}}),$(".rule-internal-container > .defaultvalue-button-value[title]",i).tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip ui-rule-editor-tooltip",position:{my:"left top+10",at:"left bottom"}})},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame-empty",bizagi.getTemplate("bizagi.editor.component.editor.rule").concat("#rule-frame-empty")),this.loadTemplate("frame-rule",bizagi.getTemplate("bizagi.editor.component.editor.rule").concat("#rule-frame-rule"))).done(function(){e.resolve()}),e.promise()},createEditRule:function(e,t){var i=this,o=i.isRule90()?"rule90":"rule",r={};r[o]=i.options.value,r[o].rule&&(r[o]=r[o].rule);var n=i.model["editor-parameters"]?i.model["editor-parameters"].type:"Scripting",a={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_EXPRESSION,oldValue:i.inputValue,type:i.options.name,data:r,newValue:i.options.value,id:i.element.closest(".bizagi_editor_component_properties").data("id"),categorytype:n||"Scripting",context:i.model["editor-parameters"]?i.model["editor-parameters"].context:void 0,editor:i.hasRuleSubproperty()?"":"rule"};i.options.hasOwnProperty("exclusive")&&(a=$.extend({},a,{exclusive:i.options.exclusive})),i.controller.publish("propertyEditorChanged",a),i.inputValue=i.options.value},getRuleValue:function(e){return e.rule||e.rule90},isRule90:function(){return this.options.name.indexOf("90")>=0},hasRuleSubproperty:function(){if(this.subproperties&&$.isArray(this.subproperties)){var e=this.subproperties[0].property||{};return!!e["bas-type"]&&"rule"==e["bas-type"]}return!1},"i.rule-external click":function(e,t){this.createEditRule(e,t)},".biz-complex-btn.defaultvalue-button-value click":function(e,t){this.createEditRule(e,t)},".rule-internal-container .rule-image-edit click":function(e,t){this.createEditRule(e,t)},".rule-internal-container .rule-image-delete click":function(e,t){var i,o=this;o.element.find(".rule-container").empty(),i={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o.inputValue,newValue:void 0,data:void 0,type:o.options.name,id:o.element.closest(".bizagi_editor_component_properties").data("id")},o.options.hasOwnProperty("exclusive")&&$.extend(i,{exclusive:o.options.exclusive}),o.controller.publish("propertyEditorChanged",i),o.options.value={baref:{ref:"expression"}},o.renderRuleEditor(o.element.find(".rule-container"),o.options)}}),bizagi.editor.component.editor("bizagi.editor.component.editor.orientation",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-orientation-ltr"),style:"bz-studio bz-orientation-left-to-right_16x16_standard",value:"ltr"},{label:bizagi.localization.getResource("formmodeler-component-editor-orientation-rtl"),style:"bz-studio bz-orientation-right-to-left_16x16_standard",value:"rtl"},{label:bizagi.localization.getResource("formmodeler-component-editor-orientation-inherited"),style:"bz-studio bz-orientation-inherited_16x16_standard",value:"inherited"}],valueCheck:!1}),void 0===t.value?t.value="ltr":null===t.value&&(t.value="ltr"),o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-orientation-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",n),i.inputValue=r},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.orientation").concat("#orientation-frame"))).done(function(){e.resolve()}),e.promise()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.queryinternalsdefaultvalues",{cache:{application:[],processVersion:[],task:[],position:[],processClass:[]}},{init:function(e,t,i){this._super(e,t,i),this.focus=null},renderEditor:function(e,t){t.value&&t.value.fixedvalue||(t.value=this.getIntialValue()),t.loadingMessage=bizagi.localization.getResource("webpart-render-loading"),$.tmpl(this.getTemplate("frame"),t).appendTo(e),this.inputValue=t.value,this.loadData(t,e)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.queryinternalsdefaultvalues").concat("#queryinternals-defaultvalue-frame"))).done(function(){e.resolve()}),e.promise()},getIntialValue:function(){return{fixedvalue:-1,name:""}},loadData:function(e,t){var i=this;$(".ui-control-input",t).click(function(){t.find(".queryinternals-defaultvalue-value").toggleClass("active"),t.find(".queryinternals-defaultvalue-action-btn").toggleClass("active"),""===e.value.name&&$("i[name=expanded].queryinternals-biz-wp-tree-icon").removeClass("bz-tree-less_16x16_standard").addClass("bz-tree-show-more_16x16_standard"),setTimeout(function(){var o=e["editor-parameters"].type,r=$(".queryinternals-defaultvalue-value-loading");if(0==i.Class.cache[o].length){var n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_LOAD_METADATA,id:i.element.closest(".bizagi_editor_component_properties").data("id")};r.startLoading({delay:0,overlay:!0}),$.when(i.controller.publish("propertyEditorChanged",n)).done(function(r){r?(i.renderEditorCanvas(r,t),i.renderEditorListHandlers(t,e),i.expandTree(e,t),i.Class.cache[o]=r):(t.find(".queryinternals-defaultvalue-value").toggleClass("active"),t.find(".queryinternals-defaultvalue-action-btn").toggleClass("active"))}).fail(function(e){bizagi.log(e)}).done(function(){r.endLoading()})}else{0==$(".queryinternals-defaultvalue-value").has("ul").length&&(i.renderEditorCanvas(i.Class.cache[o],t),i.renderEditorListHandlers(t,e),i.expandTree(e,t))}},70)}),$("#queryinternals-defaultvalue-action-btn",t).click(function(){var o=$("#data-queryinternals-defaultvalue-frame span",t);o.text(""),i.updateValue(o,e,t,!0),t.find(".queryinternals-defaultvalue-value").removeClass("active"),t.find(".queryinternals-defaultvalue-action-btn").removeClass("active"),i.expandTree(e,t)})},renderEditorCanvas:function(e,t){var i,o=$("<div>");(i=this.renderEditorCanvasChildrens(e,"<i name='expanded' class='queryinternals-biz-wp-tree-icon biz-ico queryinternals-biz-wp-tree-expand-icon bz-studio bz-tree-show-more_16x16_standard'></i>","<i class='queryinternals-biz-wp-tree-icon queryinternals-biz-wp-tree-image-")).attr("id","queryinternals-defaultvalue-mainList"),i.appendTo(o);var r=$.tmpl(o,{});$(".queryinternals-defaultvalue-value",t).html(r)},renderEditorCanvasChildrens:function(e,t,i){var o,r,n,a,s,l,d=this,c=$("<ul>"),u={application:{style:"bz-studio bz-application_16x16_standard"},process:{style:"bz-studio bz-processes_16x16_standard"},processClass:{style:"bz-studio bz-processes_16x16_standard"},task:{style:"bz-studio bz-m-task_16x16_standard"},position:{style:"bz-studio bz-object-position_16x16_standard"},processVersion:{style:"bz-studio bz-new-version_16x16_standard"},organization:{style:"bz-studio bz-organization_16x16_standard"},loading:{style:"bz-studio bz-m-custom-artifact_16x16_standard"}};return $.each(e,function(e,p){r=d.convertTypeString(p.Type),p.IdObject,n=p.DisplayName,l=p.Id,a=r?u[r].style:"",s=i+r+" "+a+"'></i>",null!=p.Children&&p.Children.length>0?(o=$("<li  data-id="+r+" data-guid="+l+" id = "+l+">"+t+s+bizagi.util.encodeHtml(n)+"</li>").appendTo(c),d.renderEditorCanvasChildrens(p.Children,t,i).appendTo(o)):o=$("<li  data-id= "+r+" data-guid="+l+" id = "+l+">"+s+bizagi.util.encodeHtml(n)+"</li>").appendTo(c)}),c},renderEditorListHandlers:function(e,t){var i=this;$("#queryinternals-defaultvalue-mainList li",e).click(function(){if(this.getElementsByTagName("ul").length>0){var o=this.getElementsByClassName("queryinternals-biz-wp-tree-expand-icon")[0];return $(o).toggleClass("queryinternals-biz-wp-tree-collapse-icon"),$(o).toggleClass("bz-tree-show-more_16x16_standard bz-tree-less_16x16_standard"),$(this).children("ul").toggle("medium"),!1}var r=t["editor-parameters"].type;if(this.getAttribute("data-id")==r)return i.updateValue(this,t,e),e.find(".queryinternals-defaultvalue-value").toggleClass("active"),e.find(".queryinternals-defaultvalue-action-btn").toggleClass("active"),i.expandTree(t,e),$("#data-queryinternals-defaultvalue-frame span",e).text($(this).text()),!1;var n=bizagi.localization.getResource("formmodeler-component-editor-validation-xpath-title"),a=bizagi.localization.getResource("formmodeler-component-editor-queryinternalsdefaultvalues-message-"+r);bizagi.showMessageBox(a,n,"warning",!1)})},updateValue:function(e,t,i,o){var r;$("#queryinternals-defaultvalue-mainList li",i).removeClass("queryinternals-defaultvalue-mainItem"),r=void 0===$(e).attr("id")?-1:$(e).attr("id"),this.inputValue=t.value={fixedvalue:r,name:$(e).text()};var n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:o?void 0:this.buildValue(e),data:o?void 0:this.buildValue(e),type:t.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",n)},expandTree:function(e,t){if(e.value&&e.value.fixedvalue){var i=e["editor-parameters"].type,o=$('#queryinternals-defaultvalue-mainList li[data-id="'+i+'"]').filter(function(t){return $(this).attr("id")===e.value.fixedvalue});$(o,t).addClass("queryinternals-defaultvalue-mainItem")}$("#queryinternals-defaultvalue-mainList ul").hide(),$(".queryinternals-biz-wp-tree-expand-icon").removeClass("queryinternals-biz-wp-tree-collapse-icon");var r=$(".queryinternals-defaultvalue-mainItem").parentsUntil("#queryinternals-defaultvalue-mainList").find("ul:has(.queryinternals-defaultvalue-mainItem)");r.show(),r.siblings().show(),r.siblings().toggleClass("queryinternals-biz-wp-tree-collapse-icon"),$("i[name=expanded].queryinternals-biz-wp-tree-collapse-icon").hasClass("bz-tree-show-more_16x16_standard")&&$("i[name=expanded].queryinternals-biz-wp-tree-collapse-icon").removeClass("bz-tree-show-more_16x16_standard").addClass("bz-tree-less_16x16_standard")},convertTypeString:function(e){var t;return 1==e?t="application":20==e?t="processClass":100==e?t="task":11==e?t="position":16==e?t="processVersion":10==e&&(t="organization"),t},buildValue:function(e){return{fixedvalue:$(e).attr("id"),name:$(e).text()}}}),bizagi.editor.component.editor("bizagi.editor.component.editor.rangequery",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-rangequery-from"),value:"from",style:"bz-studio bz-range-query-from_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-rangequery-to"),value:"to",style:"bz-studio bz-range-query-to_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-rangequery-none"),value:"none",style:" bz-studio bz-number-range_16x16_standard"}],valueCheck:!1}),void 0===t.value?t.value="none":null===t.value&&(t.value="none"),o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-rangequery-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",n),i.inputValue=r},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.rangequery").concat("#rangequery-frame"))).done(function(){e.resolve()}),e.promise()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.userstoinclude",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-userstoinclude-current"),value:"1"},{label:bizagi.localization.getResource("formmodeler-component-editor-userstoinclude-all"),value:"0"}],valueCheck:!1}),void 0===t.value?t.value="current":null===t.value&&(t.value="current"),o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-userstoinclude-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",n),i.inputValue=r},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.userstoinclude").concat("#userstoinclude-frame"))).done(function(){e.resolve()}),e.promise()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.typesearch",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-typesearch-approximate"),value:"approx"},{label:bizagi.localization.getResource("formmodeler-component-editor-typesearch-exact"),value:"exact"}],valueCheck:!1}),void 0===t.value?t.value="approximate":null===t.value&&(t.value="approximate"),o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-typesearch-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",n),i.inputValue=r},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.typesearch").concat("#typesearch-frame"))).done(function(){e.resolve()}),e.promise()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.casestatedefaultvalue",{map:{0:"casestate-all",5:"casestate-closed",2:"casestate-pending",4:"casestate-aborted"}},{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-all"),value:"casestate-all",style:"bz-studio bz-state-blue_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-closed"),value:"casestate-closed",style:"bz-studio bz-state-red_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-pending"),value:"casestate-pending",style:"bz-studio bz-state-yellow_16x16_standard"},{label:bizagi.localization.getResource("formmodeler-component-editor-casestatedefaultvalue-aborted"),value:"casestate-aborted",style:"bz-studio bz-remove-cross_16x16_standard"}],valueCheck:!1}),void 0===t.value?t.value=0:null===t.value&&(t.value=0),"object"==typeof t.value&&(t.value=t.value.fixedvalue?t.value.fixedvalue:0),t.value=o.Class.map[t.value],o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-casestatedefaultvalue-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r;o=i.buildValue(e),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:o,data:o,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",r),i.inputValue=e},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.casestatedefaultvalue").concat("#casestatedefaultvalue-frame"))).done(function(){e.resolve()}),e.promise()},buildValue:function(e){var t=0;for(var i in this.Class.map){if(this.Class.map[i]==e){t=i;break}}return{fixedvalue:t}}}),bizagi.editor.component.editor("bizagi.editor.component.editor.taskstatedefaultvalue",{map:{0:"taskstate-all",1:"taskstate-expired",2:"taskstate-expires-today",7:"taskstate-expires-future"}},{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1,$.extend(t,{uiValues:[{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-all"),value:"taskstate-all"},{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-expired"),value:"taskstate-expired"},{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-expiresinthefuture"),value:"taskstate-expires-future"},{label:bizagi.localization.getResource("formmodeler-component-editor-taskstatedefaultvalue-expirestoday"),value:"taskstate-expires-today"}],valueCheck:!1}),void 0!==t.value&&null!==t.value||(t.value=0),"object"==typeof t.value&&(t.value=t.value.fixedvalue?t.value.fixedvalue:0),t.value=o.Class.map[t.value],o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-taskstatedefaultvalue-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r;o=i.buildValue(e),r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,newValue:o,data:o,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",r),i.inputValue=o},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.taskstatedefaultvalue").concat("#taskstatedefaultvalue-frame"))).done(function(){e.resolve()}),e.promise()},buildValue:function(e){var t=0;for(var i in this.Class.map){if(this.Class.map[i]==e){t=i;break}}return{fixedvalue:t}}}),bizagi.editor.component.editor("bizagi.editor.component.editor.activecontainer",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!1;var r=t["editor-parameters"].values||[];$.extend(t,{uiValues:r,valueCheck:!1}),t.value=t.value||0,o.inputValue=t.value,i=$.tmpl(o.getTemplate("frame"),t),o.inline&&i.addClass("bizagi-editor-activecontainer-inline"),i.appendTo(e);new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:t.uiValues,uiInline:o.inline,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})},responseChangeCombo:function(e,t,i){var o,r,n;o=i.inputValue,r=e,n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")},i.controller.publish("propertyEditorChanged",n),i.inputValue=r},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.activecontainer").concat("#activecontainer-frame"))).done(function(){e.resolve()}),e.promise()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.changelayout",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i;this.data=t,this.boxes=[],this.values=[],this.total=0,this.fixedWidth=0,i=$.tmpl(this.getTemplate("frame"),t),this.renderColumnsWidths(i.find(".changelayout-fields"),t.value.elements),i.appendTo(e),this.createDialogEditor(t)},renderColumnsWidths:function(e,t){var i,o;for(o="",i=0;i<t.length;i++)o+=t[i].width,t.length>1&&i!=t.length-1&&(o+=", ");$.tmpl(this.getTemplate("columns"),{width:o}).appendTo(e)},renderFieldsWidths:function(e,t){var i;for(i=0;i<t.length;i++)$.tmpl(this.getTemplate("field"),t[i]).appendTo(e)},refreshColumnsWidths:function(e){$(".changelayout-concat-value",this.element).text(e)},createDialogEditor:function(e){var t,i,o,r,n=this;for(t=$.tmpl(n.getTemplate("popup-content"),{}),elPopupContentWrapper=$(".changelayout-wrapper-container",t),elPopupContentSlider=$(".changelayout-slider-container",t),o=e.value.elements,c=0;c<o.length;c++)$.tmpl(n.getTemplate("popup-wrapper"),o[c]).appendTo(elPopupContentWrapper);(r=$.tmpl(n.getTemplate("popup-slider"),o[0])).css("width",void 0+"%"),r.appendTo(elPopupContentSlider),i=$.tmpl(n.getTemplate("popup-actions"),{}),$($("span",i).get(0)).click(function(){var e=$(".changelayout-box",t),i=$(".changelayout-field-value",n.element),o=[];$.each(e,function(e,t){t=$(t).parent(),o.push({index:e,width:parseInt(t.attr("data-value"))+"%"}),$(i[e]).text(parseInt(t.attr("data-value"))+"%")});var r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_LAYOUT,values:o,id:n.element.closest(".bizagi_editor_component_properties").data("id")};n.controller.publish("propertyEditorChanged",r),n.hideDialog();for(var a="",s=0;s<n.boxes.length;s++)a+=parseInt($(n.boxes[s]).attr("data-value"))+"%",n.data.value.elements[s].width=parseInt($(n.boxes[s]).attr("data-value"))+"%",n.boxes.length>1&&s!=n.boxes.length-1&&(a+=", ");n.refreshColumnsWidths(a)}).text(bizagi.localization.getResource("formmodeler-component-editor-changelayout-ok")),$($("span",i).get(1)).click(function(){n.hideDialog()}).text(bizagi.localization.getResource("formmodeler-component-editor-changelayout-cancel")),n.modalReference=n.createDialog(t,i);var a=$(".changelayout-slider",t),s={slide:function(e,t){var i=$(".ui-slider-handle"),o=$(t.handle).siblings("a").andSelf().index(t.handle),r=$(this).slider("value");if(i.length>1&&(r=$(this).slider("values")),n.redrawWidthBoxes(o,r),i.length>1)return(0==o||t.value>r[o-1])&&(o==r.length-1||t.value<r[o+1])}},l=$(".changelayout-box",t);if(l.length>2){for(var d=[],c=0;c<l.length;c++){var u=parseFloat(d[c-1])?parseFloat(d[c-1]):0,p=parseFloat($(l[c]).parent().attr("data-value"))+u;p<100&&p>0&&d.push(p)}$.extend(s,{min:0,max:100,values:d})}else $.extend(s,{value:$(l[0]).parent().attr("data-value")});a.slider(s)},redrawWidthBoxes:function(e,t){var i,o,r,n,a,s;i=t[e-1]?parseInt(t[e-1]):0,o=t[e]?parseFloat(t[e])-i:parseFloat(t)-i,n=$(this.boxes[e]),a=$(this.boxes[e+1]),s=parseFloat(n.attr("data-value"))+parseFloat(a.attr("data-value")),n.css("width",o+"%"),$(".changelayout-value",n).text(o+"%"),n.attr("data-value",o),"number"!=typeof t?(r=parseInt(s-parseInt(t[e]-i)),a.css("width",r+"%"),$(".changelayout-value",a).text(r+"%"),a.attr("data-value",r)):(r=s-t,a.css("width",r+"%"),$(".changelayout-value",a).text(r+"%"),a.attr("data-value",r))},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-frame")),this.loadTemplate("field",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-field")),this.loadTemplate("columns",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-columns")),this.loadTemplate("popup-content",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-popupcontent")),this.loadTemplate("popup-wrapper",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-wrapper")),this.loadTemplate("popup-slider",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-slider")),this.loadTemplate("popup-actions",bizagi.getTemplate("bizagi.editor.component.editor.changelayout").concat("#changelayout-popupactions"))).done(function(){e.resolve()}),e.promise()},".biz-ico.changelayout-image-small-popup click":function(e,t){var i,o=this;o.showDialog(e,t).done(function(){var e=$(".changelayout-box-wrapper",o.modalReference);for(o.boxes=[],$.each(e,function(e,t){t=$(t),o.boxes.push(t),o.values.push(parseInt(o.boxes[e].attr("data-value"))),o.total+=o.values[e]}),i=0;i<o.boxes.length;i++)o.boxes[i].css("width",o.boxes[i].attr("data-value")+"%")})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.cssclass",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){void 0===t.value?t.value="":null===t.value&&(t.value=""),this.inputValue=t.value,$.tmpl(this.getTemplate("frame"),t).appendTo(e)},validateAndPublish:function(e,t){var i;/^([a-zA-Z]([a-zA-Z0-9_-])*|\s)*$/.test(t)?(this.hideError(e),this.publishValue(t)):(i=bizagi.localization.getResource("formmodeler-component-editor-cssclass-error-class"),this.showError(e,i),e.select())},publishValue:function(e){var t={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputValue,newValue:e,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")};this.controller.publish("propertyEditorChanged",t),this.inputValue=e},loadTemplates:function(){var e;return e=$.Deferred(),$.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.cssclass").concat("#cssclass-frame"))).done(function(){e.resolve()}),e.promise()},"input keyup":function(e,t){var i=e.val();13==t.keyCode&&i!=this.inputValue&&this.validateAndPublish(e,i)},"input blur":function(e){var t=e.val();t!=this.inputValue&&this.validateAndPublish(e,t)}}),$.Controller("bizagi.editor.component.editor.lstring",{init:function(e,t,i){this.canvas=e,this.model=t,this.controller=i},render:function(){var e=$("<label></label>").html(this.options.caption),t=$("<input />").attr("type","text").val(this.options.hasOwnProperty("value")?this.options.value:this.options.default);t.addClass("ui-control-input").css("width","95%"),this.inputVal=this.options.value,e.appendTo(this.element),t.appendTo(this.element)},"input keydown":function(e,t){t.stopPropagation(),13==t.keyCode&&this.inputVal!=e.val()&&(this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.inputVal,newValue:e.val(),type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),this.inputVal=e.val())}}),bizagi.editor.component.editor("bizagi.editor.component.editor.buttonactions",{init:function(e,t,i){this._super(e,t,i),this.actions={submitData:{tooltip:"formmodeler-component-editor-buttonactions-submitdata-tooltip",label:"formmodeler-component-editor-buttonactions-submitdata",value:!1,show:!0},refresh:{tooltip:"formmodeler-component-editor-buttonactions-refresh",label:"formmodeler-component-editor-buttonactions-refresh",value:!1,show:!1},validate:{tooltip:"formmodeler-component-editor-buttonactions-validate-tooltip",label:"formmodeler-component-editor-buttonactions-validate",value:!1,show:!0},next:{tooltip:"formmodeler-component-editor-buttonactions-next-tooltip",label:"formmodeler-component-editor-buttonactions-next",value:!1,show:!0},nextWithoutValidations:{tooltip:"formmodeler-component-editor-buttonactions-next-without-validations-tooltip",label:"formmodeler-component-editor-buttonactions-next-without-validations",value:!1,show:!0},back:{tooltip:"formmodeler-component-editor-buttonactions-back",label:"formmodeler-component-editor-buttonactions-back",value:!1,show:!1}}},renderEditor:function(e,t){var i=this;i.originalValue=t.value,t.value=i.executeInternalValidationRules(t.value,!0),t.value&&$.each(t.value,function(e,t){i.actions[t]&&i.actions[t].show&&(i.actions[t].value=!0)});var o=$.tmpl(i.getTemplate("control"));o.appendTo(e);var r=i.getComboValues();i.createUIControls(o,r),e.tooltip({position:{my:"left+15 center",at:"right center"},tooltipClass:"ui-widget-content ui-propertybox-tooltip"})},getComboValues:function(){var e=[];return $.each(this.actions,function(t,i){i.show&&(i.value?e.push({tooltip:i.tooltip,icon:null,label:i.label,value:t,selected:"selected"}):e.push({tooltip:i.tooltip,icon:null,label:i.label,value:t}))}),e},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.buttonactions").concat("#buttonactions-frame")),this.loadTemplate("control",bizagi.getTemplate("bizagi.editor.component.editor.buttonactions").concat("#buttonactions-control"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t){var i=this.executeInternalValidationRules(e,!1);return this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:this.originalValue,newValue:i,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")}),!0},executeInternalValidationRules:function(e,t){var i=[];if(t)$.isArray(e)&&e.indexOf("next")>=0?i.push(this.resolveAction("next",e)):i=e;else switch(e){case"next":i=["next","submitData","validate"];break;case"nextWithoutValidations":i=["nextWithoutValidations","submitData"];break;case"submitData":i=["submitData","refresh"];break;default:i=[e]}return i},resolveAction:function(e,t){return"next"==e?t.indexOf("validate")>=0?e:"nextWithoutValidations":e},createUIControls:function(e,t){var i=this;i.myCombo=new i.uiControls.comboBox({uiEditor:i,uiPlaceHolderText:" ---------- ",uiContainer:$(".ui-control-editor",e),uiValues:t,uiInline:!1,onChange:function(e,t){i.responseChangeCombo(e,t,i)}})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.adhocsuggest",{init:function(e,t,i){this._super(e,t,i);this.adhocProcessId=t.adhocProcessId},renderEditor:function(e,t){var i,o,r=this;r.inputValue=t.value,r.charLimit=300,r.placeholder=!!t["editor-parameters"].placeholder,r.placeholderText=r.placeholder?" "+t["editor-parameters"].placeholder:" ",r.isReadOnly=void 0!==t["editor-parameters"].readOnly&&bizagi.util.parseBoolean(t["editor-parameters"].readOnly),$.extend(t,{placeholder:r.placeholder,placeholderText:r.placeholderText,isReadOnly:r.isReadOnly}),(i=$.tmpl(r.getTemplate("frame"),t)).appendTo(e),r.adhocXpathInput=$("#adhocsuggest-input",i),t.value&&r.adhocXpathInput.val(t.value.xpath),r.adhocXpathInput.on("focusin",function(){r.createAutoComplete(i)}),o=$("label",i),r.addRequired(o)},createAutoComplete:function(e){var t=this;t.autoCompleteCreated||(t.adhocXpathvalues?t.initializeAutoComplete(t.adhocXpathInput,t.adhocXpathvalues):$.when(t.getDataSource()).done(function(e){t.adhocXpathvalues=e,t.initializeAutoComplete(t.adhocXpathInput,e)}),t.autoCompleteCreated=!0)},destroyAutoComplete:function(e){if(this.autoCompleteCreated){var t=$("#adhocsuggest-input",e);t.hasClass("ui-autocomplete-input")&&t.autocomplete("destroy")}},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.adhocsuggest").concat("#adhocsuggest-frame"))).done(function(){e.resolve()}),e.promise()},validate:function(e){var t,i,o=!1;return i=(t=$(e)).val(),!this.isLength(e)&&i.length?(t.hasClass("error")||t.addClass("error"),this.showError(e,this.Error),t.select()):(t.removeClass("error"),this.hideError(e),o=!0),o},isLength:function(e){return this.Error=bizagi.localization.getResource("bizagi-editor-numberrange-error-lenght").replace("$number",this.charLimit),e.val().length<=this.charLimit},"label click":function(e,t){e.next().focus()},initializeAutoComplete:function(e,t){var i=this;e.autocomplete({minLength:2,source:t,appendTo:".bizagi_editor_component_properties",select:function(t,o){var r=o.item.label.indexOf(".")>-1?o.item.label.split(".")[1]:o.item.label;e.val(r);var n=i.inputValue?i.inputValue.relatedEntity:null,a={xpath:e.val(),relatedEntity:n},s={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:a,type:i.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:i.element.closest(".bizagi_editor_component_properties").data("id")};return i.inputValue=a,i.controller.publish("propertyEditorChanged",s),!1},focus:function(){return!1},change:function(t,o){if(null===o.item){e.val(t.currentTarget.value);var r=i.inputValue?i.inputValue.relatedEntity:null,n=e.val().length>0?{xpath:bizagi.editor.utilities.getXPathByDisplayName(e.val()),relatedEntity:r}:void 0,a={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.inputValue,newValue:n,type:i.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.inputValue=n,i.controller.publish("propertyEditorChanged",a)}return!1}})},getDataSource:function(){var e=new $.Deferred,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocdataschema",adhocProcessId:this.adhocProcessId});return $.when(t.processRequest()).done(function(t){var i=[];t.properties&&$.each(t.properties,function(e,t){i.push({label:t.name,value:t.name})}),e.resolve(i)}),e.promise()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.adhocdatasource",{init:function(e,t,i){this._super(e,t,i);this.controller=i,this.canvas=e,this.adhocProcessId=t.adhocProcessId,this.adhocXpathValue={},this.dialogBox={},this.entitiesAreLoading=!1},renderEditor:function(e,t){var i,o,r=this;t.readonly=r.options["editor-parameters"].readonly||!1,(i=$.tmpl(r.getTemplate("frame"),t)).appendTo(e),o=$("label",i),r.addRequired(o),r.adhocXpathInput=$(".adhoc-xpath-value",i);var n=$(i).closest(".bizagi_editor_component_editor_adhocdatasource").find("i"),a=$(i).closest(".bizagi_editor_component_editor_adhocdatasource").find(".mini-loading");n.hide(),a.css("display","inline-block"),r.showPredefinedValuesControl=t.showPredefinedValuesControl,r.isAdhocSuggestControl=t.isAdhocSuggestControl,r.showTextModifyPredefinedValuesControl=!1,r.showAdhocEntitiesControl=t.showAdhocEntitiesControl,r.entitiesAreLoading=!0,r.adhocXpathInput.val(bizagi.localization.getResource("formmodeler-component-wait-message-loading-form")),$.when(r.getDataSources()).done(function(e){if(r.adhocXpathInput.val(""),r.bizagiEntitiesValues=e.bizagiEntities,r.adhocEntitiesValues=e.adhocEntities,t.value&&null!=t.value){if(t.value.guid){var i=r.bizagiEntitiesValues.filter(function(e){return e.value===t.value.guid})[0];null==i&&(i=r.adhocEntitiesValues.filter(function(e){return e.value===t.value.guid})[0])}if(r.adhocXpathValue=t.value,r.adhocXpathInput.val("Predefined"),null==i){var o=new $.Deferred;t.value.values?(r.adhocXpathValue=t.value,o.resolve()):$.when(r.getPredefinedValues(t.adhocProcessId,t.value.property)).done(function(e){t.value.values=e,r.adhocXpathValue=t.value,o.resolve()}),o.promise().then(function(){if(bizagi.util.isEmpty(r.adhocXpathValue)||"string"!=typeof r.adhocXpathValue.values){var e={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:void 0,newValue:void 0,type:r.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:r.element.closest(".bizagi_editor_component_properties").data("id")};r.controller.publish("propertyEditorChanged",e)}}),r.adhocXpathInput.val("Predefined"),r.showTextModifyPredefinedValuesControl=!0}else r.adhocXpathValue=i,r.adhocXpathInput.val(i.label)}r.entitiesAreLoading=!1,a.hide(),n.css("display","inline-block")})},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-frame")),this.loadTemplate("close-popup",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-popup-close")),this.loadTemplate("popup-container",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-popup-container")),this.loadTemplate("predefined-values-popup",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-predefined-values-popup")),this.loadTemplate("predefined-values-items",bizagi.getTemplate("bizagi.editor.component.editor.adhocdatasource").concat("#adhocdatasource-predefined-values-items"))).done(function(){e.resolve()}),e.promise()},initializeAutoComplete:function(e,t){var i=this;e.autocomplete({minLength:0,source:t,select:function(t,o){var r=o.item.label;if(e.val(r),i.adhocXpathInput.val()!==r){var n={guid:o.item.value,type:"bizagi",values:null};"adhoc-entity-input"==e[0].id&&(n.type="adhoc");var a={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.adhocXpathValue,newValue:n,type:i.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",a),i.adhocXpathInput.val(e.val()),i.adhocXpathValue=n}return i.closePopup(),!1},focus:function(){return!1},change:function(t,o){if(null===o.item){e.val(t.currentTarget.value);var r={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:i.adhocXpathValue,newValue:void 0,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",r),i.adhocXpathInput.val(""),i.adhocXpathValue=null,i.closePopup()}return!1}}).focus(function(){$(e).autocomplete("search","")})},getDataSource:function(){var e=new $.Deferred,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocdataschema",adhocProcessId:this.adhocProcessId});return $.when(t.processRequest()).done(function(t){var i=[];t.properties&&$.each(t.properties,function(e,t){i.push({label:t.name,value:t.name})}),e.resolve(i)}),e.promise()},createXpathNavigatorCanvas:function(){var e=this,t=e.overlay=$("<div />").addClass("bizagi_editor_xpathnavigator_overlay"),i=e.xpathNavigatorElement=$("<div />").addClass("bizagi_editor_component_xpathnavigator biz-work-panel biz-border-all biz-shadow-modal biz-border-color ui-corner-all"),o=$.tmpl(this.getTemplate("close-popup"));$(".bizagi_editor_xpathnavigator_container-close-image",o).on("click",function(){e.closePopup()}),o.appendTo(e.xpathNavigatorElement),t.appendTo("form-modeler"),i.appendTo(t),setTimeout(function(){i.click(function(e){e.stopPropagation()}),$(t).one("click",function(){e.closePopup()})},100)},calculateFloatingPosition:function(e,t){var i=this.xpathNavigatorElement.outerHeight();return e.top-=i/2,e},getDialogPosition:function(e){var t=e.offset();return{top:t.top,left:t.left+e.outerWidth()}},closePopup:function(){var e=this;e.xpathNavigatorElement.hide(),e.controller.publish("close"),e.adhocEntityInput&&e.adhocEntityInput.data("ui-autocomplete")&&e.adhocEntityInput.autocomplete("destroy"),e.bizagiEntityInput&&e.bizagiEntityInput.data("ui-autocomplete")&&e.bizagiEntityInput.autocomplete("destroy"),setTimeout(function(){e.overlay.detach()},200)},getDataSources:function(){var e=new $.Deferred,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getadhocdatasources",adhocProcessId:this.adhocProcessId});return $.when(t.processRequest()).done(function(t){var i={},o=[],r=[];$.each(t,function(e,t){"bizagi"===t.type?o.push({label:t.entName,value:t.entId}):r.push({label:t.entName,value:t.entId})}),i.bizagiEntities=o,i.adhocEntities=r,e.resolve(i)}),e.promise()},getPredefinedValues:function(e,t){var i=new $.Deferred,o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getpredefinedvalues",adhocProcessId:e,property:t});return $.when(o.processRequest()).done(function(e){i.resolve(e)}),i.promise()},".xpath-image-world click":function(e,t){var i=this;if(!i.entitiesAreLoading){var o=i.getDialogPosition(i.adhocXpathInput);i.createXpathNavigatorCanvas(),i.xpathNavigatorElement.css(i.calculateFloatingPosition(o,i.xpathNavigatorElement)),i.xpathNavigatorElement.css("height","auto"),i.xpathNavigatorElement.show(),i.xpathNavigatorElement.resizable({helper:"ui-resizable-helper",minWidth:250,start:function(e,t){$(".ui-resizable-helper").css({"z-index":1001})},stop:function(e,t){}});var r=i.bizagiEntitiesValues.length>0,n=i.adhocEntitiesValues.length>0,a=$.tmpl(i.getTemplate("popup-container"),{hasBizagiEntities:r,hasAdhocEntities:n,showPredefinedValuesControl:i.showPredefinedValuesControl,showTextModifyPredefinedValuesControl:i.showTextModifyPredefinedValuesControl,showAdhocEntitiesControl:i.showAdhocEntitiesControl,isAdhocSuggestControl:i.isAdhocSuggestControl});if(i.xpathNavigatorElement.append(a),r){i.bizagiEntityInput=$("#bizagi-entity-input",a);var s=i.bizagiEntitiesValues.filter(function(e){return e.label===i.adhocXpathInput.val()})[0];i.bizagiEntityInput.val(s?s.label:""),i.bizagiEntityInput.mousedown(function(e){$(e.target).focus()}),i.initializeAutoComplete(i.bizagiEntityInput,i.bizagiEntitiesValues)}if(n){i.adhocEntityInput=$("#adhoc-entity-input",a);s=i.adhocEntitiesValues.filter(function(e){return e.label===i.adhocXpathInput.val()})[0];i.adhocEntityInput.val(s?s.label:""),i.adhocEntityInput.mousedown(function(e){$(e.target).focus()}),i.initializeAutoComplete(i.adhocEntityInput,i.adhocEntitiesValues)}$("#predefinedValuesLink",a).click(function(){i.showPredefinedValuesPopup()})}},showPredefinedValuesPopup:function(){var e=this,t=e.getTemplate("predefined-values-popup");e.dialogBox.formContent=$.tmpl(t),e.dialogBox.elements={buttonAdd:$("#js-link-add-new-item",e.dialogBox.formContent),buttonSave:$("#button-accept-predefined-values-form",e.dialogBox.formContent),buttonCancel:$("#button-cancel-predefined-values-form",e.dialogBox.formContent)},e.dialogBox.elements.buttonAdd.on("click",$.proxy(e.onAddNewItem,e)),e.dialogBox.elements.buttonSave.on("click",$.proxy(e.onSavePredefinedValues,e)),e.dialogBox.elements.buttonCancel.on("click",$.proxy(e.closeDialogBox,e));var i=[];e.adhocXpathValue&&e.adhocXpathValue.values?i=JSON.parse(e.adhocXpathValue.values):e.dialogBox.data=[],e.initializeItems(i),$(".container-items",e.dialogBox.formContent).addClass("is-editing"),$(".list-items",e.dialogBox.formContent).on("keyup",".inputtext",$.proxy(e.onKeyPressInputItem,e)),$(".list-items",e.dialogBox.formContent).on("focusout",".inputtext",$.proxy(e.onFocusOutInputItem,e)),$(".list-items",e.dialogBox.formContent).on("focus",".inputtext",$.proxy(e.onFocusInputItem,e)),$(".list-items",e.dialogBox.formContent).on("click",".item-button.delete",$.proxy(e.onClickDeleteItem,e)),$(".list-items",e.dialogBox.formContent).on("mouseleave",".item",$.proxy(e.onMouseLeaveItem,e)),e.addNewItem(Math.guid,""),e.dialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"500px",modal:!0,title:bizagi.localization.getResource("Predefined Values"),maximize:!1,closeOnEscape:!1,close:function(){e.dialogBox.formContent.dialog("destroy"),e.dialogBox.formContent.detach()}})},initializeItems:function(e){var t=this.dialogBox.formContent,i=this.getTemplate("predefined-values-items"),o={};o.items=e;var r=$.tmpl(i,o),n=$(".list-items",t);n.empty().append(r),$(".inputtext",n).on("change",$.proxy(this.onChangeItems,this)),this.validateSaveButton(!0)},onChangeItems:function(){},onKeyPressInputItem:function(e){var t=this.dialogBox.formContent;setTimeout(function(){$(e.target).siblings(".showtext").text($(e.target).val()),$(e.target).prop("title",$(e.target).val())},51);var i=e.keyCode||e.which;function o(){setTimeout(function(){$(".list-items .item.edit",t).find(".inputtext").focus();var e=$(".list-items .item.edit",t).find(".inputtext").val();$(".list-items .item.edit",t).find(".inputtext").val(e)},51)}function r(e){$(e.target).closest(".item").removeClass("edit"),$(e.target).closest(".item").next().addClass("edit"),o()}function n(e){$(e.target).closest(".item").removeClass("edit"),$(e.target).closest(".item").prev().addClass("edit"),o()}switch($(".container-items").removeClass("editing-mouse"),this.validateSaveButton(),1===$(".list-items",t).children().length&&(0==$(".inputtext").val().length?$("#button-accept-predefined-values-form",t).prop("disabled",!0):$("#button-accept-predefined-values-form",t).prop("disabled",!1)),i.toString()){case"13":if(""!==$(e.target).val()){$(e.target).closest(".item").removeClass("edit");var a=$(e.target).closest(".item").index();this.addNewItem(Math.guid(),"",a)}break;case"27":return 0!==$(e.target).closest(".item").prev().length?n(e):0!==$(e.target).closest(".item").next().length&&r(e),$(e.target).closest(".item").remove(),this.onChangeItems(e),!1;case"38":0!==$(e.target).closest(".item").prev().length&&n(e);break;case"40":0!==$(e.target).closest(".item").next().length&&r(e)}},onFocusInputItem:function(e){$(e.target).closest(".item").addClass("edit").siblings().removeClass("edit")},onFocusOutInputItem:function(e){if(""===$.trim($(e.target).val())){var t=$(e.target).closest(".item");$(t).css("display","block").empty().css("background","#E7BA99").animate({backgroundColor:"#FFF",height:"0px"},300,"linear",function(){$(this).remove()})}else $(e.target).closest(".item").removeClass("edit")},onMouseLeaveItem:function(){var e=this.dialogBox.formContent;$(".container-items",e).addClass("editing-mouse")},onClickDeleteItem:function(e){$(e.target).closest(".item").off("keyup",".inputtext",$.proxy(this.onKeyPressInputItem,this)),$(e.target).closest(".item").off("click",".item-button.delete",$.proxy(this.onClickDeleteItem,this)),$(e.target).closest(".item").remove(),this.onChangeItems(e),this.validateSaveButton()},validateSaveButton:function(){var e=this.dialogBox.formContent;$("#button-accept-predefined-values-form",e).prop("disabled",!1),(0==$(".list-items",e).children().length||1==$(".list-items",e).children().length&&0==$(".inputtext",e).length||1==$(".inputtext",e).length&&0==$(".inputtext",e).val().length)&&$("#button-accept-predefined-values-form",e).prop("disabled",!0)},addNewItem:function(e,t,i){var o=this.dialogBox.formContent;void 0===i&&-1===(i=$(".list-items .item",o).length-1)&&(i=0);var r=this.getTemplate("predefined-values-items"),n={};n.items=[{key:e,value:t}];var a=$.tmpl(r,n);$(a).addClass("edit"),0===$(".list-items",o).children().length?$(".list-items",o).append(a):$(".list-items",o).children().eq(i).after(a),$(".inputtext",a).on("change",$.proxy(this.onChangeItems,this)),setTimeout(function(){$(".list-items .item.edit",o).find(".inputtext").focus()},51)},getValueItems:function(){var e=[];return $(".list-items .inputtext",this.dialogBox.formContent).each(function(){""!==$(this).val().trim()&&e.push({key:$(this).prop("id"),value:$(this).val()})}),e},onAddNewItem:function(){$("container-items").animate({scrollTop:9999},"slow"),this.addNewItem(Math.guid(),"")},onSavePredefinedValues:function(e){e.preventDefault();var t=this,i={guid:t.adhocXpathValue&&t.adhocXpathValue.guid?t.adhocXpathValue.guid:Math.guid(),processguid:t.adhocProcessId,type:"predefined",values:JSON.stringify(t.getValueItems())},o={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:t.adhocXpathValue,newValue:i,type:t.options.name,refreshProperties:!0,removeDefaultDisplayName:!0,id:t.element.closest(".bizagi_editor_component_properties").data("id")};t.controller.publish("propertyEditorChanged",o),t.adhocXpathInput.val("Predefined"),t.adhocXpathValue=i,t.closeDialogBox(),t.closePopup()},closeDialogBox:function(){var e=this;$(".list-items",e.dialogBox.formContent).off("keyup",".inputtext",$.proxy(e.onKeyPressInputItem,e)),$(".list-items",e.dialogBox.formContent).off("focusout",".inputtext",$.proxy(e.onFocusOutInputItem,e)),$(".list-items",e.dialogBox.formContent).off("focus",".inputtext",$.proxy(e.onFocusInputItem,e)),$(".list-items",e.dialogBox.formContent).off("click",".item-button.delete",$.proxy(e.onClickDeleteItem,e)),$(".list-items",e.dialogBox.formContent).off("mouseleave",".item",$.proxy(e.onMouseLeaveItem,e)),e.dialogBox.elements.buttonAdd.off("click",$.proxy(e.onAddNewItem,e)),e.dialogBox.elements.buttonSave.off("click",$.proxy(e.onSavePredefinedValues,e)),e.dialogBox.elements.buttonCancel.off("click",$.proxy(e.closeDialogBox,e)),e.dialogBox.formContent.dialog("destroy"),e.dialogBox.formContent.detach()}}),bizagi.editor.component.editor("bizagi.editor.component.editor.adhocattribute",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o=this;o.inline=!0,t.readonly=o.options["editor-parameters"].readonly||!1,(i=$.tmpl(o.getTemplate("frame"),t)).appendTo(e),o.inputValue=t.value,$.when(t["editor-parameters"].attribs).done(function(e){o.attributesMetadata=e;new o.uiControls.comboBox({uiEditor:o,uiContainer:$(".ui-control-editor",i),uiValues:o.getDataForCombo(t.value),uiInline:o.inline,uiInitValue:-1,onChange:function(e,t){o.responseChangeCombo(e,t,o)}})})},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.adhocattribute").concat("#adhocattribute-frame"))).done(function(){e.resolve()}),e.promise()},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r},".xpath-from-adhoc-entity.xpath-image-world click":function(e,t){var i=this,o=i.element.find(".xpath-value"),r=i.positionXpathDialog(o),n={typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SELECT_XPATH_FROM_ENTITY,oldValue:i.inputValue,position:r,type:i.options.name,subproperties:i.propertiesNames,xpathValue:i.options.value,typeEditor:i.options["bas-type"],editor:i,editorParameters:i.options["editor-parameters"],id:i.element.closest(".bizagi_editor_component_properties").data("id")};i.controller.publish("propertyEditorChanged",n)},getDisplayAttribute:function(e){return this.attributesMetadata.filter(function(t){return t.attribGuid===e})[0].displayName},getDataForCombo:function(e){for(var t=[],i=0;i<this.attributesMetadata.length;i++){var o={label:this.attributesMetadata[i].displayName,value:this.attributesMetadata[i].attribGuid};switch(this.attributesMetadata[i].attribType.type){case 15:o.style="ui-bizagi-type-attribute-string";break;case 7:o.style="ui-bizagi-type-attribute-number";break;case 8:o.style="ui-bizagi-type-attribute-currency";break;case 5:o.style="ui-bizagi-type-attribute-boolean";break;case 12:o.style="ui-bizagi-type-attribute-date";break;default:o.style="ui-bizagi-type-attribute"}o.value===e&&(o.selected=!0),t.push(o)}return e||(t[0].selected=!0,this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:"",newValue:t[0].value,data:t[0].value,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})),t},responseChangeCombo:function(e,t,i){var o,r;o=i.inputValue,r=e,i.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_CHANGE_PROPERTY,oldValue:o,newValue:r,data:r,type:i.options.name,id:i.element.closest(".bizagi_editor_component_properties").data("id")}),i.inputValue=r}}),bizagi.editor.observableClass.extend("bizagi.editor.component.controlsnavigator.group.model",{},{init:function(e){this._super(),this.items=[],e&&this.processData(e)},processData:function(e){var t,i;if(e.design.visual["controls-navigator"]){switch(typeof(i=e.design.visual["controls-navigator"].group)){case"string":t=i;break;case"object":t=bizagi.editor.utilities.resolveInternalResource(i)}this.id=t,this.name=t}else this.id="default",this.name="default";this.addItem(e)},addItem:function(e){var t={id:e.name,name:bizagi.editor.utilities.resolveInternalResource(e.display),type:e.type,icon:e.icon,style:e.style};this.items.push(t)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.controlsnavigator.model",{},{init:function(){this._super(),this.controls={},this.context={form:{groups:[],hash:{}},startform:{groups:[],hash:{}},grid:{groups:[],hash:{}},offlinegrid:{groups:[],hash:{}},mobilegrid:{groups:[],hash:{}},adhocgrid:{groups:[],hash:{}},searchform:{groups:[],hash:{}},queryform:{groups:[],hash:{}},offlineform:{groups:[],hash:{}},template:{groups:[],hash:{}},layout:{groups:[],hash:{}},notVisible:{groups:[],hash:{}},adhocform:{groups:[],hash:{}},mobileform:{groups:[],hash:{}}}},processData:function(e){var t=this;$.each(e.controls,function(e,i){if(!t.controls[i.name]){var o=t.resolveGroupforControlNavigator(i.design.visual["controls-navigator"]);if(o){var r=t.getControlContext(i);r&&(r.hash[o]?(r.hash[o].addItem(i),t.controls[i.name]=r.hash[o].items[r.hash[o].items.length-1]):t.createAndAddGroupInModel(r,o,i))}}}),t.sortGroups()},resolveGroupforControlNavigator:function(e){var t="default";if(e){if("none"==e||"none"==e.group)return null;switch(typeof e.group){case"string":t=e.group;break;case"object":t=bizagi.editor.utilities.resolveInternalResource(e.group)}}return t},createAndAddGroupInModel:function(e,t,i){var o=new bizagi.editor.component.controlsnavigator.group.model(i);e.groups.push(o),e.hash[t]=o,this.controls[i.name]=o.items[0]},getControlContext:function(e){var t=this,i=e.type,o=t.publish("getContext");return"mobileColumn"===i?t.context.mobilegrid:"column"===i?t.context.grid:"offlinecolumn"===i?t.context.offlinegrid:"adhoccolumn"===i?t.context.adhocgrid:"search"===i?t.context.searchform:"query"===i?t.context.queryform:"queryInternal"===i?t.publish("isContextEntityApplication")?t.context.queryform:null:"offline"===i||"offlinecontainer"===i?t.context.offlineform:"adhoc"===i||"adhoccontainer"===i?t.context.adhocform:"layout"===i?t.context.layout:"nestedform"===i||"booleandisabled"===i?t.context.notVisible:"mobile"===i?t.context.mobileform:"container"==i?"queryform"!=o||t.isGridControl(e)?"startform"==o?t.context.startform:"mobileform"==o?t.context.mobileform:t.context.form:t.context.queryform:"startform"==o?t.context.startform:t.context.form},sortGroups:function(){for(var e in this.context)for(var t=0,i=this.context[e].groups.length;t<i;t+=1)this.context[e].groups[t].items.sort(this.sortFunction)},sortFunction:function(e,t){var i=e.name.toLowerCase(),o=t.name.toLowerCase();return i<o?-1:i>o?1:0},getControlDisplayName:function(e){return this.controls[e]?this.controls[e].name:e},isGridControl:function(e){return e.name.indexOf("grid")>=0}}),$.Class.extend("bizagi.editor.component.banner.model",{getBannerModel:function(){return this.model={banner:{displayname:bizagi.localization.getResource("formmodeler-component-banner-store-legend"),cite:bizagi.localization.getResource("formmodeler-component-banner-store-cite"),icon:"mtool-item-more-controls",on:!0}}}}),bizagi.editor.component.controller("bizagi.editor.component.xpathnavigator",{init:function(e,t){t=t||{},this._super(e),this.model=t.model,this.canvas=e,this.presenter=t.presenter,this.scope=t.scope||"form",this.MIN_HEIGHT_FLOATING_POPUP=200},loadTemplates:function(){var e={node:bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#node","node-version":bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-node-version",close:bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-close",helper:bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-helper","node-container":bizagi.getTemplate("bizagi.editor.component.xpathnavigator")+"#xpathnavigator-node-container"};return this._super(e)},updateModel:function(e){this.model=e},createFloatingCanvas:function(){var e=this,t=e.overlay=$("<div />").addClass("bizagi_editor_xpathnavigator_overlay");e.element.addClass("biz-work-panel biz-border-all biz-shadow-modal biz-border-color ui-corner-all"),t.appendTo("form-modeler"),e.element.appendTo(t),setTimeout(function(){e.element.click(function(e){e.stopPropagation()}),$(t).one("click",function(){e.close()})},100)},render:function(e){var t,i,o,r=new $.Deferred,n=this;return t=(e=e||{}).expand||!1,n.isReadOnly="undefined"!=e.isReadOnly&&bizagi.util.parseBoolean(e.isReadOnly),n.context=e.context||"fixed",n.scope=e.scope||"form",n.filter=e.filter,n.allowDrag=void 0===e.allowDrag||e.allowDrag,n.allowDrag=!n.isReadOnly&&n.allowDrag,n.allowCollection=e.allowCollection||!1,n.isFloatingContext()&&n.createFloatingCanvas(),n.element.empty(),$.isEmptyObject(n.model)?null:($.when(n.loadTemplates()).done(function(){if(n.isFloatingContext()){n.renderCloseButton();var a=n.calculateFloatingPosition(e.position);n.element.css(a),n.element.show(),n.element.resizable({helper:"ui-resizable-helper",minHeight:n.MIN_HEIGHT_FLOATING_POPUP,minWidth:250,start:function(e,t){$(".ui-resizable-helper").css({"z-index":1001})},stop:function(e,t){}})}i=$.tmpl(n.getTemplate("node-container"),{}),n.element.append(i),o=n.element.find(".xpathnavigator-node-container"),n.renderNodes(o,n.model.rootNodes,t),$(document).ready(function(){n.togglePlusMinusIcon(n.element.find(".bizagi_editor_xpathnavigator_node").first(),!1)}),e.xpath&&n.showXpath(e.xpath),r.resolve()}),r.promise())},calculateFloatingPosition:function(e){var t=this.overlay.height(),i=this.canvas.height();return i=i<this.MIN_HEIGHT_FLOATING_POPUP?this.MIN_HEIGHT_FLOATING_POPUP:i,e.top+i>t&&(e.top-=i),e},renderCloseButton:function(){var e=$.tmpl(this.getTemplate("close"));0===this.canvas.has($(".xpathnavigator-close")).length&&e.prependTo(this.canvas)},renderNodes:function(e,t,i){var o=this,r=o.filter;$.each(t,function(t,n){"grid"===o.context?"form"!==n.nodeType&&"collection"!==n.nodeType&&o.renderNodeAndSubnodes(e,n,i):void 0===r?o.renderNodeAndSubnodes(e,n,i):o.isValidNode(n,r)&&o.renderNodeAndSubnodes(e,n,i)})},renderNodeAndSubnodes:function(e,t,i){var o,r;o=this.renderNode(e,t),t.nodes&&(r=$(o).find(".bizagi_editor_xpathnavigator_node-childs"),this.renderNodes(r,t.nodes),t.nodes.length>0&&!i&&$(o).find(".bizagi_editor_xpathnavigator_node-childs").hide())},isValidNode:function(e,t){var i=!1,o=e.nodeType,r=e.nodeSubtype;return"form"!=o&&("entity-application"==o?i=!0:e.hasRelatedEntity?("collection"!=o||"xpathtocollection"==t.typeFilter||"xpathtoentitytemplate"==t.typeFilter||this.allowCollection)&&(i=!0):this.isValidFilter(o,r,t)&&(i=!0)),i},isValidFilter:function(e,t,i){var o=i.typeFilter,r=i.types,n=!1;switch(o){case"xpathfromentity":case"xpathtosimple":for(a=0;a<r.length;a++)try{if(-1!=$.inArray(t,bizagi.editor.component.xpathnavigator.equiv.rule.xpathtosimple[r[a]])){n=!0;break}}catch(e){bizagi.logError("Equiv Error","nodeType: "+t+", types: "+r.toString())}break;case"xpathmultiple":var a;for(a=0;a<r.length;a++)try{if(-1!=$.inArray(t,bizagi.editor.component.xpathnavigator.equiv.rule.xpathmultiple[r[a]])){n=!0;break}}catch(e){bizagi.logError("Equiv Error","nodeType: "+t+", types: "+r.toString())}}return n},isFloatingContext:function(){return"floating"===this.context},renderNode:function(e,t){var i,o=$.tmpl(this.getTemplate("node"),t);return o.appendTo(e),t.formVersion&&(i=$.tmpl(this.getTemplate("node-version"),{version:t.formVersion}),$(i).insertBefore($("label",o))),this.allowDrag&&this.setDraggableNode(o,t),t.displayName.length>20&&$(o).tooltip({tooltipClass:"ui-widget-content",position:{my:"left top",at:"right+5 top-5"}}),o},setDraggableNode:function(e,t){var i=this,o=i.presenter.publish("getMainPanel");this.isFloatingContext()?i.removeDraggableOptions(e):t.enableDrag(i.scope)&&($(e).find(".bizagi_editor_xpathnavigator_data").first().data(t),$(e).find(".bizagi_editor_xpathnavigator_data").first().draggable({helper:function(e){return i.draggableHelper(e)},connectToSortable:".ui-bizagi-container-connectedSortable",distance:15,start:function(){o.addClass("bz-main-dashed-grid").addClass("ui-start-drag"),i.presenter.publish("controlRefreshCanvas",{})},stop:function(){o.removeClass("bz-main-dashed-grid").removeClass("ui-start-drag"),bizagi.util.removeAutoScroll("autoscroll","xpathnavigator"),i.presenter.publish("controlRefreshCanvas",{})},containment:"document",cursorAt:"template"==i.scope&&{left:5}}))},removeDraggableOptions:function(e){$(".ui-bizagi-draggable-item",e).removeClass("ui-bizagi-draggable-item"),$(".ui-bizagi-itemfordrag ",e).removeClass("ui-bizagi-itemfordrag ")},draggableHelper:function(e){var t,i,o,r,n,a,s,l,d,c=$(e.currentTarget),u=this.presenter.publish("getMainContainer"),p=this.presenter.publish("getMainPanel");return o=c.data(),n=parseFloat($("label",c).width())+(r=parseFloat($(".biz-ico",c).eq(0).width()))+40+"px","template"==this.scope&&(n=r+5,n+="px"),(t=$.tmpl(this.getTemplate("helper"),$.extend(o,{context:this.scope}))).css("width",n),t.css("max-width",n),i=t.appendTo(u).css({zIndex:900}),l=$(".wrapper-main-panel",u),d=$(".wrapper-main-scroll",l),p.hasClass("biz-auto-height")&&(a=l.position().top+parseFloat(l.css("padding-top"))+parseFloat(l.css("margin-top"))+50,s=d.outerHeight(),bizagi.util.autoScroll(d,a,s,"xpathnavigator")),i},expandCollapse:function(e,t){var i=this,o=new $.Deferred;if(!i.actionInProgress){if(i.hasChildren(e[0]))return i.togglePlusMinusIcon(e,t),null;i.actionInProgress=!0;var r=e.data("id");return $.when(i.model.getChildren(r)).done(function(t){var r=$(e).find(".bizagi_editor_xpathnavigator_node-childs");i.renderNodes(r,t),i.togglePlusMinusIcon(e,!0),i.actionInProgress=!1,o.resolve(t)}),o.promise()}},findNode:function(e,t){return e.find("#"+t.id)},hide:function(){this.element.hide()},togglePlusMinusIcon:function(e,t){$(e).find("ul").first().is(":visible")&&!t?($(e).children("div").find(".biz-btn").children(".xpathnavigator_collapse_icon").removeClass("bz-tree-less_16x16_standard").addClass("bz-tree-show-more_16x16_standard"),$(e).children("div").find(".biz-btn").children(".xpathnavigator_collapse_icon").removeClass("xpathnavigator_collapse_icon").addClass("xpathnavigator_expand_icon"),$(e).find("ul").first().hide()):($(e).children("div").find(".biz-btn").children(".xpathnavigator_expand_icon").removeClass("bz-tree-show-more_16x16_standard").addClass("bz-tree-less_16x16_standard"),$(e).children("div").find(".biz-btn").children(".xpathnavigator_expand_icon").removeClass("xpathnavigator_expand_icon").addClass("xpathnavigator_collapse_icon"),$(e).find("ul").first().show())},findAndShowForm:function(e,t,i,o){var r,n,a,s=this,l=i.baref.ref;if(null===(void 0!==o?o.xpath.baxpath.xpath:null))if(n=t[t.length-1],null===t[t.length-1].nodes)r=$("#"+n.id,e),s.expandCollapse(r,!0).done(function(){s.showXpathByGuid(i,o)});else{if(0==n.nodes.length)throw"Query is not sending right data.";for(a=0;a<n.nodes.length;a++)if(n.nodes[a].guid==l){r=$("#"+n.nodes[a].id,e),$(".ui-state-active",s.element).removeClass("ui-state-active"),$(r).find(".bizagi_editor_xpathnavigator_data").first().addClass("ui-state-highlight"),s.element.scrollTo(".ui-state-highlight",200);break}}else if(null===t.nodes)r=$("#"+t.id),s.expandCollapse(r,!0).done(function(){s.findAndShowForm(e,t,i,o)});else if(null===(n=t.nodes[t.nodes.length-1]).nodes)r=0==(r=$("#"+n.id)).length?$("#"+t.id):r,s.expandCollapse(r,!0).done(function(){s.findAndShowForm(e,t,i,o)});else{if(0==n.nodes.length)throw"Query is not sending right data.";for(a=0;a<n.nodes.length;a++)if(n.nodes[a].guid==l){r=$("#"+n.nodes[a].id,e),$(".ui-state-active",s.element).removeClass("ui-state-active"),$(r).find(".bizagi_editor_xpathnavigator_data").first().addClass("ui-state-highlight"),s.element.scrollTo(".ui-state-highlight",200);break}}},showXpathByGuid:function(e,t){var i=void 0!==t?t.xpath.baxpath.xpath:null;$(".bizagi_editor_xpathnavigator_data").removeClass("ui-state-highlight"),null===i?this.findAndShowForm(this.element,this.model.rootNodes,e,t):this.findAndShowXpath(this.element,this.model.rootNodes,t,e)},showMetadataXpath:function(e){if($(".bizagi_editor_xpathnavigator_data").removeClass("ui-state-highlight"),"undefined"!=e){var t=[{nodes:this.model.rootNodes}];this.findAndShowXpath(this.element,t,e)}},showXpath:function(e){var t=this,i=new $.Deferred;if($(".bizagi_editor_xpathnavigator_data").removeClass("ui-state-highlight"),void 0!==e)return $.when(t.findAndShowXpath(t.element,t.model.rootNodes,e)).done(function(){t.isFloatingContext()&&t.renderCloseButton(),i.resolve()}),i.promise()},findAndShowXpath:function(e,t,i,o){var r,n,a=this,s=0,l="grid"===a.scope?t:t[0].nodes||t,d=e,c=bizagi.editor.utilities.resolveComplexXpath(i),u=c?c.split("."):[],p=new $.Deferred;for(n=u[0];;){if(!(r=a.findNodeForXpath(d,l,n))){p.resolve();break}if(s===u.length-1){p.resolve();break}if(n=n+"."+u[++s],!r.node.nodes||0===r.node.nodes.length){$.when(a.expandCollapse(r.element,!0)).done(function(e){e&&e.length?$.when(a.showXpath(i)).done(function(){p.resolve()}):p.resolve()}),r=void 0;break}l=r.node.nodes,d=$(r.element).find(".bizagi_editor_xpathnavigator_node-childs"),"true"===r.node.canHaveChildren?a.expandCollapse(r.element,!0):p.resolve()}return r&&(void 0!==o?a.findAndShowForm(r.element,r.node,o,i):a.highlightNode(r.element)),p.promise()},findNodeForXpath:function(e,t,i){var o,r,n=this;return $.each(t,function(t,a){if(o=n.findNode(e,a),a.xpath===i)return r={element:o,node:a},!1}),r},highlightNode:function(e){this.presenter.publish("getMainContainer");$(".ui-state-active",this.element).removeClass("ui-state-active"),$(e).find(".bizagi_editor_xpathnavigator_data").first().addClass("ui-state-highlight"),this.element.scrollTo(".ui-state-highlight",200)},hasChildren:function(e){return $(e).find("ul").first().children().length>0},close:function(){this.hide(),this.publish("close"),this.isFloatingContext()&&this.overlay.detach()},onNodeRightClick:function(e,t){var i=this,o=i.model.getNode(e),r=bizagi.util.parseBoolean(o.canHaveChildren);if("floating"!=i.context&&(i.contextmenu&&i.contextmenu.destroy(),!o.parentIsGrid())){var n=$("#"+e),a=!!r&&i.expandCollapse(n,!0);$.when(a).done(function(){i.showContextMenu(o,{x:t.clientX,y:t.clientY})})}},showContextMenu:function(e,t){var i=this,o=e.getContextMenuModel(i.scope),r=i.presenter.publish("getMainContainer");return i.contextmenu=new bizagi.editor.component.contextmenu.presenter({model:o,guid:e.id,mainContainer:r}),i.contextmenu.subscribe("onItemClicked",function(t,o){i.onContextMenuItemClicked(e,o)}),i.contextmenu.render({position:t})},onContextMenuItemClicked:function(e,t){this.presenter.publish("contextMenuItemClick",{node:e,action:t.action})},".xpathnavigator-close > .bizagi_editor_xpathnavigator_container-close-image click":function(){this.close()},".bizagi_editor_xpathnavigator_data mousedown":function(e,t){var i=e.parent().data("id");if(0==t.button||1==t.button){var o=this.model.getNode(i);this.presenter.publish("nodeClick",o)}else 2==t.button&&(this.isReadOnly||this.scope&&"adhocform"===this.scope||this.onNodeRightClick(i,t))},".xpathnavigator_expand_icon, .xpathnavigator_collapse_icon click":function(e,t){t.stopImmediatePropagation();var i=e.closest(".bizagi_editor_xpathnavigator_node");this.expandCollapse(i)},".bizagi_editor_xpathnavigator_data dblclick":function(e,t){var i,o;if(!$(t.target).hasClass("xpathnavigator_expand_icon")&&!$(t.target).hasClass("xpathnavigator_collapse_icon")){var r=e.closest(".bizagi_editor_xpathnavigator_node").data("id"),n=this.model.getNode(r);(n.renderType&&n.enableDrag(this.scope)||!this.model.isRootNode(n)&&this.allowCollection)&&(this.presenter.publish("nodeDoubleClick",n),$(".ui-tooltip").remove(),i=$(".wrapper-main-scroll"),bizagi.util.autoScrollBottom(i),o=$(".ui-bizagi-container-form > div:last",i),bizagi.util.highLightElement(o),e.removeClass("ui-state-active"))}}}),bizagi.editor.observableClass.extend("bizagi.editor.component.xpathnavigator.model",{view:{onlyProcessEntity:"PROCESSENTITY",allView:"All"}},{init:function(e,t){var i=this;if(i._super(),i.rootNodes=null,i.nodes=null,i.nodeHash={},i.xpathNodeHash={},i.scopeAttributesNodes={},i.xpathPromises={},i.processEntityNodes={},this.readyDefer=new $.Deferred,i.communicationProtocol=bizagi.editor.communicationprotocol.factory,e)i.initialize(e,t);else{var o=i.communicationProtocol.createProtocol({protocol:"getfirstload"});$.when(o.processRequest()).done(function(e){i.initialize(e,t)})}},initialize:function(e,t){var i=this;if(i.processEntityId=e.nodes&&e.nodes[0]&&e.nodes[0].processEntityId,i.isProcessEntity=!!i.processEntityId,i.isEmptyRootNode=t||!1,e){if(i.isProcessEntity)for(var o=0,r=e.nodes[0].nodes.length;o<r;o++){var n=e.nodes[0].nodes[o];n.guidRelatedEntity==i.processEntityId&&(i.processEntityNodes[n.guid]=n)}i.rootNodes=i.processData(e),i.nodes=i.rootNodes.length>0&&i.rootNodes[0].nodes?i.rootNodes[0].nodes.slice(0):i.nodes,e.context&&(i.context=e.context)}i.readyDefer.resolve(i)},processData:function(e){var t=this,i=[];return e.nodes&&$.each(e.nodes,function(e,o){var r=new bizagi.editor.component.xpathnavigator.node(o);if(t.nodeHash[r.id]=r,t.processEntityNodes[r.guid]&&(t.processEntityNodes[r.guid]=r),bizagi.util.parseBoolean(r.isScopeAttribute)&&(t.scopeAttributesNodes[r.guid]=r),r.nodeType&&"form"!==r.nodeType&&(t.xpathNodeHash[r.xpath]=r),i.push(r),r.canHaveChildren&&0==o.nodes.length&&(o.nodes=null),o.nodes){var n=t.processData({nodes:o.nodes});r.setChildren(n),$.each(n,function(e,t){t.setParent(r)})}}),i},ready:function(){return this.readyDefer.promise()},registerNewNodes:function(e,t){var i=this,o=(t=t||[],e&&e.getChildren()||[]);t.length>o.length||t.forEach(function(t){if(0==o.filter(function(e){return e.guid==t.guid}).length){t.nodes=t.nodes||[],t.xpath=e.xpath+"."+t.xpath;var r=i.processData({nodes:[t]})[0];r.setParent(e),e.addChild(r)}})},addChildren:function(e,t){var i=this.getNode(e),o=this.processData(t);this.isRootNode(i)&&(this.nodes=o),i.setChildren(o),$.each(o,function(e,t){t.setParent(i)})},getChildren:function(e,t){var i=this,o=i.getNode(e);if(!o)return[];var r=o.getChildren();if(r&&!t)return r;var n=new $.Deferred;o.isRootNode=this.isRootNode(o);var a=i.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:o});return $.when(a.processRequest()).done(function(t){i.addChildren(e,t),n.resolve(o.getChildren())}),n.promise()},invalidateScopeAttributes:function(){for(var e in this.scopeAttributesNodes){this.scopeAttributesNodes[e].setChildren(void 0)}},searchNodeByXpath:function(e){var t=this.xpathNodeHash[e];return this.xpathPromises[e]||(this.xpathPromises[e]=this.getChildren(t.id)),this.xpathPromises[e]},getNodeByXpath:function(e){return this.xpathNodeHash[e]},getNode:function(e){return this.nodeHash[e]},getAllModel:function(){this.rootNodes.length>0&&(this.rootNodes[0].nodes=this.nodes&&this.nodes.slice(0))},getProcessEntityModel:function(){var e=[];if(this.isProcessEntity){for(var t in this.processEntityNodes)this.processEntityNodes.hasOwnProperty(t)&&e.push(this.processEntityNodes[t]);this.rootNodes[0].nodes=e}else this.getAllModel()},getProcessEntityId:function(){return this.processEntityId?this.processEntityId:null},processEntityRelated:function(e){var t=this.getNodeByXpath(e);return t&&t.parentIsProcessEntity(this.processEntityId)},getRootNode:function(){return this.rootNodes[0]},isRootNode:function(e){if(this.isEmptyRootNode)return!1;var t=this.getRootNode();return!(!t||t.guid!==e.guid||t.xpath!==e.xpath)},getSubModel:function(e){if("none"===e)return{ready:function(){return(new $.Deferred).resolve({})}};var t=bizagi.editor.utilities.resolveComplexXpath(e);if(null==t)return this;if(0==t.length)return this;var i=this.getNodeByXpath(t);if(i){var o=new $.Deferred,r=this.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:{contextScope:i.contextScope,guidRelatedEntity:i.guidRelatedEntity,xpath:"",isRootNode:!0,style:i.style,isScopeAttribute:i.isScopeAttribute}});return $.when(r.processRequest(),i,this).done(function(e,t,i){var r=new bizagi.editor.component.xpathnavigator.model(e,!0);$.isArray(t.getChildren())&&i.registerNewNodes(t,e.nodes),o.resolve(r)}),o.promise()}return null},getSubModelByEntity:function(e,t){var i=new $.Deferred,o=this.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:{contextScope:null,guidRelatedEntity:e,xpath:"",isRootNode:!0,style:null,isScopeAttribute:!1,entityContext:t}});return $.when(o.processRequest()).done(function(e){var t=new bizagi.editor.component.xpathnavigator.model(e,!0);i.resolve(t)}),i.promise()}}),bizagi.editor.observableClass.extend("bizagi.editor.component.xpathnavigator.node",{icons:{entity:"bz-studio bz-entity_16x16_standard","entity-application":"bz-studio bz-application_16x16_standard","entity-master":"bz-studio bz-master_16x16_standard","entity-stakeholder":"bz-studio bz-stakeholderentity_16x16_standard","entity-parametric":"bz-studio bz-Parametersentity_16x16_standard","entity-system":"bz-studio bz-entity_16x16_standard",number:"bz-studio bz-number_16x16_standard",form:"bz-studio bz-reusable-forms_16x16_standard",string:"bz-studio bz-textbox_16x16_standard",text:"bz-studio bz-textbox_16x16_standard",date:"bz-studio bz-date_16x16_standard",boolean:"bz-studio bz-boolean_16x16_standard",currency:"bz-studio bz-money_16x16_standard",image:"bz-studio bz-image_16x16_standard",attachment:"bz-studio bz-file-uploads_16x16_standard",float:"bz-studio bz-number_16x16_standard",uploadecm:"bz-studio bz-file-uploads-ecm_16x16_standard",collection:"bz-studio bz-direct-collections_16x16_standard","metadata-metadata":"bz-studio bz-process-filters_16x16_standard","metadata-applications":"bz-studio bz-process-filters-application_16x16_standard","metadata-process":"bz-studio bz-process-filters-process_16x16_standard","metadata-task":"bz-studio bz-process-task_16x16_standard","metadata-task-current":"bz-studio bz-process-current-task_16x16_standard","metadata-task-previous":"bz-studio bz-process-previous-task_16x16_standard","metadata-task-entry-date":"bz-studio bz-process-task-entry-date_16x16_standard","metadata-task-expiry-date":"bz-studio bz-process-task-expiry-date_16x16_standard","metadata-task-state":"bz-studio bz-process-task-state_16x16_standard","metadata-cases":"bz-studio bz-process-case_16x16_standard","metadata-case-creation-date":"bz-studio bz-case-creation-date_16x16_standard","metadata-case-creator":"bz-studio bz-case-creator_16x16_standard","metadata-case-id":"bz-studio bz-case-id_16x16_standard","metadata-case-number":"bz-studio bz-case-number_16x16_standard","metadata-case-solution-date":"bz-studio bz-case-solution-date_16x16_standard","metadata-case-state":"bz-studio bz-case-state_16x16_standard","metadata-users":"bz-studio bz-users_16x16_standard","metadata-users-creator":"bz-studio bz-users-creator_16x16_standard","metadata-users-creator-fullname":"bz-studio bz-users-creator-fullname_16x16_standard","metadata-users-creator-username":"bz-studio bz-users-creator-name_16x16_standard","metadata-users-creator-position":"bz-studio bz-users-creator-position_16x16_standard","metadata-users-currentuser":"bz-studio bz-users-current_16x16_standard","metadata-users-currentuser-fullname":"bz-studio bz-users-current-fullname_16x16_standard","metadata-users-currentuser-username":"bz-studio bz-users-current-name_16x16_standard","metadata-users-currentuser-position":"bz-studio bz-users-current-position_16x16_standard","metadata-users-previoususer":"bz-studio bz-users-previous_16x16_standard","metadata-users-previoususer-fullname":"bz-studio bz-users-previous-fullname_16x16_standard","metadata-users-previoususer-username":"bz-studio bz-users-previous-name_16x16_standard","metadata-users-previoususer-position":" bz-studio bz-users-previous-position_16x16_standard"}},{init:function(e){this._super(),this.nodes=null,this.data=e,e&&this.processData(e)},processData:function(e){var t=this;t.id=Math.guid(),t.canHaveChildren=void 0!==e.canHasChildren&&e.canHasChildren,t.displayName=e.displayName,t.guid=e.guid,t.isDraggable=void 0===e.isDragabble||e.isDragabble,t.style=e.style,t.renderType=e.renderType,t.DataType=e.DataType,t.xpath=e.xpath,t.isScopeAttribute=void 0!==e.isScopeAttribute&&e.isScopeAttribute,t.guidRelatedEntity=e.guidRelatedEntity,t.hasRelatedEntity=!(!t.guidRelatedEntity||"00000000-0000-0000-0000-000000000000"==t.guidRelatedEntity),t.contextScope=e.contextScope,t.formVersion=e.formVersion,t.maxLength=e.maxLength;var i={};i.default=e.displayName,i.displayName=e.displayName,(e.Languages||[]).forEach(function(e){i[e.code]=e.value}),t.languages=i,t.contextEntityType=e.contextEntityType,e.entityContext&&(t.entityContext=e.entityContext),e.predefinedValues&&(t.predefinedValues=e.predefinedValues),!0===t.isScopeAttribute||"true"==t.isScopeAttribute?(t.nodeType=e.style.replace("ui-bizagi-type-scope-","").replace(/(attribute)(-\w+)/g,"$1"),t.nodeSubtype=e.style.replace("ui-bizagi-type-scope-","").replace(/(attribute)(-)(\w+)/g,"$3")):(t.nodeType=e.style.replace("ui-bizagi-type-","").replace(/(attribute)(-\w+)/g,"$1"),t.nodeSubtype=e.style.replace("ui-bizagi-type-","").replace(/(attribute)(-)(\w+)/g,"$3")),t.icon=t.Class.icons[t.nodeSubtype],"true"===t.isDraggable&&(t.dragabbleClass="ui-bizagi-draggable-item ui-bizagi-itemfordrag")},getOriginalData:function(){var e=this.data;return e.nodes=[],e},setChildren:function(e){this.nodes=e},getChildren:function(){return this.nodes},addChild:function(e){this.nodes.push(e)},setParent:function(e){this.parent=e},getParent:function(){return this.parent},getDisplayName:function(){return this.displayName},getContextMenuModel:function(e){var t=this.nodeTypeContextMenuMappings[this.nodeType];var i=function(t){var i=t;if("template"==e){for(var o=[],r=0,n=t.items.length;r<n;r++)"addelement"!=t.items[r].action&&"addchildelements"!=t.items[r].action&&null==t.items[r].separator&&o.push(t.items[r]);i.items=o}return i}(this.contextMenuModels[t]);return new bizagi.editor.component.contextmenu.model(i)},setCaptionViewContextMenu:function(){var e=this.getContextMenuModel().getItemByAction("viewall");e&&(e.caption=e.caption==bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-viewall")?bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-onlycontextentity"):bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-viewall"))},enableDrag:function(e){return"grid"===e||"queryform"===e?bizagi.util.parseBoolean(this.isDraggable):!this.parentIsGrid()&&bizagi.util.parseBoolean(this.isDraggable)},parentIsGrid:function(){var e=!1;return this.parent&&(e="grid"===this.parent.renderType||this.parent.parentIsGrid()),e},parentIsProcessEntity:function(e){return!!e&&e===this.guidRelatedEntity},getMaxLength:function(){return this.maxLength},getRenderType:function(){return this.nodeSubtype},getDataType:function(){return this.DataType},setScopeAttribute:function(e){this.isScopeAttribute=e},parentIsParametricEntity:function(){var e=!1;return this.parent&&(e="ui-bizagi-type-entity-parametric"==this.parent.style||this.parent.parentIsParametricEntity()),e}}),bizagi.editor.component.xpathnavigator.node.extend("bizagi.editor.component.xpathnavigator.node",{},{init:function(e){this.contextMenuModels={applicationEntity:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-viewall"),style:"viewall",action:"viewall",icon:"bz-studio view-all_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},masterEntity:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addchildelements"),style:"addchildelements",action:"addchildelements",icon:"bz-studio bz-add-elements_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},entity:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addchildelements"),style:"addchildelements",action:"addchildelements",icon:"bz-studio bz-add-elements_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editvalues"),style:"editvalues",action:"editvalues",icon:" bz-studio bz-edit-entity-values_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},entitySystem:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addchildelements"),style:"addchildelements",action:"addchildelements",icon:"bz-studio bz-add-elements_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]},attribute:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"}]},form:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-newform"),style:"newform",action:"newForm",icon:"bz-studio bz-new-form_16x16_standard"}]},collection:{items:[{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-addelement"),style:"addelement",action:"addelement",icon:"bz-studio bz-add-element_16x16_standard"},{separator:!0},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-editentity"),style:"editentity",action:"editentity",icon:"bz-studio bz-edit-entity_16x16_standard"},{caption:bizagi.localization.getResource("formmodeler-component-xpathnavigator-context-menu-refresh"),style:"refresh",action:"refresh",icon:"bz-studio bz-refresh_16x16_standard"}]}},this.nodeTypeContextMenuMappings={"entity-application":"applicationEntity","entity-master":"masterEntity","entity-parametric":"entity","entity-system":"entitySystem","entity-stakeholder":"entity",attribute:"attribute",form:"form"},this._super(e)}}),$.Class.extend("bizagi.editor.component.xpathnavigator.equiv",{rule:{xpathtosimple:{boolean:["boolean"],number:["currency","number","float","oracleNumber"],date:["date"],string:["string","text"],upload:["upload","attachment"],letter:["letter"],image:["image"],uploadecm:["uploadecm"]},xpathtocollection:{xpathtocollection:["collection"]},xpathmultiple:{entity:["entity-parametric","entity-master","entity-stakeholder","entity-system"],upload:["upload","attachment"],image:["image"],uploadecm:["uploadecm"]}}},{}),bizagi.editor.observableClass.extend("bizagi.editor.component.xpathnavigator.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />"),this.model=e.model,this.xpathNavigator=new bizagi.editor.component.xpathnavigator(this.canvas,$.extend(e,{presenter:this}))},render:function(e){return e=e||{},this.model=e.model||this.model,this.xpathNavigator.updateModel(this.model),this.xpathNavigator.render(e)},renderPopup:function(e){var t;return e=e||{},this.model=e.model||this.model,this.xpathNavigator.updateModel(this.model),this.xpathNavigator.subscribe("close",function(){e.onClose&&e.onClose()}),t=$.extend(e,{context:"floating"}),this.xpathNavigator.render(t)},closePopup:function(){this.xpathNavigator.close()},showXpath:function(e){return this.xpathNavigator.showXpath(e)},showXpathByGuid:function(e,t){this.xpathNavigator.showXpathByGuid(e,t)},showMetadataXpath:function(e){this.xpathNavigator.showMetadataXpath(e)}}),bizagi.editor.component.controller("bizagi.editor.component.layoutnavigator",{init:function(e,t){this._super(),t=t||{},this.canvas=e,this.model=t.model,this.presenter=t.presenter},render:function(e){var t,i,o,r,n=this;e=e||{},n.isReadOnly="undefined"!=e.isReadOnly&&bizagi.util.parseBoolean(e.isReadOnly),n.element.empty(),n.showPercent=!0,$.when(n.loadTemplates()).done(function(){t=n.model,i=$.tmpl(n.getTemplate("layoutContainer"),{});for(var e=0;e<t.layouts.length;e++){if(o=$.tmpl(n.getTemplate("layoutItem"),t.layouts[e]),r=$(".bz-fm-layout-width",o),n.showPercent)for(var a=t.layouts[e].children,s=0;s<a.length;s++)layoutWidth=$.tmpl(n.getTemplate("layoutWidth"),{value:a[s].properties.width}),r.append(layoutWidth);else r.remove();i.append(o)}n.element.append(i),n.isReadOnly||n.setDraggableItems()})},updateModel:function(e){this.model=e},loadTemplates:function(){var e={layoutContainer:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-container",layoutItem:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-item",layoutWidth:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-width",layoutHelper:bizagi.getTemplate("bizagi.editor.component.layoutnavigator")+"#layout-helper"};return this._super(e)},setDraggableItems:function(){var e=this,t=this.presenter.publish("getMainContainer"),i=this.presenter.publish("getMainPanel");$(".bz-fm-layout-navigator-item",t).data("self",e),$(".bz-fm-layout-navigator-item",t).draggable({helper:function(t){return e.setDraggableHelper(t)},connectToSortable:".ui-bizagi-container-connectedSortable",distance:15,start:function(){i.addClass("bz-main-dashed-grid").addClass("ui-start-drag"),e.presenter.publish("controlRefreshCanvas",{})},stop:function(){i.removeClass("bz-main-dashed-grid").removeClass("ui-start-drag"),bizagi.util.removeAutoScroll("autoscroll","layoutnavigator"),e.presenter.publish("controlRefreshCanvas",{})},containment:"document"})},setDraggableHelper:function(e){var t,i,o,r,n,a=$(e.currentTarget),s=this.presenter.publish("getMainContainer"),l=this.presenter.publish("getMainPanel");a.addClass("ui-dragging"),i=a.data("id"),o=a.data("caption"),t=a.data("self"),n=a.data("style"),a.data("type",i),a.data("display",o),r=$.tmpl(t.getTemplate("layoutHelper"),{id:i,caption:o,style:n}).appendTo(s).css({zIndex:900});var d=parseFloat($("label",r).width())+parseFloat($(".bz-fm-layout-image",r).eq(0).width())+90+"px";r.css("width",d);var c=$(".wrapper-main-panel",s),u=$(".wrapper-main-scroll",c);if(l.hasClass("biz-auto-height")){var p=c.position().top+parseFloat(c.css("padding-top"))+parseFloat(c.css("margin-top"))+50,m=u.outerHeight();bizagi.util.autoScroll(u,p,m,"layoutnavigator")}return r},".bz-fm-layout-navigator-item dblclick":function(e){var t,i,o;this.presenter.publish("layoutDoubleClick",{id:e.data("id")}),i=(t=$(".wrapper-main-scroll"))[0].scrollHeight,t.scrollTop(i),o=$(".ui-bizagi-container-form > div:last",t),bizagi.util.highLightElement(o)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.layoutnavigator.model",{},{init:function(e){this._super(),this.layouts=[],this.processData(this.getLayoutDefinitions())},processData:function(e){var t=this;$.each(e.layouts,function(e,i){i.caption.resource&&(i.caption=bizagi.localization.getResource(i.caption.resource)),t.layouts.push(i)})},findControlById:function(e){for(var t=!1,i=0,o=this.layouts.length;i<o;i+=1)if(this.layouts[i].id===e){t=this.layouts[i];break}return t},getLayoutDefinitions:function(){return{layouts:[{caption:{resource:"formmodeler-component-editor-layoutnavigator-fulllayout"},children:[{properties:{width:"100%"},type:"panel"}],id:"full-layout",style:"bz-studio bz-layout-full_32x32_standard"},{caption:"70% - 30%",children:[{properties:{width:"70%"},type:"panel"},{properties:{width:"30%"},type:"panel"}],id:"70-30",style:"bz-studio bz-layout-70-30_32x32_standard"},{caption:"33% - 34% - 33%",children:[{properties:{width:"33%"},type:"panel"},{properties:{width:"34%"},type:"panel"},{properties:{width:"33%"},type:"panel"}],id:"33-33-33",style:"bz-studio bz-layout-33-33-33_32x32_standard"},{caption:"30% - 70%",children:[{properties:{width:"30%"},type:"panel"},{properties:{width:"70%"},type:"panel"}],id:"30-70",style:"bz-studio bz-layout-30-70_32x32_standard"},{caption:"50% - 50%",children:[{properties:{width:"50%"},type:"panel"},{properties:{width:"50%"},type:"panel"}],id:"50-50",style:"bz-studio bz-layout-50-50_32x32_standard"}]}}}),bizagi.editor.observableClass.extend("bizagi.editor.component.layoutnavigator.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />").addClass("bizagi_editor_layoutnavigator_container"),this.model=e.model,this.layoutNavigator=new bizagi.editor.component.layoutnavigator(this.canvas,$.extend(e,{presenter:this}))},render:function(e){return e=e||{},this.model=e.model||this.model,this.layoutNavigator.updateModel(this.model),this.layoutNavigator.render(e)}}),$.Controller("bizagi.editor.component.commandseditor",{init:function(e,t,i){this.canvas=e,this.model=t,this.controller=i,this.tmpl={}},refresh:function(){var e=this.element;this.currentTab=$("#bz-fm-commandseditor-tabs",e).tabs("option","selected");var t=0==this.currentTab?$(".bz-fm-commandseditor-actions").parent():$(".bz-fm-commandseditor-validations").parent();this.scrollPosition=t.scrollTop(),this.render()},render:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.getTemplate("container");($.tmpl(i,e.model.getReadOnlyModel()).appendTo(t),$("#bz-fm-commandseditor-tabs",t).tabs({selected:e.currentTab}),e.scrollPosition)&&(0==e.currentTab?$(".bz-fm-commandseditor-actions").parent():$(".bz-fm-commandseditor-validations").parent()).scrollTop(e.scrollPosition);e.changeEnabledView()})},changeEnabledView:function(){var e,t,i,o=this,r=o.element,n=o.model.actions;$.each(n,function(n,a){0==a.enabled&&(e="li[data-guid='"+a.guid+"']",t=r.find(e),i=$(".ui-comboBox-image-small-check",t),o.disableActionsView(t,i))});var a=o.model.validations;$.each(a,function(n,a){0==a.enabled&&(e="li[data-guid='"+a.guid+"']",t=r.find(e),i=$(".ui-comboBox-image-small-check",t),o.disableActionsView(t,i))}),o.updateEnabledAllChecked(),o.initActionSearch(),o.initValidationSearch(),o.actionPositionHandlers(),o.validationPositionHandlers(),o.initTooltips()},disableActionsView:function(e,t){var i,o=bizagi.localization.getResource("formmodeler-component-enable"),r=bizagi.localization.getResource("formmodeler-component-disable");return t.toggleClass("ui-comboBox-image-small-uncheck"),t.addClass("bz-point_16x16_standard"),e.toggleClass("bz-fm-commandseditor-component-disable"),t.hasClass("ui-comboBox-image-small-uncheck")?(t.prop("title",o),i=!1,t.removeClass("bz-point_16x16_standard"),t.addClass("bz-black"),t.addClass("bz-point_16x16_black")):(t.prop("title",r),i=!0,t.removeClass("bz-black"),t.removeClass("bz-point_16x16_black"),t.addClass("bz-point_16x16_standard")),i},initTooltips:function(){var e=this.element,t=e.find(".bz-fm-commandseditor-icons-edit"),i=e.find(".bz-fm-commandseditor-icons-delete"),o=e.find(".bz-fm-commandseditor-icons-toogle"),r=e.find(".bz-fm-commandseditor-icons-action-move-up"),n=e.find(".bz-fm-commandseditor-icons-action-move-down");t.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}}),i.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}}),o.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}}),n.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}}),r.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip",position:{my:"left+15 center",at:"right center"}})},updateEnabledAllChecked:function(){var e=this.element,t=e.find(".bz-fm-commandseditor-action .ui-comboBox-image-small-check").length,i=e.find(".bz-fm-commandseditor-action .ui-comboBox-image-small-uncheck").length,o=$("#bz-fm-commandseditor-actions-enable-all"),r=e.find(".bz-fm-commandseditor-validation .ui-comboBox-image-small-check").length,n=e.find(".bz-fm-commandseditor-validation .ui-comboBox-image-small-uncheck").length,a=$("#bz-fm-commandseditor-validations-enable-all");t==i?o.prop("checked",!1):o.prop("checked",!0),r==n?a.prop("checked",!1):a.prop("checked",!0)},disableAllActionsView:function(e,t,i){var o=bizagi.localization.getResource("formmodeler-component-enable"),r=bizagi.localization.getResource("formmodeler-component-disable");i?(t.removeClass("bz-black"),t.removeClass("bz-point_16x16_black"),t.addClass("bz-point_16x16_standard"),e.removeClass("bz-fm-commandseditor-component-disable"),t.removeClass("ui-comboBox-image-small-uncheck"),t.prop("title",r)):(t.removeClass("bz-point_16x16_standard"),t.addClass("bz-black"),t.addClass("bz-point_16x16_black"),e.addClass("bz-fm-commandseditor-component-disable"),t.addClass("ui-comboBox-image-small-uncheck"),t.prop("title",o))},".bz-fm-commandseditor-action, .bz-fm-commandseditor-validation click":function(e){var t=this.element;$(".bz-fm-commandseditor-action, .bz-fm-commandseditor-validation",t).removeClass("bz-state-selected").removeClass("ui-state-active"),e.addClass("bz-state-selected").addClass("ui-state-active")},".bz-fm-commandseditor-action .bz-fm-commandseditor-icons-edit click":function(e){var t=e.closest(".bz-fm-commandseditor-action").data("guid");this.controller.editAction(this.model,t)},".bz-fm-commandseditor-validation .bz-fm-commandseditor-icons-edit click":function(e){var t=e.closest(".bz-fm-commandseditor-validation").data("guid");this.controller.editValidation(this.model,t)},"#bz-fm-commandseditor-actions-editor .ui-widget-actions button click":function(){this.controller.createAction(this.model)},"#bz-fm-commandseditor-validations-editor .ui-widget-actions button click":function(){this.controller.createValidation(this.model)},".bz-fm-commandseditor-action .bz-fm-commandseditor-icons-delete click":function(e){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("formmodeler-component-delete-action-message"),"Bizagi","warning")).done(function(){var i=e.closest(".bz-fm-commandseditor-action").data("guid");t.model.deleteAction(i),t.refresh()})},".bz-fm-commandseditor-action .ui-comboBox-image-small-check click":function(e){var t=this.disableActionsView(e.parents("li"),e);this.updateEnabledAllChecked();var i=e.closest(".bz-fm-commandseditor-action").data("guid");this.model.changeActionStateEnabled(i,t)},"#bz-fm-commandseditor-actions-enable-all click":function(e){var t=this.element,i=t.find(".bz-fm-commandseditor-action"),o=t.find(".bz-fm-commandseditor-action .ui-comboBox-image-small-check"),r=e.is(":checked");this.disableAllActionsView(i,o,r),this.model.changeAllActionStateEnabled(r)},".bz-fm-commandseditor-validation .bz-fm-commandseditor-icons-delete click":function(e){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("formmodeler-component-delete-validation-message"),"Bizagi","warning")).done(function(){var i=e.closest(".bz-fm-commandseditor-validation").data("guid");t.model.deleteValidation(i),t.refresh(),$("#bz-fm-commandseditor-tabs",t.element).tabs("option","active",1)})},".bz-fm-commandseditor-validation .ui-comboBox-image-small-check click":function(e){var t=this.disableActionsView(e.parents("li"),e);this.updateEnabledAllChecked();var i=e.closest(".bz-fm-commandseditor-validation").data("guid");this.model.changeValidationStateEnabled(i,t)},"#bz-fm-commandseditor-validations-enable-all change":function(e){var t=this.element,i=t.find(".bz-fm-commandseditor-validation"),o=t.find(".bz-fm-commandseditor-validation .ui-comboBox-image-small-check"),r=e.is(":checked");this.disableAllActionsView(i,o,r),this.model.changeAllValidationStateEnabled(r)},loadTemplates:function(){var e=new $.Deferred;return $.when(this.loadTemplate("container",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-container"))).done(function(){e.resolve()}),e.promise()},loadTemplate:function(e,t){var i=this,o=new $.Deferred;return i.tmpl[e]?(o.resolve(i.tmpl[e]),o.promise()):bizagi.templateService.getTemplate(t).done(function(t){i.tmpl[e]=t})},getTemplate:function(e){return this.tmpl[e]?this.tmpl[e]:null},actionPositionHandlers:function(){var e=this,t=e.element,i=t.find(".bz-fm-commandseditor-icons-action-move-up"),o=t.find(".bz-fm-commandseditor-icons-action-move-down");i.click(function(){var t=$(this).closest(".bz-fm-commandseditor-action"),i=$(t).prev(),o=$(t).data("guid");e.model.moveActionUp(o),$(t).insertBefore(i)}),o.click(function(){var t=$(this).closest(".bz-fm-commandseditor-action"),i=$(t).next(),o=$(t).data("guid");e.model.moveActionDown(o),$(t).insertAfter(i)})},validationPositionHandlers:function(){var e=this,t=e.element,i=t.find(".bz-fm-commandseditor-icons-validation-move-up"),o=t.find(".bz-fm-commandseditor-icons-validation-move-down");o.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"}),i.tooltip({tooltipClass:"ui-widget-content ui-propertybox-tooltip"}),i.click(function(){var t=$(this).closest(".bz-fm-commandseditor-validation"),i=$(t).prev(),o=$(t).data("guid");e.model.moveValidationUp(o),$(t).insertBefore(i)}),o.click(function(){var t=$(this).closest(".bz-fm-commandseditor-validation"),i=$(t).next(),o=$(t).data("guid");e.model.moveValidationDown(o),$(t).insertAfter(i)})},initActionSearch:function(){var e=this,t=e.element,i=t.find("#bz-fm-commandseditor-actions-text-to-search"),o=t.find(".bz-fm-commandseditor-action"),r=t.find("#bz-fm-commandseditor-condition"),n=t.find("#bz-fm-commandseditor-statement"),a=t.find("#bz-fm-commandseditor-elsestatement");i.change(function(){e.showActionsFound(o,i)}),r.change(function(){e.showActionsFound(o,i)}),n.change(function(){e.showActionsFound(o,i)}),a.change(function(){e.showActionsFound(o,i)})},initValidationSearch:function(){var e=this,t=e.element,i=t.find("#bz-fm-commandseditor-validations-text-to-search"),o=t.find(".bz-fm-commandseditor-validation");i.change(function(){e.showValidationsFound(o,i)})},showActionsFound:function(e,t){var i=this.element,o=i.find("#bz-fm-commandseditor-condition").is(":checked")||!1,r=i.find("#bz-fm-commandseditor-statement").is(":checked")||!1,n=i.find("#bz-fm-commandseditor-elsestatement").is(":checked")||!1,a=t.val();if(a.length>2){e.hide(),a=a.toUpperCase();for(var s=0;s<e.length;s++){var l=$(e[s]).find("span.bz-fm-commandseditor-condition-xpath.biz-highlight-1-color"),d=$(e[s]).find("[data-section='then']").find("span.bz-fm-commandseditor-statement-xpath.biz-highlight-1-color"),c=$(e[s]).find("[data-section='else']").find("span.bz-fm-commandseditor-statement-xpath.biz-highlight-1-color");if(o)for(var u=0;u<l.length;u++)if($(l[u]).html().toUpperCase().indexOf(a)>-1){$(e[s]).show();break}if(r)for(var p=0;p<d.length;p++)if($(d[p]).html().toUpperCase().indexOf(a)>-1){$(e[s]).show();break}if(n)for(var m=0;m<c.length;m++)if($(c[m]).html().toUpperCase().indexOf(a)>-1){$(e[s]).show();break}}}else""===a&&e.show()},showValidationsFound:function(e,t){this.element;var i=t.val();if(i.length>2){e.hide(),i=i.toUpperCase();for(var o=0;o<e.length;o++)for(var r=$(e[o]).find("span.bz-fm-commandseditor-condition-xpath.biz-highlight-1-color"),n=0;n<r.length;n++)if($(r[n]).html().toUpperCase().indexOf(i)>-1){$(e[o]).show();break}}else""===i&&e.show()}}),bizagi.editor.component.controller("bizagi.editor.component.baseeditor",{init:function(e,t,i,o){this._super(),this.canvas=e,this.model=t,this.controller=i,this.mainContainer=o,this.tmpl={}},refresh:function(){var e=$(".bz-fm-actionvalidationeditor",this.element);this.scrollPosition=e.scrollTop(),this.render()},render:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.getTemplate("container");($.tmpl(i,e.model.getViewModel()).appendTo(t),e.configureSortablePlugin(),e.scrollPosition)&&$(".bz-fm-actionvalidationeditor",e.element).scrollTop(e.scrollPosition)})},".bz-fm-commandseditor-condition-logicOperator click":function(e){var t=e.data("parent-expression");this.displayLogicOperators(e,t)},".bz-fm-commandseditor-condition-xpath click":function(e){var t=e.closest(".bz-fm-commandseditor-condition").data("guid");this.displayExpressionControls(e,t)},".bz-fm-commandseditor-condition-operator click":function(e){var t=e.closest(".bz-fm-commandseditor-condition").data("guid");this.displayOperators(e,t)},".bz-fm-commandseditor-condition-argument click":function(e){var t=e.closest(".bz-fm-commandseditor-condition").data("guid");this.displayExpressionArgument(e,t)},".bz-fm-commandseditor-condition-new click":function(e){var t=e.closest(".bz-fm-commandseditor-button-bar").data("complex-guid");this.model.addExpression(t),this.refresh()},".bz-fm-commandseditor-btn-complex click":function(e){var t=e.closest(".bz-fm-commandseditor-button-bar").data("complex-guid");return this.model.addComplexExpression(t),this.refresh(),!1},".bz-fm-commandseditor-condition .bz-fm-commandseditor-icons-delete click":function(e){var t=e.closest(".bz-fm-commandseditor-complex").closest(".bz-fm-commandseditor-condition").data("guid"),i=e.closest(".bz-fm-commandseditor-condition").data("guid");this.model.removeExpression(i,t),this.refresh()},".bz-fm-commandseditor-button-ok click":function(){var e=this.model.validate();if(e.isValid)this.publish("save",{model:this.model.getData()});else{this.refresh();var t=e.message?e.message:bizagi.localization.getResource("formmodeler-component-commandseditor-validate-requiredfields");bizagi.showMessageBox(t,"Bizagi","error",!1)}},".bz-fm-commandseditor-button-cancel click":function(){this.publish("cancel",{model:this.model})},displayExpressionControls:function(e,t){var i=this,o=i.model.getControls({appliesToRender:!0,exclude:["undefined","activityFlowButton","image"],checkContext:!0}),r=i.model.fullModel.resolveCommand(i.model.getExpression(t)),n=i.displayList(o,r,!0);n.position({my:"left top",at:"left bottom",of:e,collision:"fit flip"}),n.find("li").click(function(){var e=$(this).data("value"),o=i.model.getPropertyToUpdate(e);i.model.updateExpression(t,o,e,"xpath"!=o),i.refresh(),n.detach()})},displayOperators:function(e,t){var i=this,o=i.model.getOperators(t),r=i.model.getExpression(t).operator,n=i.displayList(o,r);n.position({my:"left top",at:"left bottom",of:e,collision:"fit flip"}),n.find("li").click(function(){var e=$(this).data("value");i.model.updateExpression(t,"operator",e),i.refresh(),n.detach()})},displayLogicOperators:function(e,t){var i=this,o=i.model.getLogicOperators(),r=i.model.getLogicOperator(t),n=i.displayList(o,r);n.position({my:"left top",at:"left bottom",of:e,collision:"none"}),n.find("li").click(function(){var e=$(this).data("value");i.model.updateLogicOperator(t,e),i.refresh(),n.detach()})},displayExpressionArgument:function(e,t){var i,o=this,r=o.model.getExpression(t).argument,n=o.model.getExpressionType(t),a=o.model.getExpression(t).xpath;(i=o.getConstantEditor(e,r,a,n,t))&&(i.render(),i.subscribe("valuechanged",function(e,r){o.model.updateExpression(t,"argument",r.value),o.model.updateExpression(t,"argumentType",r.argumentType),i.close(),o.refresh()}))},getConstantEditor:function(e,t,i,o,r){var n={templates:this.tmpl,element:e,xpath:i,value:t,mainEditor:this,mainContainer:this.mainContainer,id:r};return"boolean"==o?new bizagi.editor.component.constantargument.boolean(n):"string"==o?new bizagi.editor.component.constantargument.string(n):"date"==o?new bizagi.editor.component.constantargument.date(n):"number"==o?new bizagi.editor.component.constantargument.number(n):"entity"==o?new bizagi.editor.component.constantargument.valuepicker(n):"color"==o?new bizagi.editor.component.constantargument.color(n):"rule"==o?new bizagi.editor.component.constantargument.rule(n):"interface"==o?new bizagi.editor.component.constantargument.interface(n):"sap"==o?new bizagi.editor.component.constantargument.sap(n):"connector"==o?new bizagi.editor.component.constantargument.connector(n):"excelBot"==o?new bizagi.editor.component.constantargument.excelbot(n):null},displayList:function(e,t,i){var o=i?this.getTemplate("controlslist"):this.getTemplate("list"),r=$.tmpl(o,{list:e,currentValue:t});return r.appendTo(this.mainContainer,document),setTimeout(function(){r.click(function(e){e.stopPropagation()}),$(document).one("click",function(){r.detach()})},100),r},configureSortablePlugin:function(){},loadTemplates:function(){}}),bizagi.editor.observableClass.extend("bizagi.editor.component.constantargument.editor",{},{init:function(e){this._super(),this.templates=e.templates,this.element=e.element,this.xpath=e.xpath,this.value=e.value,this.mainEditor=e.mainEditor,this.model=e.mainEditor.model,this.displayXpathControls=!0,this.mainContainer=e.mainContainer,this.id=e.id},render:function(){var e=this,t=e.templates.argument,i=e.editor=$.tmpl(t);i.appendTo($(e.mainContainer,document));var o=$(".bz-fm-commandseditor-argument-editor",i);$.when(e.internalRender(o)).done(function(t){e.control=t}),e.displayXpathControls?i.find(".bz-fm-commandseditor-argument-xpath").click(function(){e.displayControls($(this))}):i.find(".bz-fm-commandseditor-argument-xpath").hide()},displayControls:function(e){var t=this,i=t.model.getControl(t.xpath),o=t.model.getControl(t.value),r=[];i&&r.push(i.type);var n={appliesToRender:!0,filterBy:r};i.relatedEntity&&$.extend(n,{filterByRelatedEntity:!0,relatedEntity:i.relatedEntity});var a=t.model.getControls(n),s=t.controlsList=t.mainEditor.displayList(a,o?o.xpath:null,!0);s.position({my:"right top",at:"right bottom",offset:"4 0",of:e,collision:"none"}),s.find("li").click(function(){var e=$(this).data("value");t.changeValue(e,"xpath")}),setTimeout(function(){s.click(function(e){e.stopPropagation()}),$(document).one("click",function(){s.detach()})},100)},floatElement:function(){var e=this,t=e.editor;t.position({my:"left top",at:"left top",of:e.element,offset:" 0 -6"}),setTimeout(function(){t.click(function(e){e.stopPropagation()}),$(document).one("click",function(){e.close()})},100),e.element.hide()},changeValue:function(e,t){t=t||"const",this.publish("valuechanged",{value:e,argumentType:t})},localizableEditor:function(e){this.publish("launchLocalizableEditor",{value:e})},close:function(){$(document).unbind("click"),this.editor&&this.editor.detach(),this.controlsList&&this.controlsList.detach(),this.element.show()}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.boolean",{},{internalRender:function(e){var t=this,i=t.templates.boolean,o=$.tmpl(i,{value:t.value});return o.appendTo(e),t.floatElement(),o.find("span").click(function(){var e=bizagi.util.parseBoolean($(this).data("value"));t.changeValue(e)}),o}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.string",{},{internalRender:function(e){var t=this,i=t.templates.string,o=$.tmpl(i,{value:t.value});o.appendTo(e),t.floatElement();var r=o.find("input");return r.focus(),r.change(function(){r.unbind("change");var e=$(this).val();0==e.length&&(e=null),t.changeValue(e)}),r.keyup(function(e){if(13==e.which){var i=$(this).val();0==i.length&&(i=null),t.changeValue(i)}}),o}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.textarea",{},{init:function(e){this._super(e),this.displayXpathControls=!1},internalRender:function(e){var t=this,i=t.templates.textarea,o=$.tmpl(i,{value:t.value});o.appendTo(e),t.floatElement();var r=o.find("textarea");r.focus(),r.keyup(function(e){if(13==e.which){var i=$(this).val();0==i.length&&(i=null),t.changeValue(i)}}),t.bindChangeEventElement(r);var n=o.find("i");return n.bind("click",function(e){t.localizableEditor(r.val())}),n.bind("mouseenter",function(){r.unbind("change")}),n.bind("mouseleave",function(){t.bindChangeEventElement(r)}),o},bindChangeEventElement:function(e){var t=this;e.bind("change",function(e){var i=$(this).val();0==i.length&&(i=null),t.changeValue(i)})}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.date",{},{internalRender:function(e){var t,i=this,o=i.templates.date,r=i.dateControl=$.tmpl(o,{value:i.value});r.appendTo(e),i.floatElement();try{t=bizagi.util.dateFormatter.getDateFromInvariant(i.value,!1)}catch(e){t=null}return r.find("div").datepicker({defaultDate:t,onSelect:function(e,t){var o=e;0==o.length&&(o=null),i.changeValue(o)}}),r},displayControls:function(e){this._super(e),this.dateControl&&this.dateControl.css("opacity",.2)}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.number",{},{internalRender:function(e){var t=this,i=t.templates.number,o=t.formatValue(t.value),r=$.tmpl(i,{value:o});r.appendTo(e),t.floatElement();var n=r.find("input");return n.numeric("."),n.focus(),n.change(function(){n.unbind("change");var e=$(this).val();0==e.length&&(e=null),t.changeValue(e)}),n.keyup(function(e){if(13==e.which){var i=$(this).val();0==i.length&&(i=null),t.changeValue(i)}}),r},formatValue:function(){return $("<label/>").html(this.value||0).asNumber()}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.entity",{},{internalRender:function(e){var t=new $.Deferred;$(".bz-fm-commandseditor-argument-editor-name",e.parent()).remove();var i=this.templates.message,o=this.model.getControl(this.xpath),r=bizagi.localization.getResource("formmodeler-component-commandseditor-argumenttype-message").replace("{0}","").split(","),n=this.message=$.tmpl(i,{preValue:r[0],entity:o.label,postValue:r[1]});return n.appendTo(e),this.floatElement(),t.resolve(n),t.promise()},displayControls:function(e){this._super(e),this.entityList&&this.entityList.css("opacity",.2)}}),bizagi.editor.component.constantargument.entity.extend("bizagi.editor.component.constantargument.valuepicker",{},{internalRender:function(e){var t=this,i=(new $.Deferred,t._super.bind(t)),o={message:bizagi.localization.getResource("formmodeler-component-wait-message-loading-form")},r=new bizagi.editor.component.wait.presenter({model:o,renderArea:$("body")}),n=bizagi.editor.utilities.resolveContextEntityFromXpath(t.xpath)||bizagi.editor.utilities.resolveScopeContextFromXpath(t.xpath),a=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"entityvaluepicker",contextEntityId:n,xpath:bizagi.editor.utilities.resolveComplexXpath(t.xpath)}),s=bizagi.editor.utilities.buildComplexReference;$.when(r.render(),a.processRequest()).done(function(o,n){if(r.destroy(),n.success){if("selectedValue"===n.key){var a={isBusinessKey:!0,businessKeyValues:n.businessKeyValues.map(function(e){return{columnId:s(e.id),columnName:e.columnName,value:e.value}}),contextEntity:s(n.contextEntity),entityValueGuid:n.surrogateKeyGuid,label:n.label};t.changeValue(a,"entity")}}else if("noParameter"===n.key)return i(e)})}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.color",{},{init:function(e){this._super(e),this.displayXpathControls=!1},internalRender:function(e){var t=this,i=t.templates.color,o=$.tmpl(i,{value:t.value});return o.appendTo(e),o.find("input").spectrum({flat:!0,color:t.value,preferredFormat:"hex",showInput:!0,cancelResponse:function(e){e.flat=!1,o.find("input").spectrum("destroy"),o.closest(".bz-fm-commandseditor-argument").remove(),t.element.show()},showPalette:!0,palette:[["black","white","red","orange"],["yellow","green","blue","purple"]],chooseText:bizagi.localization.getResource("formmodeler-component-commandseditor-ok"),cancelText:bizagi.localization.getResource("formmodeler-component-commandseditor-cancel"),change:function(e){var i=e.toName()||"#"+e.toHex();t.changeValue(i)}}),t.floatElement(),o}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.rule",{},{render:function(){var e=this,t=e.model,i={rule:{baref:{ref:"expression"}}};bizagi.editor.utilities.isObject(e.value)&&(bizagi.editor.utilities.isObject(e.value.rule)?i={rule:e.value.rule}:e.value.guid&&(i={rule:{baref:{ref:e.value.guid}}}));var o=null;if(t.isGridContext()){var r=t.getContextAction().value;o=t.getControl(r).baxpath}var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"ruleexpression",categorytype:"Scripting",type:"executerule",idcontextentity:o?bizagi.editor.utilities.resolveRelatedEntityFromXpath(o):null,data:i,editor:"rule"});$.when(n.processRequest()).done(function(t){if(t){var i=t.displayName;delete t.displayName,e.changeValue({rule:t,label:i})}})}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.interface",{},{render:function(){var e=this,t=e.model,i={interface:{baref:{ref:"expression"}}};bizagi.editor.utilities.isObject(e.value)&&(bizagi.editor.utilities.isObject(e.value.interface)?i={interface:e.value.interface}:e.value.guid&&(i={interface:{baref:{ref:e.value.guid}}}));var o=null;if(t.isGridContext()){var r=t.getContextAction().value;o=t.getControl(r).baxpath}var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadinterface",type:"executerule",idcontextentity:o?bizagi.editor.utilities.resolveRelatedEntityFromXpath(o):null,idscopedefinition:o?bizagi.editor.utilities.resolveContextEntityFromXpath(o):null,data:i});$.when(n.processRequest()).done(function(t){if(t){var i=t.displayName||"Interface";delete t.displayName,e.changeValue({interface:t,label:i})}})}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.sap",{},{render:function(){var e=this,t=e.model,i={interface:{baref:{ref:"expression"}}};bizagi.editor.utilities.isObject(e.value)&&(bizagi.editor.utilities.isObject(e.value.interface)?i={interface:e.value.interface}:e.value.guid&&(i={interface:{baref:{ref:e.value.guid}}}));var o=null;if(t.isGridContext()){var r=t.getContextAction().value;o=t.getControl(r).baxpath}var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadsapinterface",type:"rule",idcontextentity:o?bizagi.editor.utilities.resolveRelatedEntityFromXpath(o):null,idscopedefinition:o?bizagi.editor.utilities.resolveContextEntityFromXpath(o):null,data:i});$.when(n.processRequest()).done(function(t){if(t){var i=t.displayName||"sap interface";delete t.displayName,e.changeValue({interface:t,label:i})}})}}),bizagi.editor.component.constantargument.editor.extend("bizagi.editor.component.constantargument.connector",{},{render:function(e){var t=this,i=t.model,o={connector:{baref:{ref:"expression"}}};e=e||"loadconnectorinterface",bizagi.editor.utilities.isObject(t.value)&&(bizagi.editor.utilities.isObject(t.value.connector)?o={connector:t.value.connector}:t.value.guid&&(o={connector:{baref:{ref:t.value.guid}}}));var r=null;if(i.isGridContext()){var n=i.getContextAction().value;r=i.getControl(n).baxpath}e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:e,type:"rule",idcontextentity:r?bizagi.editor.utilities.resolveRelatedEntityFromXpath(r):null,idscopedefinition:r?bizagi.editor.utilities.resolveContextEntityFromXpath(r):null,data:o});$.when(e.processRequest()).done(function(e){if(e){var i=e.displayName||"connector interface";delete e.displayName,t.changeValue({connector:e,label:i})}})}}),bizagi.editor.component.constantargument.connector.extend("bizagi.editor.component.constantargument.excelbot",{},{render:function(){this._super("loadexcelbotinterface")}}),bizagi.editor.observableClass.extend("bizagi.editor.component.baseeditor.model",{argumentTypes:{const:"formmodeler-component-commandseditor-argumenttype-constant",xpath:"formmodeler-component-commandseditor-argumenttype-xpath"}},{init:function(e,t){this.logicOperators=bizagi.editor.component.commandseditor.model.logicOperators,this.data=e,this.fullModel=t,this.expressions={}},resolveXpath:function(e){return this.fullModel.resolveXpath(e)},resolveCommand:function(e){return this.fullModel.resolveCommand(e)},getPropertyToUpdate:function(e){var t="xpath",i=this.fullModel.data.controls[e];return i&&i.propertyToUpdate&&(t=i.propertyToUpdate),t},getData:function(){return this.data},getControl:function(e){return e?(e=bizagi.editor.utilities.resolveComplexXpath(e),this.fullModel.getControls()[e]):null},getControls:function(e){var t=this.fullModel.getControls(),i={},o=(e=e||{}).appliesToRender||!1,r=e.appliesToContainer||!1,n=e.filterBy||null,a=e.exclude||null,s=e.checkContext||!1,l=e.filterByRelatedEntity||!1,d=null;for(var c in l&&(d=e.relatedEntity),e.checkGridContainer&&this.areThereGridAttributes(),t){var u=t[c],p=u.render,m=u.container,h=u.type,g=u.xpathContainer,f=!1;if(o&&p&&(f=!0),r&&m&&(f=!0),n){f=!1;for(var b=0;b<n.length;b++)if(n[b]==h){f=!0;break}}if(f&&a)for(b=0;b<a.length;b++)if(a[b]==h){f=!1;break}if(f&&s&&this.isGridContext())g!==this.getContextAction().value&&(f=!1);f&&(l?d===u.relatedEntity&&(i[c]={label:t[c].label,type:t[c].controlType,style:t[c].style}):i[c]={label:t[c].label,type:t[c].controlType,style:t[c].style})}return i},getOperators:function(e){var t={},i=this.getExpressionType(e);for(var o in this.operators){for(var r=!1,n=this.operators[o],a=0;a<n.appliesTo.length;a++)if(n.appliesTo[a]==i){r=!0;break}r&&(t[o]=bizagi.localization.getResource(n.label))}return t},getLogicOperators:function(){var e={};for(var t in this.logicOperators){var i=this.logicOperators[t];e[t]=bizagi.localization.getResource(i)}return e},getLogicOperator:function(e){var t=this.data;return e?this.expressions[e].complex.conditions.operator:t.conditions.operator},getExpression:function(e){return this.expressions[e].simple},getExpressionType:function(e){var t=this.expressions[e];return this.fullModel.getXpath(this.resolveXpath(this.getXpathExpression(t.simple))).type},getViewModel:function(){for(var e=this.data,t={hasErrors:!this.validate(),guid:e.guid,conditions:{expressions:[]}},i=0;i<e.conditions.expressions.length;i++){var o=i>0?this.fullModel.getLogicOperatorName(e.conditions.operator):null;t.conditions.expressions.push(this.getViewExpression(e.conditions.expressions[i],null,o))}return t},getViewExpression:function(e,t,i){var o=this;e.guid=e.guid||Math.guid(),o.expressions[e.guid]=e;var r={simple:e.simple?{xpath:{label:o.fullModel.getXpathName(o.resolveXpath(o.getXpathExpression(e.simple))),value:o.resolveXpath(e.simple.xpath)},operator:{label:o.getOperatorName(e.simple.operator),value:e.simple.operator,isUnary:o.isUnaryOperator(e.simple.operator)},argument:{label:o.fullModel.getArgumentName(e.simple.argument,e.simple.argumentType),value:e.simple.argument&&e.simple.argument.value?e.simple.argument.value:e.simple.argument},argumentType:e.simple.argumentType}:null,complex:e.complex?{conditions:{expressions:[]}}:null,logicOperator:i,parentGuid:t,guid:e.guid};if(e.complex)for(var n=0;n<e.complex.conditions.expressions.length;n++){var a=n>0?o.fullModel.getLogicOperatorName(e.complex.conditions.operator):null;r.complex.conditions.expressions.push(o.getViewExpression(e.complex.conditions.expressions[n],e.guid,a))}return r},getXpathExpression:function(e){return this.fullModel.getXpathExpression(e)},getOperatorName:function(e){return bizagi.localization.getResource(this.fullModel.getOperatorName(e,"action"))},getXpathContainer:function(){return this.xpathContainer||null},isUnaryOperator:function(e){return this.fullModel.isUnaryOperator(e,"action")},isGridContext:function(){return!1},areThereGridAttributes:function(){return!1},updateExpression:function(e,t,i,o){var r=this.expressions[e];if("xpath"==t){var n=this.getControl(i);r.simple[t]=n.baxpath,r.simple.xpathContainer=n.xpathContainer,delete r.simple.operator,delete r.simple.argument,r.simple.propertyToUpdate&&(delete r.simple[r.simple.propertyToUpdate],delete r.simple.propertyToUpdate)}else o?(n=this.getControl(i),r.simple[t]=n[t],r.simple.propertyToUpdate=t,delete r.simple.operator,delete r.simple.argument,delete r.simple.xpath):r.simple[t]=i},updateLogicOperator:function(e,t){var i=this.data;(e?this.expressions[e].complex.conditions:i.conditions).operator=t},addExpression:function(e){var t=this.data,i=e?this.expressions[e].complex.conditions.expressions:t.conditions.expressions,o=Math.guid(),r={simple:{operator:null,xpath:null,argument:null,argumentType:"const",guid:o}};i.push(r),this.expressions[o]=r},addComplexExpression:function(e){var t=this.data,i=e?this.expressions[e].complex.conditions.expressions:t.conditions.expressions,o=Math.guid(),r={complex:{conditions:{operator:"and",expressions:[{simple:{operator:null,xpath:null,argument:null,argumentType:"const",guid:o}}]}}};i.push(r),this.expressions[o]=r},removeExpression:function(e,t){var i=this.data,o=t?this.expressions[t].complex.conditions.expressions:i.conditions.expressions;delete this.expressions[e];for(var r=-1,n=0;n<o.length;n++)if(o[n].guid==e){r=n;break}r>=0&&o.splice(r,1)},setXpathContainer:function(e){this.xpathContainer=e},validate:function(e){var t=this.data,i={isValid:!0};if(this.setXpathContainer(null),0==t.conditions.expressions.length)return!1;for(var o=0;o<t.conditions.expressions.length;o++)if(!(i=this.validateExpression(t.conditions.expressions[o],e)).isValid)return i;return i},validateExpression:function(e,t){var i=this.getXpathContainer(),o={isValid:!0};if(e.simple){var r=this.getXpathExpression(e.simple);if(null==r||0==r.length)return{isValid:!1};if(null==e.simple.operator||0==e.simple.operator.length)return{isValid:!1};if(!this.fullModel.isUnaryOperator(e.simple.operator,t)&&(null==e.simple.argument||0==e.simple.argument.length))return{isValid:!1};if(null!=(i=null==i?e.simple.xpathContainer||null:i)&&null!=e.simple.xpathContainer&&i!==e.simple.xpathContainer)return{isValid:!1,message:bizagi.localization.getResource("formmodeler-component-commandseditor-validate-invalidcondition")};this.setXpathContainer(i)}else{if(0==e.complex.conditions.expressions.length)return{isValid:!1};for(var n=0;n<e.complex.conditions.expressions.length;n++)if(!(o=this.validateExpression(e.complex.conditions.expressions[n],t)).isValid)return{isValid:!1}}return o}}),bizagi.editor.component.baseeditor("bizagi.editor.component.actioneditor",{init:function(e,t,i,o){this._super(e,t,i,o)},".bz-fm-commandseditor-statement-command click":function(e){var t=e.closest(".bz-fm-commandseditor-statement").data("guid");this.displayCommands(e,t)},".bz-fm-commandseditor-statement-xpath click":function(e){var t=e.closest(".bz-fm-commandseditor-statement").data("guid");this.displayStatementControls(e,t)},".bz-fm-commandseditor-statement-argument click":function(e){var t=this,i=e.closest(".bz-fm-commandseditor-statement").data("guid");(void 0===t.model.isOpen||t.model.isOpen)&&t.displayStatementArgument(e,i),t.model.isOpen=!1,setTimeout(function(){t.model.isOpen=!0},1e3)},".bz-fm-commandseditor-statement-new click":function(e){var t=e.closest(".bz-fm-commandseditor-statements").data("section");this.model.addStatement(t),this.refresh()},".bz-fm-commandseditor-statement .bz-fm-commandseditor-icons-delete click":function(e){var t=e.closest(".bz-fm-commandseditor-statements").data("section"),i=e.closest(".bz-fm-commandseditor-statement").data("guid");this.model.removeStatement(i,t),this.refresh()},".bz-fm-commandseditor-statements-else-action click":function(e){this.displayElseActions(e)},".bz-fm-commandseditor-context-control click":function(e){this.displayContextControls(e)},displayContextControls:function(e){var t=this,i=t.model.getControls({appliesToRender:!0,filterBy:["collection"]});i.Form={label:"Form",type:"form",style:"bz-studio bz-forms_16x16_standard"};var o=t.displayList(i,t.model.getContextAction().value,!0);o.position({my:"left top",at:"left bottom",of:e,collision:"fit flip"}),o.find("li").click(function(){var e=$(this).data("value");t.model.updateContext(e),t.refresh(),o.detach()})},displayStatementControls:function(e,t){var i=this,o=i.model.fullModel.resolveCommand(i.model.getStatement(t)),r=i.model.getStatementCommand(t);if(null!=r){var n=i.model.getControls(r),a=i.displayList(n,o,!0);a.position({my:"left top",at:"left bottom",of:e,collision:"fit flip"}),a.find("li").click(function(){var e=$(this).data("value"),o=i.model.getPropertyToUpdate(e);i.model.updateStatement(t,o,e,"xpath"!==o),i.model.updateButtonsStatement(t,e),i.refresh(),a.detach()})}},displayStatementArgument:function(e,t){var i,o=this,r=o.model.getStatement(t).argument,n=o.model.getStatementType(t),a=o.model.getStatement(t).xpath;(i=o.getConstantEditor(e,r,a,n,t))&&(i.subscribe("valuechanged",function(e,r){o.model.updateStatement(t,"argument",r.value),o.model.updateStatement(t,"argumentType",r.argumentType),i.close(),o.refresh()}),i.render())},displayCommands:function(e,t){var i=this,o=i.model.getCommands(t),r=i.model.getStatement(t).command,n=i.displayList(o,r);n.position({my:"left top",at:"left bottom",of:e,collision:"fit flip"}),n.find("li").click(function(){var o=$(this).data("value");i.model.updateStatement(t,"command",o);var r=bizagi.editor.component.commandseditor.actioncommands.factory.createCommand({command:o,guid:t,model:i.model,controller:i,section:e.closest(".bz-fm-commandseditor-statements").data("section")});r&&r.execute(),i.refresh(),n.detach()})},displayElseActions:function(e){var t=this,i=t.model.getElseActions(),o=t.model.getElseAction(),r=t.displayList(i,o);r.position({my:"left top",at:"left bottom",of:e,collision:"none"}),r.find("li").click(function(){var e=$(this).data("value");t.model.updateElseAction(e),t.refresh(),r.detach()})},configureSortablePlugin:function(){var e=this,t=$(".bz-fm-commandseditor-statements",e.element);t.bind("sortstart",function(t,i){e.onSortStart(i)}),t.bind("sortstop",function(t,i){e.onSortFinish(i)}),t.sortable({items:".bz-fm-commandseditor-item",revert:!1,distance:10,cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-placeholder",delay:150}).disableSelection()},onSortStart:function(e){var t=$(e.item).parent().children(".bz-fm-commandseditor-item").index(e.item);e.item.data("start-position",t)},onSortFinish:function(e){var t=$(e.item).parent().children(".bz-fm-commandseditor-item").not(".ui-sortable-placeholder").index(e.item),i=e.item.data("start-position"),o=e.item.closest(".bz-fm-commandseditor-statements").data("section");this.model.sortCommands({finalPosition:t,initialPosition:i,section:o})},loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("container",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-action")),e.loadTemplate("list",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-list")),e.loadTemplate("controlslist",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-controls-list")),e.loadTemplate("argument",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument")),e.loadTemplate("boolean",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-boolean")),e.loadTemplate("string",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-string")),e.loadTemplate("textarea",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-textarea")),e.loadTemplate("date",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-date")),e.loadTemplate("number",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-number")),e.loadTemplate("color",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-color")),e.loadTemplate("rule",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-rule")),e.loadTemplate("interface",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-interface")),e.loadTemplate("message",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-message"))).done(function(){t.resolve()}),t.promise()}}),bizagi.editor.component.baseeditor.model.extend("bizagi.editor.component.actioneditor.model",{action:"action"},{init:function(e,t){this._super(e,t),this.operators=bizagi.editor.component.commandseditor.model.operators.action,this.actionCommands=bizagi.editor.component.commandseditor.model.actionCommands,this.elseActions=bizagi.editor.component.commandseditor.model.elseActions,this.statements={},this.context=null},getData:function(){var e=this.data,t=[];if(0==e.conditions.expressions.length)return!1;for(var i=0;i<e.conditions.expressions.length;i++)this.findDependencies(e.conditions.expressions[i],t);return e.dependencies=t,e.context=this.context,e},getSelectedCommands:function(){return this.data.commands},getCommands:function(){var e={};for(var t in this.actionCommands)this.actionCommands[t].hidden||(e[t]=bizagi.localization.getResource(this.actionCommands[t].label));return e},getStatement:function(e){return this.statements[e]},getStatementType:function(e){var t=this.statements[e];if(bizagi.util.isEmpty(t.command))return null;var i=this.actionCommands[t.command].type;if("argument"==i){if(bizagi.util.isEmpty(this.resolveXpath(t.xpath)))return null;i=this.fullModel.getXpath(this.resolveXpath(t.xpath)).type}return i},getStatementCommand:function(e){for(var t=this.statements[e],i=this.actionCommands[t.command],o={label:i?i.label:"",filterBy:i.filterBy,exclude:i.exclude,checkContext:!0,checkGridContainer:!0},r=0;r<i.appliesTo.length;r++)"render"==i.appliesTo[r]&&(o.appliesToRender=!0),"container"==i.appliesTo[r]&&(o.appliesToContainer=!0);return o},getStatementProperty:function(e){var t=this.statements[e];return t&&t.propertyToUpdate?t.propertyToUpdate:"xpath"},haveAllCommandsReverse:function(){var e=this.getSelectedCommands();for(i=0;i<e.length;i++){var t=e[i].command;if(null!=t&&!this.actionCommands[t].hasReverse)return!1}return!0},verifyFormHasReverse:function(){return this.fullModel.data.flags.EnableShowAlwaysReverseAction||this.fullModel.data.enableReverse},getElseActions:function(){var e={};for(var t in this.elseActions)e[t]=bizagi.localization.getResource(this.elseActions[t]);return(!this.verifyFormHasReverse()||this.verifyFormHasReverse()&&!this.haveAllCommandsReverse())&&delete e.automatic,e},getElseAction:function(){return this.fullModel.getElseActionType(this.data)},getXpathName:function(e){return this.fullModel.getXpathName(e)},getContextAction:function(){this.context=this.context||this.data.context;var e=this.context;return e?{label:this.getXpathName(e)||e,value:e}:{label:"Form",value:"Form"}},getViewModel:function(){for(var e=this.data,t=this.getElseAction(),i=$.extend(this._super(),{commands:[],elseCommands:e.elseCommands?[]:void 0,elseAction:{label:bizagi.localization.getResource(this.elseActions[t]),value:t},context:this.getContextAction()}),o=0;o<e.commands.length;o++)i.commands.push(this.getViewCommand(e.commands[o]));if(i.elseCommands)for(var r=0;r<e.elseCommands.length;r++)i.elseCommands.push(this.getViewCommand(e.elseCommands[r]));return i},getViewCommand:function(e){var t=this;return e.guid=e.guid||Math.guid(),t.statements[e.guid]=e,{xpath:{label:t.fullModel.getXpathName(t.resolveCommand(e)),value:t.resolveCommand(e)},command:{label:bizagi.localization.getResource(t.fullModel.getCommandName(e.command)),value:e.command,isUnary:t.fullModel.isUnaryCommand(e.command),isOnlyCommand:t.fullModel.isOnlyCommand(e.command),isOnlyArgument:t.fullModel.isOnlyArgument(e.command),hidden:t.fullModel.isHiddenCommand(e.command)},argument:{label:t.fullModel.getArgumentName(e.argument,e.argumentType),value:e.argument&&e.argument.value?e.argument.value:e.argument},guid:e.guid}},updateStatement:function(e,t,i,o){var r=this.statements[e];if(this.removeAttributesStatement(r,t,o),"xpath"==t){var n=this.getControl(i);r[t]=n.baxpath,r.xpathContainer=n.xpathContainer}else r[t]=i,o&&(r.propertyToUpdate=t)},updateButtonsStatement:function(e,t){var i=this.statements[e],o=this.fullModel.data.controls[t];"activityFlowButton"===o.controlType&&(i.controlType=o.controlType)},addStatement:function(e){var t=this.data,i="then"==e?t.commands:t.elseCommands,o=Math.guid(),r={xpath:null,command:null,argument:null,argumentType:"const",guid:o};i.push(r),this.statements[o]=r},removeStatement:function(e,t){var i=this.data,o="then"==t?i.commands:i.elseCommands,r=this.statementhasDependencies(this.statements[e]);delete this.statements[e];var n=this.findCommandPosition(e,t);n>=0&&o.splice(n,1),r&&this.removeSubmitDataStatement(o,t)},statementhasDependencies:function(e){return"execute-rule"==e.command||"refresh"==e.command||"execute-interface"==e.command||"execute-connector"==e.command||"execute-excel-bot"==e.command},removeSubmitDataStatement:function(e,t){var i=-1;if(0===$.grep(e,function(e,t){return"execute-rule"==e.command||"refresh"==e.command||"execute-interface"==e.command||"execute-connector"==e.command||"execute-excel-bot"==e.command}).length){for(var o=0;o<e.length;o++)if("submit-data"==e[o].command){i=o;break}i>=0&&this.removeStatement(e[i].guid,t)}},removeAttributesStatement:function(e,t,i){"command"==t&&(delete e.argument,delete e.xpath,delete e.xpathContainer),i&&delete e.xpath,("command"==t||"xpath"==t||i)&&e.propertyToUpdate&&(delete e[e.propertyToUpdate],delete e.propertyToUpdate)},updateElseAction:function(e){var t=this.data;this.getElseAction()!=e&&(t.elseAction=e,t.elseCommands="automatic"==e?void 0:[])},isGridContext:function(){return"string"==typeof this.context&&"Form"!=this.context},areThereGridAttributes:function(){var e=!1;if(bizagi.editor.utilities.isObject(this.data.conditions)&&$.isArray(this.data.conditions.expressions))for(var t=this.data.conditions.expressions,i=0,o=t.length;i<o;i++){var r=this.findGridContainer(t[i]);if("string"==typeof r){this.gridContainer=r,e=!0;break}}return e},findGridContainer:function(e){var t=null;if(e.simple)t=e.simple.xpathContainer;else if(e.complex&&e.complex.conditions.expressions.length>0)for(var i=0;i<e.complex.conditions.expressions.length&&"string"!=typeof(t=this.findGridContainer(e.complex.conditions.expressions[i]));i++);return t},getGridContainer:function(){return this.gridContainer||null},validate:function(){var e=this.data,t=this._super(this.Class.action);if(!t.isValid)return t;0==e.commands.length&&(t.isValid=!1);for(var i=0;i<e.commands.length;i++)if(!(t=this.validateCommand(e.commands[i])).isValid)return t;if(e.elseCommands)for(var o=0;o<e.elseCommands.length;o++)if(!(t=this.validateCommand(e.elseCommands[o])).isValid)return t;return t},updateContext:function(e){this.context!=e&&(this.context=e,this.cleanModel())},cleanModel:function(){this.data.commands=[],this.data.elseCommands=[],this.data.conditions.expressions=[],this.data.conditions.operator="and",this.statements={}},validateCommand:function(e){var t=this.getStatementProperty(e.guid);return this.fullModel.isOnlyCommand(e)?{isValid:!0}:(this.fullModel.isOnlyArgument(e)||null!=e[t]&&0!=e[t].length)&&(this.fullModel.isUnaryCommand(e)||null!=e.argument&&0!=e.argument.length)?{isValid:!0}:{isValid:!1}},findDependencies:function(e,t){if(e.simple){if(e.simple.xpath&&t.push(e.simple.xpath),e.simple.propertyToUpdate&&t.push(e.simple[e.simple.propertyToUpdate]),e.simple.argument&&"xpath"==e.simple.argumentType){var i=this.getControl(e.simple.argument);i&&i.baxpath&&t.push(i.baxpath)}}else if(e.complex.conditions.expressions.length>0)for(var o=0;o<e.complex.conditions.expressions.length;o++)this.findDependencies(e.complex.conditions.expressions[o],t)},findCommandPosition:function(e,t){for(var i=this.data,o="then"==t?i.commands:i.elseCommands,r=-1,n=0,a=o.length;n<a;n++)if(o[n].guid==e){r=n;break}return r},sortCommands:function(e){var t=this.data,i="then"==e.section?t.commands:t.elseCommands;i.move(e.initialPosition,e.finalPosition),this.statementhasDependencies(i[e.finalPosition])&&this.moveSubmitDataStatement(i,e.finalPosition)},moveSubmitDataStatement:function(e,t){for(var i=-1,o=0,r=e.length;o<r;o++)if("submit-data"==e[o].command){i=o;break}i>t&&e.move(i,t)}}),bizagi.editor.component.actioneditor.model.extend("bizagi.editor.component.actioneditor.offline.model",{},{init:function(e,t){this._super(e,t),this.actionCommands=bizagi.editor.component.commandseditor.offline.model.actionCommands}}),bizagi.editor.observableClass.extend("bizagi.editor.component.commandseditor.actioncommands.base",{},{init:function(e){e=e||{},this._super(),this.args=e,this.model=e.model,this.data=this.model.data,this.controller=e.controller},execute:function(){}}),bizagi.editor.component.commandseditor.actioncommands.base.extend("bizagi.editor.component.commandseditor.actioncommands.executerule",{},{execute:function(){return!!this.existSubmitDataCommand()||(this.addSubmitDataCommand(),this.controller.refresh(),!0)},addSubmitDataCommand:function(){var e="then"==this.args.section?this.data.commands:this.data.elseCommands;this.model.addStatement(this.args.section);var t=e.pop();t.command="submit-data",e.splice(this.getPositionStatement(),0,t)},getPositionStatement:function(){for(var e=0,t="then"==this.args.section?this.data.commands:this.data.elseCommands,i=0,o=t.length;i<o;i++)if(t[i].guid===this.args.guid){e=i;break}return e},existSubmitDataCommand:function(){var e="then"==this.args.section?this.data.commands:this.data.elseCommands;return e=e.slice(0,this.getPositionStatement()),(e=$.grep(e,function(e){return"submit-data"===e.command})).length>0}}),bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executeinterface",{},{execute:function(){return this._super()}}),bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executesap",{},{execute:function(){return this._super()}}),bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executeconnector",{},{execute:function(){return this._super()}}),bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.executeexcelbot",{},{execute:function(){return this._super()}}),bizagi.editor.component.commandseditor.actioncommands.executerule.extend("bizagi.editor.component.commandseditor.actioncommands.refresh",{},{execute:function(){return this._super()}}),bizagi.editor=bizagi.editor||{},bizagi.editor.component=bizagi.editor.component||{},bizagi.editor.component.commandseditor=bizagi.editor.component.commandseditor||{},bizagi.editor.component.commandseditor.actioncommands=bizagi.editor.component.commandseditor.actioncommands||{},bizagi.editor.component.commandseditor.actioncommands.factory=function(){return{createCommand:function(args){if(void 0!==args.command)try{args.command=args.command.replace(/-/g,"");var fn=eval("var bafn = function(args) {  return new bizagi.editor.component.commandseditor.actioncommands."+args.command+"(args);};bafn"),command=fn(args);return command}catch(e){return null}return null}}}(),bizagi.editor.component.baseeditor("bizagi.editor.component.validationeditor",{init:function(e,t,i,o){this._super(e,t,i,o)},".bz-fm-commandseditor-message-argument click":function(e){this.displayMessageControl(e)},displayMessageControl:function(e){var t=this,i=t.model.getMessage(),o=new bizagi.editor.component.constantargument.textarea({templates:t.tmpl,element:e,value:i,mainEditor:this,mainContainer:t.mainContainer});o.render(),o.subscribe("valuechanged",function(e,i){var r=i.value;t.model.updateMessage(r),o.close(),t.refresh()}),o.subscribe("launchLocalizableEditor",function(e,i){var r=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"multilanguage",i18n:t.model.getMessage()});$.when(r.processRequest()).done(function(e){e.i18n.default=i.value,t.model.updateMessage(e),o.close(),t.refresh()})})},loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("container",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-validation")),e.loadTemplate("list",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-list")),e.loadTemplate("controlslist",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-controls-list")),e.loadTemplate("argument",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument")),e.loadTemplate("boolean",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-boolean")),e.loadTemplate("string",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-string")),e.loadTemplate("textarea",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-textarea")),e.loadTemplate("date",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-date")),e.loadTemplate("number",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-number")),e.loadTemplate("color",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-color")),e.loadTemplate("message",bizagi.getTemplate("bizagi.editor.component.commandseditor").concat("#commands-editor-argument-message"))).done(function(){t.resolve()}),t.promise()}}),bizagi.editor.component.baseeditor.model.extend("bizagi.editor.component.validationeditor.model",{action:"validation"},{init:function(e,t){this._super(e,t),this.operators=bizagi.editor.component.commandseditor.model.operators.validation},getViewModel:function(){var e=this.data;return $.extend(this._super(),{message:bizagi.editor.utilities.resolveComplexLocalizable(e.validationCommand.message)})},getMessage:function(){return this.data.validationCommand.message},updateMessage:function(e){var t=this.data;"object"==typeof e&&e.i18n?t.validationCommand.message=e:t.validationCommand.message.i18n.default=e},getOperatorName:function(e){return this.fullModel.getOperatorName(e,"validation")},isUnaryOperator:function(e){return this.fullModel.isUnaryOperator(e,"validation")},validate:function(){var e=this.data,t=this._super(this.Class.action);if(!t.isValid)return t;var i=bizagi.editor.utilities.resolveComplexLocalizable(e.validationCommand.message);return null!=i&&0!=i.length||(t.isValid=!1),t}}),bizagi.editor.observableClass.extend("bizagi.editor.component.commandseditor.model",{operators:{action:{equals:{label:"formmodeler-component-commandseditor-operators-action-changes-to",appliesTo:["string","date","number","boolean","entity"]},"not-equals":{label:"formmodeler-component-commandseditor-operators-action-different-to",appliesTo:["string","date","number","boolean","entity"]},"less-than":{label:"formmodeler-component-commandseditor-operators-action-less-than",appliesTo:["date","number"]},"less-equals-than":{label:"formmodeler-component-commandseditor-operators-action-less-or-equal-than",appliesTo:["date","number"]},"greater-than":{label:"formmodeler-component-commandseditor-operators-action-greater-than",appliesTo:["date","number"]},"greater-equals-than":{label:"formmodeler-component-commandseditor-operators-action-greater-or-equal-than",appliesTo:["date","number"]},like:{label:"formmodeler-component-commandseditor-operators-action-like",appliesTo:["string"]},"is-empty":{label:"formmodeler-component-commandseditor-operators-action-is-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-not-empty":{label:"formmodeler-component-commandseditor-operators-action-is-not-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-true":{label:"formmodeler-component-commandseditor-operators-action-is-true",appliesTo:["boolean"],isUnary:!0},"is-false":{label:"formmodeler-component-commandseditor-operators-action-is-false",appliesTo:["boolean"],isUnary:!0},"does-not-contain":{label:"formmodeler-component-commandseditor-operators-action-does-not-contain",appliesTo:["string"]},contains:{label:"formmodeler-component-commandseditor-operators-action-contain",appliesTo:["string"]},"begins-with":{label:"formmodeler-component-commandseditor-operators-action-begins-with",appliesTo:["string"]},"does-not-begins-with":{label:"formmodeler-component-commandseditor-operators-action-does-not-begin-with",appliesTo:["string"]},"file-uploaded":{label:"formmodeler-component-commandseditor-operators-action-has-a-file-uploaded",appliesTo:["upload"],isUnary:!0},"file-not-uploaded":{label:"formmodeler-component-commandseditor-operators-action-has-no-file-uploaded",appliesTo:["upload"],isUnary:!0},"is-invalid-email":{label:"formmodeler-component-commandseditor-operators-action-is-an-invalid-email",appliesTo:["string"],isUnary:!0},"letter-edited":{label:"formmodeler-component-commandseditor-operators-action-has-been-edited",appliesTo:["letter"],isUnary:!0},"letter-not-edited":{label:"formmodeler-component-commandseditor-operators-action-has-not-been-edited",appliesTo:["letter"],isUnary:!0},changes:{label:"formmodeler-component-commandseditor-operators-action-has-changed",appliesTo:["string","date","number","boolean","entity","letter","upload"],isUnary:!0},"on-press":{label:"formmodeler-component-commandseditor-operators-action-on-click",appliesTo:["button"],isUnary:!0},"on-deleted-row":{label:"formmodeler-component-commandseditor-operators-action-on-deleted-row",appliesTo:["collection"],isUnary:!0}},validation:{equals:{label:"formmodeler-component-commandseditor-operators-validation-is-equal-to",appliesTo:["string","date","number","boolean","entity"]},"not-equals":{label:"formmodeler-component-commandseditor-operators-validation-is-not-equal-to",appliesTo:["string","date","number","boolean","entity"]},"less-than":{label:"formmodeler-component-commandseditor-operators-validation-less-than",appliesTo:["date","number"]},"less-equals-than":{label:"formmodeler-component-commandseditor-operators-validation-less-or-equal-than",appliesTo:["date","number"]},"greater-than":{label:"formmodeler-component-commandseditor-operators-validation-greater-than",appliesTo:["date","number"]},"greater-equals-than":{label:"formmodeler-component-commandseditor-operators-validation-greater-or-equal-than",appliesTo:["date","number"]},like:{label:"formmodeler-component-commandseditor-operators-validation-like",appliesTo:["string"]},"is-empty":{label:"formmodeler-component-commandseditor-operators-validation-is-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-not-empty":{label:"formmodeler-component-commandseditor-operators-validation-is-not-empty",appliesTo:["string","date","number","boolean","entity"],isUnary:!0},"is-true":{label:"formmodeler-component-commandseditor-operators-validation-is-true",appliesTo:["boolean"],isUnary:!0},"is-false":{label:"formmodeler-component-commandseditor-operators-validation-is-false",appliesTo:["boolean"],isUnary:!0},"begins-with":{label:"formmodeler-component-commandseditor-operators-validation-begins-with",appliesTo:["string"]},"does-not-contain":{label:"formmodeler-component-commandseditor-operators-validation-does-not-contain",appliesTo:["string"]},contains:{label:"formmodeler-component-commandseditor-operators-validation-contain",appliesTo:["string"]},"does-not-begins-with":{label:"formmodeler-component-commandseditor-operators-validation-does-not-begins-with",appliesTo:["string"]},"file-uploaded":{label:"formmodeler-component-commandseditor-operators-validation-has-a-file-uploaded",appliesTo:["upload"],isUnary:!0},"file-not-uploaded":{label:"formmodeler-component-commandseditor-operators-validation-has-no-files-uploaded",appliesTo:["upload"],isUnary:!0},"is-invalid-email":{label:"formmodeler-component-commandseditor-operators-validation-invalid-email",appliesTo:["string"],isUnary:!0},"letter-edited":{label:"formmodeler-component-commandseditor-operators-validation-has-been-edited",appliesTo:["letter"],isUnary:!0},"letter-not-edited":{label:"formmodeler-component-commandseditor-operators-validation-has-not-been-edited",appliesTo:["letter"],isUnary:!0},changes:{label:"formmodeler-component-commandseditor-operators-action-has-changed",appliesTo:["string","date","number","boolean","entity","letter","upload"],isUnary:!0},"on-press":{label:"formmodeler-component-commandseditor-operators-action-on-click",appliesTo:["button"],isUnary:!0},"on-deleted-row":{label:"formmodeler-component-commandseditor-operators-action-on-deleted-row",appliesTo:["collection"],isUnary:!0}}},logicOperators:{and:"formmodeler-component-commandseditor-logicoperators-and",or:"formmodeler-component-commandseditor-logicoperators-or"},actionCommands:{"background-color":{label:"formmodeler-component-commandseditor-actioncommands-set-background-color",appliesTo:["render","container"],exclude:["nestedform"],type:"color",hasReverse:!0},forecolor:{label:"formmodeler-component-commandseditor-actioncommands-set-forecolor-color",appliesTo:["render"],exclude:["collection"],type:"color",hasReverse:!0},visible:{label:"formmodeler-component-commandseditor-actioncommands-changes-visibility-for",appliesTo:["render","container"],type:"boolean",hasReverse:!0},readonly:{label:"formmodeler-component-commandseditor-actioncommands-changes-editability-for",appliesTo:["render","container"],exclude:["undefined","button"],type:"boolean",hasReverse:!0},required:{label:"formmodeler-component-commandseditor-actioncommands-set-required-for",appliesTo:["render"],exclude:["collection","undefined","button","activityFlowButton"],type:"boolean",hasReverse:!0},"set-value":{label:"formmodeler-component-commandseditor-actioncommands-set-value-for",appliesTo:["render"],exclude:["collection","undefined","button","activityFlowButton"],type:"argument",hasReverse:!1},"set-min":{label:"formmodeler-component-commandseditor-actioncommands-set-minimum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},"set-max":{label:"formmodeler-component-commandseditor-actioncommands-set-maximum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},collapse:{label:"formmodeler-component-commandseditor-actioncommands-collapse",appliesTo:["container"],filterBy:["group"],type:"boolean",hasReverse:!0},"set-active":{label:"formmodeler-component-commandseditor-actioncommands-set-as-active",appliesTo:["container"],filterBy:["tabItem"],isUnary:!0,hasReverse:!1},refresh:{label:"formmodeler-component-commandseditor-actioncommands-refresh",appliesTo:["render","container"],exclude:["activityFlowButton"],isUnary:!0,hasReverse:!1},"execute-rule":{label:"formmodeler-component-commandseditor-actioncommands-execute-rule",appliesTo:["render","container"],isOnlyArgument:!0,type:"rule",hasReverse:!1},"execute-interface":{label:"formmodeler-component-commandseditor-actioncommands-execute-interface",appliesTo:["render","container"],isOnlyArgument:!0,type:"interface",hasReverse:!1},"execute-sap":{label:"formmodeler-component-commandseditor-actioncommands-execute-sap",appliesTo:["render","container"],isOnlyArgument:!0,type:"sap",hasReverse:!1},"execute-connector":{label:"formmodeler-component-commandseditor-actioncommands-execute-connector",appliesTo:["render","container"],isOnlyArgument:!0,type:"connector",hasReverse:!1},"execute-excel-bot":{label:"formmodeler-component-commandseditor-actioncommands-execute-excel-bot",appliesTo:["render","container"],isOnlyArgument:!0,type:"excelBot",hasReverse:!1},"submit-data":{label:"formmodeler-component-commandseditor-actioncommands-submit-data",appliesTo:["render","container"],isOnlyCommand:!0,hasReverse:!1,hidden:!0},"clean-data":{label:"formmodeler-component-commandseditor-actioncommands-clean-data",appliesTo:["render"],exclude:["collection","undefined","button","activityFlowButton"],isUnary:!0,hasReverse:!1},"trigger-click":{label:"formmodeler-component-commandseditor-actioncommands-trigger-click",appliesTo:["render"],filterBy:["activityFlowButton"],isUnary:!0,hasReverse:!0}},elseActions:{actions:"formmodeler-component-commandseditor-elseactions-actions",none:"formmodeler-component-commandseditor-elseactions-none",automatic:"formmodeler-component-commandseditor-elseactions-automatic"}},{init:function(e){this._super(),this.actions={},this.validations={},this.data=e,this.processData(e),this.operators=this.Class.operators,this.logicOperators=this.Class.logicOperators,this.actionCommands=this.Class.actionCommands,this.isReadOnly="undefined"!=e.isReadOnly&&bizagi.util.parseBoolean(e.isReadOnly)},processData:function(e){for(var t,i=0;i<e.actions.length;i++){var o=e.actions[i];o.guid?t=o.guid:o.guid=t=Math.guid(),this.actions[t]=o}for(var r=0;r<e.validations.length;r++){var n=e.validations[r];n.guid?t=n.guid:n.guid=t=Math.guid(),this.validations[t]=n}},getDataModel:function(){return this.data},getAction:function(e){return this.actions[e]},getElseActionType:function(e){return e.elseAction?e.elseAction:e.elseCommands?e.elseCommands.length>0?"actions":"none":"automatic"},getValidation:function(e){return this.validations[e]},getControls:function(){return this.data.controls},getReadOnlyModel:function(){for(var e,t=this.data,i={actions:[],validations:[],isReadOnly:this.isReadOnly},o=0;o<t.actions.length;o++)i.actions.push(this.getReadOnlyAction(t.actions[o]));for(e=0;e<t.validations.length;e++)t.validations[e].inherent||i.validations.push(this.getReadOnlyValidation(t.validations[e]));for(e=0;e<t.validations.length;e++)t.validations[e].inherent&&i.validations.push(this.getReadOnlyValidation(t.validations[e]));return i},getReadOnlyAction:function(e){var t=this.getElseActionType(e);e.isValid=!0;for(var i={guid:e.guid,conditions:{expressions:[]},commands:[],elseAction:{label:bizagi.localization.getResource(this.Class.elseActions[t]),value:t},elseCommands:e.elseCommands?[]:void 0,isReadOnly:this.isReadOnly},o=0;o<e.conditions.expressions.length;o++){var r=o>0?this.getLogicOperatorName(e.conditions.operator):null,n=this.getReadOnlyExpression(e.conditions.expressions[o],r,"action");e.isValid=e.isValid&&n.isValid,i.conditions.expressions.push(n)}for(var a=0;a<e.commands.length;a++){var s=this.getReadOnlyCommand(e.commands[a]);e.isValid=e.isValid&&s.isValid,i.commands.push(s)}if(e.elseCommands)for(var l=0;l<e.elseCommands.length;l++)s=this.getReadOnlyCommand(e.elseCommands[l]),e.isValid=e.isValid&&s.isValid,i.elseCommands.push(s);return i},getReadOnlyValidation:function(e){e.isValid=!0;for(var t={guid:e.guid,conditions:{expressions:[]},validationCommand:{message:bizagi.editor.utilities.resolveComplexLocalizable(e.validationCommand.message)},inherent:e.inherent||!1,isReadOnly:this.isReadOnly},i=0;i<e.conditions.expressions.length;i++){var o=i>0?this.getLogicOperatorName(e.conditions.operator):null,r=this.getReadOnlyExpression(e.conditions.expressions[i],o,"validation");e.isValid=e.isValid&&r.isValid,t.conditions.expressions.push(r)}return t},getReadOnlyExpression:function(e,t,i){var o={simple:e.simple?{xpath:this.getXpathName(this.resolveXpath(this.getXpathExpression(e.simple))),operator:this.getOperatorName(e.simple.operator,i),argument:this.getArgumentName(e.simple.argument,e.simple.argumentType)}:null,complex:e.complex?{conditions:{expressions:[]}}:null,logicOperator:t,isValid:!0};if(e.simple&&(o.isValid="object"==typeof this.getControls()[this.resolveXpath(e.simple.xpath)]),e.complex)for(var r=0;r<e.complex.conditions.expressions.length;r++){var n=r>0?this.getLogicOperatorName(e.complex.conditions.operator):null,a=this.getReadOnlyExpression(e.complex.conditions.expressions[r],n,i);o.complex.conditions.expressions.push(a),o.isValid=o.isValid&&a.isValid}return o},getReadOnlyCommand:function(e){var t=this;return{xpath:t.getXpathName(t.resolveCommand(e)),command:t.getCommandName(e.command),argument:t.getArgumentName(e.argument,e.argumentType),isValid:"object"==typeof t.getControls()[t.resolveXpath(e.xpath)],isUnary:t.isUnaryCommand(e.command),isOnlyArgument:t.isOnlyArgument(e.command),isOnlyCommand:t.isOnlyCommand(e.command),hidden:t.isHiddenCommand(e.command)}},getLogicOperatorName:function(e){return bizagi.util.isEmpty(e)?"":bizagi.localization.getResource(this.logicOperators[e])},getOperatorName:function(e,t){return void 0===e||bizagi.util.isEmpty(e)||!this.operators[t][e]?"":bizagi.localization.getResource(this.operators[t][e].label)},isUnaryOperator:function(e,t){return!bizagi.util.isEmpty(e)&&(this.operators[t][e]&&(this.operators[t][e].isUnary||!1))},isUnaryCommand:function(e){return null!=e&&("string"==typeof e&&e?this.actionCommands[e].isUnary||!1:"object"==typeof e&&e.command&&this.actionCommands[e.command].isUnary||!1)},isOnlyCommand:function(e){return null!=e&&("string"==typeof e&&e?this.actionCommands[e].isOnlyCommand||!1:"object"==typeof e&&e.command&&this.actionCommands[e.command].isOnlyCommand||!1)},isOnlyArgument:function(e){return null!=e&&("string"==typeof e&&e?this.actionCommands[e].isOnlyArgument||!1:"object"==typeof e&&e.command&&this.actionCommands[e.command].isOnlyArgument||!1)},isHiddenCommand:function(e){return null!=e&&("string"==typeof e&&e?this.actionCommands[e].hidden||!1:"object"==typeof e&&e.command&&this.actionCommands[e.command].hidden||!1)},resolveXpath:function(e){return e?bizagi.editor.utilities.resolveComplexXpath(e):null},resolveCommand:function(e){return e.xpath?this.resolveXpath(e.xpath):e.propertyToUpdate?e[e.propertyToUpdate]:void 0},getXpathName:function(e){return bizagi.util.isEmpty(e)?"":this.data.controls[e]?this.data.controls[e].label:""},getXpathExpression:function(e){return e.propertyToUpdate?e[e.propertyToUpdate]:e.xpath},getXpath:function(e){return bizagi.util.isEmpty(e)?"":this.data.controls[e]},getArgumentName:function(e,t){return void 0===e||null==e?null:"const"!=t&&"entity"!=t||void 0===e?this.getXpathName(this.resolveXpath(e)):e.label?e.label:e},getCommandName:function(e){return bizagi.util.isEmpty(e)||!this.actionCommands[e]?"":bizagi.localization.getResource(this.actionCommands[e].label)},createEmptyAction:function(){return{guid:Math.guid(),conditions:{operator:"and",expressions:[]},commands:[],elseCommands:[]}},addAction:function(e,t){this.data.actions.push(t),this.actions[e]=t},updateAction:function(e,t){for(var i=this.data,o=0;o<i.actions.length;o++)i.actions[o].guid==e&&(i.actions[o]=t);this.actions[e]=t},createEmptyValidation:function(){var e=Math.guid();return{guid:e,conditions:{operator:"and",expressions:[]},validationCommand:{message:bizagi.editor.utilities.buildComplexLocalizable("",e,"message")}}},changeActionStateEnabled:function(e,t){for(var i=this.data,o=-1,r=0;r<i.actions.length;r++)if(i.actions[r].guid==e){o=r;break}o>=0&&(i.actions[o].enabled=t)},changeAllActionStateEnabled:function(e){for(var t=this.data,i=0;i<t.actions.length;i++)t.actions[i].enabled=e},changeValidationStateEnabled:function(e,t){var i=this.data;delete this.validations[e];for(var o=-1,r=0;r<i.validations.length;r++)if(i.validations[r].guid==e){o=r;break}o>=0&&(i.validations[o].enabled=t)},changeAllValidationStateEnabled:function(e){for(var t=this.data,i=0;i<t.validations.length;i++)t.validations[i].enabled=e},addValidation:function(e,t){this.data.validations.push(t),this.validations[e]=t},updateValidation:function(e,t){for(var i=this.data,o=0;o<i.validations.length;o++)i.validations[o].guid==e&&(i.validations[o]=t);this.validations[e]=t},deleteAction:function(e){var t=this.data;delete this.actions[e];for(var i=-1,o=0;o<t.actions.length;o++)if(t.actions[o].guid==e){i=o;break}i>=0&&t.actions.splice(i,1)},deleteValidation:function(e){var t=this.data;delete this.validations[e];for(var i=-1,o=0;o<t.validations.length;o++)if(t.validations[o].guid==e){i=o;break}i>=0&&t.validations.splice(i,1)},getInvalidElements:function(){return this.getReadOnlyModel(),{actions:$.grep(this.data.actions,function(e,t){return!e.isValid}),validations:$.grep(this.data.validations,function(e,t){return!e.isValid})}},moveActionUp:function(e){for(var t=this.data,i=-1,o=0;o<t.actions.length;o++)if(t.actions[o].guid==e){i=o;break}if(i>=0){var r=t.actions[i];t.actions.splice(i,1),t.actions.splice(i-1,0,r)}},moveActionDown:function(e){for(var t=this.data,i=-1,o=0;o<t.actions.length;o++)if(t.actions[o].guid==e){i=o;break}if(i>=0){var r=t.actions[i];t.actions.splice(i,1),t.actions.splice(i+1,0,r)}},moveValidationUp:function(e){for(var t=this.data,i=-1,o=0;o<t.validations.length;o++)if(t.validations[o].guid==e){i=o;break}if(i>=0){var r=t.validations[i];t.validations.splice(i,1),t.validations.splice(i-1,0,r)}},moveValidationDown:function(e){for(var t=this.data,i=-1,o=0;o<t.validations.length;o++)if(t.validations[o].guid==e){i=o;break}if(i>=0){var r=t.validations[i];t.validations.splice(i,1),t.validations.splice(i+1,0,r)}}}),bizagi.editor.component.commandseditor.model.extend("bizagi.editor.component.commandseditor.offline.model",{actionCommands:{"background-color":{label:"formmodeler-component-commandseditor-actioncommands-set-background-color",appliesTo:["render","container"],exclude:["nestedform"],type:"color",hasReverse:!0},forecolor:{label:"formmodeler-component-commandseditor-actioncommands-set-forecolor-color",appliesTo:["render"],exclude:["collection"],type:"color",hasReverse:!0},visible:{label:"formmodeler-component-commandseditor-actioncommands-changes-visibility-for",appliesTo:["render","container"],type:"boolean",hasReverse:!0},readonly:{label:"formmodeler-component-commandseditor-actioncommands-changes-editability-for",appliesTo:["render","container"],exclude:["undefined"],type:"boolean",hasReverse:!0},required:{label:"formmodeler-component-commandseditor-actioncommands-set-required-for",appliesTo:["render"],exclude:["collection","undefined","button"],type:"boolean",hasReverse:!0},"set-value":{label:"formmodeler-component-commandseditor-actioncommands-set-value-for",appliesTo:["render"],exclude:["collection","undefined","button"],type:"argument",hasReverse:!1},"set-min":{label:"formmodeler-component-commandseditor-actioncommands-set-minimum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},"set-max":{label:"formmodeler-component-commandseditor-actioncommands-set-maximum-value-for",appliesTo:["render"],filterBy:["number","date"],type:"argument",hasReverse:!1},collapse:{label:"formmodeler-component-commandseditor-actioncommands-collapse",appliesTo:["container"],filterBy:["group"],type:"boolean",hasReverse:!0},"set-active":{label:"formmodeler-component-commandseditor-actioncommands-set-as-active",appliesTo:["container"],filterBy:["tabItem"],isUnary:!0,hasReverse:!1},"clean-data":{label:"formmodeler-component-commandseditor-actioncommands-clean-data",appliesTo:["render"],filterBy:["entity"],isUnary:!0,hasReverse:!1}}},{init:function(e){this._super(e),this.actionCommands=this.Class.actionCommands}}),bizagi.editor.observableClass.extend("bizagi.editor.component.commandseditor.presenter",{},{init:function(){this._super()},show:function(e){var t=new $.Deferred,i=this.createModelFactory(e),o=this.publish("getMainContainer"),r=this.popup=bizagi.createPopup({name:"bz-fm-commandseditor",container:o,title:bizagi.localization.getResource("formmodeler-component-commandseditor-displayname"),center:!0,onClose:function(){t.resolve(i.getDataModel())}});return this.configureDraggablePlugin(r.fullPopup,o),this.commandsEditor=new bizagi.editor.component.commandseditor(r.content,i,this),this.commandsEditor.render(),t.promise()},createModelFactory:function(e){var t=this.publish("getContext");return"form"===t?new bizagi.editor.component.commandseditor.model(e):"offlineform"===t?new bizagi.editor.component.commandseditor.offline.model(e):"queryform"===t?new bizagi.editor.component.commandseditor.offline.model(e):"startform"==t?new bizagi.editor.component.commandseditor.model(e):void 0},createAction:function(e){var t=this;t.hidePopup();var i=t.publish("getMainContainer"),o=bizagi.localization.getResource("formmodeler-component-commandseditor-action-editor-title"),r=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:i,title:o,center:!0,onClose:function(){t.showPopup()}});t.configureDraggablePlugin(r.fullPopup,i);var n=e.createEmptyAction(),a=t.createActionModelFactory(n,e),s=new bizagi.editor.component.actioneditor(r.content,a,t,i);s.render(),s.subscribe("cancel",function(){t.showPopup(),r.close()}),s.subscribe("save",function(i,o){e.addAction(o.model.guid,o.model),t.showPopup(),r.close(),t.commandsEditor.refresh()})},editAction:function(e,t){var i=this;i.hidePopup();var o=i.publish("getMainContainer"),r=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:o,title:"Edit action",center:!0,onClose:function(){i.showPopup()}});i.configureDraggablePlugin(r.fullPopup,o);var n=bizagi.clone(e.getAction(t)),a=i.createActionModelFactory(n,e),s=new bizagi.editor.component.actioneditor(r.content,a,i,o);s.render(),s.subscribe("cancel",function(){i.showPopup(),r.close()}),s.subscribe("save",function(o,n){e.updateAction(t,n.model),i.showPopup(),r.close(),i.commandsEditor.refresh()})},createActionModelFactory:function(e,t){var i=this.publish("getContext");return"form"==i?new bizagi.editor.component.actioneditor.model(e,t):"offlineform"==i?new bizagi.editor.component.actioneditor.offline.model(e,t):"queryform"==i?new bizagi.editor.component.actioneditor.offline.model(e,t):"startform"==i?new bizagi.editor.component.actioneditor.model(e,t):void 0},createValidation:function(e){var t=this;t.hidePopup();var i=t.publish("getMainContainer"),o=bizagi.localization.getResource("formmodeler-component-commandseditor-validation-editor-title"),r=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:i,title:o,center:!0,onClose:function(){t.showPopup()}});t.configureDraggablePlugin(r.fullPopup,i);var n=e.createEmptyValidation(),a=new bizagi.editor.component.validationeditor.model(n,e),s=new bizagi.editor.component.validationeditor(r.content,a,t,i);s.render(),s.subscribe("cancel",function(){t.showPopup(),r.close()}),s.subscribe("save",function(i,o){e.addValidation(o.model.guid,o.model),t.showPopup(),r.close(),t.commandsEditor.refresh(),$("#bz-fm-commandseditor-tabs",t.commandsEditor.element).tabs("option","active",1)})},editValidation:function(e,t){var i=this;i.hidePopup();var o=i.publish("getMainContainer"),r=bizagi.createPopup({name:"bz-fm-actionvalidationeditor",container:o,title:"Edit validation",center:!0,onClose:function(){i.showPopup()}});i.configureDraggablePlugin(r.fullPopup,o);var n=bizagi.clone(e.getValidation(t)),a=new bizagi.editor.component.validationeditor.model(n,e),s=new bizagi.editor.component.validationeditor(r.content,a,i,o);s.render(),s.subscribe("cancel",function(){i.showPopup(),r.close()}),s.subscribe("save",function(o,n){e.updateValidation(t,n.model),i.showPopup(),r.close(),i.commandsEditor.refresh(),$("#bz-fm-commandseditor-tabs",i.commandsEditor.element).tabs("option","active",1)})},hidePopup:function(){this.popup.fullPopup.hide()},showPopup:function(){this.popup.fullPopup.show()},configureDraggablePlugin:function(e,t){e.draggable({containment:t,delay:100,distance:5,handle:".ui-popup-header"})}}),bizagi.editor.observableClass.extend("bizagi.editor.component.properties.model",{rulePropertiesHash:["defaultvalue.rule","defaultvalue.rule90","daterange.maxrule","daterange.maxrule90","daterange.minrule","daterange.minrule90","buttonrule","buttonrule.rule","buttonrule.rule90","data.filter.rule","editable.rule","editable.rule90","visible.rule","visible.rule90","required.rule","required.rule90"]},{init:function(e){this._super(),e&&(this.disableProperties=e.disableProperties,this.initModel(e)),this.communicationProtocol=bizagi.editor.communicationprotocol.factory},initModel:function(e){var t=this,i=t.model={idRender:"",elements:[]};t.externalProperties=t.populateExternalProperties(e),t.indexedProperties={},t.designProperties=e.design.properties;var o=e.design.visual["property-box"];if(o.tabs){var r=[];$.each(o.tabs,function(e,i){var o={id:i.id,caption:bizagi.editor.utilities.resolveInternalResource(i.caption)};o.elements=t.initElements({elements:i.elements}),r.push(o)}),i.elements.push({tabs:r})}else i.elements=t.initElements({elements:o.elements})},initElements:function(e){var t=this,i=e.elements||[],o=e.prefix,r=e.applyIndexing||!0,n=[];return r=void 0===r||r,$.each(i,function(e,a){var s=a.type||i[e].type,l=null;if("property"==s){if(t.propertyIsEnabled(a.value)){var d=t.getDesignProperty(a.value);if($.isEmptyObject(d))throw"The visual property ("+a.value+") doesn't exist. External properties: "+JSON.stringify(t.externalProperties);var c=a.value||a.name;l={"bas-type":d["bas-type"]||a["bas-type"],name:o?o+"."+c:c,required:d.required||{},caption:bizagi.editor.utilities.resolveInternalResource(d.caption)||a.caption,"user-editable":d["user-editable"]||a["user-editable"],value:a.dataValue||null,"editor-parameters":d["editor-parameters"]?t.processEditorParameters(d):a["editor-parameters"]||{},default:d.default,deprecated:d.deprecated||!1},r&&(t.indexedProperties[l.name]=l),d.subproperties&&t.processSubproperties(l.name,d,l)}}else l={id:a.id,caption:bizagi.editor.utilities.resolveInternalResource(a.caption)},void 0!==a.exclusive&&$.extend(l,{exclusive:!0}),void 0!==a.visibility&&$.extend(l,{visibility:a.visibility});if(l){a.elements&&(l.elements=t.initElements({elements:a.elements}));var u={};u[s]=l,n.push(u)}}),n},getDesignProperty:function(e){if(-1===e.indexOf("."))return this.designProperties[e]||{};var t=e.split(".");return t.length>1?this.designProperties[t[0]].subproperties[t[1]]:{}},processEditorParameters:function(e){var t,i,o=!1;for(t in e["editor-parameters"]){if(e["editor-parameters"][t].rule){o=!0;break}}if(o)for(t in i={},e["editor-parameters"])if(e["editor-parameters"][t].rule){var r=e["editor-parameters"][t].rule;if(-1!=r.search(/^<.*>$/)){var n=(r=r.substring(1,r.length-1)).split(":");if(n.length>1&&"design"==n[0]){var a=n[1];if(void 0===n[2]){var s=this.designProperties[a];i[t]={value:void 0!==s.value|null!=s.value?s.value:"true"===s.default,rule:e["editor-parameters"][t].rule}}}}}else i[t]=e["editor-parameters"][t];else i=e["editor-parameters"];return i},processSubproperties:function(e,t,i){var o,r,n,a=[];for(o in t.subproperties)r=t.subproperties[o],n={value:o,type:"property"},this.designProperties[o]=r,a.push(n);i.subproperties=this.initElements({elements:a,applyIndexing:!1,prefix:e})},process:function(e){var t=this;for(var i in t.model.idRender=e.guid,t.model.element=e,t.indexedProperties){var o=t.indexedProperties[i];o.value=null,t.isLayoutContainer(o)&&t.updateLayoutProperty(e,i),e.isText()&&t.isSpecialProperty(o.name)&&t.updateDefaultValueProperty(e,o,i),t.isActiveContainerProperty(o)&&t.updateActiveContainerProperty(e,o),t.updatePropertyModel(e,o,i)}return t.model},isForm:function(e){return"form"===e["bas-type"]||"searchform"===e["bas-type"]},isLayoutContainer:function(e){return"change-layout"===e["bas-type"]||"changelayout"===e["bas-type"]},isLocalizableProperty:function(e){return"localizable-string"===e["bas-type"]||"localizablestring"===e["bas-type"]},isActiveContainerProperty:function(e){return"active-container"===e["bas-type"]||"activecontainer"===e["bas-type"]},updateLayoutProperty:function(e,t){var i={elements:[]};e.elements&&$.each(e.elements,function(e,t){var o=t.properties.width||"0%";i.elements.push({index:e,width:o})}),e.properties[t]=i},updatePropertyModel:function(e,t,i){var o=bizagi.editor.component.properties.commands.factory;(t.show=!0,t.notShow=void 0,this.isRuleProperty(i))&&o.createRuleCommand({command:i,element:e,key:i}).execute();var r=o.createCommand({command:i,element:e,key:i,indexedProperty:t});r&&r.execute();var n=bizagi.editor.utilities.resolveProperty(e.properties,i);bizagi.editor.utilities.isObject(n)&&(n=bizagi.clone(n),n=this.resolveObjectProperty(t,n)),t.value=n,!t.value&&t.deprecated&&bizagi.override.enableDeprecatedProperties&&(t.show=!1)},updateDefaultValueProperty:function(e,t,i){t.default=e.getDefaultValueProperty(i)},updateActiveContainerProperty:function(e,t){var i=e.getChildren();t["editor-parameters"]=t["editor-parameters"]||{},t["editor-parameters"].values=i.length>0?$.map(i,function(e,t){return{label:e.resolveDisplayNameProperty(),value:e.guid,icon:"tab"}}):[]},resolveObjectProperty:function(e,t){return this.isLocalizableProperty(e)&&(t=this.resolveResource(t.i18n,bizagi.editorLanguage.key)),t},resolveResource:function(e,t){if(!e)return"";if("string"==typeof e)return e;if(t=t||bizagi.language,!e.languages)return e.default;for(;null==e.languages[t]&&t.length>0;){var i=t.split("-");i.pop(),t=i.join("-")}return 0==t.length||null==e.languages[t]?e.default:e.languages[t]},isSpecialProperty:function(e){return"maxlength"===e},populateExternalProperties:function(e){return{renderCaption:bizagi.editor.utilities.resolveInternalResource(e.display)}},getCaption:function(e){return this.indexedProperties[e]&&this.indexedProperties[e].caption?this.indexedProperties[e].caption:e},isRuleProperty:function(e){return this.Class.rulePropertiesHash.indexOf(e)>=0},propertyIsEnabled:function(e){return $.inArray(e,this.disableProperties)<0}}),bizagi.editor.component.controller("bizagi.editor.component.gridcolumneditor",{init:function(e,t){t=t||{},this._super(e),this.model=t.model,this.canvas=e,this.renderArea=t.renderArea,this.presenter=t.presenter,this.options=t.options},loadTemplates:function(){var e={gridcolumneditor:bizagi.getTemplate("bizagi.editor.component.gridcolumneditor")+"#gridcolumneditor-container"};return this._super(e)},refresh:function(e){this.render(e)},render:function(e){var t=this;e=e||{},t.options=$.extend(t.options,e.options),e.gridModel&&t.model.update(e.gridModel),t.createOverlay(),$.when(t.loadTemplates()).done(function(){t.canvas.empty();var i=t.renderGrid();t.renderGridWidths(e.gridModel),t.activeState(e,i)})},destroy:function(){this.overlay.detach(),this.renderArea.removeClass("bz-edit-mode"),this.presenter.publish("close"),$(window).unbind("resize.grid")},createOverlay:function(){if(this.overlay)return this.overlay;var e=this.overlay=$("<div />");return e.addClass("bz-grid-columneditor-container-main"),this.renderArea.addClass("bz-edit-mode"),e.appendTo(this.renderArea),this.canvas.appendTo(e),e},renderGrid:function(){var e,t;return t=this.model.getViewModel(),(e=this.grid=$.tmpl(this.getTemplate("gridcolumneditor"),t)).offset({top:this.options.top,left:this.options.left}),e.height(this.options.height),e.width(this.options.width),e.attr("difWindow",$(window).width()-(e.position().left+e.width())),$(window).bind("resize.grid",function(){e.width($(window).width()-e.attr("difWindow"))}),e.appendTo(this.canvas),0===t.columns.length?e.addClass("ui-drop-here-layout"):e.removeClass("ui-double-drop-here-layout"),e.find(".ui-icon").css("background-image","url('')"),e.find(".bz-grid-column").css("height","50px"),bizagi.form.modeler.params.reviewMode||this.addGridSortBehaviour(e),e},renderGridWidths:function(){var e=this.model.model;$.each($(".bz-grid-column",this.grid),function(t,i){var o=e.columns[t];if(o.columnwidth){var r=o.columnwidth,n=parseInt(r).toString(),a=r.substring(n.length,r.length);$(i).css("width",n+a),"%"!=a&&$(i).find("span").css("width",n+a)}else $(i).css("width","auto")})},addGridSortBehaviour:function(e){var t=this;e.sortable({items:".ui-bizagi-draggable-item",revert:!0,connectWith:".ui-bizagi-container-connectedSortable",distance:1,cursorAt:{top:-3,left:0},placeholder:"bz-fm-grid-columneditor-placeholder-custom",delay:0,helper:"clone"}),e.disableSelection(),e.bind("sortstart",function(e,i){t.onSortStart(i)}),e.bind("sortactivate",function(e,i){t.onSortActivate(i)}),e.bind("sortstop",function(e,i){t.onSortStop(i)})},activeState:function(e,t){var i=e.guidSelected;if($.isArray(i)&&i.length>0){for(var o=0,r=i.length;o<r;o++)$('div[data-id="'+i[o]+'"]',t).addClass("ui-state-active");this.presenter.publish("processSelectedColumns",{refresh:!0})}},onSortStart:function(e){var t=$(e.item).parent().children(".ui-bizagi-itemfordrag").index(e.item);this.initialPosition=t},onSortActivate:function(e){$(e.item).hasClass("mtool-item")?(this.sourceData=$(e.item).data("render"),this.source="controlsNavigator"):$(e.item).hasClass("bizagi_editor_xpathnavigator_data")?(this.sourceData=$(e.item).data(),this.source="xpathNavigator"):this.source="gridColumnEditor"},onSortStop:function(e){var t=this,i=t.initialPosition,o=t.source,r=t.sourceData,n=$(e.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(e.item);t.finalPosition=n,"gridColumnEditor"==o?(t.model.moveColumn(i,n),t.presenter.publish("moveColumn",{guid:t.model.getGuid(),data:r,initialPosition:i,finalPosition:n})):"controlsNavigator"==o?(t.model.insertControlColumn(n,r),t.presenter.publish("insertControl",{guid:t.model.getGuid(),data:r,position:n})):"xpathNavigator"==o&&(t.model.insertXpathColumn(n,r),t.presenter.publish("insertXpath",{guid:t.model.getGuid(),data:r,position:n})),t.refresh()},selectColumn:function(e,t){var i=e.offset(),o={position:{top:i.top,left:i.left,width:e.outerWidth(),height:e.outerHeight()},element:e,guid:e.data("id"),type:"column",grid:this.model.guid};void 0!==t&&$.extend(o,{ctrlIsPressed:!0}),this.presenter.publish("updateDesignAttributesColumn",{guid:e.data("id"),property:"columnwidth",attributes:{isWidthColumnEditable:this.model.isWidthColumnEditable(e.data("id")),percentMaxWidth:this.model.getPercentMaxWidth(e.data("id"))}}),this.presenter.publish("selectColumn",o)},unselectColumn:function(e){this.presenter.publish("unselectColumn",e)},showContextMenu:function(e,t){var i={position:t,guid:e,type:"column",grid:this.model.guid};this.presenter.publish("showContextMenu",i)},".biz-action-btn.biz-btn-ok click":function(){this.presenter.publish("performValidationsInModel",{originalGridModel:this.model.originalModel,model:this.model.getViewModel()})},".biz-action-btn.biz-btn-cancel click":function(){this.presenter.publish("cancelChangesInModel",{gridModel:this.model.originalModel}),this.destroy()},".bz-grid-column click":function(e,t){this.presenter.publish("checkCtrlKey",{})?(e.toggleClass("ui-state-active"),e.hasClass("ui-state-active")?this.selectColumn(e,!0):this.unselectColumn({guid:e.data("id"),ctrlIsPressed:!0})):($("#bz-fm-grid-columneditor .bz-grid-column").not(e).removeClass("ui-state-active"),e.toggleClass("ui-state-active"),e.hasClass("ui-state-active")?this.selectColumn(e):this.unselectColumn())},".bz-grid-column mousedown":function(e,t){return 2!=t.button||(this.showContextMenu(e.data("id"),{x:t.clientX,y:t.clientY}),t.preventDefault(),t.stopPropagation(),!1)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.gridcolumneditor.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />"),this.model=new bizagi.editor.component.gridcolumneditor.model(e.gridModel),this.gridcolumneditor=new bizagi.editor.component.gridcolumneditor(this.canvas,{model:this.model,presenter:this,renderArea:e.renderArea})},getGuid:function(){return this.model.getGuid()},refresh:function(e){this.gridcolumneditor.refresh(e)},render:function(e){this.gridcolumneditor.render(e)},destroy:function(){this.gridcolumneditor.destroy()}}),bizagi.editor.observableClass.extend("bizagi.editor.component.gridcolumneditor.model",{},{init:function(e){this.model={columns:[]},this.guid=e.guid,this.originalModel=bizagi.clone(e),this.model.columns=this.processModel(e)},getGuid:function(){return this.guid},update:function(e){this.model.columns=this.processModel(e)},processModel:function(e){var t=[];if(!e)return t;if(e.elements.length>0)for(var i=0;i<e.elements.length;i++){var o=e.elements[i];t.push({guid:o.guid,displayName:bizagi.editor.utilities.resolvei18n(o.properties.displayName),xpath:o.properties.xpath,type:o.type,columnwidth:o.properties.columnwidth})}return t},getViewModel:function(){return this.model},insertControlColumn:function(e,t){var i={guid:Math.guid(),displayName:t.caption,type:t.type};return this.model.columns.splice(e,0,i),i},insertXpathColumn:function(e,t){var i={guid:Math.guid(),displayName:t.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)};return this.model.columns.splice(e,0,i),i},moveColumn:function(e,t){this.model.columns.move(e,t)},deleteColumn:function(e){for(var t=0,i=this.model.columns.length;t<i;t+=1)if(this.model.columns[t].guid===e){this.model.columns.splice(t,1);break}},isWidthColumnEditable:function(e){if(1==$.grep(this.model.columns,function(e,t){return null==e.columnwidth||"auto"==e.columnwidth}).length){for(var t=0,i=this.model.columns.length;t<i;t+=1){var o=this.model.columns[t].columnwidth;if("auto"==o||null==o&&e==this.model.columns[t].guid)return!1}return!0}return!0},getPercentMaxWidth:function(e){for(var t=100,i=0,o=this.model.columns.length;i<o;i+=1){var r=this.model.columns[i].columnwidth;r&&r.indexOf("%")>=0&&e!=this.model.columns[i].guid&&(t-=parseInt(r))}return t}}),bizagi.editor.component.controller("bizagi.editor.component.wait",{},{init:function(e,t){this._super(),t=t||{},this.canvas=e,this.model=t.model,this.presenter=t.presenter,this.renderArea=t.renderArea},loadTemplates:function(){var e={wait:bizagi.getTemplate("bizagi.editor.component.wait")+"#wait-container"};return this._super(e)},render:function(){var e=this,t=new $.Deferred;bizagi.log("self.createOverlay();"),e.createOverlay();var i=e.element;return i.empty(),$.when(e.loadTemplates()).done(function(){var o=e.getTemplate("wait");$.tmpl(o,e.model.getModel()).appendTo(i),t.resolve()}),t.promise()},createOverlay:function(){if(this.overlay)return this.overlay;var e=this.overlay=$("<div />");e.addClass("bz-grid-wait-container-main"),this.renderArea.addClass("bz-edit-mode"),e.appendTo(this.renderArea),this.canvas.appendTo(e)},destroy:function(){this.overlay.detach(),this.renderArea.removeClass("bz-edit-mode")}}),bizagi.editor.observableClass.extend("bizagi.editor.component.wait.presenter",{},{init:function(e){this._super(),e=e||{},this.canvas=e.canvas||$("<div />"),this.model=new bizagi.editor.component.wait.model(e.model),this.waitEditor=new bizagi.editor.component.wait(this.canvas,{model:this.model,presenter:this,renderArea:e.renderArea})},render:function(e){this.waitEditor.render(e)},destroy:function(){this.waitEditor.destroy()}}),bizagi.editor.observableClass.extend("bizagi.editor.component.wait.model",{},{init:function(e){e=e||{},this.message=e.message||""},getModel:function(){return{message:this.message}}}),bizagi.editor.component.controller("bizagi.editor.component.searchresulteditor",{init:function(e,t){t=t||{},this._super(e),this.model=t.model,this.canvas=e,this.presenter=t.presenter,this.options=t.options},loadTemplates:function(){var e={searchresulteditor:bizagi.getTemplate("bizagi.editor.component.searchresulteditor")+"#searchresulteditor-container"};return this._super(e)},refresh:function(e){this.render(e)},render:function(e){var t=this;e=e||{},t.options=$.extend(t.options,e.options),e.searchResultModel&&t.model.update(e.searchResultModel),t.canvas.empty(),$.when(t.loadTemplates()).done(function(){var i=t.renderGrid();0===i.children().length&&i.addClass("children"),i.appendTo(t.canvas),e.currentSelectElement&&t.selectColumnByGuid(e.currentSelectElement)})},renderGrid:function(){var e;return e=this.grid=$.tmpl(this.getTemplate("searchresulteditor"),this.model.getViewModel()),$("[title]",e).tooltip(),e.appendTo(this.canvas),this.addGridSortBehaviour(e),e},addGridSortBehaviour:function(e){var t=this;e.sortable({items:".ui-bizagi-draggable-item",revert:!0,connectWith:".ui-bizagi-container-connectedSortable",distance:10,cursorAt:{top:-3,left:0},placeholder:"bz-fm-searchresult-placeholder",delay:150,helper:"clone"}),e.disableSelection(),e.bind("sortstart",function(e,i){t.onSortStart(i)}),e.bind("sortactivate",function(e,i){t.onSortActivate(i)}),e.bind("sortstop",function(e,i){t.onSortStop(i)})},onSortStart:function(e){var t=$(e.item).parent().children(".ui-bizagi-itemfordrag").index(e.item);this.initialPosition=t},onSortActivate:function(e){$(e.item).hasClass("bizagi_editor_xpathnavigator_data")?(this.sourceData=$(e.item).data(),this.source="xpathNavigator"):this.source="searchResultEditor"},onSortStop:function(e){var t=this.initialPosition,i=this.source,o=this.sourceData,r=$(e.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(e.item);this.finalPosition=r,"searchResultEditor"==i?this.presenter.publish("moveColumn",{data:o,initialPosition:t,finalPosition:r}):"xpathNavigator"==i&&this.presenter.publish("insertXpath",{data:o,position:r})},selectColumn:function(e){var t=e.offset();this.presenter.publish("selectColumn",{position:{top:t.top,left:t.left,width:e.outerWidth(),height:e.outerHeight()},element:e,guid:e.data("id")})},unSelectColumn:function(){this.presenter.publish("unSelectColumn",{})},selectColumnByGuid:function(e){var t=$('.bz-searchresult-column[data-id = "'+e+'"]',this.canvas);if(t.length>0){var i=$(t[0]);i.toggleClass("ui-state-active"),this.selectColumn(i)}},".bz-searchresult-column click":function(e){$("#bz-fm-searchresult-editor > .bz-searchresult-column").not(e).removeClass("ui-state-active"),e.toggleClass("ui-state-active"),e.hasClass("ui-state-active")?this.selectColumn(e):this.unSelectColumn(e)}}),bizagi.editor.observableClass.extend("bizagi.editor.component.searchresulteditor.presenter",{},{init:function(e){this._super(),e=e||{},this.model=new bizagi.editor.component.searchresulteditor.model(e.searchResultModel),this.searchresulteditor=new bizagi.editor.component.searchresulteditor(e.canvas,{model:this.model,presenter:this})},refresh:function(e){this.searchresulteditor.refresh(e)},render:function(e){this.searchresulteditor.render($.extend(e))}}),bizagi.editor.observableClass.extend("bizagi.editor.component.searchresulteditor.model",{},{init:function(e){this.dummyRows=5,this.model=this.processModel(e)},update:function(e){this.model=this.processModel(e)},processModel:function(e){var t={columns:[],rows:[],resultValidations:e.resultValidations};if(!e)return t;var i=e.model;if(i.length>0)for(var o=0;o<i.length;o++){for(var r=i[o],n=[],a=0;a<this.dummyRows;a++)n.push({value:"value"});t.columns.push({guid:r.guid,displayName:bizagi.editor.utilities.resolvei18n(r.properties.displayName),xpath:r.properties.xpath,type:r.type,values:n})}return t},getViewModel:function(){return this.model}}),bizagi.editor.component.controller("bizagi.editor.component.buttoneditor",{init:function(e,t){t=t||{},this._super(e),this.model=t.model,this.canvas=e,this.presenter=t.presenter,this.options=t.options,this.rendering=new bizagi.rendering.facade},loadTemplates:function(){var e={buttoneditor:bizagi.getTemplate("bizagi.editor.component.buttoneditor")+"#buttoneditor-container"};return this._super(e)},refresh:function(e){this.render(e)},render:function(e){var t=this;e=e||{},t.isReadOnly="undefined"!=e.isReadOnly&&bizagi.util.parseBoolean(e.isReadOnly),t.allowAddButtons="undefined"!=e.allowAddButtons&&bizagi.util.parseBoolean(e.allowAddButtons),t.options=$.extend(t.options,e.options),e.buttonModel&&t.model.update(e.buttonModel),$.when(t.loadTemplates()).done(function(){t.buttonEditor||(t.canvas.empty(),(t.buttonEditor=$.tmpl(t.getTemplate("buttoneditor"))).appendTo(t.canvas));var e=$("#bz-fm-buttoneditor-rendering",t.buttonEditor);t.renderButtons(e)})},renderButtons:function(e){var t=this;if(null==bizagi.renderButtonsTimeout)return bizagi.renderButtonsTimeout=setTimeout(function(){bizagi.renderButtonsTimeout=null},200),t.rendering.update({mode:"design",canvas:e,allowButtons:!0,data:{properties:{},buttons:t.model.getViewModel()}}),$.when(t.rendering.ready()).done(function(){var i=$(".ui-bizagi-button-container",e),o=$(".ui-bizagi-button",i);if(i.unwrap(),o.wrap("<span></span>"),$(".bz-fm-buttoneditor-add",i).button(),$(".bz-fm-buttoneditor-add .ui-button-text",i).addClass("bz-fm-buttoneditor-add-icon"),!t.isReadOnly&&t.allowAddButtons){$(".bz-fm-buttoneditor-add",i).button(),$(".bz-fm-buttoneditor-add .ui-button-text",i).addClass("bz-fm-buttoneditor-add-icon");var r=$(i.children()[0]);if(r.sortable({items:r.children().not(".bz-fm-avoid-sort"),cancel:"textarea,select,option",distance:10,axis:"x",cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-button-placeholder bz-fm-avoid-sort",delay:150,start:function(e,i){t.sortStart(e,i)},tolerance:"pointer",stop:function(e,i){t.sortFinish(e,i)}}),t.options.element){var n=t.options.element.guid,a=$('input[data-guid="'+n+'"]',i);a.length>0&&(a.toggleClass("bz-state-active"),a=a.parent(),t.selectButton(a,n))}}else $(".bz-fm-avoid-sort",i).hide()}),e},sortStart:function(e,t){var i=$(t.item).parent().children().not(".bz-fm-avoid-sort").index(t.item);return t.item.data("start-position",i),this.initialPosition=i,!0},sortFinish:function(e,t){var i=$(t.item).parent().children().not(".bz-fm-avoid-sort").index(t.item);return this.presenter.publish("moveButton",{initialPosition:t.item.data("start-position")||this.initialPosition,finalPosition:i}),!0},selectButton:function(e,t){var i=e.offset();this.presenter.publish("selectButton",{position:{top:i.top,left:i.left,width:e.outerWidth(),height:e.outerHeight()},element:e,guid:t,type:"button"})},unselectButton:function(){this.presenter.publish("unselectButton")},".ui-bizagi-button click":function(e){if(!this.isReadOnly){$(".ui-bizagi-render").not(e).removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").not(e).removeClass("ui-state-active"),$(".ui-bizagi-container").removeClass("ui-bizagi-container-selected"),e.toggleClass("bz-state-active");var t=e.hasClass("bz-state-active");$(".ui-bizagi-button",this.canvas).not(e).removeClass("bz-state-active"),t?this.selectButton(e.parent(),e.data("guid")):this.unselectButton()}},".bz-fm-buttoneditor-add click":function(e){this.presenter.publish("addButton")}}),bizagi.editor.observableClass.extend("bizagi.editor.component.buttoneditor.presenter",{},{init:function(e){this._super(),e=e||{},this.model=new bizagi.editor.component.buttoneditor.model(e.buttonModel),this.buttoneditor=new bizagi.editor.component.buttoneditor(e.canvas,{model:this.model,presenter:this,isReadOnly:e.isReadOnly})},refresh:function(e){this.buttoneditor.refresh(e)},render:function(e){this.buttoneditor.render($.extend(e))}}),bizagi.editor.observableClass.extend("bizagi.editor.component.buttoneditor.model",{},{init:function(e){this.model=this.processModel(e)},update:function(e){this.model=this.processModel(e)},processModel:function(e){return e},getViewModel:function(){return this.model}}),bizagi.editor.observableClass.extend("bizagi.editor.command",{},{init:function(e){e=e||{},this._super(),this.arguments=e.arguments,this.controller=e.controller,this.model=e.model,this.arguments.canUndo=void 0!==this.arguments.canUndo?this.arguments.canUndo:this.canUndo(),this.arguments.refresh=this.needRefresh(),this.arguments.canValidate=!1,this.validateArguments()},needRefresh:function(){return!1},execute:function(){},canUndo:function(){return!0},undo:function(){return!1},redo:function(){return this.execute()},validateArguments:function(){if(void 0===this.arguments)throw"Argument is not defined"},createElement:function(e,t){var i={properties:e,guid:e.guid,elements:t};return this.model.createElement(e.type,i)},isSpecialElement:function(e,t){var i="tabitem";if("offlinetab"===e)i="offlinetabitem";else if("adhoctab"===e)i="adhoctabitem";else{if("tab"!==e)return;i="tabitem"}var o=this.createElement({type:i,displayName:"Tab 1"});this.controller.isAdhocFormContext()||(o.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable("Tab 1",o.guid,"displayName")),t.addElement(o)},resolveResult:function(e){return"object"==typeof e&&e.done&&"resolved"==e.state()?bizagi.resolveResult(e):e},setXpathAdhoc:function(e){e.properties.displayName instanceof Object?xpath=bizagi.editor.utilities.getXPathByDisplayName(e.properties.displayName.i18n.default):xpath=bizagi.editor.utilities.getXPathByDisplayName(e.properties.displayName),xpath=xpath.substr(0,1).toLowerCase()+xpath.substr(1),e.properties.xpathAdhoc={xpath:xpath,relatedEntity:null}}}),bizagi.editor.command.extend("bizagi.editor.notUndoableCommand",{},{canUndo:function(){return!1}}),bizagi.editor.command.extend("bizagi.editor.refreshableCommand",{},{needRefresh:function(){return!0}}),bizagi.editor.observableClass.extend("bizagi.editor.commandfactory",{},{init:function(e){this._super(),this.controller=e},create:function(args){if(void 0===args.command)throw"The argument must contain a command to perform";try{var fn=eval("var bafn = function(args, controller, model) { \n return new bizagi.editor."+args.command+"Command({arguments: args, controller: controller, model: model }); \n};\nbafn"),command=fn(args,this.controller,this.controller.getModel());return command}catch(e){throw"Can't create a comand for "+args.command}}}),bizagi.editor.observableClass.extend("bizagi.editor.base.controller",{},{init:function(e){var t=this;this._super(),e=e||{},this.readyDefer=new $.Deferred,this._ResourcesServices=bizagi.editor.base.services.resourcesServices,t.commandfactory=new bizagi.editor.commandfactory(this),t.undoCommandStack=[],t.redoCommandStack=[],t.copyFormatStack=[],t.selectedElements={},t.communicationProtocol=bizagi.editor.communicationprotocol.factory,t.communicationProtocol.setContext(e.context),t.ctrlPressed=!1,t.newForm=null==e.data,t.context=e.context||"form",t.originalContext=bizagi.clone(t.context),t.contextInfo={xpath:{xpath:{baxpath:{xpath:"",contextentity:e.contextentity,scopedefinition:e.scopedefinition}}},guid:null},t.idForm=bizagi.editor.utilities.isGuidEmpty(e.idForm)?Math.guid():e.idForm,t.idParentForm=e.idParentForm,t.baseContextInfo=bizagi.clone(t.contextInfo),t.contextEntityType="enum"==e.contextentitytype?"parameter":e.contextentitytype,t.xpathNavigatorView=bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity,setTimeout(function(){t.initModels(e)},200)},initModels:function(e){var t,i,o,r,n=this,a=n.communicationProtocol.createProtocol({protocol:"getcontrolsdefinitions"}),s=n.communicationProtocol.createProtocol({protocol:"getfirstload"}),l=n.communicationProtocol.createProtocol({protocol:"checkflags",flags:{EnableCssClassProperty:!0,EnableShowAlwaysReverseAction:!0,EnableLetters:!0}}),d=n.communicationProtocol.createProtocol({protocol:"localizableresources"}),c=!1;n.isNewForm()||(c=n.communicationProtocol.createProtocol({protocol:"checkoutform"}).processRequest()),$.when(a.processRequest()).pipe(function(e){return t=e,s.processRequest()}).pipe(function(e){return i=e,l.processRequest()}).pipe(function(e){return o=e,d.processRequest()}).pipe(function(e){return r=e,c}).done(function(a){$.when(bizagi.localization.ready()).done(function(){var s=n.componentModels={},l=s.controls=new bizagi.editor.controls(t,o);bizagi=bizagi||{},bizagi.editor=bizagi.editor||{},bizagi.editor.flags=o,a=a||{},n.isInCheckout=a.isInCheckout,n.userInfo=a.userInfo,o.EnableCssClassProperty||l.disableControlProperties("EnableCssClassProperty"),e.isActivityForm=!(!n.isFormContext()&&!n.isStartFormContext())&&bizagi.util.parseBoolean(e.isActivityForm),n.model=new bizagi.editor.model({definitions:t,controls:l,context:e.context,contextentity:e.contextentity,scopedefinition:e.scopedefinition,isActivityForm:e.isActivityForm,hasOfflineForm:e.hasOfflineForm,isOfflineAsOnline:e.isOfflineAsOnline,version:e.version,flags:o,idParentForm:n.idParentForm,isVersionable:e.isVersionable,deployOnParent:e.deployOnParent,isNewForm:n.newForm,resources:r}),n.model.subscribe("refresh",function(){n.publish("refresh")}),n.model.subscribe("getDefaultDisplayName",function(e,t){return n.publish("getDefaultDisplayName",t)}),n.model.subscribe("getNodeInfo",function(e,t){return n.publish("getNodeInfo",t)}),n.model.subscribe("getContextXpath",function(e,t){return n.getContextXpath(t)}),n.model.subscribe("findXpathAttributes",function(e,t){return n.publish("findXpathAttributes",t)}),n.model.subscribe("resizeHeigthCanvas",function(e,t){return n.publish("resizeHeigthCanvas",t)}),n.model.subscribe("isReadOnlyForm",function(){return n.isReadOnlyForm()}),n.model.subscribe("getContextEntityType",function(){return n.getContextEntityType()}),n.model.subscribe("getControllerInfo",function(e,t){if(t.type&&"function"==typeof n[t.type])return n[t.type](t)}),n.model.subscribe("refreshElement",function(e,t){return n.publish("refreshElement",t)}),n.model.subscribe("formIsLoaded",function(e,t){return n.publish("formIsLoaded",t)}),n.model.subscribe("getIdForm",function(){return n.idForm}),n.model.subscribe("getOriginalModel",function(){return n.originalModel}),n.model.subscribe("getModel",function(){return n.getChangesetModel()}),n.model.subscribe("isNewForm",function(e,t){return n.isNewForm()}),n.model.subscribe("getIdParentForm",function(e,t){return n.idParentForm}),n.model.subscribe("setIdParentForm",function(e,t){n.setIdParentForm(t.idParentForm)});var d=[];(n.isFormContext()||n.isStartFormContext())&&$.each(l.controls,function(e,t){!t.type||"userfield"!=t.type&&"userfield"!=t.rendertype||(d.push(n.loadUserfield(t)),n.loadIconUserField(t))}),s.xpathNavigator=new bizagi.editor.component.xpathnavigator.model(i),s.controlsNavigator=new bizagi.editor.component.controlsnavigator.model,s.controlsNavigator.subscribe("isContextEntityApplication",function(){return n.isContextEntityApplication()}),s.controlsNavigator.subscribe("getContext",function(){return n.getContext()}),s.controlsNavigator.processData(l),s.layoutNavigator=new bizagi.editor.component.layoutnavigator.model,s.ribbon=new bizagi.editor.component.ribbon.model(n.model.getRibbonModelData()),n.processEntityId=s.xpathNavigator.getProcessEntityId(),$.when.apply($,d).done(function(){n.readyDefer.resolve()})})})},loadUserfield:function(userfieldDefinition){var defer=$.Deferred(),requestInfo={actiontype:"GetUserfieldDependencies",parameters:[{key:"userfieldId",value:userfieldDefinition.guid}]};return $.when(bizagi.editor.base.services.resourcesServices.getResource(requestInfo)).done(function(data){try{var definition=data.result.parameters[0].value;try{data=eval(definition)}catch(e){bizagi.log("Could not parse result userfield1 "+userfieldDefinition.name,e.message)}$.each(data,function(index,val){if("js"==val.type)try{eval(val.content)}catch(e){bizagi.log("Could not parse result userfield3 "+userfieldDefinition.name,e.message)}"css"==val.type&&bizagi.util.loadStyle(val.content,userfieldDefinition.guid)})}catch(e){bizagi.log("Could not parse result userfield "+userfieldDefinition.name,e.message)}}).pipe(function(){defer.resolve()}),defer.promise()},loadIconUserField:function(e){var t=$.Deferred();e.icon=t.promise();var i={actiontype:"GetUserfieldIconDependencies",parameters:[{key:"userfieldId",value:e.guid},{key:"density",value:"HDPI"},{key:"size",value:"SMALL"}]};$.when(bizagi.editor.base.services.resourcesServices.getResource(i)).done(function(i){var o=i.result.parameters[0].value;bizagi.util.loadIconStyle(o,e.name),e.icon=t.resolve(o)})},ready:function(){return this.readyDefer.promise()},executeCommand:function(e){var t,i=this;if(t=this.commandfactory.create(e))return $.when(t.execute()).pipe(function(o){return o&&!e.error?(e.success=!0,i.onCommandExecuted(e),(void 0===e.canUndo||e.canUndo)&&"getElementDesignProperty"!==t.arguments.command&&(i.undoCommandStack.push(t),i.redoCommandStack.length>0&&i.redoCommandStack.splice(0,i.redoCommandStack.splice.length))):(e.success=!1,e.result={error:!0,message:e.error}),e.result})},onCommandExecuted:function(e){this.publish("commandExecuted",e)},hasUndo:function(){return this.undoCommandStack.length>0},undo:function(){var e,t;return!!(e=this.undoCommandStack.pop())&&((t=e.undo())?this.redoCommandStack.push(e):this.undoCommandStack.push(e),t)},hasRedo:function(){return this.redoCommandStack.length>0},redo:function(){var e,t,i;return!!(e=this.redoCommandStack.pop())&&(t=e.redo(),i=$.extend({},e.arguments,{redoed:!0}),this.onCommandExecuted(i),this.undoCommandStack.push(e),t)},getControlsModel:function(){return this.componentModels.controls},isContextEntityApplication:function(){return"application"==this.contextEntityType},getControlsNavigatorModel:function(){var e=this.context;return this.componentModels.controlsNavigator.context[e]},getControlDisplayName:function(e){return this.componentModels.controlsNavigator.getControlDisplayName(e)},getXpathNavigatorModel:function(e){var t=(e=e||{}).context,i=this.componentModels.xpathNavigator;if(null!=t)return""==t?i:i.getSubModel(t);var o=this.contextInfo;return i.getSubModel(o.xpath)},getXpathNavigatorModelGrid:function(e){var t=(e=e||{}).context;return null!=t?""==t?this.xpathNavigatorModelGrid:this.xpathNavigatorModelGrid.getSubModel(t):this.xpathNavigatorModelGrid},getLayoutNavigatorModel:function(){return this.componentModels.layoutNavigator},getRibbonModel:function(){return this.componentModels.ribbon},getRenderingModel:function(){return this.model.getRenderingModel()},getPersistenceModel:function(){return this.model.getPersistenceModel()},getChangesetModel:function(){return this.model.getChangeset()},setResources:function(e){"object"==typeof e&&this.model.setResources(e)},getModel:function(){return this.model},getCommandsModel:function(){var e=this,t=new $.Deferred;return $.when(e.model.getCommandsModel()).done(function(i){e.commandsModel=bizagi.clone($.extend(i,{flags:e.model.getFlags(),isReadOnly:e.isReadOnlyForm()})),t.resolve(e.commandsModel)}),t.promise()},getFlags:function(){return this.model.getFlags()},getCommandsEditorModel:function(){var e=new $.Deferred;return $.when(this.getCommandsModel()).done(function(t){e.resolve(new bizagi.editor.component.commandseditor.model(t))}),e.promise()},copyFormatHasElement:function(){return this.copyFormatStack.length>0},getCopyFormatElement:function(){return this.copyFormatStack[0]},isOfflineAsOnline:function(){return this.model.checkOfflineAsOnline()},setOfflineAsOnline:function(e){this.model.updateOfflineAsOnline(e)},pushCopyFormat:function(e){this.copyFormatStack.push(e)},popCopyFormat:function(){return this.copyFormatStack.pop()},setCommandsModel:function(e){return this.model.setCommandsModel(e)},setOriginalModel:function(e){var t=this;$.when(t.model.ready()).done(function(){t.originalModel=e||t.getChangesetModel(),t.publish("refreshRibbon",{})})},setXpathNavigatorModelGrid:function(e){this.xpathNavigatorModelGrid=e},setUserInfo:function(e){this.userInfo=e},getContext:function(){return this.context},getOriginalContext:function(){return this.originalContext},getContextInfo:function(){return{xpath:this.contextInfo.xpath,guid:this.contextInfo.guid||this.model.getGuid()}},getContextXpath:function(e){var t=e.xpath;if(this.isGridContext()){var i=bizagi.editor.utilities.resolveComplexXpath(this.contextInfo.xpath);return t?i+"."+t:i}return t},getUserInfo:function(){return this.userInfo},changeContext:function(e){this.context=e.context,"adhocgrid"===e.context?this.contextInfo.xpathAdhoc=e.xpathAdhoc||this.baseContextInfo.xpathAdhoc:this.contextInfo.xpath=e.xpath||this.baseContextInfo.xpath,this.contextInfo.guid=e.guid||this.baseContextInfo.guid},isFormContext:function(){return"form"===this.context},isTemplateContext:function(){return"template"===this.context},isStartFormContext:function(){return"startform"===this.context},isAdhocFormContext:function(){return"adhocform"===this.context||"adhocgrid"===this.context},isOfflineContext:function(){return"offlineform"===this.context||"offlinegrid"===this.context},isOfflineFormContext:function(){return"offlineform"===this.context},isGridContext:function(){return"grid"===this.context||"offlinegrid"===this.context||"adhocgrid"===this.context},searchDependencies:function(e){return this.executeCommand({command:"searchDependencies",guids:e.guids,message:e.message})},isSearchFormContext:function(){return"searchform"===this.context},isQueryFormContext:function(){return"queryform"===this.context},isActivityForm:function(){return this.model.checkActivityForm()},hasOfflineForm:function(){return this.model.checkOfflineForm()},isReadOnlyForm:function(){return this.isInCheckout},setReadOnlyFlag:function(e){this.isInCheckout=e},thereAreChangesInForm:function(){var e=this;return $.when(e.model.ready()).pipe(function(){return!bizagi.editor.utilities.objectEquals(e.originalModel,e.getChangesetModel())})},toogleXPathNavigatorView:function(){this.xpathNavigatorView=this.xpathNavigatorView===bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity?bizagi.editor.component.xpathnavigator.model.view.allView:bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity},getXpathNavigatorView:function(){return this.xpathNavigatorView},getProcessEntityId:function(){return this.processEntityId},addSelectedElement:function(e,t){this.selectedElements[e]=t},removeSelectedElement:function(e){e?this.selectedElements[e]&&delete this.selectedElements[e]:this.selectedElements={}},getSelectedElements:function(e){return e?this.selectedElements[e]:this.selectedElements},getGuidsSelected:function(){var e=[];for(var t in this.selectedElements)e.push(t);return e},getContextEntityType:function(){return this.contextEntityType},thereAreMultiselection:function(){var e=0;for(var t in this.selectedElements)e++;return e>1},setNewForm:function(e){this.newForm=e},setIdParentForm:function(e){this.idParentForm=e},setCtrlKey:function(e){this.ctrlPressed=e},isCtrlKeyPressed:function(e){return this.ctrlPressed},isNewForm:function(){return this.newForm},hasEnableCommandsEditor:function(){return"searchform"!==this.context&&"queryform"!==this.context},setLastInsertedElement:function(e){this.lastInsertedElement=e},getLastInsertedElement:function(){return this.lastInsertedElement},getIdForm:function(){return this.idForm}}),bizagi.editor.base.controller.extend("bizagi.editor.adhoc.controller",{},{initModels:function(e){var t,i,o,r,n=this;n.adhocProcessId=e.adhocProcessId;var a=n.communicationProtocol.createProtocol({protocol:"availablelanguages"}),s=n.communicationProtocol.createProtocol({protocol:"getcontrolsdefinitions"}),l=n.getCommunicationProtocolForXpathNavigator(),d=n.communicationProtocol.createProtocol({protocol:"getlayoutsdefinitions"});$.when(s.processRequest()).pipe(function(e){return t=e,l.processRequest()}).pipe(function(e){return(i=e).context="adhocform",d.processRequest()}).pipe(function(e){return o=e,a.processRequest()}).done(function(a){r=a,$.when(bizagi.localization.ready()).done(function(){var a=n.componentModels={},s=a.controls=new bizagi.editor.controls(t);bizagi=bizagi||{},bizagi.editor=bizagi.editor||{},bizagi.editor.flags={},n.model=new bizagi.editor.model({definitions:t,controls:s,context:e.context,contextentity:null,scopedefinition:null,isActivityForm:!1,version:"1.0",languages:r,flags:[],idParentForm:n.idParentForm}),n.model.subscribe("refresh",function(){n.publish("refresh")}),n.model.subscribe("getDefaultDisplayName",function(e,t){return n.publish("getDefaultDisplayName",t)}),n.model.subscribe("getNodeInfo",function(e,t){return n.publish("getNodeInfo",t)}),n.model.subscribe("getContextXpath",function(e,t){return n.getContextXpath(t)}),n.model.subscribe("findXpathAttributes",function(e,t){return n.publish("findXpathAttributes",t)}),n.model.subscribe("resizeHeigthCanvas",function(e,t){return n.publish("resizeHeigthCanvas",t)}),n.model.subscribe("isReadOnlyForm",function(){return n.isReadOnlyForm()}),n.model.subscribe("getContextEntityType",function(){return n.getContextEntityType()}),n.model.subscribe("getControllerInfo",function(e,t){if(t.type&&"function"==typeof n[t.type])return n[t.type](t)}),n.model.subscribe("getIdForm",function(){return n.idForm}),n.model.subscribe("getOriginalModel",function(){return n.originalModel}),n.model.subscribe("getModel",function(){return n.getChangesetModel()}),a.xpathNavigator=new bizagi.editor.component.xpathnavigator.model(i),a.controlsNavigator=new bizagi.editor.component.controlsnavigator.model,a.controlsNavigator.subscribe("isContextEntityApplication",function(){return n.isContextEntityApplication()}),a.controlsNavigator.subscribe("getContext",function(){return n.getContext()}),a.controlsNavigator.processData(s),a.layoutNavigator=new bizagi.editor.component.layoutnavigator.model(o),a.ribbon=new bizagi.editor.component.ribbon.model(n.model.getRibbonModelData()),n.readyDefer.resolve()})})},getCommunicationProtocolForXpathNavigator:function(){return this.communicationProtocol.createProtocol({protocol:"getfirstload",adhocProcessId:this.adhocProcessId})},getAdhocXpathNavigatorModelGrid:function(){var e=new $.Deferred,t=this.communicationProtocol.createProtocol({protocol:"getchildrennodes",node:{entityContext:"adhocgrid",guidRelatedEntity:this.adhocProcessId,xpathAdhoc:this.contextInfo.xpathAdhoc}});return $.when(t.processRequest()).done(function(t){var i=new bizagi.editor.component.xpathnavigator.model(t);e.resolve(i)}),e.promise()},getXpathNavigatorFromServer:function(){var e=this,t=$.Deferred(),i=e.getCommunicationProtocolForXpathNavigator();return $.when(i.processRequest()).done(function(i){i.context="adhocform",e.componentModels.xpathNavigator=new bizagi.editor.component.xpathnavigator.model(i),t.resolve()}),t.promise()}}),$.Widget.prototype.destroy=function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},bizagi.editor.observableClass.extend("bizagi.editor.view",{},{init:function(e){var t=this;this._super(),"adhocform"!=e.context?(this.controller=new bizagi.editor.base.controller(e),t.controller.subscribe("getNodeInfo",function(e,i){return t.getNodeInfo(i)}),t.controller.subscribe("findXpathAttributes",function(e,i){return t.findXpathAttributes(i)})):this.controller=new bizagi.editor.adhoc.controller(e),t.controller.subscribe("commandExecuted",function(e,i){t.commandExecuted(i)}),t.controller.subscribe("refresh",function(e,i){t.refresh()}),t.controller.subscribe("showControlWizard",function(e,i){return t.showControlWizard(i)}),t.controller.subscribe("getExternalData",function(e,i){return t.getExternalData(i)}),t.controller.subscribe("getDefaultDisplayName",function(e,i){return t.getDefaultDisplayName(i)}),t.controller.subscribe("resizeHeigthCanvas",function(e,i){return t.refreshCanvas(i)}),t.controller.subscribe("refreshElement",function(e,i){return t.refreshElement(i)}),t.controller.subscribe("formIsLoaded",function(e,i){return t.formIsLoaded()}),t.controller.subscribe("getMainPanel",function(e,i){return t.getMainPanel()}),t.controller.subscribe("refreshRibbon",function(e,i){t.refreshRibbon()})},ready:function(){return this.controller.ready()},refresh:function(e){var t=this;e=e||{},$.when(t.preRender(e)).pipe(function(){t.render(e),t.postRender()})},executeCommand:function(e){var t=this;e.command&&(e.gridGuid="changeContext"===e.command?t.guid:null);var i=$.when(t.controller.executeCommand(e)).pipe(function(i){return e.success&&e.refresh&&t.refresh(e),i});return"object"==typeof i&&i.done&&"resolved"==i.state()?bizagi.resolveResult(i):i},undo:function(){this.controller.undo()&&this.refresh()},redo:function(){this.controller.redo()&&this.refresh()},render:function(){},showControlWizard:function(){},getExternalData:function(){},commandExecuted:function(e){"function"==typeof this[e.command+"Executed"]&&this[e.command+"Executed"](e.result,e)},refreshLayout:function(){this.layoutComponent.refresh()}}),bizagi.editor.view.extend("bizagi.editor.modelerView",{},{init:function(e){var t=this;e=e||{},t.renderingMode="design",t.validateForm=!1,t._super(e),t.currentTabIndex=0,bizagi.editorLanguage={displayname:"default",IsRightToLeft:!1,key:"default"};var i=$("body"),o={message:bizagi.localization.getResource("formmodeler-component-wait-message-loading-form")},r=new bizagi.editor.component.wait.presenter({model:o,renderArea:i});$.when(r.render(),this.controller.ready()).done(function(){$.when(t.processLayout(e)).done(function(){setTimeout(function(){r.destroy()},100)})}),e.data?$.when(t.load(e.data,e.mustRegenerateGuids)).done(function(){t.setOriginalModel()}):t.setOriginalModel(),e.autoGenerate&&t.autoGenerate()},load:function(e,t){var i=this,o=new $.Deferred;return $.when(this.controller.ready()).pipe(function(){return i.executeCommand({command:"loadModel",dataModel:e,canUndo:!1,mustRegenerateGuids:t})}).done(function(){if(t){var e=i.controller.getModel();$.when(e.ready()).pipe(function(){return i.executeCommand({command:"duplicateDisplayNameForm",canUndo:!1})}).done(function(){var t=Math.guid(),o=bizagi.editor.communicationprotocol.factory,r=i.controller.getChangesetModel().changeSet;e.isVersionable&&(r.push({action:"merge",deployOnParent:e.mustSetDeployOnParent(),id:t,name:"FormClass_"+t,type:"FormClass",parentId:i.controller.idParentForm,modifiedByUser:BIZAGI_USER,content:JSON.stringify({})}),r[0].parentId=t,i.controller.setIdParentForm(t));var n=o.createProtocol({protocol:"saveform",changeset:{changeSet:r},idForm:i.controller.getIdForm()});$.when(n.processRequest()).pipe(function(){return i.formIsLoaded()}).done(function(){setTimeout(function(){i.controller.setOriginalModel(),i.refreshRibbon()},100)})})}o.resolve()}),o.promise()},autoGenerate:function(){var e=this;$.when(this.controller.ready()).done(function(){$.when(e.controller.getXpathNavigatorModel()).pipe(function(e){return e.ready()}).done(function(t){var i;if(t.getProcessEntityId()){t.getProcessEntityModel();var o=t.getRootNode()||{};$.isArray(o.nodes)&&(i=o.nodes[0])&&$.when(t.getChildren(i.id)).done(function(){e.executeCommand({command:"addEntityChildren",node:i,canUndo:!1})})}else i=t.getRootNode(),e.executeCommand({command:"addEntityChildren",node:i,canUndo:!1})})})},save:function(){var e={command:"saveModel",dataModel:{},canUndo:!1};return this.executeCommand(e),e.dataModel},validateAndSaveForm:function(){this.performSave(!0)},updateForm:function(e){var t;t={command:"updateModel",data:e,canUndo:!1},this.executeCommand(t)},setOriginalModel:function(){var e=this;$.when(this.controller.ready()).done(function(){e.controller.setOriginalModel()})},processLayout:function(e){var t=this,i=new $.Deferred;t.configureHtmlPage(e),t.mainContainer=$("<form-modeler />").appendTo(e.canvas||"body"),t.mainContainer.addClass("container-layout");var o=t.layoutComponent=new bizagi.editor.component.layout.presenter({canvas:t.mainContainer,context:e.context,isActivityForm:e.isActivityForm});return $.when(o.render()).done(function(){bizagi.form.modeler.params.reviewMode&&($(".wrapper-left-panel").css("margin-top","20px"),$(".wrapper-left-panel").css("height",$(".wrapper-left-panel").outerHeight()+54+"px"),$(".wrapper-main-panel").css("padding","0px 0px 0 305px"),t.mainContainer.find(".left-panel li").eq(1).remove(),t.mainContainer.find(".left-panel li").eq(1).remove()),setTimeout(function(){t.configureLeftPane(),t.drawRibbon(),t.controller.isSearchFormContext()&&t.drawSearchResultEditor(),t.controller.isActivityForm()&&setTimeout(function(){t.drawButtonEditor()},100),t.configureKeyHandlers(),$.when(t.configureRenderingView()).done(function(){i.resolve()})},100)}),i.promise()},configureHtmlPage:function(){$("html").addClass("biz-work-area"),$("body").addClass("biz-font").addClass("biz-normal-font").addClass("biz-text-color"),$("body").attr("oncontextmenu","return false")},configureLeftPane:function(){var e=this;$.when(e.drawControlsNavigator(),e.drawXpathNavigator(),e.drawLayoutNavigator(),e.drawBanner()).done(function(){e.mainContainer.find(".left-panel").tabs({beforeActivate:function(t,i){var o=$("a",i.newTab).data("rendering-mode");e.hidePropertyBox(),e.needsRedrawAfterTabChange(i.newTab.index())&&(e.currentSelectedElement=null,e.controller.removeSelectedElement(),e.renderingMode=o,e.render(o)),e.currentTabIndex=i.newTab.index(),e.setBannerVisibility(i)}}),e.setBannerVisibility()})},configureKeyHandlers:function(){var e=this;$(document).keydown(function(e){}).keyup(function(t){46===t.keyCode&&($(document.activeElement).is("input, textarea")||bizagi.form.modeler.params.reviewMode||e.deleteElement())}),$(document).on("keydown",function(t){17==t.keyCode&&e.controller.setCtrlKey(!0)}),$(document).on("keyup",function(t){e.controller.isCtrlKeyPressed()&&e.controller.setCtrlKey(!1)})},needsRedrawAfterTabChange:function(e){return this.currentTabIndex<2&&2===e||2===this.currentTabIndex&&e<2},setBannerVisibility:function(e){"show"===(e?$("a",e.newTab).attr("data-banner"):"hide")?this.showBanner():this.hideBanner()},preRender:function(e){var t=new $.Deferred;return this.validateForm&&e.canValidate?this.processValidations({canRefresh:!1}):t.resolve()},render:function(e,t){var i=this.controller.getContext();"form"==i?this.renderForm(e,t):"mobileform"==i?this.renderForm(e,t):"searchform"==i?this.renderSearchForm(t):"grid"==i||"offlinegrid"==i||"adhocgrid"==i?this.renderGridColumnEditor():"offlineform"==i?this.renderForm(e,t):"queryform"==i?this.renderForm(e,t):"startform"==i?this.renderForm(e,t):"adhocform"==i&&this.renderForm(e,t)},postRender:function(){var e=null;this.controller.thereAreMultiselection()&&(e=bizagi.editor.utilities.getGuidEmpty()),this.refreshRibbon(e)},refreshCanvas:function(){var e,t,i,o,r=this.getMainPanel(),n=this.getMainContainer();e=$(".wrapper-main-scroll",n),t=$("> .ui-bizagi-container-form",r),i=$(".top-scroll-grad",e),o=$(".bottom-scroll-grad",e);var a=parseFloat(r.css("padding-top"))+parseFloat(r.css("padding-bottom")),s=Math.floor(1*e.height()-a),l="adhocform"==this.controller.getContext()?$(".c-breadcrumb").height():0,d="adhocform"==this.controller.getContext()?e.width()+20:e.width(),c=e.position().top+l,u=e.position().top+e.outerHeight(!0)-o.height()+l;t.prop("scrollHeight")>s?(r.addClass("biz-auto-height"),o.css("top",u).css("width",d),o.show(),i.css("top",c).css("width",d),i.show()):(o.hide(),i.hide(),r.removeClass("biz-auto-height")),r.hasClass("biz-auto-height")&&($(".top-scroll-grad",e).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollTopInterval(e,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}),$(".bottom-scroll-grad",e).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollBottomInterval(e,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}))},renderForm:function(e,t){var i=this,o=$("#main-panel");i.refreshRenderingView(e,t),i.controller.isActivityForm()&&(i.refreshButtonEditor(),"design"==i.renderingMode&&o.on("widgetComplete",function(){i.refreshCanvas()}),i.refreshCanvas(),setTimeout(function(){i.refreshCanvas()},500))},renderSearchForm:function(e){this.refreshRenderingView(e),this.refreshSearchFormResult()},renderGridColumnEditor:function(){this.refreshGridColumnEditor()},enableLayoutTab:function(){this.mainContainer.find(".left-panel").tabs("option","disabled",[])},disableLayoutTab:function(){this.mainContainer.find(".left-panel").tabs("option","disabled",[2])},removeFormEvents:function(){this.unsubscribeAll()},getMainPanel:function(){return this.mainContainer.find("#main-panel")},getMainContainer:function(){return this.mainContainer}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawXpathNavigator:function(){var e=this,t=$("<div />").addClass("bizagi_editor_xpathnavigator_container").appendTo(e.getMainContainer().find("#left-tab-data-bind"));$.when(e.executeCommand({command:"getXpathNavigatorModel"}),e.controller.getContext()).pipe(function(i,o){e.xpathNavigatorModel=i;var r=e.xpathNavigator=new bizagi.editor.component.xpathnavigator.presenter({canvas:t,model:i,scope:o});return e.controller.isGridContext()&&e.controller.setXpathNavigatorModelGrid(i),r.subscribe("getMainContainer",function(t,i){return e.getMainContainer(i)}),r.subscribe("getMainPanel",function(t,i){return e.getMainPanel(i)}),e.attachHandlersXpathNavigator(),r.render({isReadOnly:e.controller.isReadOnlyForm(),scope:e.controller.getContext()})})},attachHandlersXpathNavigator:function(){var e=this,t=e.xpathNavigator;e.controller.isReadOnlyForm()||(t.subscribe("nodeDoubleClick",function(t,i){e.onNodeDoubleClick(i)}),t.subscribe("contextMenuItemClick",function(t,i){e.onContextMenuItemClick(i)}),t.subscribe("controlRefreshCanvas",function(t,i){e.refreshCanvas(i)}))},showElementXpath:function(e){return e&&this.changeXpathNavigatorView(bizagi.clone(e)),this.xpathNavigator.showXpath(e)},showElementGuid:function(e,t){return t&&this.changeXpathNavigatorView(bizagi.clone(t)),this.xpathNavigator.showXpathByGuid(e,t)},showMetadataXpath:function(e){return this.xpathNavigator.showMetadataXpath(e)},changeXpathNavigatorView:function(e){return!this.controller.isGridContext()&&("template"!=this.controller.getContext()&&(!(!(e=bizagi.editor.utilities.resolveComplexXpath(e))||(e=e.split(".")[0],this.xpathNavigatorModel.processEntityRelated(e)||this.controller.getXpathNavigatorView()!==bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity))&&(this.performViewAll(this.xpathNavigatorModel.getRootNode()),!0)))},refreshXpathNavigator:function(e){var t=this;$.when(t.executeCommand({command:"getXpathNavigatorModel"})).done(function(i){t.controller.isGridContext()&&t.controller.setXpathNavigatorModelGrid(i);var o={model:e&&e.model||i,context:e?e.context:void 0,scope:t.controller.getContext(),isReadOnly:t.controller.isReadOnlyForm()};t.xpathNavigator.render(o)})},reloadXpathNode:function(e){var t=this;e&&$.when(t.controller.getXpathNavigatorModel()).done(function(i){i&&$.when(i.getChildren(e.id,!0),i.invalidateScopeAttributes()).done(function(){t.refreshXpathNavigator()})})},insertXpathElement:function(e){var t={command:"insertElementFromXpathNavigator",data:{renderType:e.renderType,nodeSubtype:e.nodeSubtype,name:e.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(e.xpath,e.contextScope,e.isScopeAttribute,e.guidRelatedEntity),guid:e.guid}};return-1!==e.renderType.indexOf("adhoc")&&(t.data.context=-1!==e.renderType.indexOf("adhoccolumn")?"adhocgrid":"adhocform",t.data.displayName=e.displayName,e.parent&&(t.data.parent={guidRelatedEntity:e.parent.guidRelatedEntity}),e.guidRelatedEntity&&(t.data.guidRelatedEntity=e.guidRelatedEntity),t.data.entityContext=e.entityContext,e.predefinedValues&&(t.data.predefinedValues=e.predefinedValues)),this.executeCommand(t)},onNodeDoubleClick:function(e){this.controller.isTemplateContext()||this.insertXpathElement(e)},onContextMenuItemClick:function(e){var t=e.action;"editentity"==t&&this.performEditEntity(e.node),"viewall"==t&&this.performViewAll(e.node),"refresh"==t&&this.performRefresh(e.node),"addelement"==t&&this.performAddElement(e.node),"addchildelements"==t&&this.performAddChildElements(e.node),"editvalues"==t&&this.performEditValues(e.node),"newForm"==t&&this.performNewForm(e.node)},performEditEntity:function(e){var t=this,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"editentity",id:e.guidRelatedEntity});$.when(i.processRequest()).done(function(){t.reloadXpathNode(e)})},performViewAll:function(e){var t=this;e.setCaptionViewContextMenu(),$.when(t.executeCommand({command:"getXpathNavigatorModel",toogleView:!0})).done(function(e){t.xpathNavigator.render({model:e,scope:t.controller.getContext()})})},performRefresh:function(e){this.reloadXpathNode(e)},performAddElement:function(e){this.insertXpathElement(e)},performAddChildElements:function(e){this.executeCommand({command:"addEntityChildren",node:e})},performEditValues:function(e){var t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"editentityvalues",id:e.guidRelatedEntity});$.when(t.processRequest()).done(function(){})},performNewForm:function(e){var t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"newform",node:e});$.when(t.processRequest()).done(function(){})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawDecorator:function(e){var t=this,i=e.element;t.removeDecorator();var o=$("<div />").appendTo(i),r=t.executeCommand({command:"getDecoratorModel",guid:e.guid}),n=t.decorator=new bizagi.editor.component.decorator.presenter({canvas:o,data:e,model:r});n.subscribe("showProperties",function(e,i){t.onShowProperties(i)}),n.subscribe("showXpathNavigator",function(e,i){t.onShowXpathNavigator(i)}),n.subscribe("deleteElement",function(e,i){t.onDeleteElement(i)}),n.subscribe("openNestedForm",function(e,i){t.onOpenNestedForm(i)}),n.subscribe("buttonClicked",function(e,i){t.onButtonClicked(i)}),n.subscribe("close",function(){o.detach()}),$.when(n.render()).done(function(){e.IsOnClickEvent&&t.drawPropertyBox({guid:e.guid})})},destroyDecorator:function(){this.decorator&&this.decorator.destroy()},removeDecorator:function(){$(".bizagi_editor_component_decorator").length>0&&$(".bizagi_editor_component_decorator").detach()},onShowProperties:function(e){this.drawPropertyBox({guid:e.guid})},onShowXpathNavigator:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.guid}),o=(t.controller.model.getElement(e.guid).propertyModel.indexedProperties||{}).xpath||{},r={};r.typeFilter=o["bas-type"];var n=o["editor-parameters"]||{};if(n.types){r.types=n.types;var a={typeEditor:r.typeFilter,editorParameters:n};t.editorValidations[e.guid]=a}"object"==typeof i.xpath&&t.changeXpathNavigatorView(i.xpath),$.when(t.controller.getXpathNavigatorModel()).done(function(o){var n=new bizagi.editor.component.xpathnavigator.presenter({model:o}),a=i.xpath;n.subscribe("nodeDoubleClick",function(i,o){t.changeXpathPropertyForElement(e.guid,"xpath",o),n.closePopup()}),n.renderPopup({position:{left:e.position.left,top:e.position.top+e.position.height},xpath:a,filter:r})})},changeXpathForElement:function(e,t){var i={command:"changeProperty",guid:e,property:"xpath",value:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)};this.executeCommand(i)},onDeleteElement:function(e){this.hidePropertyBox(),this.executeCommand({command:"removeElementById",guid:e})},onButtonClicked:function(e){var t=this.decorator.getDecoratedElement();if("ConfigGrid"===e.button)this.drawGridColumnEditor({guid:e.guid,element:t}),this.hidePropertyBox(),this.executeCommand({command:"changeContext",guid:e.guid,context:this.getGridContext()});else if("EditNestedForm"===e.button){var i={},o=this.executeCommand({command:"getElementProperties",guid:e.guid});i.refForm=o.form,i.protocol="opennestedform",i.idForm=e.guid,bizagi.editor.communicationprotocol.factory.createProtocol(i).processRequest()}else"AddForm"===e.button?this.drawSelectFormEditor({guid:e.guid,element:t,property:"add.form",caption:"Add Form"}):"EditForm"===e.button&&this.drawSelectFormEditor({guid:e.guid,element:t,property:"edit.form",caption:"Edit Form"})},getGridContext:function(){return this.controller.isOfflineFormContext()?"offlinegrid":this.controller.isAdhocFormContext()?"adhocgrid":"grid"}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{changeContextExecuted:function(e,t){this.refreshControlsNavigator(),this.refreshXpathNavigator({context:t.context}),"grid"!=t.context&&"offlinegrid"!=t.context&&"adhocgrid"!=t.context||(this.formContainer.disableSortablePlugin(),this.disableLayoutTab()),"form"!=t.context&&"offlineform"!=t.context&&"adhocform"!=t.context||this.enableLayoutTab()},updateModelExecuted:function(e){"CreateForm"===e.action?(this.validateForm&&this.processValidations({canRefresh:!1}),this.drawPropertyBox({guid:e.guid})):"CreateFormFromXpath"===e.action?this.reloadXpathNode({id:e.idNode}):"OpenWizardTemplates"===e.action&&this.drawPropertyBox({guid:e.guid})},changePropertyExecuted:function(e,t){var i=this,o=t.guid;if("xpath"==t.property){var r=i.controller.model.getElement(o);i.isGrid(r.type)&&(r.deleteColumns&&r.deleteColumns(),i.render())}if("showinprocesses"==t.property&&0==t.value){var n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getdependency"});$.when(n.processRequest()).done(function(e){if(!e){var o=bizagi.localization.getResource("templatedesigner-dependency");$.when(bizagi.showMessageBox(o),i.controller.executeCommand({command:"changeProperty",guid:t.guids[0],property:t.property,value:!0})).done(function(){i.drawPropertyBox({guid:t.guids[0],redraw:!0})})}})}if(t.refreshProperties){var a=t.guid;$.isArray(t.guids)&&(a=t.guids[0]),i.drawPropertyBox({guid:a,redraw:!0})}},changeMultiplePropertiesExecuted:function(e,t){t.refreshProperties&&this.drawPropertyBox({guid:t.guid,redraw:!0})},loadWidgetsExecuted:function(){this.refreshControlsNavigator()},formValidationsExecuted:function(e){$.isEmptyObject(e)||(this.validateForm=!0)},isGrid:function(e){return"grid"==e||"groupedgrid"===e}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawControlsNavigator:function(){var e=this,t=$("<div />").appendTo(e.getMainContainer().find("#left-tab-minitoolbar"));$.when(e.controller.getControlsNavigatorModel()).pipe(function(i){var o=e.controlsNavigator=new bizagi.editor.component.controlsnavigator.presenter({canvas:t,model:i});return o.subscribe("getMainPanel",function(t,i){return e.getMainPanel()}),o.subscribe("getMainContainer",function(t,i){return e.getMainContainer()}),e.attachHandlersControlsNavigator(),o.render({isReadOnly:e.controller.isReadOnlyForm(),isAdhocFormContext:e.controller.isAdhocFormContext()})})},attachHandlersControlsNavigator:function(){var e=this,t=e.controlsNavigator;e.controller.isReadOnlyForm()||(t.subscribe("controlDoubleClick",function(t,i){e.onControlDoubleClick(i)}),t.subscribe("controlRefreshCanvas",function(t,i){e.refreshCanvas(i)}))},onControlDoubleClick:function(e){this.executeCommand({command:"insertElementFromControlsNavigator",data:e})},refreshControlsNavigator:function(){var e=this;$.when(e.controller.getControlsNavigatorModel()).done(function(t){e.controlsNavigator&&e.controlsNavigator.render({model:t,isReadOnly:e.controller.isReadOnlyForm()})})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawBanner:function(e){var t=this,i=t.getMainContainer(),o=$("<div />").appendTo(i.find(".left-panel")),r={element:i.find(".left-panel")},n=t.banner=new bizagi.editor.component.banner.presenter({canvas:o,data:r});return n.subscribe("onBannerClick",function(e,i){t.onBannerClick(i)}),n.subscribe("onBannerOptionClick",function(e,i){t.onBannerOptionClick(i)}),n.render()},hideBanner:function(){this.banner.hide()},showBanner:function(){(this.controller.isFormContext()||this.controller.isStartFormContext())&&this.banner.show()},destroy:function(){},onBannerClick:function(e){this.performstore()},onBannerOptionClick:function(e){"function"==typeof this["perform"+e.key]&&this["perform"+e.key]()},performstore:function(){var e=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"openwidgetstore"});$.when(t.processRequest()).done(function(t){if(t){var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getwidgets"});$.when(i.processRequest()).done(function(t){t&&e.executeCommand({command:"loadWidgets",controls:t}),e.destroy()})}})},performupload:function(){var e=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"installwidget"});$.when(t.processRequest()).done(function(){e.destroy()})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{mappingContext:{grid:"form",offlinegrid:"offlineform"}},{drawGridColumnEditor:function(e){var t=this,i=e.element,o=$("#main-panel");t.controller.removeSelectedElement(),$.when(t.executeCommand({command:"getGridColumnModel",guid:e.guid})).done(function(r){var n=t.gridcolumneditor=new bizagi.editor.component.gridcolumneditor.presenter({gridModel:r,guid:e.guid,renderArea:o}),a=i.offset();n.render({options:{top:a.top,left:a.left,height:i.outerHeight(),width:i.outerWidth()},guidSelected:t.controller.getGuidsSelected()}),n.subscribe("moveColumn",function(e,i){t.onMoveGridColumn(i)}),n.subscribe("insertControl",function(e,i){t.onInsertControlColumn(i)}),n.subscribe("insertXpath",function(e,i){t.onInsertXpathColumn(i)}),n.subscribe("selectColumn",function(e,i){t.onSelectGridColumn(i)}),n.subscribe("unselectColumn",function(e,i){t.onUnselectGridColumn(i)}),n.subscribe("showContextMenu",function(e,i){t.onShowGridColumnContextMenu(i)}),n.subscribe("performChangesInModel",function(e,i){t.onPerformChangesInModel(i)}),n.subscribe("performValidationsInModel",function(e,i){t.onPerformValidationsInModel(i)}),n.subscribe("cancelChangesInModel",function(e,i){t.onCancelChangesInModel(i)}),n.subscribe("checkCtrlKey",function(e,i){return t.controller.isCtrlKeyPressed()}),n.subscribe("processSelectedColumns",function(e,i){t.onProcessSelectedColumns(i)}),n.subscribe("updateDesignAttributesColumn",function(e,i){t.onUpdateDesignAttributesColumn(i)})})},refreshGridColumnEditor:function(){var e=this.gridcolumneditor,t=this.controller.getGuidsSelected();e&&$.when(this.executeCommand({command:"getGridColumnModel",guid:e.getGuid()})).done(function(i){e.refresh({gridModel:i,guidSelected:t})})},onInsertXpathColumn:function(e){var t=e.data,i={command:"insertElementFromXpathNavigator",data:{context:t.context,renderType:t.renderType,nodeSubtype:t.nodeSubtype,name:t.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)},position:e.position,parent:e.guid};-1!==t.renderType.indexOf("adhoccolumn")&&(i.data.context="adhocgrid",i.data.displayName=t.displayName,t.parent&&(i.data.parent={guidRelatedEntity:t.parent.guidRelatedEntity}),t.guidRelatedEntity&&(i.data.guidRelatedEntity=t.guidRelatedEntity,i.data.entityContext=t.entityContext),t.predefinedValues&&(i.data.predefinedValues=t.predefinedValues)),this.executeCommand(i)},onInsertControlColumn:function(e){var t=e.data,i={command:"insertElementFromControlsNavigator",data:{renderType:t.name,name:t.name,displayName:t.displayName&&t.displayName.length>0?t.displayName:t.name},position:e.position,parent:e.guid};this.executeCommand(i)},onMoveGridColumn:function(e){var t={command:"moveElement",initialPosition:e.initialPosition,finalPosition:e.finalPosition,parent:e.guid};this.executeCommand(t)},onSelectGridColumn:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.guid});t.currentSelectedElement=e.guid,void 0===e.ctrlIsPressed&&t.controller.removeSelectedElement(),t.controller.addSelectedElement(e.guid,e),$.when(t.showElementXpath(i.xpath)).done(function(){t.onDrawComponents(e)})},onShowGridColumnContextMenu:function(e){var t=this;if(!t.controller.thereAreMultiselection()||!t.controller.getSelectedElements(e.guid)){var i=t.executeCommand({command:"getElementProperties",guid:e.guid});t.contextmenu&&t.contextmenu.destroy(),$.when(t.showElementXpath(i.xpath)).done(function(){t.drawContextMenu({guid:e.guid,position:e.position})})}},onCancelChangesInModel:function(e){this.executeCommand({command:"updateGridColumnModel",gridModel:e.gridModel,canUndo:!1}),this.executeCommand({command:"changeContext",context:this.getContext()}),this.currentSelectedElement=null,this.controller.removeSelectedElement()},onPerformChangesInModel:function(){this.executeCommand({command:"changeContext",context:this.getContext()}),this.currentSelectedElement=null,this.controller.removeSelectedElement()},onPerformValidationsInModel:function(){this.currentSelectedElement=null,this.hidePropertyBox(),this.onPerformChangesInModel(),this.gridcolumneditor.destroy()},onUnselectGridColumn:function(e){this.currentSelectedElement=null,e&&void 0!==e.ctrlIsPressed?this.controller.removeSelectedElement(e.guid):this.controller.removeSelectedElement(),this.hidePropertyBox(),this.refreshRibbon(),this.destroyDecorator(),this.onProcessSelectedColumns(e)},onDrawComponents:function(e){this.controller.thereAreMultiselection()?(this.removeDecorator(),this.drawPropertyBox({guid:this.controller.getGuidsSelected()})):(this.hidePropertyBox(),this.refreshRibbon(e.guid),this.drawDecorator($.extend(e,{IsOnClickEvent:!0})))},onProcessSelectedColumns:function(e){e=e||{};var t=this.controller.getGuidsSelected();if(1===t.length){var i=this.controller.getSelectedElements(t[0]);this.controller.removeSelectedElement(),this.onSelectGridColumn($.extend({IsOnClickEvent:!0},i))}else t.length>1&&this.onDrawComponents(e)},onUpdateDesignAttributesColumn:function(e){e.command="changeDesignAttributes",this.executeCommand(e)},getContext:function(){return this.controller.getOriginalContext()}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawSearchResultEditor:function(){var e=this;$.when(e.executeCommand({command:"getSearchResultModel"})).done(function(t){var i=e.createSearchResultCanvas(),o=e.searchresulteditor=new bizagi.editor.component.searchresulteditor.presenter({searchResultModel:t,canvas:i});o.render(),o.subscribe("moveColumn",function(t,i){e.onMoveColumn(i)}),o.subscribe("insertXpath",function(t,i){e.onInsertXpath(i)}),o.subscribe("selectColumn",function(t,i){e.onSelectColumn(i)}),o.subscribe("unSelectColumn",function(t,i){e.onUnSelectColumn(i)})})},createSearchResultCanvas:function(){return $("#search-result-panel .bz-fm-searchresult-content",this.getMainContainer())},refreshSearchFormResult:function(){var e=this,t=e.searchresulteditor;t&&$.when(e.executeCommand({command:"getSearchResultModel"})).done(function(i){t.refresh({searchResultModel:i,currentSelectElement:e.currentSelectedElement})})},onInsertXpath:function(e){var t=e.data,i={command:"insertElementFromXpathNavigator",data:{renderType:t.renderType,name:t.displayName,displayName:t.displayName,xpath:bizagi.editor.utilities.buildComplexXpath(t.xpath,t.contextScope,t.isScopeAttribute,t.guidRelatedEntity)},position:e.position,searchformresult:!0};this.executeCommand(i)},onMoveColumn:function(e){var t={command:"moveElement",initialPosition:e.initialPosition,finalPosition:e.finalPosition,elementType:"searchresult"};this.executeCommand(t)},onSelectColumn:function(e){var t=this.executeCommand({command:"getElementProperties",guid:e.guid});this.hidePropertyBox(),this.refreshRibbon(e.guid),this.currentSelectedElement=e.guid,this.drawDecorator($.extend(e,{IsOnClickEvent:!0}),!0),this.showElementXpath(t.xpath)},onUnSelectColumn:function(){this.currentSelectedElement=null,this.hidePropertyBox(),this.removeDecorator()}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawButtonEditor:function(){var e=this;$.when(e.executeCommand({command:"getButtonModel"})).done(function(t){var i=e.createButtonEditorCanvas();(e.buttoneditor=new bizagi.editor.component.buttoneditor.presenter({buttonModel:t,canvas:i})).render({isReadOnly:e.controller.isReadOnlyForm(),allowAddButtons:e.controller.isFormContext()}),e.attachHandlersButtonEditor(),e.refreshButtonEditor()})},attachHandlersButtonEditor:function(){var e=this,t=e.buttoneditor;e.controller.isReadOnlyForm()||(t.subscribe("selectButton",function(t,i){e.onSelectButton(i)}),t.subscribe("unselectButton",function(t,i){e.onUnselectButton(i)}),t.subscribe("addButton",function(t,i){e.onAddButton(i)}),t.subscribe("moveButton",function(t,i){e.onMoveButton(i)}))},refreshButtonEditor:function(){var e=this,t=e.buttoneditor,i=e.controller.getContextInfo().guid,o=e.executeCommand({command:"getElementProperty",guid:i,property:"usecustombuttons"});(o=o||e.controller.isStartFormContext())?(e.showButtonEditor(),t&&$.when(e.executeCommand({command:"getButtonModel"})).done(function(i){var o=e.controller.getGuidsSelected()[0]?e.controller.getSelectedElements(e.controller.getGuidsSelected()[0]):null;t.refresh({buttonModel:i,options:{element:o},isReadOnly:e.controller.isReadOnlyForm(),allowAddButtons:e.controller.isFormContext()})})):e.hideButtonEditor()},showButtonEditor:function(){$(".wrapper-main-panel").addClass("bz-form-buttons-enabled")},hideButtonEditor:function(){$(".wrapper-main-panel").removeClass("bz-form-buttons-enabled")},createButtonEditorCanvas:function(){return $("#button-editor-panel",this.getMainContainer())},onSelectButton:function(e){this.currentSelectedElement=e.guid,this.controller.removeSelectedElement(),this.controller.addSelectedElement(e.guid,e),this.hidePropertyBox(),this.refreshRibbon(e.guid),this.controller.isFormContext()?this.drawDecorator($.extend(e,{IsOnClickEvent:!0})):this.drawPropertyBox({guid:e.guid}),this.applyCopyFormat(e.guid)},onUnselectButton:function(){this.currentSelectedElement=null,this.hidePropertyBox(),this.refreshRibbon(),this.removeDecorator()},onAddButton:function(){this.hidePropertyBox(),this.removeDecorator(),this.executeCommand({command:"insertButton"})},onMoveButton:function(e){var t={command:"moveElement",initialPosition:e.initialPosition,finalPosition:e.finalPosition,elementType:"button"};this.executeCommand(t)}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{configureRenderingView:function(){var e=this,t=e.controller.getModel().getForm();return e.loadFormDeferred=new $.Deferred,e.renderingView=new bizagi.rendering.facade,e.renderingView.subscribe("sortstart",function(){e.onRenderingViewSortStart()}),e.renderingView.subscribe("sortfinish",function(t,i){e.onRenderingViewSortFinish(i)}),e.renderingView.subscribe("unselectelement",function(t,i){e.onRenderingViewElementUnselected(i)}),e.renderingView.subscribe("selectelement",function(t,i){return e.onRenderingViewElementSelected(i)}),e.renderingView.subscribe("canChangeLabel",function(){return!0}),e.renderingView.subscribe("startlabeledition",function(){e.onRenderingViewStartLabelEdition()}),e.renderingView.subscribe("changelabel",function(t,i){e.onRenderingViewElementChangeLabel(i)}),bizagi.form.modeler.params.reviewMode||e.renderingView.subscribe("elementrightclick",function(t,i){e.onRenderingViewElementRightClick(i)}),e.renderingView.subscribe("getMainPanel",function(t,i){return e.getMainPanel(i)}),e.renderingView.subscribe("getMainContainer",function(t,i){return e.getMainContainer(i)}),e.renderingView.subscribe("addtab",function(t,i){e.onRenderingViewTabAdd(i)}),e.renderingView.subscribe("deletetab",function(t,i){e.onRenderingViewTabDelete(i)}),e.renderingView.subscribe("activatetab",function(t,i){e.onRenderingViewTabActivate(i)}),e.renderingView.subscribe("showsearchform",function(t,i){e.onRenderingShowSearchForm(i)}),e.renderingView.subscribe("showProperties",function(t,i){e.onRenderingShowProperties(i)}),e.renderingView.subscribe("showPropertiesForm",function(t,i){e.onRenderingShowPropertiesForm(i)}),e.renderingView.subscribe("controlRefreshCanvas",function(t,i){e.refreshCanvas(i)}),e.renderingView.subscribe("selectcontainerform",function(t,i){e.onRenderingSelectForm(i)}),e.renderingView.subscribe("checkCtrlKey",function(t,i){return e.onCheckCtrlKey(i)}),e.renderingView.subscribe("resizeImage",function(t,i){return e.onResizeImage(i)}),e.renderingView.subscribe("refreshControl",function(t,i){return e.onRefreshControl(i)}),e.renderingView.subscribe("getparentid",function(t,i){return e.onGetParentId(i)}),e.renderingView.subscribe("getLastInsertedElement",function(){return e.onGetLastInsertedElement()}),e.renderingView.subscribe("getControlIcon",function(t,i){return e.onGetControlIcon(i)}),e.renderingView.subscribe("setLastInsertedElement",function(t,i){e.onSetLastInsertedElement(i)}),e.renderingView.subscribe("unsubscribeAll",function(t,i){e.unsubscribeAll(i)}),e.renderingView.subscribe("validateFormIsActive",function(t,i){return e.validateForm}),$.when(t.ready()).pipe(function(){var t={data:e.controller.getRenderingModel(),canvas:e.getMainPanel(),mode:e.renderingMode};return e.renderingView.execute(t)}).done(function(t){e.formContainer=t,e.controller.isReadOnlyForm()&&e.drawReadOnlyEditor(t.container),e.loadFormDeferred.resolve(),setTimeout(function(){e.applyThemeToRendering()},100),$(document).ready(function(){e.applyThemeToRendering()}),$(window).bind("resize.rendering",function(){e.applyThemeToRendering()})}),e.loadFormDeferred.promise()},applyThemeToRendering:function(){var e,t=this.getMainPanel(),i=this.getMainContainer();$(".wrapper-main-scroll",i),e=$("> .ui-bizagi-container-form",t),"layout"===this.renderingMode?t.addClass("bz-main-layout-mode"):"design"===this.renderingMode&&t.removeClass("bz-main-layout-mode"),0===e.children().length&&e.append('<div class="children"></div>'),e.addClass("biz-form").addClass("biz-draft-border"),this.renderingView.publish("controlRefreshCanvas"),$(".ui-bizagi-container-form > .children",i).attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere-containers"));$(".ui-bizagi-container-panel, .ui-bizagi-container-group, .ui-bizagi-container-nestedform, .ui-bizagi-container-horizontal, .ui-col > .children, .ui-bizagi-container-tab, .ui-bizagi-render:last, .ui-bizagi-render:first",i).attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere")),$(".ui-drop-here-layout",i).attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere"));var o=$('<style id="drophere"></style>');if(0===$("#drophere",i).length){var r=$("head");r.append(o),$("#drophere",r).append('.ui-bizagi-placeholder:before,  #bz-fm-grid-columneditor[class*="drop-here"]:before {content:"'+bizagi.localization.getResource("formmodeler-component-editor-layout-drophere")+'"}')}},createMsgValidationTooltip:function(){var e=this.getMainPanel();$(".ui-bizagi-render-icon-editor-msg-validation[title], .ui-bizagi-container-icon-editor-msg-validation-templates[title], .ui-bizagi-render-icon-msg-validation[title]",e).tooltip({tooltipClass:"ui-widget-content ui-msg-validation-tooltip",content:function(){var e=$(this);if(e[0]&&e[0].attributes["data-title"])return e[0].attributes["data-title"].value;if(e[0]&&e[0].title){var t=e[0].title;return e[0].title="",t}}})},formIsLoaded:function(){return this.loadFormDeferred},removeMsgValidationTooltip:function(){var e=this.getMainPanel();$(".ui-msg-validation-tooltip",e).remove()},refreshRenderingView:function(e,t){void 0!==this.renderingView&&(t=t||this.renderingMode,this.renderingMode=t,this.showRenderingModel())},showRenderingModel:function(){var e=this;$.when(e.controller.getRenderingModel()).done(function(t){var i={data:t,mode:e.renderingMode,focus:e.currentFocus};$.when(e.renderingView.update(i)).done(function(t){e.formContainer=t,"design"===e.renderingMode&&t.selectElementByGuid(e.controller.getGuidsSelected()),e.controller.isTemplateContext()?e.applyThemeToTemplates():e.applyThemeToRendering(),e.validateForm&&(e.removeMsgValidationTooltip(),e.createMsgValidationTooltip())})})},setCurrentFocus:function(e){this.currentFocus=e},isLayoutMode:function(){return"layout"===this.renderingMode},processSelectedElements:function(e){var t=this.controller.getGuidsSelected();1===t.length?(e=this.controller.getSelectedElements(t[0]),this.controller.removeSelectedElement(),this.onRenderingViewElementSelected($.extend({IsOnClickEvent:!0},e))):t.length>1&&this.drawComponents()},drawComponents:function(e){var t=(e=e||{}).args;this.controller.thereAreMultiselection()?(this.removeDecorator(),t&&!t.IsOnClickEvent||this.drawPropertyBox({guid:this.controller.getGuidsSelected()}),this.refreshRibbon()):(this.drawDecorator(t),this.refreshRibbon(t.guid),this.applyCopyFormat(t.guid))},deleteElement:function(){var e=this.controller.getGuidsSelected();e&&(this.hidePropertyBox(),this.executeCommand({command:"removeElementById",guids:e}),this.currentSelectedElement=null)},onRenderingViewSortStart:function(){this.hidePropertyBox(),this.getMainPanel().addClass("bz-main-dashed-grid")},onRenderingViewSortFinish:function(e){this.getMainPanel().removeClass("bz-main-dashed-grid"),e.source&&e.source.toolbar?this.executeCommand({command:"insertElementFromControlsNavigator",position:e.finalPosition,parent:e.targetContainer,data:e.source.data}):e.source&&e.source.xpathNavigator?(e.source.data.xpath=bizagi.editor.utilities.buildComplexXpath(e.source.data.xpath,e.source.data.contextScope,e.source.data.isScopeAttribute,e.source.data.guidRelatedEntity),this.executeCommand({command:"insertElementFromXpathNavigator",position:e.finalPosition,parent:e.targetContainer,data:e.source.data})):e.source&&e.source.layout?this.executeCommand({command:"createAndInsertControlLayoutInModel",position:e.finalPosition,parent:e.targetContainer,id:e.source.data}):e.sourceContainer===e.targetContainer?e.initialPosition!==e.finalPosition&&this.executeCommand({command:"moveElement",initialPosition:e.initialPosition,finalPosition:e.finalPosition,parent:e.targetContainer}):this.executeCommand({command:"moveElementContainer",posIni:e.initialPosition,posEnd:e.finalPosition,parentSource:e.sourceContainer,parentTarget:e.targetContainer})},onRenderingViewElementUnselected:function(e){this.currentSelectedElement=null,e&&void 0!==e.ctrlIsPressed?this.controller.removeSelectedElement(e.guid):this.controller.removeSelectedElement(),this.hidePropertyBox(),this.removeDecorator(),this.refreshRibbon(),this.processSelectedElements(e)},onRenderingSelectForm:function(e){this.drawPropertyBox({formProperties:!0})},onRenderingViewElementSelected:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.guid}),o=$.Deferred(),r={args:e,decorator:!0,ribbon:!0,copyFormat:!0};return e.IsOnClickEvent?(t.currentSelectedElement=e.guid,void 0===e.ctrlIsPressed&&t.controller.removeSelectedElement(),t.controller.addSelectedElement(e.guid,e),"nestedForm"==e.type?$.when(t.showElementGuid(i.form,i.xpath)).done(function(){t.drawComponents(r),o.resolve(!0)}):e.isInternal?$.when(t.showMetadataXpath(i.xpath)).done(function(){t.drawComponents(r),o.resolve(!0)}):$.when(t.showElementXpath(i.xpath)).done(function(){t.drawComponents(r),o.resolve(!0)})):(t.drawComponents(r),o.resolve(!0)),o.promise()},applyCopyFormat:function(e){var t;if(this.controller.copyFormatHasElement()){var i=this.controller.getCopyFormatElement();i.guid!==e&&(i=this.controller.popCopyFormat(),t={command:"changeMultipleProperties",guid:e,properties:bizagi.clone(i.properties)},this.executeCommand(t))}},onRenderingViewStartLabelEdition:function(){var e=this;setTimeout(function(){e.formContainer.disableSortablePlugin()},150),e.hidePropertyBox()},onRenderingViewElementChangeLabel:function(e){this.executeCommand({command:"changeProperty",guid:e.guid,property:"displayName",value:e.value})},onRenderingViewElementRightClick:function(e){var t=this;if(!t.controller.thereAreMultiselection()||!t.controller.getSelectedElements(e.guid)){var i=t.executeCommand({command:"getElementProperties",guid:e.guid});t.contextmenu&&t.contextmenu.destroy(),$.when(t.showElementXpath(i.xpath)).done(function(){t.drawContextMenu({guid:e.guid,position:e.position})})}},onRenderingViewTabAdd:function(e){var t=this,i=t.executeCommand({command:"insertTabItem",tab:e.guid});setTimeout(function(){t.onRenderingViewTabActivate(i)},100)},onRenderingViewTabDelete:function(e){this.executeCommand({command:"removeElementById",guid:e.guid})},onRenderingViewTabActivate:function(e){var t=this;t.setCurrentFocus(e.guid),t.currentSelectedElement=null,setTimeout(function(){t.refreshCanvas()},10)},onRenderingShowSearchForm:function(e){var t=this.executeCommand({command:"getElementProperties",guid:e.guid});t&&t.searchforms&&$.isArray(t.searchforms)&&this.performSelectFormButton({value:t.searchforms})},onRenderingShowPropertiesForm:function(){this.performShowFormProperties()},onRenderingShowProperties:function(e){this.drawPropertyBox(e)},onCheckCtrlKey:function(){return!(this.isLayoutMode()||!this.controller.isCtrlKeyPressed())},onResizeImage:function(e){this.executeCommand({command:"changeMultipleProperties",guid:e.guid,properties:e.properties,refreshProperties:!0})},onGetRenderElement:function(e){return this.formContainer?this.formContainer.getRenderById(e.id):null},refreshElement:function(e){var t,i,o={};this.formContainer&&(e.container&&(t=e.container.properties.id,$.isArray(o[t])||(o[t]=[]),o[t].push(1),(i=this.formContainer.getRenderById(t))&&(i.refreshDesignContainer(e),this.refreshCanvas())))},onRefreshControl:function(e){this.executeCommand({command:"refreshControl",guid:e.guid,canvas:e.canvas})},onGetParentId:function(e){return this.controller.model.getElement(e.guid).parent.guid},onSetLastInsertedElement:function(e){this.controller.setLastInsertedElement(e)},onGetLastInsertedElement:function(){return this.controller.getLastInsertedElement()},onGetControlIcon:function(e){return(this.controller.model.getElement(e.id)||{style:"bz-studio bz-layout-full_16x16_standard"}).style},unsubscribeAll:function(){var e=this;e.renderingView.unsubscribe("sortstart"),e.renderingView.unsubscribe("sortfinish"),e.renderingView.unsubscribe("unselectelement"),e.renderingView.unsubscribe("selectelement"),e.renderingView.unsubscribe("canChangeLabel"),e.renderingView.unsubscribe("startlabeledition"),e.renderingView.unsubscribe("changelabel"),e.renderingView.unsubscribe("elementrightclick"),e.renderingView.unsubscribe("addtab"),e.renderingView.unsubscribe("deletetab"),e.renderingView.unsubscribe("activatetab"),e.renderingView.unsubscribe("showsearchform"),e.renderingView.unsubscribe("showProperties"),e.renderingView.unsubscribe("showPropertiesForm"),e.renderingView.unsubscribe("controlRefreshCanvas"),e.renderingView.unsubscribe("selectcontainerform"),e.renderingView.unsubscribe("checkCtrlKey"),e.renderingView.unsubscribe("resizeImage"),e.renderingView.unsubscribe("refreshControl"),e.renderingView.unsubscribe("getparentid"),e.renderingView.unsubscribe("getLastInsertedElement"),e.renderingView.unsubscribe("getControlIcon"),e.renderingView.unsubscribe("setLastInsertedElement"),e.renderingView.unsubscribe("unsubscribeAll"),e.renderingView.unsubscribe("getMainPanel"),e.renderingView.unsubscribe("getMainContainer"),e.renderingView.unsubscribe("validateFormIsActive")}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{configureTemplateView:function(){var e=this,t=e.controller.getRenderingModel(),i={data:t,canvas:e.getMainPanel(),mode:e.renderingMode};e.renderingView=new bizagi.rendering.facade,bizagi.log("Rendering with ...",t),e.renderingView.subscribe("dropfinish",function(t,i){i.sourceGuid?e.onRenderingReplaceAndRestoreElement(i):e.onRenderingViewUpdateElement(i)}),e.renderingView.subscribe("changelabel",function(t,i){i.value?($.extend(i,{property:"displayName",renderType:"label"}),i.value=bizagi.editor.utilities.buildComplexLocalizable(i.value,i.guid,"displayName"),e.onRenderingViewUpdateElement(i)):e.refresh()}),e.renderingView.subscribe("deleteRepeaterItem",function(t,i){e.onDeleteRepeaterItem(i)}),e.renderingView.subscribe("unselectelement",function(t,i){e.onRenderingViewElementUnselected(i)}),e.renderingView.subscribe("selectelement",function(t,i){e.onRenderingViewElementSelected(i)}),e.renderingView.subscribe("selectcontainerform",function(t,i){e.onRenderingSelectForm(i)}),e.renderingView.subscribe("canChangeLabel",function(t,i){return e.onTemplateChangeLabel(i)}),e.renderingView.subscribe("restoreItem",function(t,i){e.onRestoreItem(i)}),e.renderingView.subscribe("isDeleteOptionAllowed",function(t,i){return e.onIsDeleteOptionAllowed(i)}),e.renderingView.subscribe("controlRefreshCanvas",function(t,i){setTimeout(function(){e.refreshCanvas(i)},0)}),e.renderingView.subscribe("hideElement",function(t,i){e.onHideElement(i)}),$.when(e.renderingView.execute(i)).done(function(t){e.formContainer=t,e.controller.isReadOnlyForm()&&e.drawReadOnlyEditor(t.container),e.applyThemeToTemplates(),$(document).ready(function(){e.applyThemeToTemplates()}),$(window).resize(function(){e.applyThemeToTemplates()})})},applyThemeToTemplates:function(){var e,t=this.getMainPanel(),i=this.getMainContainer();$(".wrapper-main-scroll",i),e=$("> .bz-design-template",t),"layout"===this.renderingMode?t.addClass("bz-main-layout-mode"):"design"===this.renderingMode&&t.removeClass("bz-main-layout-mode"),0===e.children().length&&e.append('<div class="children"></div>'),e.addClass("biz-form").addClass("biz-draft-border"),this.renderingView.publish("controlRefreshCanvas")},onRenderingReplaceAndRestoreElement:function(e){this.executeCommand($.extend({command:"replaceAndRestoreElement"},e))},onRenderingViewUpdateElement:function(e){"layoutLabel"===this.controller.model.getElement(e.guid).type?this.executeCommand({command:"changeProperty",guid:e.guid,property:"displayName",value:e.value}):this.executeCommand($.extend({command:"updateElement"},e))},onDeleteRepeaterItem:function(e){this.executeCommand($.extend({command:"deleteRepeaterItem"},e))},onTemplateChangeLabel:function(e){return":image"!=this.executeCommand({command:"getElementProperties",guid:e.guid}).type},onRestoreItem:function(e){this.executeCommand({command:"updateElement",guid:e.guid,renderType:"layoutPlaceholder",toInitialState:!0})},onIsDeleteOptionAllowed:function(e){var t=this.controller.getModel().getElement(e.guid);return!!t&&("layoutPlaceholder"!=t.type&&!(t.properties.type&&t.properties.type.search(/image/gi)>=0))},onHideElement:function(e){this.executeCommand({command:"changeProperty",guid:e.guid,property:"hide",value:!0})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawSelectFormEditor:function(e){this.decorator.canvas.find(".bizagi_editor_component_editor_form").detach();var t=this.decorator.canvas.find(".editor-ui-actions-container"),i=$("<div />").appendTo(t),o=$.extend(this.executeCommand({command:"getSelectFormModel",guid:e.guid,property:e.property}),{caption:e.caption});this.getRelatedForms(o),(this.formSelector=new bizagi.editor.component.editor.form.presenter({canvas:i,model:o})).render()},getRelatedForms:function(e){if("object"==typeof e.xpath){var t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"relatedforms",xpath:bizagi.editor.utilities.resolveComplexXpath(e.xpath),context:e.context});$.when(t.processRequest()).done(function(t){t&&(e.relatedForms=t)})}}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawLayoutNavigator:function(){var e=this,t=$("<div />").addClass("bizagi_editor_layoutnavigator_container").appendTo(e.getMainContainer().find("#left-tab-layout"));$.when(e.controller.getLayoutNavigatorModel()).pipe(function(i){var o=e.layoutNavigator=new bizagi.editor.component.layoutnavigator.presenter({canvas:t,model:i});return o.subscribe("getMainContainer",function(t,i){return e.getMainContainer(i)}),o.subscribe("getMainPanel",function(t,i){return e.getMainPanel(i)}),e.attachHandlersLayoutNavigator(),o.render({isReadOnly:e.controller.isReadOnlyForm()})})},attachHandlersLayoutNavigator:function(){var e=this,t=e.layoutNavigator;e.controller.isReadOnlyForm()||(t.subscribe("layoutDoubleClick",function(t,i){e.onLayoutDoubleClick(i)}),t.subscribe("controlRefreshCanvas",function(t,i){e.refreshCanvas(i)}))},onLayoutDoubleClick:function(e){var t={command:"addControlLayoutInModel",id:e.id};this.executeCommand(t)},refreshLayoutNavigator:function(){var e=this;$.when(e.controller.getLayoutNavigatorModel()).done(function(t){e.layoutNavigator.render({model:t,isReadOnly:e.controller.isReadOnlyForm()})})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawRibbon:function(){var e=this,t=$("<div />").appendTo(e.getMainContainer().find(".ribbon-panel"));return $.when(e.executeCommand({command:"getRibbonModel",validFormChecked:e.validateForm})).pipe(function(i){var o=e.ribbon=new bizagi.editor.component.ribbon.presenter({canvas:t,model:i});return o.subscribe("onItemClicked",function(t,i){e.onItemRibbonClick($.extend(i,{guid:o.getGuid()}))}),o.render()})},refreshRibbon:function(e){var t=this;t.controller.thereAreMultiselection()&&(e=bizagi.editor.utilities.getGuidEmpty()),e=e||t.currentSelectedElement,$.when(t.executeCommand({command:"getConvertToModel",guid:e})).pipe(function(i){return t.executeCommand({command:"getRibbonModel",guid:e,convertToModel:i,validFormChecked:t.validateForm})}).done(function(i){t.ribbon&&t.ribbon.render({model:i,guid:e})})},onItemRibbonClick:function(e){var t=this,i=e.action;e.property&&e.value&&!e.action&&("expression"!=e.value?t.executeCommand({command:"changeProperty",guid:e.guid,property:e.property,value:e.value}):t.showExpressionSelector(e.property,e.guid)),"undo"==i&&t.performUndo(),"redo"==i&&t.performRedo(),"save"==i&&t.performSave(),"copy-from"==i&&t.performCopyFrom(),"switchForm"==i&&t.performSwitchForm(),"setuseoffline"==i&&t.performSetUseOffline(),"copy-format"==i&&t.performCopyFormat(e),"actionsvalidations"==i&&t.performShowActionsValidations(),"formproperties"==i&&t.performShowFormProperties(),"delete"==i&&t.performDelete(e.guid),"rename"==i&&t.performRename(e.guid),"validate"==i&&t.performValidate(),"Language"==i&&t.performChangeEditorLanguage(e),"useCustomButtons"==i&&t.enableOrDisableCustomButtons(e),"checkout"==i&&t.performCheckout(e),"useOfflineForm"==i&&t.enableOrDisableOfflineFormOption(e),"offlineAsOnline"==i&&t.performSetOfflineAsOnline(e),"emailTemplate"==i&&t.performEmailTemplate(e),"convert"==i&&t.performConvertTo(e)},performConvertTo:function(e){this.executeCommand({command:"convertTo",guid:e.guid,convertTo:e.property})},performUndo:function(){this.undo()},performRedo:function(){this.redo()},performSave:function(e){var t=this;t.dialog||$.when(t.processValidations({canRefresh:!0}),t.controller.thereAreChangesInForm()).done(function(i,o){if(o||!t.controller.isReadOnlyForm()&&i.showMessage)if(i.showMessage||e){t.dialog=new bizagi.editor.component.dialog.presenter;var r={name:"bz-dialog-perfomsave",title:t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-save"):bizagi.localization.getResource("bizagi-editor-form-dialog-save"),message:i.showMessage?t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-save-warning-message"):bizagi.localization.getResource("bizagi-editor-form-save-warning-message"):t.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-save-message"):bizagi.localization.getResource("bizagi-editor-form-save-message"),buttons:[{text:bizagi.localization.getResource("bizagi-editor-form-dialog-yes"),legend:t.getLegendYesOption({showMessage:i.showMessage,close:e}),style:"bz-studio bz-yes-no_16x16_standard",click:function(){$.when(t.saveForm()).done(function(i){e&&i&&t.closeForm()})}},{text:bizagi.localization.getResource("bizagi-editor-form-dialog-no"),legend:t.getLegendNoOption({showMessage:i.showMessage,close:e}),style:"bz-studio bz-false_16x16_standard",click:function(){e&&t.closeForm()}}]};t.addCancelButton({showMessage:i.showMessage,close:e,model:r}),$.when(t.dialog.show({data:r})).done(function(e){setTimeout(function(){"function"==typeof e&&e.call(t),t.dialog=null},0)})}else t.saveForm();else e&&t.closeForm()})},performCopyFrom:function(){var e=this;if(!e.loadingCopyForm){e.loadingCopyForm=!0;var t=$("body"),i=new bizagi.editor.component.wait.presenter({model:{message:"Copy form"},renderArea:t}),o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"copyform"});$.when(o.processRequest(),i.render()).done(function(t){t&&e.executeCommand({command:"insertElements",data:t}),setTimeout(function(){i.destroy(),e.loadingCopyForm=!1},100)})}},performCopyFormat:function(e){this.executeCommand({command:"copyFormat",guid:e.guid})},performSwitchForm:function(){var e=this;e.dialog||$.when(e.processValidations({canRefresh:!0}),e.controller.thereAreChangesInForm()).done(function(t,i){if(i||t.showMessage)if(t.showMessage){e.dialog=new bizagi.editor.component.dialog.presenter;var o={name:"bz-dialog-perfomsave",title:bizagi.localization.getResource("bizagi-editor-form-dialog-save"),message:t.showMessage?bizagi.localization.getResource("bizagi-editor-form-save-warning-message"):bizagi.localization.getResource("bizagi-editor-form-save-message"),buttons:[{text:bizagi.localization.getResource("bizagi-editor-form-dialog-yes"),legend:e.getLegendYesOption({showMessage:t.showMessage,close:!1}),style:"bz-studio bz-yes-no_16x16_standard",click:function(){$.when(e.saveForm()).done(function(){e.switchForm()})}},{text:bizagi.localization.getResource("bizagi-editor-form-dialog-no"),legend:e.getLegendNoOption({showMessage:t.showMessage,close:!1}),style:"bz-studio bz-black bz-false_16x16_black",click:function(){e.switchForm()}}]};e.addCancelButton({showMessage:t.showMessage,close:!0,model:o}),$.when(e.dialog.show({data:o})).done(function(t){setTimeout(function(){"function"==typeof t&&t.call(e),e.dialog=null},0)})}else $.when(e.saveForm()).done(function(){e.switchForm()});else e.switchForm()})},performSetUseOffline:function(){var e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"setuseoffline"});$.when(e.processRequest()).done()},performShowActionsValidations:function(){this.drawCommandsEditor()},performShowFormProperties:function(){this.drawPropertyBox({formProperties:!0})},performDelete:function(e){this.hidePropertyBox(),this.executeCommand({command:"removeElementById",guid:e})},performRename:function(e){var t;(t=$('[guid="'+e+'"]')).find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||$("label",t).trigger("dblclick")},performValidate:function(){this.validateForm=!this.validateForm,this.validateForm?this.controller.isTemplateContext()?this.processTemplateValidations({canRefresh:!0}):this.processValidations({canRefresh:!0}):this.removeValidations({canRefresh:!0})},performChangeEditorLanguage:function(e){e.canValidate=!0,bizagi.editorLanguage=e.value,this.refresh(e)},performSetOfflineAsOnline:function(){var e=this,t=e.controller.isOfflineAsOnline();t=!t;var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"setuseoffline",value:t});$.when(i.processRequest()).done(function(i){i&&(e.controller.setOfflineAsOnline(t),e.refreshRibbon())})},enableOrDisableOfflineFormOption:function(){var e=this.controller.getContextInfo().guid,t=this.executeCommand({command:"getElementProperty",guid:e,property:"useofflineform"});t=t||!1,this.executeCommand({command:"changeProperty",guid:e,property:"useofflineform",value:!t})},performEmailTemplate:function(){var e=this,t=e.controller.getContextInfo().guid,i=e.executeCommand({command:"getElementProperty",guid:t,property:"emailintegration"});bizagi.log("VALUE "+i);var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"loadtemplate",template:i||{baref:{ref:"template"}}});$.when(o.processRequest()).done(function(i){i&&!i.isEmpty&&e.executeCommand({command:"changeProperty",guid:t,property:"emailintegration",value:i})})},enableOrDisableCustomButtons:function(){var e=this,t=e.controller.getContextInfo().guid,i=e.executeCommand({command:"getElementProperty",guid:t,property:"usecustombuttons"}),o=e.controller.getRibbonModel();if(1==i){var r=bizagi.localization.getResource("formmodeler-component-ribbon-useCustomButtons-validation");$.when(bizagi.showConfirmationBox(r,"Bizagi","warning")).done(function(){i=i||!1,o.hideGroup("email"),e.executeCommand({command:"changeProperty",guid:t,property:"usecustombuttons",value:!i})})}else i=i||!1,o.showGroup("email"),e.executeCommand({command:"changeProperty",guid:t,property:"usecustombuttons",value:!i})},performCheckout:function(e){var t=this;$.when(t.checkStatusForm()).done(function(e){e.isInCheckout?t.showUserInformation():t.checkoutForm()})},saveForm:function(){var e=this,t=$.Deferred(),i=e.getMainContainer();return $.when(e.executeCommand({command:"saveModel"})).done(function(o){var r={message:bizagi.localization.getResource("formmodeler-component-wait-message-save")},n=new bizagi.editor.component.wait.presenter({model:r,renderArea:i});$.when(n.render()).done(function(){var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"saveform",jsonForm:o.dataModel,changeset:o.changeset,idForm:o.idForm}),r=o.deployOnParent;setTimeout(function(){$.when(i.processRequest()).done(function(i){if((i=i||{}).canBeSaved)e.controller.setNewForm(!1),e.controller.getModel().setDeployOnParent(r),e.controller.setResources(i.resources),e.controller.setOriginalModel(),e.refreshRibbon(),e.refreshPropertyBox();else{var o=i.userInfo||{},a=i.isInCheckout?bizagi.localization.getResource("bizagi-editor-force-checkout-message").replace("{0}",o.userFullName):bizagi.localization.getResource("bizagi-editor-force-checkout-reopen-message");$.when(bizagi.showMessageBox(a,"Bizagi")).done(function(){})}n.destroy(),t.resolve(i.canBeSaved)})},200)})}),t.promise()},closeForm:function(){var e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"closeform"});$.when(e.processRequest()).done(function(){})},switchForm:function(){var e=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"switchform"});$.when(e.processRequest()).done(function(e){})},addCancelButton:function(e){e.close&&e.model.buttons.push({text:bizagi.localization.getResource("bizagi-editor-form-dialog-cancel"),style:"bz-studio bz-error_16x16_standard",legend:this.getLegendCancelOption(e)})},getLegendYesOption:function(e){return e.showMessage&&e.close?this.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-yes-errors-close-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-yes-errors-close-legend"):e.showMessage?this.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-yes-errors-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-yes-errors-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-yes-legend")},getLegendNoOption:function(e){return e.showMessage&&e.close?this.controller.isTemplateContext()?bizagi.localization.getResource("bizagi-editor-template-dialog-no-errors-close-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-no-errors-close-legend"):e.showMessage?bizagi.localization.getResource("bizagi-editor-form-dialog-no-errors-legend"):bizagi.localization.getResource("bizagi-editor-form-dialog-no-legend")},getLegendCancelOption:function(e){return e.showMessage&&e.close?bizagi.localization.getResource("bizagi-editor-form-dialog-cancel-errors-legend"):e.close?bizagi.localization.getResource("bizagi-editor-form-dialog-cancel-legend"):""},checkStatusForm:function(){var e=new $.Deferred,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getstatusform"});return $.when(t.processRequest()).done(function(t){t=t||{},e.resolve(t)}),e.promise()},showUserInformation:function(){var e=this,t=e.controller.getUserInfo(),i=new bizagi.editor.component.blockedformsdialog.presenter,o={name:"bz-dialog-perfomsave",title:bizagi.localization.getResource("bizagi-editor-form-dialog-userinfo-title"),date:e.getDateInfo(),blockerUser:t.userFullName};i.subscribe("unlockformevent",function(){var i=bizagi.localization.getResource("formmodeler-component-unlock-form-confirmation").replace("{0}",t.userFullName);$.when(bizagi.showConfirmationBox(i,"Unlock form","warning",null,{dialogClass:"someClass"})).done(function(){e.checkoutForm()})}),$.when(i.show({data:o})).done(function(t){setTimeout(function(){"function"==typeof t&&t.call(e),e.dialog=null},0)})},getUserInfo:function(){var e=this.controller.getUserInfo(),t=bizagi.localization.getResource("bizagi-editor-form-dialog-userinfo-message");return t=t.replace("{0}",e.userFullName).replace("{1}",this.getDateInfo())},getDateInfo:function(){var e=this.controller.getUserInfo();return $.timeago(e.CheckOutDate)},checkoutForm:function(){var e=this,t=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"checkoutform",forceCheckin:!0});$.when(t.processRequest()).done(function(t){(t=t||{}).userInfo&&(e.controller.setReadOnlyFlag(t.isInCheckout),e.controller.setUserInfo(t.userInfo)),e.attachHandlersComponents(),e.refresh()})},attachHandlersComponents:function(){var e=this;e.controller.isActivityForm()&&(e.attachHandlersButtonEditor(),e.refreshButtonEditor()),e.controller.isTemplateContext()||(e.attachHandlersControlsNavigator(),e.refreshControlsNavigator(),e.attachHandlersLayoutNavigator(),e.refreshLayoutNavigator()),e.attachHandlersXpathNavigator(),e.refreshXpathNavigator()}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawContextMenu:function(e){var t=this;$.when(t.executeCommand({command:"getConvertToModel",guid:e.guid})).done(function(i){t.destroy();var o=t.executeCommand({command:"getContextMenuModel",guid:e.guid,convertToModel:i}),r=t.getMainContainer(),n=t.contextmenu=new bizagi.editor.component.contextmenu.presenter({model:o,guid:e.guid,mainContainer:r});return n.subscribe("onItemClicked",function(e,i){t.onContextMenuItemClicked(n,i)}),t.controller.isAdhocFormContext()&&(e.position.y=e.position.y-$(".l-wrapper-breadcrumb").height()||0),n.render({position:e.position})})},onContextMenuItemClicked:function(e,t){var i=this;i.hidePropertyBox(),t.property&&t.value&&(i.controller.isOfflineContext()?i.executeCommand({command:"changeProperty",guid:e.guid,property:t.property,value:t.value}):i.controller.isAdhocFormContext()?i.executeCommand({command:"changeProperty",guid:e.guid,property:t.property,value:t.value}):"object"==typeof t.value&&t.value.fixedvalue?i.executeCommand({command:"changeProperty",guid:e.guid,property:t.property,value:t.value}):(t.value=bizagi.editor.utilities.buildComplexReference(t.value),i.performShowRuleSelector({type:t.property,id:e.guid,newValue:t.value,categorytype:"Boolean",data:t.value}))),t.action&&("delete"==t.action&&i.executeCommand({command:"removeElementById",guid:e.guid}),"rename"==t.action&&i.showElementLabelEditor(e.guid),"convertTo"==t.action&&i.executeCommand({command:"convertTo",guid:e.guid,convertTo:t.value}),"properties"==t.action&&i.showPropertyBox(e.guid))},showExpressionSelector:function(e,t){var i=this.controller.getModel().getElement(t).getProperty(e)||{},o={};o.data=i.rule||{rule:{baref:{ref:"expression"}}},o.type=e,o.categorytype="Boolean",this.performShowRuleSelector(o)},showElementLabelEditor:function(e){var t=this.formContainer.getRenderById(e);t&&t.showElementLabelEditor&&t.showElementLabelEditor()},showPropertyBox:function(e){$('[guid="'+e+'"]');this.drawPropertyBox({guid:e})},destroy:function(){this.contextmenu&&this.contextmenu.destroy()}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{map:{columnsearchlist:"searchlist",multiselect:"searchlist"}},{drawPropertyBox:function(e){var t=this;t.propertyBox&&t.hidePropertyBox(),t.redrawPropertyBox=!!e.redraw&&e.redraw;var i=t.getMainContainer();t.propertyBox=new bizagi.editor.component.properties.presenter({mainContainer:i}),t.propertyBox.subscribe("propertyChanged",function(e,i){return t.onPropertiesChanged(i)}),t.propertyBox.subscribe("getRenderElement",function(e,i){return t.onGetRenderElement(i)}),t.propertyBox.subscribe("destroy",function(e,i){t.hidePropertyBox(i)}),t.editorValidations={},t.guid=e.guid||t.currentSelectedElement,t.formProperties=!(!e||!e.formProperties),t.refreshPropertyBox()},refreshPropertyBox:function(){var e,t=this;if(t.validElement()){if(t.formProperties)e=t.executeCommand({command:"getFormPropertiesModel",showValidations:t.validateForm});else{if(!t.guid)return void(t.propertyBox&&t.propertyBox.propertyBox&&t.propertyBox.propertyBox.element&&t.propertyBox.propertyBox.element.hide());t.controller.thereAreMultiselection()?e=t.executeCommand({command:"getMultiselectionProperties",showValidations:t.validateForm}):(t.executeCommand({command:"applyOverridesElement",guid:t.guid,overrides:{requiredProperties:!0}}),e=t.executeCommand({command:"getPropertiesModel",guid:t.guid,showValidations:t.validateForm}))}t.propertyBox.render({model:e,position:{left:10,top:135},redraw:t.redrawPropertyBox})}},validElement:function(){return!!this.propertyBox&&(!!this.formProperties||(!!$.isArray(this.guid)||!!this.executeCommand({command:"getElementProperties",guid:this.guid})))},onPropertiesChanged:function(e){if("function"==typeof this["perform"+e.typeEvent])return this["perform"+e.typeEvent](e)},hidePropertyBox:function(){this.propertyBox&&this.propertyBox.destroy(),this.propertyBox=null},showXpathEditor:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.guid});"object"==typeof i.xpath&&t.changeXpathNavigatorView(i.xpath);var o=e.model||t.controller.getXpathNavigatorModel({context:e.context});$.when(o).done(function(o){$.extend(o,{context:t.controller.getContext()});var r=new bizagi.editor.component.xpathnavigator.presenter({model:o}),n=bizagi.editor.utilities.resolveProperty(i,e.property);/^.*:+.*$/.test(n)&&(n=void 0),r.subscribe("nodeDoubleClick",function(i,o){t.changeXpathPropertyForElement(e.guid,e.property,o),r.closePopup()}),r.renderPopup({position:e.position,xpath:n,filter:e.filter})})},showMultiXpathEditor:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.guid}),o=e.model||t.controller.getXpathNavigatorModel({context:e.context});$.when(o).done(function(o){$.extend(o,{context:t.controller.getContext()});var r=new bizagi.editor.component.xpathnavigator.presenter({model:o}),n=bizagi.editor.utilities.resolveProperty(i,e.property);/^.*:+.*$/.test(n)&&(n=void 0),r.subscribe("nodeDoubleClick",function(i,o){t.changeXpathMultiplePropertyForElement(e.guid,e.property,o),r.closePopup()}),r.renderPopup({position:e.position,filter:e.filter,allowCollection:null==e.filter.allowCollections||bizagi.util.parseBoolean(e.filter.allowCollections)})})},changeXpathPropertyForElement:function(e,t,i){if(void 0!==this.editorValidations[e]&&!this.validateXpathChange(e,t,i))return;var o={command:"changeProperty",guid:e,property:t,value:bizagi.editor.utilities.buildComplexXpath(i.xpath,i.contextScope,i.isScopeAttribute,i.guidRelatedEntity),refreshProperties:!0,removeDefaultDisplayName:!0,renderTypeProperty:i.nodeSubtype,validateForm:this.validateForm};this.editorValidations[e]&&void 0!==this.editorValidations[e].exclusive&&(o=$.extend({},o,{exclusive:this.editorValidations[e].exclusive})),this.executeCommand(o)},changeXpathMultiplePropertyForElement:function(e,t,i){if(void 0!==this.editorValidations[e]&&!this.validateXpathMultipleChange(e,t,i))return;var o=this.executeCommand({command:"getElementProperty",guid:e,property:t})||[],r=bizagi.editor.utilities.buildComplexXpath(i.xpath,i.contextScope,i.isScopeAttribute,i.guidRelatedEntity);if(!(0!=$.grep(o,function(e){return r.xpath.baxpath.xpath==e.xpath.baxpath.xpath}).length)){o.push(r);var n={command:"changeProperty",guid:e,property:t,value:o,refreshProperties:!0,removeDefaultDisplayName:!0,renderTypeProperty:i.nodeSubtype,validateForm:this.validateForm};this.executeCommand(n)}},performPropertyChange:function(e,t){var i=[e.id],o=t||e.refreshProperties;bizagi.editor.utilities.isGuidEmpty(e.id)&&(i=this.controller.getGuidsSelected()),this.executeCommand({command:"changeProperty",guids:i,property:e.type,value:e.newValue,exclusive:e.exclusive,refreshProperties:o,validateForm:this.validateForm})},performPropertyChangeLayout:function(e){this.executeCommand({command:"changeLayout",guid:e.id,values:e.values})},performShowRuleSelector:function(e){var t=this;if(!t.requestInProgress){t.requestInProgress=!0;var i=e.data;if(i&&t.isRule90(i)){var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getruledisplayname",rule:i.rule90});$.when(o.processRequest()).done(function(e){var t=bizagi.localization.getResource("formmodeler-message-rule90").replace("{0}",e.displayName);bizagi.showMessageBox(t)})}var r=t.executeCommand({command:"getElementProperties",guid:e.id,getContext:e.context});if(r&&r.context)var n=r.context;var a=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(e,{protocol:"ruleexpression",idcontextentity:n}));$.when(a.processRequest()).done(function(i){i&&(e.newValue=i.isEmpty?void 0:i,t.performPropertyChange(e,!0))}).always(function(){setTimeout(function(){t.requestInProgress=!1},100)})}},performShowLocalization:function(e){var t=this,i=t.controller.getModel().getElement(e.id),o=i.resolveProperty(e.type);if("object"!=typeof o&&(o="string"==typeof o?bizagi.editor.utilities.buildComplexLocalizable(o,e.id,e.type):bizagi.editor.utilities.buildComplexLocalizable(i.getDefaultLocalizableProperty(e.type),e.id,e.type)),o.i18n){var r=o.i18n;r.languages=r.languages||{}}var n=o.i18n.default;o.i18n.default=$("<div/>").html(o.i18n.default).text();var a=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"multilanguage",i18n:o});$.when(a.processRequest()).done(function(i){o.i18n.default=n,i&&(i.i18n.default=n,e.newValue=i,t.performPropertyChange(e,!0))})},performChangeMultipleProperties:function(e){var t=[e.id];bizagi.editor.utilities.isGuidEmpty(e.id)&&(t=this.controller.getGuidsSelected()),this.executeCommand({command:"changeMultipleProperties",properties:e.properties,guids:t})},performShowFilterEditor:function(e){var t=this;if("data.filter"===e.type){e.xpathNode=t.executeCommand({command:"getXpathDataForElement",guid:e.id});var i=t.executeCommand({command:"getElementProperties",guid:e.id}),o=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(e,{protocol:"loadfilter",idcontextentity:i.context}));$.when(o.processRequest()).done(function(i){i&&(e.newValue=i.isEmpty?void 0:bizagi.editor.utilities.buildComplexFilter(i,e.xpathNode),t.performPropertyChange(e,!0))})}},performShowRuleEditorForDefaultValue:function(e){},performShowXPathEditor:function(e){this.showXpathEditor({guid:e.id,property:e.type,position:e.position})},performShowInterfaceEditor:function(e){var t=this,i=bizagi.editor.communicationprotocol.factory.createProtocol($.extend(e,{protocol:"loadinterface"}));t.requestInProgress||(t.requestInProgress=!0,$.when(i.processRequest()).done(function(i){i&&(e.newValue=i,t.performPropertyChange(e,!0))}).always(function(){setTimeout(function(){t.requestInProgress=!1},100)}))},performSelectXpathFromEntity:function(e){var t=this,i={typeEditor:e.typeEditor,editorParameters:e.editorParameters};void 0!==e.editorParameters.types&&(t.editorValidations[e.id]=i),$.when(t.executeCommand({command:"getXpathEditorModel",guid:e.id,editorParameters:e.editorParameters})).done(function(i){$.when(i).done(function(i){var o={guid:e.id,property:e.type,position:e.position,model:i};void 0!==e.editorParameters.types&&$.isArray(e.editorParameters.types)&&$.extend(o,{filter:{typeFilter:e.typeEditor,types:e.editorParameters.types}}),t.showXpathEditor(o)})})},performSelectXpathToSimple:function(e){var t={typeEditor:e.typeEditor,editorParameters:e.editorParameters};void 0!==e.exclusive&&(t=$.extend({},t,{exclusive:e.exclusive})),this.editorValidations[e.id]=t,this.showXpathEditor({guid:e.id,property:e.type,position:e.position,context:e.context,filter:{typeFilter:e.typeEditor,types:e.editorParameters.types}})},performSelectXpathToEntity:function(e){if("nestedform"==this.executeCommand({command:"getElementProperties",guid:e.id}).type){var t=bizagi.localization.getResource("formmodeler-component-editor-validation-xpath-title"),i=bizagi.localization.getResource("formmodeler-component-editor-validation-xpath-message");bizagi.showMessageBox(i,t,"warning",!1)}else this.editorValidations[e.id]={typeEditor:e.typeEditor},this.showXpathEditor({guid:e.id,property:e.type,position:e.position,context:e.context,filter:{typeFilter:e.typeEditor}})},performSelectXpathToCollection:function(e){this.editorValidations[e.id]={typeEditor:e.typeEditor},this.showXpathEditor({guid:e.id,property:e.type,position:e.position,context:e.context,filter:{typeFilter:e.typeEditor}})},performSelectMultiXpath:function(e){var t={typeEditor:e.typeEditor,editorParameters:e.editorParameters};void 0!==e.exclusive&&(t=$.extend({},t,{exclusive:e.exclusive})),this.editorValidations[e.id]=t,this.showMultiXpathEditor({guid:e.id,property:e.type,position:e.position,context:e.context,filter:{typeFilter:e.typeEditor,types:e.editorParameters.types,allowCollections:e.editorParameters.allowCollections}})},performSelectXpath:function(e){this.showXpathEditor({guid:e.id,property:e.type,position:e.position,context:e.context})},performShowGridValidationsEditor:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.id});if("object"==typeof i.xpath){var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"gridvalidations",guidRender:e.id,xpath:bizagi.editor.utilities.resolveComplexXpath(i.xpath),gridValidations:i.gridvalidations});$.when(o.processRequest()).done(function(i){i&&(e.newValue=i,t.performPropertyChange(e,!0))})}},performSelectProcess:function(e){var t=this,i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"selectprocess",guidRender:e.id});$.when(i.processRequest()).done(function(i){i&&(e.newValue=i,t.performPropertyChange(e,!0))})},performSelectFormOption:function(e){var t=[],i=bizagi.editor.utilities.buildComplexReference(e.form);e.newValue=i,e.context&&"searchform"===e.context&&(t.push(i),e.newValue=t),this.performPropertyChange($.extend(e,{type:e.propertyName}),!0),e.showForm&&this.executeCommand({command:"updateModel",data:{actiontype:"ShowForm",guidrender:e.id,form:e.form}})},performSelectFormButton:function(e){if($.isArray(e.value)&&(e.value=e.value[0]),"object"==typeof e.value){var t=bizagi.editor.utilities.resolveComplexReference(e.value);if(t.length>0)bizagi.editor.communicationprotocol.factory.createProtocol($.extend(e,{protocol:"openform",idform:t})).processRequest()}},performShowWizardTemplates:function(e){var t=this.executeCommand({command:"getElementProperties",guid:e.id,canUndo:!1}),i=this.controller.getModel();if(t.xpath&&(bizagi.editor.utilities.isObject(t.xpath),1)){var o=bizagi.editor.utilities.resolveComplexXpath(t.xpath),r=bizagi.editor.utilities.resolveRelatedEntityFromXpath(t.xpath),n=(i=this.controller.getModel(),bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"showwizardtemplates",xpath:o,relatedEntity:r,guidControl:e.id,propertyName:e.propertyName,isScopeAttribute:i.publish("getNodeInfo",{xpath:o,callback:function(e){return e.isScopeAttribute}})}));$.when(n.processRequest()).done(function(){delete bizagi.editor.component.properties.commands.selecttemplate.templatesPromise[r]})}},performSelectFormNew:function(e){var t=this.executeCommand({command:"getElementProperties",guid:e.id,canUndo:!1}),i=this.executeCommand({command:"propertyIsRequired",guid:e.id,property:"xpath"}),o=this.controller.getModel();if(t.xpath&&"object"==typeof t.xpath||!i){var r=bizagi.editor.utilities.resolveComplexXpath(t.xpath),n=bizagi.editor.utilities.resolveRelatedEntityFromXpath(t.xpath);bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"createform",xpath:this.controller.getContextXpath({xpath:r}),guid:e.id,propertyName:e.propertyName,context:e.context,relatedEntity:n,isScopeAttribute:o.publish("getNodeInfo",{xpath:r,callback:function(e){return e.isScopeAttribute}}),showForm:e.showForm}).processRequest(),delete bizagi.editor.component.properties.commands.relatedforms.relatedFormsCache[n+"_"+e.context]}},performSelectFormNone:function(e){e.newValue=void 0,this.performPropertyChange($.extend(e,{type:e.propertyName}),!0)},performSelectTemplateNone:function(e){e.newValue=void 0,this.performPropertyChange($.extend(e,{type:e.propertyName}),!0)},performSelectTemplateDefault:function(e){e.newValue=e.value,this.performPropertyChange($.extend(e,{type:e.propertyName}),!0)},performShowDocumentTemplatesEditor:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.id});if(i.xpath&&"object"==typeof i.xpath){var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"documenttemplates",groupmapping:i.groupmapping,append:i.append,xpath:bizagi.editor.utilities.resolveComplexXpath(i.xpath),idContextEntity:i.context});$.when(o.processRequest()).done(function(i){i&&t.performPropertyChange({id:e.id,type:"groupmapping",newValue:bizagi.editor.utilities.buildComplexReference(i)})})}},performShowAssociationEditor:function(e){var t=this,i=t.executeCommand({command:"getElementProperties",guid:e.id}),o=i.type;$.when(t.showControlWizard({model:i,control:t.Class.map[o]||o})).done(function(i){i.success&&t.executeCommand({command:"updateAssociationModel",model:i.model,guid:e.id,control:o}),t.refreshPropertyBox()})},performLoadMetadata:function(e){var t=this.executeCommand({command:"getElementProperties",guid:e.id});return bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmetadata",xpath:bizagi.editor.utilities.resolveComplexXpath(t.xpath)}).processRequest()},validateXpathChange:function(e,t,i){var o,r=i.nodeType,n=i.nodeSubtype,a=!1,s=this.editorValidations[e],l="N/A",d=bizagi.localization.getResource("bizagi-editor-validation-xpath-title-message-entity");switch(s.typeEditor){case"xpathfromentity":case"xpathtosimple":var c;for(o=s.editorParameters.types,l=o.toString(),a=!0,c=0;c<o.length;c++)try{if(-1!=$.inArray(n,bizagi.editor.component.xpathnavigator.equiv.rule.xpathtosimple[o[c]])){a=!1;break}}catch(e){bizagi.logError("Equiv Error","renderType: "+r+", types: "+l)}break;case"xpathtocollection":l="collection",-1==$.inArray(r,bizagi.editor.component.xpathnavigator.equiv.rule.xpathtocollection.xpathtocollection)&&(d=bizagi.localization.getResource("bizagi-editor-validation-xpath-title-message-collection"),a=!0);break;case"xpathtoentity":i.hasRelatedEntity&&"00000000-0000-0000-0000-000000000000"!=i.guidRelatedEntity&&"collection"!=r||(a=!0)}if(a){var u=bizagi.localization.getResource("bizagi-editor-validation-xpath-title"),p=printf(d,l);bizagi.showMessageBox(p,u,"warning",!1)}return!a},validateXpathMultipleChange:function(e,t,i){var o,r,n,a=i.nodeType,s=i.nodeSubtype,l=!1,d=this.editorValidations[e];for(r=d.editorParameters.types,o=r.toString(),l=!0,n=0;n<r.length;n++)try{if(-1!=$.inArray(s,bizagi.editor.component.xpathnavigator.equiv.rule.xpathmultiple[r[n]])){l=!1;break}}catch(e){bizagi.logError("Equiv Error","renderType: "+a+", types: "+o)}if(l){var c=bizagi.localization.getResource("bizagi-editor-validation-xpath-title"),u=printf(bizagi.localization.getResource("bizagi-editor-validation-xpath-title-message"),d.typeEditor,o,a);bizagi.showMessageBox(u,c,"warning",!1)}return!l},isRule90:function(e){return e.rule90}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawReadOnlyEditor:function(e){var t=this,i=$("<div />").addClass("bizagi_editor_readonlyeditor_container");e.prepend(i);var o=t.controller.getUserInfo(),r=t.readOnlyEditor=new bizagi.editor.component.readonlyeditor.presenter({canvas:i,model:o});return r.subscribe("showUserInformation",function(e,i){t.showUserInformation()}),r.render({isReadOnly:t.controller.isReadOnlyForm()})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{processValidations:function(e){var t=this,i=new $.Deferred;if(t.controller.isTemplateContext())return t.processTemplateValidations(e);if(t.controller.isAdhocFormContext())return t.processAdhocValidations(e);var o=t.executeCommand({command:"formValidations",validations:["RequiredProperties","RequiredDependentProperties","SameXpath","ElementsInContainers","AttributesAdministrables","AttributesNoEditables","EntitiesNoEditables"],canRefresh:e.canRefresh});return $.when(o).done(function(e){$.isEmptyObject(e)||(t.validateForm=!0,t.refreshRibbon(),$.extend(e,{showMessage:!0})),i.resolve(e)}),i.promise()},processTemplateValidations:function(e){var t=this.executeCommand({command:"formValidations",validations:[],canRefresh:e.canRefresh});return $.isEmptyObject(t)||(this.validateForm=!0,this.refreshRibbon(),$.extend(t,{showMessage:!0})),t},processAdhocValidations:function(e){var t=this,i=new $.Deferred,o=t.executeCommand({command:"formValidations",validations:["RequiredProperties","RequiredDependentProperties","SameXpath","ElementsInContainers","AttributesAdministrables","AttributesNoEditables","SameXpathAdhoc","SameXpathAdhocDataSource"],canRefresh:e.canRefresh});return $.when(o).done(function(e){$.isEmptyObject(e)||(t.validateForm=!0,t.refreshRibbon(),$.extend(e,{showMessage:!0})),i.resolve(e)}),i.promise()},removeValidations:function(e){this.validateForm=!1,this.executeCommand({command:"removeValidationsInModel",canRefresh:e.canRefresh})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{showControlWizard:function(e){var t=this.wizardPresenter=new bizagi.editor.wizard.presenter;return this.prepareWizardParams(e),e.isGridContext=this.controller.isGridContext(),e.isGridContext&&(e.gridContextXpath=this.controller.getContextXpath({})),t.show(e)},prepareWizardParams:function(e){var t=this;"cascadingcombo"==e.control?e.xpathModel=t.controller.getXpathNavigatorModel():"association"==e.control?(t.wizardPresenter.subscribe("showXPathNavigatorEditor",function(e,i){return t.onShowXpathNavigatorEditor(i)}),t.wizardPresenter.subscribe("getMultipleRelationship",function(e,i){return t.onGetMultipleRelationship(i)}),t.wizardPresenter.subscribe("getXpathData",function(e,i){return t.onGetXpathData(i)}),t.wizardPresenter.subscribe("setLocalization",function(e,i){return t.onSetLocalization(i)})):["searchlist","multiselect"].includes(e.control)&&(t.wizardPresenter.subscribe("showXPathNavigatorEditor",function(e,i){return t.onShowXpathNavigatorEditor(i)}),t.wizardPresenter.subscribe("getMultipleRelationship",function(e,i){return t.onGetSimpleRelationship(i)}),t.wizardPresenter.subscribe("getXpathData",function(e,i){return t.onGetXpathData(i)}),t.wizardPresenter.subscribe("setLocalization",function(e,i){return t.onSetLocalization(i)}),t.wizardPresenter.subscribe("changelabel",function(e,i){t.onElementChangeLabel(i)}))},onShowXpathNavigatorEditor:function(e){var t,i=this,o=new $.Deferred;i.editorValidations=i.editorValidations||{};var r=e.filter&&e.filter.types;return r=r||[],i.editorValidations[e.xpathProperty]={typeEditor:e.typeEditor,editorParameters:{types:r}},t=i.controller.isGridContext()?i.controller.getXpathNavigatorModelGrid({context:e.entity}):i.controller.getXpathNavigatorModel({context:e.entity}),$.when(t).done(function(t){var r=new bizagi.editor.component.xpathnavigator.presenter({model:t});r.subscribe("nodeDoubleClick",function(t,n){i.validateXpathChange(e.xpathProperty,e.xpathProperty,n)&&(r.closePopup(),o.resolve(n))}),r.renderPopup({position:e.position,filter:e.filter,xpath:e.xpath,allowCollection:e.allowCollection})}),o.promise()},onGetMultipleRelationship:function(e){var t=bizagi.editor.utilities.resolveRelatedEntityFromXpath(e.leftEntity),i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(e.rightEntity);return bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmultiplerelationship",leftEntityId:t,rightEntityId:i}).processRequest()},onGetSimpleRelationship:function(e){var t=bizagi.editor.utilities.resolveRelatedEntityFromXpath(e.leftEntity);return bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmultiplerelationship",leftEntityId:t}).processRequest()},onGetXpathData:function(e){var t=e.xpath;return this.controller.getXpathNavigatorModel().getNodeByXpath(t)},onSetLocalization:function(e){var t=new $.Deferred,i=e.propertyValue;i=i||bizagi.editor.utilities.buildComplexLocalizable("",e.elementGuid,e.propertyName);var o=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"multilanguage",i18n:i});return $.when(o.processRequest()).done(function(e){e&&t.resolve(e)}),t.promise()},onElementChangeLabel:function(e){this.executeCommand({command:"changeProperty",guid:e.guid,property:"displayName",value:e.value})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{getExternalData:function(e){if(bizagi.log("sucede getExternalData",e),"function"==typeof this["getDataFor"+e.control])return this["getDataFor"+e.control](e)},getDataForcascadingcombo:function(e){var t=bizagi.editor.utilities.resolveComplexXpath(e.xpath),i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(e.xpath);return bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getparententities",id:i,xpath:t}).processRequest()},getDataForquerycascadingcombo:function(e){return this.getDataForcascadingcombo(e)},getDefaultDisplayName:function(e){var t=this,i=e.element,o=i.properties,r=o.xpath,n=$.Deferred(),a=function(e,i){var o=e.split("."),r=o.slice(0,i).join("."),d=(l=t.controller.getXpathNavigatorModel({context:""})).searchNodeByXpath(r);"object"==typeof d&&d.done&&"resolved"==d.state()&&(d=bizagi.resolveResult(d)),$.when(d).done(function(){if(i<o.length-1)a(e,i+1);else{var t=l.getNodeByXpath(e);n.resolve(s(t))}})},s=function(e){return e.languages};if(o&&"object"==typeof r){if(i.isInternal())return bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getmetadataattributedisplayname",xpath:o.xpath,guidControl:t.controller.getControlsModel().getGuidControl(i.type)}).processRequest();r=i.getXpath();var l=t.controller.isGridContext()?t.controller.getXpathNavigatorModelGrid():t.controller.getXpathNavigatorModel();$.when(l).done(function(e){if((l=e||l).getNodeByXpath(r)){var t=l.getNodeByXpath(r);n.resolve(s(t))}else{i.parent.isGrid()&&(r=i.parent.getXpath()+"."+r);var o=i.getHierarchicalXpathNestedForm();a(r=o?o+"."+r:r,1)}})}else t.controller.isTemplateContext()?n.resolve(""):n.resolve(t.controller.getControlDisplayName(i.type));return n.promise()},getNodeInfo:function(e){e=e||{};var t=this.controller.isGridContext()?this.controller.getXpathNavigatorModelGrid():this.controller.getXpathNavigatorModel(),i=e.root?t.getRootNode():t.getNodeByXpath(e.xpath);return i&&"function"==typeof e.callback?e.callback.call(this,i):i},findXpathAttributes:function(e){var t=this;return t.showElementXpath(e.xpath).pipe(function(){return t.executeCommand({command:"applyOverridesElement",element:e.element})})}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerView",{},{drawCommandsEditor:function(){var e=this,t=new bizagi.editor.component.commandseditor.presenter;$.when(e.controller.getCommandsModel()).done(function(i){t.subscribe("getContext",function(t,i){return e.onGetContext(i)}),t.subscribe("getMainContainer",function(t,i){return e.getMainContainer(i)}),$.when(t.show(i)).done(function(t){e.controller.setCommandsModel(t),e.refreshRibbon()})})},onGetContext:function(){return this.controller.getContext()}}),bizagi.editor.modelerView.extend("bizagi.editor.modelerSmartphoneView",{},{init:function(e){var t=this;e=e||{},t.renderingMode="design",t.validateForm=!1,bizagi.editor.view.prototype.init.apply(this,[e]),t.currentTabIndex=0,bizagi.editorLanguage={displayname:"default",IsRightToLeft:!1,key:"default"};var i=$("body"),o={message:bizagi.localization.getResource("formmodeler-component-wait-message-loading-form")},r=new bizagi.editor.component.wait.presenter({model:o,renderArea:i});$.when(r.render(),this.controller.ready()).done(function(){$.when(t.processLayout(e)).done(function(){setTimeout(function(){r.destroy()},100)})}),e.data&&t.load(e.data),e.autoGenerate&&t.autoGenerate(),t.setOriginalModel()},load:function(e){var t=this;$.when(this.controller.ready()).done(function(){t.executeCommand({command:"loadModel",dataModel:e,canUndo:!1})})},autoGenerate:function(){var e=this;$.when(this.controller.ready()).done(function(){$.when(e.controller.getXpathNavigatorModel()).done(function(t){var i;if(t.getProcessEntityId()){t.getProcessEntityModel();var o=t.getRootNode()||{};$.isArray(o.nodes)&&(i=o.nodes[0])&&$.when(t.getChildren(i.id)).done(function(){e.executeCommand({command:"addEntityChildren",node:i,canUndo:!1})})}else i=t.getRootNode(),e.executeCommand({command:"addEntityChildren",node:i,canUndo:!1})})})},save:function(){var e={command:"saveModel",dataModel:{},canUndo:!1};return this.executeCommand(e),e.dataModel},validateAndSaveForm:function(){this.performSave(!0)},updateForm:function(e){var t;t={command:"updateModel",data:e,canUndo:!1},this.executeCommand(t)},setOriginalModel:function(){var e=this;$.when(this.controller.ready()).done(function(){e.controller.setOriginalModel()})},processLayout:function(e){var t=this,i=new $.Deferred;t.configureHtmlPage(e),t.smartPhoneMainContainer=$("<form-modeler />").appendTo(e.canvas||"body"),t.smartPhoneMainContainer.addClass("container-layout");var o=t.layoutComponent=new bizagi.editor.component.smartphone.layout.presenter({canvas:t.smartPhoneMainContainer,context:e.context,isActivityForm:e.isActivityForm});return $.when(o.render()).done(function(){setTimeout(function(){t.configureLeftPane(),t.drawRibbon(),t.controller.isSearchFormContext()&&t.drawSearchResultEditor(),t.controller.isActivityForm()&&setTimeout(function(){t.drawButtonEditor()},100),t.configureKeyHandlers(),$.when(t.configureRenderingView()).done(function(){i.resolve()})},100)}),i.promise()},configureHtmlPage:function(){$("html").addClass("biz-work-area"),$("body").addClass("biz-font").addClass("biz-normal-font").addClass("biz-text-color"),$("body").attr("oncontextmenu","return false")},configureLeftPane:function(){var e=this;$.when(e.drawControlsNavigator(),e.drawXpathNavigator(),e.drawLayoutNavigator(),e.drawBanner()).done(function(){e.smartPhoneMainContainer.find(".left-panel").tabs({beforeActivate:function(t,i){var o=$("a",i.newTab).data("rendering-mode");e.hidePropertyBox(),e.needsRedrawAfterTabChange(i.newTab.index())&&(e.currentSelectedElement=null,e.controller.removeSelectedElement(),e.renderingMode=o,e.render(o)),e.currentTabIndex=i.newTab.index(),e.setBannerVisibility(i)}}),e.setBannerVisibility()})},configureKeyHandlers:function(){var e=this;$(document).keydown(function(e){}).keyup(function(t){46===t.keyCode&&($(document.activeElement).is("input, textarea")||bizagi.form.modeler.params.reviewMode||e.deleteElement())}),$(document).on("keydown",function(t){17==t.keyCode&&e.controller.setCtrlKey(!0)}),$(document).on("keyup",function(t){e.controller.isCtrlKeyPressed()&&e.controller.setCtrlKey(!1)})},needsRedrawAfterTabChange:function(e){return this.currentTabIndex<2&&2===e||2===this.currentTabIndex&&e<2},setBannerVisibility:function(e){"show"===(e?$("a",e.newTab).attr("data-banner"):"hide")?this.showBanner():this.hideBanner()},preRender:function(e){var t=new $.Deferred;return this.validateForm&&e.canValidate?this.processValidations({canRefresh:!1}):t.resolve()},render:function(e,t){var i=this.controller.getContext();"form"==i?this.renderForm(e,t):"mobileform"==i?this.renderForm(e,t):"searchform"==i?this.renderSearchForm(t):"grid"==i||"offlinegrid"==i||"adhocgrid"==i?this.renderGridColumnEditor():"offlineform"==i?this.renderForm(e,t):"queryform"==i?this.renderForm(e,t):"startform"==i?this.renderForm(e,t):"adhocform"==i&&this.renderForm(e,t)},postRender:function(){var e=null;this.controller.thereAreMultiselection()&&(e=bizagi.editor.utilities.getGuidEmpty()),this.refreshRibbon(e)},refreshCanvas:function(){var e,t,i,o,r;e=$("#smartphone-main-panel"),t=$(".wrapper-main-scroll"),i=$("> .ui-bizagi-container-form",e),o=$(".top-scroll-grad",t),r=$(".bottom-scroll-grad",t);var n=parseFloat(e.css("padding-top"))+parseFloat(e.css("padding-bottom")),a=Math.floor(1*t.height()-n),s="adhocform"==this.controller.getContext()?$(".c-breadcrumb").height():0,l="adhocform"==this.controller.getContext()?t.width()+20:t.width(),d=t.position().top+s,c=t.position().top+t.outerHeight(!0)-r.height()+s;i.prop("scrollHeight")>a?(e.addClass("biz-auto-height"),r.css("top",c).css("width",l),r.show(),o.css("top",d).css("width",l),o.show()):(r.hide(),o.hide(),e.removeClass("biz-auto-height")),e.hasClass("biz-auto-height")&&($(".top-scroll-grad",t).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollTopInterval(t,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}),$(".bottom-scroll-grad",t).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollBottomInterval(t,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}))},renderForm:function(e,t){var i=this,o=$("#smartphone-main-panel");i.refreshRenderingView(e,t),i.controller.isActivityForm()&&(i.refreshButtonEditor(),"design"==i.renderingMode&&o.on("widgetComplete",function(){i.refreshCanvas()}),i.refreshCanvas(),setTimeout(function(){i.refreshCanvas()},500))},renderSearchForm:function(e){this.refreshRenderingView(e),this.refreshSearchFormResult()},renderGridColumnEditor:function(){this.refreshGridColumnEditor()},enableLayoutTab:function(){this.smartPhoneMainContainer.find(".left-panel").tabs("option","disabled",[])},disableLayoutTab:function(){this.smartPhoneMainContainer.find(".left-panel").tabs("option","disabled",[2])},removeFormEvents:function(){this.unsubscribeAll()},getMainPanel:function(){return this.smartPhoneMainContainer.find("#smartphone-main-panel")},getMainContainer:function(){return this.smartPhoneMainContainer}}),bizagi.editor.component.editor("bizagi.editor.component.editor.groupmapping",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o;t.ButtonName=bizagi.localization.getResource("formmodeler-component-editor-groupmapping-buttonname"),t.caption=bizagi.util.trim(t.caption).length>0?t.caption:" ",(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),o=$("div",i),this.addRequired(o)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.groupmapping").concat("#groupmapping-frame"))).done(function(){e.resolve()}),e.promise()},".biz-action-validate click":function(e,t){t.stopPropagation(),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_DOCUMENT_TEMPLATES,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}}),bizagi.editor.component.editor("bizagi.editor.component.editor.associationconfig",{init:function(e,t,i){this._super(e,t,i)},renderEditor:function(e,t){var i,o;t.ButtonName=bizagi.localization.getResource("formmodeler-component-editor-associationconfig-buttonname"),t.caption=bizagi.util.trim(t.caption).length>0?t.caption:" ",(i=$.tmpl(this.getTemplate("frame"),t)).appendTo(e),o=$("div",i),this.addRequired(o)},remove:function(){this.element.hide(),this.element.empty()},loadTemplates:function(){var e=$.Deferred();return $.when(this.loadTemplate("frame",bizagi.getTemplate("bizagi.editor.component.editor.associationconfig").concat("#associationconfig-frame"))).done(function(){e.resolve()}),e.promise()},".biz-action-validate click":function(e,t){t.stopPropagation(),this.controller.publish("propertyEditorChanged",{typeEvent:bizagi.editor.component.properties.events.PROPERTIES_SHOW_ASSOCIATION_EDITOR,type:this.options.name,id:this.element.closest(".bizagi_editor_component_properties").data("id")})}}),bizagi.editor.observableClass.extend("bizagi.editor.model",{},{init:function(e){var t=this,i=e&&e.definitions?e.definitions:{};t.context=e.context,t.isActivityForm=e.isActivityForm,t.hasOfflineForm=e.hasOfflineForm,t.isOfflineAsOnline=e.isOfflineAsOnline,t.idParentForm=e.idParentForm,t.isVersionable=bizagi.util.parseBoolean(e.isVersionable),t.deployOnParent=bizagi.util.parseBoolean(e.deployOnParent)||!1,t.isNewForm=e.isNewForm,t.idFormClass=Math.guid(),t.setResources(e.resources),t.flags=e.flags,this._super(),t.elementFactory=new bizagi.editor.base.elementFactory({definitions:i,controls:e.controls});var o={contextentity:e.contextentity,scopedefinition:e.scopedefinition,isActivityForm:e.isActivityForm,version:e.version};t.form=t.createFormElement(e.context,o),e.isActivityForm&&"form"==t.context&&(t.addCustomButtonsSwitchToRibbon(),t.addEmailOptionsToRibbonModel()),"startform"==t.context&&t.flags.UseOfflineForms&&t.addUseOfflineFormSwitchToRibbon()},isInitForm:function(){return"offlineform"==this.context||"startform"==this.context},checkActivityForm:function(){return 1==bizagi.util.parseBoolean(this.isActivityForm)},checkOfflineForm:function(){return bizagi.util.parseBoolean(this.hasOfflineForm)},checkOfflineAsOnline:function(){return bizagi.util.parseBoolean(this.isOfflineAsOnline)},updateOfflineAsOnline:function(e){this.isOfflineAsOnline=e},createFormElement:function(e,t){var i,o=this;return e=e||"form",i=o.createElement(e,t),o.isActivityForm&&i.createDefaultButtons(),i.subscribe("refresh",function(e,t){o.publish("refresh",t)}),i.subscribe("getDefaultDisplayName",function(e,t){return o.publish("getDefaultDisplayName",t)}),i.subscribe("getContextXpath",function(e,t){return o.publish("getContextXpath",t)}),i.subscribe("getNodeInfo",function(e,t){return o.publish("getNodeInfo",t)}),i.subscribe("findXpathAttributes",function(e,t){return o.publish("findXpathAttributes",t)}),i.subscribe("resizeHeigthCanvas",function(e,t){o.publish("resizeHeigthCanvas",t)}),i.subscribe("isReadOnlyForm",function(e,t){return o.publish("isReadOnlyForm",t)}),i.subscribe("getContextEntityType",function(e,t){return o.publish("getContextEntityType",t)}),i.subscribe("getControllerInfo",function(e,t){return o.publish("getControllerInfo",t)}),i.subscribe("refreshElement",function(e,t){return o.publish("refreshElement",t)}),i.subscribe("formIsLoaded",function(e,t){return o.publish("formIsLoaded",t)}),i.subscribe("getIdForm",function(){return o.publish("getIdForm")}),i.subscribe("getOriginalModel",function(){return o.publish("getOriginalModel")}),i.subscribe("getModel",function(){return o.publish("getModel")}),i.subscribe("getLocalizationObject",function(e,t){return o.getLocalizationObject(t)}),i.subscribe("getResourceByUri",function(e,t){return o.hashResources[t.uri]}),i},createDefaultButtons:function(e){var t=[],i=Math.guid(),o=this.createElement("formbutton",{guid:i,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-save"),i,"caption"),actions:["submitData","refresh"]}});o.setParent(e);var r=Math.guid(),n=this.createElement("formbutton",{guid:r,properties:{caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("render-form-button-next"),r,"caption"),actions:["validate","submitData","next"]}});return n.setParent(e),t.push(o),t.push(n),t},getForm:function(){return this.form},createLayoutElement:function(e){var t=this,i=t.createElement("horizontal");return e.children.forEach(function(e){i.addElement(t.createChildElement(e))}),i},createChildElement:function(e){var t=$.extend(e.properties,{type:e.type});return this.createElement(e.type,{properties:t})},loadModel:function(e,t,i){var o=this;i=void 0!==i&&bizagi.util.parseBoolean(i),o.form=o.createElement(e,t,i),o.isActivityForm&&0===o.form.buttons.length&&o.form.createDefaultButtons(),o.form.subscribe("refresh",function(e,t){o.publish("refresh",t)}),o.form.subscribe("getDefaultDisplayName",function(e,t){return o.publish("getDefaultDisplayName",t)}),o.form.subscribe("getContextXpath",function(e,t){return o.publish("getContextXpath",t)}),o.form.subscribe("getNodeInfo",function(e,t){return o.publish("getNodeInfo",t)}),o.form.subscribe("findXpathAttributes",function(e,t){return o.publish("findXpathAttributes",t)}),o.form.subscribe("resizeHeigthCanvas",function(e,t){o.publish("resizeHeigthCanvas",t)}),o.form.subscribe("isReadOnlyForm",function(e,t){return o.publish("isReadOnlyForm",t)}),o.form.subscribe("getContextEntityType",function(e,t){return o.publish("getContextEntityType",t)}),o.form.subscribe("getControllerInfo",function(e,t){return o.publish("getControllerInfo",t)}),o.form.subscribe("refreshElement",function(e,t){return o.publish("refreshElement",t)}),o.form.subscribe("formIsLoaded",function(e,t){return o.publish("formIsLoaded",t)}),o.form.subscribe("getIdForm",function(){return o.publish("getIdForm")}),o.form.subscribe("getOriginalModel",function(){return o.publish("getOriginalModel")}),o.form.subscribe("getModel",function(){return o.publish("getModel")}),o.form.subscribe("getLocalizationObject",function(e,t){return o.getLocalizationObject(t)}),o.form.subscribe("getResourceByUri",function(e,t){return o.hashResources[t.uri]})},saveModel:function(){return this.form.getPersistenceModel()},getChangeset:function(){var e=this,t=e.publish("getIdForm"),i=e.publish("isNewForm"),o=e.publish("getIdParentForm"),r=[{action:"merge",deployOnParent:i?!e.isVersionable:e.deployOnParent,id:t,name:"form_"+t,type:e.getFormType(),parentId:o,modifiedByUser:BIZAGI_USER,content:JSON.stringify(e.form.getPersistenceModel())}];if(i&&e.isVersionable){var n=e.idFormClass;r.push({action:"merge",deployOnParent:!1,id:n,name:"FormClass_"+n,type:"FormClass",parentId:e.idParentForm,modifiedByUser:BIZAGI_USER,content:JSON.stringify({})}),r[0].parentId=n,e.publish("setIdParentForm",{idParentForm:n})}var a=this.form.getLocalizablePropertiesModel().concat(this.form.getLocalizableValidationMessagesModel(t));return{changeSet:r.concat(a).concat(e.getPropertiesDeleted(a))}},mustSetDeployOnParent:function(){var e=this.publish("getContextEntityType");return this.isVersionable&&"application"!=e&&this.isQueryForm()},getPropertiesDeleted:function(e){var t=this.resources||[];this.checkActivityForm()&&!this.hasCustomButtons()&&(t=t.filter(function(e){return"bizagiObjects.form"==e.category}));var i=[];return t.forEach(function(t){var o;o=t,e.filter(function(e){return e.id==o.Id}).length>0||i.push({action:"delete",ids:[t.Id]})}),i},getLocalizationObject:function(e){var t=e.i18n,i=this.hashResources[t.uri];if(e.regenerateGuid&&i&&(delete this.hashResources[t.uri],i.uri=e.newUri,this.hashResources[e.newUri]=i),!i)return t;var o={};return(i.languages||[]).forEach(function(e){o[e.Code]=e.Value}),{uri:i.uri,default:i.DefaultValue,languages:o}},setResources:function(e){var t=this;t.hashResources={},t.resources=e||[],t.resources.forEach(function(e){t.hashResources[e.uri]=e})},setDeployOnParent:function(e){this.deployOnParent=e},isQueryForm:function(){return"queryform"==this.context},getFormType:function(){return"searchform"==this.context?"SearchForm":"offlineform"==this.context?"OfflineForm":"queryform"==this.context?"Query":"startform"==this.context?"StartForm":"template"==this.context?"Template":"Form"},createElement:function(e,t,i){return this.elementFactory.createElement(e,t,i,this.resources)},getRibbonModelData:function(){return"offlineform"==this.context?this.Class.ribbonModelDataOffline:"template"==this.context?this.Class.ribbonModelTemplateData:"adhocform"==this.context?bizagi.form.modeler.params.reviewMode?{elements:[]}:this.Class.ribbonModelAdhoc:this.Class.ribbonModelData},addWidgets:function(e){this.elementFactory.addWidgetsControls(e)},getFlags:function(){return this.flags},addEmailOptionsToRibbonModel:function(){this.getRibbonModelData().elements.push({caption:"formmodeler-component-ribbon-caption-email",css:"bz-studio bz-newSystemConfiguration_32x32_standard",hide:!0,name:"email",elements:[{caption:"formmodeler-component-ribbon-caption-emailtemplate",style:"email-template",action:"emailTemplate",align:"vertical",disabled:"disabled",css:"bz-studio bz-newSystemConfiguration_32x32_standard"}]})},addCustomButtonsSwitchToRibbon:function(){for(var e=this.getRibbonModelData(),t={caption:"formmodeler-component-ribbon-caption-useCustomButtons",style:"validate",action:"useCustomButtons",disabled:"disabled",css:"bz-studio bz-form-buttons_16x16_standard",checked:!1,name:"customButtons"},i=0;i<e.elements.length;i++)"formmodeler-component-ribbon-caption-show"==e.elements[i].caption&&e.elements[i].elements.push(t)},addUseOfflineFormSwitchToRibbon:function(){for(var e=this.getRibbonModelData(),t={caption:"formmodeler-component-ribbon-caption-useofflineform",style:"validate",action:"useOfflineForm",css:"bz-studio bz-forms-offline_16x16_standard",tooltip:"formmodeler-component-ribbon-offline-caption-useoffline-tooltip",checked:!1},i=0;i<e.elements.length;i++)"formmodeler-component-ribbon-caption-show"==e.elements[i].caption&&e.elements[i].elements.push(t)}}),bizagi.editor.base.form.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"subscribe"!=key&&"unsubscribe"!=key&&"publish"!=key&&(bizagi.editor.model.prototype[key]=eval("var tmp = function(){ \nif (this.getForm()){ \nreturn this.getForm()."+key+".apply(this.getForm(), arguments); \n} \nreturn null;};\ntmp \n"));bizagi.editor.model.extend("bizagi.editor.model",{ribbonModelData:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",css:"bz-sprite-img bz-save_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-redo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyfrom",style:"copy-from",action:"copy-from",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-form_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-warning_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-validation",name:"validation",elements:[{caption:"formmodeler-component-ribbon-caption-actionsvalidations",style:"actions-validations",action:"actionsvalidations",align:"vertical",disabled:"disabled",css:"bz-studio bz-actions-and-validations_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-element",name:"element",css:"bz-studio bz-save_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-convertto",style:"convert-to",action:"convertto",disabled:"disabled",css:"bz-studio bz-convert-to_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-delete",style:"delete",action:"delete",disabled:"disabled",css:"bz-studio bz-delete_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-rename",style:"rename",action:"rename",disabled:"disabled",css:"bz-studio bz-rename_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-visible",style:"visible",property:"visible",disabled:"disabled",css:"bz-studio bz-visible_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"visible",value:{fixedvalue:"true"},css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"visible",value:{fixedvalue:"false"},css:"bz-studio bz-boolean-remove_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-expression",style:"expression",property:"visible",value:"expression",css:"bz-studio bz-expresion-ex_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-editable",style:"editable",property:"editable",disabled:"disabled",css:"bz-studio bz-editable_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"editable",value:{fixedvalue:"true"},css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"editable",value:{fixedvalue:"false"},css:"bz-studio bz-boolean-remove_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-expression",style:"expression",property:"editable",value:"expression",css:"bz-studio bz-expresion-ex_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-required",style:"required",property:"required",disabled:"disabled",css:"bz-studio bz-required_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"required",value:{fixedvalue:"true"},css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"required",value:{fixedvalue:"false"},css:"bz-studio bz-boolean-remove_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-expression",style:"expression",property:"required",value:"expression",css:"bz-studio bz-expresion-ex_16x16_standard"}]}]},{caption:"formmodeler-component-ribbon-caption-languages",name:"languages",css:"bz-studio bz-world_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-language",style:"language",property:"language",css:"bz-studio bz-world_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-default",style:"language",property:"language",css:"bz-studio bz-world_16x16_standard",action:"Language",value:{displayname:"default",IsRightToLeft:!1,key:"default"}}]}]}]},ribbonModelTemplateData:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-redo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-studio bz-warning_16x16_standard"}]}]},ribbonModelDataOffline:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-studio bz-warning_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-validation",name:"validation",elements:[{caption:"formmodeler-component-ribbon-caption-actionsvalidations",style:"actions-validations",action:"actionsvalidations",align:"vertical",disabled:"disabled",css:"bz-studio bz-actions-and-validations_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-element",name:"element",css:"bz-studio bz-undo_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-convertto",style:"convert-to",action:"convertto",disabled:"disabled",css:"bz-studio bz-convert-to_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-delete",style:"delete",action:"delete",disabled:"disabled",css:"bz-studio bz-delete_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-rename",style:"rename",action:"rename",disabled:"disabled",css:"bz-studio bz-rename_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-visible",style:"visible",property:"visible",disabled:"disabled",css:"bz-studio bz-visible_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"visible",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"visible",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-editable",style:"editable",property:"editable",disabled:"disabled",css:"bz-studio bz-editable_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"editable",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"editable",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-required",style:"required",property:"required",disabled:"disabled",css:"bz-studio bz-required_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"required",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"required",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]}]},{caption:"formmodeler-component-ribbon-caption-languages",name:"languages",css:"bz-studio bz-world_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-language",style:"language",property:"language",css:"bz-studio bz-world_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-default",style:"language",property:"language",css:"bz-studio bz-world_16x16_standard",action:"Language",value:{displayname:"default",IsRightToLeft:!1,key:"default"}}]}]}]},ribbonModelAdhoc:{elements:[{caption:"formmodeler-component-ribbon-caption-form",name:"form",elements:[{caption:"formmodeler-component-ribbon-caption-undo",style:"undo",action:"undo",disabled:"disabled",css:"bz-studio bz-undo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-redo",style:"redo",action:"redo",disabled:"disabled",css:"bz-studio bz-redo_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-save",style:"save",action:"save",align:"vertical",disabled:"disabled",css:"bz-studio bz-save_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-copyformat",style:"copy-format",action:"copy-format",align:"vertical",disabled:"disabled",css:"bz-studio bz-copy-format_32x32_standard"},{caption:"formmodeler-component-ribbon-caption-properties",style:"form-properties",action:"formproperties",align:"vertical",disabled:"disabled",css:"bz-studio bz-form-properties_32x32_standard"}]},{caption:"formmodeler-component-ribbon-caption-show",name:"show",css:"bz-studio bz-warning_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-validations",style:"validate",action:"validate",checked:!1,css:"bz-studio bz-studio bz-warning_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-element",name:"element",css:"bz-studio bz-undo_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-delete",style:"delete",action:"delete",disabled:"disabled",css:"bz-studio bz-delete_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-rename",style:"rename",action:"rename",disabled:"disabled",css:"bz-studio bz-rename_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-visible",style:"visible",property:"visible",disabled:"disabled",css:"bz-studio bz-visible_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"visible",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"visible",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-editable",style:"editable",property:"editable",disabled:"disabled",css:"bz-studio bz-editable_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"editable",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"editable",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]},{caption:"formmodeler-component-ribbon-caption-required",style:"required",property:"required",disabled:"disabled",css:"bz-studio bz-required_16x16_standard",elements:[{caption:"formmodeler-component-ribbon-caption-true",style:"true",property:"required",value:"true",css:"bz-studio bz-yes-no_16x16_standard"},{caption:"formmodeler-component-ribbon-caption-false",style:"false",property:"required",value:"false",css:"bz-studio bz-boolean-remove_16x16_standard"}]}]}]}},{}),bizagi.editor.observableClass.extend("bizagi.editor.controls",{},{init:function(e,t){this._super(),this.controls={},this.convertToMap={},this.controlsToConvert={},t=t||{},void 0!==e&&this.processData(e,t)},processData:function(e,t){var i=this;$.each(e.controls,function(e,o){t[o.name]||(i.isConvertible(o.name)&&i.addControlInConvertToMap(o),i.controls[o.name]=o)})},findControl:function(e){var t=this.controls[e];if(null==t)throw"there aren't a control with name "+e;return t},disabledControls:function(e){for(var t in e)this.controls[t]&&e[t]&&delete this.controls[t]},getDesignProperties:function(e){var t=this.findControl(e);return t.design&&t.design.properties?t.design.properties:{}},getGuidControl:function(e){return this.findControl(e).jquery},isConvertible:function(e){return"association"!=e&&("userpassword"!=e&&("comboselected"!=e&&("getuser"!=e&&"stakeholder"!=e)))},addControlInConvertToMap:function(e){var t=e.type||"render",i=e.design?e.design.properties:null;if(i){var o=i.xpath;if(o&&o["bas-type"]){var r=this.getConvertToMap(t);r[o["bas-type"]]||(r[o["bas-type"]]=[]);var n={controlName:e.name,filterBy:o["editor-parameters"]?o["editor-parameters"].types:null,caption:bizagi.editor.utilities.resolveInternalResource(e.display),style:e.style};r[o["bas-type"]].push(n),this.controlsToConvert[e.name]={siblings:r[o["bas-type"]],definition:n}}}},getConvertToMap:function(e){return this.convertToMap[e]||(this.convertToMap[e]={}),this.convertToMap[e]},getControlsToConvert:function(e){var t=this;if(!t.controlsToConvert[e])return[];var i=t.controlsToConvert[e];return $.grep(i.siblings,function(e,o){return e.controlName!==i.definition.controlName&&t.filterBy(i,e.filterBy)})},filterBy:function(e,t){if(e.definition.filterBy&&$.isArray(e.definition.filterBy)&&t&&$.isArray(t)){for(var i=0,o=e.definition.filterBy.length;i<o;i+=1){var r=e.definition.filterBy[i];if(t.indexOf(r)>=0)return!0}return!1}return!0},disableControlProperties:function(e){for(var t in bizagi.editor.overrides[e]){var i=bizagi.editor.overrides[e][t],o=this.controls[t];if(null!=o&&bizagi.editor.utilities.isObject(i)){var r=i.properties&&i.properties.disable||[];o.disableProperties=o.disableProperties?o.disableProperties:[];for(var n=0;n<=r.length;n++)o.disableProperties.push(r[n])}}}}),bizagi.editor.base.HostFacade=function(){return this.internalCache={},this.isHost=function(){return!bizagi.editor.base.info.isCloud()&&"undefined"!=typeof sharedObject},this.invokeHost=function(e,t){var i=new $.Deferred;bizagi.log("Invoking host method "+e,t);var o=sharedObject.call(e,JSON.encode(t));bizagi.log("Result from invoking host method "+e,o);try{o=JSON.parse(o)}catch(t){bizagi.log("Could not parse result for call "+e,t.message)}return i.resolve(o),i.promise()},{getControlsMetadata:function(){var e,t=new $.Deferred;return internalCache.getControlsMetadata?internalCache.getControlsMetadata:(e=isHost()?invokeHost("GetControlDefinitions"):$.ajax({url:"jquery/editor/base/mocks/stub.controls.definition.json.txt",dataType:"json",async:!0}),$.when(e).done(function(e){bizagi.log("Current working control definitions: ",e),internalCache.getControlsMetadata=e,t.resolve(e)}),t.promise())},getXpathNavigatorFirstLoad:function(){return isHost()?invokeHost("XpathNavigatorFirstLoad"):$.ajax({url:"jquery/editor/component/xpathNavigator/mocks/stub.xpathnavigator.firstLoad.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},getUserfieldDependencies:function(e){return isHost()?invokeHost("GetUserfieldDependencies",{name:e}):$.ajax({url:"jquery/editor/component/xpathNavigator/mocks/stub.xpathnavigator.firstLoad.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},GetUserfieldIconDependencies:function(e,t,i){return isHost()?invokeHost("GetUserfieldIconDependencies",{name:e,density:t,size:i}):$.ajax({url:"jquery/editor/base/mocks/stub.loadUserFieldIcon.json.txt",dataType:"text",async:!0}).pipe(function(e){return e})},getXpathNavigatorExpandLoad:function(e){var t;return isHost()?(params={contextScope:e.contextScope,guid:e.guidRelatedEntity,xpath:e.xpath,style:e.style,isScopeAttribute:e.isScopeAttribute},t=invokeHost("XpathNavigatorExpandLoad",params)):t=$.ajax({url:"jquery/editor/component/xpathNavigator/mocks/stub.xpathnavigator.forexpand.json.txt",dataType:"json",async:!0}).pipe(function(e){return e}),t},getLayoutNavigatorModel:function(){return isHost()?invokeHost("GetLayoutDefinitions"):$.ajax({url:"jquery/editor/component/layoutnavigator/mocks/stub.layoutnavigator.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},executeBasActions:function(e){var t;new $.Deferred;if(isHost())t=invokeHost("ExecuteBasActions",e);else{var i=e.actiontype.toLowerCase();t=$.ajax({url:"jquery/editor/base/mocks/stub."+i+".json.txt",dataType:"json",async:!0}).pipe(function(e){return e})}return t},LoadForm:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadform.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},GetReleatedEntityForms:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadrelatedforms.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadExpression:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadexpression.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadInterface:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadinterface.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadLocalizationForm:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.multilenguages.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadCopyForm:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadcopyform.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadFilterEditor:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadfilter.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadDocumentTemplates:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loaddocumentemplates.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},LoadEntityValues:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadentityvalues.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},GetAvailableLanguages:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.getavailablelanguages.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},GetAttributeDisplayName:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.atributtedisplayname.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},OpenWidgetstore:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadwigdetstore.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},InstallWidget:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.installwidget.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},GetWidgets:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.loadwigdets.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},VerifyLetters:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.verifyletters.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},GetParentEntities:function(){return $.ajax({url:"jquery/editor/base/mocks/stub.getparententities.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},CreateForm:function(e){var t=e.parameters,i=this.findKeyInParameters(t,"guidRender"),o=this.findKeyInParameters(t,"propertyName"),r=this.findKeyInParameters(t,"context");setTimeout(function(){bizagi.form.modeler.updateForm({actiontype:"CreateForm",guidrender:i,propertyname:o,context:r,idform:Math.guid()})},100)},findKeyInParameters:function(e,t){for(var i=0,o=e.length;i<o;i+=1)if(e[i].key===t)return e[i].value},getRibbonBaseModel:function(){return $.ajax({url:"jquery/editor/component/ribbon/mocks/stub.base.ribbon.json.txt",dataType:"json",async:!0}).pipe(function(e){return e})},loadRuleExpressions:function(e){var t=!1;isHost()&&(t=invokeHost("LoadBooleanExpression")),t&&(t=JSON.parse(t))}}}(),bizagi.editor.base.info=function(){function e(){}return e.prototype.isCloud=function(){return!(BIZAGI_URL_REST_SERVICES.indexOf("localhost")>=0)},new e}(),bizagi.editor.refreshableCommand.extend("bizagi.editor.moveElementCommand",{},{execute:function(){var e=this.arguments,t=this.controller.getContextInfo();return e.elementType=e.elementType||"render",this.parent||(this.parent=this.arguments.parent||t.guid),this.model.moveElement(e.initialPosition,e.finalPosition,this.parent,e.elementType),!0},undo:function(){var e=this.arguments;return this.model.moveElement(e.finalPosition,e.initialPosition,this.parent,e.searchformresult),!0}}),bizagi.rendering.element.original=$.extend(!0,{},bizagi.rendering.element.prototype),$.extend(bizagi.rendering.element.prototype,{isContainedInNestedForm:function(){return!!this.parent&&("nestedForm"===this.parent.properties.type||("collectionnavigator"===this.parent.properties.type||this.parent.isContainedInNestedForm()))},isContainedInCollectionNavigator:function(){return this.getFormContainer().properties.isNavigationForm||!1},isContainedInGrid:function(){return null!=this.column},isReadOnlyForm:function(){return!!((this.getFormContainer()||{}).properties||{}).isReadOnly},findElement:function(e){return e&&this.properties.guid===e?this:null},selectElement:function(){},unselectElement:function(){}}),bizagi.rendering.container.original=$.extend(!0,{},bizagi.rendering.container.prototype),$.extend(bizagi.rendering.container.prototype,{postRenderContainer:function(e){var t=this;return bizagi.rendering.container.original.postRenderContainer.apply(this,arguments),e.hasClass("ui-sortable")&&e.sortable("destroy"),e.addClass("ui-bizagi-itemfordrag"),t.addDraggableClassToContainer(),t.isReadOnlyForm()?e:"template"==t.getFormType()?("template"==t.properties.type&&e.click(function(e){t.onClickCanvas(e)}),e):(t.isContainerSortable()&&(e.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),bizagi.form.modeler.params.reviewMode||setTimeout(function(){t.configureSortablePlugin(e)},100)),t.isClickEventAllowed()&&(void 0!==t.properties.type&&"searchForm"!==t.properties.type&&"queryForm"!==t.properties.type?(e.mousedown(function(e){t.onMouseDown(e)}),e.click(function(e){t.onClick(e)})):e.click(function(e){t.onClickCanvas(e)})),t.changeVisibility(t.properties.visible),e)},selectElementByGuid:function(e){for(var t=0,i=e.length;t<i;t++){var o=e[t],r=this.findElement(o);r&&r.selectElement({IsOnClickEvent:!1})}},findElement:function(e){if(!e)return null;if(this.properties.guid===e)return this;for(var t=0;t<this.children.length;t++){var i=this.children[t].findElement(e);if(i)return i}return null},disableSortablePlugin:function(){this.container&&this.container.hasClass("ui-sortable")&&this.container.data()["ui-sortable"]&&this.container.sortable("destroy");for(var e=0,t=this.children.length;e<t;e+=1)this.children[e].container&&this.children[e].disableSortablePlugin()},selectElement:function(e){var t=this.container;t.addClass("ui-bizagi-container-selected");var i=t.offset();$.extend(i,{width:t.outerWidth(),height:t.outerHeight()}),this.triggerGlobalHandler("selectelement",$.extend(e,{position:i,guid:this.properties.guid,element:t,type:this.properties.type}))},unselectElement:function(e){this.container.removeClass("ui-bizagi-container-selected"),e&&$.extend(e,{guid:this.properties.guid}),this.triggerGlobalHandler("unselectelement",e)},configureSortablePlugin:function(e){var t=this,i=t.triggerGlobalHandler("getMainPanel",{}),o=i&&i[0]&&"#"+i[0].id||"";e.addClass("ui-bizagi-container-connectedSortable"),e.bind("sortstart",function(e,i){t.onSortStart(i)}),e.bind("sortstop",function(e,i){t.onSortFinish(i)}),e.bind("sortactivate",function(e,i){t.currentDragSource=t.getDragSource(i.item)});e.sortable({items:"> .ui-bizagi-draggable-item",revert:!1,connectWith:".ui-bizagi-container-connectedSortable:not(.ui-sortable-helper)",distance:10,cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-placeholder",delay:150,cancel:"layout"===t.getMode()?".ui-bizagi-render, .ui-bizagi-input-editable":".ui-bizagi-input-editable, .ui-bizagi-grid-cell",containment:o+" .ui-bizagi-container-form",helper:function(e,i){return t.sortableHelper(i)},start:function(){i&&i.addClass("ui-start-drag")},stop:function(){i&&i.removeClass("ui-start-drag")},beforeStop:function(){window.x3=$("#mtool-container-helper")}}).disableSelection(),t.loadHelperTemplate()},setConnectWith:function(e,t){var i;void 0!==e&&(i=(i=".ui-bizagi-container-connectedSortable")+"[id!= "+t+"]",e.container&&e.container.hasClass("ui-sortable")&&e.container.data()["ui-sortable"]&&e.container.sortable("option","connectWith",i),this.setConnectWith(e.parent,t))},addDraggableClassToContainer:function(){var e=this;if(e.isContainerDraggable()){if(e.container.addClass("ui-bizagi-draggable-item"),e.container.addClass("ui-dashed-layout"),"horizontal"===e.properties.type&&e.container.addClass("ui-table"),0===$(".ui-widget-content",e.container).children().length)$(".ui-widget-content",e.container).append('<div class="children"></div>');else if(e.container.hasClass("ui-bizagi-container-tab"))for(var t=$(".ui-bizagi-container-tabItem",e.container),i=0;i<t.length;i++){var o=$(t[i]);0===o.children().length&&o.append('<div class="children"></div>')}if(!e.container.hasClass("ui-bizagi-container-nestedform")&&!e.container.hasClass("ui-bizagi-container-collectionnavigator")){var r=$("> .ui-bizagi-container-panel",e.container);for(r.addClass("ui-col"),i=0;i<r.length;i++){var n=$(r[i]);0===n.children().length&&n.append('<div class="children"></div>')}}e.container.hasClass("ui-dashed-layout")&&(e.container.data("display","Layout"),e.container.data("type","layout")),$("> .ui-bizagi-container-panel",e.container).mouseenter(function(){$(this).addClass("ui-col-hover")}).mouseleave(function(){$(this).removeClass("ui-col-hover")})}},isContainerDraggable:function(){if(this.isContainedInNestedForm()||this.isContainedInCollectionNavigator())return!1;var e=this.properties.type||"form";return"group"==e||"nestedForm"==e||"tab"==e||"horizontal"==e||"contentPanel"==e||"collectionnavigator"==e},isContainerSortable:function(){if(this.isContainedInNestedForm()||this.isContainedInCollectionNavigator())return!1;var e=this.properties.type||"form";return"form"==e||"group"==e||"panel"==e||"tabItem"==e||"queryForm"==e||"searchForm"==e||"contentPanel"==e||"offlineForm"==e||"adhocForm"==e},isElementSortAllowed:function(e){var t=this.getMode();if("design"===t){if(e.hasClass("ui-bizagi-container-horizontal"))return!1}else if("layout"===t&&e.hasClass("ui-bizagi-render"))return!1;return!0},isClickEventAllowed:function(){var e=this.getMode();if(this.isContainedInNestedForm()||this.isContainedInCollectionNavigator())return!1;var t=this.properties.type||"form";if("design"==e){if("panel"==t)return!1}else if("layout"===e&&("form"==t||"group"==t||"panel"==t))return!1;return!0},sortableHelper:function(e){if(!this.helperTemplate)return null;e.addClass("ui-dragging");var t=e.data(),i=t.type?t.type.toLowerCase():"render",o=t.guid,r=t.display,n=this.triggerGlobalHandler("getControlIcon",{type:i,id:o}),a=this.triggerGlobalHandler("getMainContainer",{});r&&""!==r||(r=i);var s=$.tmpl(this.helperTemplate,{id:i,caption:r,icon:n}),l=$(".wrapper-main-scroll",a),d=s.appendTo(l).css({zIndex:900}),c=parseFloat($("label",d).width())+parseFloat($(".biz-ico",d).eq(0).width())+40+"px";return d.css("width",c),d},loadHelperTemplate:function(){var e=this;return $.when(bizagi.templateService.getTemplate(bizagi.getTemplate("bizagi.editor.component.renderingview").concat("#bizagi-render-drag-helper"))).pipe(function(t){return e.helperTemplate=t,e.helperTemplate})},getDragSource:function(e){var t={container:!1,toolbar:!1,xpathNavigator:!1,layout:!1,data:null};return $(e).hasClass("ui-bizagi-render")||$(e).hasClass("ui-bizagi-container")?(t.container=!0,t.data={guid:$(e).parents(".ui-bizagi-container").first().data("guid")}):$(e).hasClass("mtool-item")?(t.toolbar=!0,t.data=$(e).data("render")):$(e).hasClass("bizagi_editor_xpathnavigator_data")?(t.xpathNavigator=!0,t.data=$(e).data()):$(e).hasClass("bz-fm-layout-navigator-item")&&(t.layout=!0,t.data=$(e).data("id")),t},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?$(this.container).removeClass("ui-state-disabled"):$(this.container).addClass("ui-state-disabled")},getSortableContainer:function(){return this.container},onSortStart:function(e){var t=$(e.item).parent().children(".ui-bizagi-itemfordrag").index(e.item);e.item.data("start-position",t);var i=$(e.item).parents(".ui-bizagi-container").first().data("guid")||this.triggerGlobalHandler("getparentid",{guid:$(e.item).data("guid")});e.item.data("sourceContainer",i),t>=0&&this.triggerGlobalHandler("sortstart")},onSortFinish:function(e){if(null==bizagi.sortContainerTimeout){bizagi.sortContainerTimeout=setTimeout(function(){bizagi.sortContainerTimeout=null},100);var t=$(e.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(e.item),i=$(e.item).parents(".ui-bizagi-container").first().data("guid")||this.triggerGlobalHandler("getparentid",{guid:$(e.item).data("guid")}),o=e.item.data("start-position"),r=e.item.data("sourceContainer");return 0==this.isElementSortAllowed($(e.item))?(this.getSortableContainer().sortable("cancel"),!1):(t>=0&&this.triggerGlobalHandler("sortfinish",{source:this.currentDragSource,initialPosition:o,finalPosition:t,sourceContainer:r,targetContainer:i}),!0)}},onClickCanvas:function(e){e.stopImmediatePropagation(),$(".ui-bizagi-render").removeClass("ui-state-active"),$(".bz-form-item").removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").removeClass("ui-state-active"),$(".ui-bizagi-container").removeClass("ui-bizagi-container-selected"),this.unselectElement(),0!=e.button&&1!=e.button||this.triggerGlobalHandler("selectcontainerform",{})},onClick:function(e){var t=this.container;e.stopImmediatePropagation(),this.triggerGlobalHandler("checkCtrlKey",{})?t.hasClass("ui-bizagi-container-selected")?this.unselectElement({ctrlIsPressed:!0}):this.selectElement({IsOnClickEvent:!0,ctrlIsPressed:!0}):0!=e.button&&1!=e.button||($(".ui-bizagi-render").removeClass("ui-state-active"),$(".ui-bizagi-container").not(t).removeClass("ui-bizagi-container-selected"),t.hasClass("ui-bizagi-container-selected")?this.unselectElement():this.selectElement({IsOnClickEvent:!0}))},onMouseDown:function(e){if(0==e.button||1==e.button)this.setConnectWith(this.parent,this.container.data("guid"));else if(2==e.button)return this.triggerGlobalHandler("elementrightclick",{guid:this.properties.guid,position:{x:e.clientX,y:e.clientY}}),e.preventDefault(),e.stopPropagation(),!1}}),bizagi.rendering.form.original=$.extend(!0,{},bizagi.rendering.form.prototype),$.extend(bizagi.rendering.form.prototype,{postRenderContainer:function(e){if(bizagi.rendering.form.original.postRenderContainer.apply(this,arguments),void 0!==typeof this.params.allowButtons&&this.params.allowButtons||$(".ui-bizagi-button-container",e).remove(),this.properties.messageValidation&&this.properties.messageValidation.length>0){var t=this.createMessageValidationElement(this.properties.messageValidation);t.tooltip(),e.prepend(t)}return e},createMessageValidationElement:function(e){var t=this;e=e.replace("</br>","");var i=bizagi.localization.getResource("formmodeler-validations-form"),o=$('<div class="ui-message-validation"/>');return $("<span>"+i+'<i class="biz-ico bz-studio bz-warning-red_16x16_standard" title="'+e+'"></i></span>').appendTo(o),$(o,"div").click(function(){t.triggerGlobalHandler("showPropertiesForm")}),o}}),bizagi.rendering.render.original=$.extend(!0,{},bizagi.rendering.render.prototype),$.extend(bizagi.rendering.render.prototype,{postRenderElement:function(e){var t=this,i=t.properties;if(bizagi.rendering.render.original.postRenderElement.apply(this,arguments),t.isReadOnlyForm())return e;if(setTimeout(function(){"label"===i.type&&t.triggerGlobalHandler("validateFormIsActive",{})&&0===bizagi.editor.utilities.resolvei18n(i.displayName).length&&e.addClass("displayName__required")},10),e.attr("guid",t.properties.guid),"template"==t.getFormType())return t.configureLayoutElement(e);if(!t.isContainedInNestedForm()&&!t.isContainedInCollectionNavigator()){t.setMouseDownEvent(e),t.isContainedInGrid()||(e.addClass("ui-bizagi-draggable-item"),e.addClass("ui-bizagi-itemfordrag"));var o,r=$(".ui-bizagi-render-search",e);if(r.length>0&&r.parent().addClass("ui-bizagi-display-as-search"),t.isClickEventAllowed())o="design"==t.getMode()&&"grid"==t.properties.type?t.getLabelGrid():t.getLabel(),e.click(function(i){t.onRenderClick(i,e)}),bizagi.form.modeler.params.reviewMode||o.dblclick(function(){t.onLabelDoubleClick(o)}),t.properties.validationMessage&&t.showValidationMessage(t.properties.validationMessage)}return e.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),t.resetStyle(e)},configureLayoutElement:function(e){var t=this;return t.configureDroppablePlugin(e),t.configureDraggablePlugin(e),e.click(function(i){t.onRenderClick(i,e)}),e.dblclick(function(){t.onLabelDoubleClick(e)}),e.find(".biz-template-editor-render-hide-control").click(function(i){t.onRemoveElement(i,e)}),t.setDeleteLayoutItem(e),e},setDeleteLayoutItem:function(e){var t=this,i=(t.properties.type,$("<span class='biz-icon biz-tmpl-delete pull-right bz-studio bz-delete_16x16_standard'></span>")),o=$("<span class='biz-icon biz-tmpl-delete pull-right bz-studio bz-undo_16x16_black'></span>"),r=e.closest("[id]");setTimeout(function(){if(0==r.length&&t.triggerGlobalHandler("isDeleteOptionAllowed",{guid:t.properties.guid}))e.addClass("hover-applied"),e.hover(function(){$(this).append(o)},function(){$(this).find("span.biz-tmpl-delete").detach()}),o.click(function(){t.triggerGlobalHandler("restoreItem",{guid:t.properties.guid})});else{if(null==r.attr("id"))return;if(r.hasClass("hover-applied"))return;r.addClass("hover-applied"),r.hover(function(){$(this).append(i)},function(){$(this).find("span.biz-tmpl-delete").detach()}),n=r,i.click(function(){t.triggerGlobalHandler("deleteRepeaterItem",{guid:n.attr("id")})})}var n},10)},configureDraggablePlugin:function(e){e.draggable({helper:"clone",zIndex:9999,opacity:.75,cursorAt:{left:5},containment:"document",cancel:".biz-template-editor-render-placeholder",start:function(e,t){$(t.helper).data("isLayoutElement",!0)}})},configureDroppablePlugin:function(e){var t=this;e.droppable({hoverClass:"ui-state-highlight",tolerance:"pointer",activeClass:"ui-editor-highlight",greedy:!0,drop:function(e,t){$(this).addClass("ui-state-highlight")},activate:function(){t.getFormContainer().container.find("[noShow='true']").show()},deactivate:function(){t.getFormContainer().container.find("[noShow='true']").hide()}}),e.on("drop",function(e,i){t.onDrop(i)})},getLabelGrid:function(){return $(".bz-rn-grid-header-title",this.element)},resetStyle:function(e){var t=e,i=t.css("color"),o=t.css("background-color");return"black"==i&&t.css("color",""),"white"==o&&t.css("background-color",""),t},selectElement:function(e){var t,i=this,o=i.properties;if(!i.actionInProgress&&i.element){i.actionInProgress=!0,i.element.addClass("ui-state-active");var r=i.element.offset();$.extend(r,{width:i.element.outerWidth(),height:i.element.outerHeight()}),t=$.extend(e,{position:r,guid:i.properties.guid,element:i.element,type:i.properties.type,isInternal:o.isInternal}),$.when(i.triggerGlobalHandler("selectelement",t)).always(function(){i.actionInProgress=!1})}},unselectElement:function(e){this.element.removeClass("ui-state-active"),e&&$.extend(e,{guid:this.properties.guid}),this.triggerGlobalHandler("unselectelement",e)},isClickEventAllowed:function(){return"design"===this.getMode()&&!this.column&&!this.isColumn},setMouseDownEvent:function(e){var t=this;t.isClickEventAllowed()&&e.bind("mousedown.contextmenu",function(e){return 2!=e.button||(t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:e.clientX,y:e.clientY}}),e.preventDefault(),e.stopPropagation(),!1)})},changeVisibility:function(e){var t=this.properties;1==bizagi.util.parseBoolean(e)?$(this.element).removeClass("ui-state-disabled"):$(this.element).addClass("ui-state-disabled"),t.visible=e},showValidationMessage:function(e){this.setValidationMessage(e)},onRenderClick:function(e,t){e.stopPropagation(),e.preventDefault(),this.triggerGlobalHandler("checkCtrlKey",{})?t&&t.hasClass("ui-state-active")?this.unselectElement({ctrlIsPressed:!0}):($(document.activeElement).is("input")&&$(document.activeElement).closest(".bizagi_editor_component_properties").length>0&&($(document.activeElement).trigger("blur"),$(".bizagi_editor_component_properties").hide()),this.selectElement({IsOnClickEvent:!0,ctrlIsPressed:!0})):(0!=e.button&&1!=e.button||($(".ui-bizagi-render").not(t).removeClass("ui-state-active"),$(".bz-form-item").not(t).removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").not(t).removeClass("ui-state-active"),$(".ui-bizagi-button").not(t).removeClass("bz-state-active"),$(".ui-bizagi-container").removeClass("ui-bizagi-container-selected"),$(".ui-bizagi-render-layout").not(t).removeClass("ui-state-active")),t&&t.hasClass("ui-state-active")?this.unselectElement():($(document.activeElement).is("input")&&$(document.activeElement).closest(".bizagi_editor_component_properties").length>0&&($(document.activeElement).trigger("blur"),$(".bizagi_editor_component_properties").hide()),this.selectElement({IsOnClickEvent:!0})))},onLabelDoubleClick:function(e){var t=this;if("label"===t.properties.type&&t.unselectElement({}),t.triggerGlobalHandler("canChangeLabel",{guid:t.properties.guid})){t.triggerGlobalHandler("startlabeledition");var i=new bizagi.editor.component.editableLabel.presenter({label:e,value:t.properties.displayName});i.subscribe("change",function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})}),i.render()}},onRemoveElement:function(e,t){this.triggerGlobalHandler("hideElement",{guid:this.properties.guid})},showElementLabelEditor:function(){this.element.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||$("label",this.element).trigger("dblclick")},onDrop:function(e){var t=$(e.draggable),i=$(e.helper),o=t.data(),r=i.data(),n=bizagi.editor.utilities.buildComplexXpath(o.xpath,o.contextScope,o.isScopeAttribute,o.guidRelatedEntity);this.triggerGlobalHandler("dropfinish",{guid:this.properties.guid,property:"xpath",value:n,renderType:o.nodeSubtype,sourceGuid:!(!r||!r.isLayoutElement)&&i.attr("guid")})}}),bizagi.rendering.group.original=$.extend(!0,{},bizagi.rendering.group.prototype),$.extend(bizagi.rendering.group.prototype,{postRenderContainer:function(e){var t=this;if(bizagi.rendering.group.original.postRenderContainer.apply(this,arguments),!t.isReadOnlyForm()){var i=e.find(".ui-bizagi-container-group-header:first a");t.isInNestedform()||i.dblclick(function(){t.triggerGlobalHandler("startlabeledition");var e=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});e.subscribe("change",function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})}),e.render()});var o=t.properties.guid;setTimeout(function(){var e=t.triggerGlobalHandler("getLastInsertedElement");o==e&&(t.showElementLabelEditor(),t.triggerGlobalHandler("setLastInsertedElement",null))},0)}},disableSortablePlugin:function(){var e=this.container.find(".ui-bizagi-container-group-wrapper");e&&e.hasClass("ui-sortable")&&e.data()["ui-sortable"]&&e.sortable("destroy");for(var t=0,i=this.children.length;t<i;t+=1)this.children[t].container&&this.children[t].disableSortablePlugin()},configureSortablePlugin:function(e){return e=e.find(".ui-bizagi-container-group-wrapper"),bizagi.rendering.group.original.configureSortablePlugin.apply(this,arguments)},getSortableContainer:function(){return this.container.find(".ui-bizagi-container-group-wrapper")},isInNestedform:function(){var e,t,i=!1;t=this.properties,e=this.parent;do{if("nestedForm"==t.type||"collectionnavigator"==t.type){i=!0;break}t=e.properties,e=e.parent}while(void 0!==e);return i},showElementLabelEditor:function(){this.container.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||this.container.find("a:first").trigger("dblclick")}}),bizagi.rendering.contentPanel.original=$.extend(!0,{},bizagi.rendering.contentPanel.prototype),$.extend(bizagi.rendering.contentPanel.prototype,{postRenderContainer:function(e){var t=this;bizagi.rendering.contentPanel.original.postRenderContainer.apply(this,arguments),e.addClass("ui-bizagi-container-contentpanel-formmodeler");var i=e.find(".ui-bizagi-container-contentpanel-header");i.dblclick(function(){i.hide(),t.triggerGlobalHandler("startlabeledition");var e=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});e.subscribe("change",function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})}),$.when(e.render()).done(function(){0==t.getElement().find(".ui-bizagi-container-input-editable").length?setTimeout(function(){i.hide(),t.adjustEditLabel()},100):t.adjustEditLabel()})})},configureSortablePlugin:function(e){return e=e.find(".ui-bizagi-container-contentpanel-wrapper"),bizagi.rendering.contentPanel.original.configureSortablePlugin.apply(this,arguments)},getSortableContainer:function(){return this.container.find(".ui-bizagi-container-contentpanel-wrapper")},disableSortablePlugin:function(){var e=this.container.find(".ui-bizagi-container-contentpanel-wrapper");e&&e.hasClass("ui-sortable")&&e.data()["ui-sortable"]&&e.sortable("destroy");for(var t=0,i=this.children.length;t<i;t+=1)this.children[t].container&&this.children[t].disableSortablePlugin()},adjustEditLabel:function(){this.getElement().find(".ui-bizagi-container-input-editable").css({width:"95%","background-color":"orange",top:"-18px","border-radius":"10px"}),this.getElement().find(".ui-bizagi-container-input-editable input").css({"margin-left":"5px",width:"90%"}),this.getElement().find(".ui-bizagi-render-confirmation").css({right:"10px",top:"5px"})},showElementLabelEditor:function(){this.container.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||this.container.find("span:first").trigger("dblclick")}}),bizagi.rendering.tab.original=$.extend(!0,{},bizagi.rendering.tab.prototype),$.extend(bizagi.rendering.tab.prototype,{postRenderContainer:function(e){var t=this,i=t.properties;if(bizagi.rendering.tab.original.postRenderContainer.apply(this,arguments),!t.isReadOnlyForm()){if(!t.isContainedInNestedForm()&&!t.isContainedInCollectionNavigator())$(".bz-render-tab-add",e).click(function(e){return e.stopImmediatePropagation(),t.triggerGlobalHandler("addtab",{guid:i.guid}),!1}),$.each(t.children,function(t,i){var o=$("li[data-tab-guid="+i.properties.guid+"]",e);i.setTabHeader(o)}),$(".ui-tabs-nav",e).sortable({items:"li[data-tab-guid]",revert:!0,distance:10,axis:"x",cursorAt:{top:-3,left:0},placeholder:"ui-bizagi-tab-placeholder",delay:150,start:function(e,i){t.sortStart(e,i)},tolerance:"pointer",stop:function(e,i){t.sortFinish(e,i)}}),$(".ui-tabs-nav li",e).unbind("keydown");e.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),e.on("tabsload",function(e,i){t.triggerGlobalHandler("controlRefreshCanvas",{})}).on("tabsactivate",function(e,i){t.triggerGlobalHandler("controlRefreshCanvas",{})})}},sortStart:function(e,t){var i=$(t.item).parent().children("li[data-tab-guid]").not(".ui-bizagi-tab-placeholder").index(t.item);return t.item.data("start-position",i),this.initialPosition=i,!0},sortFinish:function(e,t){var i=$(t.item).parent().children("li[data-tab-guid]").not(".ui-bizagi-tab-placeholder").index(t.item);return this.triggerGlobalHandler("sortfinish",{source:{},initialPosition:t.item.data("start-position")||this.initialPosition,finalPosition:i,sourceContainer:this.properties.guid,targetContainer:this.properties.guid}),!0}}),bizagi.rendering.tabItem.original=$.extend(!0,{},bizagi.rendering.tabItem.prototype),$.extend(bizagi.rendering.tabItem.prototype,{setTabHeader:function(e){var t=this,i=t.properties;t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()||($(".bz-render-tab-delete",e).click(function(){return t.triggerGlobalHandler("deletetab",{guid:i.guid}),!1}),$(".bz-render-tab-edit",e).click(function(){t.isEditableLabelActive()||t.editDisplayName(e)}),e.dblclick(function(){t.isEditableLabelActive()||t.editDisplayName(e)}).click(function(e){e.stopImmediatePropagation(),t.isEditableLabelActive()||t.triggerGlobalHandler("showProperties",{guid:t.properties.guid,redraw:!0})}).mousedown(function(e){2===e.button&&(e.stopImmediatePropagation(),t.isEditableLabelActive()||t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:e.clientX,y:e.clientY}}))}),e.droppable({accept:".ui-bizagi-draggable-item",hoverClass:"ui-bizagi-tab-drop-hover",tolerance:"pointer",drop:function(e,i){t.dropRender(e,i)},activate:function(e,i){t.currentDragSource=t.getDragSource(i.draggable)}}))},activate:function(){bizagi.rendering.tabItem.original.activate.apply(this,arguments),this.triggerGlobalHandler("activatetab",{guid:this.properties.guid})},editDisplayName:function(e){var t=this,i=$("a",e);t.triggerGlobalHandler("startlabeledition");var o=t.editableLabelPresenter=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});o.subscribe("change",function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})}),o.render()},isEditableLabelActive:function(){return!(!this.editableLabelPresenter||!this.editableLabelPresenter.editableLabel)},dropRender:function(e,t){if("mouseup"===e.originalEvent.type){var i=this.children.length,o=this.properties.guid,r=t.draggable?t.draggable.data("start-position"):null,n=t.draggable?t.draggable.data("sourceContainer"):null,a=this.currentDragSource;if(bizagi.editor.utilities.isObject(a)){if(null!=bizagi.sortContainerTimeout)return;bizagi.sortContainerTimeout=setTimeout(function(){bizagi.sortContainerTimeout=null},100),this.triggerGlobalHandler("sortfinish",{source:a,initialPosition:r,finalPosition:i,sourceContainer:n,targetContainer:o})}}}}),bizagi.rendering.search.original=$.extend(!0,{},bizagi.rendering.search.prototype),$.extend(bizagi.rendering.search.prototype,{postRender:function(){var e=this;bizagi.rendering.search.original.postRender.apply(this,arguments),e.isReadOnlyForm()||e.advancedSearch&&!e.isContainedInNestedForm()&&e.advancedSearch.click(function(t){t.stopPropagation(),e.triggerGlobalHandler("showsearchform",{guid:e.properties.guid})})}}),bizagi.rendering.image.original=$.extend(!0,{},bizagi.rendering.image.prototype),$.extend(bizagi.rendering.image.prototype,{postRender:function(){var e=this,t=e.getControl(),i=e.properties.width,o=e.parent.properties.type;bizagi.rendering.image.original.postRender.apply(this,arguments),setTimeout(function(){if(-1===i){var r=$(".resizable_img",t),n=t.width(),a=t.height(),s=0,l=0;if("grid"==o)s=$(".resizable_img",t).closest("td").height();else if(e.parent.properties.id==e.getFormContainer().properties.id)s=50;else{var d=e.parent.getChildreCount(),c=e.parent.getChildrenSumHeight("image");s=(s=$(".resizable_img",t).closest(".ui-bizagi-container").height()-17)<50?50:s,l=e.parent.countByRenderTypeWithParams("image",-1),d>1&&(s-=c)}r.width(n),l>1?null!=s&&s>0?$(".resizable_img",e.parent.container).height(s/l+"px"):$(".resizable_img",t).height(a+"px"):null!=s&&s>0?r.height(s+"px"):r.height(a+"px")}e.triggerGlobalHandler("controlRefreshCanvas")},160)},changeImageSize:function(e,t){var i=this.getControl();this.executeTriggerHandler(i,e,t,"string")},executeTriggerHandler:function(e,t,i,o){var r="",n="";"string"==o?(r=t.slice(0,-2),n=i.slice(0,-2)):(r=t,n=i),this.triggerGlobalHandler("resizeImage",{guid:this.properties.guid,properties:[{property:"thumbnail.width",value:r},{property:"thumbnail.height",value:n}]})}}),bizagi.rendering.collectionnavigator.original=$.extend(!0,{},bizagi.rendering.collectionnavigator.prototype),$.extend(bizagi.rendering.collectionnavigator.prototype,{postRender:function(){var e=this;bizagi.rendering.collectionnavigator.original.postRender.apply(this,arguments),$.when(e.isRendered()).done(function(){var t=e.properties,i=e.getControl().find(".bz-collectionnavigator-navigationform");t.navigationform&&setTimeout(function(){e.triggerGlobalHandler("refreshControl",{guid:t.guid,canvas:i})},0)})}}),bizagi.rendering.date.original=$.extend(!0,{},bizagi.rendering.date.prototype),$.extend(bizagi.rendering.date.prototype,{setDisplayValue:function(e){bizagi.rendering.date.original.setDisplayValue.apply(this,arguments);var t=this.properties,i=this.getDateControl().parent(),o=$(".ui-bizagi-render-date",i);if(t.valueFormat.color&&t.valueFormat.color.length>0){var r="bz-"+t.valueFormat.color.replace("#","")+"-placeholder",n="."+r+"::-webkit-input-placeholder{color:"+t.valueFormat.color+"}";bizagi.util.loadStyle(n,r),o.addClass(r)}t.valueFormat.strikethru&&t.valueFormat.underline?o.addClass("biz-modify-placeholder-through-underline"):(o.removeClass("biz-modify-placeholder-through-underline"),t.valueFormat.strikethru?o.addClass("biz-modify-placeholder-through"):o.removeClass("biz-modify-placeholder-through"),t.valueFormat.underline?o.addClass("biz-modify-placeholder-underline"):o.removeClass("biz-modify-placeholder-underline"))}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.moveElementContainerCommand",{},{execute:function(){var e=this.arguments;return this.element||(this.element=this.model.findElementByPosition(e.posIni,e.parentSource)),this.controller.executeCommand({command:"removeElement",position:e.posIni,parent:e.parentSource,canUndo:!1}),this.controller.executeCommand({command:"insertElement",position:e.posEnd,parent:e.parentTarget,element:this.element,canUndo:!1}),!0},undo:function(){var e=this.arguments;return this.controller.executeCommand({command:"removeElement",position:e.posEnd,parent:e.parentTarget,canUndo:!1}),this.controller.executeCommand({command:"insertElement",position:e.posIni,parent:e.parentSource,element:this.element,canUndo:!1}),!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.removeElementCommand",{},{execute:function(){var e=this.arguments,t=this.controller.getContextInfo(),i=this.arguments.parent||t.guid;return e.canValidate=!0,void 0!==this.arguments.position?this.model.removeElement(e.position,i,e.element):this.model.removeLastElement(i),!0},undo:function(){return!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementCommand",{},{execute:function(){var e=this,t=e.controller.getContextInfo(),i=e.arguments.parent||t.guid;if(!e.validateModel(i))return!1;if(e.arguments.canValidate=!0,void 0!==e.arguments.position)e.model.insertElement(e.arguments.position,i,e.arguments.element);else{var o=e.model.addElement(e.arguments.element,i);e.arguments.position=o}return e.controller.executeCommand({command:"applyOverridesElement",overrides:{properties:!0,requiredProperties:!0},guid:e.arguments.element.guid,canUndo:!1}),!0},undo:function(){var e=this.controller.getContextInfo(),t=this.arguments.parent||e.guid;return this.model.removeElement(this.arguments.position,t),!0},validateModel:function(e){var t=!0;if("offlinegrid"==this.controller.getContext()){var i=this.model.getElement(e);i&&$.isArray(i.elements)&&(t=i.elements.length<=3),t||bizagi.showMessageBox(bizagi.localization.getResource("formmodeler-component-gridcolumneditor-offline-max-columns"),"","warning",!1)}return t}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.insertButtonCommand",{},{execute:function(){var e=this.controller.getContextInfo(),t=(this.arguments.parent||e.guid,Math.guid()),i=this.createElement({guid:t,type:"formbutton",caption:bizagi.editor.utilities.buildComplexLocalizable(bizagi.localization.getResource("formmodeler-component-editor-newbutton"),t,"caption")});return this.model.addButton(i),this.arguments.guid=i.guid,!0},undo:function(){return this.model.removeElementById(this.arguments.guid),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getElementPropertiesCommand",{},{execute:function(){var e=this.arguments;return bizagi.editor.utilities.isGuidEmpty(e.guid)?this.processMultiselect():this.getElementProperties(e.guid),!0},searchContext:function(e,t){return this.controller.isGridContext()?bizagi.editor.utilities.resolveContextEntityFromXpath(e):t?bizagi.editor.utilities.resolveRelatedEntityFromXpath(e):void 0},getElementProperties:function(e){var t=this.arguments,i=this.model.getElement(e);this.arguments.result=bizagi.clone(i.properties),i.properties.xpath&&$.extend(this.arguments.result,{context:this.searchContext(i.properties.xpath,t.getContext)})},processMultiselect:function(){if(this.controller.isGridContext()){var e=this.controller.getGuidsSelected();this.getElementProperties(e[0])}else this.arguments.result=null}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getFormPropertiesModelCommand",{},{execute:function(){var e=this.arguments,t=this.model.getPropertiesModel();if(e.showValidations){var i=this.model.getFormValidations();i&&(t.validations=bizagi.clone(i))}return this.arguments.result=t,!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getPropertiesModelCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid),i=this.getPropertiesModel(t);if(e.showValidations){var o=t.getFormValidations();o&&(i.validations=bizagi.clone(o))}return this.arguments.result=i,!0},getPropertiesModel:function(e){var t,i;return t=e.getPropertiesModel(),t=this.resolveDependencies(t),i=e.getPropertiesExternal(),$.extend(t,i),t},resolveDependencies:function(e){var t;if(e.elements.length>1)throw"No code for this case";return t=e.elements[0].tabs,this.map={},this.generateElementMap(t,""),this.resolveAllDependencies(e),this.resolveSpecificDependencies(e),e},generateElementMap:function(e,t){var i,o,r,n,a,s,l;for(l=this.map,s=0;s<e.length;s++)n="",void 0!==e[s].property?n=void 0!==(i=e[s].property).subproperties?"(property.subproperties)":"(property)":void 0!==e[s].group?(i=e[s].group,n="(group.elements)"):void 0!==e[s].category?(i=e[s].category,n="(category)"):(i=e[s],n="(elements)"),r=t+""+s+n,void 0!==i.name&&void 0!==i["bas-type"]&&(void 0!==i.subproperties?(a=t+""+s+"(property)",l[i.name]=a):l[i.name]=r),void 0!==(o=void 0!==i.elements?i.elements:void 0!==i.subproperties?i.subproperties:void 0)&&$.isArray(o)&&o.length>0&&this.generateElementMap(o,r)},resolveAllDependencies:function(e){var t,i,o,r,n,a,s;for(r=(t=e.elements[0].tabs).length,a=0;a<r;a++)for(n=(i=t[a]).elements.length,s=0;s<n;s++)void 0!==(o=i.elements[s].property)&&this.resolveEditorParametersRule(o,e)},resolveEditorParametersRule:function(e,t){var i,o,r,n,a;if(void 0!==e["editor-parameters"])for(i in o=e["editor-parameters"])o[i]&&void 0!==o[i].rule&&-1!=(r=o[i].rule).search(/^<.*>$/)&&(n=(r=r.substring(1,r.length-1)).split(":")).length>1&&"design"==n[0]&&(a=n[1],void 0===n[2]&&this.updateDependency(e.name,a,"editorParameters",t))},processRules:function(e,t){bizagi.editor.component.properties.processrules(e,t,this.map)},updateDependency:function(e,t,i,o){var r=this.getMapAttribute(t,"value",o);if(void 0!==r)if(!1===r||"false"==r)r=!1;else{if(!0!==r&&"true"!=r)throw"value is "+r;r=!0}this.setMapAttributeEditorParameter(e,t,r,o)},surfModel:function(e,t,i){var o,r=void 0;if((o=e.split(".")).length>1)switch(o[0]){case"group":"elements"==o[1]&&(r=i[t][o[0]][o[1]]);break;case"property":"subproperties"==o[1]&&(r=i[t][o[0]][o[1]])}else switch(e){case"elements":r=i.elements[0].tabs[t][e];break;case"property":r=i[t][e]}return r},setMapAttributeWithChangeProperty:function(e,t,i,o){this.setMapAttribute(e,t,i,o),this.controller.executeCommand({command:"changeProperty",guid:o.idRender,property:e,value:i,canUndo:!1})},setMapAttribute:function(e,t,i,o){var r;if(!(r=this.getPropertyFromMap(e,o)))throw"Error with the reference (set)";r[t]=i},getMapAttribute:function(e,t,i){var o;if(!(o=this.getPropertyFromMap(e,i)))throw"Error with the reference (get)";return o[t]},getPropertyFromMap:function(e,t){var i,o,r=this.map[e],n=r.match(/\d+/g),a=r.match(/\(([a-z]+|\.)+\)/g),s=t;for(i=0;i<n.length&&i<a.length;i++)o=a[i].substring(1,a[i].length-1),s=this.surfModel(o,n[i],s);return s},setMapAttributeEditorParameter:function(e,t,i,o){var r;if(!(r=this.getPropertyFromMap(e,o)))throw"Error with the reference for editor parameter (set)";r["editor-parameters"][t].value=i},resolveSpecificDependencies:function(e){var t=this;t.resolveDatalistSubproperties(e),t.resolveDependenciesFromXpathForCombos(e),t.resolveDependenciesFromXpathForSearch(e),t.resolveDependenciesFromXpathForGrid(e);var i=t.getRenderType(e);"grid"===t.getRenderType(e)&&t.updateFormsProperties(e),"groupedgrid"===t.getRenderType(e)&&t.updateGroupedGridProperties(e),"offlinegrid"===t.getRenderType(e)&&t.updateOfflineGridProperties(e),"collectionnavigator"===t.getRenderType(e)&&t.updateCollectionNavigatorProperties(e),"text"!==i&&"columntext"!==i&&"adhoctext"!==i||t.updateText(e),"actionlauncher"===t.getRenderType(e)&&t.updateActionLauncher(e),"entitytemplate"===t.getRenderType(e)&&t.updateEntityTemplate(e),t.updateDecimalsForNumbers(e),t.updateMultipleSearch(e),t.resolveDocumentTemplatesButtonsVisibilityByAllowgenerate(e),t.resolveBindingButtonVisibility(e),t.resolveUserConfirmationMessageVisibility(e),t.resolveGroupProperties(e)},resolveDatalistSubproperties:function(e){var t,i,o,r,n=this.map;if(void 0!==n.xpath&&void 0!==n.data)if(null!==(t=this.getMapAttribute("xpath","value",e))&&"object"==typeof t)for(this.hasMapProperty("data","notShow",e)&&this.deleteMarkNotShow("data",e),i=this.getMapAttribute("data","subproperties",e),r=0;r<i.length;r++)o=i[r].property,this.resolveDatalistSubpropertiesRule(o,t,e);else this.insertMarkNotShow("data",e)},resolveDependenciesFromXpathForCombos:function(e){var t,i=this;i.areThesePropertiesInMap(["xpath","data.displayattrib","data.additionalattrib","data.sortattribute","data.filter"])&&(null!==(t=i.getMapAttribute("xpath","value",e))&&"object"==typeof t?(i.deleteMarkNotShow("data.displayattrib",e),i.deleteMarkNotShow("data.additionalattrib",e),i.deleteMarkNotShow("data.sortattribute",e),i.deleteMarkNotShow("data.filter",e)):(i.insertMarkNotShow("data.displayattrib",e),i.insertMarkNotShow("data.additionalattrib",e),i.insertMarkNotShow("data.sortattribute",e),i.insertMarkNotShow("data.filter",e)))},resolveDependenciesFromXpathForSearch:function(e){var t;this.areThesePropertiesInMap(["xpath","searchforms","data.displayattrib","data.filter"])&&(null!==(t=this.getMapAttribute("xpath","value",e))&&"object"==typeof t?(this.deleteMarkNotShow("data.displayattrib",e),this.deleteMarkNotShow("data.filter",e)):(this.insertMarkNotShow("data.displayattrib",e),this.insertMarkNotShow("data.filter",e)))},resolveDependenciesFromXpathForGrid:function(e){var t,i=this;if(i.areThesePropertiesInMap(["xpath","gridvalidations","data.sortattribute","data.filter"]))if(null!==(t=i.getMapAttribute("xpath","value",e))&&"object"==typeof t){if(i.deleteMarkNotShow("data.sortattribute",e),i.deleteMarkNotShow("data.filter",e),i.areThesePropertiesInMap(["data.sortattribute","data.sortorder"])){var o=i.getMapAttribute("data.sortattribute","value",e);null!==o&&"object"==typeof o?i.deleteMarkNotShow("data.sortorder",e):i.insertMarkNotShow("data.sortorder",e)}}else i.insertMarkNotShow("data.sortattribute",e),i.insertMarkNotShow("data.filter",e),i.areThesePropertiesInMap(["data.sortattribute","data.sortorder"])&&i.insertMarkNotShow("data.sortorder",e)},resolveDocumentTemplatesButtonsVisibilityByAllowgenerate:function(e){if(this.areThesePropertiesInMap(["validate","allowgenerate"])){var t=this.getMapAttribute("allowgenerate","value",e);t&&this.hasMapProperty("validate","notShow",e)?this.deleteMarkNotShow("validate",e):t||(this.insertMarkNotShow("validate",e),this.setMapAttributeWithChangeProperty("validate","value",!1,e))}},resolveBindingButtonVisibility:function(e){var t;this.map;this.areThesePropertiesInMap(["xpath","groupmapping"])&&(null!==(t=this.getMapAttribute("xpath","value",e))&&"object"==typeof t?this.hasMapProperty("groupmapping","notShow",e)&&this.deleteMarkNotShow("groupmapping",e):this.insertMarkNotShow("groupmapping",e))},deleteMarkNotShow:function(e,t){this.setMapAttribute(e,"notShow",void 0,t)},insertMarkNotShow:function(e,t){this.setMapAttribute(e,"notShow",!0,t)},resolveDatalistSubpropertiesRule:function(e,t,i){var o;"true"==e["user-editable"]&&null!==e.value&&"string"==typeof e.value&&-1!=e.value.search(/^<.*>$/)&&"design"==(o=e.value.substring(1,e.value.length-1).split(":"))[0]&&"xpath"==o[1]&&"relatedentity"==o[2]&&this.updateValueMapForSubproperty(e.name,t,i)},hasMapProperty:function(e,t,i){return void 0!==this.getPropertyFromMap(e,i)[t]},updateValueMapForSubproperty:function(e,t,i){this.setMapAttribute(e,"value",t,i)},updateMultipleSearch:function(e,t){var i;this.areThesePropertiesInMap(["newrecords"])&&(i=this.getMapAttribute("newrecords","value",e),this.isFalsifiable(i.allownew)?this.insertMarkNotShow("newrecords.allownewform",e):this.deleteMarkNotShow("newrecords.allownewform",e))},isFalsifiable:function(e){var t=!1;return null==e||!1===e||"false"==e?t=!0:!0!==e&&"true"!=e||(t=!1),t},updateDecimalsForNumbers:function(e){var t;this.areThesePropertiesInMap(["allowdecimals","numdecimals"])&&(t=this.getMapAttribute("allowdecimals","value",e),this.isFalsifiable(t)?this.insertMarkNotShow("numdecimals",e):this.deleteMarkNotShow("numdecimals",e))},resolveUserConfirmationMessageVisibility:function(e){this.areThesePropertiesInMap(["userconfirmation.needsuserconfirmation"])&&(value=this.getMapAttribute("userconfirmation.needsuserconfirmation","value",e),this.isFalsifiable(value)?this.insertMarkNotShow("userconfirmation.userconfirmationmessage",e):this.deleteMarkNotShow("userconfirmation.userconfirmationmessage",e))},setMapAttributesWithChangeMultipleProperties:function(e,t){var i;for(i=0;i<e.length;i++)this.setMapAttribute(e[i].property,"value",e[i].value,t);this.controller.executeCommand({command:"changeMultipleProperties",properties:e,guid:t.idRender})},updateInlineaddAndWithform:function(e){var t=this;void 0===t.controller.mem?(t.controller.mem={},t.controller.mem[e.idRender]={},t.controller.mem[e.idRender].inlineadd=!t.isFalsifiable(t.getMapAttribute("inlineadd","value",e)),t.controller.mem[e.idRender]["add.withform"]=!t.isFalsifiable(t.getMapAttribute("add.withform","value",e))):void 0===t.controller.mem[e.idRender]&&(t.controller.mem[e.idRender]={},t.controller.mem[e.idRender].inlineadd=!t.isFalsifiable(t.getMapAttribute("inlineadd","value",e)),t.controller.mem[e.idRender]["add.withform"]=!t.isFalsifiable(t.getMapAttribute("add.withform","value",e))),void 0!==t.controller.mem[e.idRender]&&(t.isFalsifiable(t.getMapAttribute("inlineadd","value",e))!=t.isFalsifiable(t.controller.mem[e.idRender].inlineadd)?t.isFalsifiable(t.getMapAttribute("inlineadd","value",e))?(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!1},{property:"add.withform",value:!0}],e),t.controller.mem[e.idRender].inlineadd=!1,t.controller.mem[e.idRender]["add.withform"]=!0):(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!0},{property:"add.withform",value:!1}],e),t.controller.mem[e.idRender].inlineadd=!0,t.controller.mem[e.idRender]["add.withform"]=!1):t.isFalsifiable(t.getMapAttribute("add.withform","value",e))?(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!0},{property:"add.withform",value:!1}],e),t.controller.mem[e.idRender].inlineadd=!0,t.controller.mem[e.idRender]["add.withform"]=!1):(t.setMapAttributesWithChangeMultipleProperties([{property:"inlineadd",value:!1},{property:"add.withform",value:!0}],e),t.controller.mem[e.idRender].inlineadd=!1,t.controller.mem[e.idRender]["add.withform"]=!0))},updateFormsProperties:function(e){var t,i=this;if(i.areThesePropertiesInMap(["allowadd","add.addlabel","inlineadd","add.withform","add.addform"])&&(t=i.getMapAttribute("allowadd","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("add.addlabel",e),i.insertMarkNotShow("inlineadd",e),i.insertMarkNotShow("add.withform",e),i.insertMarkNotShow("add.addform",e),i.insertMarkNotShow("add.validationrule",e),i.setMapAttribute("add.withform","value",!1,e)):(i.deleteMarkNotShow("add.addlabel",e),i.deleteMarkNotShow("inlineadd",e),i.insertMarkNotShow("add.withform",e),i.deleteMarkNotShow("add.addform",e),i.deleteMarkNotShow("add.validationrule",e)),i.updateInlineaddAndWithform(e),i.areThesePropertiesInMap(["add.withform","add.addform"])&&(t=i.getMapAttribute("add.withform","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("add.addform",e),i.insertMarkNotShow("add.validationrule",e)):i.isFalsifiable(i.getMapAttribute("allowadd","value",e))||(i.deleteMarkNotShow("add.addform",e),i.deleteMarkNotShow("add.validationrule",e)))),i.areThesePropertiesInMap(["delete.allowdelete","delete.deletelabel","delete.validationrule"])&&(t=i.getMapAttribute("delete.allowdelete","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("delete.deletelabel",e),i.insertMarkNotShow("delete.validationrule",e)):(i.deleteMarkNotShow("delete.deletelabel",e),i.deleteMarkNotShow("delete.validationrule",e))),i.areThesePropertiesInMap(["allowedit","edit.editlabel","edit.editform","edit.validationrule","edit.inlineedit"]))if(t=i.getMapAttribute("allowedit","value",e),i.isFalsifiable(t))i.insertMarkNotShow("edit.editlabel",e),i.insertMarkNotShow("edit.inlineedit",e),i.insertMarkNotShow("edit.withform",e),i.insertMarkNotShow("edit.editform",e),i.insertMarkNotShow("edit.validationrule",e),i.setMapAttributeWithChangeProperty("edit.withform","value","false",e);else{i.deleteMarkNotShow("edit.editlabel",e),i.deleteMarkNotShow("edit.inlineedit",e),i.insertMarkNotShow("edit.withform",e),i.deleteMarkNotShow("edit.editform",e),i.deleteMarkNotShow("edit.validationrule",e);var o=i.getMapAttribute("edit.editform","value",e);i.isFalsifiable(o)||$.isEmptyObject(o)?i.setMapAttributeWithChangeProperty("edit.withform","value","false",e):i.setMapAttributeWithChangeProperty("edit.withform","value","true",e)}i.areThesePropertiesInMap(["allowdetail","detail.detaillabel","detail.detailform"])&&(t=i.getMapAttribute("allowdetail","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("detail.detaillabel",e),i.insertMarkNotShow("detail.detailform",e)):(i.deleteMarkNotShow("detail.detaillabel",e),i.deleteMarkNotShow("detail.detailform",e))),i.areThesePropertiesInMap(["totalize.operation"])&&(t=i.getMapAttribute("totalize.operation","value",e),bizagi.util.isEmpty(t)?i.insertMarkNotShow("totalize.format",e):i.deleteMarkNotShow("totalize.format",e))},updateOfflineGridProperties:function(e){var t=this;if(t.areThesePropertiesInMap(["add.allowadd","add.addlabel"])){var i=t.getMapAttribute("add.allowadd","value",e);t.isFalsifiable(i)?t.insertMarkNotShow("add.addlabel",e):t.deleteMarkNotShow("add.addlabel",e)}t.areThesePropertiesInMap(["delete.allowdelete","delete.deletelabel"])&&(i=t.getMapAttribute("delete.allowdelete","value",e),t.isFalsifiable(i)?t.insertMarkNotShow("delete.deletelabel",e):t.deleteMarkNotShow("delete.deletelabel",e))},updateCollectionNavigatorProperties:function(e){var t,i=this;if(i.areThesePropertiesInMap(["allowadd","add.inlineadd","add.addform","add.validationrule"])&&(t=i.getMapAttribute("allowadd","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("add.inlineadd",e),i.insertMarkNotShow("add.addform",e),i.insertMarkNotShow("add.validationrule",e)):(i.deleteMarkNotShow("add.inlineadd",e),i.deleteMarkNotShow("add.addform",e),i.deleteMarkNotShow("add.validationrule",e)),i.isFalsifiable(t)||(t=i.getMapAttribute("add.addform","value",e),i.isFalsifiable(t)?i.insertMarkNotShow("add.validationrule",e):i.deleteMarkNotShow("add.validationrule",e))),i.areThesePropertiesInMap(["allowedit","edit.editform","edit.inlineedit","edit.validationrule"])&&(t=i.getMapAttribute("allowedit","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("edit.inlineedit",e),i.insertMarkNotShow("edit.editform",e),i.insertMarkNotShow("edit.validationrule",e)):(i.deleteMarkNotShow("edit.inlineedit",e),i.deleteMarkNotShow("edit.editform",e),i.deleteMarkNotShow("edit.validationrule",e)),i.isFalsifiable(t)||(t=i.getMapAttribute("edit.editform","value",e),i.isFalsifiable(t)?i.insertMarkNotShow("edit.validationrule",e):i.deleteMarkNotShow("edit.validationrule",e))),i.areThesePropertiesInMap(["delete.allowdelete","delete.validationrule"])&&(t=i.getMapAttribute("delete.allowdelete","value",e),i.isFalsifiable(t)?i.insertMarkNotShow("delete.validationrule",e):i.deleteMarkNotShow("delete.validationrule",e)),i.areThesePropertiesInMap(["allowdetail","detail.detailform"])&&(t=i.getMapAttribute("allowdetail","value",e),i.isFalsifiable(t)?i.insertMarkNotShow("detail.detailform",e):i.deleteMarkNotShow("detail.detailform",e)),i.areThesePropertiesInMap(["xpath","data.sortattribute","data.filter","data.sortorder"])){var o=i.getMapAttribute("xpath","value",e);null!==o&&"object"==typeof o?(i.deleteMarkNotShow("data.sortattribute",e),i.deleteMarkNotShow("data.filter",e),null!==(t=i.getMapAttribute("data.sortattribute","value",e))&&"object"==typeof t?i.deleteMarkNotShow("data.sortorder",e):i.insertMarkNotShow("data.sortorder",e)):(i.insertMarkNotShow("data.sortattribute",e),i.insertMarkNotShow("data.filter",e),i.insertMarkNotShow("data.sortorder",e))}},updateGroupedGridProperties:function(e){var t,i=this;i.areThesePropertiesInMap(["allowadd","add.addform","add.addlabel","add.validationrule"])&&(t=i.getMapAttribute("allowadd","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("add.addform",e),i.insertMarkNotShow("add.addlabel",e),i.insertMarkNotShow("add.validationrule",e)):(i.deleteMarkNotShow("add.addform",e),i.deleteMarkNotShow("add.addlabel",e),i.deleteMarkNotShow("add.validationrule",e)),i.isFalsifiable(t)||(t=i.getMapAttribute("add.addform","value",e),i.isFalsifiable(t)?i.insertMarkNotShow("add.validationrule",e):i.deleteMarkNotShow("add.validationrule",e))),i.areThesePropertiesInMap(["allowedit","edit.editform","edit.editlabel","edit.validationrule"])&&(t=i.getMapAttribute("allowedit","value",e),i.isFalsifiable(t)?(i.insertMarkNotShow("edit.editlabel",e),i.insertMarkNotShow("edit.editform",e),i.insertMarkNotShow("edit.validationrule",e)):(i.deleteMarkNotShow("edit.editlabel",e),i.deleteMarkNotShow("edit.editform",e),i.deleteMarkNotShow("edit.validationrule",e)),i.isFalsifiable(t)||(t=i.getMapAttribute("edit.editform","value",e),i.isFalsifiable(t)?i.insertMarkNotShow("edit.validationrule",e):i.deleteMarkNotShow("edit.validationrule",e)))},updateText:function(e){var t;this.areThesePropertiesInMap(["isextended","autoextend"])&&(t=this.getMapAttribute("isextended","value",e),this.isFalsifiable(t)?this.hideProperties(["autoextend"],e):this.showProperties(["autoextend"],e))},updateActionLauncher:function(e){this.areThesePropertiesInMap(["ishorizontal","allowsearch","selecttemplate"])&&(fvalue=this.getMapAttribute("ishorizontal","value",e),fvalue?(this.hideProperties(["allowsearch"],e),this.showProperties(["selecttemplate"],e)):(this.showProperties(["allowsearch"],e),this.hideProperties(["selecttemplate"],e)))},updateEntityTemplate:function(e){var t=this;t.areThesePropertiesInMap(["allowactions","xpathmultiple","filter","maxitems","orientation"])&&(fvalue=t.getMapAttribute("allowactions","value",e),fvalue?(t.showProperties(["xpathmultiple"],e),t.showProperties(["filter"],e),t.showProperties(["maxitems"],e),t.showProperties(["orientation"],e),t.showProperties(["format"],e)):(t.hideProperties(["xpathmultiple"],e),t.hideProperties(["filter"],e),t.hideProperties(["maxitems"],e),t.hideProperties(["orientation"],e),t.hideProperties(["format"],e))),t.areThesePropertiesInMap(["allowactions","xpathmultiple"])&&(!0===t.getMapAttribute("allowactions","value",e)?t.showProperties(["xpathmultiple"],e):t.hideProperties(["xpathmultiple"],e))},resolveGroupProperties:function(e){if(this.areThesePropertiesInMap(["groupby","showcolumn","displaytype"])){var t=this.getMapAttribute("groupby","value",e);this.isFalsifiable(t)?(this.hideProperties(["showcolumn"],e),this.hideProperties(["displaytype"],e)):(this.showProperties(["showcolumn"],e),this.showProperties(["displaytype"],e))}},hideProperties:function(e,t){for(var i=0,o=e.length;i<o;)this.insertMarkNotShow(e[i++],t)},showProperties:function(e,t){for(var i=0,o=e.length;i<o;)this.deleteMarkNotShow(e[i++],t)},areThesePropertiesInMap:function(e){var t,i=this.map,o=!0;for(t=0;t<e.length;t++)if(void 0===i[e[t]]){o=!1;break}return o},getRenderType:function(e){return e.element.type}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.deleteRepeaterItemCommand",{},{execute:function(){var e=this.arguments.guid;if(!e)return!1;var t=this.model.getForm().getLayout();return this.deleteItem(t,e),!0},deleteItem:function(e,t){var i,o=e.properties.html,n=!0,a=o.split("{{/repeater}}"),s=/{{placeholder(:\w*)?(\s*\{"id":"([\w-]+)"\})?/g;for(this.originalHtml=o,this.originalElements={},j=0,r=a.length;j<r;j++){for(var l=a[j].split("{{separator}}"),d=0,c=l.length;d<c;d++){var u=l[d];if(u.indexOf(t)>=0){for(var p=/{{repeater:item}}[\w\W]+{{\/repeater:item}}/g.exec(u)[0];null!==(i=s.exec(p));){var m=i[3];this.originalElements[m]=e.removeElementById(m)}e.properties.html=o.replace(p+"{{separator}}",""),n=!1;break}}if(!n)break}},undo:function(){var e=this.model.getForm().getLayout();for(id in e.properties.html=this.originalHtml,this.originalElements)e.addElement(this.originalElements[id]);return!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.changePropertyCommand",{},{execute:function(){var e=this,t=e.arguments;if($.isArray(t.guids)||"string"!=typeof t.guid||(t.guids=[t.guid]),"template"!==e.controller.getContext()&&!e.checksDependenciesInAV())return!1;e.originalValue||(e.originalValue={});for(var i=0,o=t.guids.length;i<o;i++){var r=t.guids[i],n=e.model.getElement(r);e.originalValue[r]||(e.originalValue=e.originalValue||{},e.property=t.exclusive?n.getExclusiveProperty(t.property):t.property,e.originalValue[r]=n.getProperty(e.property),t.canValidate=!0,n.isLocalizableProperty(t.property)&&(t.value="string"==typeof t.value?e.processLocalizableProperty(n,e.originalValue[r]):e.verifyFormat(t.value,n))),n.assignProperty(t.property,t.value,t.exclusive),e.controller.isAdhocFormContext()&&"displayName"===t.property&&!n.isSaved()&&e.controller.executeCommand({command:"changeProperty",guids:t.guids,property:"xpathAdhoc",value:t.newValue}),"xpath"===t.property&&(e.controller.executeCommand({command:"applyOverridesElement",element:n}),t.refreshProperties=t.refreshProperties||"number"==n.properties.type),t.removeDefaultDisplayName&&n.removeDefaultDisplayName(),n.hasDesignValue(e.arguments.property)&&(e.arguments.refresh=!0)}return e.hasDependencies(t.property)&&(t.refreshProperties=!0),t.validateForm&&(n.isRequiredProperty(t.property)||n.isDependentProperty(t.property))&&(e.controller.executeCommand({command:"formValidations",validations:["RequiredProperties","RequiredDependentProperties","SameXpath","ElementsInContainers"],canRefresh:!1}),t.refreshProperties=!0),!0},undo:function(){for(var e=this.arguments,t=0,i=e.guids.length;t<i;t++){var o=e.guids[t],r=this.model.getElement(o);r.assignProperty(this.property,this.originalValue[o],e.exclusive),"xpath"===e.property&&this.controller.executeCommand({command:"applyOverridesElement",element:r})}return!0},hasDependencies:function(e){return"typedinamic"==e||"allowdinamiclabel"==e||"multipleselection"==e||"allowactions"==e||"selecttemplate"==e||"ishorizontal"==e||"showtime"==e||"dateformat"==e||"rule"==e||"interface"==e||"allowadd"==e||"displayName"==e||"helptext"==e||"allowedit"==e||"allowdecimals"==e||"advancedsearch.advancedsearch"==e||"newrecords.allownew"==e||"userconfirmation.needsuserconfirmation"==e||"format"==e||"allowgenerate"==e||"delete.allowdelete"==e||"add.withform"==e||"allowdetail"==e||"buttonrule.rule"==e||"buttonrule.rule90"==e||"buttonrule.interface"==e||"data.filter"==e||"buttonrule"==e||"add.allowadd"==e||"navigationform"==e||"add.addform"==e||"xpathActions"==e||"inlineadd"==e||"add.withform"==e||"detail.withform"==e||"isextended"==e||"totalize.operation"==e||"edit.editform"==e||"data.sortattribute"==e},processLocalizableProperty:function(e,t){var i,o=this.arguments,r=bizagi.editorLanguage.key;return i="string"==typeof t?bizagi.editor.utilities.buildComplexLocalizable(t,e.guid,o.property):t?$.extend({},this.verifyFormat(t,e)):{i18n:{default:e.getDefaultLocalizableProperty(o.property),languages:{},uri:e.guid.toString()+":"+o.property}},"default"===r?i.i18n.default=o.value:i.i18n.languages[r]=o.value,i},verifyFormat:function(e,t){var i=this.arguments;if(e&&e.i18n&&((!e.i18n.uri||e.i18n.uri.indexOf("undefined")>=0)&&(e.i18n.uri=i.guid+":"+i.property),e.i18n.default&&0!==e.i18n.default.length||(e.i18n.default=t.getDefaultLocalizableProperty(i.property)),e.i18n.languages)){var o={};for(var r in e.i18n.languages)e.i18n.languages[r]&&(o[r]=e.i18n.languages[r]);e.i18n.languages=o}return e},checksDependenciesInAV:function(){var e=this.arguments;if(this.controller.hasEnableCommandsEditor()&&"xpath"===e.property&&!this.resolveResult(this.controller.executeCommand({command:"searchDependencies",guids:e.guids})).result)return!1;return!0}}),bizagi.editor.changePropertyCommand.extend("bizagi.editor.changePropertyCommand",{},{execute:function(){var e=this.arguments,t=e.value,i=e.property;if(this.controller.isTemplateContext()){var o=e.guid||e.guids[0],r=this.element=this.model.getElement(o);if(!r||"hide"==i)return this._super();var n=(r.properties||{}).type||"";if("layoutPlaceholder"==r.type)return this.processLayoutControl(o);if("xpath"==i&&null==t)return n.search(/:image/gi)>=0?this._super():this.processLayoutControl(o)}return this._super()},processLayoutControl:function(e){var t=this.arguments,i=t.property;if(t.refreshProperties=!0,"displayName"==i)this.controller.executeCommand({command:"updateElement",renderType:"label",property:i,value:bizagi.editor.utilities.buildComplexLocalizable(t.value,e,"displayName"),guid:e,canUndo:!1});else if("xpath"==i||"link"==i){var o=this.controller.getXpathNavigatorModel().getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(t.value)),r=o?o.getRenderType():"layoutPlaceholder";this.controller.executeCommand({command:"updateElement",renderType:r,property:"xpath",value:t.value,guid:e,canUndo:!1})}return!0},undo:function(){var e=this,t=e.arguments,i=t.property,o=t.value;if(e.controller.isTemplateContext()){var r=(e.element.properties||{}).type||"";if("hide"==i)return e._super();if("layoutPlaceholder"==e.element.type&&e.model.replaceElement(e.element.guid,e.element),"xpath"==i&&null==o){if(r.search(/:image/gi)>=0)return e._super();e.model.replaceElement(e.element.guid,e.element)}return!0}return e._super()}}),bizagi.editor.changePropertyCommand.extend("bizagi.editor.changePropertyCommand",{},{execute:function(){var e=this,t=e.arguments,i=t.value,o=t.property,r=t.guid||t.guids[0],n=e.element=e.model.getElement(r);if(!e.controller.isAdhocFormContext())return e._super();if(!e.hasListValues(n.type))return e._super();if(!{displayName:!0,xpathAdhoc:!0}[o])return e._super();if("displayName"===o&&(n.isSaved()||n.properties.draggedProperty))return e._super();"displayName"===o&&(i=(i=bizagi.editor.utilities.getXPathByDisplayName(i)).substr(0,1).toLowerCase()+i.substr(1));var a="xpathAdhoc"===o&&bizagi.editor.utilities.isObject(i)?i.xpath:i;if("string"!=typeof a)return e._super();n.assignProperty("data.datasource",void 0);var s=e.controller.getXpathNavigatorModel().getNodeByXpath(a);return s&&s.renderType===n.type&&(e.datasource=n.resolveProperty("data.datasource"),n.assignProperty("data.datasource",{type:s.entityContext,guid:s.guidRelatedEntity,values:s.predefinedValues})),e._super()},hasListValues:function(e){return"adhoccombo"===e||"adhocsuggest"===e||"adhoccolumncombo"===e},undo:function(){var e=this.arguments;e.property,e.value;return this.element.assignProperty("data.datasource",this.datasource),this._super()}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.changeDesignAttributesCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid).getIndexedProperties()[e.property];if(t)for(var i in e.attributes)t["editor-parameters"]=t["editor-parameters"]||{},t["editor-parameters"][i]=e.attributes[i]}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.changePropertyElementsCommand",{},{execute:function(){var e=this.arguments,t=e.elements;this.originalValue||(this.originalValue={});for(var i=0,o=t.length;i<o;i++){var r=t[i].guid,n=t[i].property,a=t[i].value,s=this.model.getElement(r);this.originalValue[r]||(this.originalValue[r]={property:n,value:s.getProperty(n)},e.canValidate=!0),s.assignProperty(n,a)}return!0},undo:function(){for(var e in this.originalValue){var t=this.originalValue[e].property,i=this.originalValue[e].value;this.model.getElement(e).assignProperty(t,i)}return!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementFromControlsNavigatorCommand",{map:{querycascadingcombo:"cascadingcombo",columnsearchlist:"searchlist",multiselect:"searchlist"}},{validateArguments:function(){return void 0!==this.arguments.data&&void 0!==this.arguments.data.name},execute:function(){var e=this,t=e.arguments,i=t.data.name;if(!e.validateArguments())return!1;var o=!1;return e.needsWizard(i)&&(o=!0,e.precondition||(e.precondition=e.controller.publish("showControlWizard",{control:e.Class.map[i]||i,title:bizagi.localization.getResource("bizagi-editor-wizard-title-"+i)}))),$.when(e.precondition).pipe(function(r){return o?void 0===r.success||0==r.success||e.processWizardResult(i,r):(e.insertElement(t,i),!0)})},insertElement:function(e,t){var i=this;e.element||(e.element=i.createElement({type:t}),e.element.isVisualProperty("xpath")&&!i.needsDisplayName(t)||(e.element.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable(e.data.displayName,e.element.guid,"displayName"),"adhocform"==i.model.context&&(e.element.properties.displayName=e.element.properties.displayName.i18n.default)),e.element.properties.displayName=i.validateSameDisplayNameOfElements(e.element.properties.displayName),"adhocform"!=i.model.context&&"adhocgrid"!=i.model.context||i.setXpathAdhoc(e.element),e.canValidate=!0,i.isSpecialElement(i.arguments.data.name,e.element),i.parent=e.parent||i.controller.getContextInfo().guid),i.controller.executeCommand({command:"insertElement",position:e.position,parent:i.parent,element:e.element,canUndo:!1}),i.controller.setLastInsertedElement(e.element.guid)},needsDisplayName:function(e){return"link"===e||"formlink"===e||"columnformlink"===e||"columnlink"===e||""===e},undo:function(){var e=this.arguments,t=this.controller.executeCommand({command:"removeElementById",position:e.position,parent:this.parent,element:e.element,guid:e.element.guid,searchformresult:e.searchformresult,canUndo:!1});return!(t=this.resolveResult(t)).error},needsWizard:function(e){return"cascadingcombo"==e||("association"===e||("querycascadingcombo"===e||("searchlist"===e||("columnsearchlist"===e||"multiselect"===e))))},processWizardResult:function(e,t){return"cascadingcombo"===e?this.processCascadingCombo(e,t):"querycascadingcombo"===e?this.processCascadingCombo(e,t):"association"===e?this.processMultipleRelation(e,t):"searchlist"===e?this.processMultipleRelation(e,t):"columnsearchlist"===e?this.processMultipleRelation(e,t):"multiselect"===e?this.processMultipleRelation(e,t):void 0},processCascadingCombo:function(e,t){var i=this,o=i.arguments,r=o.parent||i.controller.getContextInfo().guid,n=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"getparententities",id:t.guidRelatedEntity,xpath:t.xpath});return $.when(n.processRequest()).pipe(function(n){if(n.length<2){var a=bizagi.localization.getResource("bizagi-editor-form-validation-cascadingcombo");return bizagi.showMessageBox(a,"Bizagi","error",!1),!0}var s,l;return i.cascadingComboElement={},$.each(n,function(n,a){i.cascadingComboElement[n]?o.element=i.cascadingComboElement[n]:(o.element=i.createElement({type:e,xpath:bizagi.editor.utilities.buildComplexXpath(a.xpath,t.contextEntity,!1,a.guid),parentcombo:s,parentrelation:a.parentRelation?bizagi.editor.utilities.buildComplexXpath(a.parentRelation,a.id,!1,a.parentEntity):void 0}),i.cascadingComboElement[n]=o.element),i.controller.executeCommand({command:"insertElement",parent:r,element:o.element,position:o.position+n,canUndo:!1}),null!=l&&l.setProperty("childcombo",o.element.guid),s=o.element.guid,l=i.model.getElement(s)}),!0})},processMultipleRelation:function(e,t){var i=this,o=i.arguments,r=t.model,n=o.parent||i.controller.getContextInfo().guid,a=r.leftxpath,s=bizagi.clone(a),l=s.xpath.baxpath;return l.xpath=l.xpath+"."+r.factxpath,r.xpath=s,r.type=e,$.when(i.getFactNames(r)).pipe(function(){return o.element=i.createElement(r),["searchlist","multiselect"].includes(e)&&(o.element.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable(r.factxpath,o.element.guid,"displayName")),i.controller.executeCommand({command:"insertElement",parent:n,element:o.element,position:o.position,canUndo:!1}),!0})},getFactNames:function(e){var t=e.leftxpath,i=e.leftfactname,o=e.rightxpath,r=e.rightfactname,n=new $.Deferred;return $.when(this.controller.getXpathNavigatorModel({context:t}),this.controller.getXpathNavigatorModel({context:o})).done(function(t,o){var a=t.getNodeByXpath(i);if(e.leftfactname=bizagi.editor.utilities.buildComplexXpath(a.xpath,a.contextScope,a.isScopeAttribute,a.guidRelatedEntity),r){var s=o.getNodeByXpath(r);e.rightfactname=bizagi.editor.utilities.buildComplexXpath(s.xpath,s.contextScope,s.isScopeAttribute,s.guidRelatedEntity)}n.resolve()}),n.promise()},validateSameDisplayNameOfElements:function(e){var t=e,i=this.controller.getContext(),o={};if("adhocform"==i||"adhocgrid"==i){this.model.getMapDisplayNameAdhoc(this.model.form,o);var r=this.controller.getXpathNavigatorModel();$.isArray(r.nodes)&&r.nodes.forEach(function(e){o[bizagi.editor.utilities.getXPathByDisplayName(e.displayName)]=e}),t=this.getDisplayNameAutonumeric(o,e)}return t},convertToLowerPropertiesHash:function(e){for(var t,i=Object.keys(e),o=i.length,r={};o--;)r[(t=i[o]).toLowerCase()]=e[t];return r},getDisplayNameAutonumeric:function(e,t){var i=bizagi.clone(t);if(i=bizagi.editor.utilities.getXPathByDisplayName(i),void 0!==(o=this.convertToLowerPropertiesHash(e))[i.toLowerCase()]){var o=this.getAllHashByDisplayName(o,i);t=t+" "+this.getNextNumberByHash(o).toString()}return t},getAllHashByDisplayName:function(e,t){var i={},o=new RegExp("^("+t.toLowerCase()+")+\\d*$");for(var r in e)o.test(r)&&(i[r]="");return i},getNextNumberByHash:function(e){var t=this.getAllNumbersOfHashes(e);return t=this.sortNumbersAndCombine(t),this.getNextNumberByArrayNumbers(t)},getAllNumbersOfHashes:function(e){var t=[],i=new RegExp("\\d*$");for(var o in e){var r=i.exec(o),n=0;r&&""!==r[0]&&(n=r[0]),t.push(parseInt(n,10))}return t},sortNumbersAndCombine:function(e){var t=e.sort();return t.filter(function(e,i){return t.indexOf(e)==i})},getNextNumberByArrayNumbers:function(e){for(var t=0,i=e.length;t<i;t+=1)if(t!==e[t])return t;return e.length}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.removeElementByIdCommand",{},{execute:function(){var e=this,t=e.arguments;if((e.data=[],e.tabBackup=[],$.isArray(t.guids)||"string"!=typeof t.guid||(t.guids=[t.guid]),"convertTo"!==t.action&&"nestedForm"!==e.type&&e.controller.hasEnableCommandsEditor())&&!e.resolveResult(e.controller.executeCommand({command:"searchDependencies",guids:t.guids})).result)return!1;for(var i=0;i<t.guids.length;i++){var o=e.model.getElement(t.guids[i]);if(o){e.type=o.type;var r=e.controller.getContextInfo(),n=o.parent?e.model.getElement(o.parent.guid):e.model.getElement(r.guid);t.canValidate=!0,"cascadingcombo"==o.type||"querycascadingcombo"==o.type?e.data.push(e.removeCascadingCombo(o)):e.data.push(e.model.removeElementById(t.guids[i])),"tab"==n.type&&0==n.elements.length&&(e.tabBackup.push({parent:n.parent.guid,data:n,guid:n.guid,position:n.position}),e.model.removeElementById(n.guid)),e.removeElementSelected()}}return t.result=e.data,!0},undo:function(){var e=this;if(e.tabBackup.length>0)for(var t=e.tabBackup.length-1;t>=0;t--){e.model.insertElement(e.tabBackup[t].position,e.tabBackup[t].parent,e.tabBackup[t].data);for(var i=e.data.length-1;i>=0;i--)e.model.insertElement(e.data[i].position,e.data[i].parent.guid,e.data[i])}else if($.isArray(e.data))for(t=e.data.length-1;t>=0;t--)e.data[t].entities?e.insertCascadingCombo(t):"formbutton"==e.data[t].type?e.model.addButton(e.data[t]):e.model.insertElement(e.data[t].position,e.data[t].parent.guid,e.data[t]);else"cascadingcombo"==e.type||"querycascadingcombo"==e.type?e.insertCascadingCombo():e.model.insertElement(e.data.position,e.data.parent.guid,e.data);return!0},removeCascadingCombo:function(e){for(var t=e,i=[],o=[],r=0,n={};null!=t.getProperty("parentcombo");){var a=t.getProperty("parentcombo");t=this.model.getElement(a)}for(i.push(t);null!=t.getProperty("childcombo");){var s=t.getProperty("childcombo");t=this.model.getElement(s),i.push(t)}for(var l=0;l<i.length;l++)o.push(this.model.removeElementById(i[l].guid)),0===l?(r=o[l].position,n=o[l].parent):o[l].position<r&&(r=o[l].position);return{position:r,parent:n,entities:o}},insertCascadingCombo:function(e){var t=this;void 0===e?$.each(t.data.entities,function(e,i){t.model.insertElement(t.data.position+e,i.parent.guid,i)}):$.each(t.data[e].entities,function(i,o){t.model.insertElement(t.data[e].position+i,o.parent.guid,o)})},removeElementSelected:function(){this.controller.removeSelectedElement()}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementFromXpathNavigatorCommand",{columnRenderMapping:{boolean:"columnboolean",button:"columnbutton",text:"columntext",number:"columnnumber",money:"columnmoney",date:"columndate",document:"columnDocument",combo:"columncombo",cascadingCombo:"columncombo",list:"columnlist",search:"columnsearch",formlink:"columnformlink",hidden:"columnhidden",label:"columnlabel",link:"columnlink",radio:"columnradio",upload:"columnupload",image:"columnimage",uploadecm:"columnuploadecm",letter:"columnletter"},offlineColumnRenderMapping:{boolean:"offlinecolumnboolean",text:"offlinecolumntext",number:"offlinecolumnnumber",money:"offlinecolumnmoney",date:"offlinecolumndate",combo:"offlinecolumncombo",radio:"offlinecolumnradio",search:"offlinecolumnsuggest"},offlineFormRenderMapping:{boolean:"offlineboolean",text:"offlinetext",number:"offlinenumber",money:"offlinemoney",date:"offlinedate",combo:"offlinecombo",cascadingCombo:"offlinecombo",list:"offlinecombo",radio:"offlinecombo",search:"offlinesuggest",grid:"offlinegrid",image:"offlineimage",upload:"offlineupload"},searchFormRenderMapping:{boolean:"searchboolean",text:"searchtext",number:"searchnumber",money:"searchmoney",date:"searchdate",combo:"searchcombo",cascadingCombo:"searchcombo",list:"searchcombo",radio:"searchcombo",search:"searchsuggest"},searchFormResultRenderMapping:{boolean:"columnResultBoolean",text:"columnResultText",number:"columnResultNumber",money:"columnResultMoney",date:"columnResultDate",combo:"columnResultText",cascadingCombo:"columnResultText",list:"columnResultText",radio:"columnResultText",search:"columnResultText"},queryFormRenderMapping:{boolean:"queryboolean",text:"querytext",number:"querynumber",money:"querymoney",date:"querydate",combo:"querycombo",list:"querylist",cascadingCombo:"querycascadingcombo",radio:"queryradio",search:"querycombo",application:"queryapplication",process:"queryprocess",creatorfullname:"querycreatorfullname",creatorposition:"querycreatorposition",creatorusername:"querycreatorusername",currentuser:"queryusercurrentuser",currentuserfullname:"queryuserfullname",currentuserusername:"queryuserusername",currentuserposition:"queryuserposition",previoususer:"queryuserprevioususer",previoususerfullname:"queryprevioususerfullname",previoususerusername:"queryprevioususerusername",previoususerposition:"queryprevioususerposition",currenttask:"querytaskcurrenttask",previoustask:"querytaskprevioustask",taskentrydate:"querytaskentrydate",taskexpirydate:"querytaskexpirydate",taskstate:"querytaskstate",casecreationdate:"querycasecreationdate",casecreator:"querycasecreator",caseid:"querycaseid",casenumber:"querycasenumber",casesolutiondate:"querycasesolutiondate",casestate:"querycasestate",nestedform:"nestedform"},mobileFormRenderMapping:{boolean:"mobileboolean",text:"mobiletext",number:"mobilenumber",money:"mobilemoney"},propertiesOverrides:{float:{allowdecimals:"true"}}},{execute:function(){var e=this,t=e.arguments;if(void 0===e.element){var i=e.createElementData();if(!i.type)return e.arguments.canUndo=!1,!0;e.arguments.canValidate=!0;var o=e.createElement(i);e.isSpecialElement(t.data.renderType,o),e.element=o,e.parent=e.arguments.parent||e.controller.getContextInfo().guid}return e.controller.executeCommand({command:"insertElement",position:e.arguments.position,parent:e.parent,element:e.element,searchformresult:e.arguments.searchformresult,canUndo:!1}),!0},undo:function(){var e=this.controller.executeCommand({command:"removeElementById",position:this.arguments.position,parent:this.parent,element:this.element,guid:this.element.guid,searchformresult:this.arguments.searchformresult,canUndo:!1});return!(e=this.resolveResult(e)).error},createElementData:function(){var e=this.arguments,t={};return t.type=this.resolveType(),"adhocform"==e.data.context||"adhocgrid"==e.data.context?(t.xpathAdhoc={xpath:e.data.xpath.xpath.baxpath.xpath,relatedEntity:e.data.parent?e.data.parent.guidRelatedEntity:null},t.draggedProperty=!0,t.displayName=e.data.displayName?e.data.displayName:e.data.name,e.data.guidRelatedEntity?t.data={datasource:{guid:e.data.guidRelatedEntity,type:e.data.entityContext}}:t.data={datasource:{type:e.data.entityContext}},e.data.predefinedValues&&(t.data.datasource.values=e.data.predefinedValues)):t.xpath=e.data.xpath,t.renderType=e.data.nodeSubtype,this.controller.isQueryFormContext()&&this.isColumn()&&(t.selectable=!1),"nestedform"===e.data.renderType&&(t.form=bizagi.editor.utilities.buildComplexReference(e.data.guid),t.displayName=e.data.displayName),t.renderType&&this.Class.propertiesOverrides[t.renderType]&&(t=$.extend(t,this.Class.propertiesOverrides[t.renderType])),t},isColumn:function(){var e=this.arguments,t=this.controller.getXpathNavigatorModel(),i=bizagi.editor.utilities.resolveComplexXpath(e.data.xpath),o=t.getNodeByXpath(i);return!!o&&o.parentIsGrid()},resolveType:function(){var e=this,t=e.controller.getContext();return"form"==t||"startform"==t?"form"===e.arguments.data.renderType?"nestedform":e.arguments.data.renderType:"grid"==t?this.Class.columnRenderMapping[e.arguments.data.renderType]:"offlinegrid"==t?this.Class.offlineColumnRenderMapping[e.arguments.data.renderType]:"searchform"==t?e.arguments.searchformresult?this.Class.searchFormResultRenderMapping[e.arguments.data.renderType]:this.Class.searchFormRenderMapping[e.arguments.data.renderType]:"mobileform"==t?this.Class.mobileFormRenderMapping[e.arguments.data.renderType]:"offlineform"==t?this.Class.offlineFormRenderMapping[e.arguments.data.renderType]:"queryform"==t?this.Class.queryFormRenderMapping[e.arguments.data.renderType]:"adhocform"==t||"adhocgrid"==t?e.arguments.data.renderType:null}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.loadModelCommand",{},{execute:function(){var e=this.arguments,t=e.dataModel;return this.model.loadModel(this.controller.getContext(),t,e.mustRegenerateGuids),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.saveModelCommand",{},{execute:function(){var e=this.arguments;e.dataModel;this.model.updateSubmitVersionProperty(),e.dataModel=this.model.saveModel(),e.changeset=this.model.getChangeset(),e.idForm=e.changeset.changeSet[0].id;var t=e.changeset.changeSet[0].deployOnParent;return e.result={dataModel:e.dataModel,changeset:e.changeset,idForm:e.idForm,deployOnParent:t},e.result=this.controller.isAdhocFormContext()?e.dataModel:e.result,!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.createAndInsertControlLayoutInModelCommand",{},{execute:function(){var e=this.arguments;if(void 0===this.layout){var t=this.controller.getLayoutNavigatorModel().findControlById(e.id);"object"==typeof t&&(this.layout=this.model.createLayoutElement(t))}return this.controller.executeCommand({command:"insertElement",position:this.arguments.position,parent:this.arguments.parent,element:this.layout,canUndo:!1}),!0},undo:function(){return this.controller.executeCommand({command:"removeElement",position:this.arguments.position,parent:this.arguments.parent,element:this.layout,canUndo:!1}),!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.changeMultiplePropertiesCommand",{},{execute:function(){var e=this.arguments,t=!1;e.canValidate=!0,$.isArray(e.guids)||"string"!=typeof e.guid||(e.guids=[e.guid]),this.originalValues||(this.originalValues={});for(var i=0,o=e.guids.length;i<o;i++){var r=e.guids[i],n=this.model.getElement(r);if(!this.originalValues[r]){this.originalValues[r]=[];for(var a=0,s=e.properties.length;a<s;a+=1){var l=e.properties[a].property;this.originalValues[r].push({property:l,value:n.getProperty(l)})}}for(a=0,s=e.properties.length;a<s;a+=1){l=e.properties[a].property;var d=e.properties[a].value;n.assignProperty(l,d,e.exclusive),t=n.hasDesignValue(l)||t}}return t&&(this.arguments.refresh=!0),!0},undo:function(){for(var e=this.arguments,t=0,i=e.guids.length;t<i;t++){var o=e.guids[t],r=this.model.getElement(o);for(var n in this.originalValues)for(var a=0,s=this.originalValues[n].length;a<s;a++){var l=this.originalValues[n][a].property,d=this.originalValues[n][a].value;r.assignProperty(l,d,e.exclusive)}}return!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.changeContextCommand",{},{canUndo:function(){return!1},execute:function(){var e=this.arguments,t=e.guid?this.model.getElement(e.guid):null,i=t&&t.properties.xpath?t.properties.xpath:"grid"===e.context||"offlinegrid"===e.context||"adhocgrid"===e.context?"none":null,o={context:e.context,guid:e.guid};return"adhocgrid"===e.context?o.xpathAdhoc=t.properties.xpathAdhoc.xpath:o.xpath=i,this.controller.changeContext(o),!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.addControlLayoutInModelCommand",{},{execute:function(){var e=this.arguments;if(void 0===this.layout){var t=this.controller.getLayoutNavigatorModel().findControlById(e.id);"object"==typeof t&&(this.layout=this.model.createLayoutElement(t))}return this.model.addElement(this.layout),!0},undo:function(){return this.model.removeLastElement(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getGridColumnModelCommand",{},{execute:function(){var e=$.Deferred(),t=this.model.getElement(this.arguments.guid);return $.when(t.getGridColumnModel()).done(function(t){e.resolve(t)}),this.arguments.result=e.promise(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getSearchResultModelCommand",{},{execute:function(){var e=$.Deferred();if(!this.controller.isSearchFormContext())throw"bizagi.editor.getSearchResultModelCommand - To use this command you must be in the searchform context";return $.when(this.model.getSearchResultRenderingModel()).done(function(t){e.resolve({model:bizagi.clone(t.result),resultValidations:t.resultValidations})}),this.arguments.result=e.promise(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getButtonModelCommand",{},{execute:function(){$.Deferred();if(!this.controller.isActivityForm())throw"bizagi.editor.getButtonModelCommand - To use this command you must use an activity form";return this.arguments.result=$.when(this.model.getButtonRenderingModel()),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getXpathEditorModelCommand",{},{execute:function(){var e=this,t=e.arguments,i=this.model.getElement(this.arguments.guid),o=new $.Deferred,r=e.controller.isGridContext()?e.controller.getXpathNavigatorModelGrid():e.controller.getXpathNavigatorModel();return $.when(r).done(function(n){if("adhocform"!=r.context&&"adhocgrid"!=e.controller.context){var a=i.properties.xpath,s=n.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(a));if(s&&bizagi.util.parseBoolean(s.isScopeAttribute)){s.setScopeAttribute("false");var l=n.getSubModel(a);s.setScopeAttribute("true")}else l=n.getSubModel(a)}else{var d=e.resolveEditorParameter(t.editorParameters.entity,i);if(t.editorParameters.entityContext){var c=e.resolveEditorParameter(t.editorParameters.entityContext,i);l=n.getSubModelByEntity(d,c)}else l=n.getSubModelByEntity(d)}o.resolve(l)}),t.result=o.promise(),!0},resolveEditorParameter:function(parameter,element){var t=element;return parameter=parameter.substring(1,parameter.length-1),parts=parameter.split(":"),parts.shift(),eval("t.properties."+parts.join("."))}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.insertTabItemCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(this.arguments.tab);this.arguments.position=t.elements.length,this.arguments.canValidate=!0;var i="tabitem";this.controller.isAdhocFormContext()?i="adhoctabitem":this.controller.isOfflineFormContext()&&(i="offlinetabitem");var o="Tab "+(t.elements.length+1),r=this.createElement({type:i,displayName:o});return this.controller.isAdhocFormContext()||(r.properties.displayName=bizagi.editor.utilities.buildComplexLocalizable(o,r.guid,"displayName")),t.addElement(r),e.result=r,!0},undo:function(){return this.model.removeElement(this.arguments.position,this.arguments.tab),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.updateModelCommand",{},{execute:function(){var e=this.arguments;return"OpenNestedForm"===e.data.actiontype?this.processNestedFormAction():"CreateForm"===e.data.actiontype?this.processCreateFormAction():"CreateFormFromXpath"===e.data.actiontype?this.processCreateFormFromXpathAction():"ShowForm"===e.data.actiontype?this.processShowForm():"OpenWizardTemplates"===e.data.actiontype&&this.processWizardTemplates(),!0},processNestedFormAction:function(){var e=this.arguments,t=(e.data.json,e.data.guidrender);t&&this.model.getElement(t).initilizeData();e.result={action:e.data.actiontype}},findElementInModel:function(e){return this.model.getElement(e)},processData:function(e,t){var i=this,o=[];return e.elements&&$.each(e.elements,function(e,r){var n=i.model.createElement(r.type,r);n.setParent(t),o.push(n)}),o},processWizardTemplates:function(){var e=this.arguments,t=e.data,i=t.propertyName,o=t.guidControl,r=bizagi.editor.utilities.buildComplexReference(t.guidTemplate);this.model.changeProperty(o,i,r),this.model.changeProperty(o,"templatetype","template"),e.result={action:t.actiontype,guid:o}},processCreateFormAction:function(){var e=this.arguments,t=e.data,i=[],o=t.propertyname,r=t.guidrender,n=bizagi.editor.utilities.buildComplexReference(t.idform);t.context&&"searchform"===t.context?(i.push(n),this.model.changeProperty(r,o,i)):this.model.changeProperty(r,o,n),bizagi.util.parseBoolean(t.showForm)&&this.processShowForm(),e.result={action:t.actiontype,guid:r}},processCreateFormFromXpathAction:function(){var e=this.arguments;e.result={action:e.data.actiontype,idNode:e.data.guidForm}},processShowForm:function(){var e=this.arguments,t=e.data,i=this.model.getElement(t.guidrender);e.refresh=!0,i.loadForm(),e.result={action:t.actiontype}}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.updateElementCommand",{renderLayout:{string:"layoutText",collection:"layoutLink",label:"layoutLabel",number:"layoutNumber",float:"layoutNumber",currency:"layoutMoney",date:"layoutDateTime",image:"layoutImage",collection:"layoutLink","entity-parametric":"layoutLink","entity-master":"layoutLink","entity-system":"layoutLink","entity-stakeholder":"layoutLink",boolean:"layoutBoolean",layoutPlaceholder:"layoutPlaceholder",attachment:"layoutUpload"}},{execute:function(){var e=this,t=e.arguments,i=(t.renderType,t.guid),o=e.model.getForm().getLayout(),r=e.createLayoutElement(),n=e.element=e.model.getElement(i);return e.originalHtml||(e.originalHtml=o.properties.html,e.repeaters=bizagi.clone(o.repeaters)),!!e.canReplaceElement(n)&&(e.setProperties(r,n),e.model.replaceElement(i,r),!0)},createLayoutElement:function(){var e=this.arguments,t=(e.property,e.renderType),i=e.guid,o=this.Class.renderLayout[t],r={guid:i,properties:{rendertype:t}};return r.properties[e.property]=e.value,this.model.createElement(o,r)},canReplaceElement:function(e){var t=this.arguments,i=t.toInitialState,o=t.renderType;return!e||(!!i||(":image"!=e.properties.type||"image"==o))},setProperties:function(e,t){var i=this.arguments,o=i.toInitialState;i.guid;if(!o){var r=e.designValueProperties;for(property in r)property!=i.property&&t.designValueProperties[property]&&e.assignProperty(property,t.getProperty(property))}t.properties.type&&e.assignProperty("type",t.getProperty("type")),e.assignProperty("hide",!1)},undo:function(){var e=this.arguments.guid,t=this.model.getForm().getLayout(),i=t.repeaters;for(var o in t.properties.html=this.originalHtml,this.model.replaceElement(e,this.element),i)if(!bizagi.editor.utilities.objectEquals(i[o].elements,this.repeaters[o].elements)){for(var r in i[o].elements)this.model.removeElementById(r);i[o].elements=this.repeaters[o].elements}return!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.replaceAndRestoreElementCommand",{},{execute:function(){var e=this,t=e.arguments,i=t.sourceGuid;e.originalSourceElement=e.model.getElement(i),e.originalTargetElement=e.model.getElement(t.guid);var o=e.originalSourceElement.properties||{},r=e.originalTargetElement.properties||{};return!(e.isImageControl(r.type)&&!e.isImageControl(o.type))&&("layoutPlaceholder"!=e.originalSourceElement.type&&(e.restoreSourceElement(i),e.replaceTargetElement(),!0))},restoreSourceElement:function(e){var t=this.originalSourceElement.properties;if(!(t.type.search(/image/gi)>=0)){var i={guid:e,properties:{rendertype:"layoutPlaceholder",type:t.type}},o=this.model.createElement("layoutPlaceholder",i);this.model.replaceElement(e,o)}},replaceTargetElement:function(){var e=this.arguments,t=bizagi.clone(this.originalSourceElement.properties),i=(t.type,this.originalTargetElement.properties.type,e.guid),o={guid:i,properties:$.extend(t,{type:this.originalTargetElement.properties.type})},r=this.model.createElement(this.originalSourceElement.type,o);this.model.replaceElement(i,r)},isImageControl:function(e){return(e=e||"").search(/image/gi)>=0},undo:function(){var e=this.arguments,t=this.originalSourceElement.properties,i=e.sourceGuid,o=e.guid;return-1==t.type.search(/image/gi)&&this.model.replaceElement(i,this.originalSourceElement),this.model.replaceElement(o,this.originalTargetElement),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.updateGridColumnModelCommand",{},{execute:function(){var e=this.arguments,t=e.gridModel.guid,i=this.model.createElement(e.gridModel.type,e.gridModel);return"adhocgrid"!=i.type&&i.restoreDefaultDisplayName(),this.model.replaceElement(t,i),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.updateAssociationModelCommand",{},{execute:function(){var e=["leftxpath","leftdisplayattrib","leftadditionalattrib","leftfilter","leftcaption","rightxpath","rightdisplayattrib","rightfilter","rightadditionalattrib","rightcaption","factxpath"],t=this.arguments,i=t.model,o=t.guid;this.changes={};for(var r=this.model.getElement(o),n=r.properties,a=0,s=e.length;a<s;a++){var l=e[a];bizagi.editor.utilities.objectEquals(i[l],n[l])||(t.refresh=!0,this.changes[l]=n[l],r.assignProperty(l,i[l]))}return this.calculateXpathControl(),!0},calculateXpathControl:function(){var e=this.arguments,t=e.model,i=e.guid,o=this.model.getElement(i),r=e.control;if(this.changes.factxpath){var n=t.leftxpath,a=bizagi.clone(n),s=a.xpath.baxpath;s.xpath=s.xpath+"."+t.factxpath,o.assignProperty("xpath",a),"searchlist"==r&&o.assignProperty("displayName",bizagi.editor.utilities.buildComplexLocalizable(t.factxpath,i,"displayName")),$.when(this.getFactNames(t)).done(function(){o.assignProperty("leftfactname",t.leftfactname),o.assignProperty("rightfactname",t.rightfactname)})}},getFactNames:function(e){var t=e.leftxpath,i=e.leftfactname,o=e.rightxpath,r=e.rightfactname,n=new $.Deferred;return $.when(this.controller.getXpathNavigatorModel({context:t}),this.controller.getXpathNavigatorModel({context:o})).done(function(t,o){var a=t.getNodeByXpath(i);if(e.leftfactname=bizagi.editor.utilities.buildComplexXpath(a.xpath,a.contextScope,a.isScopeAttribute,a.guidRelatedEntity),r){var s=o.getNodeByXpath(r);e.rightfactname=bizagi.editor.utilities.buildComplexXpath(s.xpath,s.contextScope,s.isScopeAttribute,s.guidRelatedEntity)}n.resolve()}),n.promise()}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getDecoratorModelCommand",{},{execute:function(){var e=this.arguments.guid,t=this.model.getElement(e);return this.arguments.result=t.getDecoratorModel(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getContextMenuModelCommand",{},{execute:function(){var e=this.arguments,t=e.guid,i=e.convertToModel,o=this.model.getElement(t).getContextMenuModel();return o.addConverToItem(i),this.arguments.result=o,!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getXpathDataForElementCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(this.arguments.guid),i=bizagi.editor.utilities.resolveComplexXpath(t.properties.xpath),o=this.controller.isGridContext()?this.controller.getXpathNavigatorModelGrid():this.controller.getXpathNavigatorModel();return e.result=o.getNodeByXpath(i),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getElementPropertyCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid);return this.arguments.result=t.getProperty(e.property),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getElementDesignPropertyCommand",{},{execute:function(){var e=this.arguments;return this.arguments.result=void 0!==e.guids&&this.model.getElement(e.guids[0]).getRenderingModel(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getRibbonModelCommand",{},{execute:function(){var e=this,t=new $.Deferred;args=e.arguments;var i=e.controller.getRibbonModel(),o=e.model.getElement(args.guid),r=args.convertToModel;if(i.reset(),o){for(var n=o.getRibbonProperties(),a=0;a<n.length;a++)i.enableProperty(n[a],o.resolveProperty(n[a]));i.enableAction("copy-format"),r.length>0&&(i.enableAction("convertto"),e.appendConvertToModel(i,r)),i.enableAction("rename"),"nestedform"!==o.type&&"grid"!==o.type||i.disableAction("rename"),i.enableAction("delete"),e.isControlEditable(o)||i.disableProperty("editable")}else i.disableAction("convertto"),e.appendConvertToModel(i,[]);if(e.controller.hasUndo()?i.enableAction("undo"):i.disableAction("undo"),i.enableAction("checkout"),e.controller.isReadOnlyForm()?i.enableAction("checkout"):i.disableAction("checkout"),e.controller.hasRedo()?i.enableAction("redo"):i.disableAction("redo"),e.controller.isReadOnlyForm())i.enableAction("actionsvalidations");else if(e.controller.isFormContext()){i.enableAction("copy-from"),i.enableAction("actionsvalidations"),i.enableAction("useCustomButtons"),e.controller.getModel().getProperty("usecustombuttons")?(i.checkAction("useCustomButtons"),i.showGroup("email"),i.checkAction("enableEmail"),i.enableAction("emailTemplate")):(i.uncheckAction("useCustomButtons"),i.uncheckAction("enableEmail"),i.disableAction("emailTemplate"))}else if(e.controller.isQueryFormContext())i.enableAction("actionsvalidations");else if(e.controller.isOfflineFormContext())i.enableAction("actionsvalidations"),i.showGroup("initForm"),i.enableAction("offlineAsOnline"),e.controller.isOfflineAsOnline()?i.checkAction("offlineAsOnline"):i.uncheckAction("offlineAsOnline");else if(e.controller.isStartFormContext()){if(i.enableAction("actionsvalidations"),i.enableAction("copy-from"),bizagi.editor.flags.UseOfflineForms)e.controller.hasOfflineForm()?i.enableAction("offlineAsOnline"):i.disableAction("offlineAsOnline"),e.controller.getModel().getProperty("useofflineform")?(i.checkAction("useOfflineForm"),i.showGroup("initForm")):(i.hideGroup("initForm"),i.uncheckAction("useOfflineForm")),e.controller.isOfflineAsOnline()?i.checkAction("offlineAsOnline"):i.uncheckAction("offlineAsOnline")}return args.validFormChecked?i.checkAction("validate"):i.uncheckAction("validate"),e.controller.isReadOnlyForm()?(i.disableProperty("language"),i.disableAction("validate")):(i.enableAction("formproperties"),i.enableProperty("language",bizagi.editorLanguage),i.setCaption("language",bizagi.editorLanguage.key)),$.when(e.controller.thereAreChangesInForm()).done(function(e){e?i.enableAction("save"):i.disableAction("save"),t.resolve(i)}),args.result=t.promise(),!0},appendConvertToModel:function(e,t){var i=e.getElementByAction("convertto");if(i){i.elements=[];for(var o=0;o<t.length;o++)i.elements.push({caption:t[o].caption,action:"convert",style:t[o].controlName,property:t[o].controlName,css:t[o].style});e.processElementsForConvertTo(i.elements)}},isControlEditable:function(e){return null!=e.properties.editable}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.insertElementsCommand",{},{execute:function(){var e=this,t=e.arguments,i=new $.Deferred,o=t.data||{};return t.canValidate=!0,e.form||(e.form=e.processData(o)),$.when(e.form.ready()).done(function(){e.addElements(),e.addActions(),e.addValidations(),setTimeout(function(){e.addButtons(),i.resolve(!0)},100)}),i.promise()},processData:function(e){var t=this;t.elements=[];t.hashResources={};var i=e.resources||[],o=e.form;if(i.forEach(function(e){t.hashResources[e.uri]=e}),o&&o.elements){var r=t.model.createElement("form",o,!0);return r.subscribe("getLocalizationObject",function(e,i){return t.getLocalizationObject(i)}),t.regenerateGuids(r,r.elements),t.elements=r.elements,r}return{}},getLocalizationObject:function(e){var t=e.i18n,i=this.hashResources[t.uri];if(i&&(delete this.hashResources[t.uri],i.uri=e.newUri,this.hashResources[e.newUri]=i),!i)return t;var o={};return(i.languages||[]).forEach(function(e){o[e.code]=e.value}),{uri:i.uri,default:i.defaultValue,languages:o}},regenerateGuids:function(e,t){var i=this;t.forEach(function(t){"container"==t.elementType&&i.regenerateGuids(e,t.elements),"cascadingcombo"==t.type&&i.processCascadingCombo(e,t)})},processCascadingCombo:function(e,t){var i=t.resolveProperty("parentcombo"),o=t.resolveProperty("childcombo");if(i){var r=e.getElementByOldGuid(i);t.assignProperty("parentcombo",r.guid)}if(o){var n=e.getElementByOldGuid(o);t.assignProperty("childcombo",n.guid)}},addElements:function(){var e=this;(e.form.elements||[]).forEach(function(t){e.model.addElement(t)})},deleteElements:function(){var e=this;(e.form.elements||[]).forEach(function(t){e.model.removeElementById(t.guid)})},addActions:function(){var e=this;(e.form.actions||[]).forEach(function(t){e.model.addAction(t)})},deleteActions:function(){var e=this;(e.form.actions||[]).forEach(function(t){e.model.deleteAction(t.guid)})},addValidations:function(){var e=this;(e.form.validations||[]).forEach(function(t){e.model.addValidation(t)})},deleteValidations:function(){var e=this;(e.form.validations||[]).forEach(function(t){e.model.deleteValidation(t.guid)})},addButtons:function(){var e=this,t=e.form.buttons||[];e.model.getProperty("usecustombuttons")&&t.forEach(function(t){var i=e.model.createElement(t.type,t);e.model.addButton(i)})},deleteButtons:function(){var e=this;(e.form.buttons||[]).forEach(function(t){e.model.removeElementById(t.guid)})},undo:function(){return this.deleteElements(),this.deleteActions(),this.deleteValidations(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.validateGridColumnModelCommand",{},{execute:function(){var e=this.arguments,t=this.controller.getContextInfo(),i=this.model.getElement(t.guid);return e.result=!0,this.validateGroupBy(i)||(e.result=!1),!0},validateGroupBy:function(e){var t=!0;e&&e.elements&&(t=$.grep(e.elements,function(e,t){if(e.properties&&e.properties.groupby)return!0===e.properties.groupby}).length<=1);return t}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.formValidationsCommand",{},{execute:function(){var e=new $.Deferred,t=this.arguments;t.result={},t.refresh=t.canRefresh,t.canValidate=!0;var i=[];if($.isArray(t.validations)&&t.validations.length>0)for(var o=0,r=t.validations.length;o<r;o+=1)$.isFunction(this["validate"+t.validations[o]])&&i.push(this["validate"+t.validations[o]]());return $.when.apply($,i).done(function(){e.resolve(!0)}),e.promise()},validateRequiredProperties:function(){var e=this.arguments;return this.model.validRequiredProperties()||$.extend(e.result,{requiredProperties:!0}),!0},validateRequiredDependentProperties:function(){var e=this.arguments;return this.model.validRequiredDependentProperties()||$.extend(e.result,{requiredDependentProperties:!0}),!0},validateSameXpath:function(){var e=this,t={},i={},o=e.arguments;if(e.model.getMapXpath(e.model.form,t),$.each(t,function(e,t){t.elements.length>1&&t.editables>1&&(i[e]=t)}),!$.isEmptyObject(i)){for(var r in i){var n=i[r];$.each(n.elements,function(t,i){(i=e.model.getElement(i.guid))&&i.validSameXpath&&i.validSameXpath(r)})}$.extend(o.result,{sameXpath:!0})}return!0},validateSameXpathAdhoc:function(){var e=this,t={},i={},o=e.arguments;if(e.model.getMapXpathAdhoc(e.model.form,t),$.each(t,function(e,t){t.elements.length>1&&t.editables>1&&(i[e]=t)}),!$.isEmptyObject(i)){for(var r in i){var n=i[r];$.each(n.elements,function(t,i){(i=e.model.getElement(i.guid))&&i.validSameXpathAdhoc&&i.validSameXpathAdhoc(r)})}$.extend(o.result,{sameXpath:!0})}return!0},validateSameXpathAdhocDataSource:function(){var e=this,t={},i={},o=e.arguments;if(e.model.getMapXpathDatasourceAdhoc(e.model.form,t),$.each(t,function(e,t){t.elements.length>1&&t.editables>1&&(i[e]=t)}),!$.isEmptyObject(i)){for(var r in i){var n=i[r];$.each(n.elements,function(t,i){(i=e.model.getElement(i.guid))&&i.validSameXpathDatasourceAdhoc&&i.validSameXpathDatasourceAdhoc(r)})}$.extend(o.result,{sameXpath:!0})}return!0},validateElementsInContainers:function(){var e=this.arguments;return this.model.validElementsInContainer()||$.extend(e.result,{elementInContainers:!0}),!0},validateAttributesAdministrables:function(){var e=this.arguments,t=this.model.getForm(),i=t.getProperty("isadministrable");return!("parameter"!=t.triggerGlobalHandler("getContextEntityType")||!i)||(this.model.validAttributesAdministrables()||$.extend(e.result,{attributesAdministrables:!0}),!0)},validateLayoutPlaceholder:function(){var e=this.arguments,t=this.model.getForm().getLayout().repeaters,i=[];for(var o in t){var r=t[o];for(id in r.elements)i.push(id)}return this.model.validLayoutPlaceholder(i)||$.extend(e.result,{layoutPlaceholder:!0}),!0},validateAttributesNoEditables:function(){var e=$.Deferred(),t=this.arguments;return $.when(this.model.validAttributesNoEditables()).then(function(i){i||$.extend(t.result,{attributesNoEditables:!0}),e.resolve(!0)}),e.promise()},validateEntitiesNoEditables:function(){var e=$.Deferred(),t=this.arguments;return $.when(this.model.validEntitiesNoEditables()).then(function(i){i||$.extend(t.result,{entitiesNoEditables:!0}),e.resolve(!0)}),e.promise()}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.validateActionsValidationsModelCommand",{},{execute:function(){var e=this;e.controller.isFormContext()&&$.when(e.controller.getCommandsEditorModel()).done(function(t){var i=t.getInvalidElements();i.actions&&e.removeActions(i.actions),i.validations&&e.removeValidations(i.validations)})},removeActions:function(e){for(var t=0,i=e.length;t<i;t++)this.model.deleteAction(e[t].guid)},removeValidations:function(e){for(var t=0,i=e.length;t<i;t++)this.model.deleteValidation(e[t].guid)}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getSelectFormModelCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid),i={};return i.value=t.getProperty(e.property),i.xpath=t.getProperty("xpath"),i.name=e.propertyName,i.relatedForms=[],i.context=this.controller.getContext(),this.arguments.result=i,!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.removeValidationsInModelCommand",{},{execute:function(){var e=this.arguments;return e.refresh=e.canRefresh,this.model.removeValidations(),!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.convertToCommand",{},{execute:function(){var e=this,t=e.arguments,i=e.model.getElement(t.guid),o=!1;if(e.needsExternalData(t.convertTo)){if(!e.validateElement(i,t.convertTo))return t.canUndo=!1,!1;o=!0,e.precondition||(e.precondition=e.controller.publish("getExternalData",{control:t.convertTo,xpath:i.resolveProperty("xpath")}))}return $.when(e.precondition).pipe(function(i){o?e.processControl({control:t.convertTo,data:i}):e.converToElement()}).pipe(function(){return!0})},converToElement:function(){var e=this,t=e.arguments,i=$.Deferred();if(!e.data){var o=e.getCommonProperties({exclude:{}}),r=e.getElements();e.convertToElement=e.createElement($.extend(o,{type:t.convertTo}),r),e.controller.executeCommand({command:"applyOverridesElement",element:e.convertToElement})}return $.when(e.controller.executeCommand({command:"removeElementById",guid:t.guid,canUndo:!1,action:"convertTo"})).done(function(o){o=e.resolveData(o),e.controller.removeSelectedElement(t.guid),e.model.insertElement(o.position,o.parent.guid,e.convertToElement),e.data=o,e.controller.executeCommand({command:"applyOverridesElement",element:e.data}),i.resolve()}),i.promise()},undo:function(){var e=this.convertToElement.guid;return this.controller.executeCommand({command:"removeElementById",guid:e,action:"convertTo",canUndo:!1}),$.isArray(this.data.entities)?this.insertCascadingCombo():this.model.insertElement(this.data.position,this.data.parent.guid,this.data),!0},getCommonProperties:function(e){var t=this.arguments,i=e.exclude||{},o=this.controller.getControlsModel(),r=this.model.getElement(t.guid),n=o.getDesignProperties(r.type)||{},a=o.getDesignProperties(t.convertTo)||{},s={renderType:!0};for(var l in n)if(!i[l]){var d=n[l],c=a[l];d&&c&&this.identicalProperties(d,c)&&(s[l]=!0)}return this.setValueConvertToProperties(r,s)},getElements:function(){var e=this.arguments,t=this.model.getElement(e.guid);if(t&&t.elements)return this.isContainer(t.type)||this.isCollection(t.type)?t.elements:void 0},isContainer:function(e){return"group"==e||"panel"===e||"tab"===e},isCollection:function(e){return"grid"==e||"groupedgrid"===e},identicalProperties:function(e,t){return!(!e["bas-type"]||!t["bas-type"])&&(!(e.subproperties^t.subproperties)&&(e.subproperties?this.identicalSubproperties(e.subproperties,t.subproperties):e["bas-type"]===t["bas-type"]))},identicalSubproperties:function(e,t){return bizagi.util.identicalObjects(e,t)},setValueConvertToProperties:function(e,t){var i=e.properties,o={};for(var r in t)i[r]&&(o[r]=bizagi.clone(i[r]));return o},needsExternalData:function(e){return"cascadingcombo"==e||"querycascadingcombo"==e},processControl:function(e){if("cascadingcombo"==e.control||"querycascadingcombo"==e.control)return this.processCascadingCombo(e.data)},processCascadingCombo:function(e){var t=this,i=t.arguments,o=$.Deferred();if(e.length<2){var r=bizagi.localization.getResource("bizagi-editor-form-validation-convertto-cascadingcombo");return bizagi.showMessageBox(r,"Bizagi","error",!1),void o.resolve()}var n=t.getCommonProperties({exclude:{displayName:1,xpath:1,data:1}});$.when(t.controller.executeCommand({command:"removeElementById",guid:i.guid,canUndo:!1,action:"convertTo"})).done(function(r){r=t.resolveData(r),t.data=r;var a,s,l=r.parent.guid||t.controller.getContextInfo().guid,d=r.position;t.cascadingComboElements||(t.cascadingComboElements={}),$.each(e,function(e,o){t.cascadingComboElements[e]?t.convertToElement=t.cascadingComboElements[e]:(t.convertToElement=t.createElement($.extend(n,{type:i.convertTo,xpath:bizagi.editor.utilities.buildComplexXpath(o.xpath,i.contextEntity,!1,o.id),parentcombo:a,parentrelation:o.parentRelation?bizagi.editor.utilities.buildComplexXpath(o.parentRelation,o.id,!1,o.parentEntity):void 0})),t.cascadingComboElements[e]=t.convertToElement),t.controller.executeCommand({command:"insertElement",parent:l,element:t.convertToElement,position:d+e,canUndo:!1}),null!=s&&s.setProperty("childcombo",t.convertToElement.guid),a=t.convertToElement.guid,s=t.model.getElement(a)}),o.resolve()}),o.promise()},validateElement:function(e,t){var i=this.arguments;if("cascadingcombo"===t||"querycascadingcombo"===t){var o=e&&e.resolveProperty("xpath");if("object"!=typeof o)return bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-cascadingcombo-invaliddatasource"),"Bizagi","error",!1),!1;i.contextEntity=bizagi.editor.utilities.resolveContextEntityFromXpath(o)}return!0},insertCascadingCombo:function(){var e=this;$.each(e.data.entities,function(t,i){e.model.insertElement(e.data.position+t,i.parent.guid,i)})},resolveData:function(e){return $.isArray(e)?e[0]:e}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.loadWidgetsCommand",{},{execute:function(){var e=this,t=e.arguments;e.model.addWidgets(t.controls.widgets);var i=e.controller.componentModels.controlsNavigator,o=e.controller.getControlsModel();for(var r in $.each(t.controls.widgets,function(t,i){i.type&&"userfield"==i.type&&(e.controller.loadIconUserField(i),e.controller.loadUserfield(i))}),i.processData({controls:t.controls.widgets}),o.processData({controls:t.controls.widgets},[]),localStorage)r.indexOf("control.definitions")>=0&&localStorage.removeItem(r);return!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.copyFormatCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid).getFormatProperties();return this.controller.pushCopyFormat({guid:e.guid,properties:t}),!0}}),bizagi.editor.refreshableCommand.extend("bizagi.editor.changeLayoutCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid);this.originalValue||(this.originalValue=bizagi.clone(t.getProperty("layout"))),t.assignProperty("layout",{elements:e.values});for(var i=0,o=e.values.length;i<o;i+=1){t.elements[i].assignProperty("width",e.values[i].width)}return!0},undo:function(){var e=this.arguments,t=this.model.getElement(e.guid);t.assignProperty("layout",this.originalValue);for(var i=0,o=this.originalValue.elements.length;i<o;i+=1){t.elements[i].assignProperty("width",this.originalValue.elements[i].width)}return!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.propertyIsRequiredCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid);return e.result=t.isRequiredProperty(e.property),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getXpathNavigatorModelCommand",{},{execute:function(){var e=this,t=e.arguments,i=new $.Deferred;return t.toogleView&&e.controller.toogleXPathNavigatorView(),$.when(e.controller.getXpathNavigatorModel()).done(function(t){$.when(t.ready()).done(function(t){if($.isPlainObject(t))i.resolve(t);else if(e.controller.isGridContext())i.resolve(t);else{e.controller.getXpathNavigatorView()===bizagi.editor.component.xpathnavigator.model.view.onlyProcessEntity?t.getProcessEntityModel():t.getAllModel(),i.resolve(t)}})}),t.result=i.promise(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getAdhocXpathNavigatorModelCommand",{},{execute:function(){var e=this.arguments,t=new $.Deferred;return e.toogleView&&this.controller.toogleXPathNavigatorView(),$.when(this.controller.getAdhocXpathNavigatorModelGrid()).done(function(e){t.resolve(e)}),e.result=t.promise(),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getConvertToModelCommand",{renderTypeMapping:{text:"string",currency:"number",float:"number",attachment:"upload","entity-master":["combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"],"entity-stakeholder":["combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"],"entity-system":["combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"],"entity-parametric":["cascadingcombo","combo","formlink","list","search","radio","suggest","searchsuggest","searchcombo","entitytemplate","actionlauncher"]},renderTypeOfflineMapping:{currency:"number",float:"number",attachment:"upload","entity-master":["offlinecombo","offlineradio","offlinesuggest","offlinelist"],"entity-stakeholder":["offlinecombo","offlineradio","offlinesuggest","offlinelist"],"entity-parametric":["offlinecombo","offlineradio","offlinesuggest","offlinelist"]},renderTypeQueryMapping:{currency:"querynumber",float:"querynumber","entity-master":["querycombo","queryradio","querysuggest","querylist"],"entity-stakeholder":["querycombo","queryradio","querysuggest","querylist"],"entity-parametric":["querycascadingcombo","querycombo","queryradio","querysuggest","querylist"]}},{execute:function(){var e=this,t=e.arguments,i=new $.Deferred,o=e.model.getElement(t.guid);if(o){var r,n=o.properties.xpath;if(e.model=o.getConvertToModel(),t.result=e.model,n)r="groupedgrid"===o.type?e.controller.getXpathNavigatorModel():e.controller.isGridContext()?e.controller.getXpathNavigatorModelGrid():e.controller.getXpathNavigatorModel(),$.when(r).done(function(o){var r=o.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(n));if(r){var a=r.getRenderType();t.result=e.getModel(a)}i.resolve(!0)});else i.resolve(!0)}else t.result=[],i.resolve(!0);return i.promise()},getModel:function(e){var t=this.model;return e=this.resolveType(e),$.isArray(e)?$.grep(t,function(t,i){return $.inArray(t.controlName,e)>=0}):$.grep(t,function(t,i){return t.controlName===e||$.inArray(e,t.filterBy)>=0})},resolveType:function(e){var t=this.controller.isOfflineContext()?this.Class.renderTypeOfflineMapping:this.controller.isQueryFormContext()?this.Class.renderTypeQueryMapping:this.Class.renderTypeMapping;if(t[e]){var i=t[e];if(this.controller.isGridContext()&&Array.isArray(i)){var o=this.controller.isOfflineContext();i=i.map(function(e){return o?e.replace(/offline/,"offlinecolumn"):"column"+e})}return i}return e}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.applyOverridesElementCommand",{propertiesOverrides:{currency:{allowdecimals:"true",thousands:"true"},float:{allowdecimals:"true",thousands:"true"},number:{allowdecimals:"false",thousands:"false"}},requiredPropertiesOverrides:{combo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},columncombo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},querycombo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},querymultiselect:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},searchcombo:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},list:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},columnlist:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},querylist:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},radio:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},columnradio:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}},queryradio:{"entity-parametric":{"data.displayattrib":!1},"entity-master":{"data.displayattrib":!0},"entity-stakeholder":{"data.displayattrib":!0},"entity-system":{"data.displayattrib":!0}}}},{execute:function(){var e=this,t=e.arguments;return!!e.controller.isOfflineFormContext()||(e.element=t.element||e.model.getElement(t.guid),!bizagi.editor.utilities.isObject(e.element.properties.xpath)||(e.xpathModel=e.controller.isGridContext()?e.controller.getXpathNavigatorModelGrid():e.controller.getXpathNavigatorModel(),t.overrides=t.overrides||{properties:!0,requiredProperties:!0},t.overrides.properties&&e.propertiesOverrides(),t.overrides.requiredProperties&&e.requiredPropertiesOverrides(),e.updateControlType(),!0))},propertiesOverrides:function(){var e=this.getRenderType();e&&this.Class.propertiesOverrides[e]&&this.element.propertiesOverrides(this.Class.propertiesOverrides[e])},requiredPropertiesOverrides:function(){var e=this.element.properties.type,t=this.getRenderType(),i=this.Class.requiredPropertiesOverrides[e];i&&i[t]&&this.element.requiredPropertiesOverrides(i[t])},getRenderType:function(){var e=this.element.properties.xpath,t=this.xpathModel.getNodeByXpath(bizagi.editor.utilities.resolveComplexXpath(e));return!!t&&t.getRenderType()},updateControlType:function(){"hidden"!=this.element.type&&"offlinehidden"!=this.element.type&&"columnhidden"!=this.element.type&&"queryhidden"!=this.element.type&&"layoutPlaceholder"!=this.element.type||(this.element.controlType=this.getRenderType())}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.getMultiselectionPropertiesCommand",{properties:{visible:!1,editable:!1,required:!1,format:!1,layout:!1},defaultValueProperties:{visible:{fixedvalue:"true"},editable:{fixedvalue:"true"},required:{fixedvalue:"false"},format:{size:void 0,bold:void 0,italic:void 0,underline:void 0,strikethru:void 0,color:void 0,background:void 0},layout:{labelwidth:50,valuewidth:50}}},{execute:function(){var e=this,t=e.arguments||{};return e.mergeModel=bizagi.clone(e.Class.properties),e.selectedElements=e.controller.getGuidsSelected(),e.getPropertiesModel(e.selectedElements),e.findCommonProperties(),t.result=e.buildModel(),e.resetProperties(),!0},getPropertiesModel:function(e){this.propertiesModel={};for(var t=0,i=e.length;t<i;t++){var o=e[t],r=this.model.getElement(o);this.propertiesModel[o]=$.extend(!0,{},r.getPropertiesModel())}},resetProperties:function(){for(var e in this.Class.properties)this.Class.properties[e]=!1},findCommonProperties:function(){for(var e in this.commonProperties={},this.propertiesModel){this.resetProperties(),this.commonProperties[e]={};var t=this.propertiesModel[e].elements[0].tabs;this.findPropertiesInTabs(e,t)||this.removePropertiesInMergeModel()}},findPropertiesInTabs:function(e,t){for(var i=0,o=t.length;i<o;i++)for(var r=t[i],n=0,a=r.elements.length;n<a;n++){var s=r.elements[n];if(s.property&&this.propertyIsValid(s.property.name)&&("boolean"==typeof this.mergeModel[s.property.name]?this.mergeModel[s.property.name]={element:s,tab:r}:this.resolvePropertyValue(s),this.findAllProperties()))return!0}return!1},resolvePropertyValue:function(e){if(this.mergeModel[e.property.name]){var t=this.mergeModel[e.property.name].element;if(!bizagi.editor.utilities.objectEquals(e.property.value,t.property.value)&&(t.property.value=this.Class.defaultValueProperties[e.property.name],t.property.subproperties))for(var i=t.property.subproperties,o=0,r=i.length;o<r;o++){var n=i[o].property;n&&(n.value=this.Class.defaultValueProperties[n.name])}}},propertyIsValid:function(e){for(var t in this.Class.properties){if(!this.Class.properties.hasOwnProperty(t))break;if(t===e)return this.Class.properties[t]=!0,!0}return!1},findAllProperties:function(){var e=!0;for(var t in this.Class.properties)if(!(e&=this.Class.properties[t]))return e;return e},removePropertiesInMergeModel:function(){for(var e in this.Class.properties)this.Class.properties[e]||delete this.mergeModel[e]},buildModel:function(){var e={},t=this.selectedElements.length;e.renderCaption=t+" "+bizagi.localization.getResource("bizagi-editor-properties-multiple-controls-caption"),e.idRender="00000000-0000-0000-0000-000000000000",e.element={type:"multiselect"},e.elements=[];var i={tabs:[]},o=this.mergeTabs();for(var r in o)i.tabs.push(o[r]);return e.elements.push(i),e},mergeTabs:function(){var e={};for(var t in this.mergeModel){var i=this.mergeModel[t].tab;e[i.caption]?e[i.caption].elements.push(this.mergeModel[t].element):(e[i.caption]={elements:[],caption:i.caption,id:i.id},e[i.caption].elements.push(this.mergeModel[t].element))}return e}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.searchDependenciesCommand",{},{execute:function(){var e=this.arguments,t=this.model.getActionValidationsModel(),i=this.controller.isGridContext()?bizagi.editor.utilities.resolveComplexXpath(this.controller.getContextInfo().xpath)+"[].":"";this.actions=t.actions,this.validations=t.validations,this.mapXpath=t.mapXpaths,$.isArray(e.guids)||"string"!=typeof e.guid||(e.guids=[e.guid]);for(var o=0;o<e.guids.length;o++){var r=this.model.getElement(e.guids[o]);if(this.processElement(r,i))return!0}return e.result={result:!0},!0},processElement:function(e,t){var i=this,o=i.arguments,r=!1;if(t=t||"",!e)return!1;var n=e.properties,a=i.xpath=t+(bizagi.editor.utilities.resolveComplexXpath(n.xpath)||e.guid);if(i.isUniqueXpath(a)){i.idElement=e.guid;var s=e.resolveDisplayNameProperty();if(i.processActions()||(i.showMessage(s),o.result={result:!1,fail:"Actions"},r=!0),i.processValidations()||(i.showMessage(s),o.result={result:!1,fail:"Validations"},r=!0),Array.isArray(e.elements)){var l=e.isGrid();e.elements.forEach(function(e){var t=l?a+"[].":t;r=r||i.processElement(e,t)})}}return r},processActions:function(){for(var e=0,t=this.actions.length;e<t;e++){var i=this.actions[e];if(this.seachInDependencies(i.dependencies))return!1;if(this.searchInCommands(i.commands))return!1;if(this.searchInCommands(i.elseCommands))return!1}return!0},isUniqueXpath:function(e){if(!e)return!0;if(!this.mapXpath[e])return!0;var t=this.mapXpath[e].elements;if(1==t.length)return!0;for(var i=0,o=t.length,r={form:0,nestedForm:0};i<o;)t[i++].nestedForm?r.nestedForm++:r.form++;return 1===r.form},processValidations:function(){for(var e=0,t=this.validations.length;e<t;e++){var i=this.validations[e];if(this.searchInConditions(i.conditions))return!1}return!0},seachInDependencies:function(e){var t=this,i=!1;return e&&$.each(e,function(e,o){return t.xpath===bizagi.editor.utilities.resolveComplexXpath(o)?(i=!0,!1):t.idElement===bizagi.editor.utilities.resolveComplexXpath(o)?(i=!0,!1):void 0}),i},searchInCommands:function(e){var t=this,i=!1;return e&&$.each(e,function(e,o){return o.xpath&&t.xpath===bizagi.editor.utilities.resolveComplexXpath(o.xpath)?(i=!0,!1):o.container&&o.container===t.idElement?(i=!0,!1):o.renderId&&o.renderId===t.idElement?(i=!0,!1):void 0}),i},searchInConditions:function(e){var t=this,i=!1,o=e.expressions;return $.each(o,function(e,o){if(o.simple){if(t.xpath===(bizagi.editor.utilities.resolveComplexXpath(o.simple.xpath)||o.simple.renderId))return i=!0,!1}else if(o.complex)return t.searchInConditions(o.complex.conditions)}),i},showMessage:function(e){var t=this.arguments.message,i=bizagi.localization.getResource("formmodeler-command-searchdependencies-error").replace("{0}",e);t&&(i=t.replace("{0}",e)),bizagi.showMessageBox(i,"info","info",!1)}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.refreshControlCommand",{},{execute:function(){var e=this.arguments,t=this.model.getElement(e.guid);return t&&t.refreshControl&&t.refreshControl(e),!0}}),bizagi.editor.insertElementFromXpathNavigatorCommand.extend("bizagi.editor.addEntityChildrenCommand",{},{execute:function(){var e=this,t=e.arguments,i=new $.Deferred,o=t.node,r=e.controller.getContextInfo().guid;return null==e.elements?(e.elements=[],e.parent=r,e.addElementToRender(o.getChildren(),r)):e.elements.forEach(function(t){return e.model.addElement(t,e.parent)}),t.refresh=!0,i.resolve(!0),t.result=i.promise(),!0},addElementToRender:function(e,t){var i=this;(e=e||[]).forEach(function(e){var o=i.resolveType(e.renderType);if(o&&"form"!=e.nodeType){var r=i.model.createElement(o,{properties:{type:o,xpath:bizagi.editor.utilities.buildComplexXpath(e.xpath,e.contextScope,e.isScopeAttribute,e.guidRelatedEntity),renderType:e.nodeSubtype}});i.elements.push(r),i.model.addElement(r,t),i.controller.executeCommand({command:"applyOverridesElement",overrides:{properties:!0,requiredProperties:!0},guid:r.guid,canUndo:!1})}})},resolveType:function(e){var t=this.controller.getContext();return"form"==t||"startform"==t?"form"===e?"nestedform":e:"grid"==t?this.Class.columnRenderMapping[e]:"offlinegrid"==t?this.Class.offlineColumnRenderMapping[e]:"searchform"==t?this.Class.searchFormRenderMapping[e]:"offlineform"==t?this.Class.offlineFormRenderMapping[e]:"queryform"==t?this.Class.queryFormRenderMapping[e]:null},undo:function(){var e=this;return e.elements.forEach(function(t){e.model.removeElementById(t.guid)}),!0}}),bizagi.editor.notUndoableCommand.extend("bizagi.editor.duplicateDisplayNameFormCommand",{},{execute:function(){var e=this.model.getGuid(),t=this.model.resolveProperty("displayName")&&this.model.resolveDisplayNameProperty();if(!t)return!1;var i="copy_"+t;return this.controller.executeCommand({command:"changeProperty",guid:e,property:"displayName",value:i,canUndo:!1}),!0}}),bizagi.editor.component.controller("bizagi.editor.wizard.base",{init:function(e,t){this._super(e),this.params=t},render:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplates()).done(function(){e.renderWizard(),e.renderButtons().appendTo(e.element),t.resolve()}),t.promise()},loadTemplates:function(e){e=e||{};e=$.extend(e,{"wizard-buttons":bizagi.getTemplate("bizagi.editor.wizard.base")+"#wizard-buttons"});return this._super(e)},getButtons:function(){return[{button:"cancel",caption:bizagi.localization.getResource("bizagi-editor-wizard-buttons-cancel")},{button:"finish",caption:bizagi.localization.getResource("bizagi-editor-wizard-buttons-finish")}]},renderWizard:function(){},renderButtons:function(){var e=this,t=e.getButtons(),i=$.tmpl(e.getTemplate("wizard-buttons"),{buttons:t});return $("button",i).button(),$("button",i).click(function(){var t=$(this).attr("data-button");e.processButton(t)}),i},processButton:function(e){"cancel"==e&&this.presenter.closePopup({success:!1}),"finish"==e&&this.processFinishButton()},processFinishButton:function(){this.presenter.closePopup({success:!0})}}),bizagi.editor.observableClass.extend("bizagi.editor.wizard.presenter",{},{createWizard:function(canvas,params){try{var control=params.control,fn=eval("var bafn = function(canvas, params) {  return new bizagi.editor.wizard."+control+"(canvas, params);};bafn"),wizard=fn(canvas,params);return wizard}catch(e){throw"Can't create a wizard for "+control}},show:function(e){var t=this.popupDeferred=new $.Deferred,i=this.popup=bizagi.createPopup({name:"bz-fm-wizard",container:"form-modeler",additionalClass:"bz-fm-wizard-popup-"+e.control,title:e.title,center:!0,onClose:function(e){t.resolve(e)}});return this.wizard=this.createWizard(i.content,$.extend(e,{presenter:this,popup:i})),this.wizard.render(),t.promise()},closePopup:function(e){this.popup.close(e)}}),bizagi.editor.wizard.base("bizagi.editor.wizard.cascadingcombo",{init:function(e,t){t=t||{},this._super(e,t),this.canvas=e,this.presenter=t.presenter},loadTemplates:function(){var e={"wizard-container":bizagi.getTemplate("bizagi.editor.wizard.cascadingcombo")+"#wizard-container"};return this._super(e)},renderWizard:function(){var e=$.tmpl(this.getTemplate("wizard-container"),{});this.drawXpathNavigator(e),e.appendTo(this.canvas)},drawXpathNavigator:function(e){var t=this,i=$(".bz-fm-wizard-cascadingcombo-xpath span",e);$.when(t.params.xpathModel).done(function(e){var o=new bizagi.editor.component.xpathnavigator.presenter({canvas:i,model:e});o.subscribe("nodeClick",function(e,i){t.onNodeClick(i)}),o.subscribe("nodeDoubleClick",function(e,i){t.onNodeDoubleClick(i)}),o.render({allowDrag:!1,filter:{typeFilter:"xpathtoentity"}})})},processFinishButton:function(){null!=this.selectedNode?"entity-application"!=this.selectedNode.nodeType?this.presenter.closePopup({success:!0,xpath:this.selectedNode.xpath,displayName:this.selectedNode.displayName,contextEntity:this.selectedNode.contextScope,guidRelatedEntity:this.selectedNode.guidRelatedEntity}):bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-cascadingcombo-invaliddatasource"),"Bizagi","error",!1):bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-cascadingcombo-nodatasource"),"Bizagi","error",!1)},onNodeClick:function(e){this.selectedNode=e},onNodeDoubleClick:function(e){this.selectedNode=e,this.processFinishButton()}}),bizagi.editor.wizard.base("bizagi.editor.wizard.association",{init:function(e,t){t=t||{},this._super(e,t),this.canvas=e,this.presenter=t.presenter,this.model=new bizagi.editor.wizard.association.model(t.model)},loadTemplates:function(){var e={"wizard-container":bizagi.getTemplate("bizagi.editor.wizard.association")+"#wizard-container-association"};return this._super(e)},renderWizard:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.getTemplate("wizard-container");$.tmpl(i,e.model.getViewModel()).appendTo(t)})},refresh:function(){this.render()},updateProperty:function(e,t,i){return this.model.updateProperty(e,t,i)},getFilterProperty:function(e){return this.model.getFilter(e)},getFilterTypes:function(e){return this.model.getFilterTypes(e)},getRelatedEntity:function(e){return this.model.getRelatedEntity(e)},getPropertyValue:function(e){return this.model.getPropertyValue(e)},processFinishButton:function(){var e=this;e.model.isValid()?$.when(e.relationshipIsValid()).done(function(t){t.isValid?e.presenter.closePopup({success:!0,model:e.model.getPersistenceModel(t)}):bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-association-invalidrelationship"),"Bizagi","error",!1)}):bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-association-invalidmodel"),"Bizagi","error",!1)},getOffsetElement:function(e){var t=e.offset();return{top:t.top+e.outerHeight(!0),left:t.left}},buildComplexXpath:function(e){return bizagi.editor.utilities.buildComplexXpath(e.xpath,e.contextScope,e.isScopeAttribute,e.guidRelatedEntity)},resolveComplexXpath:function(e){return bizagi.editor.utilities.resolveComplexXpath(e)},getMultipleRelationship:function(e){var t=new $.Deferred;return $.when(this.presenter.publish("getMultipleRelationship",e)).done(function(e){t.resolve()}),t.promise()},relationshipIsValid:function(){var e=new $.Deferred,t=bizagi.editor.utilities.resolveRelatedEntityFromXpath(this.getPropertyValue("leftxpath")),i=bizagi.editor.utilities.resolveRelatedEntityFromXpath(this.getPropertyValue("rightxpath"));return $.when(this.presenter.publish("getMultipleRelationship",{leftEntity:this.getPropertyValue("leftxpath"),rightEntity:this.getPropertyValue("rightxpath")})).done(function(o){if(o)for(var r=o.leftfact,n=o.rightfact,a=0,s=r.length;a<s;a++){var l=r[a];if(l.ParentId==t&&l.RightEntity==i){e.resolve({isValid:!0,factxpath:l.CatalogName,leftfactname:l.CatalogName,rightfactname:n[0]&&n[0].CatalogName});break}}else e.resolve(!1);e.resolve(!1)}),e.promise()},".bizagi_editor_component_editor_xpath .bz-wizard-association-editor-xpath click":function(e){var t=this,i=e.prev("input"),o=e.data("property"),r={};r.position=t.getOffsetElement(i,r);var n=void 0;t.getFilterProperty(o)&&((n={}).typeFilter=t.getFilterProperty(o),r.typeEditor=n.typeFilter,t.getFilterTypes(o)&&(n.types=t.getFilterTypes(o))),r.filter=n,r.entity=t.resolveComplexXpath(t.getRelatedEntity(o)),r.xpath=t.resolveComplexXpath(t.getPropertyValue(o)),r.xpathProperty=o,$.when(t.presenter.publish("showXPathNavigatorEditor",r)).done(function(e){var i=t.buildComplexXpath(e);t.updateProperty(i,t.resolveComplexXpath(i),o),t.refresh()})},".biz-ico-filter-value click":function(e){var t=this,i=e.data("property"),o=t.getPropertyValue(i),r={};r.data=o||{bafilter:{filter:"filter"}},r.entity=t.resolveComplexXpath(t.getRelatedEntity(i)),r.xpathNode=t.presenter.publish("getXpathData",{xpath:r.entity}),r.protocol="loadfilter";var n=bizagi.editor.communicationprotocol.factory.createProtocol(r);$.when(n.processRequest()).done(function(e){if(e){var o=e.isEmpty?void 0:bizagi.editor.utilities.buildComplexFilter(e,r.xpathNode);t.updateProperty(o,e,i),t.refresh()}})},".editor-localizablestring-input input blur":function(e){var t=e.val(),i=e.data("property"),o=this.getPropertyValue(i),r=e.next(".editor-localizablestring-localization"),n=e.parent();if(r.removeClass("ui-control-fadeIn"),n.toggleClass("ui-control-focus"),t.length>0){if(bizagi.editor.utilities.isObject(o)){var a=bizagi.editorLanguage.key;"default"===a?o.i18n.default=t:o.i18n.languages[a]=t,t=o}else t=bizagi.editor.utilities.buildComplexLocalizable(t,this.model.getElementGuid(),i);this.updateProperty(t,bizagi.editor.utilities.resolvei18n(t),i),this.refresh()}},".editor-localizablestring-input input focus":function(e){var t=e.next(".editor-localizablestring-localization"),i=e.prev('input[type="text"]').parent();t.addClass("ui-control-fadeIn"),i.toggleClass("ui-control-focus")},".editor-localizablestring-input .editor-localizablestring-localization mouseenter":function(e){e.addClass("editor_localizablestring_fadeIn")},".editor-localizablestring-input .editor-localizablestring-localization mouseleave":function(e){e.removeClass("editor_localizablestring_fadeIn")},".editor-localizablestring-localization click":function(e){var t=this,i=e.prev("input").data("property"),o=t.getPropertyValue(i),r=t.model.getElementGuid();$.when(t.presenter.publish("setLocalization",{propertyName:i,propertyValue:o,elementGuid:r})).done(function(e){t.updateProperty(e,bizagi.editor.utilities.resolvei18n(e),i),t.refresh()})}}),bizagi.editor.observableClass.extend("bizagi.editor.wizard.association.model",{},{init:function(e){e=e||{},this.elementGuid=e.guid||Math.guid(),this.data=e,this.leftProperties={},this.rightProperties={},this.properties={},this.xpathProperty=null,this.processData(e)},processData:function(e){for(var t=this.getLeftPropertiesModel(),i=this.getRightPropertiesModel(),o=0,r=t.length;o<r;o++){var n=t[o];n.value=e[n.property],n.displayValue=this.getDisplayValue(n),this.leftProperties[n.property]=n,this.properties[n.property]=n}for(o=0,r=i.length;o<r;o++){var a=i[o];a.value=e[a.property],a.displayValue=this.getDisplayValue(a),this.rightProperties[a.property]=a,this.properties[a.property]=a}},getDisplayValue:function(e){if(e.value){if("xpatheditor"==e.editor)return bizagi.editor.utilities.resolveComplexXpath(e.value);if("filter"==e.editor)return bizagi.editor.utilities.resolvefilterExpression(e.value);if("localizable"==e.editor)return bizagi.editor.utilities.resolvei18n(e.value)}},updateProperty:function(e,t,i){var o=this.properties[i];o&&(o.value=e,o.displayValue=t,this.cleanProperties(i))},cleanProperties:function(e){if("leftxpath"==e)for(var t=this.getLeftPropertiesModel(),i=1,o=t.length;i<o;i++){var r=t[i];this.leftProperties[r.property].value=null,this.leftProperties[r.property].displayValue=null}else if("rightxpath"==e){var n=this.getRightPropertiesModel();for(i=1,o=n.length;i<o;i++){var a=n[i];this.rightProperties[a.property].value=null,this.rightProperties[a.property].displayValue=null}}},update:function(e){this.processModel(e)},getFilter:function(e){var t=this.properties[e];return t?t.filterBy:""},getFilterTypes:function(e){var t=this.properties[e];return t?t.types:null},getRelatedEntity:function(e){var t=this.properties[e];return t?this.getPropertyValue(t.entity):null},getEntity:function(e){var t=this.properties[e];return t?t.entity:null},getPropertyValue:function(e){var t=this.properties[e];return t?t.value:null},getProperty:function(e){return this.properties[e]},getElementGuid:function(){return this.elementGuid},updateDependencies:function(){var e=bizagi.util.isEmpty(this.getPropertyValue("leftxpath"));for(var t in this.leftProperties)"leftxpath"!=t&&(this.leftProperties[t].readonly=e);var i=bizagi.util.isEmpty(this.getPropertyValue("rightxpath"));for(var o in this.rightProperties)"rightxpath"!=o&&(this.rightProperties[o].readonly=i)},isValid:function(){for(var e in this.properties)if(this.properties[e].required&&!this.properties[e].value)return!1;return!0},getViewModel:function(){return this.updateDependencies(),{leftProperties:this.getViewLeftPropertiesModel(),rightProperties:this.getViewRightPropertiesModel()}},getViewLeftPropertiesModel:function(){var e=[];for(var t in this.leftProperties)e.push(this.leftProperties[t]);return e},getViewRightPropertiesModel:function(){var e=[];for(var t in this.rightProperties)e.push(this.rightProperties[t]);return e},getLeftPropertiesModel:function(){var e=[];return e.push({property:"leftxpath",value:null,editor:"xpatheditor",filterBy:"xpathtocollection",readonly:!1,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftxpath")}),e.push({property:"leftdisplayattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"leftxpath",required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftdisplayattrib")}),e.push({property:"leftadditionalattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"leftxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftadditionalattrib")}),e.push({property:"leftfilter",value:null,editor:"filter",readonly:!0,displayValue:null,entity:"leftxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftfilter")}),e.push({property:"leftcaption",value:"",editor:"localizable",readonly:!0,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-leftcaption")}),e},getRightPropertiesModel:function(){var e=[];return e.push({property:"rightxpath",value:null,readonly:!1,editor:"xpatheditor",filterBy:"xpathtocollection",displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightxpath")}),e.push({property:"rightdisplayattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightdisplayattrib")}),e.push({property:"rightadditionalattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightadditionalattrib")}),e.push({property:"rightfilter",value:null,editor:"filter",readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightfilter")}),e.push({property:"rightcaption",value:"",editor:"localizable",readonly:!0,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-association-editor-rightcaption")}),e},getPersistenceModel:function(e){var t={};for(var i in this.properties)this.properties[i].value&&(t[i]=this.properties[i].value);return t.factxpath=e.factxpath,t.guid=this.getElementGuid(),t.leftfactname=e.leftfactname,t.rightfactname=e.rightfactname,t}}),bizagi.editor.base.services=bizagi.editor.base.services||{},bizagi.editor.base.services.EndPoint=function(){function e(e,t,i,o,r){this._name=e,this._url=t,this._method=i,this._arguments=o,this._isArray=r}return e.prototype.getName=function(){return this._name},e.prototype.setName=function(e){this._name=e},e.prototype.getUrl=function(){return this._url},e.prototype.setUrl=function(e){this._url=e},e.prototype.getIsArray=function(){return this._isArray},e.prototype.setisArray=function(e){this._isArray=e},e.prototype.getMethod=function(){return this._method},e.prototype.setMethod=function(e){this._method=e},e.prototype.getArguments=function(){return this._arguments},e.prototype.setArguments=function(e){this._arguments=e},e.prototype.setHeaders=function(e){this._headers=e},e}(),bizagi.editor.base.services.EndPointArgument=function(){function e(e,t){this._name=e,this._type=t}return e.prototype.getName=function(){return this._name},e.prototype.setName=function(e){this._name=e},e.prototype.getType=function(){return this._type},e.prototype.setType=function(e){this._type=e},e}();var EndPointArgument=bizagi.editor.base.services.EndPointArgument,EndPointArgumentType,EndPointMethod;bizagi.editor.base.services.EndPointArgumentBuilder=function(){function e(){}return e.prototype.setName=function(e){return this._name=e,this},e.prototype.setType=function(e){return this._type=e,this},e.prototype.create=function(){if(null==this._name)throw"Name is null";if(null==this._type)throw"Type is null";return new EndPointArgument(this._name,this._type)},e}(),function(e){e[e.UrlPath=0]="UrlPath",e[e.QueryString=1]="QueryString",e[e.Body=2]="Body",e[e.Form=3]="Form"}(EndPointArgumentType||(EndPointArgumentType={})),bizagi.editor.base.services.EndPointBuilder=function(){function e(){this._name=null,this._url=null,this._method=null,this._arguments=null,this._headers=null,this._isArray=!1,this.EndPoint=bizagi.editor.base.services.EndPoint}return e.prototype.setName=function(e){return this._name=e,this},e.prototype.setUrl=function(e){return this._url=e,this},e.prototype.setMethod=function(e){return this._method=e,this},e.prototype.setArguments=function(e){return this._arguments=e,this},e.prototype.setIsArray=function(e){return this._isArray=e,this},e.prototype.create=function(){if(null==this._name)throw"Name is null";if(null==this._url)throw"Url is null";if(null==this._method)throw"Method is null";if(null==this._arguments)throw"Arguments is null";if(null==this._isArray)throw"isArray is null";return new this.EndPoint(this._name,this._url,this._method,this._arguments,this._isArray)},e}(),bizagi.editor.base.services.EndPointHeader=function(){function e(e,t){this._name=e,this._value=t}return e.prototype.getName=function(){return this._name},e.prototype.setName=function(e){this._name=e},e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(e){this._value=e},e}(),function(e){e[e.GET=0]="GET",e[e.POST=1]="POST",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(EndPointMethod||(EndPointMethod={}));var EndPointBuilder=bizagi.editor.base.services.EndPointBuilder;bizagi.editor.base.services.EndPointsHelper=function(){function e(){}return e.prototype.getResource=function(){return(new EndPointBuilder).setName("getResource").setUrl(BIZAGI_URL_REST_SERVICES+"api/forms-designer/resources").setMethod(EndPointMethod[EndPointMethod.POST]).setArguments([]).create()},e.prototype.getMultiResources=function(){return(new EndPointBuilder).setName("getMultiResources").setUrl(BIZAGI_URL_REST_SERVICES+"api/forms-designer/multiresources").setMethod(EndPointMethod[EndPointMethod.POST]).setArguments([]).create()},new e}(),bizagi.editor.base.services.Manager=function(){function e(){}return e.prototype.requestRestService=function(e,t){if("undefined"!=typeof BIZAGI_EDITOR_TEST){var i=e.actiontype.toLowerCase();return promise=$.ajax({url:"jquery/editor/base/mocks/stub."+i+".json.txt",dataType:"json",async:!0}).pipe(function(e){return e}),promise}return $.ajax({url:t.getUrl(),data:JSON.stringify(e),type:t.getMethod(),contentType:"application/json; charset=utf-8",dataType:"json"})},new e}(),bizagi.editor.base.services.resourcesServices=function(){function e(){this._managerServices=bizagi.editor.base.services.Manager,this._endPointHelper=bizagi.editor.base.services.EndPointsHelper,this.batch={},this.batchTimer=50}return e.prototype.getResource=function(e){return this._managerServices.requestRestService(e,this._endPointHelper.getResource()).done(function(e){return $.isArray(e)?e[0]:e})},e.prototype.getMultiResources=function(e){return this.addResource(e)},e.prototype.addResource=function(e){var t=this,i=new $.Deferred;clearTimeout(t.batchTimeout);var o=e.tag=Math.guid(),r={request:e,deferred:i};return t.batch[o]=r,t.batchTimeout=setTimeout(function(){t.fire()},t.batchTimer),i.promise()},e.prototype.fire=function(){var e={},t=new $.Deferred,i=[];return $.each(this.batch,function(t,o){i.push(o),e[t]=o}),this.batch={},this._managerServices.requestRestService(i,this._endPointHelper.getMultiResources()).done(function(t){$.each(t,function(t,i){var o=i.response,r=o.tag;o.error?e[r].deferred.reject(o.error):e[r].deferred.resolve(o),delete e[r]})}),t.promise()},new e}(),bizagi.editor.wizard.base("bizagi.editor.wizard.searchlist",{init:function(e,t){t=t||{},this._super(e,t),this.canvas=e,this.presenter=t.presenter,this.model=new bizagi.editor.wizard.searchlist.model(t.model,t.gridContextXpath)},loadTemplates:function(){var e={"wizard-container":bizagi.getTemplate("bizagi.editor.wizard.searchlist")+"#wizard-container-searchlist"};return this._super(e)},renderWizard:function(){var e=this,t=e.element;t.empty(),$.when(e.loadTemplates()).done(function(){var i=e.getTemplate("wizard-container");$.tmpl(i,e.model.getViewModel()).appendTo(t)})},refresh:function(){this.render()},updateProperty:function(e,t,i){return this.model.updateProperty(e,t,i)},getFilterProperty:function(e){return this.model.getFilter(e)},getFilterTypes:function(e){return this.model.getFilterTypes(e)},getRelatedEntity:function(e){return this.model.getRelatedEntity(e)},getPropertyValue:function(e){return this.model.getPropertyValue(e)},processFinishButton:function(){var e=this;e.model.isValid()?$.when(e.relationshipIsValid()).done(function(t){t.isValid?e.presenter.closePopup({success:!0,model:e.model.getPersistenceModel(t)}):bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-searchlist-invalidrelationship"),"Bizagi","error",!1)}):bizagi.showMessageBox(bizagi.localization.getResource("bizagi-editor-wizard-searchlist-invalidmodel"),"Bizagi","error",!1)},getOffsetElement:function(e){var t=e.offset();return{top:t.top+e.outerHeight(!0),left:t.left}},buildComplexXpath:function(e){return bizagi.editor.utilities.buildComplexXpath(e.xpath,e.contextScope,e.isScopeAttribute,e.guidRelatedEntity)},resolveComplexXpath:function(e){return bizagi.editor.utilities.resolveComplexXpath(e)},clearPropertyValue:function(e){var t=e.data("property");this.updateProperty(void 0,"",t),this.refresh()},getMultipleRelationship:function(e){var t=new $.Deferred;return $.when(this.presenter.publish("getMultipleRelationship",e)).done(function(e){t.resolve()}),t.promise()},relationshipIsValid:function(){var e=new $.Deferred,t=(bizagi.editor.utilities.resolveRelatedEntityFromXpath(this.getPropertyValue("leftxpath")),bizagi.editor.utilities.resolveRelatedEntityFromXpath(this.getPropertyValue("rightxpath")));return $.when(this.presenter.publish("getMultipleRelationship",{leftEntity:this.getPropertyValue("leftxpath"),rightEntity:this.getPropertyValue("rightxpath")})).done(function(i){if(i)for(var o=i.leftfact,r=0,n=o.length;r<n;r++){var a=o[r];if(a.RightEntity==t){e.resolve({isValid:!0,factxpath:a.CatalogName,leftfactname:a.CatalogName});break}}else e.resolve(!1);e.resolve(!1)}),e.promise()},".bizagi_editor_component_editor_xpath .bz-wizard-searchlist-editor-xpath click":function(e){var t=this,i=e.prev("input"),o=e.data("property"),r={};r.position=t.getOffsetElement(i,r);var n=void 0;t.getFilterProperty(o)&&((n={}).typeFilter=t.getFilterProperty(o),r.typeEditor=n.typeFilter,t.getFilterTypes(o)&&(n.types=t.getFilterTypes(o))),r.filter=n,r.entity=t.resolveComplexXpath(t.getRelatedEntity(o)),r.xpath=t.resolveComplexXpath(t.getPropertyValue(o)),r.xpathProperty=o,r.allowCollection=!0,$.when(t.presenter.publish("showXPathNavigatorEditor",r)).done(function(e){var i=t.buildComplexXpath(e);t.updateProperty(i,t.resolveComplexXpath(i),o),t.refresh()})},".filter-searchList-mainDiv-value click":function(e){var t=this,i=e.data("property"),o=t.getPropertyValue(i),r={};r.data=o&&o.bafilter?o:{bafilter:{filter:"filter"}},r.entity=t.resolveComplexXpath(t.getRelatedEntity(i)),r.xpathNode=t.presenter.publish("getXpathData",{xpath:r.entity}),r.protocol="loadfilter";var n=bizagi.editor.communicationprotocol.factory.createProtocol(r);$.when(n.processRequest()).done(function(e){if(e){var o=e.isEmpty?void 0:bizagi.editor.utilities.buildComplexFilter(e,r.xpathNode);t.updateProperty(o,e,i),t.refresh()}})},".filter-searchList-mainDiv-rule click":function(e){var t=this,i=e.data("property"),o=t.getPropertyValue(i),r={};r.data=o&&o.rule?o:{rule:{baref:{ref:"expression"}}},r.categorytype="scripting",r.protocol="ruleexpression";var n=bizagi.editor.communicationprotocol.factory.createProtocol(r);$.when(n.processRequest()).done(function(e){e&&(t.updateProperty(e,e.rule.displayName,i),t.refresh())})},".filter-searchList-mainDiv-delete click":function(e){this.clearPropertyValue(e)},".biz-ico-default click":function(e){this.clearPropertyValue(e)},".editor-localizablestring-input input blur":function(e){var t=e.val(),i=e.data("property"),o=this.getPropertyValue(i),r=e.next(".editor-localizablestring-localization"),n=e.parent();if(r.removeClass("ui-control-fadeIn"),n.toggleClass("ui-control-focus"),t.length>0){if(bizagi.editor.utilities.isObject(o)){var a=bizagi.editorLanguage.key;"default"===a?o.i18n.default=t:o.i18n.languages[a]=t,t=o}else t=bizagi.editor.utilities.buildComplexLocalizable(t,this.model.getElementGuid(),i);this.updateProperty(t,bizagi.editor.utilities.resolvei18n(t),i),this.refresh()}},".editor-localizablestring-input input focus":function(e){var t=e.next(".editor-localizablestring-localization"),i=e.prev('input[type="text"]').parent();t.addClass("ui-control-fadeIn"),i.toggleClass("ui-control-focus")},".editor-localizablestring-input .editor-localizablestring-localization mouseenter":function(e){e.addClass("editor_localizablestring_fadeIn")},".editor-localizablestring-input .editor-localizablestring-localization mouseleave":function(e){e.removeClass("editor_localizablestring_fadeIn")},".editor-localizablestring-localization click":function(e){var t=this,i=e.prev("input").data("property"),o=t.getPropertyValue(i),r=t.model.getElementGuid();$.when(t.presenter.publish("setLocalization",{propertyName:i,propertyValue:o,elementGuid:r})).done(function(e){t.updateProperty(e,bizagi.editor.utilities.resolvei18n(e),i),t.refresh()})}}),bizagi.editor.observableClass.extend("bizagi.editor.wizard.searchlist.model",{},{init:function(e,t){e=e||{},this.elementGuid=e.guid||Math.guid(),this.data=e,this.leftProperties={},this.rightProperties={},this.properties={},this.xpathProperty=null,this.gridContextXpath=t,this.processData(e)},processData:function(e){for(var t=this.getLeftPropertiesModel(),i=this.getRightPropertiesModel(),o=0,r=t.length;o<r;o++){var n=t[o],a=n.value,s=n.displayValue;n.value=a||e[n.property],n.displayValue=s||this.getDisplayValue(n),this.leftProperties[n.property]=n,this.properties[n.property]=n}for(o=0,r=i.length;o<r;o++){var l=i[o];l.value=e[l.property],l.displayValue=this.getDisplayValue(l),this.rightProperties[l.property]=l,this.properties[l.property]=l}},getDisplayValue:function(e){if(e.value){if("xpatheditor"==e.editor)return bizagi.editor.utilities.resolveComplexXpath(e.value);if("filter"==e.editor)return bizagi.editor.utilities.resolvefilterExpression(e.value);if("localizable"==e.editor)return bizagi.editor.utilities.resolvei18n(e.value)}},updateProperty:function(e,t,i){var o=this.properties[i];o&&(o.value=e,o.displayValue=t,this.cleanProperties(i))},cleanProperties:function(e){if("leftxpath"==e)for(var t=this.getLeftPropertiesModel(),i=1,o=t.length;i<o;i++){var r=t[i];this.leftProperties[r.property].value=null,this.leftProperties[r.property].displayValue=null}else if("rightxpath"==e){var n=this.getRightPropertiesModel();for(i=1,o=n.length;i<o;i++){var a=n[i];this.rightProperties[a.property].value=null,this.rightProperties[a.property].displayValue=null}}},update:function(e){this.processModel(e)},getFilter:function(e){var t=this.properties[e];return t?t.filterBy:""},getFilterTypes:function(e){var t=this.properties[e];return t?t.types:null},getRelatedEntity:function(e){var t=this.properties[e];return t?this.getPropertyValue(t.entity):null},getEntity:function(e){var t=this.properties[e];return t?t.entity:null},getPropertyValue:function(e){var t=this.properties[e];return t?t.value:null},getProperty:function(e){return this.properties[e]},getElementGuid:function(){return this.elementGuid},updateDependencies:function(){var e=bizagi.util.isEmpty(this.getPropertyValue("leftxpath"));for(var t in this.leftProperties)"leftxpath"!=t&&(this.leftProperties[t].readonly=e);var i=bizagi.util.isEmpty(this.getPropertyValue("rightxpath"));for(var o in this.rightProperties)"rightxpath"!=o&&(this.rightProperties[o].readonly=i)},isValid:function(){for(var e in this.properties)if(this.properties[e].required&&!this.properties[e].value)return!1;return!0},getViewModel:function(){return this.updateDependencies(),{leftProperties:this.getViewLeftPropertiesModel(),rightProperties:this.getViewRightPropertiesModel()}},getViewLeftPropertiesModel:function(){var e=[];for(var t in this.leftProperties)e.push(this.leftProperties[t]);return e},getViewRightPropertiesModel:function(){var e=[];for(var t in this.rightProperties)e.push(this.rightProperties[t]);return e},getLeftPropertiesModel:function(){var e=[];return e.push({property:"leftxpath",value:null,editor:"xpatheditor",filterBy:"xpathtoentity",readonly:!1,displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-leftxpath")}),e},getRightPropertiesModel:function(){var e=[];return e.push({property:"rightxpath",value:null,readonly:!1,editor:"xpatheditor",filterBy:"xpathtocollection",displayValue:null,required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightxpath")}),e.push({property:"rightdisplayattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",required:!0,title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightdisplayattrib")}),e.push({property:"rightadditionalattrib",value:null,editor:"xpatheditor",filterBy:"xpathfromentity",types:["string","number","date","boolean"],readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightadditionalattrib")}),e.push({property:"rightfilter",value:null,editor:"filter",readonly:!0,displayValue:null,entity:"rightxpath",title:bizagi.localization.getResource("bizagi-editor-wizard-searchlist-editor-rightfilter")}),e},getPersistenceModel:function(e){var t={};for(var i in this.properties)this.properties[i].value&&(t[i]=this.properties[i].value);return t.factxpath=e.factxpath,t.guid=this.getElementGuid(),t.leftfactname=e.leftfactname,t.rightfactname=e.rightfactname,t}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.form=void 0!==bizagi.form?bizagi.form:{},bizagi.form.modeler=void 0!==bizagi.form.modeler?bizagi.form.modeler:{},bizagi.form.modeler.initialize=function(e){e=e||{},BIZAGI_LANGUAGE=e.language||"default",BIZAGI_ENVIRONMENT="release",BIZAGI_ENABLE_LOG=void 0===e.enableLog||e.enableLog,BIZAGI_ENABLE_CUSTOMIZATIONS=!1,BIZAGI_DEFAULT_DATETIME_INFO=!1,BIZAGI_URL_REST_SERVICES=e.urlRestServices||"http://localhost:3333/",BIZAGI_USER=e.user||"",BIZAGI_IDENTIFIER_MODEL=e.idModel||"";var t=bizagi.loader;t.init(function(){t.start("formModeler").then(function(){bizagi.util.loadFile({src:bizagi.getStyleSheet("bizagi.overrides.formmodeler.custom.styles"),type:"css"})})})},bizagi.form.modeler.instance=null,bizagi.form.modeler.createForm=function(e){var t="undefined"!=typeof $?new $.Deferred:null;return bizagi.loader.whenModuleLoaded("formModeler",function(){switch(bizagi.form.modeler.params=e,bizagi.form.modeler.params.reviewMode&&$("#wrapper-formdesigner").addClass("read-only-form-designer"),e.context){case"template":bizagi.form.modeler.instance=new bizagi.editor.templateView(e);break;case"adhocform":bizagi.form.modeler.instance=new bizagi.editor.adhocModelerView(e);break;default:bizagi.form.modeler.instance=new bizagi.editor.modelerView(e)}t&&t.resolve(bizagi.form.modeler.instance)}),t?t.promise():null},bizagi.form.modeler.saveForm=function(e){return e&&e.encode?bizagi.util.unicode2htmlencode(JSON.encode(bizagi.form.modeler.instance.save())):JSON.encode(bizagi.form.modeler.instance.save())},bizagi.form.modeler.updateForm=function(e){bizagi.form.modeler.instance.updateForm(e)},bizagi.form.modeler.validateAndSaveForm=function(){return JSON.encode(bizagi.form.modeler.instance.validateAndSaveForm())},bizagi.form.modeler.removeFormEvents=function(e){if(bizagi.form.modeler.instance)return bizagi.form.modeler.instance.removeFormEvents(e)},bizagi.editor=bizagi.editor||{},bizagi.editor.overrides={EnableCssClassProperty:{group:{properties:{disable:["cssclass"]}},tab:{properties:{disable:["cssclass"]}},columncombo:{properties:{disable:["cssclass"]}},columndate:{properties:{disable:["cssclass"]}},columnboolean:{properties:{disable:["cssclass"]}},columnbutton:{properties:{disable:["cssclass"]}},columndocument:{properties:{disable:["cssclass"]}},columnformlink:{properties:{disable:["cssclass"]}},columnimage:{properties:{disable:["cssclass"]}},columnlabel:{properties:{disable:["cssclass"]}},columnletter:{properties:{disable:["cssclass"]}},columnlink:{properties:{disable:["cssclass"]}},columnlist:{properties:{disable:["cssclass"]}},columnmoney:{properties:{disable:["cssclass"]}},columnnumber:{properties:{disable:["cssclass"]}},columnradio:{properties:{disable:["cssclass"]}},columnsearch:{properties:{disable:["cssclass"]}},columnsuggest:{properties:{disable:["cssclass"]}},columntext:{properties:{disable:["cssclass"]}},columnupload:{properties:{disable:["cssclass"]}},columnuploadecm:{properties:{disable:["cssclass"]}},association:{properties:{disable:["cssclass"]}},boolean:{properties:{disable:["cssclass"]}},cascadingcombo:{properties:{disable:["cssclass"]}},combo:{properties:{disable:["cssclass"]}},contentpanel:{properties:{disable:["cssclass"]}},date:{properties:{disable:["cssclass"]}},document:{properties:{disable:["cssclass"]}},fileprint:{properties:{disable:["cssclass"]}},formlink:{properties:{disable:["cssclass"]}},grid:{properties:{disable:["cssclass"]}},groupedgrid:{properties:{disable:["cssclass"]}},image:{properties:{disable:["cssclass"]}},label:{properties:{disable:["cssclass"]}},letter:{properties:{disable:["cssclass"]}},link:{properties:{disable:["cssclass"]}},list:{properties:{disable:["cssclass"]}},money:{properties:{disable:["cssclass"]}},nestedform:{properties:{disable:["cssclass"]}},number:{properties:{disable:["cssclass"]}},panel:{properties:{disable:["cssclass"]}},radio:{properties:{disable:["cssclass"]}},search:{properties:{disable:["cssclass"]}},suggest:{properties:{disable:["cssclass"]}},tabitem:{properties:{disable:["cssclass"]}},text:{properties:{disable:["cssclass"]}},upload:{properties:{disable:["cssclass"]}},uploadecm:{properties:{disable:["cssclass"]}}}},bizagi.editor.modelerView.extend("bizagi.editor.templateView",{},{init:function(e){this._super(e)},load:function(e){var t=this;$.when(this.controller.ready()).done(function(){t.executeCommand({command:"loadModel",dataModel:e,canUndo:!1})})},save:function(){var e={command:"saveModel",dataModel:{},canUndo:!1};return this.executeCommand(e),e.dataModel},validateAndSaveForm:function(){this.performSave(!0)},updateForm:function(e){var t;t={command:"updateModel",data:e,canUndo:!1},this.executeCommand(t)},setOriginalModel:function(){var e=this;$.when(this.controller.ready()).done(function(){e.controller.setOriginalModel()})},processLayout:function(e){var t=this,i=new $.Deferred;t.mainContainer=$("<form-modeler />").addClass("container-layout"),t.mainContainer.appendTo(e.canvas||"body"),t.configureHtmlPage();var o=new bizagi.editor.component.layout.presenter({canvas:t.mainContainer,context:e.context,isActivityForm:e.isActivityForm});return $.when(o.render()).done(function(){setTimeout(function(){t.configureLeftPane(),t.drawRibbon(),t.configureTemplateView(),i.resolve()},100)}),i.promise()},configureHtmlPage:function(){this.mainContainer.addClass("biz-template-editor"),this.mainContainer.addClass("biz-text-color"),$("body").attr("oncontextmenu","return false")},configureLeftPane:function(){var e=this;$.when(e.drawXpathNavigator()).done(function(){e.mainContainer.find(".left-panel").tabs({}),e.mainContainer.find(".left-panel li[tabindex]:gt(0)").remove()})},configureKeyHandlers:function(){var e=this;$(document).keydown(function(e){}).keyup(function(t){46===t.keyCode&&($(document.activeElement).is("input, textarea")||e.deleteElement())}),$(document).on("keydown",function(t){17==t.keyCode&&e.controller.setCtrlKey(!0)}),$(document).on("keyup",function(t){e.controller.isCtrlKeyPressed()&&e.controller.setCtrlKey(!1)})},needsRedrawAfterTabChange:function(e){return this.currentTabIndex<2&&2===e||2===this.currentTabIndex&&e<2},setBannerVisibility:function(e){"show"===(e?$("a",e.newTab).attr("data-banner"):"hide")?this.showBanner():this.hideBanner()},preRender:function(e){this.validateForm&&e.canValidate&&this.processTemplateValidations({canRefresh:!1})},render:function(e,t){this.renderTemplate(e,t)},postRender:function(){var e=null;this.controller.thereAreMultiselection()&&(e=bizagi.editor.utilities.getGuidEmpty()),this.refreshRibbon(e)},refreshCanvas:function(){var e,t,i,o,r;e=$("#main-panel"),t=$(".wrapper-main-scroll"),i=$("> .bz-design-template",e),o=$(".top-scroll-grad",t),r=$(".bottom-scroll-grad",t);var n=parseFloat(e.css("padding-top"))+parseFloat(e.css("padding-bottom")),a=Math.floor(1*t.height()-n),s=t.position().top,l=t.position().top+t.outerHeight(!0)-r.height();i.prop("scrollHeight")>a?(e.addClass("biz-auto-height"),r.css("top",l).css("width",t.width()),r.show(),o.css("top",s).css("width",t.width()),o.show()):(r.hide(),o.hide(),e.removeClass("biz-auto-height")),e.hasClass("biz-auto-height")&&($(".top-scroll-grad",t).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollTopInterval(t,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}),$(".bottom-scroll-grad",t).mouseover(function(){bizagi.util.autoScrollInterval.init||bizagi.util.autoScrollBottomInterval(t,"panelOver","scrollGrad")}).mouseleave(function(){bizagi.util.autoScrollInterval.init||bizagi.util.removeAutoScroll("panelOver","scrollGrad")}))},renderTemplate:function(e,t){this.showRenderingModel()},renderForm:function(e,t){var i=this,o=$("#main-panel");i.refreshRenderingView(e,t),i.controller.isActivityForm()&&(i.refreshButtonEditor(),"design"==i.renderingMode&&o.on("widgetComplete",function(){i.refreshCanvas()}),i.refreshCanvas())},renderSearchForm:function(e){this.refreshRenderingView(e),this.refreshSearchFormResult()},renderGridColumnEditor:function(){this.refreshGridColumnEditor()},enableLayoutTab:function(){this.mainContainer.find(".left-panel").tabs("option","disabled",[])},disableLayoutTab:function(){this.mainContainer.find(".left-panel").tabs("option","disabled",[2])}}),bizagi.editor.modelerView.extend("bizagi.editor.adhocModelerView",{},{init:function(e){var t=this;t.initializeForm(e),t.formModelerParams=e,e=e||{},t.renderingMode="design",t.validateForm=!1,bizagi.editor.view.prototype.init.apply(this,[e]),t.currentTabIndex=0,bizagi.editorLanguage={displayname:"default",IsRightToLeft:!1,key:"default"},e.data?$.when(t.load(e.data),this.controller.ready()).done(function(){t.processLayout(e)}):$.when(this.controller.ready()).done(function(){t.processLayout(e)}),e.autoGenerate&&t.autoGenerate(),t.setOriginalModel(),t.applyCustomOverrides()},configureLeftPane:function(){bizagi.form.modeler.params.reviewMode?this.showTabPropertiesInModeReadOnly():this.showAllTabs()},showTabPropertiesInModeReadOnly:function(){var e=this;$.when(e.drawXpathNavigator()).done(function(){e.mainContainer.find(".left-panel").tabs({beforeActivate:function(t,i){var o=$("a",i.newTab).data("rendering-mode");e.hidePropertyBox(),e.needsRedrawAfterTabChange(i.newTab.index())&&(e.currentSelectedElement=null,e.controller.removeSelectedElement(),e.renderingMode=o,e.render(o)),e.currentTabIndex=i.newTab.index(),e.setBannerVisibility(i),e.mainContainer.find(".bizagi_editor_xpathnavigator_container").css("pointer-events","none")}})})},showAllTabs:function(){var e=this;$.when(e.drawControlsNavigator(),e.drawXpathNavigator(),e.drawLayoutNavigator(),e.drawBanner()).done(function(){e.mainContainer.find(".left-panel").tabs({beforeActivate:function(t,i){var o=$("a",i.newTab).data("rendering-mode");e.hidePropertyBox(),e.needsRedrawAfterTabChange(i.newTab.index())&&(e.currentSelectedElement=null,e.controller.removeSelectedElement(),e.renderingMode=o,e.render(o)),e.currentTabIndex=i.newTab.index(),e.setBannerVisibility(i)}}),!e.controller.isAdhocFormContext()||!e.formModelerParams.data||e.formModelerParams.data.elements&&0!==e.formModelerParams.data.elements.length||e.selectControlsTab(),e.setBannerVisibility()})},configureHtmlPage:function(e){(this.adhocCanvas=e.canvas).addClass("biz-work-area"),$("body").attr("oncontextmenu","return false")},drawPropertyBox:function(e){var t=this;t.propertyBox&&t.hidePropertyBox(),t.redrawPropertyBox=!!e.redraw&&e.redraw,t.formModelerParams?t.propertyBox=new bizagi.editor.component.properties.presenter({adhocProcessId:t.formModelerParams.adhocProcessId}):t.propertyBox=new bizagi.editor.component.properties.presenter,t.propertyBox.subscribe("propertyChanged",function(e,i){return t.onPropertiesChanged(i)}),t.propertyBox.subscribe("getRenderElement",function(e,i){return t.onGetRenderElement(i)}),t.propertyBox.subscribe("destroy",function(e,i){t.hidePropertyBox(i)}),t.editorValidations={},t.guid=e.guid||t.currentSelectedElement,t.formProperties=!(!e||!e.formProperties),t.refreshPropertyBox()},showElementXpath:function(e){},selectControlsTab:function(){$('.ui-tabs-nav[role="tablist"] a[href="#left-tab-minitoolbar"]').trigger("click")},saveForm:function(){var e=this,t=$.Deferred(),i=e.getMainContainer();return $.when(e.executeCommand({command:"saveModel"})).done(function(o){var r={message:bizagi.localization.getResource("formmodeler-component-wait-message-save")},n=new bizagi.editor.component.wait.presenter({model:r,renderArea:i});$.when(n.render()).done(function(){var i=bizagi.editor.communicationprotocol.factory.createProtocol({protocol:"saveform",jsonForm:o,adhocTaskId:e.formModelerParams.adhocTaskId,adhocProcessId:e.formModelerParams.adhocProcessId,isAdhocSummaryForm:!!e.formModelerParams.isAdhocSummaryForm});setTimeout(function(){$.when(i.processRequest()).done(function(){e.controller.setNewForm(!1),e.controller.setOriginalModel(),e.refreshRibbon(),e.refreshPropertyBox(),$.when(e.controller.getXpathNavigatorFromServer()).done(function(){e.refreshXpathNavigator()}),t.resolve()}).fail(function(){t.reject()}).always(function(){n.destroy()})},200)})}),t.promise()},load:function(e){var t=this;return $.when(this.controller.ready()).done(function(){t.executeCommand({command:"loadModel",dataModel:e,canUndo:!1,refresh:!0})})},applyCustomOverrides:function(){bizagi.editor.component.properties.commands.allowdecimals.prototype.execute=function(){},bizagi.editor.component.properties.commands.numberrange.prototype.execute=function(){this.indexedProperty.notShow=!1},bizagi.editor.component.properties.commands.thousands.prototype.execute=function(){},bizagi.editor.component.properties.commands.defaultvalue.prototype.execute=function(){this.indexedProperty.notShow=!1},bizagi.editor.component.properties.commands.data.displayattrib.prototype.execute=function(){var e=this;e.element.properties.data.datasource&&"bizagi"===e.element.properties.data.datasource.type?(e.properties.data.displayattrib&&e.properties.data.displayattrib.xpath&&e.properties.data.displayattrib.xpath.baxpath&&e.properties.data.datasource.guid!==e.properties.data.displayattrib.xpath.baxpath.contextentity&&(e.element.properties.data.displayattrib=void 0),e.indexedProperty.show=!0):(e.element.properties.data.displayattrib=void 0,e.indexedProperty.show=!1)},bizagi.editor.component.properties.commands.data.sortattribute.prototype.execute=function(){var e=this;e.element.properties.data.datasource&&"bizagi"===e.element.properties.data.datasource.type?(e.properties.data.sortattribute&&e.properties.data.sortattribute.xpath&&e.properties.data.sortattribute.xpath.baxpath&&e.properties.data.datasource.guid!==e.properties.data.sortattribute.xpath.baxpath.contextentity&&(e.element.properties.data.sortattribute=void 0),e.indexedProperty.show=!0):(e.element.properties.data.sortattribute=void 0,e.indexedProperty.show=!1)}},changeXpathPropertyForElement:function(e,t,i){if(void 0!==this.editorValidations[e]&&!this.validateXpathChange(e,t,i))return;var o={command:"changeProperty",guid:e,property:t,value:"adhoc"==i.data.entityContext?i.guid:bizagi.editor.utilities.buildComplexXpath(i.xpath,i.contextScope,i.isScopeAttribute,i.guidRelatedEntity),refreshProperties:!0,removeDefaultDisplayName:!0,renderTypeProperty:i.nodeSubtype,validateForm:this.validateForm};this.editorValidations[e]&&void 0!==this.editorValidations[e].exclusive&&(o=$.extend({},o,{exclusive:this.editorValidations[e].exclusive})),this.executeCommand(o)},initializeForm:function(e){e.data||(e.data={properties:{displayName:"AdhocForm_"+Math.guid()}})},refreshXpathNavigator:function(e){var t=this;t.controller.isGridContext()?$.when(t.executeCommand({command:"getAdhocXpathNavigatorModel"})).done(function(i){t.controller.setXpathNavigatorModelGrid(i);var o={model:e&&e.model||i,context:e?e.context:void 0,scope:t.controller.getContext(),isReadOnly:t.controller.isReadOnlyForm()};t.xpathNavigator.render(o)}):t._super(e)}});
//# sourceMappingURL=../../../../Maps/desktop/formmodeller.production.js.map
// 4.1.6 (2014-10-08) @notMinified 
!function (e, t) { "use strict"; function n(e, t) { for (var n, r = [], i = 0; i < e.length; ++i) { if (n = s[e[i]] || o(e[i]), !n) throw "module definition dependecy not found: " + e[i]; r.push(n) } t.apply(null, r) } function r(e, r, i) { if ("string" != typeof e) throw "invalid module definition, module id must be defined and be a string"; if (r === t) throw "invalid module definition, dependencies must be specified"; if (i === t) throw "invalid module definition, definition function must be specified"; n(r, function () { s[e] = i.apply(null, arguments) }) } function i(e) { return !!s[e] } function o(t) { for (var n = e, r = t.split(/[.\/]/), i = 0; i < r.length; ++i) { if (!n[r[i]]) return; n = n[r[i]] } return n } function a(n) { for (var r = 0; r < n.length; r++) { for (var i = e, o = n[r], a = o.split(/[.\/]/), l = 0; l < a.length - 1; ++l) i[a[l]] === t && (i[a[l]] = {}), i = i[a[l]]; i[a[a.length - 1]] = s[o] } } var s = {}, l = "tinymce/dom/EventUtils", c = "tinymce/dom/Sizzle", u = "tinymce/util/Tools", d = "tinymce/Env", f = "tinymce/dom/DomQuery", p = "tinymce/html/Styles", h = "tinymce/dom/TreeWalker", m = "tinymce/dom/Range", g = "tinymce/html/Entities", v = "tinymce/dom/StyleSheetLoader", y = "tinymce/dom/DOMUtils", b = "tinymce/dom/ScriptLoader", C = "tinymce/AddOnManager", x = "tinymce/dom/RangeUtils", w = "tinymce/NodeChange", _ = "tinymce/html/Node", E = "tinymce/html/Schema", N = "tinymce/html/SaxParser", k = "tinymce/html/DomParser", S = "tinymce/html/Writer", T = "tinymce/html/Serializer", R = "tinymce/dom/Serializer", A = "tinymce/dom/TridentSelection", B = "tinymce/util/VK", D = "tinymce/dom/ControlSelection", L = "tinymce/dom/BookmarkManager", H = "tinymce/dom/Selection", M = "tinymce/dom/ElementUtils", P = "tinymce/fmt/Preview", O = "tinymce/Formatter", I = "tinymce/UndoManager", F = "tinymce/EnterKey", z = "tinymce/ForceBlocks", W = "tinymce/EditorCommands", V = "tinymce/util/URI", U = "tinymce/util/Class", $ = "tinymce/util/EventDispatcher", q = "tinymce/ui/Selector", j = "tinymce/ui/Collection", Y = "tinymce/ui/DomUtils", K = "tinymce/ui/Control", G = "tinymce/ui/Factory", X = "tinymce/ui/KeyboardNavigation", J = "tinymce/ui/Container", Q = "tinymce/ui/DragHelper", Z = "tinymce/ui/Scrollable", et = "tinymce/ui/Panel", tt = "tinymce/ui/Movable", nt = "tinymce/ui/Resizable", rt = "tinymce/ui/FloatPanel", it = "tinymce/ui/Window", ot = "tinymce/ui/MessageBox", at = "tinymce/WindowManager", st = "tinymce/util/Quirks", lt = "tinymce/util/Observable", ct = "tinymce/EditorObservable", ut = "tinymce/Shortcuts", dt = "tinymce/Editor", ft = "tinymce/util/I18n", pt = "tinymce/FocusManager", ht = "tinymce/EditorManager", mt = "tinymce/LegacyInput", gt = "tinymce/util/XHR", vt = "tinymce/util/JSON", yt = "tinymce/util/JSONRequest", bt = "tinymce/util/JSONP", Ct = "tinymce/util/LocalStorage", xt = "tinymce/Compat", wt = "tinymce/ui/Layout", _t = "tinymce/ui/AbsoluteLayout", Et = "tinymce/ui/Tooltip", Nt = "tinymce/ui/Widget", kt = "tinymce/ui/Button", St = "tinymce/ui/ButtonGroup", Tt = "tinymce/ui/Checkbox", Rt = "tinymce/ui/ComboBox", At = "tinymce/ui/ColorBox", Bt = "tinymce/ui/PanelButton", Dt = "tinymce/ui/ColorButton", Lt = "tinymce/util/Color", Ht = "tinymce/ui/ColorPicker", Mt = "tinymce/ui/Path", Pt = "tinymce/ui/ElementPath", Ot = "tinymce/ui/FormItem", It = "tinymce/ui/Form", Ft = "tinymce/ui/FieldSet", zt = "tinymce/ui/FilePicker", Wt = "tinymce/ui/FitLayout", Vt = "tinymce/ui/FlexLayout", Ut = "tinymce/ui/FlowLayout", $t = "tinymce/ui/FormatControls", qt = "tinymce/ui/GridLayout", jt = "tinymce/ui/Iframe", Yt = "tinymce/ui/Label", Kt = "tinymce/ui/Toolbar", Gt = "tinymce/ui/MenuBar", Xt = "tinymce/ui/MenuButton", Jt = "tinymce/ui/ListBox", Qt = "tinymce/ui/MenuItem", Zt = "tinymce/ui/Menu", en = "tinymce/ui/Radio", tn = "tinymce/ui/ResizeHandle", nn = "tinymce/ui/Spacer", rn = "tinymce/ui/SplitButton", on = "tinymce/ui/StackLayout", an = "tinymce/ui/TabPanel", sn = "tinymce/ui/TextBox", ln = "tinymce/ui/Throbber"; r(l, [], function () { function e(e, t, n, r) { e.addEventListener ? e.addEventListener(t, n, r || !1) : e.attachEvent && e.attachEvent("on" + t, n) } function t(e, t, n, r) { e.removeEventListener ? e.removeEventListener(t, n, r || !1) : e.detachEvent && e.detachEvent("on" + t, n) } function n(e, t) { function n() { return !1 } function r() { return !0 } var i, o = t || {}, l; for (i in e) s[i] || (o[i] = e[i]); if (o.target || (o.target = o.srcElement || document), e && a.test(e.type) && e.pageX === l && e.clientX !== l) { var c = o.target.ownerDocument || document, u = c.documentElement, d = c.body; o.pageX = e.clientX + (u && u.scrollLeft || d && d.scrollLeft || 0) - (u && u.clientLeft || d && d.clientLeft || 0), o.pageY = e.clientY + (u && u.scrollTop || d && d.scrollTop || 0) - (u && u.clientTop || d && d.clientTop || 0) } return o.preventDefault = function () { o.isDefaultPrevented = r, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1) }, o.stopPropagation = function () { o.isPropagationStopped = r, e && (e.stopPropagation ? e.stopPropagation() : e.cancelBubble = !0) }, o.stopImmediatePropagation = function () { o.isImmediatePropagationStopped = r, o.stopPropagation() }, o.isDefaultPrevented || (o.isDefaultPrevented = n, o.isPropagationStopped = n, o.isImmediatePropagationStopped = n), o } function r(n, r, i) { function o() { i.domLoaded || (i.domLoaded = !0, r(c)) } function a() { ("complete" === l.readyState || "interactive" === l.readyState && l.body) && (t(l, "readystatechange", a), o()) } function s() { try { l.documentElement.doScroll("left") } catch (e) { return void setTimeout(s, 0) } o() } var l = n.document, c = { type: "ready" }; return i.domLoaded ? void r(c) : (l.addEventListener ? "complete" === l.readyState ? o() : e(n, "DOMContentLoaded", o) : (e(l, "readystatechange", a), l.documentElement.doScroll && n.self === n.top && s()), void e(n, "load", o)) } function i() { function i(e, t) { var n, r, i, o, a = s[t]; if (n = a && a[e.type]) for (r = 0, i = n.length; i > r; r++) if (o = n[r], o && o.func.call(o.scope, e) === !1 && e.preventDefault(), e.isImmediatePropagationStopped()) return } var a = this, s = {}, l, c, u, d, f; c = o + (+new Date).toString(32), d = "onmouseenter" in document.documentElement, u = "onfocusin" in document.documentElement, f = { mouseenter: "mouseover", mouseleave: "mouseout" }, l = 1, a.domLoaded = !1, a.events = s, a.bind = function (t, o, p, h) { function m(e) { i(n(e || _.event), g) } var g, v, y, b, C, x, w, _ = window; if (t && 3 !== t.nodeType && 8 !== t.nodeType) { for (t[c] ? g = t[c] : (g = l++, t[c] = g, s[g] = {}), h = h || t, o = o.split(" "), y = o.length; y--; ) b = o[y], x = m, C = w = !1, "DOMContentLoaded" === b && (b = "ready"), a.domLoaded && "ready" === b && "complete" == t.readyState ? p.call(h, n({ type: b })) : (d || (C = f[b], C && (x = function (e) { var t, r; if (t = e.currentTarget, r = e.relatedTarget, r && t.contains) r = t.contains(r); else for (; r && r !== t; ) r = r.parentNode; r || (e = n(e || _.event), e.type = "mouseout" === e.type ? "mouseleave" : "mouseenter", e.target = t, i(e, g)) })), u || "focusin" !== b && "focusout" !== b || (w = !0, C = "focusin" === b ? "focus" : "blur", x = function (e) { e = n(e || _.event), e.type = "focus" === e.type ? "focusin" : "focusout", i(e, g) }), v = s[g][b], v ? "ready" === b && a.domLoaded ? p({ type: b }) : v.push({ func: p, scope: h }) : (s[g][b] = v = [{ func: p, scope: h}], v.fakeName = C, v.capture = w, v.nativeHandler = x, "ready" === b ? r(t, x, a) : e(t, C || b, x, w))); return t = v = 0, p } }, a.unbind = function (e, n, r) { var i, o, l, u, d, f; if (!e || 3 === e.nodeType || 8 === e.nodeType) return a; if (i = e[c]) { if (f = s[i], n) { for (n = n.split(" "), l = n.length; l--; ) if (d = n[l], o = f[d]) { if (r) for (u = o.length; u--; ) if (o[u].func === r) { var p = o.nativeHandler, h = o.fakeName, m = o.capture; o = o.slice(0, u).concat(o.slice(u + 1)), o.nativeHandler = p, o.fakeName = h, o.capture = m, f[d] = o } r && 0 !== o.length || (delete f[d], t(e, o.fakeName || d, o.nativeHandler, o.capture)) } } else { for (d in f) o = f[d], t(e, o.fakeName || d, o.nativeHandler, o.capture); f = {} } for (d in f) return a; delete s[i]; try { delete e[c] } catch (g) { e[c] = null } } return a }, a.fire = function (e, t, r) { var o; if (!e || 3 === e.nodeType || 8 === e.nodeType) return a; r = n(null, r), r.type = t, r.target = e; do o = e[c], o && i(r, o), e = e.parentNode || e.ownerDocument || e.defaultView || e.parentWindow; while (e && !r.isPropagationStopped()); return a }, a.clean = function (e) { var t, n, r = a.unbind; if (!e || 3 === e.nodeType || 8 === e.nodeType) return a; if (e[c] && r(e), e.getElementsByTagName || (e = e.document), e && e.getElementsByTagName) for (r(e), n = e.getElementsByTagName("*"), t = n.length; t--; ) e = n[t], e[c] && r(e); return a }, a.destroy = function () { s = {} }, a.cancel = function (e) { return e && (e.preventDefault(), e.stopImmediatePropagation()), !1 } } var o = "mce-data-", a = /^(?:mouse|contextmenu)|click/, s = { keyLocation: 1, layerX: 1, layerY: 1, returnValue: 1 }; return i.Event = new i, i.Event.bind(window, "ready", function () { }), i }), r(c, [], function () { function e(e, t, n, r) { var i, o, a, s, l, c, d, p, h, m; if ((t ? t.ownerDocument || t : z) !== D && B(t), t = t || D, n = n || [], !e || "string" != typeof e) return n; if (1 !== (s = t.nodeType) && 9 !== s) return []; if (H && !r) { if (i = vt.exec(e)) if (a = i[1]) { if (9 === s) { if (o = t.getElementById(a), !o || !o.parentNode) return n; if (o.id === a) return n.push(o), n } else if (t.ownerDocument && (o = t.ownerDocument.getElementById(a)) && I(t, o) && o.id === a) return n.push(o), n } else { if (i[2]) return Z.apply(n, t.getElementsByTagName(e)), n; if ((a = i[3]) && x.getElementsByClassName) return Z.apply(n, t.getElementsByClassName(a)), n } if (x.qsa && (!M || !M.test(e))) { if (p = d = F, h = t, m = 9 === s && e, 1 === s && "object" !== t.nodeName.toLowerCase()) { for (c = N(e), (d = t.getAttribute("id")) ? p = d.replace(bt, "\\$&") : t.setAttribute("id", p), p = "[id='" + p + "'] ", l = c.length; l--; ) c[l] = p + f(c[l]); h = yt.test(e) && u(t.parentNode) || t, m = c.join(",") } if (m) try { return Z.apply(n, h.querySelectorAll(m)), n } catch (g) { } finally { d || t.removeAttribute("id") } } } return S(e.replace(st, "$1"), t, n, r) } function n() { function e(n, r) { return t.push(n + " ") > w.cacheLength && delete e[t.shift()], e[n + " "] = r } var t = []; return e } function r(e) { return e[F] = !0, e } function i(e) { var t = D.createElement("div"); try { return !!e(t) } catch (n) { return !1 } finally { t.parentNode && t.parentNode.removeChild(t), t = null } } function o(e, t) { for (var n = e.split("|"), r = e.length; r--; ) w.attrHandle[n[r]] = t } function a(e, t) { var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || K) - (~e.sourceIndex || K); if (r) return r; if (n) for (; n = n.nextSibling; ) if (n === t) return -1; return e ? 1 : -1 } function s(e) { return function (t) { var n = t.nodeName.toLowerCase(); return "input" === n && t.type === e } } function l(e) { return function (t) { var n = t.nodeName.toLowerCase(); return ("input" === n || "button" === n) && t.type === e } } function c(e) { return r(function (t) { return t = +t, r(function (n, r) { for (var i, o = e([], n.length, t), a = o.length; a--; ) n[i = o[a]] && (n[i] = !(r[i] = n[i])) }) }) } function u(e) { return e && typeof e.getElementsByTagName !== Y && e } function d() { } function f(e) { for (var t = 0, n = e.length, r = ""; n > t; t++) r += e[t].value; return r } function p(e, t, n) { var r = t.dir, i = n && "parentNode" === r, o = V++; return t.first ? function (t, n, o) { for (; t = t[r]; ) if (1 === t.nodeType || i) return e(t, n, o) } : function (t, n, a) { var s, l, c = [W, o]; if (a) { for (; t = t[r]; ) if ((1 === t.nodeType || i) && e(t, n, a)) return !0 } else for (; t = t[r]; ) if (1 === t.nodeType || i) { if (l = t[F] || (t[F] = {}), (s = l[r]) && s[0] === W && s[1] === o) return c[2] = s[2]; if (l[r] = c, c[2] = e(t, n, a)) return !0 } } } function h(e) { return e.length > 1 ? function (t, n, r) { for (var i = e.length; i--; ) if (!e[i](t, n, r)) return !1; return !0 } : e[0] } function m(t, n, r) { for (var i = 0, o = n.length; o > i; i++) e(t, n[i], r); return r } function g(e, t, n, r, i) { for (var o, a = [], s = 0, l = e.length, c = null != t; l > s; s++) (o = e[s]) && (!n || n(o, r, i)) && (a.push(o), c && t.push(s)); return a } function v(e, t, n, i, o, a) { return i && !i[F] && (i = v(i)), o && !o[F] && (o = v(o, a)), r(function (r, a, s, l) { var c, u, d, f = [], p = [], h = a.length, v = r || m(t || "*", s.nodeType ? [s] : s, []), y = !e || !r && t ? v : g(v, f, e, s, l), b = n ? o || (r ? e : h || i) ? [] : a : y; if (n && n(y, b, s, l), i) for (c = g(b, p), i(c, [], s, l), u = c.length; u--; ) (d = c[u]) && (b[p[u]] = !(y[p[u]] = d)); if (r) { if (o || e) { if (o) { for (c = [], u = b.length; u--; ) (d = b[u]) && c.push(y[u] = d); o(null, b = [], c, l) } for (u = b.length; u--; ) (d = b[u]) && (c = o ? tt.call(r, d) : f[u]) > -1 && (r[c] = !(a[c] = d)) } } else b = g(b === a ? b.splice(h, b.length) : b), o ? o(null, a, b, l) : Z.apply(a, b) }) } function y(e) { for (var t, n, r, i = e.length, o = w.relative[e[0].type], a = o || w.relative[" "], s = o ? 1 : 0, l = p(function (e) { return e === t }, a, !0), c = p(function (e) { return tt.call(t, e) > -1 }, a, !0), u = [function (e, n, r) { return !o && (r || n !== T) || ((t = n).nodeType ? l(e, n, r) : c(e, n, r)) } ]; i > s; s++) if (n = w.relative[e[s].type]) u = [p(h(u), n)]; else { if (n = w.filter[e[s].type].apply(null, e[s].matches), n[F]) { for (r = ++s; i > r && !w.relative[e[r].type]; r++); return v(s > 1 && h(u), s > 1 && f(e.slice(0, s - 1).concat({ value: " " === e[s - 2].type ? "*" : "" })).replace(st, "$1"), n, r > s && y(e.slice(s, r)), i > r && y(e = e.slice(r)), i > r && f(e)) } u.push(n) } return h(u) } function b(t, n) { var i = n.length > 0, o = t.length > 0, a = function (r, a, s, l, c) { var u, d, f, p = 0, h = "0", m = r && [], v = [], y = T, b = r || o && w.find.TAG("*", c), C = W += null == y ? 1 : Math.random() || .1, x = b.length; for (c && (T = a !== D && a); h !== x && null != (u = b[h]); h++) { if (o && u) { for (d = 0; f = t[d++]; ) if (f(u, a, s)) { l.push(u); break } c && (W = C) } i && ((u = !f && u) && p--, r && m.push(u)) } if (p += h, i && h !== p) { for (d = 0; f = n[d++]; ) f(m, v, a, s); if (r) { if (p > 0) for (; h--; ) m[h] || v[h] || (v[h] = J.call(l)); v = g(v) } Z.apply(l, v), c && !r && v.length > 0 && p + n.length > 1 && e.uniqueSort(l) } return c && (W = C, T = y), m }; return i ? r(a) : a } var C, x, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I, F = "sizzle" + -new Date, z = window.document, W = 0, V = 0, U = n(), $ = n(), q = n(), j = function (e, t) { return e === t && (A = !0), 0 }, Y = typeof t, K = 1 << 31, G = {}.hasOwnProperty, X = [], J = X.pop, Q = X.push, Z = X.push, et = X.slice, tt = X.indexOf || function (e) { for (var t = 0, n = this.length; n > t; t++) if (this[t] === e) return t; return -1 }, nt = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", rt = "[\\x20\\t\\r\\n\\f]", it = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", ot = "\\[" + rt + "*(" + it + ")(?:" + rt + "*([*^$|!~]?=)" + rt + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + it + "))|)" + rt + "*\\]", at = ":(" + it + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + ot + ")*)|.*)\\)|)", st = new RegExp("^" + rt + "+|((?:^|[^\\\\])(?:\\\\.)*)" + rt + "+$", "g"), lt = new RegExp("^" + rt + "*," + rt + "*"), ct = new RegExp("^" + rt + "*([>+~]|" + rt + ")" + rt + "*"), ut = new RegExp("=" + rt + "*([^\\]'\"]*?)" + rt + "*\\]", "g"), dt = new RegExp(at), ft = new RegExp("^" + it + "$"), pt = { ID: new RegExp("^#(" + it + ")"), CLASS: new RegExp("^\\.(" + it + ")"), TAG: new RegExp("^(" + it + "|[*])"), ATTR: new RegExp("^" + ot), PSEUDO: new RegExp("^" + at), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + rt + "*(even|odd|(([+-]|)(\\d*)n|)" + rt + "*(?:([+-]|)" + rt + "*(\\d+)|))" + rt + "*\\)|)", "i"), bool: new RegExp("^(?:" + nt + ")$", "i"), needsContext: new RegExp("^" + rt + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + rt + "*((?:-\\d)?\\d*)" + rt + "*\\)|)(?=[^-]|$)", "i") }, ht = /^(?:input|select|textarea|button)$/i, mt = /^h\d$/i, gt = /^[^{]+\{\s*\[native \w/, vt = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, yt = /[+~]/, bt = /'|\\/g, Ct = new RegExp("\\\\([\\da-f]{1,6}" + rt + "?|(" + rt + ")|.)", "ig"), xt = function (e, t, n) { var r = "0x" + t - 65536; return r !== r || n ? t : 0 > r ? String.fromCharCode(r + 65536) : String.fromCharCode(r >> 10 | 55296, 1023 & r | 56320) }; try { Z.apply(X = et.call(z.childNodes), z.childNodes), X[z.childNodes.length].nodeType } catch (wt) { Z = { apply: X.length ? function (e, t) { Q.apply(e, et.call(t)) } : function (e, t) { for (var n = e.length, r = 0; e[n++] = t[r++]; ); e.length = n - 1 } } } x = e.support = {}, E = e.isXML = function (e) { var t = e && (e.ownerDocument || e).documentElement; return t ? "HTML" !== t.nodeName : !1 }, B = e.setDocument = function (e) { var t, n = e ? e.ownerDocument || e : z, r = n.defaultView; return n !== D && 9 === n.nodeType && n.documentElement ? (D = n, L = n.documentElement, H = !E(n), r && r !== r.top && (r.addEventListener ? r.addEventListener("unload", function () { B() }, !1) : r.attachEvent && r.attachEvent("onunload", function () { B() })), x.attributes = i(function (e) { return e.className = "i", !e.getAttribute("className") }), x.getElementsByTagName = i(function (e) { return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length }), x.getElementsByClassName = gt.test(n.getElementsByClassName), x.getById = i(function (e) { return L.appendChild(e).id = F, !n.getElementsByName || !n.getElementsByName(F).length }), x.getById ? (w.find.ID = function (e, t) { if (typeof t.getElementById !== Y && H) { var n = t.getElementById(e); return n && n.parentNode ? [n] : [] } }, w.filter.ID = function (e) { var t = e.replace(Ct, xt); return function (e) { return e.getAttribute("id") === t } }) : (delete w.find.ID, w.filter.ID = function (e) { var t = e.replace(Ct, xt); return function (e) { var n = typeof e.getAttributeNode !== Y && e.getAttributeNode("id"); return n && n.value === t } }), w.find.TAG = x.getElementsByTagName ? function (e, t) { return typeof t.getElementsByTagName !== Y ? t.getElementsByTagName(e) : void 0 } : function (e, t) { var n, r = [], i = 0, o = t.getElementsByTagName(e); if ("*" === e) { for (; n = o[i++]; ) 1 === n.nodeType && r.push(n); return r } return o }, w.find.CLASS = x.getElementsByClassName && function (e, t) { return H ? t.getElementsByClassName(e) : void 0 }, P = [], M = [], (x.qsa = gt.test(n.querySelectorAll)) && (i(function (e) { e.innerHTML = "<select msallowcapture=''><option selected=''></option></select>", e.querySelectorAll("[msallowcapture^='']").length && M.push("[*^$]=" + rt + "*(?:''|\"\")"), e.querySelectorAll("[selected]").length || M.push("\\[" + rt + "*(?:value|" + nt + ")"), e.querySelectorAll(":checked").length || M.push(":checked") }), i(function (e) { var t = n.createElement("input"); t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("name", "D"), e.querySelectorAll("[name=d]").length && M.push("name" + rt + "*[*^$|!~]?="), e.querySelectorAll(":enabled").length || M.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), M.push(",.*:") })), (x.matchesSelector = gt.test(O = L.matches || L.webkitMatchesSelector || L.mozMatchesSelector || L.oMatchesSelector || L.msMatchesSelector)) && i(function (e) { x.disconnectedMatch = O.call(e, "div"), O.call(e, "[s!='']:x"), P.push("!=", at) }), M = M.length && new RegExp(M.join("|")), P = P.length && new RegExp(P.join("|")), t = gt.test(L.compareDocumentPosition), I = t || gt.test(L.contains) ? function (e, t) { var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode; return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r))) } : function (e, t) { if (t) for (; t = t.parentNode; ) if (t === e) return !0; return !1 }, j = t ? function (e, t) { if (e === t) return A = !0, 0; var r = !e.compareDocumentPosition - !t.compareDocumentPosition; return r ? r : (r = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1, 1 & r || !x.sortDetached && t.compareDocumentPosition(e) === r ? e === n || e.ownerDocument === z && I(z, e) ? -1 : t === n || t.ownerDocument === z && I(z, t) ? 1 : R ? tt.call(R, e) - tt.call(R, t) : 0 : 4 & r ? -1 : 1) } : function (e, t) { if (e === t) return A = !0, 0; var r, i = 0, o = e.parentNode, s = t.parentNode, l = [e], c = [t]; if (!o || !s) return e === n ? -1 : t === n ? 1 : o ? -1 : s ? 1 : R ? tt.call(R, e) - tt.call(R, t) : 0; if (o === s) return a(e, t); for (r = e; r = r.parentNode; ) l.unshift(r); for (r = t; r = r.parentNode; ) c.unshift(r); for (; l[i] === c[i]; ) i++; return i ? a(l[i], c[i]) : l[i] === z ? -1 : c[i] === z ? 1 : 0 }, n) : D }, e.matches = function (t, n) { return e(t, null, null, n) }, e.matchesSelector = function (t, n) { if ((t.ownerDocument || t) !== D && B(t), n = n.replace(ut, "='$1']"), !(!x.matchesSelector || !H || P && P.test(n) || M && M.test(n))) try { var r = O.call(t, n); if (r || x.disconnectedMatch || t.document && 11 !== t.document.nodeType) return r } catch (i) { } return e(n, D, null, [t]).length > 0 }, e.contains = function (e, t) { return (e.ownerDocument || e) !== D && B(e), I(e, t) }, e.attr = function (e, n) { (e.ownerDocument || e) !== D && B(e); var r = w.attrHandle[n.toLowerCase()], i = r && G.call(w.attrHandle, n.toLowerCase()) ? r(e, n, !H) : t; return i !== t ? i : x.attributes || !H ? e.getAttribute(n) : (i = e.getAttributeNode(n)) && i.specified ? i.value : null }, e.error = function (e) { throw new Error("Syntax error, unrecognized expression: " + e) }, e.uniqueSort = function (e) { var t, n = [], r = 0, i = 0; if (A = !x.detectDuplicates, R = !x.sortStable && e.slice(0), e.sort(j), A) { for (; t = e[i++]; ) t === e[i] && (r = n.push(i)); for (; r--; ) e.splice(n[r], 1) } return R = null, e }, _ = e.getText = function (e) { var t, n = "", r = 0, i = e.nodeType; if (i) { if (1 === i || 9 === i || 11 === i) { if ("string" == typeof e.textContent) return e.textContent; for (e = e.firstChild; e; e = e.nextSibling) n += _(e) } else if (3 === i || 4 === i) return e.nodeValue } else for (; t = e[r++]; ) n += _(t); return n }, w = e.selectors = { cacheLength: 50, createPseudo: r, match: pt, attrHandle: {}, find: {}, relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling"} }, preFilter: { ATTR: function (e) { return e[1] = e[1].replace(Ct, xt), e[3] = (e[3] || e[4] || e[5] || "").replace(Ct, xt), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4) }, CHILD: function (t) { return t[1] = t[1].toLowerCase(), "nth" === t[1].slice(0, 3) ? (t[3] || e.error(t[0]), t[4] = +(t[4] ? t[5] + (t[6] || 1) : 2 * ("even" === t[3] || "odd" === t[3])), t[5] = +(t[7] + t[8] || "odd" === t[3])) : t[3] && e.error(t[0]), t }, PSEUDO: function (e) { var t, n = !e[6] && e[2]; return pt.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && dt.test(n) && (t = N(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3)) } }, filter: { TAG: function (e) { var t = e.replace(Ct, xt).toLowerCase(); return "*" === e ? function () { return !0 } : function (e) { return e.nodeName && e.nodeName.toLowerCase() === t } }, CLASS: function (e) { var t = U[e + " "]; return t || (t = new RegExp("(^|" + rt + ")" + e + "(" + rt + "|$)")) && U(e, function (e) { return t.test("string" == typeof e.className && e.className || typeof e.getAttribute !== Y && e.getAttribute("class") || "") }) }, ATTR: function (t, n, r) { return function (i) { var o = e.attr(i, t); return null == o ? "!=" === n : n ? (o += "", "=" === n ? o === r : "!=" === n ? o !== r : "^=" === n ? r && 0 === o.indexOf(r) : "*=" === n ? r && o.indexOf(r) > -1 : "$=" === n ? r && o.slice(-r.length) === r : "~=" === n ? (" " + o + " ").indexOf(r) > -1 : "|=" === n ? o === r || o.slice(0, r.length + 1) === r + "-" : !1) : !0 } }, CHILD: function (e, t, n, r, i) { var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t; return 1 === r && 0 === i ? function (e) { return !!e.parentNode } : function (t, n, l) { var c, u, d, f, p, h, m = o !== a ? "nextSibling" : "previousSibling", g = t.parentNode, v = s && t.nodeName.toLowerCase(), y = !l && !s; if (g) { if (o) { for (; m; ) { for (d = t; d = d[m]; ) if (s ? d.nodeName.toLowerCase() === v : 1 === d.nodeType) return !1; h = m = "only" === e && !h && "nextSibling" } return !0 } if (h = [a ? g.firstChild : g.lastChild], a && y) { for (u = g[F] || (g[F] = {}), c = u[e] || [], p = c[0] === W && c[1], f = c[0] === W && c[2], d = p && g.childNodes[p]; d = ++p && d && d[m] || (f = p = 0) || h.pop(); ) if (1 === d.nodeType && ++f && d === t) { u[e] = [W, p, f]; break } } else if (y && (c = (t[F] || (t[F] = {}))[e]) && c[0] === W) f = c[1]; else for (; (d = ++p && d && d[m] || (f = p = 0) || h.pop()) && ((s ? d.nodeName.toLowerCase() !== v : 1 !== d.nodeType) || ! ++f || (y && ((d[F] || (d[F] = {}))[e] = [W, f]), d !== t)); ); return f -= i, f === r || f % r === 0 && f / r >= 0 } } }, PSEUDO: function (t, n) { var i, o = w.pseudos[t] || w.setFilters[t.toLowerCase()] || e.error("unsupported pseudo: " + t); return o[F] ? o(n) : o.length > 1 ? (i = [t, t, "", n], w.setFilters.hasOwnProperty(t.toLowerCase()) ? r(function (e, t) { for (var r, i = o(e, n), a = i.length; a--; ) r = tt.call(e, i[a]), e[r] = !(t[r] = i[a]) }) : function (e) { return o(e, 0, i) }) : o } }, pseudos: { not: r(function (e) { var t = [], n = [], i = k(e.replace(st, "$1")); return i[F] ? r(function (e, t, n, r) { for (var o, a = i(e, null, r, []), s = e.length; s--; ) (o = a[s]) && (e[s] = !(t[s] = o)) }) : function (e, r, o) { return t[0] = e, i(t, null, o, n), !n.pop() } }), has: r(function (t) { return function (n) { return e(t, n).length > 0 } }), contains: r(function (e) { return e = e.replace(Ct, xt), function (t) { return (t.textContent || t.innerText || _(t)).indexOf(e) > -1 } }), lang: r(function (t) { return ft.test(t || "") || e.error("unsupported lang: " + t), t = t.replace(Ct, xt).toLowerCase(), function (e) { var n; do if (n = H ? e.lang : e.getAttribute("xml:lang") || e.getAttribute("lang")) return n = n.toLowerCase(), n === t || 0 === n.indexOf(t + "-"); while ((e = e.parentNode) && 1 === e.nodeType); return !1 } }), target: function (e) { var t = window.location && window.location.hash; return t && t.slice(1) === e.id }, root: function (e) { return e === L }, focus: function (e) { return e === D.activeElement && (!D.hasFocus || D.hasFocus()) && !!(e.type || e.href || ~e.tabIndex) }, enabled: function (e) { return e.disabled === !1 }, disabled: function (e) { return e.disabled === !0 }, checked: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && !!e.checked || "option" === t && !!e.selected }, selected: function (e) { return e.parentNode && e.parentNode.selectedIndex, e.selected === !0 }, empty: function (e) { for (e = e.firstChild; e; e = e.nextSibling) if (e.nodeType < 6) return !1; return !0 }, parent: function (e) { return !w.pseudos.empty(e) }, header: function (e) { return mt.test(e.nodeName) }, input: function (e) { return ht.test(e.nodeName) }, button: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && "button" === e.type || "button" === t }, text: function (e) { var t; return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase()) }, first: c(function () { return [0] }), last: c(function (e, t) { return [t - 1] }), eq: c(function (e, t, n) { return [0 > n ? n + t : n] }), even: c(function (e, t) { for (var n = 0; t > n; n += 2) e.push(n); return e }), odd: c(function (e, t) { for (var n = 1; t > n; n += 2) e.push(n); return e }), lt: c(function (e, t, n) { for (var r = 0 > n ? n + t : n; --r >= 0; ) e.push(r); return e }), gt: c(function (e, t, n) { for (var r = 0 > n ? n + t : n; ++r < t; ) e.push(r); return e })} }, w.pseudos.nth = w.pseudos.eq; for (C in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) w.pseudos[C] = s(C); for (C in { submit: !0, reset: !0 }) w.pseudos[C] = l(C); return d.prototype = w.filters = w.pseudos, w.setFilters = new d, N = e.tokenize = function (t, n) { var r, i, o, a, s, l, c, u = $[t + " "]; if (u) return n ? 0 : u.slice(0); for (s = t, l = [], c = w.preFilter; s; ) { (!r || (i = lt.exec(s))) && (i && (s = s.slice(i[0].length) || s), l.push(o = [])), r = !1, (i = ct.exec(s)) && (r = i.shift(), o.push({ value: r, type: i[0].replace(st, " ") }), s = s.slice(r.length)); for (a in w.filter) !(i = pt[a].exec(s)) || c[a] && !(i = c[a](i)) || (r = i.shift(), o.push({ value: r, type: a, matches: i }), s = s.slice(r.length)); if (!r) break } return n ? s.length : s ? e.error(t) : $(t, l).slice(0) }, k = e.compile = function (e, t) { var n, r = [], i = [], o = q[e + " "]; if (!o) { for (t || (t = N(e)), n = t.length; n--; ) o = y(t[n]), o[F] ? r.push(o) : i.push(o); o = q(e, b(i, r)), o.selector = e } return o }, S = e.select = function (e, t, n, r) { var i, o, a, s, l, c = "function" == typeof e && e, d = !r && N(e = c.selector || e); if (n = n || [], 1 === d.length) { if (o = d[0] = d[0].slice(0), o.length > 2 && "ID" === (a = o[0]).type && x.getById && 9 === t.nodeType && H && w.relative[o[1].type]) { if (t = (w.find.ID(a.matches[0].replace(Ct, xt), t) || [])[0], !t) return n; c && (t = t.parentNode), e = e.slice(o.shift().value.length) } for (i = pt.needsContext.test(e) ? 0 : o.length; i-- && (a = o[i], !w.relative[s = a.type]); ) if ((l = w.find[s]) && (r = l(a.matches[0].replace(Ct, xt), yt.test(o[0].type) && u(t.parentNode) || t))) { if (o.splice(i, 1), e = r.length && f(o), !e) return Z.apply(n, r), n; break } } return (c || k(e, d))(r, t, !H, n, yt.test(e) && u(t.parentNode) || t), n }, x.sortStable = F.split("").sort(j).join("") === F, x.detectDuplicates = !!A, B(), x.sortDetached = i(function (e) { return 1 & e.compareDocumentPosition(D.createElement("div")) }), i(function (e) { return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href") }) || o("type|href|height|width", function (e, t, n) { return n ? void 0 : e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2) }), x.attributes && i(function (e) { return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value") }) || o("value", function (e, t, n) { return n || "input" !== e.nodeName.toLowerCase() ? void 0 : e.defaultValue }), i(function (e) { return null == e.getAttribute("disabled") }) || o(nt, function (e, t, n) { var r; return n ? void 0 : e[t] === !0 ? t.toLowerCase() : (r = e.getAttributeNode(t)) && r.specified ? r.value : null }), e }), r(u, [], function () { function e(e) { return null === e || e === t ? "" : ("" + e).replace(m, "") } function n(e, n) { return n ? "array" == n && g(e) ? !0 : typeof e == n : e !== t } function r(e) { var t = e, n, r; if (!g(e)) for (t = [], n = 0, r = e.length; r > n; n++) t[n] = e[n]; return t } function i(e, t, n) { var r; for (e = e || [], t = t || ",", "string" == typeof e && (e = e.split(t)), n = n || {}, r = e.length; r--; ) n[e[r]] = {}; return n } function o(e, n, r) { var i, o; if (!e) return 0; if (r = r || e, e.length !== t) { for (i = 0, o = e.length; o > i; i++) if (n.call(r, e[i], i, e) === !1) return 0 } else for (i in e) if (e.hasOwnProperty(i) && n.call(r, e[i], i, e) === !1) return 0; return 1 } function a(e, t) { var n = []; return o(e, function (e) { n.push(t(e)) }), n } function s(e, t) { var n = []; return o(e, function (e) { (!t || t(e)) && n.push(e) }), n } function l(e, t, n) { var r = this, i, o, a, s, l, c = 0; if (e = /^((static) )?([\w.]+)(:([\w.]+))?/.exec(e), a = e[3].match(/(^|\.)(\w+)$/i)[2], o = r.createNS(e[3].replace(/\.\w+$/, ""), n), !o[a]) { if ("static" == e[2]) return o[a] = t, void (this.onCreate && this.onCreate(e[2], e[3], o[a])); t[a] || (t[a] = function () { }, c = 1), o[a] = t[a], r.extend(o[a].prototype, t), e[5] && (i = r.resolve(e[5]).prototype, s = e[5].match(/\.(\w+)$/i)[1], l = o[a], o[a] = c ? function () { return i[s].apply(this, arguments) } : function () { return this.parent = i[s], l.apply(this, arguments) }, o[a].prototype[a] = o[a], r.each(i, function (e, t) { o[a].prototype[t] = i[t] }), r.each(t, function (e, t) { i[t] ? o[a].prototype[t] = function () { return this.parent = i[t], e.apply(this, arguments) } : t != a && (o[a].prototype[t] = e) })), r.each(t["static"], function (e, t) { o[a][t] = e }) } } function c(e, t) { var n, r; if (e) for (n = 0, r = e.length; r > n; n++) if (e[n] === t) return n; return -1 } function u(e, n) { var r, i, o, a = arguments, s; for (r = 1, i = a.length; i > r; r++) { n = a[r]; for (o in n) n.hasOwnProperty(o) && (s = n[o], s !== t && (e[o] = s)) } return e } function d(e, t, n, r) { r = r || this, e && (n && (e = e[n]), o(e, function (e, i) { return t.call(r, e, i, n) === !1 ? !1 : void d(e, t, n, r) })) } function f(e, t) { var n, r; for (t = t || window, e = e.split("."), n = 0; n < e.length; n++) r = e[n], t[r] || (t[r] = {}), t = t[r]; return t } function p(e, t) { var n, r; for (t = t || window, e = e.split("."), n = 0, r = e.length; r > n && (t = t[e[n]], t); n++); return t } function h(t, r) { return !t || n(t, "array") ? t : a(t.split(r || ","), e) } var m = /^\s*|\s*$/g, g = Array.isArray || function (e) { return "[object Array]" === Object.prototype.toString.call(e) }; return { trim: e, isArray: g, is: n, toArray: r, makeMap: i, each: o, map: a, grep: s, inArray: c, extend: u, create: l, walk: d, createNS: f, resolve: p, explode: h} }), r(d, [], function () { var e = navigator, t = e.userAgent, n, r, i, o, a, s, l; n = window.opera && window.opera.buildNumber, r = /WebKit/.test(t), i = !r && !n && /MSIE/gi.test(t) && /Explorer/gi.test(e.appName), i = i && /MSIE (\w+)\./.exec(t)[1], o = -1 == t.indexOf("Trident/") || -1 == t.indexOf("rv:") && -1 == e.appName.indexOf("Netscape") ? !1 : 11, i = i || o, a = !r && !o && /Gecko/.test(t), s = -1 != t.indexOf("Mac"), l = /(iPad|iPhone)/.test(t); var c = !l || t.match(/AppleWebKit\/(\d*)/)[1] >= 534; return { opera: n, webkit: r, ie: i, gecko: a, mac: s, iOS: l, contentEditable: c, transparentSrc: "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7", caretAfter: 8 != i, range: window.getSelection && "Range" in window, documentMode: i ? document.documentMode || 7 : 10} }), r(f, [l, c, u, d], function (e, n, r, i) { function o(e) { return "undefined" != typeof e } function a(e) { return "string" == typeof e } function s(e, t) { var n, r, i; for (t = t || x, i = t.createElement("div"), n = t.createDocumentFragment(), i.innerHTML = e; r = i.firstChild; ) n.appendChild(r); return n } function l(e, t, n, r) { var i; if (a(t)) t = s(t, g(e[0])); else if (t.length && !t.nodeType) { if (t = d.makeArray(t), r) for (i = t.length - 1; i >= 0; i--) l(e, t[i], n, r); else for (i = 0; i < t.length; i++) l(e, t[i], n, r); return e } if (t.nodeType) for (i = e.length; i--; ) n.call(e[i], t); return e } function c(e, t) { return e && t && -1 !== (" " + e.className + " ").indexOf(" " + t + " ") } function u(e, t, n) { var r, i; return t = d(t)[0], e.each(function () { var e = this; n && r == e.parentNode ? i.appendChild(e) : (r = e.parentNode, i = t.cloneNode(!1), e.parentNode.insertBefore(i, e), i.appendChild(e)) }), e } function d(e, t) { return new d.fn.init(e, t) } function f(e, t) { var n; if (t.indexOf) return t.indexOf(e); for (n = t.length; n--; ) if (t[n] === e) return n; return -1 } function p(e) { return null === e || e === k ? "" : ("" + e).replace(L, "") } function h(e, t) { var n, r, i, o, a; if (e) if (n = e.length, n === o) { for (r in e) if (e.hasOwnProperty(r) && (a = e[r], t.call(a, r, a) === !1)) break } else for (i = 0; n > i && (a = e[i], t.call(a, i, a) !== !1); i++); return e } function m(e, t) { var n = []; return h(e, function (e, r) { t(r, e) && n.push(r) }), n } function g(e) { return e ? 9 == e.nodeType ? e : e.ownerDocument : x } function v(e, n, r) { var i = [], o = e[n]; for ("string" != typeof r && r instanceof d && (r = r[0]); o && 9 !== o.nodeType; ) { if (r !== t) { if (o === r) break; if ("string" == typeof r && d(o).is(r)) break } 1 === o.nodeType && i.push(o), o = o[n] } return i } function y(e, n, r, i) { var o = []; for (i instanceof d && (i = i[0]); e; e = e[n]) if (!r || e.nodeType === r) { if (i !== t) { if (e === i) break; if ("string" == typeof i && d(e).is(i)) break } o.push(e) } return o } function b(e, t, n) { for (e = e[t]; e; e = e[t]) if (e.nodeType == n) return e; return null } function C(e, t, n) { h(n, function (n, r) { e[n] = e[n] || {}, e[n][t] = r }) } var x = document, w = Array.prototype.push, _ = Array.prototype.slice, E = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/, N = e.Event, k, S = r.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom", " "), T = r.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected", " "), R = { "for": "htmlFor", "class": "className", readonly: "readOnly" }, A = { "float": "cssFloat" }, B = {}, D = {}, L = /^\s*|\s*$/g; return d.fn = d.prototype = { constructor: d, selector: "", context: null, length: 0, init: function (e, t) { var n = this, r, i; if (!e) return n; if (e.nodeType) return n.context = n[0] = e, n.length = 1, n; if (t && t.nodeType) n.context = t; else { if (t) return d(e).attr(t); n.context = t = document } if (a(e)) { if (n.selector = e, r = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : E.exec(e), !r) return d(t).find(e); if (r[1]) for (i = s(e, g(t)).firstChild; i; ) w.call(n, i), i = i.nextSibling; else { if (i = g(t).getElementById(r[2]), !i) return n; if (i.id !== r[2]) return n.find(e); n.length = 1, n[0] = i } } else this.add(e, !1); return n }, toArray: function () { return r.toArray(this) }, add: function (e, t) { var n = this, r, i; if (a(e)) return n.add(d(e)); if (e.nodeType) return n.add([e]); if (t !== !1) for (r = d.unique(n.toArray().concat(d.makeArray(e))), n.length = r.length, i = 0; i < r.length; i++) n[i] = r[i]; else w.apply(n, d.makeArray(e)); return n }, attr: function (e, t) { var n = this, r; if ("object" == typeof e) h(e, function (e, t) { n.attr(e, t) }); else { if (!o(t)) { if (n[0] && 1 === n[0].nodeType) { if (r = B[e], r && r.get) return r.get(n[0], e); if (T[e]) return n.prop(e) ? e : k; t = n[0].getAttribute(e, 2), null === t && (t = k) } return t } this.each(function () { var n; if (1 === this.nodeType) { if (n = B[e], n && n.set) return void n.set(this, t); null === t ? this.removeAttribute(e, 2) : this.setAttribute(e, t, 2) } }) } return n }, removeAttr: function (e) { return this.attr(e, null) }, prop: function (e, t) { var n = this; if (e = R[e] || e, "object" == typeof e) h(e, function (e, t) { n.prop(e, t) }); else { if (!o(t)) return n[0] && n[0].nodeType && e in n[0] ? n[0][e] : t; this.each(function () { 1 == this.nodeType && (this[e] = t) }) } return n }, css: function (e, t) { function n(e) { return e.replace(/-(\D)/g, function (e, t) { return t.toUpperCase() }) } function r(e) { return e.replace(/[A-Z]/g, function (e) { return "-" + e }) } var i = this, a, s; if ("object" == typeof e) h(e, function (e, t) { i.css(e, t) }); else if (o(t)) e = n(e), "number" != typeof t || S[e] || (t += "px"), i.each(function () { var n = this.style; if (s = D[e], s && s.set) return void s.set(this, t); try { this.style[A[e] || e] = t } catch (i) { } (null === t || "" === t) && (n.removeProperty ? n.removeProperty(r(e)) : n.removeAttribute(e)) }); else { if (a = i[0], s = D[e], s && s.get) return s.get(a); if (a.ownerDocument.defaultView) try { return a.ownerDocument.defaultView.getComputedStyle(a, null).getPropertyValue(r(e)) } catch (l) { return k } else if (a.currentStyle) return a.currentStyle[n(e)] } return i }, remove: function () { for (var e = this, t, n = this.length; n--; ) t = e[n], N.clean(t), t.parentNode && t.parentNode.removeChild(t); return this }, empty: function () { for (var e = this, t, n = this.length; n--; ) for (t = e[n]; t.firstChild; ) t.removeChild(t.firstChild); return this }, html: function (e) { var t = this, n; if (o(e)) { n = t.length; try { for (; n--; ) t[n].innerHTML = e } catch (r) { d(t[n]).empty().append(e) } return t } return t[0] ? t[0].innerHTML : "" }, text: function (e) { var t = this, n; if (o(e)) { for (n = t.length; n--; ) "innerText" in t[n] ? t[n].innerText = e : t[0].textContent = e; return t } return t[0] ? t[0].innerText || t[0].textContent : "" }, append: function () { return l(this, arguments, function (e) { 1 === this.nodeType && this.appendChild(e) }) }, prepend: function () { return l(this, arguments, function (e) { 1 === this.nodeType && this.insertBefore(e, this.firstChild) }, !0) }, before: function () { var e = this; return e[0] && e[0].parentNode ? l(e, arguments, function (e) { this.parentNode.insertBefore(e, this) }) : e }, after: function () { var e = this; return e[0] && e[0].parentNode ? l(e, arguments, function (e) { this.parentNode.insertBefore(e, this.nextSibling) }, !0) : e }, appendTo: function (e) { return d(e).append(this), this }, prependTo: function (e) { return d(e).prepend(this), this }, replaceWith: function (e) { return this.before(e).remove() }, wrap: function (e) { return u(this, e) }, wrapAll: function (e) { return u(this, e, !0) }, wrapInner: function (e) { return this.each(function () { d(this).contents().wrapAll(e) }), this }, unwrap: function () { return this.parent().each(function () { d(this).replaceWith(this.childNodes) }) }, clone: function () { var e = []; return this.each(function () { e.push(this.cloneNode(!0)) }), d(e) }, addClass: function (e) { return this.toggleClass(e, !0) }, removeClass: function (e) { return this.toggleClass(e, !1) }, toggleClass: function (e, t) { var n = this; return "string" != typeof e ? n : (-1 !== e.indexOf(" ") ? h(e.split(" "), function () { n.toggleClass(this, t) }) : n.each(function (n, r) { var i, o; o = c(r, e), o !== t && (i = r.className, o ? r.className = p((" " + i + " ").replace(" " + e + " ", " ")) : r.className += i ? " " + e : e) }), n) }, hasClass: function (e) { return c(this[0], e) }, each: function (e) { return h(this, e) }, on: function (e, t) { return this.each(function () { N.bind(this, e, t) }) }, off: function (e, t) { return this.each(function () { N.unbind(this, e, t) }) }, trigger: function (e) { return this.each(function () { "object" == typeof e ? N.fire(this, e.type, e) : N.fire(this, e) }) }, show: function () { return this.css("display", "") }, hide: function () { return this.css("display", "none") }, slice: function () { return new d(_.apply(this, arguments)) }, eq: function (e) { return -1 === e ? this.slice(e) : this.slice(e, +e + 1) }, first: function () { return this.eq(0) }, last: function () { return this.eq(-1) }, find: function (e) { var t, n, r = []; for (t = 0, n = this.length; n > t; t++) d.find(e, this[t], r); return d(r) }, filter: function (e) { return d("function" == typeof e ? m(this.toArray(), function (t, n) { return e(n, t) }) : d.filter(e, this.toArray())) }, closest: function (e) { var t = []; return e instanceof d && (e = e[0]), this.each(function (n, r) { for (; r; ) { if ("string" == typeof e && d(r).is(e)) { t.push(r); break } if (r == e) { t.push(r); break } r = r.parentNode } }), d(t) }, offset: function (e) { var t, n, r, i = 0, o = 0, a; return e ? this.css(e) : (t = this[0], t && (n = t.ownerDocument, r = n.documentElement, t.getBoundingClientRect && (a = t.getBoundingClientRect(), i = a.left + (r.scrollLeft || n.body.scrollLeft) - r.clientLeft, o = a.top + (r.scrollTop || n.body.scrollTop) - r.clientTop)), { left: i, top: o }) }, push: w, sort: [].sort, splice: [].splice }, r.extend(d, { extend: r.extend, makeArray: r.toArray, inArray: f, isArray: r.isArray, each: h, trim: p, grep: m, find: n, expr: n.selectors, unique: n.uniqueSort, text: n.getText, contains: n.contains, filter: function (e, t, n) { var r = t.length; for (n && (e = ":not(" + e + ")"); r--; ) 1 != t[r].nodeType && t.splice(r, 1); return t = 1 === t.length ? d.find.matchesSelector(t[0], e) ? [t[0]] : [] : d.find.matches(e, t) } }), h({ parent: function (e) { var t = e.parentNode; return t && 11 !== t.nodeType ? t : null }, parents: function (e) { return v(e, "parentNode") }, next: function (e) { return b(e, "nextSibling", 1) }, prev: function (e) { return b(e, "previousSibling", 1) }, children: function (e) { return y(e.firstChild, "nextSibling", 1) }, contents: function (e) { return r.toArray(("iframe" === e.nodeName ? e.contentDocument || e.contentWindow.document : e).childNodes) } }, function (e, t) { d.fn[e] = function (n) { var r = this, i = []; return r.each(function () { var e = t.call(i, this, n, i); e && (d.isArray(e) ? i.push.apply(i, e) : i.push(e)) }), this.length > 1 && (i = d.unique(i), 0 === e.indexOf("parents") && (i = i.reverse())), i = d(i), n ? i.filter(n) : i } }), h({ parentsUntil: function (e, t) { return v(e, "parentNode", t) }, nextUntil: function (e, t) { return y(e, "nextSibling", 1, t).slice(1) }, prevUntil: function (e, t) { return y(e, "previousSibling", 1, t).slice(1) } }, function (e, t) { d.fn[e] = function (n, r) { var i = this, o = []; return i.each(function () { var e = t.call(o, this, n, o); e && (d.isArray(e) ? o.push.apply(o, e) : o.push(e)) }), this.length > 1 && (o = d.unique(o), (0 === e.indexOf("parents") || "prevUntil" === e) && (o = o.reverse())), o = d(o), r ? o.filter(r) : o } }), d.fn.is = function (e) { return !!e && this.filter(e).length > 0 }, d.fn.init.prototype = d.fn, d.overrideDefaults = function (e) { function t(r, i) { return n = n || e(), 0 === arguments.length && (r = n.element), i || (i = n.context), new t.fn.init(r, i) } var n; return d.extend(t, this), t }, i.ie && i.ie < 8 && (C(B, "get", { maxlength: function (e) { var t = e.maxLength; return 2147483647 === t ? k : t }, size: function (e) { var t = e.size; return 20 === t ? k : t }, "class": function (e) { return e.className }, style: function (e) { var t = e.style.cssText; return 0 === t.length ? k : t } }), C(B, "set", { "class": function (e, t) { e.className = t }, style: function (e, t) { e.style.cssText = t } })), i.ie && i.ie < 9 && (A["float"] = "styleFloat", C(D, "set", { opacity: function (e, t) { var n = e.style; null === t || "" === t ? n.removeAttribute("filter") : (n.zoom = 1, n.filter = "alpha(opacity=" + 100 * t + ")") } })), d.attrHooks = B, d.cssHooks = D, d }), r(p, [], function () { return function (e, t) { function n(e, t, n, r) { function i(e) { return e = parseInt(e, 10).toString(16), e.length > 1 ? e : "0" + e } return "#" + i(t) + i(n) + i(r) } var r = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi, i = /(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi, o = /\s*([^:]+):\s*([^;]+);?/g, a = /\s+$/, s, l, c = {}, u, d, f, p = "\ufeff"; for (e = e || {}, t && (d = t.getValidStyles(), f = t.getInvalidStyles()), u = ("\\\" \\' \\; \\: ; : " + p).split(" "), l = 0; l < u.length; l++) c[u[l]] = p + l, c[p + l] = u[l]; return { toHex: function (e) { return e.replace(r, n) }, parse: function (t) { function s(e, t, n) { var r, i, o, a; if (r = m[e + "-top" + t], r && (i = m[e + "-right" + t], i && (o = m[e + "-bottom" + t], o && (a = m[e + "-left" + t])))) { var s = [r, i, o, a]; for (l = s.length - 1; l-- && s[l] === s[l + 1]; ); l > -1 && n || (m[e + t] = -1 == l ? s[0] : s.join(" "), delete m[e + "-top" + t], delete m[e + "-right" + t], delete m[e + "-bottom" + t], delete m[e + "-left" + t]) } } function u(e) { var t = m[e], n; if (t) { for (t = t.split(" "), n = t.length; n--; ) if (t[n] !== t[0]) return !1; return m[e] = t[0], !0 } } function d(e, t, n, r) { u(t) && u(n) && u(r) && (m[e] = m[t] + " " + m[n] + " " + m[r], delete m[t], delete m[n], delete m[r]) } function f(e) { return b = !0, c[e] } function p(e, t) { return b && (e = e.replace(/\uFEFF[0-9]/g, function (e) { return c[e] })), t || (e = e.replace(/\\([\'\";:])/g, "$1")), e } function h(t, n, r, i, o, a) { if (o = o || a) return o = p(o), "'" + o.replace(/\'/g, "\\'") + "'"; if (n = p(n || r || i), !e.allow_script_urls) { var s = n.replace(/[\s\r\n]+/, ""); if (/(java|vb)script:/i.test(s)) return ""; if (!e.allow_svg_data_urls && /^data:image\/svg/i.test(s)) return "" } return C && (n = C.call(x, n, "style")), "url('" + n.replace(/\'/g, "\\'") + "')" } var m = {}, g, v, y, b, C = e.url_converter, x = e.url_converter_scope || this; if (t) { for (t = t.replace(/[\u0000-\u001F]/g, ""), t = t.replace(/\\[\"\';:\uFEFF]/g, f).replace(/\"[^\"]+\"|\'[^\']+\'/g, function (e) { return e.replace(/[;:]/g, f) }); g = o.exec(t); ) { if (v = g[1].replace(a, "").toLowerCase(), y = g[2].replace(a, ""), y = y.replace(/\\[0-9a-f]+/g, function (e) { return String.fromCharCode(parseInt(e.substr(1), 16)) }), v && y.length > 0) { if (!e.allow_script_urls && ("behavior" == v || /expression\s*\(|\/\*|\*\//.test(y))) continue; "font-weight" === v && "700" === y ? y = "bold" : ("color" === v || "background-color" === v) && (y = y.toLowerCase()), y = y.replace(r, n), y = y.replace(i, h), m[v] = b ? p(y, !0) : y } o.lastIndex = g.index + g[0].length } s("border", "", !0), s("border", "-width"), s("border", "-color"), s("border", "-style"), s("padding", ""), s("margin", ""), d("border", "border-width", "border-style", "border-color"), "medium none" === m.border && delete m.border, "none" === m["border-image"] && delete m["border-image"] } return m }, serialize: function (e, t) { function n(t) { var n, r, o, a; if (n = d[t]) for (r = 0, o = n.length; o > r; r++) t = n[r], a = e[t], a !== s && a.length > 0 && (i += (i.length > 0 ? " " : "") + t + ": " + a + ";") } function r(e, t) { var n; return n = f["*"], n && n[e] ? !1 : (n = f[t], n && n[e] ? !1 : !0) } var i = "", o, a; if (t && d) n("*"), n(t); else for (o in e) a = e[o], a !== s && a.length > 0 && (!f || r(o, t)) && (i += (i.length > 0 ? " " : "") + o + ": " + a + ";"); return i } } } }), r(h, [], function () { return function (e, t) { function n(e, n, r, i) { var o, a; if (e) { if (!i && e[n]) return e[n]; if (e != t) { if (o = e[r]) return o; for (a = e.parentNode; a && a != t; a = a.parentNode) if (o = a[r]) return o } } } var r = e; this.current = function () { return r }, this.next = function (e) { return r = n(r, "firstChild", "nextSibling", e) }, this.prev = function (e) { return r = n(r, "lastChild", "previousSibling", e) } } }), r(m, [u], function (e) { function t(n) { function r() { return M.createDocumentFragment() } function i(e, t) { _(F, e, t) } function o(e, t) { _(z, e, t) } function a(e) { i(e.parentNode, j(e)) } function s(e) { i(e.parentNode, j(e) + 1) } function l(e) { o(e.parentNode, j(e)) } function c(e) { o(e.parentNode, j(e) + 1) } function u(e) { e ? (H[U] = H[V], H[$] = H[W]) : (H[V] = H[U], H[W] = H[$]), H.collapsed = F } function d(e) { a(e), c(e) } function f(e) { i(e, 0), o(e, 1 === e.nodeType ? e.childNodes.length : e.nodeValue.length) } function p(e, t) { var n = H[V], r = H[W], i = H[U], o = H[$], a = t.startContainer, s = t.startOffset, l = t.endContainer, c = t.endOffset; return 0 === e ? w(n, r, a, s) : 1 === e ? w(i, o, a, s) : 2 === e ? w(i, o, l, c) : 3 === e ? w(n, r, l, c) : void 0 } function h() { E(I) } function m() { return E(P) } function g() { return E(O) } function v(e) { var t = this[V], r = this[W], i, o; 3 !== t.nodeType && 4 !== t.nodeType || !t.nodeValue ? (t.childNodes.length > 0 && (o = t.childNodes[r]), o ? t.insertBefore(e, o) : 3 == t.nodeType ? n.insertAfter(e, t) : t.appendChild(e)) : r ? r >= t.nodeValue.length ? n.insertAfter(e, t) : (i = t.splitText(r), t.parentNode.insertBefore(e, i)) : t.parentNode.insertBefore(e, t) } function y(e) { var t = H.extractContents(); H.insertNode(e), e.appendChild(t), H.selectNode(e) } function b() { return q(new t(n), { startContainer: H[V], startOffset: H[W], endContainer: H[U], endOffset: H[$], collapsed: H.collapsed, commonAncestorContainer: H.commonAncestorContainer }) } function C(e, t) { var n; if (3 == e.nodeType) return e; if (0 > t) return e; for (n = e.firstChild; n && t > 0; ) --t, n = n.nextSibling; return n ? n : e } function x() { return H[V] == H[U] && H[W] == H[$] } function w(e, t, r, i) { var o, a, s, l, c, u; if (e == r) return t == i ? 0 : i > t ? -1 : 1; for (o = r; o && o.parentNode != e; ) o = o.parentNode; if (o) { for (a = 0, s = e.firstChild; s != o && t > a; ) a++, s = s.nextSibling; return a >= t ? -1 : 1 } for (o = e; o && o.parentNode != r; ) o = o.parentNode; if (o) { for (a = 0, s = r.firstChild; s != o && i > a; ) a++, s = s.nextSibling; return i > a ? -1 : 1 } for (l = n.findCommonAncestor(e, r), c = e; c && c.parentNode != l; ) c = c.parentNode; for (c || (c = l), u = r; u && u.parentNode != l; ) u = u.parentNode; if (u || (u = l), c == u) return 0; for (s = l.firstChild; s; ) { if (s == c) return -1; if (s == u) return 1; s = s.nextSibling } } function _(e, t, r) { var i, o; for (e ? (H[V] = t, H[W] = r) : (H[U] = t, H[$] = r), i = H[U]; i.parentNode; ) i = i.parentNode; for (o = H[V]; o.parentNode; ) o = o.parentNode; o == i ? w(H[V], H[W], H[U], H[$]) > 0 && H.collapse(e) : H.collapse(e), H.collapsed = x(), H.commonAncestorContainer = n.findCommonAncestor(H[V], H[U]) } function E(e) { var t, n = 0, r = 0, i, o, a, s, l, c; if (H[V] == H[U]) return N(e); for (t = H[U], i = t.parentNode; i; t = i, i = i.parentNode) { if (i == H[V]) return k(t, e); ++n } for (t = H[V], i = t.parentNode; i; t = i, i = i.parentNode) { if (i == H[U]) return S(t, e); ++r } for (o = r - n, a = H[V]; o > 0; ) a = a.parentNode, o--; for (s = H[U]; 0 > o; ) s = s.parentNode, o++; for (l = a.parentNode, c = s.parentNode; l != c; l = l.parentNode, c = c.parentNode) a = l, s = c; return T(a, s, e) } function N(e) { var t, n, i, o, a, s, l, c, u; if (e != I && (t = r()), H[W] == H[$]) return t; if (3 == H[V].nodeType) { if (n = H[V].nodeValue, i = n.substring(H[W], H[$]), e != O && (o = H[V], c = H[W], u = H[$] - H[W], 0 === c && u >= o.nodeValue.length - 1 ? o.parentNode.removeChild(o) : o.deleteData(c, u), H.collapse(F)), e == I) return; return i.length > 0 && t.appendChild(M.createTextNode(i)), t } for (o = C(H[V], H[W]), a = H[$] - H[W]; o && a > 0; ) s = o.nextSibling, l = D(o, e), t && t.appendChild(l), --a, o = s; return e != O && H.collapse(F), t } function k(e, t) { var n, i, o, a, s, l; if (t != I && (n = r()), i = R(e, t), n && n.appendChild(i), o = j(e), a = o - H[W], 0 >= a) return t != O && (H.setEndBefore(e), H.collapse(z)), n; for (i = e.previousSibling; a > 0; ) s = i.previousSibling, l = D(i, t), n && n.insertBefore(l, n.firstChild), --a, i = s; return t != O && (H.setEndBefore(e), H.collapse(z)), n } function S(e, t) { var n, i, o, a, s, l; for (t != I && (n = r()), o = A(e, t), n && n.appendChild(o), i = j(e), ++i, a = H[$] - i, o = e.nextSibling; o && a > 0; ) s = o.nextSibling, l = D(o, t), n && n.appendChild(l), --a, o = s; return t != O && (H.setStartAfter(e), H.collapse(F)), n } function T(e, t, n) { var i, o, a, s, l, c, u; for (n != I && (o = r()), i = A(e, n), o && o.appendChild(i), a = j(e), s = j(t), ++a, l = s - a, c = e.nextSibling; l > 0; ) u = c.nextSibling, i = D(c, n), o && o.appendChild(i), c = u, --l; return i = R(t, n), o && o.appendChild(i), n != O && (H.setStartAfter(e), H.collapse(F)), o } function R(e, t) { var n = C(H[U], H[$] - 1), r, i, o, a, s, l = n != H[U]; if (n == e) return B(n, l, z, t); for (r = n.parentNode, i = B(r, z, z, t); r; ) { for (; n; ) o = n.previousSibling, a = B(n, l, z, t), t != I && i.insertBefore(a, i.firstChild), l = F, n = o; if (r == e) return i; n = r.previousSibling, r = r.parentNode, s = B(r, z, z, t), t != I && s.appendChild(i), i = s } } function A(e, t) { var n = C(H[V], H[W]), r = n != H[V], i, o, a, s, l; if (n == e) return B(n, r, F, t); for (i = n.parentNode, o = B(i, z, F, t); i; ) { for (; n; ) a = n.nextSibling, s = B(n, r, F, t), t != I && o.appendChild(s), r = F, n = a; if (i == e) return o; n = i.nextSibling, i = i.parentNode, l = B(i, z, F, t), t != I && l.appendChild(o), o = l } } function B(e, t, r, i) { var o, a, s, l, c; if (t) return D(e, i); if (3 == e.nodeType) { if (o = e.nodeValue, r ? (l = H[W], a = o.substring(l), s = o.substring(0, l)) : (l = H[$], a = o.substring(0, l), s = o.substring(l)), i != O && (e.nodeValue = s), i == I) return; return c = n.clone(e, z), c.nodeValue = a, c } if (i != I) return n.clone(e, z) } function D(e, t) { return t != I ? t == O ? n.clone(e, F) : e : void e.parentNode.removeChild(e) } function L() { return n.create("body", null, g()).outerText } var H = this, M = n.doc, P = 0, O = 1, I = 2, F = !0, z = !1, W = "startOffset", V = "startContainer", U = "endContainer", $ = "endOffset", q = e.extend, j = n.nodeIndex; return q(H, { startContainer: M, startOffset: 0, endContainer: M, endOffset: 0, collapsed: F, commonAncestorContainer: M, START_TO_START: 0, START_TO_END: 1, END_TO_END: 2, END_TO_START: 3, setStart: i, setEnd: o, setStartBefore: a, setStartAfter: s, setEndBefore: l, setEndAfter: c, collapse: u, selectNode: d, selectNodeContents: f, compareBoundaryPoints: p, deleteContents: h, extractContents: m, cloneContents: g, insertNode: v, surroundContents: y, cloneRange: b, toStringIE: L }), H } return t.prototype.toString = function () { return this.toStringIE() }, t }), r(g, [u], function (e) { function t(e) { var t; return t = document.createElement("div"), t.innerHTML = e, t.textContent || t.innerText || e } function n(e, t) { var n, r, i, a = {}; if (e) { for (e = e.split(","), t = t || 10, n = 0; n < e.length; n += 2) r = String.fromCharCode(parseInt(e[n], t)), o[r] || (i = "&" + e[n + 1] + ";", a[r] = i, a[i] = r); return a } } var r = e.makeMap, i, o, a, s = /[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g, l = /[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g, c = /[<>&\"\']/g, u = /&(#x|#)?([\w]+);/g, d = { 128: "\u20ac", 130: "\u201a", 131: "\u0192", 132: "\u201e", 133: "\u2026", 134: "\u2020", 135: "\u2021", 136: "\u02c6", 137: "\u2030", 138: "\u0160", 139: "\u2039", 140: "\u0152", 142: "\u017d", 145: "\u2018", 146: "\u2019", 147: "\u201c", 148: "\u201d", 149: "\u2022", 150: "\u2013", 151: "\u2014", 152: "\u02dc", 153: "\u2122", 154: "\u0161", 155: "\u203a", 156: "\u0153", 158: "\u017e", 159: "\u0178" }; o = { '"': "&quot;", "'": "&#39;", "<": "&lt;", ">": "&gt;", "&": "&amp;", "`": "&#96;" }, a = { "&lt;": "<", "&gt;": ">", "&amp;": "&", "&quot;": '"', "&apos;": "'" }, i = n("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro", 32); var f = { encodeRaw: function (e, t) { return e.replace(t ? s : l, function (e) { return o[e] || e }) }, encodeAllRaw: function (e) { return ("" + e).replace(c, function (e) { return o[e] || e }) }, encodeNumeric: function (e, t) { return e.replace(t ? s : l, function (e) { return e.length > 1 ? "&#" + (1024 * (e.charCodeAt(0) - 55296) + (e.charCodeAt(1) - 56320) + 65536) + ";" : o[e] || "&#" + e.charCodeAt(0) + ";" }) }, encodeNamed: function (e, t, n) { return n = n || i, e.replace(t ? s : l, function (e) { return o[e] || n[e] || e }) }, getEncodeFunc: function (e, t) { function a(e, n) { return e.replace(n ? s : l, function (e) { return o[e] || t[e] || "&#" + e.charCodeAt(0) + ";" || e }) } function c(e, n) { return f.encodeNamed(e, n, t) } return t = n(t) || i, e = r(e.replace(/\+/g, ",")), e.named && e.numeric ? a : e.named ? t ? c : f.encodeNamed : e.numeric ? f.encodeNumeric : f.encodeRaw }, decode: function (e) { return e.replace(u, function (e, n, r) { return n ? (r = parseInt(r, 2 === n.length ? 16 : 10), r > 65535 ? (r -= 65536, String.fromCharCode(55296 + (r >> 10), 56320 + (1023 & r))) : d[r] || String.fromCharCode(r)) : a[e] || i[e] || t(e) }) } }; return f }), r(v, [], function () { return function (e, t) { function n(t) { e.getElementsByTagName("head")[0].appendChild(t) } function r(t, r, s) { function l() { for (var e = v.passed, t = e.length; t--; ) e[t](); v.status = 2, v.passed = [], v.failed = [] } function c() { for (var e = v.failed, t = e.length; t--; ) e[t](); v.status = 3, v.passed = [], v.failed = [] } function u() { var e = navigator.userAgent.match(/WebKit\/(\d*)/); return !!(e && e[1] < 536) } function d(e, t) { e() || ((new Date).getTime() - g < a ? window.setTimeout(t, 0) : c()) } function f() { d(function () { for (var t = e.styleSheets, n, r = t.length, i; r--; ) if (n = t[r], i = n.ownerNode ? n.ownerNode : n.owningElement, i && i.id === h.id) return l(), !0 }, f) } function p() { d(function () { try { var e = m.sheet.cssRules; return l(), !!e } catch (t) { } }, p) } var h, m, g, v; if (o[t] ? v = o[t] : (v = { passed: [], failed: [] }, o[t] = v), r && v.passed.push(r), s && v.failed.push(s), 1 != v.status) { if (2 == v.status) return void l(); if (3 == v.status) return void c(); if (v.status = 1, h = e.createElement("link"), h.rel = "stylesheet", h.type = "text/css", h.id = "u" + i++, h.async = !1, h.defer = !1, g = (new Date).getTime(), "onload" in h && !u()) h.onload = f, h.onerror = c; else { if (navigator.userAgent.indexOf("Firefox") > 0) return m = e.createElement("style"), m.textContent = '@import "' + t + '"', p(), void n(m); f() } n(h), h.href = t } } var i = 0, o = {}, a; t = t || {}, a = t.maxLoadTime || 5e3, this.load = r } }), r(y, [c, f, p, l, h, m, g, d, u, v], function (e, n, r, i, o, a, s, l, c, u) { function d(e, t) { var n = {}, r = t.keep_values, i; return i = { set: function (n, r, i) { t.url_converter && (r = t.url_converter.call(t.url_converter_scope || e, r, i, n[0])), n.attr("data-mce-" + i, r).attr(i, r) }, get: function (e, t) { return e.attr("data-mce-" + t) || e.attr(t) } }, n = { style: { set: function (e, t) { return null !== t && "object" == typeof t ? void e.css(t) : (r && e.attr("data-mce-style", t), void e.attr("style", t)) }, get: function (t) { var n = t.attr("data-mce-style") || t.attr("style"); return n = e.serializeStyle(e.parseStyle(n), t[0].nodeName) } } }, r && (n.href = n.src = i), n } function f(e, t) { var o = this, a; o.doc = e, o.win = window, o.files = {}, o.counter = 0, o.stdMode = !v || e.documentMode >= 8, o.boxModel = !v || "CSS1Compat" == e.compatMode || o.stdMode, o.styleSheetLoader = new u(e), o.boundEvents = [], o.settings = t = t || {}, o.schema = t.schema, o.styles = new r({ url_converter: t.url_converter, url_converter_scope: t.url_converter_scope }, t.schema), o.fixDoc(e), o.events = t.ownEvents ? new i(t.proxy) : i.Event, o.attrHooks = d(o, t), a = t.schema ? t.schema.getBlockElements() : {}, o.$ = n.overrideDefaults(function () { return { context: e, element: o.getRoot()} }), o.isBlock = function (e) { if (!e) return !1; var t = e.nodeType; return t ? !(1 !== t || !a[e.nodeName]) : !!a[e] } } var p = c.each, h = c.is, m = c.grep, g = c.trim, v = l.ie, y = /^([a-z0-9],?)+$/i, b = /^[ \t\r\n]*$/; return f.prototype = { $$: function (e) { return "string" == typeof e && (e = this.get(e)), this.$(e) }, root: null, fixDoc: function (e) { var t = this.settings, n; if (v && t.schema) { "abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g, function (t) { e.createElement(t) }); for (n in t.schema.getCustomElements()) e.createElement(n) } }, clone: function (e, t) { var n = this, r, i; return !v || 1 !== e.nodeType || t ? e.cloneNode(t) : (i = n.doc, t ? r.firstChild : (r = i.createElement(e.nodeName), p(n.getAttribs(e), function (t) { n.setAttrib(r, t.nodeName, n.getAttrib(e, t.nodeName)) }), r)) }, getRoot: function () { var e = this; return e.settings.root_element || e.doc.body }, getViewPort: function (e) { var t, n; return e = e ? e : this.win, t = e.document, n = this.boxModel ? t.documentElement : t.body, { x: e.pageXOffset || n.scrollLeft, y: e.pageYOffset || n.scrollTop, w: e.innerWidth || n.clientWidth, h: e.innerHeight || n.clientHeight} }, getRect: function (e) { var t = this, n, r; return e = t.get(e), n = t.getPos(e), r = t.getSize(e), { x: n.x, y: n.y, w: r.w, h: r.h} }, getSize: function (e) { var t = this, n, r; return e = t.get(e), n = t.getStyle(e, "width"), r = t.getStyle(e, "height"), -1 === n.indexOf("px") && (n = 0), -1 === r.indexOf("px") && (r = 0), { w: parseInt(n, 10) || e.offsetWidth || e.clientWidth, h: parseInt(r, 10) || e.offsetHeight || e.clientHeight} }, getParent: function (e, t, n) { return this.getParents(e, t, n, !1) }, getParents: function (e, n, r, i) { var o = this, a, s = []; for (e = o.get(e), i = i === t, r = r || ("BODY" != o.getRoot().nodeName ? o.getRoot().parentNode : null), h(n, "string") && (a = n, n = "*" === n ? function (e) { return 1 == e.nodeType } : function (e) { return o.is(e, a) }); e && e != r && e.nodeType && 9 !== e.nodeType; ) { if (!n || n(e)) { if (!i) return e; s.push(e) } e = e.parentNode } return i ? s : null }, get: function (e) { var t; return e && this.doc && "string" == typeof e && (t = e, e = this.doc.getElementById(e), e && e.id !== t) ? this.doc.getElementsByName(t)[1] : e }, getNext: function (e, t) { return this._findSib(e, t, "nextSibling") }, getPrev: function (e, t) { return this._findSib(e, t, "previousSibling") }, select: function (t, n) { var r = this; return e(t, r.get(n) || r.settings.root_element || r.doc, []) }, is: function (n, r) { var i; if (n.length === t) { if ("*" === r) return 1 == n.nodeType; if (y.test(r)) { for (r = r.toLowerCase().split(/,/), n = n.nodeName.toLowerCase(), i = r.length - 1; i >= 0; i--) if (r[i] == n) return !0; return !1 } } if (n.nodeType && 1 != n.nodeType) return !1; var o = n.nodeType ? [n] : n; return e(r, o[0].ownerDocument || o[0], null, o).length > 0 }, add: function (e, t, n, r, i) { var o = this; return this.run(e, function (e) { var a; return a = h(t, "string") ? o.doc.createElement(t) : t, o.setAttribs(a, n), r && (r.nodeType ? a.appendChild(r) : o.setHTML(a, r)), i ? a : e.appendChild(a) }) }, create: function (e, t, n) { return this.add(this.doc.createElement(e), e, t, n, 1) }, createHTML: function (e, t, n) { var r = "", i; r += "<" + e; for (i in t) t.hasOwnProperty(i) && null !== t[i] && "undefined" != typeof t[i] && (r += " " + i + '="' + this.encode(t[i]) + '"'); return "undefined" != typeof n ? r + ">" + n + "</" + e + ">" : r + " />" }, createFragment: function (e) { var t, n, r = this.doc, i; for (i = r.createElement("div"), t = r.createDocumentFragment(), e && (i.innerHTML = e); n = i.firstChild; ) t.appendChild(n); return t }, remove: function (e, t) { return e = this.$$(e), t ? e.each(function () { for (var e; e = this.firstChild; ) 3 == e.nodeType && 0 === e.data.length ? this.removeChild(e) : this.parentNode.insertBefore(e, this) }).remove() : e.remove(), e.length > 1 ? e.toArray() : e[0] }, setStyle: function (e, t, n) { e = this.$$(e).css(t, n), this.settings.update_styles && e.attr("data-mce-style", null) }, getStyle: function (e, n, r) { return e = this.$$(e), r ? e.css(n) : (n = n.replace(/-(\D)/g, function (e, t) { return t.toUpperCase() }), "float" == n && (n = v ? "styleFloat" : "cssFloat"), e[0] && e[0].style ? e[0].style[n] : t) }, setStyles: function (e, t) { e = this.$$(e).css(t), this.settings.update_styles && e.attr("data-mce-style", null) }, removeAllAttribs: function (e) { return this.run(e, function (e) { var t, n = e.attributes; for (t = n.length - 1; t >= 0; t--) e.removeAttributeNode(n.item(t)) }) }, setAttrib: function (e, t, n) { var r = this, i, o, a = r.settings; "" === n && (n = null), e = r.$$(e), i = e.attr(t), e.length && (o = r.attrHooks[t], o && o.set ? o.set(e, n, t) : e.attr(t, n), i != n && a.onSetAttrib && a.onSetAttrib({ attrElm: e, attrName: t, attrValue: n })) }, setAttribs: function (e, t) { var n = this; n.$$(e).each(function (e, r) { p(t, function (e, t) { n.setAttrib(r, t, e) }) }) }, getAttrib: function (e, t, n) { var r = this, i, o; return e = r.$$(e), e.length && (i = r.attrHooks[t], o = i && i.get ? i.get(e, t) : e.attr(t)), "undefined" == typeof o && (o = n || ""), o }, getPos: function (e, t) { var r = this, i = 0, o = 0, a, s = r.doc, l = s.body, c; if (e = r.get(e), t = t || l, e) { if (t === l && e.getBoundingClientRect && "static" === n(l).css("position")) return c = e.getBoundingClientRect(), t = r.boxModel ? s.documentElement : l, i = c.left + (s.documentElement.scrollLeft || l.scrollLeft) - t.clientLeft, o = c.top + (s.documentElement.scrollTop || l.scrollTop) - t.clientTop, { x: i, y: o }; for (a = e; a && a != t && a.nodeType; ) i += a.offsetLeft || 0, o += a.offsetTop || 0, a = a.offsetParent; for (a = e.parentNode; a && a != t && a.nodeType; ) i -= a.scrollLeft || 0, o -= a.scrollTop || 0, a = a.parentNode } return { x: i, y: o} }, parseStyle: function (e) { return this.styles.parse(e) }, serializeStyle: function (e, t) { return this.styles.serialize(e, t) }, addStyle: function (e) { var t = this, n = t.doc, r, i; if (t !== f.DOM && n === document) { var o = f.DOM.addedStyles; if (o = o || [], o[e]) return; o[e] = !0, f.DOM.addedStyles = o } i = n.getElementById("mceDefaultStyles"), i || (i = n.createElement("style"), i.id = "mceDefaultStyles", i.type = "text/css", r = n.getElementsByTagName("head")[0], r.firstChild ? r.insertBefore(i, r.firstChild) : r.appendChild(i)), i.styleSheet ? i.styleSheet.cssText += e : i.appendChild(n.createTextNode(e)) }, loadCSS: function (e) { var t = this, n = t.doc, r; return t !== f.DOM && n === document ? void f.DOM.loadCSS(e) : (e || (e = ""), r = n.getElementsByTagName("head")[0], void p(e.split(","), function (e) { var i; t.files[e] || (t.files[e] = !0, i = t.create("link", { rel: "stylesheet", href: e }), v && n.documentMode && n.recalc && (i.onload = function () { n.recalc && n.recalc(), i.onload = null }), r.appendChild(i)) })) }, addClass: function (e, t) { this.$$(e).addClass(t) }, removeClass: function (e, t) { this.toggleClass(e, t, !1) }, hasClass: function (e, t) { return this.$$(e).hasClass(t) }, toggleClass: function (e, t, r) { this.$$(e).toggleClass(t, r).each(function () { "" === this.className && n(this).attr("class", null) }) }, show: function (e) { this.$$(e).show() }, hide: function (e) { this.$$(e).hide() }, isHidden: function (e) { return "none" == this.$$(e).css("display") }, uniqueId: function (e) { return (e ? e : "mce_") + this.counter++ }, setHTML: function (e, t) { e = this.$$(e), v ? e.each(function (e, r) { if (r.canHaveHTML !== !1) { for (; r.firstChild; ) r.removeChild(r.firstChild); try { r.innerHTML = "<br>" + t, r.removeChild(r.firstChild) } catch (i) { n("<div>").html("<br>" + t).contents().slice(1).appendTo(r) } return t } }) : e.html(t) }, getOuterHTML: function (e) { return e = this.get(e), 1 == e.nodeType ? e.outerHTML : n("<div>").append(n(e).clone()).html() }, setOuterHTML: function (e, t) { var r = this; r.$$(e).each(function () { try { this.outerHTML = t } catch (e) { r.remove(n(this).html(t), !0) } }) }, decode: s.decode, encode: s.encodeAllRaw, insertAfter: function (e, t) { return t = this.get(t), this.run(e, function (e) { var n, r; return n = t.parentNode, r = t.nextSibling, r ? n.insertBefore(e, r) : n.appendChild(e), e }) }, replace: function (e, t, n) { var r = this; return r.run(t, function (t) { return h(t, "array") && (e = e.cloneNode(!0)), n && p(m(t.childNodes), function (t) { e.appendChild(t) }), t.parentNode.replaceChild(e, t) }) }, rename: function (e, t) { var n = this, r; return e.nodeName != t.toUpperCase() && (r = n.create(t), p(n.getAttribs(e), function (t) { n.setAttrib(r, t.nodeName, n.getAttrib(e, t.nodeName)) }), n.replace(r, e, 1)), r || e }, findCommonAncestor: function (e, t) { for (var n = e, r; n; ) { for (r = t; r && n != r; ) r = r.parentNode; if (n == r) break; n = n.parentNode } return !n && e.ownerDocument ? e.ownerDocument.documentElement : n }, toHex: function (e) { return this.styles.toHex(c.trim(e)) }, run: function (e, t, n) { var r = this, i; return "string" == typeof e && (e = r.get(e)), e ? (n = n || this, e.nodeType || !e.length && 0 !== e.length ? t.call(n, e) : (i = [], p(e, function (e, o) { e && ("string" == typeof e && (e = r.get(e)), i.push(t.call(n, e, o))) }), i)) : !1 }, getAttribs: function (e) { var t; if (e = this.get(e), !e) return []; if (v) { if (t = [], "OBJECT" == e.nodeName) return e.attributes; "OPTION" === e.nodeName && this.getAttrib(e, "selected") && t.push({ specified: 1, nodeName: "selected" }); var n = /<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi; return e.cloneNode(!1).outerHTML.replace(n, "").replace(/[\w:\-]+/gi, function (e) { t.push({ specified: 1, nodeName: e }) }), t } return e.attributes }, isEmpty: function (e, t) { var n = this, r, i, a, s, l, c = 0; if (e = e.firstChild) { s = new o(e, e.parentNode), t = t || (n.schema ? n.schema.getNonEmptyElements() : null); do { if (a = e.nodeType, 1 === a) { if (e.getAttribute("data-mce-bogus")) continue; if (l = e.nodeName.toLowerCase(), t && t[l]) { if ("br" === l) { c++; continue } return !1 } for (i = n.getAttribs(e), r = i.length; r--; ) if (l = i[r].nodeName, "name" === l || "data-mce-bookmark" === l) return !1 } if (8 == a) return !1; if (3 === a && !b.test(e.nodeValue)) return !1 } while (e = s.next()) } return 1 >= c }, createRng: function () { var e = this.doc; return e.createRange ? e.createRange() : new a(this) }, nodeIndex: function (e, t) { var n = 0, r, i; if (e) for (r = e.nodeType, e = e.previousSibling; e; e = e.previousSibling) i = e.nodeType, (!t || 3 != i || i != r && e.nodeValue.length) && (n++, r = i); return n }, split: function (e, t, n) { function r(e) { function t(e) { var t = e.previousSibling && "SPAN" == e.previousSibling.nodeName, n = e.nextSibling && "SPAN" == e.nextSibling.nodeName; return t && n } var n, o = e.childNodes, a = e.nodeType; if (1 != a || "bookmark" != e.getAttribute("data-mce-type")) { for (n = o.length - 1; n >= 0; n--) r(o[n]); if (9 != a) { if (3 == a && e.nodeValue.length > 0) { var s = g(e.nodeValue).length; if (!i.isBlock(e.parentNode) || s > 0 || 0 === s && t(e)) return } else if (1 == a && (o = e.childNodes, 1 == o.length && o[0] && 1 == o[0].nodeType && "bookmark" == o[0].getAttribute("data-mce-type") && e.parentNode.insertBefore(o[0], e), o.length || /^(br|hr|input|img)$/i.test(e.nodeName))) return; i.remove(e) } return e } } var i = this, o = i.createRng(), a, s, l; return e && t ? (o.setStart(e.parentNode, i.nodeIndex(e)), o.setEnd(t.parentNode, i.nodeIndex(t)), a = o.extractContents(), o = i.createRng(), o.setStart(t.parentNode, i.nodeIndex(t) + 1), o.setEnd(e.parentNode, i.nodeIndex(e) + 1), s = o.extractContents(), l = e.parentNode, l.insertBefore(r(a), e), n ? l.replaceChild(n, t) : l.insertBefore(t, e), l.insertBefore(r(s), e), i.remove(e), n || t) : void 0 }, bind: function (e, t, n, r) { var i = this; if (c.isArray(e)) { for (var o = e.length; o--; ) e[o] = i.bind(e[o], t, n, r); return e } return !i.settings.collect || e !== i.doc && e !== i.win || i.boundEvents.push([e, t, n, r]), i.events.bind(e, t, n, r || i) }, unbind: function (e, t, n) { var r = this, i; if (c.isArray(e)) { for (i = e.length; i--; ) e[i] = r.unbind(e[i], t, n); return e } if (r.boundEvents && (e === r.doc || e === r.win)) for (i = r.boundEvents.length; i--; ) { var o = r.boundEvents[i]; e != o[0] || t && t != o[1] || n && n != o[2] || this.events.unbind(o[0], o[1], o[2]) } return this.events.unbind(e, t, n) }, fire: function (e, t, n) { return this.events.fire(e, t, n) }, getContentEditable: function (e) { var t; return e && 1 == e.nodeType ? (t = e.getAttribute("data-mce-contenteditable"), t && "inherit" !== t ? t : "inherit" !== e.contentEditable ? e.contentEditable : null) : null }, getContentEditableParent: function (e) { for (var t = this.getRoot(), n = null; e && e !== t && (n = this.getContentEditable(e), null === n); e = e.parentNode); return n }, destroy: function () { var t = this; if (t.boundEvents) { for (var n = t.boundEvents.length; n--; ) { var r = t.boundEvents[n]; this.events.unbind(r[0], r[1], r[2]) } t.boundEvents = null } e.setDocument && e.setDocument(), t.win = t.doc = t.root = t.events = t.frag = null }, isChildOf: function (e, t) { for (; e; ) { if (t === e) return !0; e = e.parentNode } return !1 }, dumpRng: function (e) { return "startContainer: " + e.startContainer.nodeName + ", startOffset: " + e.startOffset + ", endContainer: " + e.endContainer.nodeName + ", endOffset: " + e.endOffset }, _findSib: function (e, t, n) { var r = this, i = t; if (e) for ("string" == typeof i && (i = function (e) { return r.is(e, t) }), e = e[n]; e; e = e[n]) if (i(e)) return e; return null } }, f.DOM = new f(document), f }), r(b, [y, u], function (e, t) { function n() { function e(e, t) { function n() { o.remove(s), a && (a.onreadystatechange = a.onload = a = null), t() } function i() { "undefined" != typeof console && console.log && console.log("Failed to load: " + e) } var o = r, a, s; s = o.uniqueId(), a = document.createElement("script"), a.id = s, a.type = "text/javascript", a.src = e, "onreadystatechange" in a ? a.onreadystatechange = function () { /loaded|complete/.test(a.readyState) && n() } : a.onload = n, a.onerror = i, (document.getElementsByTagName("head")[0] || document.body).appendChild(a) } var t = 0, n = 1, a = 2, s = {}, l = [], c = {}, u = [], d = 0, f; this.isDone = function (e) { return s[e] == a }, this.markDone = function (e) { s[e] = a }, this.add = this.load = function (e, n, r) { var i = s[e]; i == f && (l.push(e), s[e] = t), n && (c[e] || (c[e] = []), c[e].push({ func: n, scope: r || this })) }, this.loadQueue = function (e, t) { this.loadScripts(l, e, t) }, this.loadScripts = function (t, r, l) { function p(e) { i(c[e], function (e) { e.func.call(e.scope) }), c[e] = f } var h; u.push({ func: r, scope: l || this }), (h = function () { var r = o(t); t.length = 0, i(r, function (t) { return s[t] == a ? void p(t) : void (s[t] != n && (s[t] = n, d++, e(t, function () { s[t] = a, d--, p(t), h() }))) }), d || (i(u, function (e) { e.func.call(e.scope) }), u.length = 0) })() } } var r = e.DOM, i = t.each, o = t.grep; return n.ScriptLoader = new n, n }), r(C, [b, u], function (e, n) { function r() { var e = this; e.items = [], e.urls = {}, e.lookup = {} } var i = n.each; return r.prototype = { get: function (e) { return this.lookup[e] ? this.lookup[e].instance : t }, dependencies: function (e) { var t; return this.lookup[e] && (t = this.lookup[e].dependencies), t || [] }, requireLangPack: function (t, n) { var i = r.language; if (i && r.languageLoad !== !1) { if (n) if (n = "," + n + ",", -1 != n.indexOf("," + i.substr(0, 2) + ",")) i = i.substr(0, 2); else if (-1 == n.indexOf("," + i + ",")) return; e.ScriptLoader.add(this.urls[t] + "/langs/" + i + ".js") } }, add: function (e, t, n) { return this.items.push(t), this.lookup[e] = { instance: t, dependencies: n }, t }, createUrl: function (e, t) { return "object" == typeof t ? t : { prefix: e.prefix, resource: t, suffix: e.suffix} }, addComponents: function (t, n) { var r = this.urls[t]; i(n, function (t) { e.ScriptLoader.add(r + "/" + t) }) }, load: function (n, o, a, s) { function l() { var r = c.dependencies(n); i(r, function (e) { var n = c.createUrl(o, e); c.load(n.resource, n, t, t) }), a && a.call(s ? s : e) } var c = this, u = o; c.urls[n] || ("object" == typeof o && (u = o.prefix + o.resource + o.suffix), 0 !== u.indexOf("/") && -1 == u.indexOf("://") && (u = r.baseURL + "/" + u), c.urls[n] = u.substring(0, u.lastIndexOf("/")), c.lookup[n] ? l() : e.ScriptLoader.add(u, l, s)) } }, r.PluginManager = new r, r.ThemeManager = new r, r }), r(x, [u, h], function (e, t) { function n(e, t) { var n = e.childNodes; return t--, t > n.length - 1 ? t = n.length - 1 : 0 > t && (t = 0), n[t] || e } function r(e) { this.walk = function (t, r) { function o(e) { var t; return t = e[0], 3 === t.nodeType && t === c && u >= t.nodeValue.length && e.splice(0, 1), t = e[e.length - 1], 0 === f && e.length > 0 && t === d && 3 === t.nodeType && e.splice(e.length - 1, 1), e } function a(e, t, n) { for (var r = []; e && e != n; e = e[t]) r.push(e); return r } function s(e, t) { do { if (e.parentNode == t) return e; e = e.parentNode } while (e) } function l(e, t, n) { var i = n ? "nextSibling" : "previousSibling"; for (g = e, v = g.parentNode; g && g != t; g = v) v = g.parentNode, y = a(g == e ? g : g[i], i), y.length && (n || y.reverse(), r(o(y))) } var c = t.startContainer, u = t.startOffset, d = t.endContainer, f = t.endOffset, p, h, m, g, v, y, b; if (b = e.select("td.mce-item-selected,th.mce-item-selected"), b.length > 0) return void i(b, function (e) { r([e]) }); if (1 == c.nodeType && c.hasChildNodes() && (c = c.childNodes[u]), 1 == d.nodeType && d.hasChildNodes() && (d = n(d, f)), c == d) return r(o([c])); for (p = e.findCommonAncestor(c, d), g = c; g; g = g.parentNode) { if (g === d) return l(c, p, !0); if (g === p) break } for (g = d; g; g = g.parentNode) { if (g === c) return l(d, p); if (g === p) break } h = s(c, p) || c, m = s(d, p) || d, l(c, h, !0), y = a(h == c ? h : h.nextSibling, "nextSibling", m == d ? m.nextSibling : m), y.length && r(o(y)), l(d, m) }, this.split = function (e) { function t(e, t) { return e.splitText(t) } var n = e.startContainer, r = e.startOffset, i = e.endContainer, o = e.endOffset; return n == i && 3 == n.nodeType ? r > 0 && r < n.nodeValue.length && (i = t(n, r), n = i.previousSibling, o > r ? (o -= r, n = i = t(i, o).previousSibling, o = i.nodeValue.length, r = 0) : o = 0) : (3 == n.nodeType && r > 0 && r < n.nodeValue.length && (n = t(n, r), r = 0), 3 == i.nodeType && o > 0 && o < i.nodeValue.length && (i = t(i, o).previousSibling, o = i.nodeValue.length)), { startContainer: n, startOffset: r, endContainer: i, endOffset: o} }, this.normalize = function (n) { function r(r) { function a(n, r) { for (var i = new t(n, e.getParent(n.parentNode, e.isBlock) || f); n = i[r ? "prev" : "next"](); ) if ("BR" === n.nodeName) return !0 } function s(e, t) { return e.previousSibling && e.previousSibling.nodeName == t } function l(n, r) { var a, s, l; if (r = r || c, l = e.getParent(r.parentNode, e.isBlock) || f, n && "BR" == r.nodeName && g && e.isEmpty(l)) return c = r.parentNode, u = e.nodeIndex(r), void (i = !0); for (a = new t(r, l); p = a[n ? "prev" : "next"](); ) { if ("false" === e.getContentEditableParent(p)) return; if (3 === p.nodeType && p.nodeValue.length > 0) return c = p, u = n ? p.nodeValue.length : 0, void (i = !0); if (e.isBlock(p) || h[p.nodeName.toLowerCase()]) return; s = p } o && s && (c = s, i = !0, u = 0) } var c, u, d, f = e.getRoot(), p, h, m, g; if (c = n[(r ? "start" : "end") + "Container"], u = n[(r ? "start" : "end") + "Offset"], g = 1 == c.nodeType && u === c.childNodes.length, h = e.schema.getNonEmptyElements(), m = r, 1 == c.nodeType && u > c.childNodes.length - 1 && (m = !1), 9 === c.nodeType && (c = e.getRoot(), u = 0), c === f) { if (m && (p = c.childNodes[u > 0 ? u - 1 : 0], p && (h[p.nodeName] || "TABLE" == p.nodeName))) return; if (c.hasChildNodes() && (u = Math.min(!m && u > 0 ? u - 1 : u, c.childNodes.length - 1), c = c.childNodes[u], u = 0, c.hasChildNodes() && !/TABLE/.test(c.nodeName))) { p = c, d = new t(c, f); do { if (3 === p.nodeType && p.nodeValue.length > 0) { u = m ? 0 : p.nodeValue.length, c = p, i = !0; break } if (h[p.nodeName.toLowerCase()]) { u = e.nodeIndex(p), c = p.parentNode, "IMG" != p.nodeName || m || u++, i = !0; break } } while (p = m ? d.next() : d.prev()) } } o && (3 === c.nodeType && 0 === u && l(!0), 1 === c.nodeType && (p = c.childNodes[u], p || (p = c.childNodes[u - 1]), !p || "BR" !== p.nodeName || s(p, "A") || a(p) || a(p, !0) || l(!0, p))), m && !o && 3 === c.nodeType && u === c.nodeValue.length && l(!1), i && n["set" + (r ? "Start" : "End")](c, u) } var i, o; return o = n.collapsed, r(!0), o || r(), i && o && n.collapse(!0), i } } var i = e.each; return r.compareRanges = function (e, t) { if (e && t) { if (!e.item && !e.duplicate) return e.startContainer == t.startContainer && e.startOffset == t.startOffset; if (e.item && t.item && e.item(0) === t.item(0)) return !0; if (e.isEqual && t.isEqual && t.isEqual(e)) return !0 } return !1 }, r }), r(w, [x], function (e) { return function (t) { function n(e) { var n, r; if (r = t.$(e).parentsUntil(t.getBody()).add(e), r.length === i.length) { for (n = r.length; n >= 0 && r[n] === i[n]; n--); if (-1 === n) return i = r, !0 } return i = r, !1 } var r, i = []; "onselectionchange" in t.getDoc() || t.on("NodeChange Click MouseUp KeyUp Focus", function (n) { var i, o; i = t.selection.getRng(), o = { startContainer: i.startContainer, startOffset: i.startOffset, endContainer: i.endContainer, endOffset: i.endOffset }, "nodechange" != n.type && e.compareRanges(o, r) || t.fire("SelectionChange"), r = o }), t.on("contextmenu", function () { t.fire("SelectionChange") }), t.on("SelectionChange", function () { var e = t.selection.getStart(!0); t.selection.isCollapsed() || n(e) || !t.dom.isChildOf(e, t.getBody()) || t.nodeChanged({ selectionChange: !0 }) }), t.on("MouseUp", function (e) { e.isDefaultPrevented() || setTimeout(function () { t.nodeChanged() }, 0) }), this.nodeChanged = function (e) { var n = t.selection, r, i, o; t.initialized && n && !t.settings.disable_nodechange && !t.settings.readonly && (o = t.getBody(), r = n.getStart() || o, r = r.ownerDocument != t.getDoc() ? t.getBody() : r, "IMG" == r.nodeName && n.isCollapsed() && (r = r.parentNode), i = [], t.dom.getParent(r, function (e) { return e === o ? !0 : void i.push(e) }), e = e || {}, e.element = r, e.parents = i, t.fire("NodeChange", e)) } } }), r(_, [], function () { function e(e, t, n) { var r, i, o = n ? "lastChild" : "firstChild", a = n ? "prev" : "next"; if (e[o]) return e[o]; if (e !== t) { if (r = e[a]) return r; for (i = e.parent; i && i !== t; i = i.parent) if (r = i[a]) return r } } function t(e, t) { this.name = e, this.type = t, 1 === t && (this.attributes = [], this.attributes.map = {}) } var n = /^[ \t\r\n]*$/, r = { "#text": 3, "#comment": 8, "#cdata": 4, "#pi": 7, "#doctype": 10, "#document-fragment": 11 }; return t.prototype = { replace: function (e) { var t = this; return e.parent && e.remove(), t.insert(e, t), t.remove(), t }, attr: function (e, t) { var n = this, r, i, o; if ("string" != typeof e) { for (i in e) n.attr(i, e[i]); return n } if (r = n.attributes) { if (t !== o) { if (null === t) { if (e in r.map) for (delete r.map[e], i = r.length; i--; ) if (r[i].name === e) return r = r.splice(i, 1), n; return n } if (e in r.map) { for (i = r.length; i--; ) if (r[i].name === e) { r[i].value = t; break } } else r.push({ name: e, value: t }); return r.map[e] = t, n } return r.map[e] } }, clone: function () { var e = this, n = new t(e.name, e.type), r, i, o, a, s; if (o = e.attributes) { for (s = [], s.map = {}, r = 0, i = o.length; i > r; r++) a = o[r], "id" !== a.name && (s[s.length] = { name: a.name, value: a.value }, s.map[a.name] = a.value); n.attributes = s } return n.value = e.value, n.shortEnded = e.shortEnded, n }, wrap: function (e) { var t = this; return t.parent.insert(e, t), e.append(t), t }, unwrap: function () { var e = this, t, n; for (t = e.firstChild; t; ) n = t.next, e.insert(t, e, !0), t = n; e.remove() }, remove: function () { var e = this, t = e.parent, n = e.next, r = e.prev; return t && (t.firstChild === e ? (t.firstChild = n, n && (n.prev = null)) : r.next = n, t.lastChild === e ? (t.lastChild = r, r && (r.next = null)) : n.prev = r, e.parent = e.next = e.prev = null), e }, append: function (e) { var t = this, n; return e.parent && e.remove(), n = t.lastChild, n ? (n.next = e, e.prev = n, t.lastChild = e) : t.lastChild = t.firstChild = e, e.parent = t, e }, insert: function (e, t, n) { var r; return e.parent && e.remove(), r = t.parent || this, n ? (t === r.firstChild ? r.firstChild = e : t.prev.next = e, e.prev = t.prev, e.next = t, t.prev = e) : (t === r.lastChild ? r.lastChild = e : t.next.prev = e, e.next = t.next, e.prev = t, t.next = e), e.parent = r, e }, getAll: function (t) { var n = this, r, i = []; for (r = n.firstChild; r; r = e(r, n)) r.name === t && i.push(r); return i }, empty: function () { var t = this, n, r, i; if (t.firstChild) { for (n = [], i = t.firstChild; i; i = e(i, t)) n.push(i); for (r = n.length; r--; ) i = n[r], i.parent = i.firstChild = i.lastChild = i.next = i.prev = null } return t.firstChild = t.lastChild = null, t }, isEmpty: function (t) { var r = this, i = r.firstChild, o, a; if (i) do { if (1 === i.type) { if (i.attributes.map["data-mce-bogus"]) continue; if (t[i.name]) return !1; for (o = i.attributes.length; o--; ) if (a = i.attributes[o].name, "name" === a || 0 === a.indexOf("data-mce-bookmark")) return !1 } if (8 === i.type) return !1; if (3 === i.type && !n.test(i.value)) return !1 } while (i = e(i, r)); return !0 }, walk: function (t) { return e(this, null, t) } }, t.create = function (e, n) { var i, o; if (i = new t(e, r[e] || 1), n) for (o in n) i.attr(o, n[o]); return i }, t }), r(E, [u], function (e) { function t(e, t) { return e ? e.split(t || " ") : [] } function n(e) { function n(e, n, r) { function i(e, t) { var n = {}, r, i; for (r = 0, i = e.length; i > r; r++) n[e[r]] = t || {}; return n } var s, c, u, d = arguments; for (r = r || [], n = n || "", "string" == typeof r && (r = t(r)), c = 3; c < d.length; c++) "string" == typeof d[c] && (d[c] = t(d[c])), r.push.apply(r, d[c]); for (e = t(e), s = e.length; s--; ) u = [].concat(l, t(n)), a[e[s]] = { attributes: i(u), attributesOrder: u, children: i(r, o)} } function r(e, n) { var r, i, o, s; for (e = t(e), r = e.length, n = t(n); r--; ) for (i = a[e[r]], o = 0, s = n.length; s > o; o++) i.attributes[n[o]] = {}, i.attributesOrder.push(n[o]) } var a = {}, l, c, u, d, f, p; return i[e] ? i[e] : (l = t("id accesskey class dir lang style tabindex title"), c = t("address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul"), u = t("a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment"), "html4" != e && (l.push.apply(l, t("contenteditable contextmenu draggable dropzone hidden spellcheck translate")), c.push.apply(c, t("article aside details dialog figure header footer hgroup section nav")), u.push.apply(u, t("audio canvas command datalist mark meter output progress time wbr video ruby bdi keygen"))), "html5-strict" != e && (l.push("xml:lang"), p = t("acronym applet basefont big font strike tt"), u.push.apply(u, p), s(p, function (e) { n(e, "", u) }), f = t("center dir isindex noframes"), c.push.apply(c, f), d = [].concat(c, u), s(f, function (e) { n(e, "", d) })), d = d || [].concat(c, u), n("html", "manifest", "head body"), n("head", "", "base command link meta noscript script style title"), n("title hr noscript br"), n("base", "href target"), n("link", "href rel media hreflang type sizes hreflang"), n("meta", "name http-equiv content charset"), n("style", "media type scoped"), n("script", "src async defer type charset"), n("body", "onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload", d), n("address dt dd div caption", "", d), n("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn", "", u), n("blockquote", "cite", d), n("ol", "reversed start type", "li"), n("ul", "", "li"), n("li", "value", d), n("dl", "", "dt dd"), n("a", "href target rel media hreflang type", u), n("q", "cite", u), n("ins del", "cite datetime", d), n("img", "src alt usemap ismap width height"), n("iframe", "src name width height", d), n("embed", "src type width height"), n("object", "data type typemustmatch name usemap form width height", d, "param"), n("param", "name value"), n("map", "name", d, "area"), n("area", "alt coords shape href target rel media hreflang type"), n("table", "border", "caption colgroup thead tfoot tbody tr" + ("html4" == e ? " col" : "")), n("colgroup", "span", "col"), n("col", "span"), n("tbody thead tfoot", "", "tr"), n("tr", "", "td th"), n("td", "colspan rowspan headers", d), n("th", "colspan rowspan headers scope abbr", d), n("form", "accept-charset action autocomplete enctype method name novalidate target", d), n("fieldset", "disabled form name", d, "legend"), n("label", "form for", u), n("input", "accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"), n("button", "disabled form formaction formenctype formmethod formnovalidate formtarget name type value", "html4" == e ? d : u), n("select", "disabled form multiple name required size", "option optgroup"), n("optgroup", "disabled label", "option"), n("option", "disabled label selected value"), n("textarea", "cols dirname disabled form maxlength name readonly required rows wrap"), n("menu", "type label", d, "li"), n("noscript", "", d), "html4" != e && (n("wbr"), n("ruby", "", u, "rt rp"), n("figcaption", "", d), n("mark rt rp summary bdi", "", u), n("canvas", "width height", d), n("video", "src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered", d, "track source"), n("audio", "src crossorigin preload autoplay mediagroup loop muted controls buffered volume", d, "track source"), n("source", "src type media"), n("track", "kind src srclang label default"), n("datalist", "", u, "option"), n("article section nav aside header footer", "", d), n("hgroup", "", "h1 h2 h3 h4 h5 h6"), n("figure", "", d, "figcaption"), n("time", "datetime", u), n("dialog", "open", d), n("command", "type label icon disabled checked radiogroup command"), n("output", "for form name", u), n("progress", "value max", u), n("meter", "value min max low high optimum", u), n("details", "open", d, "summary"), n("keygen", "autofocus challenge disabled form keytype name")), "html5-strict" != e && (r("script", "language xml:space"), r("style", "xml:space"), r("object", "declare classid code codebase codetype archive standby align border hspace vspace"), r("embed", "align name hspace vspace"), r("param", "valuetype type"), r("a", "charset name rev shape coords"), r("br", "clear"), r("applet", "codebase archive code object alt name width height align hspace vspace"), r("img", "name longdesc align border hspace vspace"), r("iframe", "longdesc frameborder marginwidth marginheight scrolling align"), r("font basefont", "size color face"), r("input", "usemap align"), r("select", "onchange"), r("textarea"), r("h1 h2 h3 h4 h5 h6 div p legend caption", "align"), r("ul", "type compact"), r("li", "type"), r("ol dl menu dir", "compact"), r("pre", "width xml:space"), r("hr", "align noshade size width"), r("isindex", "prompt"), r("table", "summary width frame rules cellspacing cellpadding align bgcolor"), r("col", "width align char charoff valign"), r("colgroup", "width align char charoff valign"), r("thead", "align char charoff valign"), r("tr", "align char charoff valign bgcolor"), r("th", "axis align char charoff valign nowrap bgcolor width height"), r("form", "accept"), r("td", "abbr axis scope align char charoff valign nowrap bgcolor width height"), r("tfoot", "align char charoff valign"), r("tbody", "align char charoff valign"), r("area", "nohref"), r("body", "background bgcolor text link vlink alink")), "html4" != e && (r("input button select textarea", "autofocus"), r("input textarea", "placeholder"), r("a", "download"), r("link script img", "crossorigin"), r("iframe", "sandbox seamless allowfullscreen")), s(t("a form meter progress dfn"), function (e) { a[e] && delete a[e].children[e] }), delete a.caption.children.table, i[e] = a, a) } function r(e, t) { var n; return e && (n = {}, "string" == typeof e && (e = { "*": e }), s(e, function (e, r) { n[r] = "map" == t ? a(e, /[, ]/) : c(e, /[, ]/) })), n } var i = {}, o = {}, a = e.makeMap, s = e.each, l = e.extend, c = e.explode, u = e.inArray; return function (e) { function o(t, n, r) { var o = e[t]; return o ? o = a(o, /[, ]/, a(o.toUpperCase(), /[, ]/)) : (o = i[t], o || (o = a(n, " ", a(n.toUpperCase(), " ")), o = l(o, r), i[t] = o)), o } function d(e) { return new RegExp("^" + e.replace(/([?+*])/g, ".$1") + "$") } function f(e) { var n, r, i, o, s, l, c, f, p, h, m, g, v, b, x, w, _, E, N, k = /^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/, S = /^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/, T = /[*?+]/; if (e) for (e = t(e, ","), y["@"] && (w = y["@"].attributes, _ = y["@"].attributesOrder), n = 0, r = e.length; r > n; n++) if (s = k.exec(e[n])) { if (b = s[1], p = s[2], x = s[3], f = s[5], g = {}, v = [], l = { attributes: g, attributesOrder: v }, "#" === b && (l.paddEmpty = !0), "-" === b && (l.removeEmpty = !0), "!" === s[4] && (l.removeEmptyAttrs = !0), w) { for (E in w) g[E] = w[E]; v.push.apply(v, _) } if (f) for (f = t(f, "|"), i = 0, o = f.length; o > i; i++) if (s = S.exec(f[i])) { if (c = {}, m = s[1], h = s[2].replace(/::/g, ":"), b = s[3], N = s[4], "!" === m && (l.attributesRequired = l.attributesRequired || [], l.attributesRequired.push(h), c.required = !0), "-" === m) { delete g[h], v.splice(u(v, h), 1); continue } b && ("=" === b && (l.attributesDefault = l.attributesDefault || [], l.attributesDefault.push({ name: h, value: N }), c.defaultValue = N), ":" === b && (l.attributesForced = l.attributesForced || [], l.attributesForced.push({ name: h, value: N }), c.forcedValue = N), "<" === b && (c.validValues = a(N, "?"))), T.test(h) ? (l.attributePatterns = l.attributePatterns || [], c.pattern = d(h), l.attributePatterns.push(c)) : (g[h] || v.push(h), g[h] = c) } w || "@" != p || (w = g, _ = v), x && (l.outputName = p, y[x] = l), T.test(p) ? (l.pattern = d(p), C.push(l)) : y[p] = l } } function p(e) { y = {}, C = [], f(e), s(_, function (e, t) { b[t] = e.children }) } function h(e) { var n = /^(~)?(.+)$/; e && (i.text_block_elements = i.block_elements = null, s(t(e, ","), function (e) { var t = n.exec(e), r = "~" === t[1], i = r ? "span" : "div", o = t[2]; if (b[o] = b[i], L[o] = i, r || (R[o.toUpperCase()] = {}, R[o] = {}), !y[o]) { var a = y[i]; a = l({}, a), delete a.removeEmptyAttrs, delete a.removeEmpty, y[o] = a } s(b, function (e, t) { e[i] && (b[t] = e = l({}, b[t]), e[o] = e[i]) }) })) } function m(e) { var n = /^([+\-]?)(\w+)\[([^\]]+)\]$/; e && s(t(e, ","), function (e) { var r = n.exec(e), i, o; r && (o = r[1], i = o ? b[r[2]] : b[r[2]] = { "#comment": {} }, i = b[r[2]], s(t(r[3], "|"), function (e) { "-" === o ? (b[r[2]] = i = l({}, b[r[2]]), delete i[e]) : i[e] = {} })) }) } function g(e) { var t = y[e], n; if (t) return t; for (n = C.length; n--; ) if (t = C[n], t.pattern.test(e)) return t } var v = this, y = {}, b = {}, C = [], x, w, _, E, N, k, S, T, R, A, B, D, L = {}, H = {}; e = e || {}, _ = n(e.schema), e.verify_html === !1 && (e.valid_elements = "*[*]"), x = r(e.valid_styles), w = r(e.invalid_styles, "map"), T = r(e.valid_classes, "map"), E = o("whitespace_elements", "pre script noscript style textarea video audio iframe object"), N = o("self_closing_elements", "colgroup dd dt li option p td tfoot th thead tr"), k = o("short_ended_elements", "area base basefont br col frame hr img input isindex link meta param embed source wbr track"), S = o("boolean_attributes", "checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"), A = o("non_empty_elements", "td th iframe video audio object script", k), B = o("text_block_elements", "h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"), R = o("block_elements", "hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup", B), D = o("text_inline_elements", "span strong b em i font strike u var cite dfn code mark q sup sub samp"), s((e.special || "script noscript style textarea").split(" "), function (e) { H[e] = new RegExp("</" + e + "[^>]*>", "gi") }), e.valid_elements ? p(e.valid_elements) : (s(_, function (e, t) { y[t] = { attributes: e.attributes, attributesOrder: e.attributesOrder }, b[t] = e.children }), "html5" != e.schema && s(t("strong/b em/i"), function (e) { e = t(e, "/"), y[e[1]].outputName = e[0] }), y.img.attributesDefault = [{ name: "alt", value: ""}], s(t("ol ul sub sup blockquote span font a table tbody tr strong em b i"), function (e) { y[e] && (y[e].removeEmpty = !0) }), s(t("p h1 h2 h3 h4 h5 h6 th td pre div address caption"), function (e) { y[e].paddEmpty = !0 }), s(t("span"), function (e) { y[e].removeEmptyAttrs = !0 })), h(e.custom_elements), m(e.valid_children), f(e.extended_valid_elements), m("+ol[ul|ol],+ul[ul|ol]"), e.invalid_elements && s(c(e.invalid_elements), function (e) { y[e] && delete y[e] }), g("span") || f("span[!data-mce-type|*]"), v.children = b, v.getValidStyles = function () { return x }, v.getInvalidStyles = function () { return w }, v.getValidClasses = function () { return T }, v.getBoolAttrs = function () { return S }, v.getBlockElements = function () { return R }, v.getTextBlockElements = function () { return B }, v.getTextInlineElements = function () { return D }, v.getShortEndedElements = function () { return k }, v.getSelfClosingElements = function () { return N }, v.getNonEmptyElements = function () { return A }, v.getWhiteSpaceElements = function () { return E }, v.getSpecialElements = function () { return H }, v.isValidChild = function (e, t) { var n = b[e]; return !(!n || !n[t]) }, v.isValid = function (e, t) { var n, r, i = g(e); if (i) { if (!t) return !0; if (i.attributes[t]) return !0; if (n = i.attributePatterns) for (r = n.length; r--; ) if (n[r].pattern.test(e)) return !0 } return !1 }, v.getElementRule = g, v.getCustomElements = function () { return L }, v.addValidElements = f, v.setValidElements = p, v.addCustomElements = h, v.addValidChildren = m, v.elements = y } }), r(N, [E, g, u], function (e, t, n) { function r(e, t, n) { var r = 1, i, o, a, s; for (s = e.getShortEndedElements(), a = /<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g, a.lastIndex = i = n; o = a.exec(t); ) { if (i = a.lastIndex, "/" === o[1]) r--; else if (!o[1]) { if (o[2] in s) continue; r++ } if (0 === r) break } return i } function i(i, a) { function s() { } var l = this; i = i || {}, l.schema = a = a || new e, i.fix_self_closing !== !1 && (i.fix_self_closing = !0), o("comment cdata text start end pi doctype".split(" "), function (e) { e && (l[e] = i[e] || s) }), l.parse = function (e) { function o(e) { var t, n; for (t = p.length; t-- && p[t].name !== e; ); if (t >= 0) { for (n = p.length - 1; n >= t; n--) e = p[n], e.valid && l.end(e.name); p.length = t } } function s(e, t, n, r, o) { var a, s, l = /[\s\u0000-\u001F]+/g; if (t = t.toLowerCase(), n = t in x ? t : z(n || r || o || ""), _ && !y && 0 !== t.indexOf("data-")) { if (a = T[t], !a && R) { for (s = R.length; s-- && (a = R[s], !a.pattern.test(t)); ); -1 === s && (a = null) } if (!a) return; if (a.validValues && !(n in a.validValues)) return } if (V[t] && !i.allow_script_urls) { var c = n.replace(l, ""); try { c = decodeURIComponent(c) } catch (u) { c = unescape(c) } if (U.test(c)) return; if (!i.allow_html_data_urls && $.test(c) && !/^data:image\//i.test(c)) return } h.map[t] = n, h.push({ name: t, value: n }) } var l = this, c, u = 0, d, f, p = [], h, m, g, v, y, b, C, x, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I, F = 0, z = t.decode, W, V = n.makeMap("src,href,data,background,formaction,poster"), U = /((java|vb)script|mhtml):/i, $ = /^data:/i; for (M = new RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))", "g"), P = /([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g, C = a.getShortEndedElements(), H = i.self_closing_elements || a.getSelfClosingElements(), x = a.getBoolAttrs(), _ = i.validate, b = i.remove_internals, W = i.fix_self_closing, O = a.getSpecialElements(); c = M.exec(e); ) { if (u < c.index && l.text(z(e.substr(u, c.index - u))), d = c[6]) d = d.toLowerCase(), ":" === d.charAt(0) && (d = d.substr(1)), o(d); else if (d = c[7]) { if (d = d.toLowerCase(), ":" === d.charAt(0) && (d = d.substr(1)), w = d in C, W && H[d] && p.length > 0 && p[p.length - 1].name === d && o(d), !_ || (E = a.getElementRule(d))) { if (N = !0, _ && (T = E.attributes, R = E.attributePatterns), (S = c[8]) ? (y = -1 !== S.indexOf("data-mce-type"), y && b && (N = !1), h = [], h.map = {}, S.replace(P, s)) : (h = [], h.map = {}), _ && !y) { if (A = E.attributesRequired, B = E.attributesDefault, D = E.attributesForced, L = E.removeEmptyAttrs, L && !h.length && (N = !1), D) for (m = D.length; m--; ) k = D[m], v = k.name, I = k.value, "{$uid}" === I && (I = "mce_" + F++), h.map[v] = I, h.push({ name: v, value: I }); if (B) for (m = B.length; m--; ) k = B[m], v = k.name, v in h.map || (I = k.value, "{$uid}" === I && (I = "mce_" + F++), h.map[v] = I, h.push({ name: v, value: I })); if (A) { for (m = A.length; m-- && !(A[m] in h.map); ); -1 === m && (N = !1) } if (k = h.map["data-mce-bogus"]) { if ("all" === k) { u = r(a, e, M.lastIndex), M.lastIndex = u; continue } N = !1 } } N && l.start(d, h, w) } else N = !1; if (f = O[d]) { f.lastIndex = u = c.index + c[0].length, (c = f.exec(e)) ? (N && (g = e.substr(u, c.index - u)), u = c.index + c[0].length) : (g = e.substr(u), u = e.length), N && (g.length > 0 && l.text(g, !0), l.end(d)), M.lastIndex = u; continue } w || (S && S.indexOf("/") == S.length - 1 ? N && l.end(d) : p.push({ name: d, valid: N })) } else (d = c[1]) ? (">" === d.charAt(0) && (d = " " + d), i.allow_conditional_comments || "[if" !== d.substr(0, 3) || (d = " " + d), l.comment(d)) : (d = c[2]) ? l.cdata(d) : (d = c[3]) ? l.doctype(d) : (d = c[4]) && l.pi(d, c[5]); u = c.index + c[0].length } for (u < e.length && l.text(z(e.substr(u))), m = p.length - 1; m >= 0; m--) d = p[m], d.valid && l.end(d.name) } } var o = n.each; return i.findEndTag = r, i }), r(k, [_, E, N, u], function (e, t, n, r) { var i = r.makeMap, o = r.each, a = r.explode, s = r.extend; return function (r, l) { function c(t) { var n, r, o, a, s, c, d, f, p, h, m, g, v, y; for (m = i("tr,td,th,tbody,thead,tfoot,table"), h = l.getNonEmptyElements(), g = l.getTextBlockElements(), n = 0; n < t.length; n++) if (r = t[n], r.parent && !r.fixed) if (g[r.name] && "li" == r.parent.name) { for (v = r.next; v && g[v.name]; ) v.name = "li", v.fixed = !0, r.parent.insert(v, r.parent), v = v.next; r.unwrap(r) } else { for (a = [r], o = r.parent; o && !l.isValidChild(o.name, r.name) && !m[o.name]; o = o.parent) a.push(o); if (o && a.length > 1) { for (a.reverse(), s = c = u.filterNode(a[0].clone()), p = 0; p < a.length - 1; p++) { for (l.isValidChild(c.name, a[p].name) ? (d = u.filterNode(a[p].clone()), c.append(d)) : d = c, f = a[p].firstChild; f && f != a[p + 1]; ) y = f.next, d.append(f), f = y; c = d } s.isEmpty(h) ? o.insert(r, a[0], !0) : (o.insert(s, a[0], !0), o.insert(r, s)), o = a[0], (o.isEmpty(h) || o.firstChild === o.lastChild && "br" === o.firstChild.name) && o.empty().remove() } else if (r.parent) { if ("li" === r.name) { if (v = r.prev, v && ("ul" === v.name || "ul" === v.name)) { v.append(r); continue } if (v = r.next, v && ("ul" === v.name || "ul" === v.name)) { v.insert(r, v.firstChild, !0); continue } r.wrap(u.filterNode(new e("ul", 1))); continue } l.isValidChild(r.parent.name, "div") && l.isValidChild("div", r.name) ? r.wrap(u.filterNode(new e("div", 1))) : "style" === r.name || "script" === r.name ? r.empty().remove() : r.unwrap() } } } var u = this, d = {}, f = [], p = {}, h = {}; r = r || {}, r.validate = "validate" in r ? r.validate : !0, r.root_name = r.root_name || "body", u.schema = l = l || new t, u.filterNode = function (e) { var t, n, r; n in d && (r = p[n], r ? r.push(e) : p[n] = [e]), t = f.length; for (; t--; ) n = f[t].name, n in e.attributes.map && (r = h[n], r ? r.push(e) : h[n] = [e]); return e }, u.addNodeFilter = function (e, t) { o(a(e), function (e) { var n = d[e]; n || (d[e] = n = []), n.push(t) }) }, u.addAttributeFilter = function (e, t) { o(a(e), function (e) { var n; for (n = 0; n < f.length; n++) if (f[n].name === e) return void f[n].callbacks.push(t); f.push({ name: e, callbacks: [t] }) }) }, u.parse = function (t, o) { function a() { function e(e) { e && (t = e.firstChild, t && 3 == t.type && (t.value = t.value.replace(R, "")), t = e.lastChild, t && 3 == t.type && (t.value = t.value.replace(D, ""))) } var t = y.firstChild, n, i; if (l.isValidChild(y.name, I.toLowerCase())) { for (; t; ) n = t.next, 3 == t.type || 1 == t.type && "p" !== t.name && !T[t.name] && !t.attr("data-mce-type") ? i ? i.append(t) : (i = u(I, 1), i.attr(r.forced_root_block_attrs), y.insert(i, t), i.append(t)) : (e(i), i = null), t = n; e(i) } } function u(t, n) { var r = new e(t, n), i; return t in d && (i = p[t], i ? i.push(r) : p[t] = [r]), r } function m(e) { var t, n, r; for (t = e.prev; t && 3 === t.type; ) n = t.value.replace(D, ""), n.length > 0 ? (t.value = n, t = t.prev) : (r = t.prev, t.remove(), t = r) } function g(e) { var t, n = {}; for (t in e) "li" !== t && "p" != t && (n[t] = e[t]); return n } var v, y, b, C, x, w, _, E, N, k, S, T, R, A = [], B, D, L, H, M, P, O, I; if (o = o || {}, p = {}, h = {}, T = s(i("script,style,head,html,body,title,meta,param"), l.getBlockElements()), O = l.getNonEmptyElements(), P = l.children, S = r.validate, I = "forced_root_block" in o ? o.forced_root_block : r.forced_root_block, M = l.getWhiteSpaceElements(), R = /^[ \t\r\n]+/, D = /[ \t\r\n]+$/, L = /[ \t\r\n]+/g, H = /^[ \t\r\n]+$/, v = new n({ validate: S, allow_script_urls: r.allow_script_urls, allow_conditional_comments: r.allow_conditional_comments, self_closing_elements: g(l.getSelfClosingElements()), cdata: function (e) { b.append(u("#cdata", 4)).value = e }, text: function (e, t) { var n; B || (e = e.replace(L, " "), b.lastChild && T[b.lastChild.name] && (e = e.replace(R, ""))), 0 !== e.length && (n = u("#text", 3), n.raw = !!t, b.append(n).value = e) }, comment: function (e) { b.append(u("#comment", 8)).value = e }, pi: function (e, t) { b.append(u(e, 7)).value = t, m(b) }, doctype: function (e) { var t; t = b.append(u("#doctype", 10)), t.value = e, m(b) }, start: function (e, t, n) { var r, i, o, a, s; if (o = S ? l.getElementRule(e) : {}) { for (r = u(o.outputName || e, 1), r.attributes = t, r.shortEnded = n, b.append(r), s = P[b.name], s && P[r.name] && !s[r.name] && A.push(r), i = f.length; i--; ) a = f[i].name, a in t.map && (N = h[a], N ? N.push(r) : h[a] = [r]); T[e] && m(r), n || (b = r), !B && M[e] && (B = !0) } }, end: function (t) { var n, r, i, o, a; if (r = S ? l.getElementRule(t) : {}) { if (T[t] && !B) { if (n = b.firstChild, n && 3 === n.type) if (i = n.value.replace(R, ""), i.length > 0) n.value = i, n = n.next; else for (o = n.next, n.remove(), n = o; n && 3 === n.type; ) i = n.value, o = n.next, (0 === i.length || H.test(i)) && (n.remove(), n = o), n = o; if (n = b.lastChild, n && 3 === n.type) if (i = n.value.replace(D, ""), i.length > 0) n.value = i, n = n.prev; else for (o = n.prev, n.remove(), n = o; n && 3 === n.type; ) i = n.value, o = n.prev, (0 === i.length || H.test(i)) && (n.remove(), n = o), n = o } if (B && M[t] && (B = !1), (r.removeEmpty || r.paddEmpty) && b.isEmpty(O)) if (r.paddEmpty) b.empty().append(new e("#text", "3")).value = "\xa0"; else if (!b.attributes.map.name && !b.attributes.map.id) return a = b.parent, T[b.name] ? b.empty().remove() : b.unwrap(), void (b = a); b = b.parent } } }, l), y = b = new e(o.context || r.root_name, 11), v.parse(t), S && A.length && (o.context ? o.invalid = !0 : c(A)), I && ("body" == y.name || o.isRootContent) && a(), !o.invalid) { for (k in p) { for (N = d[k], C = p[k], _ = C.length; _--; ) C[_].parent || C.splice(_, 1); for (x = 0, w = N.length; w > x; x++) N[x](C, k, o) } for (x = 0, w = f.length; w > x; x++) if (N = f[x], N.name in h) { for (C = h[N.name], _ = C.length; _--; ) C[_].parent || C.splice(_, 1); for (_ = 0, E = N.callbacks.length; E > _; _++) N.callbacks[_](C, N.name, o) } } return y }, r.remove_trailing_brs && u.addNodeFilter("br", function (t) { var n, r = t.length, i, o = s({}, l.getBlockElements()), a = l.getNonEmptyElements(), c, u, d, f, p, h; for (o.body = 1, n = 0; r > n; n++) if (i = t[n], c = i.parent, o[i.parent.name] && i === c.lastChild) { for (d = i.prev; d; ) { if (f = d.name, "span" !== f || "bookmark" !== d.attr("data-mce-type")) { if ("br" !== f) break; if ("br" === f) { i = null; break } } d = d.prev } i && (i.remove(), c.isEmpty(a) && (p = l.getElementRule(c.name), p && (p.removeEmpty ? c.remove() : p.paddEmpty && (c.empty().append(new e("#text", 3)).value = "\xa0")))) } else { for (u = i; c && c.firstChild === u && c.lastChild === u && (u = c, !o[c.name]); ) c = c.parent; u === c && (h = new e("#text", 3), h.value = "\xa0", i.replace(h)) } }), r.allow_html_in_named_anchor || u.addAttributeFilter("id,name", function (e) { for (var t = e.length, n, r, i, o; t--; ) if (o = e[t], "a" === o.name && o.firstChild && !o.attr("href")) { i = o.parent, n = o.lastChild; do r = n.prev, i.insert(n, o), n = r; while (n) } }), r.validate && l.getValidClasses() && u.addAttributeFilter("class", function (e) { for (var t = e.length, n, r, i, o, a, s = l.getValidClasses(), c, u; t--; ) { for (n = e[t], r = n.attr("class").split(" "), a = "", i = 0; i < r.length; i++) o = r[i], u = !1, c = s["*"], c && c[o] && (u = !0), c = s[n.name], u || !c || c[o] || (u = !0), u && (a && (a += " "), a += o); a.length || (a = null), n.attr("class", a) } }) } }), r(S, [g, u], function (e, t) { var n = t.makeMap; return function (t) { var r = [], i, o, a, s, l; return t = t || {}, i = t.indent, o = n(t.indent_before || ""), a = n(t.indent_after || ""), s = e.getEncodeFunc(t.entity_encoding || "raw", t.entities), l = "html" == t.element_format, { start: function (e, t, n) { var c, u, d, f; if (i && o[e] && r.length > 0 && (f = r[r.length - 1], f.length > 0 && "\n" !== f && r.push("\n")), r.push("<", e), t) for (c = 0, u = t.length; u > c; c++) d = t[c], r.push(" ", d.name, '="', s(d.value, !0), '"'); r[r.length] = !n || l ? ">" : " />", n && i && a[e] && r.length > 0 && (f = r[r.length - 1], f.length > 0 && "\n" !== f && r.push("\n")) }, end: function (e) { var t; r.push("</", e, ">"), i && a[e] && r.length > 0 && (t = r[r.length - 1], t.length > 0 && "\n" !== t && r.push("\n")) }, text: function (e, t) { e.length > 0 && (r[r.length] = t ? e : s(e)) }, cdata: function (e) { r.push("<![CDATA[", e, "]]>") }, comment: function (e) { r.push("<!--", e, "-->") }, pi: function (e, t) { t ? r.push("<?", e, " ", t, "?>") : r.push("<?", e, "?>"), i && r.push("\n") }, doctype: function (e) { r.push("<!DOCTYPE", e, ">", i ? "\n" : "") }, reset: function () { r.length = 0 }, getContent: function () { return r.join("").replace(/\n$/, "") } } } }), r(T, [S, E], function (e, t) { return function (n, r) { var i = this, o = new e(n); n = n || {}, n.validate = "validate" in n ? n.validate : !0, i.schema = r = r || new t, i.writer = o, i.serialize = function (e) { function t(e) { var n = i[e.type], s, l, c, u, d, f, p, h, m; if (n) n(e); else { if (s = e.name, l = e.shortEnded, c = e.attributes, a && c && c.length > 1) { for (f = [], f.map = {}, m = r.getElementRule(e.name), p = 0, h = m.attributesOrder.length; h > p; p++) u = m.attributesOrder[p], u in c.map && (d = c.map[u], f.map[u] = d, f.push({ name: u, value: d })); for (p = 0, h = c.length; h > p; p++) u = c[p].name, u in f.map || (d = c.map[u], f.map[u] = d, f.push({ name: u, value: d })); c = f } if (o.start(e.name, c, l), !l) { if (e = e.firstChild) do t(e); while (e = e.next); o.end(s) } } } var i, a; return a = n.validate, i = { 3: function (e) { o.text(e.value, e.raw) }, 8: function (e) { o.comment(e.value) }, 7: function (e) { o.pi(e.name, e.value) }, 10: function (e) { o.doctype(e.value) }, 4: function (e) { o.cdata(e.value) }, 11: function (e) { if (e = e.firstChild) do t(e); while (e = e.next) } }, o.reset(), 1 != e.type || n.inner ? i[11](e) : t(e), o.getContent() } } }), r(R, [y, k, g, T, _, E, d, u], function (e, t, n, r, i, o, a, s) { var l = s.each, c = s.trim, u = e.DOM; return function (e, i) { var s, d, f; return i && (s = i.dom, d = i.schema), s = s || u, d = d || new o(e), e.entity_encoding = e.entity_encoding || "named", e.remove_trailing_brs = "remove_trailing_brs" in e ? e.remove_trailing_brs : !0, f = new t(e, d), f.addAttributeFilter("data-mce-tabindex", function (e, t) { for (var n = e.length, r; n--; ) r = e[n], r.attr("tabindex", r.attributes.map["data-mce-tabindex"]), r.attr(t, null) }), f.addAttributeFilter("src,href,style", function (t, n) { for (var r = t.length, i, o, a = "data-mce-" + n, l = e.url_converter, c = e.url_converter_scope, u; r--; ) i = t[r], o = i.attributes.map[a], o !== u ? (i.attr(n, o.length > 0 ? o : null), i.attr(a, null)) : (o = i.attributes.map[n], "style" === n ? o = s.serializeStyle(s.parseStyle(o), i.name) : l && (o = l.call(c, o, n, i.name)), i.attr(n, o.length > 0 ? o : null)) }), f.addAttributeFilter("class", function (e) { for (var t = e.length, n, r; t--; ) n = e[t], r = n.attr("class"), r && (r = n.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g, ""), n.attr("class", r.length > 0 ? r : null)) }), f.addAttributeFilter("data-mce-type", function (e, t, n) { for (var r = e.length, i; r--; ) i = e[r], "bookmark" !== i.attributes.map["data-mce-type"] || n.cleanup || i.remove() }), f.addNodeFilter("noscript", function (e) { for (var t = e.length, r; t--; ) r = e[t].firstChild, r && (r.value = n.decode(r.value)) }), f.addNodeFilter("script,style", function (e, t) { function n(e) { return e.replace(/(<!--\[CDATA\[|\]\]-->)/g, "\n").replace(/^[\r\n]*|[\r\n]*$/g, "").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi, "").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g, "") } for (var r = e.length, i, o, a; r--; ) i = e[r], o = i.firstChild ? i.firstChild.value : "", "script" === t ? (a = i.attr("type"), a && i.attr("type", "mce-no/type" == a ? null : a.replace(/^mce\-/, "")), o.length > 0 && (i.firstChild.value = "// <![CDATA[\n" + n(o) + "\n// ]]>")) : o.length > 0 && (i.firstChild.value = "<!--\n" + n(o) + "\n-->") }), f.addNodeFilter("#comment", function (e) { for (var t = e.length, n; t--; ) n = e[t], 0 === n.value.indexOf("[CDATA[") ? (n.name = "#cdata", n.type = 4, n.value = n.value.replace(/^\[CDATA\[|\]\]$/g, "")) : 0 === n.value.indexOf("mce:protected ") && (n.name = "#text", n.type = 3, n.raw = !0, n.value = unescape(n.value).substr(14)) }), f.addNodeFilter("xml:namespace,input", function (e, t) { for (var n = e.length, r; n--; ) r = e[n], 7 === r.type ? r.remove() : 1 === r.type && ("input" !== t || "type" in r.attributes.map || r.attr("type", "text")) }), e.fix_list_elements && f.addNodeFilter("ul,ol", function (e) { for (var t = e.length, n, r; t--; ) n = e[t], r = n.parent, ("ul" === r.name || "ol" === r.name) && n.prev && "li" === n.prev.name && n.prev.append(n) }), f.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize", function (e, t) { for (var n = e.length; n--; ) e[n].attr(t, null) }), { schema: d, addNodeFilter: f.addNodeFilter, addAttributeFilter: f.addAttributeFilter, serialize: function (t, n) { var i = this, o, u, p, h, m; return a.ie && s.select("script,style,select,map").length > 0 ? (m = t.innerHTML, t = t.cloneNode(!1), s.setHTML(t, m)) : t = t.cloneNode(!0), o = t.ownerDocument.implementation, o.createHTMLDocument && (u = o.createHTMLDocument(""), l("BODY" == t.nodeName ? t.childNodes : [t], function (e) { u.body.appendChild(u.importNode(e, !0)) }), t = "BODY" != t.nodeName ? u.body.firstChild : u.body, p = s.doc, s.doc = u), n = n || {}, n.format = n.format || "html", n.selection && (n.forced_root_block = ""), n.no_events || (n.node = t, i.onPreProcess(n)), h = new r(e, d), n.content = h.serialize(f.parse(c(n.getInner ? t.innerHTML : s.getOuterHTML(t)), n)), n.cleanup || (n.content = n.content.replace(/\uFEFF/g, "")), n.no_events || i.onPostProcess(n), p && (s.doc = p), n.node = null, n.content }, addRules: function (e) { d.addValidElements(e) }, setRules: function (e) { d.setValidElements(e) }, onPreProcess: function (e) { i && i.fire("PreProcess", e) }, onPostProcess: function (e) { i && i.fire("PostProcess", e) } } } }), r(A, [], function () { function e(e) { function t(t, n) { var r, i = 0, o, a, s, l, c, u, d = -1, f; if (r = t.duplicate(), r.collapse(n), f = r.parentElement(), f.ownerDocument === e.dom.doc) { for (; "false" === f.contentEditable; ) f = f.parentNode; if (!f.hasChildNodes()) return { node: f, inside: 1 }; for (s = f.children, o = s.length - 1; o >= i; ) if (u = Math.floor((i + o) / 2), l = s[u], r.moveToElementText(l), d = r.compareEndPoints(n ? "StartToStart" : "EndToEnd", t), d > 0) o = u - 1; else { if (!(0 > d)) return { node: l }; i = u + 1 } if (0 > d) for (l ? r.collapse(!1) : (r.moveToElementText(f), r.collapse(!0), l = f, a = !0), c = 0; 0 !== r.compareEndPoints(n ? "StartToStart" : "StartToEnd", t) && 0 !== r.move("character", 1) && f == r.parentElement(); ) c++; else for (r.collapse(!0), c = 0; 0 !== r.compareEndPoints(n ? "StartToStart" : "StartToEnd", t) && 0 !== r.move("character", -1) && f == r.parentElement(); ) c++; return { node: l, position: d, offset: c, inside: a} } } function n() { function n(e) { var n = t(o, e), r, i, s = 0, l, c, u; if (r = n.node, i = n.offset, n.inside && !r.hasChildNodes()) return void a[e ? "setStart" : "setEnd"](r, 0); if (i === c) return void a[e ? "setStartBefore" : "setEndAfter"](r); if (n.position < 0) { if (l = n.inside ? r.firstChild : r.nextSibling, !l) return void a[e ? "setStartAfter" : "setEndAfter"](r); if (!i) return void (3 == l.nodeType ? a[e ? "setStart" : "setEnd"](l, 0) : a[e ? "setStartBefore" : "setEndBefore"](l)); for (; l; ) { if (3 == l.nodeType && (u = l.nodeValue, s += u.length, s >= i)) { r = l, s -= i, s = u.length - s; break } l = l.nextSibling } } else { if (l = r.previousSibling, !l) return a[e ? "setStartBefore" : "setEndBefore"](r); if (!i) return void (3 == r.nodeType ? a[e ? "setStart" : "setEnd"](l, r.nodeValue.length) : a[e ? "setStartAfter" : "setEndAfter"](l)); for (; l; ) { if (3 == l.nodeType && (s += l.nodeValue.length, s >= i)) { r = l, s -= i; break } l = l.previousSibling } } a[e ? "setStart" : "setEnd"](r, s) } var o = e.getRng(), a = i.createRng(), s, l, c, u, d; if (s = o.item ? o.item(0) : o.parentElement(), s.ownerDocument != i.doc) return a; if (l = e.isCollapsed(), o.item) return a.setStart(s.parentNode, i.nodeIndex(s)), a.setEnd(a.startContainer, a.startOffset + 1), a; try { n(!0), l || n() } catch (f) { if (-2147024809 != f.number) throw f; d = r.getBookmark(2), c = o.duplicate(), c.collapse(!0), s = c.parentElement(), l || (c = o.duplicate(), c.collapse(!1), u = c.parentElement(), u.innerHTML = u.innerHTML), s.innerHTML = s.innerHTML, r.moveToBookmark(d), o = e.getRng(), n(!0), l || n() } return a } var r = this, i = e.dom, o = !1; this.getBookmark = function (n) { function r(e) { var t, n, r, o, a = []; for (t = e.parentNode, n = i.getRoot().parentNode; t != n && 9 !== t.nodeType; ) { for (r = t.children, o = r.length; o--; ) if (e === r[o]) { a.push(o); break } e = t, t = t.parentNode } return a } function o(e) { var n; return n = t(a, e), n ? { position: n.position, offset: n.offset, indexes: r(n.node), inside: n.inside} : void 0 } var a = e.getRng(), s = {}; return 2 === n && (a.item ? s.start = { ctrl: !0, indexes: r(a.item(0))} : (s.start = o(!0), e.isCollapsed() || (s.end = o()))), s }, this.moveToBookmark = function (e) { function t(e) { var t, n, r, o; for (t = i.getRoot(), n = e.length - 1; n >= 0; n--) o = t.children, r = e[n], r <= o.length - 1 && (t = o[r]); return t } function n(n) { var i = e[n ? "start" : "end"], a, s, l, c; i && (a = i.position > 0, s = o.createTextRange(), s.moveToElementText(t(i.indexes)), c = i.offset, c !== l ? (s.collapse(i.inside || a), s.moveStart("character", a ? -c : c)) : s.collapse(n), r.setEndPoint(n ? "StartToStart" : "EndToStart", s), n && r.collapse(!0)) } var r, o = i.doc.body; e.start && (e.start.ctrl ? (r = o.createControlRange(), r.addElement(t(e.start.indexes)), r.select()) : (r = o.createTextRange(), n(!0), n(), r.select())) }, this.addRange = function (t) { function n(e) { var t, n, a, d, h; a = i.create("a"), t = e ? s : c, n = e ? l : u, d = r.duplicate(), (t == f || t == f.documentElement) && (t = p, n = 0), 3 == t.nodeType ? (t.parentNode.insertBefore(a, t), d.moveToElementText(a), d.moveStart("character", n), i.remove(a), r.setEndPoint(e ? "StartToStart" : "EndToEnd", d)) : (h = t.childNodes, h.length ? (n >= h.length ? i.insertAfter(a, h[h.length - 1]) : t.insertBefore(a, h[n]), d.moveToElementText(a)) : t.canHaveHTML && (t.innerHTML = "<span>&#xFEFF;</span>", a = t.firstChild, d.moveToElementText(a), d.collapse(o)), r.setEndPoint(e ? "StartToStart" : "EndToEnd", d), i.remove(a)) } var r, a, s, l, c, u, d, f = e.dom.doc, p = f.body, h, m; if (s = t.startContainer, l = t.startOffset, c = t.endContainer, u = t.endOffset, r = p.createTextRange(), s == c && 1 == s.nodeType) { if (l == u && !s.hasChildNodes()) { if (s.canHaveHTML) return d = s.previousSibling, d && !d.hasChildNodes() && i.isBlock(d) ? d.innerHTML = "&#xFEFF;" : d = null, s.innerHTML = "<span>&#xFEFF;</span><span>&#xFEFF;</span>", r.moveToElementText(s.lastChild), r.select(), i.doc.selection.clear(), s.innerHTML = "", void (d && (d.innerHTML = "")); l = i.nodeIndex(s), s = s.parentNode } if (l == u - 1) try { if (m = s.childNodes[l], a = p.createControlRange(), a.addElement(m), a.select(), h = e.getRng(), h.item && m === h.item(0)) return } catch (g) { } } n(!0), n(), r.select() }, this.getRangeAt = n } return e }), r(B, [d], function (e) { return { BACKSPACE: 8, DELETE: 46, DOWN: 40, ENTER: 13, LEFT: 37, RIGHT: 39, SPACEBAR: 32, TAB: 9, UP: 38, modifierPressed: function (e) { return e.shiftKey || e.ctrlKey || e.altKey }, metaKeyPressed: function (t) { return e.mac ? t.metaKey : t.ctrlKey && !t.altKey } } }), r(D, [B, u, d], function (e, t, n) { return function (r, i) { function o(e) { var t = i.settings.object_resizing; return t === !1 || n.iOS ? !1 : ("string" != typeof t && (t = "table,img,div"), "false" === e.getAttribute("data-mce-resize") ? !1 : i.dom.is(e, t)) } function a(t) { var n, r, o, a, s; n = t.screenX - T, r = t.screenY - R, P = n * k[2] + D, O = r * k[3] + L, P = 5 > P ? 5 : P, O = 5 > O ? 5 : O, o = "IMG" == w.nodeName && i.settings.resize_img_proportional !== !1 ? !e.modifierPressed(t) : e.modifierPressed(t) || "IMG" == w.nodeName && k[2] * k[3] !== 0, o && (W(n) > W(r) ? (O = V(P * H), P = V(O / H)) : (P = V(O / H), O = V(P * H))), C.setStyles(_, { width: P, height: O }), a = k.startPos.x + n, s = k.startPos.y + r, a = a > 0 ? a : 0, s = s > 0 ? s : 0, C.setStyles(E, { left: a, top: s, display: "block" }), E.innerHTML = P + " &times; " + O, k[2] < 0 && _.clientWidth <= P && C.setStyle(_, "left", A + (D - P)), k[3] < 0 && _.clientHeight <= O && C.setStyle(_, "top", B + (L - O)), n = U.scrollWidth - $, r = U.scrollHeight - q, n + r !== 0 && C.setStyles(E, { left: a - n, top: s - r }), M || (i.fire("ObjectResizeStart", { target: w, width: D, height: L }), M = !0) } function s() { function e(e, t) { t && (w.style[e] || !i.schema.isValid(w.nodeName.toLowerCase(), e) ? C.setStyle(w, e, t) : C.setAttrib(w, e, t)) } M = !1, e("width", P), e("height", O), C.unbind(I, "mousemove", a), C.unbind(I, "mouseup", s), F != I && (C.unbind(F, "mousemove", a), C.unbind(F, "mouseup", s)), C.remove(_), C.remove(E), z && "TABLE" != w.nodeName || l(w), i.fire("ObjectResized", { target: w, width: P, height: O }), C.setAttrib(w, "style", C.getAttrib(w, "style")), i.nodeChanged() } function l(e, t, r) { var l, u, d, f, p; g(), l = C.getPos(e, U), A = l.x, B = l.y, p = e.getBoundingClientRect(), u = p.width || p.right - p.left, d = p.height || p.bottom - p.top, w != e && (m(), w = e, P = O = 0), f = i.fire("ObjectSelected", { target: e }), o(e) && !f.isDefaultPrevented() ? x(N, function (e, i) { function o(t) { T = t.screenX, R = t.screenY, D = w.clientWidth, L = w.clientHeight, H = L / D, k = e, e.startPos = { x: u * e[0] + A, y: d * e[1] + B }, $ = U.scrollWidth, q = U.scrollHeight, _ = w.cloneNode(!0), C.addClass(_, "mce-clonedresizable"), C.setAttrib(_, "data-mce-bogus", "all"), _.contentEditable = !1, _.unSelectabe = !0, C.setStyles(_, { left: A, top: B, margin: 0 }), _.removeAttribute("data-mce-selected"), U.appendChild(_), C.bind(I, "mousemove", a), C.bind(I, "mouseup", s), F != I && (C.bind(F, "mousemove", a), C.bind(F, "mouseup", s)), E = C.add(U, "div", { "class": "mce-resize-helper", "data-mce-bogus": "all" }, D + " &times; " + L) } var l, c; return t ? void (i == t && o(r)) : (l = C.get("mceResizeHandle" + i), l ? C.show(l) : (c = U, l = C.add(c, "div", { id: "mceResizeHandle" + i, "data-mce-bogus": "all", "class": "mce-resizehandle", unselectable: !0, style: "cursor:" + i + "-resize; margin:0; padding:0" }), n.ie && (l.contentEditable = !1)), e.elm || (C.bind(l, "mousedown", function (e) { e.stopImmediatePropagation(), e.preventDefault(), o(e) }), e.elm = l), void C.setStyles(l, { left: u * e[0] + A - l.offsetWidth / 2, top: d * e[1] + B - l.offsetHeight / 2 })) }) : c(), w.setAttribute("data-mce-selected", "1") } function c() { var e, t; g(), w && w.removeAttribute("data-mce-selected"); for (e in N) t = C.get("mceResizeHandle" + e), t && (C.unbind(t), C.remove(t)) } function u(e) { function t(e, t) { if (e) do if (e === t) return !0; while (e = e.parentNode) } var n, i; if (!M) return x(C.select("img[data-mce-selected],hr[data-mce-selected]"), function (e) { e.removeAttribute("data-mce-selected") }), i = "mousedown" == e.type ? e.target : r.getNode(), i = C.$(i).closest(z ? "table" : "table,img,hr")[0], t(i, U) && (v(), n = r.getStart(!0), t(n, i) && t(r.getEnd(!0), i) && (!z || i != n && "IMG" !== n.nodeName)) ? void l(i) : void c() } function d(e, t, n) { e && e.attachEvent && e.attachEvent("on" + t, n) } function f(e, t, n) { e && e.detachEvent && e.detachEvent("on" + t, n) } function p(e) { var t = e.srcElement, n, r, o, a, s, c, u; n = t.getBoundingClientRect(), c = S.clientX - n.left, u = S.clientY - n.top; for (r in N) if (o = N[r], a = t.offsetWidth * o[0], s = t.offsetHeight * o[1], W(a - c) < 8 && W(s - u) < 8) { k = o; break } M = !0, i.fire("ObjectResizeStart", { target: w, width: w.clientWidth, height: w.clientHeight }), i.getDoc().selection.empty(), l(t, r, S) } function h(e) { var t = e.srcElement; if (t != w) { if (i.fire("ObjectSelected", { target: t }), m(), 0 === t.id.indexOf("mceResizeHandle")) return void (e.returnValue = !1); ("IMG" == t.nodeName || "TABLE" == t.nodeName) && (c(), w = t, d(t, "resizestart", p)) } } function m() { f(w, "resizestart", p) } function g() { for (var e in N) { var t = N[e]; t.elm && (C.unbind(t.elm), delete t.elm) } } function v() { try { i.getDoc().execCommand("enableObjectResizing", !1, !1) } catch (e) { } } function y(e) { var t; if (z) { t = I.body.createControlRange(); try { return t.addElement(e), t.select(), !0 } catch (n) { } } } function b() { w = _ = null, z && (m(), f(U, "controlselect", h)) } var C = i.dom, x = t.each, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I = i.getDoc(), F = document, z = n.ie && n.ie < 11, W = Math.abs, V = Math.round, U = i.getBody(), $, q; N = { n: [.5, 0, 0, -1], e: [1, .5, 1, 0], s: [.5, 1, 0, 1], w: [0, .5, -1, 0], nw: [0, 0, -1, -1], ne: [1, 0, 1, -1], se: [1, 1, 1, 1], sw: [0, 1, -1, 1] }; var j = ".mce-content-body"; return i.contentStyles.push(j + " div.mce-resizehandle {position: absolute;border: 1px solid black;background: #FFF;width: 5px;height: 5px;z-index: 10000}" + j + " .mce-resizehandle:hover {background: #000}" + j + " img[data-mce-selected], hr[data-mce-selected] {outline: 1px solid black;resize: none}" + j + " .mce-clonedresizable {position: absolute;" + (n.gecko ? "" : "outline: 1px dashed black;") + "opacity: .5;filter: alpha(opacity=50);z-index: 10000}" + j + " .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}"), i.on("init", function () { z ? (i.on("ObjectResized", function (e) { "TABLE" != e.target.nodeName && (c(), y(e.target)) }), d(U, "controlselect", h), i.on("mousedown", function (e) { S = e })) : (v(), n.ie >= 11 && (i.on("mouseup", function (e) { var t = e.target.nodeName; !M && /^(TABLE|IMG|HR)$/.test(t) && (i.selection.select(e.target, "TABLE" == t), i.nodeChanged()) }), i.dom.bind(U, "mscontrolselect", function (e) { /^(TABLE|IMG|HR)$/.test(e.target.nodeName) && (e.preventDefault(), "IMG" == e.target.tagName && window.setTimeout(function () { i.selection.select(e.target) }, 0)) }))), i.on("nodechange ResizeEditor", u), i.on("keydown keyup", function (e) { w && "TABLE" == w.nodeName && u(e) }), i.on("hide", c) }), i.on("remove", g), { isResizable: o, showResizeRect: l, hideResizeRect: c, updateResizeRect: u, controlSelect: y, destroy: b} } }), r(L, [d, u], function (e, t) { function n(n) { var r = n.dom; this.getBookmark = function (e, i) { function o(e, n) { var i = 0; return t.each(r.select(e), function (e, t) { e == n && (i = t) }), i } function a(e) { function t(t) { var n, r, i, o = t ? "start" : "end"; n = e[o + "Container"], r = e[o + "Offset"], 1 == n.nodeType && "TR" == n.nodeName && (i = n.childNodes, n = i[Math.min(t ? r : r - 1, i.length - 1)], n && (r = t ? 0 : n.childNodes.length, e["set" + (t ? "Start" : "End")](n, r))) } return t(!0), t(), e } function s() { function e(e, t) { var n = e[t ? "startContainer" : "endContainer"], a = e[t ? "startOffset" : "endOffset"], s = [], l, c, u = 0; if (3 == n.nodeType) { if (i) for (l = n.previousSibling; l && 3 == l.nodeType; l = l.previousSibling) a += l.nodeValue.length; s.push(a) } else c = n.childNodes, a >= c.length && c.length && (u = 1, a = Math.max(0, c.length - 1)), s.push(r.nodeIndex(c[a], i) + u); for (; n && n != o; n = n.parentNode) s.push(r.nodeIndex(n, i)); return s } var t = n.getRng(!0), o = r.getRoot(), a = {}; return a.start = e(t, !0), n.isCollapsed() || (a.end = e(t)), a } var l, c, u, d, f, p, h = "&#xFEFF;", m; if (2 == e) return p = n.getNode(), f = p ? p.nodeName : null, "IMG" == f ? { name: f, index: o(f, p)} : n.tridentSel ? n.tridentSel.getBookmark(e) : s(); if (e) return { rng: n.getRng() }; if (l = n.getRng(), u = r.uniqueId(), d = n.isCollapsed(), m = "overflow:hidden;line-height:0px", l.duplicate || l.item) { if (l.item) return p = l.item(0), f = p.nodeName, { name: f, index: o(f, p) }; c = l.duplicate(); try { l.collapse(), l.pasteHTML('<span data-mce-type="bookmark" id="' + u + '_start" style="' + m + '">' + h + "</span>"), d || (c.collapse(!1), l.moveToElementText(c.parentElement()), 0 === l.compareEndPoints("StartToEnd", c) && c.move("character", -1), c.pasteHTML('<span data-mce-type="bookmark" id="' + u + '_end" style="' + m + '">' + h + "</span>")) } catch (g) { return null } } else { if (p = n.getNode(), f = p.nodeName, "IMG" == f) return { name: f, index: o(f, p) }; c = a(l.cloneRange()), d || (c.collapse(!1), c.insertNode(r.create("span", { "data-mce-type": "bookmark", id: u + "_end", style: m }, h))), l = a(l), l.collapse(!0), l.insertNode(r.create("span", { "data-mce-type": "bookmark", id: u + "_start", style: m }, h)) } return n.moveToBookmark({ id: u, keep: 1 }), { id: u} }, this.moveToBookmark = function (i) { function o(e) { var t = i[e ? "start" : "end"], n, r, o, a; if (t) { for (o = t[0], r = c, n = t.length - 1; n >= 1; n--) { if (a = r.childNodes, t[n] > a.length - 1) return; r = a[t[n]] } 3 === r.nodeType && (o = Math.min(t[0], r.nodeValue.length)), 1 === r.nodeType && (o = Math.min(t[0], r.childNodes.length)), e ? l.setStart(r, o) : l.setEnd(r, o) } return !0 } function a(n) { var o = r.get(i.id + "_" + n), a, s, l, c, h = i.keep; if (o && (a = o.parentNode, "start" == n ? (h ? (a = o.firstChild, s = 1) : s = r.nodeIndex(o), u = d = a, f = p = s) : (h ? (a = o.firstChild, s = 1) : s = r.nodeIndex(o), d = a, p = s), !h)) { for (c = o.previousSibling, l = o.nextSibling, t.each(t.grep(o.childNodes), function (e) { 3 == e.nodeType && (e.nodeValue = e.nodeValue.replace(/\uFEFF/g, "")) }); o = r.get(i.id + "_" + n); ) r.remove(o, 1); c && l && c.nodeType == l.nodeType && 3 == c.nodeType && !e.opera && (s = c.nodeValue.length, c.appendData(l.nodeValue), r.remove(l), "start" == n ? (u = d = c, f = p = s) : (d = c, p = s)) } } function s(t) { return !r.isBlock(t) || t.innerHTML || e.ie || (t.innerHTML = '<br data-mce-bogus="1" />'), t } var l, c, u, d, f, p; if (i) if (i.start) { if (l = r.createRng(), c = r.getRoot(), n.tridentSel) return n.tridentSel.moveToBookmark(i); o(!0) && o() && n.setRng(l) } else i.id ? (a("start"), a("end"), u && (l = r.createRng(), l.setStart(s(u), f), l.setEnd(s(d), p), n.setRng(l))) : i.name ? n.select(r.select(i.name)[i.index]) : i.rng && n.setRng(i.rng) } } return n.isBookmarkNode = function (e) { return e && "SPAN" === e.tagName && "bookmark" === e.getAttribute("data-mce-type") }, n }), r(H, [h, A, D, x, L, d, u], function (e, n, r, i, o, a, s) { function l(e, t, i, a) { var s = this; s.dom = e, s.win = t, s.serializer = i, s.editor = a, s.bookmarkManager = new o(s), s.controlSelection = new r(s, a), s.win.getSelection || (s.tridentSel = new n(s)) } var c = s.each, u = s.trim, d = a.ie; return l.prototype = { setCursorLocation: function (e, t) { var n = this, r = n.dom.createRng(); e ? (r.setStart(e, t), r.setEnd(e, t), n.setRng(r), n.collapse(!1)) : (n._moveEndPoint(r, n.editor.getBody(), !0), n.setRng(r)) }, getContent: function (e) { var n = this, r = n.getRng(), i = n.dom.create("body"), o = n.getSel(), a, s, l; return e = e || {}, a = s = "", e.get = !0, e.format = e.format || "html", e.selection = !0, n.editor.fire("BeforeGetContent", e), "text" == e.format ? n.isCollapsed() ? "" : r.text || (o.toString ? o.toString() : "") : (r.cloneContents ? (l = r.cloneContents(), l && i.appendChild(l)) : r.item !== t || r.htmlText !== t ? (i.innerHTML = "<br>" + (r.item ? r.item(0).outerHTML : r.htmlText), i.removeChild(i.firstChild)) : i.innerHTML = r.toString(), /^\s/.test(i.innerHTML) && (a = " "), /\s+$/.test(i.innerHTML) && (s = " "), e.getInner = !0, e.content = n.isCollapsed() ? "" : a + n.serializer.serialize(i, e) + s, n.editor.fire("GetContent", e), e.content) }, setContent: function (e, t) { var n = this, r = n.getRng(), i, o = n.win.document, a, s; if (t = t || { format: "html" }, t.set = !0, t.selection = !0, e = t.content = e, t.no_events || n.editor.fire("BeforeSetContent", t), e = t.content, r.insertNode) { e += '<span id="__caret">_</span>', r.startContainer == o && r.endContainer == o ? o.body.innerHTML = e : (r.deleteContents(), 0 === o.body.childNodes.length ? o.body.innerHTML = e : r.createContextualFragment ? r.insertNode(r.createContextualFragment(e)) : (a = o.createDocumentFragment(), s = o.createElement("div"), a.appendChild(s), s.outerHTML = e, r.insertNode(a))), i = n.dom.get("__caret"), r = o.createRange(), r.setStartBefore(i), r.setEndBefore(i), n.setRng(r), n.dom.remove("__caret"); try { n.setRng(r) } catch (l) { } } else r.item && (o.execCommand("Delete", !1, null), r = n.getRng()), /^\s+/.test(e) ? (r.pasteHTML('<span id="__mce_tmp">_</span>' + e), n.dom.remove("__mce_tmp")) : r.pasteHTML(e); t.no_events || n.editor.fire("SetContent", t) }, getStart: function (e) { var t = this, n = t.getRng(), r, i, o, a; if (n.duplicate || n.item) { if (n.item) return n.item(0); for (o = n.duplicate(), o.collapse(1), r = o.parentElement(), r.ownerDocument !== t.dom.doc && (r = t.dom.getRoot()), i = a = n.parentElement(); a = a.parentNode; ) if (a == r) { r = i; break } return r } return r = n.startContainer, 1 == r.nodeType && r.hasChildNodes() && (e && n.collapsed || (r = r.childNodes[Math.min(r.childNodes.length - 1, n.startOffset)])), r && 3 == r.nodeType ? r.parentNode : r }, getEnd: function (e) { var t = this, n = t.getRng(), r, i; return n.duplicate || n.item ? n.item ? n.item(0) : (n = n.duplicate(), n.collapse(0), r = n.parentElement(), r.ownerDocument !== t.dom.doc && (r = t.dom.getRoot()), r && "BODY" == r.nodeName ? r.lastChild || r : r) : (r = n.endContainer, i = n.endOffset, 1 == r.nodeType && r.hasChildNodes() && (e && n.collapsed || (r = r.childNodes[i > 0 ? i - 1 : i])), r && 3 == r.nodeType ? r.parentNode : r) }, getBookmark: function (e, t) { return this.bookmarkManager.getBookmark(e, t) }, moveToBookmark: function (e) { return this.bookmarkManager.moveToBookmark(e) }, select: function (e, t) { var n = this, r = n.dom, i = r.createRng(), o; if (n.lastFocusBookmark = null, e) { if (!t && n.controlSelection.controlSelect(e)) return; o = r.nodeIndex(e), i.setStart(e.parentNode, o), i.setEnd(e.parentNode, o + 1), t && (n._moveEndPoint(i, e, !0), n._moveEndPoint(i, e)), n.setRng(i) } return e }, isCollapsed: function () { var e = this, t = e.getRng(), n = e.getSel(); return !t || t.item ? !1 : t.compareEndPoints ? 0 === t.compareEndPoints("StartToEnd", t) : !n || t.collapsed }, collapse: function (e) { var t = this, n = t.getRng(), r; n.item && (r = n.item(0), n = t.win.document.body.createTextRange(), n.moveToElementText(r)), n.collapse(!!e), t.setRng(n) }, getSel: function () { var e = this.win; return e.getSelection ? e.getSelection() : e.document.selection }, getRng: function (e) { function t(e, t, n) { try { return t.compareBoundaryPoints(e, n) } catch (r) { return -1 } } var n = this, r, i, o, a = n.win.document, s; if (!e && n.lastFocusBookmark) { var l = n.lastFocusBookmark; return l.startContainer ? (i = a.createRange(), i.setStart(l.startContainer, l.startOffset), i.setEnd(l.endContainer, l.endOffset)) : i = l, i } if (e && n.tridentSel) return n.tridentSel.getRangeAt(0); try { (r = n.getSel()) && (i = r.rangeCount > 0 ? r.getRangeAt(0) : r.createRange ? r.createRange() : a.createRange()) } catch (c) { } if (d && i && i.setStart && a.selection) { try { s = a.selection.createRange() } catch (c) { } s && s.item && (o = s.item(0), i = a.createRange(), i.setStartBefore(o), i.setEndAfter(o)) } return i || (i = a.createRange ? a.createRange() : a.body.createTextRange()), i.setStart && 9 === i.startContainer.nodeType && i.collapsed && (o = n.dom.getRoot(), i.setStart(o, 0), i.setEnd(o, 0)), n.selectedRange && n.explicitRange && (0 === t(i.START_TO_START, i, n.selectedRange) && 0 === t(i.END_TO_END, i, n.selectedRange) ? i = n.explicitRange : (n.selectedRange = null, n.explicitRange = null)), i }, setRng: function (e, t) { var n = this, r; if (e) if (e.select) try { e.select() } catch (i) { } else if (n.tridentSel) { if (e.cloneRange) try { return void n.tridentSel.addRange(e) } catch (i) { } } else if (r = n.getSel()) { n.explicitRange = e; try { r.removeAllRanges(), r.addRange(e) } catch (i) { } t === !1 && r.extend && (r.collapse(e.endContainer, e.endOffset), r.extend(e.startContainer, e.startOffset)), n.selectedRange = r.rangeCount > 0 ? r.getRangeAt(0) : null } }, setNode: function (e) { var t = this; return t.setContent(t.dom.getOuterHTML(e)), e }, getNode: function () { function e(e, t) { for (var n = e; e && 3 === e.nodeType && 0 === e.length; ) e = t ? e.nextSibling : e.previousSibling; return e || n } var t = this, n = t.getRng(), r, i = n.startContainer, o = n.endContainer, a = n.startOffset, s = n.endOffset, l = t.dom.getRoot(); return n ? n.setStart ? (r = n.commonAncestorContainer, !n.collapsed && (i == o && 2 > s - a && i.hasChildNodes() && (r = i.childNodes[a]), 3 === i.nodeType && 3 === o.nodeType && (i = i.length === a ? e(i.nextSibling, !0) : i.parentNode, o = 0 === s ? e(o.previousSibling, !1) : o.parentNode, i && i === o)) ? i : r && 3 == r.nodeType ? r.parentNode : r) : (r = n.item ? n.item(0) : n.parentElement(), r.ownerDocument !== t.win.document && (r = l), r) : l }, getSelectedBlocks: function (t, n) { var r = this, i = r.dom, o, a, s = []; if (a = i.getRoot(), t = i.getParent(t || r.getStart(), i.isBlock), n = i.getParent(n || r.getEnd(), i.isBlock), t && t != a && s.push(t), t && n && t != n) { o = t; for (var l = new e(t, a); (o = l.next()) && o != n; ) i.isBlock(o) && s.push(o) } return n && t != n && n != a && s.push(n), s }, isForward: function () { var e = this.dom, t = this.getSel(), n, r; return t && t.anchorNode && t.focusNode ? (n = e.createRng(), n.setStart(t.anchorNode, t.anchorOffset), n.collapse(!0), r = e.createRng(), r.setStart(t.focusNode, t.focusOffset), r.collapse(!0), n.compareBoundaryPoints(n.START_TO_START, r) <= 0) : !0 }, normalize: function () { var e = this, t = e.getRng(); return !d && new i(e.dom).normalize(t) && e.setRng(t, e.isForward()), t }, selectorChanged: function (e, t) { var n = this, r; return n.selectorChangedData || (n.selectorChangedData = {}, r = {}, n.editor.on("NodeChange", function (e) { var t = e.element, i = n.dom, o = i.getParents(t, null, i.getRoot()), a = {}; c(n.selectorChangedData, function (e, t) { c(o, function (n) { return i.is(n, t) ? (r[t] || (c(e, function (e) { e(!0, { node: n, selector: t, parents: o }) }), r[t] = e), a[t] = e, !1) : void 0 }) }), c(r, function (e, n) { a[n] || (delete r[n], c(e, function (e) { e(!1, { node: t, selector: n, parents: o }) })) }) })), n.selectorChangedData[e] || (n.selectorChangedData[e] = []), n.selectorChangedData[e].push(t), n }, getScrollContainer: function () { for (var e, t = this.dom.getRoot(); t && "BODY" != t.nodeName; ) { if (t.scrollHeight > t.clientHeight) { e = t; break } t = t.parentNode } return e }, scrollIntoView: function (e) { function t(e) { for (var t = 0, n = 0, r = e; r && r.nodeType; ) t += r.offsetLeft || 0, n += r.offsetTop || 0, r = r.offsetParent; return { x: t, y: n} } var n, r, i = this, o = i.dom, a = o.getRoot(), s, l; if ("BODY" != a.nodeName) { var c = i.getScrollContainer(); if (c) return n = t(e).y - t(c).y, l = c.clientHeight, s = c.scrollTop, void ((s > n || n + 25 > s + l) && (c.scrollTop = s > n ? n : n - l + 25)) } r = o.getViewPort(i.editor.getWin()), n = o.getPos(e).y, s = r.y, l = r.h, (n < r.y || n + 25 > s + l) && i.editor.getWin().scrollTo(0, s > n ? n : n - l + 25) }, placeCaretAt: function (e, t) { var n = this.editor.getDoc(), r, i; if (n.caretPositionFromPoint) i = n.caretPositionFromPoint(e, t), r = n.createRange(), r.setStart(i.offsetNode, i.offset), r.collapse(!0); else if (n.caretRangeFromPoint) r = n.caretRangeFromPoint(e, t); else if (n.body.createTextRange) { r = n.body.createTextRange(); try { r.moveToPoint(e, t), r.collapse(!0) } catch (o) { r.collapse(t < n.body.clientHeight) } } this.setRng(r) }, _moveEndPoint: function (t, n, r) { var i = n, o = new e(n, i), s = this.dom.schema.getNonEmptyElements(); do { if (3 == n.nodeType && 0 !== u(n.nodeValue).length) return void (r ? t.setStart(n, 0) : t.setEnd(n, n.nodeValue.length)); if (s[n.nodeName] && !/^(TD|TH)$/.test(n.nodeName)) return void (r ? t.setStartBefore(n) : "BR" == n.nodeName ? t.setEndBefore(n) : t.setEndAfter(n)); if (a.ie && a.ie < 11 && this.dom.isBlock(n) && this.dom.isEmpty(n)) return void (r ? t.setStart(n, 0) : t.setEnd(n, 0)) } while (n = r ? o.next() : o.prev()); "BODY" == i.nodeName && (r ? t.setStart(i, 0) : t.setEnd(i, i.childNodes.length)) }, destroy: function () { this.win = null, this.controlSelection.destroy() } }, l }), r(M, [L, u], function (e, t) { function n(t) { this.compare = function (n, i) { function o(e) { var n = {}; return r(t.getAttribs(e), function (r) { var i = r.nodeName.toLowerCase(); 0 !== i.indexOf("_") && "style" !== i && "data-mce-style" !== i && (n[i] = t.getAttrib(e, i)) }), n } function a(e, t) { var n, r; for (r in e) if (e.hasOwnProperty(r)) { if (n = t[r], "undefined" == typeof n) return !1; if (e[r] != n) return !1; delete t[r] } for (r in t) if (t.hasOwnProperty(r)) return !1; return !0 } return n.nodeName != i.nodeName ? !1 : a(o(n), o(i)) && a(t.parseStyle(t.getAttrib(n, "style")), t.parseStyle(t.getAttrib(i, "style"))) ? !e.isBookmarkNode(n) && !e.isBookmarkNode(i) : !1 } } var r = t.each; return n }), r(P, [u], function (e) { function t(e, t) { function r(e) { return e.replace(/%(\w+)/g, "") } var i, o, a = e.dom, s = "", l, c; if (c = e.settings.preview_styles, c === !1) return ""; if (c || (c = "font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"), "string" == typeof t) { if (t = e.formatter.get(t), !t) return; t = t[0] } return i = t.block || t.inline || "span", o = a.create(i), n(t.styles, function (e, t) { e = r(e), e && a.setStyle(o, t, e) }), n(t.attributes, function (e, t) { e = r(e), e && a.setAttrib(o, t, e) }), n(t.classes, function (e) { e = r(e), a.hasClass(o, e) || a.addClass(o, e) }), e.fire("PreviewFormats"), a.setStyles(o, { position: "absolute", left: -65535 }), e.getBody().appendChild(o), l = a.getStyle(e.getBody(), "fontSize", !0), l = /px$/.test(l) ? parseInt(l, 10) : 0, n(c.split(" "), function (t) { var n = a.getStyle(o, t, !0); if (!("background-color" == t && /transparent|rgba\s*\([^)]+,\s*0\)/.test(n) && (n = a.getStyle(e.getBody(), t, !0), "#ffffff" == a.toHex(n).toLowerCase()) || "color" == t && "#000000" == a.toHex(n).toLowerCase())) { if ("font-size" == t && /em|%$/.test(n)) { if (0 === l) return; n = parseFloat(n, 10) / (/%$/.test(n) ? 100 : 1), n = n * l + "px" } "border" == t && n && (s += "padding:0 2px;"), s += t + ":" + n + ";" } }), e.fire("AfterPreviewFormats"), a.remove(o), s } var n = e.each; return { getCssText: t} }), r(O, [h, x, L, M, u, P], function (e, t, n, r, i, o) { return function (a) { function s(e) { return e.nodeType && (e = e.nodeName), !!a.schema.getTextBlockElements()[e.toLowerCase()] } function l(e, t) { return U.getParents(e, t, U.getRoot()) } function c(e) { return 1 === e.nodeType && "_mce_caret" === e.id } function u() { p({ valigntop: [{ selector: "td,th", styles: { verticalAlign: "top"}}], valignmiddle: [{ selector: "td,th", styles: { verticalAlign: "middle"}}], valignbottom: [{ selector: "td,th", styles: { verticalAlign: "bottom"}}], alignleft: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "left" }, defaultBlock: "div" }, { selector: "img,table", collapsed: !1, styles: { "float": "left"}}], aligncenter: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "center" }, defaultBlock: "div" }, { selector: "img", collapsed: !1, styles: { display: "block", marginLeft: "auto", marginRight: "auto"} }, { selector: "table", collapsed: !1, styles: { marginLeft: "auto", marginRight: "auto"}}], alignright: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "right" }, defaultBlock: "div" }, { selector: "img,table", collapsed: !1, styles: { "float": "right"}}], alignjustify: [{ selector: "figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li", styles: { textAlign: "justify" }, defaultBlock: "div"}], bold: [{ inline: "strong", remove: "all" }, { inline: "span", styles: { fontWeight: "bold"} }, { inline: "b", remove: "all"}], italic: [{ inline: "em", remove: "all" }, { inline: "span", styles: { fontStyle: "italic"} }, { inline: "i", remove: "all"}], underline: [{ inline: "span", styles: { textDecoration: "underline" }, exact: !0 }, { inline: "u", remove: "all"}], strikethrough: [{ inline: "span", styles: { textDecoration: "line-through" }, exact: !0 }, { inline: "strike", remove: "all"}], forecolor: { inline: "span", styles: { color: "%value" }, links: !0, remove_similar: !0 }, hilitecolor: { inline: "span", styles: { backgroundColor: "%value" }, links: !0, remove_similar: !0 }, fontname: { inline: "span", styles: { fontFamily: "%value"} }, fontsize: { inline: "span", styles: { fontSize: "%value"} }, fontsize_class: { inline: "span", attributes: { "class": "%value"} }, blockquote: { block: "blockquote", wrapper: 1, remove: "all" }, subscript: { inline: "sub" }, superscript: { inline: "sup" }, code: { inline: "code" }, link: { inline: "a", selector: "a", remove: "all", split: !0, deep: !0, onmatch: function () { return !0 }, onformat: function (e, t, n) { at(n, function (t, n) { U.setAttrib(e, n, t) }) } }, removeformat: [{ selector: "b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q", remove: "all", split: !0, expand: !1, block_expand: !0, deep: !0 }, { selector: "span", attributes: ["style", "class"], remove: "empty", split: !0, expand: !1, deep: !0 }, { selector: "*", attributes: ["style", "class"], split: !1, expand: !1, deep: !0}] }), at("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/), function (e) { p(e, { block: e, remove: "all" }) }), p(a.settings.formats) } function d() { a.addShortcut("ctrl+b", "bold_desc", "Bold"), a.addShortcut("ctrl+i", "italic_desc", "Italic"), a.addShortcut("ctrl+u", "underline_desc", "Underline"); for (var e = 1; 6 >= e; e++) a.addShortcut("ctrl+" + e, "", ["FormatBlock", !1, "h" + e]); a.addShortcut("ctrl+7", "", ["FormatBlock", !1, "p"]), a.addShortcut("ctrl+8", "", ["FormatBlock", !1, "div"]), a.addShortcut("ctrl+9", "", ["FormatBlock", !1, "address"]) } function f(e) { return e ? V[e] : V } function p(e, t) { e && ("string" != typeof e ? at(e, function (e, t) { p(t, e) }) : (t = t.length ? t : [t], at(t, function (e) { e.deep === tt && (e.deep = !e.selector), e.split === tt && (e.split = !e.selector || e.inline), e.remove === tt && e.selector && !e.inline && (e.remove = "none"), e.selector && e.inline && (e.mixed = !0, e.block_expand = !0), "string" == typeof e.classes && (e.classes = e.classes.split(/\s+/)) }), V[e] = t)) } function h(e) { return e && V[e] && delete V[e], V } function m(e) { var t; return a.dom.getParent(e, function (e) { return t = a.dom.getStyle(e, "text-decoration"), t && "none" !== t }), t } function g(e) { var t; 1 === e.nodeType && e.parentNode && 1 === e.parentNode.nodeType && (t = m(e.parentNode), a.dom.getStyle(e, "color") && t ? a.dom.setStyle(e, "text-decoration", t) : a.dom.getStyle(e, "textdecoration") === t && a.dom.setStyle(e, "text-decoration", null)) } function v(t, n, r) { function i(e, t) { if (t = t || d, e) { if (t.onformat && t.onformat(e, t, n, r), at(t.styles, function (t, r) { U.setStyle(e, r, A(t, n)) }), t.styles) { var i = U.getAttrib(e, "style"); i && e.setAttribute("data-mce-style", i) } at(t.attributes, function (t, r) { U.setAttrib(e, r, A(t, n)) }), at(t.classes, function (t) { t = A(t, n), U.hasClass(e, t) || U.addClass(e, t) }) } } function o() { function t(t, n) { var i = new e(n); for (r = i.current(); r; r = i.prev()) if (r.childNodes.length > 1 || r == t || "BR" == r.tagName) return r } var n = a.selection.getRng(), i = n.startContainer, o = n.endContainer; if (i != o && 0 === n.endOffset) { var s = t(i, o), l = 3 == s.nodeType ? s.length : s.childNodes.length; n.setEnd(s, l) } return n } function l(e, r, o) { var a = [], l, f, p = !0; l = d.inline || d.block, f = U.create(l), i(f), q.walk(e, function (e) { function r(e) { var g, v, y, b, x; return x = p, g = e.nodeName.toLowerCase(), v = e.parentNode.nodeName.toLowerCase(), 1 === e.nodeType && nt(e) && (x = p, p = "true" === nt(e), b = !0), S(g, "br") ? (h = 0, void (d.block && U.remove(e))) : d.wrapper && C(e, t, n) ? void (h = 0) : p && !b && d.block && !d.wrapper && s(g) && j(v, l) ? (e = U.rename(e, l), i(e), a.push(e), void (h = 0)) : d.selector && (at(u, function (t) { "collapsed" in t && t.collapsed !== m || U.is(e, t.selector) && !c(e) && (i(e, t), y = !0) }), !d.inline || y) ? void (h = 0) : void (!p || b || !j(l, g) || !j(v, l) || !o && 3 === e.nodeType && 1 === e.nodeValue.length && 65279 === e.nodeValue.charCodeAt(0) || c(e) || d.inline && Y(e) ? (h = 0, at(st(e.childNodes), r), b && (p = x), h = 0) : (h || (h = U.clone(f, Q), e.parentNode.insertBefore(h, e), a.push(h)), h.appendChild(e))) } var h; at(e, r) }), d.links === !0 && at(a, function (e) { function t(e) { "A" === e.nodeName && i(e, d), at(st(e.childNodes), t) } t(e) }), at(a, function (e) { function r(e) { var t = 0; return at(e.childNodes, function (e) { B(e) || ot(e) || t++ }), t } function o(e) { var t, n; return at(e.childNodes, function (e) { return 1 != e.nodeType || ot(e) || c(e) ? void 0 : (t = e, Q) }), t && !ot(t) && k(t, d) && (n = U.clone(t, Q), i(n), U.replace(n, e, Z), U.remove(t, 1)), n || e } var s; if (s = r(e), (a.length > 1 || !Y(e)) && 0 === s) return void U.remove(e, 1); if (d.inline || d.wrapper) { if (d.exact || 1 !== s || (e = o(e)), at(u, function (t) { at(U.select(t.inline, e), function (e) { ot(e) || M(t, n, e, t.exact ? e : null) }) }), C(e.parentNode, t, n)) return U.remove(e, 1), e = 0, Z; d.merge_with_parents && U.getParent(e.parentNode, function (r) { return C(r, t, n) ? (U.remove(e, 1), e = 0, Z) : void 0 }), e && d.merge_siblings !== !1 && (e = I(O(e), e), e = I(e, O(e, Z))) } }) } var u = f(t), d = u[0], p, h, m = !r && $.isCollapsed(); if (d) if (r) r.nodeType ? (h = U.createRng(), h.setStartBefore(r), h.setEndAfter(r), l(L(h, u), null, !0)) : l(r, null, !0); else if (m && d.inline && !U.select("td.mce-item-selected,th.mce-item-selected").length) z("apply", t, n); else { var y = a.selection.getNode(); K || !u[0].defaultBlock || U.getParent(y, U.isBlock) || v(u[0].defaultBlock), a.selection.setRng(o()), p = $.getBookmark(), l(L($.getRng(Z), u), p), d.styles && (d.styles.color || d.styles.textDecoration) && (lt(y, g, "childNodes"), g(y)), $.moveToBookmark(p), W($.getRng(Z)), a.nodeChanged() } } function y(e, t, n, r) { function i(e) { var n, r, o, a, s; if (1 === e.nodeType && nt(e) && (a = y, y = "true" === nt(e), s = !0), n = st(e.childNodes), y && !s) for (r = 0, o = p.length; o > r && !M(p[r], t, e, e); r++); if (h.deep && n.length) { for (r = 0, o = n.length; o > r; r++) i(n[r]); s && (y = a) } } function o(n) { var i; return at(l(n.parentNode).reverse(), function (n) { var o; i || "_start" == n.id || "_end" == n.id || (o = C(n, e, t, r), o && o.split !== !1 && (i = n)) }), i } function s(e, n, r, i) { var o, a, s, l, c, u; if (e) { for (u = e.parentNode, o = n.parentNode; o && o != u; o = o.parentNode) { for (a = U.clone(o, Q), c = 0; c < p.length; c++) if (M(p[c], t, a, a)) { a = 0; break } a && (s && a.appendChild(s), l || (l = a), s = a) } !i || h.mixed && Y(e) || (n = U.split(e, n)), s && (r.parentNode.insertBefore(s, r), l.appendChild(r)) } return n } function c(e) { return s(o(e), e, e, !0) } function u(e) { var t = U.get(e ? "_start" : "_end"), n = t[e ? "firstChild" : "lastChild"]; return ot(n) && (n = n[e ? "firstChild" : "lastChild"]), U.remove(t, !0), n } function d(e) { var t, n, r = e.commonAncestorContainer; e = L(e, p, Z), h.split && (t = F(e, Z), n = F(e), t != n ? (/^(TR|TH|TD)$/.test(t.nodeName) && t.firstChild && (t = "TR" == t.nodeName ? t.firstChild.firstChild || t : t.firstChild || t), r && /^T(HEAD|BODY|FOOT|R)$/.test(r.nodeName) && /^(TH|TD)$/.test(n.nodeName) && n.firstChild && (n = n.firstChild || n), t = D(t, "span", { id: "_start", "data-mce-type": "bookmark" }), n = D(n, "span", { id: "_end", "data-mce-type": "bookmark" }), c(t), c(n), t = u(Z), n = u()) : t = n = c(t), e.startContainer = t.parentNode, e.startOffset = G(t), e.endContainer = n.parentNode, e.endOffset = G(n) + 1), q.walk(e, function (e) { at(e, function (e) { i(e), 1 === e.nodeType && "underline" === a.dom.getStyle(e, "text-decoration") && e.parentNode && "underline" === m(e.parentNode) && M({ deep: !1, exact: !0, inline: "span", styles: { textDecoration: "underline"} }, null, e) }) }) } var p = f(e), h = p[0], g, v, y = !0; return n ? void (n.nodeType ? (v = U.createRng(), v.setStartBefore(n), v.setEndAfter(n), d(v)) : d(n)) : void ($.isCollapsed() && h.inline && !U.select("td.mce-item-selected,th.mce-item-selected").length ? z("remove", e, t, r) : (g = $.getBookmark(), d($.getRng(Z)), $.moveToBookmark(g), h.inline && x(e, t, $.getStart()) && W($.getRng(!0)), a.nodeChanged())) } function b(e, t, n) { var r = f(e); !x(e, t, n) || "toggle" in r[0] && !r[0].toggle ? v(e, t, n) : y(e, t, n) } function C(e, t, n, r) { function i(e, t, i) { var o, a, s = t[i], l; if (t.onmatch) return t.onmatch(e, t, i); if (s) if (s.length === tt) { for (o in s) if (s.hasOwnProperty(o)) { if (a = "attributes" === i ? U.getAttrib(e, o) : T(e, o), r && !a && !t.exact) return; if ((!r || t.exact) && !S(a, R(A(s[o], n), o))) return } } else for (l = 0; l < s.length; l++) if ("attributes" === i ? U.getAttrib(e, s[l]) : T(e, s[l])) return t; return t } var o = f(t), a, s, l; if (o && e) for (s = 0; s < o.length; s++) if (a = o[s], k(e, a) && i(e, a, "attributes") && i(e, a, "styles")) { if (l = a.classes) for (s = 0; s < l.length; s++) if (!U.hasClass(e, l[s])) return; return a } } function x(e, t, n) { function r(n) { var r = U.getRoot(); return n === r ? !1 : (n = U.getParent(n, function (n) { return n.parentNode === r || !!C(n, e, t, !0) }), C(n, e, t)) } var i; return n ? r(n) : (n = $.getNode(), r(n) ? Z : (i = $.getStart(), i != n && r(i) ? Z : Q)) } function w(e, t) { var n, r = [], i = {}; return n = $.getStart(), U.getParent(n, function (n) { var o, a; for (o = 0; o < e.length; o++) a = e[o], !i[a] && C(n, a, t) && (i[a] = !0, r.push(a)) }, U.getRoot()), r } function _(e) { var t = f(e), n, r, i, o, a; if (t) for (n = $.getStart(), r = l(n), o = t.length - 1; o >= 0; o--) { if (a = t[o].selector, !a || t[o].defaultBlock) return Z; for (i = r.length - 1; i >= 0; i--) if (U.is(r[i], a)) return Z } return Q } function E(e, t, n) { var r; return et || (et = {}, r = {}, a.on("NodeChange", function (e) { var t = l(e.element), n = {}; t = i.grep(t, function (e) { return 1 == e.nodeType && !e.getAttribute("data-mce-bogus") }), at(et, function (e, i) { at(t, function (o) { return C(o, i, {}, e.similar) ? (r[i] || (at(e, function (e) { e(!0, { node: o, format: i, parents: t }) }), r[i] = e), n[i] = e, !1) : void 0 }) }), at(r, function (i, o) { n[o] || (delete r[o], at(i, function (n) { n(!1, { node: e.element, format: o, parents: t }) })) }) })), at(e.split(","), function (e) { et[e] || (et[e] = [], et[e].similar = n), et[e].push(t) }), this } function N(e) { return o.getCssText(a, e) } function k(e, t) { return S(e, t.inline) ? Z : S(e, t.block) ? Z : t.selector ? 1 == e.nodeType && U.is(e, t.selector) : void 0 } function S(e, t) { return e = e || "", t = t || "", e = "" + (e.nodeName || e), t = "" + (t.nodeName || t), e.toLowerCase() == t.toLowerCase() } function T(e, t) { return R(U.getStyle(e, t), t) } function R(e, t) { return ("color" == t || "backgroundColor" == t) && (e = U.toHex(e)), "fontWeight" == t && 700 == e && (e = "bold"), "fontFamily" == t && (e = e.replace(/[\'\"]/g, "").replace(/,\s+/g, ",")), "" + e } function A(e, t) { return "string" != typeof e ? e = e(t) : t && (e = e.replace(/%(\w+)/g, function (e, n) { return t[n] || e })), e } function B(e) { return e && 3 === e.nodeType && /^([\t \r\n]+|)$/.test(e.nodeValue) } function D(e, t, n) { var r = U.create(t, n); return e.parentNode.insertBefore(r, e), r.appendChild(e), r } function L(t, n, r) { function i(e) { function t(e) { return "BR" == e.nodeName && e.getAttribute("data-mce-bogus") && !e.nextSibling } var r, i, o, a, s; if (r = i = e ? g : y, a = e ? "previousSibling" : "nextSibling", s = U.getRoot(), 3 == r.nodeType && !B(r) && (e ? v > 0 : b < r.nodeValue.length)) return r; for (; ; ) { if (!n[0].block_expand && Y(i)) return i; for (o = i[a]; o; o = o[a]) if (!ot(o) && !B(o) && !t(o)) return i; if (i.parentNode == s) { r = i; break } i = i.parentNode } return r } function o(e, t) { for (t === tt && (t = 3 === e.nodeType ? e.length : e.childNodes.length); e && e.hasChildNodes(); ) e = e.childNodes[t], e && (t = 3 === e.nodeType ? e.length : e.childNodes.length); return { node: e, offset: t} } function c(e) { for (var t = e; t; ) { if (1 === t.nodeType && nt(t)) return "false" === nt(t) ? t : e; t = t.parentNode } return e } function u(t, n, i) { function o(e, t) { var n, o, a = e.nodeValue; return "undefined" == typeof t && (t = i ? a.length : 0), i ? (n = a.lastIndexOf(" ", t), o = a.lastIndexOf("\xa0", t), n = n > o ? n : o, -1 === n || r || n++) : (n = a.indexOf(" ", t), o = a.indexOf("\xa0", t), n = -1 !== n && (-1 === o || o > n) ? n : o), n } var s, l, c, u; if (3 === t.nodeType) { if (c = o(t, n), -1 !== c) return { container: t, offset: c }; u = t } for (s = new e(t, U.getParent(t, Y) || a.getBody()); l = s[i ? "prev" : "next"](); ) if (3 === l.nodeType) { if (u = l, c = o(l), -1 !== c) return { container: l, offset: c} } else if (Y(l)) break; return u ? (n = i ? 0 : u.length, { container: u, offset: n }) : void 0 } function d(e, r) { var i, o, a, s; for (3 == e.nodeType && 0 === e.nodeValue.length && e[r] && (e = e[r]), i = l(e), o = 0; o < i.length; o++) for (a = 0; a < n.length; a++) if (s = n[a], !("collapsed" in s && s.collapsed !== t.collapsed) && U.is(i[o], s.selector)) return i[o]; return e } function f(e, t) { var r, i = U.getRoot(); if (n[0].wrapper || (r = U.getParent(e, n[0].block, i)), r || (r = U.getParent(3 == e.nodeType ? e.parentNode : e, function (e) { return e != i && s(e) })), r && n[0].wrapper && (r = l(r, "ul,ol").reverse()[0] || r), !r) for (r = e; r[t] && !Y(r[t]) && (r = r[t], !S(r, "br")); ); return r || e } var p, h, m, g = t.startContainer, v = t.startOffset, y = t.endContainer, b = t.endOffset; if (1 == g.nodeType && g.hasChildNodes() && (p = g.childNodes.length - 1, g = g.childNodes[v > p ? p : v], 3 == g.nodeType && (v = 0)), 1 == y.nodeType && y.hasChildNodes() && (p = y.childNodes.length - 1, y = y.childNodes[b > p ? p : b - 1], 3 == y.nodeType && (b = y.nodeValue.length)), g = c(g), y = c(y), (ot(g.parentNode) || ot(g)) && (g = ot(g) ? g : g.parentNode, g = g.nextSibling || g, 3 == g.nodeType && (v = 0)), (ot(y.parentNode) || ot(y)) && (y = ot(y) ? y : y.parentNode, y = y.previousSibling || y, 3 == y.nodeType && (b = y.length)), n[0].inline && (t.collapsed && (m = u(g, v, !0), m && (g = m.container, v = m.offset), m = u(y, b), m && (y = m.container, b = m.offset)), h = o(y, b), h.node)) { for (; h.node && 0 === h.offset && h.node.previousSibling; ) h = o(h.node.previousSibling); h.node && h.offset > 0 && 3 === h.node.nodeType && " " === h.node.nodeValue.charAt(h.offset - 1) && h.offset > 1 && (y = h.node, y.splitText(h.offset - 1)) } return (n[0].inline || n[0].block_expand) && (n[0].inline && 3 == g.nodeType && 0 !== v || (g = i(!0)), n[0].inline && 3 == y.nodeType && b !== y.nodeValue.length || (y = i())), n[0].selector && n[0].expand !== Q && !n[0].inline && (g = d(g, "previousSibling"), y = d(y, "nextSibling")), (n[0].block || n[0].selector) && (g = f(g, "previousSibling"), y = f(y, "nextSibling"), n[0].block && (Y(g) || (g = i(!0)), Y(y) || (y = i()))), 1 == g.nodeType && (v = G(g), g = g.parentNode), 1 == y.nodeType && (b = G(y) + 1, y = y.parentNode), { startContainer: g, startOffset: v, endContainer: y, endOffset: b} } function H(e, t) { return t.links && "A" == e.tagName } function M(e, t, n, r) { var i, o, a; if (!k(n, e) && !H(n, e)) return Q; if ("all" != e.remove) for (at(e.styles, function (i, o) { i = R(A(i, t), o), "number" == typeof o && (o = i, r = 0), (e.remove_similar || !r || S(T(r, o), i)) && U.setStyle(n, o, ""), a = 1 }), a && "" === U.getAttrib(n, "style") && (n.removeAttribute("style"), n.removeAttribute("data-mce-style")), at(e.attributes, function (e, i) { var o; if (e = A(e, t), "number" == typeof i && (i = e, r = 0), !r || S(U.getAttrib(r, i), e)) { if ("class" == i && (e = U.getAttrib(n, i), e && (o = "", at(e.split(/\s+/), function (e) { /mce\w+/.test(e) && (o += (o ? " " : "") + e) }), o))) return void U.setAttrib(n, i, o); "class" == i && n.removeAttribute("className"), J.test(i) && n.removeAttribute("data-mce-" + i), n.removeAttribute(i) } }), at(e.classes, function (e) { e = A(e, t), (!r || U.hasClass(r, e)) && U.removeClass(n, e) }), o = U.getAttribs(n), i = 0; i < o.length; i++) if (0 !== o[i].nodeName.indexOf("_")) return Q; return "none" != e.remove ? (P(n, e), Z) : void 0 } function P(e, t) { function n(e, t, n) { return e = O(e, t, n), !e || "BR" == e.nodeName || Y(e) } var r = e.parentNode, i; t.block && (K ? r == U.getRoot() && (t.list_block && S(e, t.list_block) || at(st(e.childNodes), function (e) { j(K, e.nodeName.toLowerCase()) ? i ? i.appendChild(e) : (i = D(e, K), U.setAttribs(i, a.settings.forced_root_block_attrs)) : i = 0 })) : Y(e) && !Y(r) && (n(e, Q) || n(e.firstChild, Z, 1) || e.insertBefore(U.create("br"), e.firstChild), n(e, Z) || n(e.lastChild, Q, 1) || e.appendChild(U.create("br")))), t.selector && t.inline && !S(t.inline, e) || U.remove(e, 1) } function O(e, t, n) { if (e) for (t = t ? "nextSibling" : "previousSibling", e = n ? e : e[t]; e; e = e[t]) if (1 == e.nodeType || !B(e)) return e } function I(e, t) { function n(e, t) { for (i = e; i; i = i[t]) { if (3 == i.nodeType && 0 !== i.nodeValue.length) return e; if (1 == i.nodeType && !ot(i)) return i } return e } var i, o, a = new r(U); if (e && t && (e = n(e, "previousSibling"), t = n(t, "nextSibling"), a.compare(e, t))) { for (i = e.nextSibling; i && i != t; ) o = i, i = i.nextSibling, e.appendChild(o); return U.remove(t), at(st(t.childNodes), function (t) { e.appendChild(t) }), e } return t } function F(t, n) { var r, i, o; return r = t[n ? "startContainer" : "endContainer"], i = t[n ? "startOffset" : "endOffset"], 1 == r.nodeType && (o = r.childNodes.length - 1, !n && i && i--, r = r.childNodes[i > o ? o : i]), 3 === r.nodeType && n && i >= r.nodeValue.length && (r = new e(r, a.getBody()).next() || r), 3 !== r.nodeType || n || 0 !== i || (r = new e(r, a.getBody()).prev() || r), r } function z(t, n, r, i) { function o(e) { var t = U.create("span", { id: g, "data-mce-bogus": !0, style: b ? "color:red" : "" }); return e && t.appendChild(a.getDoc().createTextNode(X)), t } function l(e, t) { for (; e; ) { if (3 === e.nodeType && e.nodeValue !== X || e.childNodes.length > 1) return !1; t && 1 === e.nodeType && t.push(e), e = e.firstChild } return !0 } function c(e) { for (; e; ) { if (e.id === g) return e; e = e.parentNode } } function u(t) { var n; if (t) for (n = new e(t, t), t = n.current(); t; t = n.next()) if (3 === t.nodeType) return t } function d(e, t) { var n, r; if (e) r = $.getRng(!0), l(e) ? (t !== !1 && (r.setStartBefore(e), r.setEndBefore(e)), U.remove(e)) : (n = u(e), n.nodeValue.charAt(0) === X && (n.deleteData(0, 1), r.startContainer == n && r.startOffset > 0 && r.setStart(n, r.startOffset - 1), r.endContainer == n && r.endOffset > 0 && r.setEnd(n, r.endOffset - 1)), U.remove(e, 1)), $.setRng(r); else if (e = c($.getStart()), !e) for (; e = U.get(g); ) d(e, !1) } function p() { var e, t, i, a, s, l, d; e = $.getRng(!0), a = e.startOffset, l = e.startContainer, d = l.nodeValue, t = c($.getStart()), t && (i = u(t)), d && a > 0 && a < d.length && /\w/.test(d.charAt(a)) && /\w/.test(d.charAt(a - 1)) ? (s = $.getBookmark(), e.collapse(!0), e = L(e, f(n)), e = q.split(e), v(n, r, e), $.moveToBookmark(s)) : (t && i.nodeValue === X ? v(n, r, t) : (t = o(!0), i = t.firstChild, e.insertNode(t), a = 1, v(n, r, t)), $.setCursorLocation(i, a)) } function h() { var e = $.getRng(!0), t, a, l, c, u, d, p = [], h, m; for (t = e.startContainer, a = e.startOffset, u = t, 3 == t.nodeType && (a != t.nodeValue.length && (c = !0), u = u.parentNode); u; ) { if (C(u, n, r, i)) { d = u; break } u.nextSibling && (c = !0), p.push(u), u = u.parentNode } if (d) if (c) l = $.getBookmark(), e.collapse(!0), e = L(e, f(n), !0), e = q.split(e), y(n, r, e), $.moveToBookmark(l); else { for (m = o(), u = m, h = p.length - 1; h >= 0; h--) u.appendChild(U.clone(p[h], !1)), u = u.firstChild; u.appendChild(U.doc.createTextNode(X)), u = u.firstChild; var g = U.getParent(d, s); g && U.isEmpty(g) ? d.parentNode.replaceChild(m, d) : U.insertAfter(m, d), $.setCursorLocation(u, 1), U.isEmpty(d) && U.remove(d) } } function m() { var e; e = c($.getStart()), e && !U.isEmpty(e) && lt(e, function (e) { 1 != e.nodeType || e.id === g || U.isEmpty(e) || U.setAttrib(e, "data-mce-bogus", null) }, "childNodes") } var g = "_mce_caret", b = a.settings.caret_debug; a._hasCaretEvents || (it = function () { var e = [], t; if (l(c($.getStart()), e)) for (t = e.length; t--; ) U.setAttrib(e[t], "data-mce-bogus", "1") }, rt = function (e) { var t = e.keyCode; d(), (8 == t || 37 == t || 39 == t) && d(c($.getStart())), m() }, a.on("SetContent", function (e) { e.selection && m() }), a._hasCaretEvents = !0), "apply" == t ? p() : h() } function W(t) { var n = t.startContainer, r = t.startOffset, i, o, a, s, l; if (3 == n.nodeType && r >= n.nodeValue.length && (r = G(n), n = n.parentNode, i = !0), 1 == n.nodeType) for (s = n.childNodes, n = s[Math.min(r, s.length - 1)], o = new e(n, U.getParent(n, U.isBlock)), (r > s.length - 1 || i) && o.next(), a = o.current(); a; a = o.next()) if (3 == a.nodeType && !B(a)) return l = U.create("a", { "data-mce-bogus": "all" }, X), a.parentNode.insertBefore(l, a), t.setStart(a, 0), $.setRng(t), void U.remove(l) } var V = {}, U = a.dom, $ = a.selection, q = new t(U), j = a.schema.isValidChild, Y = U.isBlock, K = a.settings.forced_root_block, G = U.nodeIndex, X = "\ufeff", J = /^(src|href|style)$/, Q = !1, Z = !0, et, tt, nt = U.getContentEditable, rt, it, ot = n.isBookmarkNode, at = i.each, st = i.grep, lt = i.walk, ct = i.extend; ct(this, { get: f, register: p, unregister: h, apply: v, remove: y, toggle: b, match: x, matchAll: w, matchNode: C, canApply: _, formatChanged: E, getCssText: N }), u(), d(), a.on("BeforeGetContent", function (e) { it && "raw" != e.format && it() }), a.on("mouseup keydown", function (e) { rt && rt(e) }) } }), r(I, [d, u, N], function (e, t, n) { var r = t.trim, i; return i = new RegExp(["<span[^>]+data-mce-bogus[^>]+>[\u200b\ufeff]+<\\/span>", '\\s?data-mce-selected="[^"]+"'].join("|"), "gi"), function (t) { function o() { var e = t.getContent({ format: "raw", no_events: 1 }), o = /<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g, a, s, l, c, u, d = t.schema; for (e = e.replace(i, ""), u = d.getShortEndedElements(); c = o.exec(e); ) s = o.lastIndex, l = c[0].length, a = u[c[1]] ? s : n.findEndTag(d, e, s), e = e.substring(0, s - l) + e.substring(a), o.lastIndex = s - l; return r(e) } function a(e) { s.typing = !1, s.add({}, e) } var s = this, l = 0, c = [], u, d, f = 0; return t.on("init", function () { s.add() }), t.on("BeforeExecCommand", function (e) { var t = e.command; "Undo" != t && "Redo" != t && "mceRepaint" != t && s.beforeChange() }), t.on("ExecCommand", function (e) { var t = e.command; "Undo" != t && "Redo" != t && "mceRepaint" != t && a(e) }), t.on("ObjectResizeStart", function () { s.beforeChange() }), t.on("SaveContent ObjectResized blur", a), t.on("DragEnd", a), t.on("KeyUp", function (n) { var r = n.keyCode; (r >= 33 && 36 >= r || r >= 37 && 40 >= r || 45 == r || 13 == r || n.ctrlKey) && (a(), t.nodeChanged()), (46 == r || 8 == r || e.mac && (91 == r || 93 == r)) && t.nodeChanged(), d && s.typing && (t.isDirty() || (t.isNotDirty = !c[0] || o() == c[0].content, t.isNotDirty || t.fire("change", { level: c[0], lastLevel: null })), t.fire("TypingUndo"), d = !1, t.nodeChanged()) }), t.on("KeyDown", function (e) { var t = e.keyCode; return t >= 33 && 36 >= t || t >= 37 && 40 >= t || 45 == t ? void (s.typing && a(e)) : void ((16 > t || t > 20) && 224 != t && 91 != t && !s.typing && (s.beforeChange(), s.typing = !0, s.add({}, e), d = !0)) }), t.on("MouseDown", function (e) { s.typing && a(e) }), t.addShortcut("ctrl+z", "", "Undo"), t.addShortcut("ctrl+y,ctrl+shift+z", "", "Redo"), t.on("AddUndo Undo Redo ClearUndos", function (e) { e.isDefaultPrevented() || t.nodeChanged() }), s = { data: c, typing: !1, beforeChange: function () { f || (u = t.selection.getBookmark(2, !0)) }, add: function (e, n) { var r, i = t.settings, a; if (e = e || {}, e.content = o(), f || t.removed) return null; if (a = c[l], t.fire("BeforeAddUndo", { level: e, lastLevel: a, originalEvent: n }).isDefaultPrevented()) return null; if (a && a.content == e.content) return null; if (c[l] && (c[l].beforeBookmark = u), i.custom_undo_redo_levels && c.length > i.custom_undo_redo_levels) { for (r = 0; r < c.length - 1; r++) c[r] = c[r + 1]; c.length--, l = c.length } e.bookmark = t.selection.getBookmark(2, !0), l < c.length - 1 && (c.length = l + 1), c.push(e), l = c.length - 1; var s = { level: e, lastLevel: a, originalEvent: n }; return t.fire("AddUndo", s), l > 0 && (t.isNotDirty = !1, t.fire("change", s)), e }, undo: function () { var e; return s.typing && (s.add(), s.typing = !1), l > 0 && (e = c[--l], 0 === l && (t.isNotDirty = !0), t.setContent(e.content, { format: "raw" }), t.selection.moveToBookmark(e.beforeBookmark), t.fire("undo", { level: e })), e }, redo: function () { var e; return l < c.length - 1 && (e = c[++l], t.setContent(e.content, { format: "raw" }), t.selection.moveToBookmark(e.bookmark), t.fire("redo", { level: e })), e }, clear: function () { c = [], l = 0, s.typing = !1, t.fire("ClearUndos") }, hasUndo: function () { return l > 0 || s.typing && c[0] && o() != c[0].content }, hasRedo: function () { return l < c.length - 1 && !this.typing }, transact: function (e) { s.beforeChange(); try { f++, e() } finally { f-- } s.add() } } } }), r(F, [h, x, d], function (e, t, n) { var r = n.ie && n.ie < 11; return function (i) { function o(o) { function f(e) { return e && a.isBlock(e) && !/^(TD|TH|CAPTION|FORM)$/.test(e.nodeName) && !/^(fixed|absolute)/i.test(e.style.position) && "true" !== a.getContentEditable(e) } function p(e) { var t; a.isBlock(e) && (t = s.getRng(), e.appendChild(a.create("span", null, "\xa0")), s.select(e), e.lastChild.outerHTML = "", s.setRng(t)) } function h(e) { var t = e, n = [], r; if (t) { for (; t = t.firstChild; ) { if (a.isBlock(t)) return; 1 != t.nodeType || d[t.nodeName.toLowerCase()] || n.push(t) } for (r = n.length; r--; ) t = n[r], !t.hasChildNodes() || t.firstChild == t.lastChild && "" === t.firstChild.nodeValue ? a.remove(t) : "A" == t.nodeName && " " === (t.innerText || t.textContent) && a.remove(t) } } function m(t) { function r(e) { for (; e; ) { if (1 == e.nodeType || 3 == e.nodeType && e.data && /[\r\n\s]/.test(e.data)) return e; e = e.nextSibling } } var i, o, l, c = t, u; if (t) { if (n.ie && n.ie < 9 && A && A.firstChild && A.firstChild == A.lastChild && "BR" == A.firstChild.tagName && a.remove(A.firstChild), /^(LI|DT|DD)$/.test(t.nodeName)) { var f = r(t.firstChild); f && /^(UL|OL|DL)$/.test(f.nodeName) && t.insertBefore(a.doc.createTextNode("\xa0"), t.firstChild) } if (l = a.createRng(), n.ie || t.normalize(), t.hasChildNodes()) { for (i = new e(t, t); o = i.current(); ) { if (3 == o.nodeType) { l.setStart(o, 0), l.setEnd(o, 0); break } if (d[o.nodeName.toLowerCase()]) { l.setStartBefore(o), l.setEndBefore(o); break } c = o, o = i.next() } o || (l.setStart(c, 0), l.setEnd(c, 0)) } else "BR" == t.nodeName ? t.nextSibling && a.isBlock(t.nextSibling) ? ((!B || 9 > B) && (u = a.create("br"), t.parentNode.insertBefore(u, t)), l.setStartBefore(t), l.setEndBefore(t)) : (l.setStartAfter(t), l.setEndAfter(t)) : (l.setStart(t, 0), l.setEnd(t, 0)); s.setRng(l), a.remove(u), s.scrollIntoView(t) } } function g(e) { var t = l.forced_root_block; t && t.toLowerCase() === e.tagName.toLowerCase() && a.setAttribs(e, l.forced_root_block_attrs) } function v(e) { var t = T, n, i, o, s = u.getTextInlineElements(); if (e || "TABLE" == P ? (n = a.create(e || I), g(n)) : n = A.cloneNode(!1), o = n, l.keep_styles !== !1) do if (s[t.nodeName]) { if ("_mce_caret" == t.id) continue; i = t.cloneNode(!1), a.setAttrib(i, "id", ""), n.hasChildNodes() ? (i.appendChild(n.firstChild), n.appendChild(i)) : (o = i, n.appendChild(i)) } while (t = t.parentNode); return r || (o.innerHTML = '<br data-mce-bogus="1">'), n } function y(t) { var n, r, i; if (3 == T.nodeType && (t ? R > 0 : R < T.nodeValue.length)) return !1; if (T.parentNode == A && F && !t) return !0; if (t && 1 == T.nodeType && T == A.firstChild) return !0; if ("TABLE" === T.nodeName || T.previousSibling && "TABLE" == T.previousSibling.nodeName) return F && !t || !F && t; for (n = new e(T, A), 3 == T.nodeType && (t && 0 === R ? n.prev() : t || R != T.nodeValue.length || n.next()); r = n.current(); ) { if (1 === r.nodeType) { if (!r.getAttribute("data-mce-bogus") && (i = r.nodeName.toLowerCase(), d[i] && "br" !== i)) return !1 } else if (3 === r.nodeType && !/^[ \t\r\n]*$/.test(r.nodeValue)) return !1; t ? n.prev() : n.next() } return !0 } function b(e, t) { var n, r, o, s, l, c, d = I || "P"; if (r = a.getParent(e, a.isBlock), c = i.getBody().nodeName.toLowerCase(), !r || !f(r)) { if (r = r || S, !r.hasChildNodes()) return n = a.create(d), g(n), r.appendChild(n), N.setStart(n, 0), N.setEnd(n, 0), n; for (s = e; s.parentNode != r; ) s = s.parentNode; for (; s && !a.isBlock(s); ) o = s, s = s.previousSibling; if (o && u.isValidChild(c, d.toLowerCase())) { for (n = a.create(d), g(n), o.parentNode.insertBefore(n, o), s = o; s && !a.isBlock(s); ) l = s.nextSibling, n.appendChild(s), s = l; N.setStart(e, t), N.setEnd(e, t) } } return e } function C() { function e(e) { for (var t = M[e ? "firstChild" : "lastChild"]; t && 1 != t.nodeType; ) t = t[e ? "nextSibling" : "previousSibling"]; return t === A } function t() { var e = M.parentNode; return /^(LI|DT|DD)$/.test(e.nodeName) ? e : M } var n = M.parentNode.nodeName; /^(OL|UL|LI)$/.test(n) && (I = "LI"), L = I ? v(I) : a.create("BR"), e(!0) && e() ? "LI" == n ? a.insertAfter(L, t()) : a.replace(L, M) : e(!0) ? "LI" == n ? (a.insertAfter(L, t()), L.appendChild(a.doc.createTextNode(" ")), L.appendChild(M)) : M.parentNode.insertBefore(L, M) : e() ? (a.insertAfter(L, t()), p(L)) : (M = t(), k = N.cloneRange(), k.setStartAfter(A), k.setEndAfter(M), H = k.extractContents(), "LI" == I && "LI" == H.firstChild.nodeName ? (L = H.firstChild, a.insertAfter(H, M)) : (a.insertAfter(H, M), a.insertAfter(L, M))), a.remove(A), m(L), c.add() } function x() { i.execCommand("InsertLineBreak", !1, o) } function w(e) { do 3 === e.nodeType && (e.nodeValue = e.nodeValue.replace(/^[\r\n]+/, "")), e = e.firstChild; while (e) } function _(e) { var t = a.getRoot(), n, r; for (n = e; n !== t && "false" !== a.getContentEditable(n); ) "true" === a.getContentEditable(n) && (r = n), n = n.parentNode; return n !== t ? r : t } function E(e) { var t; r || (e.normalize(), t = e.lastChild, (!t || /^(left|right)$/gi.test(a.getStyle(t, "float", !0))) && a.add(e, "br")) } var N, k, S, T, R, A, B, D, L, H, M, P, O, I, F; if (N = s.getRng(!0), !o.isDefaultPrevented()) { if (!N.collapsed) return void i.execCommand("Delete"); if (new t(a).normalize(N), T = N.startContainer, R = N.startOffset, I = (l.force_p_newlines ? "p" : "") || l.forced_root_block, I = I ? I.toUpperCase() : "", B = a.doc.documentMode, D = o.shiftKey, 1 == T.nodeType && T.hasChildNodes() && (F = R > T.childNodes.length - 1, T = T.childNodes[Math.min(R, T.childNodes.length - 1)] || T, R = F && 3 == T.nodeType ? T.nodeValue.length : 0), S = _(T)) { if (c.beforeChange(), !a.isBlock(S) && S != a.getRoot()) return void ((!I || D) && x()); if ((I && !D || !I && D) && (T = b(T, R)), A = a.getParent(T, a.isBlock), M = A ? a.getParent(A.parentNode, a.isBlock) : null, P = A ? A.nodeName.toUpperCase() : "", O = M ? M.nodeName.toUpperCase() : "", "LI" != O || o.ctrlKey || (A = M, P = O), /^(LI|DT|DD)$/.test(P)) { if (!I && D) return void x(); if (a.isEmpty(A)) return void C() } if ("PRE" == P && l.br_in_pre !== !1) { if (!D) return void x() } else if (!I && !D && "LI" != P || I && D) return void x(); I && A === i.getBody() || (I = I || "P", y() ? (L = /^(H[1-6]|PRE|FIGURE)$/.test(P) && "HGROUP" != O ? v(I) : v(), l.end_container_on_empty_block && f(M) && a.isEmpty(A) ? L = a.split(M, A) : a.insertAfter(L, A), m(L)) : y(!0) ? (L = A.parentNode.insertBefore(v(), A), p(L), m(A)) : (k = N.cloneRange(), k.setEndAfter(A), H = k.extractContents(), w(H), L = H.firstChild, a.insertAfter(H, A), h(L), E(A), m(L)), a.setAttrib(L, "id", ""), i.fire("NewBlock", { newBlock: L }), c.add()) } } } var a = i.dom, s = i.selection, l = i.settings, c = i.undoManager, u = i.schema, d = u.getNonEmptyElements(); i.on("keydown", function (e) { 13 == e.keyCode && o(e) !== !1 && e.preventDefault() }) } }), r(z, [], function () { return function (e) { function t() { var t = i.getStart(), s = e.getBody(), l, c, u, d, f, p, h, m = -16777215, g, v, y, b, C; if (C = n.forced_root_block, t && 1 === t.nodeType && C) { for (; t && t != s; ) { if (a[t.nodeName]) return; t = t.parentNode } if (l = i.getRng(), l.setStart) { c = l.startContainer, u = l.startOffset, d = l.endContainer, f = l.endOffset; try { v = e.getDoc().activeElement === s } catch (x) { } } else l.item && (t = l.item(0), l = e.getDoc().body.createTextRange(), l.moveToElementText(t)), v = l.parentElement().ownerDocument === e.getDoc(), y = l.duplicate(), y.collapse(!0), u = -1 * y.move("character", m), y.collapsed || (y = l.duplicate(), y.collapse(!1), f = -1 * y.move("character", m) - u); for (t = s.firstChild, b = s.nodeName.toLowerCase(); t; ) if ((3 === t.nodeType || 1 == t.nodeType && !a[t.nodeName]) && o.isValidChild(b, C.toLowerCase())) { if (3 === t.nodeType && 0 === t.nodeValue.length) { h = t, t = t.nextSibling, r.remove(h); continue } p || (p = r.create(C, e.settings.forced_root_block_attrs), t.parentNode.insertBefore(p, t), g = !0), h = t, t = t.nextSibling, p.appendChild(h) } else p = null, t = t.nextSibling; if (g && v) { if (l.setStart) l.setStart(c, u), l.setEnd(d, f), i.setRng(l); else try { l = e.getDoc().body.createTextRange(), l.moveToElementText(s), l.collapse(!0), l.moveStart("character", u), f > 0 && l.moveEnd("character", f), l.select() } catch (x) { } e.nodeChanged() } } } var n = e.settings, r = e.dom, i = e.selection, o = e.schema, a = o.getBlockElements(); n.forced_root_block && e.on("NodeChange", t) } }), r(W, [T, d, u, M, x, h], function (e, n, r, i, o, a) { var s = r.each, l = r.extend, c = r.map, u = r.inArray, d = r.explode, f = n.gecko, p = n.ie, h = n.ie && n.ie < 11, m = !0, g = !1; return function (r) { function v(e, t, n) { var r; return e = e.toLowerCase(), (r = T.exec[e]) ? (r(e, t, n), m) : g } function y(e) { var t; return e = e.toLowerCase(), (t = T.state[e]) ? t(e) : -1 } function b(e) { var t; return e = e.toLowerCase(), (t = T.value[e]) ? t(e) : g } function C(e, t) { t = t || "exec", s(e, function (e, n) { s(n.toLowerCase().split(","), function (n) { T[t][n] = e }) }) } function x(e, n, i) { return n === t && (n = g), i === t && (i = null), r.getDoc().execCommand(e, n, i) } function w(e) { return A.match(e) } function _(e, n) { A.toggle(e, n ? { value: n} : t), r.nodeChanged() } function E(e) { B = S.getBookmark(e) } function N() { S.moveToBookmark(B) } var k = r.dom, S = r.selection, T = { state: {}, exec: {}, value: {} }, R = r.settings, A = r.formatter, B; l(this, { execCommand: v, queryCommandState: y, queryCommandValue: b, addCommands: C }), C({ "mceResetDesignMode,mceBeginUndoLevel": function () { }, "mceEndUndoLevel,mceAddUndoLevel": function () { r.undoManager.add() }, "Cut,Copy,Paste": function (e) { var t = r.getDoc(), i; try { x(e) } catch (o) { i = m } if (i || !t.queryCommandSupported(e)) { var a = r.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead."); n.mac && (a = a.replace(/Ctrl\+/g, "\u2318+")), r.windowManager.alert(a) } }, unlink: function () { if (S.isCollapsed()) { var e = S.getNode(); return void ("A" == e.tagName && r.dom.remove(e, !0)) } A.remove("link") }, "JustifyLeft,JustifyCenter,JustifyRight,JustifyFull": function (e) { var t = e.substring(7); "full" == t && (t = "justify"), s("left,center,right,justify".split(","), function (e) { t != e && A.remove("align" + e) }), _("align" + t), v("mceRepaint") }, "InsertUnorderedList,InsertOrderedList": function (e) { var t, n; x(e), t = k.getParent(S.getNode(), "ol,ul"), t && (n = t.parentNode, /^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName) && (E(), k.split(n, t), N())) }, "Bold,Italic,Underline,Strikethrough,Superscript,Subscript": function (e) { _(e) }, "ForeColor,HiliteColor,FontName": function (e, t, n) { _(e, n) }, FontSize: function (e, t, n) { var r, i; n >= 1 && 7 >= n && (i = d(R.font_size_style_values), r = d(R.font_size_classes), n = r ? r[n - 1] || n : i[n - 1] || n), _(e, n) }, RemoveFormat: function (e) { A.remove(e) }, mceBlockQuote: function () { _("blockquote") }, FormatBlock: function (e, t, n) { return _(n || "p") }, mceCleanup: function () { var e = S.getBookmark(); r.setContent(r.getContent({ cleanup: m }), { cleanup: m }), S.moveToBookmark(e) }, mceRemoveNode: function (e, t, n) { var i = n || S.getNode(); i != r.getBody() && (E(), r.dom.remove(i, m), N()) }, mceSelectNodeDepth: function (e, t, n) { var i = 0; k.getParent(S.getNode(), function (e) { return 1 == e.nodeType && i++ == n ? (S.select(e), g) : void 0 }, r.getBody()) }, mceSelectNode: function (e, t, n) { S.select(n) }, mceInsertContent: function (t, n, o) { function a(e) { function t(e) { return r[e] && 3 == r[e].nodeType } var n, r, i; return n = S.getRng(!0), r = n.startContainer, i = n.startOffset, 3 == r.nodeType && (i > 0 ? e = e.replace(/^&nbsp;/, " ") : t("previousSibling") || (e = e.replace(/^ /, "&nbsp;")), i < r.length ? e = e.replace(/&nbsp;(<br>|)$/, " ") : t("nextSibling") || (e = e.replace(/(&nbsp;| )(<br>|)$/, "&nbsp;"))), e } function l(e) { if (w) for (b = e.firstChild; b; b = b.walk(!0)) _[b.name] && b.attr("data-mce-new", "true") } function c() { if (w) { var e = r.getBody(), t = new i(k); s(k.select("*[data-mce-new]"), function (n) { n.removeAttribute("data-mce-new"); for (var r = n.parentNode; r && r != e; r = r.parentNode) t.compare(r, n) && k.remove(n, !0) }) } } var u, d, f, h, m, g, v, y, b, C, x, w, _ = r.schema.getTextInlineElements(); "string" != typeof o && (w = o.merge, o = o.content), /^ | $/.test(o) && (o = a(o)), u = r.parser, d = new e({}, r.schema), x = '<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>', g = { content: o, format: "html", selection: !0 }, r.fire("BeforeSetContent", g), o = g.content, -1 == o.indexOf("{$caret}") && (o += "{$caret}"), o = o.replace(/\{\$caret\}/, x), y = S.getRng(); var E = y.startContainer || (y.parentElement ? y.parentElement() : null), N = r.getBody(); E === N && S.isCollapsed() && k.isBlock(N.firstChild) && k.isEmpty(N.firstChild) && (y = k.createRng(), y.setStart(N.firstChild, 0), y.setEnd(N.firstChild, 0), S.setRng(y)), S.isCollapsed() || r.getDoc().execCommand("Delete", !1, null), f = S.getNode(); var T = { context: f.nodeName.toLowerCase() }; if (m = u.parse(o, T), l(m), b = m.lastChild, "mce_marker" == b.attr("id")) for (v = b, b = b.prev; b; b = b.walk(!0)) if (3 == b.type || !k.isBlock(b.name)) { r.schema.isValidChild(b.parent.name, "span") && b.parent.insert(v, b, "br" === b.name); break } if (T.invalid) { for (S.setContent(x), f = S.getNode(), h = r.getBody(), 9 == f.nodeType ? f = b = h : b = f; b !== h; ) f = b, b = b.parentNode; o = f == h ? h.innerHTML : k.getOuterHTML(f), o = d.serialize(u.parse(o.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i, function () { return d.serialize(m) }))), f == h ? k.setHTML(h, o) : k.setOuterHTML(f, o) } else o = d.serialize(m), b = f.firstChild, C = f.lastChild, !b || b === C && "BR" === b.nodeName ? k.setHTML(f, o) : S.setContent(o); c(), v = k.get("mce_marker"), S.scrollIntoView(v), y = k.createRng(), b = v.previousSibling, b && 3 == b.nodeType ? (y.setStart(b, b.nodeValue.length), p || (C = v.nextSibling, C && 3 == C.nodeType && (b.appendData(C.data), C.parentNode.removeChild(C)))) : (y.setStartBefore(v), y.setEndBefore(v)), k.remove(v), S.setRng(y), r.fire("SetContent", g), r.addVisual() }, mceInsertRawHTML: function (e, t, n) { S.setContent("tiny_mce_marker"), r.setContent(r.getContent().replace(/tiny_mce_marker/g, function () { return n })) }, mceToggleFormat: function (e, t, n) { _(n) }, mceSetContent: function (e, t, n) { r.setContent(n) }, "Indent,Outdent": function (e) { var t, n, i; t = R.indentation, n = /[a-z%]+$/i.exec(t), t = parseInt(t, 10), y("InsertUnorderedList") || y("InsertOrderedList") ? x(e) : (R.forced_root_block || k.getParent(S.getNode(), k.isBlock) || A.apply("div"), s(S.getSelectedBlocks(), function (o) { if ("LI" != o.nodeName) { var a = r.getParam("indent_use_margin", !1) ? "margin" : "padding"; a += "rtl" == k.getStyle(o, "direction", !0) ? "Right" : "Left", "outdent" == e ? (i = Math.max(0, parseInt(o.style[a] || 0, 10) - t), k.setStyle(o, a, i ? i + n : "")) : (i = parseInt(o.style[a] || 0, 10) + t + n, k.setStyle(o, a, i)) } })) }, mceRepaint: function () { if (f) try { E(m), S.getSel() && S.getSel().selectAllChildren(r.getBody()), S.collapse(m), N() } catch (e) { } }, InsertHorizontalRule: function () { r.execCommand("mceInsertContent", !1, "<hr />") }, mceToggleVisualAid: function () { r.hasVisual = !r.hasVisual, r.addVisual() }, mceReplaceContent: function (e, t, n) { r.execCommand("mceInsertContent", !1, n.replace(/\{\$selection\}/g, S.getContent({ format: "text" }))) }, mceInsertLink: function (e, t, n) { var r; "string" == typeof n && (n = { href: n }), r = k.getParent(S.getNode(), "a"), n.href = n.href.replace(" ", "%20"), r && n.href || A.remove("link"), n.href && A.apply("link", n, r) }, selectAll: function () { var e = k.getRoot(), t; S.getRng().setStart ? (t = k.createRng(), t.setStart(e, 0), t.setEnd(e, e.childNodes.length), S.setRng(t)) : (t = S.getRng(), t.item || (t.moveToElementText(e), t.select())) }, "delete": function () { x("Delete"); var e = r.getBody(); k.isEmpty(e) && (r.setContent(""), e.firstChild && k.isBlock(e.firstChild) ? r.selection.setCursorLocation(e.firstChild, 0) : r.selection.setCursorLocation(e, 0)) }, mceNewDocument: function () { r.setContent("") }, InsertLineBreak: function (e, t, n) { function i() { for (var e = new a(p, v), t, n = r.schema.getNonEmptyElements(); t = e.next(); ) if (n[t.nodeName.toLowerCase()] || t.length > 0) return !0 } var s = n, l, c, u, d = S.getRng(!0); new o(k).normalize(d); var f = d.startOffset, p = d.startContainer; if (1 == p.nodeType && p.hasChildNodes()) { var g = f > p.childNodes.length - 1; p = p.childNodes[Math.min(f, p.childNodes.length - 1)] || p, f = g && 3 == p.nodeType ? p.nodeValue.length : 0 } var v = k.getParent(p, k.isBlock), y = v ? v.nodeName.toUpperCase() : "", b = v ? k.getParent(v.parentNode, k.isBlock) : null, C = b ? b.nodeName.toUpperCase() : "", x = s && s.ctrlKey; "LI" != C || x || (v = b, y = C), p && 3 == p.nodeType && f >= p.nodeValue.length && (h || i() || (l = k.create("br"), d.insertNode(l), d.setStartAfter(l), d.setEndAfter(l), c = !0)), l = k.create("br"), d.insertNode(l); var w = k.doc.documentMode; return h && "PRE" == y && (!w || 8 > w) && l.parentNode.insertBefore(k.doc.createTextNode("\r"), l), u = k.create("span", {}, "&nbsp;"), l.parentNode.insertBefore(u, l), S.scrollIntoView(u), k.remove(u), c ? (d.setStartBefore(l), d.setEndBefore(l)) : (d.setStartAfter(l), d.setEndAfter(l)), S.setRng(d), r.undoManager.add(), m } }), C({ "JustifyLeft,JustifyCenter,JustifyRight,JustifyFull": function (e) { var t = "align" + e.substring(7), n = S.isCollapsed() ? [k.getParent(S.getNode(), k.isBlock)] : S.getSelectedBlocks(), r = c(n, function (e) { return !!A.matchNode(e, t) }); return -1 !== u(r, m) }, "Bold,Italic,Underline,Strikethrough,Superscript,Subscript": function (e) { return w(e) }, mceBlockQuote: function () { return w("blockquote") }, Outdent: function () { var e; if (R.inline_styles) { if ((e = k.getParent(S.getStart(), k.isBlock)) && parseInt(e.style.paddingLeft, 10) > 0) return m; if ((e = k.getParent(S.getEnd(), k.isBlock)) && parseInt(e.style.paddingLeft, 10) > 0) return m } return y("InsertUnorderedList") || y("InsertOrderedList") || !R.inline_styles && !!k.getParent(S.getNode(), "BLOCKQUOTE") }, "InsertUnorderedList,InsertOrderedList": function (e) { var t = k.getParent(S.getNode(), "ul,ol"); return t && ("insertunorderedlist" === e && "UL" === t.tagName || "insertorderedlist" === e && "OL" === t.tagName) } }, "state"), C({ "FontSize,FontName": function (e) { var t = 0, n; return (n = k.getParent(S.getNode(), "span")) && (t = "fontsize" == e ? n.style.fontSize : n.style.fontFamily.replace(/, /g, ",").replace(/[\'\"]/g, "").toLowerCase()), t } }, "value"), C({ Undo: function () { r.undoManager.undo() }, Redo: function () { r.undoManager.redo() } }) } }), r(V, [u], function (e) { function t(e, o) { var a = this, s, l; if (e = r(e), o = a.settings = o || {}, s = o.base_uri, /^([\w\-]+):([^\/]{2})/i.test(e) || /^\s*#/.test(e)) return void (a.source = e); var c = 0 === e.indexOf("//"); 0 !== e.indexOf("/") || c || (e = (s ? s.protocol || "http" : "http") + "://mce_host" + e), /^[\w\-]*:?\/\//.test(e) || (l = o.base_uri ? o.base_uri.path : new t(location.href).directory, "" === o.base_uri.protocol ? e = "//mce_host" + a.toAbsPath(l, e) : (e = /([^#?]*)([#?]?.*)/.exec(e), e = (s && s.protocol || "http") + "://mce_host" + a.toAbsPath(l, e[1]) + e[2])), e = e.replace(/@@/g, "(mce_at)"), e = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e), n(i, function (t, n) { var r = e[n]; r && (r = r.replace(/\(mce_at\)/g, "@@")), a[t] = r }), s && (a.protocol || (a.protocol = s.protocol), a.userInfo || (a.userInfo = s.userInfo), a.port || "mce_host" !== a.host || (a.port = s.port), a.host && "mce_host" !== a.host || (a.host = s.host), a.source = ""), c && (a.protocol = "") } var n = e.each, r = e.trim, i = "source protocol authority userInfo user password host port relative path directory file query anchor".split(" "), o = { ftp: 21, http: 80, https: 443, mailto: 25 }; return t.prototype = { setPath: function (e) { var t = this; e = /^(.*?)\/?(\w+)?$/.exec(e), t.path = e[0], t.directory = e[1], t.file = e[2], t.source = "", t.getURI() }, toRelative: function (e) { var n = this, r; if ("./" === e) return e; if (e = new t(e, { base_uri: n }), "mce_host" != e.host && n.host != e.host && e.host || n.port != e.port || n.protocol != e.protocol && "" !== e.protocol) return e.getURI(); var i = n.getURI(), o = e.getURI(); return i == o || "/" == i.charAt(i.length - 1) && i.substr(0, i.length - 1) == o ? i : (r = n.toRelPath(n.path, e.path), e.query && (r += "?" + e.query), e.anchor && (r += "#" + e.anchor), r) }, toAbsolute: function (e, n) { return e = new t(e, { base_uri: this }), e.getURI(n && this.isSameOrigin(e)) }, isSameOrigin: function (e) { if (this.host == e.host && this.protocol == e.protocol) { if (this.port == e.port) return !0; var t = o[this.protocol]; if (t && (this.port || t) == (e.port || t)) return !0 } return !1 }, toRelPath: function (e, t) { var n, r = 0, i = "", o, a; if (e = e.substring(0, e.lastIndexOf("/")), e = e.split("/"), n = t.split("/"), e.length >= n.length) for (o = 0, a = e.length; a > o; o++) if (o >= n.length || e[o] != n[o]) { r = o + 1; break } if (e.length < n.length) for (o = 0, a = n.length; a > o; o++) if (o >= e.length || e[o] != n[o]) { r = o + 1; break } if (1 === r) return t; for (o = 0, a = e.length - (r - 1); a > o; o++) i += "../"; for (o = r - 1, a = n.length; a > o; o++) i += o != r - 1 ? "/" + n[o] : n[o]; return i }, toAbsPath: function (e, t) { var r, i = 0, o = [], a, s; for (a = /\/$/.test(t) ? "/" : "", e = e.split("/"), t = t.split("/"), n(e, function (e) { e && o.push(e) }), e = o, r = t.length - 1, o = []; r >= 0; r--) 0 !== t[r].length && "." !== t[r] && (".." !== t[r] ? i > 0 ? i-- : o.push(t[r]) : i++); return r = e.length - i, s = 0 >= r ? o.reverse().join("/") : e.slice(0, r).join("/") + "/" + o.reverse().join("/"), 0 !== s.indexOf("/") && (s = "/" + s), a && s.lastIndexOf("/") !== s.length - 1 && (s += a), s }, getURI: function (e) { var t, n = this; return (!n.source || e) && (t = "", e || (t += n.protocol ? n.protocol + "://" : "//", n.userInfo && (t += n.userInfo + "@"), n.host && (t += n.host), n.port && (t += ":" + n.port)), n.path && (t += n.path), n.query && (t += "?" + n.query), n.anchor && (t += "#" + n.anchor), n.source = t), n.source } }, t }), r(U, [u], function (e) { function t() { } var n = e.each, r = e.extend, i, o; return t.extend = i = function (e) { function t() { var e, t, n, r = this; if (!o && (r.init && r.init.apply(r, arguments), t = r.Mixins)) for (e = t.length; e--; ) n = t[e], n.init && n.init.apply(r, arguments) } function a() { return this } function s(e, t) { return function () { var n = this, r = n._super, i; return n._super = c[e], i = t.apply(n, arguments), n._super = r, i } } var l = this, c = l.prototype, u, d, f; o = !0, u = new l, o = !1, e.Mixins && (n(e.Mixins, function (t) { t = t; for (var n in t) "init" !== n && (e[n] = t[n]) }), c.Mixins && (e.Mixins = c.Mixins.concat(e.Mixins))), e.Methods && n(e.Methods.split(","), function (t) { e[t] = a }), e.Properties && n(e.Properties.split(","), function (t) { var n = "_" + t; e[t] = function (e) { var t = this, r; return e !== r ? (t[n] = e, t) : t[n] } }), e.Statics && n(e.Statics, function (e, n) { t[n] = e }), e.Defaults && c.Defaults && (e.Defaults = r({}, c.Defaults, e.Defaults)); for (d in e) f = e[d], u[d] = "function" == typeof f && c[d] ? s(d, f) : f; return t.prototype = u, t.constructor = t, t.extend = i, t }, t }), r($, [u], function (e) { function t(e) { function t() { return !1 } function n() { return !0 } function r(r, i) { var a, s, l, d; if (r = r.toLowerCase(), i = i || {}, i.type = r, i.target || (i.target = c), i.preventDefault || (i.preventDefault = function () { i.isDefaultPrevented = n }, i.stopPropagation = function () { i.isPropagationStopped = n }, i.stopImmediatePropagation = function () { i.isImmediatePropagationStopped = n }, i.isDefaultPrevented = t, i.isPropagationStopped = t, i.isImmediatePropagationStopped = t), e.beforeFire && e.beforeFire(i), a = u[r]) for (s = 0, l = a.length; l > s; s++) { if (a[s] = d = a[s], d.once && o(r, d), i.isImmediatePropagationStopped()) return i.stopPropagation(), i; if (d.call(c, i) === !1) return i.preventDefault(), i } return i } function i(e, n, r) { var i, o, a; if (n === !1 && (n = t), n) for (o = e.toLowerCase().split(" "), a = o.length; a--; ) e = o[a], i = u[e], i || (i = u[e] = [], d(e, !0)), r ? i.unshift(n) : i.push(n); return l } function o(e, t) { var n, r, i, o, a; if (e) for (o = e.toLowerCase().split(" "), n = o.length; n--; ) { if (e = o[n], r = u[e], !e) { for (i in u) d(i, !1), delete u[i]; return l } if (r) { if (t) for (a = r.length; a--; ) r[a] === t && (r = r.slice(0, a).concat(r.slice(a + 1)), u[e] = r); else r.length = 0; r.length || (d(e, !1), delete u[e]) } } else { for (e in u) d(e, !1); u = {} } return l } function a(e, t, n) { return t.once = !0, i(e, t, n) } function s(e) { return e = e.toLowerCase(), !(!u[e] || 0 === u[e].length) } var l = this, c, u = {}, d; e = e || {}, c = e.scope || l, d = e.toggleEvent || t, l.fire = r, l.on = i, l.off = o, l.once = a, l.has = s } var n = e.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchend", " "); return t.isNative = function (e) { return !!n[e.toLowerCase()] }, t }), r(q, [U], function (e) { function t(e) { for (var t = [], n = e.length, r; n--; ) r = e[n], r.__checked || (t.push(r), r.__checked = 1); for (n = t.length; n--; ) delete t[n].__checked; return t } var n = /^([\w\\*]+)?(?:#([\w\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i, r = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g, i = /^\s*|\s*$/g, o, a = e.extend({ init: function (e) { function t(e) { return e ? (e = e.toLowerCase(), function (t) { return "*" === e || t.type === e }) : void 0 } function o(e) { return e ? function (t) { return t._name === e } : void 0 } function a(e) { return e ? (e = e.split("."), function (t) { for (var n = e.length; n--; ) if (!t.hasClass(e[n])) return !1; return !0 }) : void 0 } function s(e, t, n) { return e ? function (r) { var i = r[e] ? r[e]() : ""; return t ? "=" === t ? i === n : "*=" === t ? i.indexOf(n) >= 0 : "~=" === t ? (" " + i + " ").indexOf(" " + n + " ") >= 0 : "!=" === t ? i != n : "^=" === t ? 0 === i.indexOf(n) : "$=" === t ? i.substr(i.length - n.length) === n : !1 : !!n } : void 0 } function l(e) { var t; return e ? (e = /(?:not\((.+)\))|(.+)/i.exec(e), e[1] ? (t = u(e[1], []), function (e) { return !d(e, t) }) : (e = e[2], function (t, n, r) { return "first" === e ? 0 === n : "last" === e ? n === r - 1 : "even" === e ? n % 2 === 0 : "odd" === e ? n % 2 === 1 : t[e] ? t[e]() : !1 })) : void 0 } function c(e, r, c) { function u(e) { e && r.push(e) } var d; return d = n.exec(e.replace(i, "")), u(t(d[1])), u(o(d[2])), u(a(d[3])), u(s(d[4], d[5], d[6])), u(l(d[7])), r.psuedo = !!d[7], r.direct = c, r } function u(e, t) { var n = [], i, o, a; do if (r.exec(""), o = r.exec(e), o && (e = o[3], n.push(o[1]), o[2])) { i = o[3]; break } while (o); for (i && u(i, t), e = [], a = 0; a < n.length; a++) ">" != n[a] && e.push(c(n[a], [], ">" === n[a - 1])); return t.push(e), t } var d = this.match; this._selectors = u(e, []) }, match: function (e, t) { var n, r, i, o, a, s, l, c, u, d, f, p, h; for (t = t || this._selectors, n = 0, r = t.length; r > n; n++) { for (a = t[n], o = a.length, h = e, p = 0, i = o - 1; i >= 0; i--) for (c = a[i]; h; ) { if (c.psuedo) for (f = h.parent().items(), u = d = f.length; u-- && f[u] !== h; ); for (s = 0, l = c.length; l > s; s++) if (!c[s](h, u, d)) { s = l + 1; break } if (s === l) { p++; break } if (i === o - 1) break; h = h.parent() } if (p === o) return !0 } return !1 }, find: function (e) { function n(e, t, i) { var o, a, s, l, c, u = t[i]; for (o = 0, a = e.length; a > o; o++) { for (c = e[o], s = 0, l = u.length; l > s; s++) if (!u[s](c, o, a)) { s = l + 1; break } if (s === l) i == t.length - 1 ? r.push(c) : c.items && n(c.items(), t, i + 1); else if (u.direct) return; c.items && n(c.items(), t, i) } } var r = [], i, s, l = this._selectors; if (e.items) { for (i = 0, s = l.length; s > i; i++) n(e.items(), l[i], 0); s > 1 && (r = t(r)) } return o || (o = a.Collection), new o(r) } }); return a }), r(j, [u, q, U], function (e, t, n) { var r, i, o = Array.prototype.push, a = Array.prototype.slice; return i = { length: 0, init: function (e) { e && this.add(e) }, add: function (t) { var n = this; return e.isArray(t) ? o.apply(n, t) : t instanceof r ? n.add(t.toArray()) : o.call(n, t), n }, set: function (e) { var t = this, n = t.length, r; for (t.length = 0, t.add(e), r = t.length; n > r; r++) delete t[r]; return t }, filter: function (e) { var n = this, i, o, a = [], s, l; for ("string" == typeof e ? (e = new t(e), l = function (t) { return e.match(t) }) : l = e, i = 0, o = n.length; o > i; i++) s = n[i], l(s) && a.push(s); return new r(a) }, slice: function () { return new r(a.apply(this, arguments)) }, eq: function (e) { return -1 === e ? this.slice(e) : this.slice(e, +e + 1) }, each: function (t) { return e.each(this, t), this }, toArray: function () { return e.toArray(this) }, indexOf: function (e) { for (var t = this, n = t.length; n-- && t[n] !== e; ); return n }, reverse: function () { return new r(e.toArray(this).reverse()) }, hasClass: function (e) { return this[0] ? this[0].hasClass(e) : !1 }, prop: function (e, t) { var n = this, r, i; return t !== r ? (n.each(function (n) { n[e] && n[e](t) }), n) : (i = n[0], i && i[e] ? i[e]() : void 0) }, exec: function (t) { var n = this, r = e.toArray(arguments).slice(1); return n.each(function (e) { e[t] && e[t].apply(e, r) }), n }, remove: function () { for (var e = this.length; e--; ) this[e].remove(); return this } }, e.each("fire on off show hide addClass removeClass append prepend before after reflow".split(" "), function (t) { i[t] = function () { var n = e.toArray(arguments); return this.each(function (e) { t in e && e[t].apply(e, n) }), this } }), e.each("text name disabled active selected checked visible parent value data".split(" "), function (e) { i[e] = function (t) { return this.prop(e, t) } }), r = n.extend(i), t.Collection = r, r }), r(Y, [u, y], function (e, t) { var n = 0; return { id: function () { return "mceu_" + n++ }, createFragment: function (e) { return t.DOM.createFragment(e) }, getWindowSize: function () { return t.DOM.getViewPort() }, getSize: function (e) { var t, n; if (e.getBoundingClientRect) { var r = e.getBoundingClientRect(); t = Math.max(r.width || r.right - r.left, e.offsetWidth), n = Math.max(r.height || r.bottom - r.bottom, e.offsetHeight) } else t = e.offsetWidth, n = e.offsetHeight; return { width: t, height: n} }, getPos: function (e, n) { return t.DOM.getPos(e, n) }, getViewPort: function (e) { return t.DOM.getViewPort(e) }, get: function (e) { return document.getElementById(e) }, addClass: function (e, n) { return t.DOM.addClass(e, n) }, removeClass: function (e, n) { return t.DOM.removeClass(e, n) }, hasClass: function (e, n) { return t.DOM.hasClass(e, n) }, toggleClass: function (e, n, r) { return t.DOM.toggleClass(e, n, r) }, css: function (e, n, r) { return t.DOM.setStyle(e, n, r) }, getRuntimeStyle: function (e, n) { return t.DOM.getStyle(e, n, !0) }, on: function (e, n, r, i) { return t.DOM.bind(e, n, r, i) }, off: function (e, n, r) { return t.DOM.unbind(e, n, r) }, fire: function (e, n, r) { return t.DOM.fire(e, n, r) }, innerHtml: function (e, n) { t.DOM.setHTML(e, n) } } }), r(K, [U, u, $, j, Y], function (e, t, n, r, i) { function o(e) { return e._eventDispatcher || (e._eventDispatcher = new n({ scope: e, toggleEvent: function (t, r) { r && n.isNative(t) && (e._nativeEvents || (e._nativeEvents = {}), e._nativeEvents[t] = !0, e._rendered && e.bindPendingEvents()) } })), e._eventDispatcher } var a = "onmousewheel" in document, s = !1, l = "mce-", c = e.extend({ Statics: { classPrefix: l }, isRtl: function () { return c.rtl }, classPrefix: l, init: function (e) { var n = this, r, o; if (n.settings = e = t.extend({}, n.Defaults, e), n._id = e.id || i.id(), n._text = n._name = "", n._width = n._height = 0, n._aria = { role: e.role }, this._elmCache = {}, r = e.classes) for (r = r.split(" "), r.map = {}, o = r.length; o--; ) r.map[r[o]] = !0; n._classes = r || [], n.visible(!0), t.each("title text width height name classes visible disabled active value".split(" "), function (t) { var r = e[t], i; r !== i ? n[t](r) : n["_" + t] === i && (n["_" + t] = !1) }), n.on("click", function () { return n.disabled() ? !1 : void 0 }), e.classes && t.each(e.classes.split(" "), function (e) { n.addClass(e) }), n.settings = e, n._borderBox = n.parseBox(e.border), n._paddingBox = n.parseBox(e.padding), n._marginBox = n.parseBox(e.margin), e.hidden && n.hide() }, Properties: "parent,title,text,width,height,disabled,active,name,value", Methods: "renderHtml", getContainerElm: function () { return document.body }, getParentCtrl: function (e) { for (var t, n = this.getRoot().controlIdLookup; e && n && !(t = n[e.id]); ) e = e.parentNode; return t }, parseBox: function (e) { var t, n = 10; if (e) return "number" == typeof e ? (e = e || 0, { top: e, left: e, bottom: e, right: e }) : (e = e.split(" "), t = e.length, 1 === t ? e[1] = e[2] = e[3] = e[0] : 2 === t ? (e[2] = e[0], e[3] = e[1]) : 3 === t && (e[3] = e[1]), { top: parseInt(e[0], n) || 0, right: parseInt(e[1], n) || 0, bottom: parseInt(e[2], n) || 0, left: parseInt(e[3], n) || 0 }) }, borderBox: function () { return this._borderBox }, paddingBox: function () { return this._paddingBox }, marginBox: function () { return this._marginBox }, measureBox: function (e, t) { function n(t) { var n = document.defaultView; return n ? (t = t.replace(/[A-Z]/g, function (e) { return "-" + e }), n.getComputedStyle(e, null).getPropertyValue(t)) : e.currentStyle[t] } function r(e) { var t = parseFloat(n(e), 10); return isNaN(t) ? 0 : t } return { top: r(t + "TopWidth"), right: r(t + "RightWidth"), bottom: r(t + "BottomWidth"), left: r(t + "LeftWidth")} }, initLayoutRect: function () { var e = this, t = e.settings, n, r, o = e.getEl(), a, s, l, c, u, d, f, p; n = e._borderBox = e._borderBox || e.measureBox(o, "border"), e._paddingBox = e._paddingBox || e.measureBox(o, "padding"), e._marginBox = e._marginBox || e.measureBox(o, "margin"), p = i.getSize(o), d = t.minWidth, f = t.minHeight, l = d || p.width, c = f || p.height, a = t.width, s = t.height, u = t.autoResize, u = "undefined" != typeof u ? u : !a && !s, a = a || l, s = s || c; var h = n.left + n.right, m = n.top + n.bottom, g = t.maxWidth || 65535, v = t.maxHeight || 65535; return e._layoutRect = r = { x: t.x || 0, y: t.y || 0, w: a, h: s, deltaW: h, deltaH: m, contentW: a - h, contentH: s - m, innerW: a - h, innerH: s - m, startMinWidth: d || 0, startMinHeight: f || 0, minW: Math.min(l, g), minH: Math.min(c, v), maxW: g, maxH: v, autoResize: u, scrollW: 0 }, e._lastLayoutRect = {}, r }, layoutRect: function (e) { var t = this, n = t._layoutRect, r, i, o, a, s, l; return n || (n = t.initLayoutRect()), e ? (o = n.deltaW, a = n.deltaH, e.x !== s && (n.x = e.x), e.y !== s && (n.y = e.y), e.minW !== s && (n.minW = e.minW), e.minH !== s && (n.minH = e.minH), i = e.w, i !== s && (i = i < n.minW ? n.minW : i, i = i > n.maxW ? n.maxW : i, n.w = i, n.innerW = i - o), i = e.h, i !== s && (i = i < n.minH ? n.minH : i, i = i > n.maxH ? n.maxH : i, n.h = i, n.innerH = i - a), i = e.innerW, i !== s && (i = i < n.minW - o ? n.minW - o : i, i = i > n.maxW - o ? n.maxW - o : i, n.innerW = i, n.w = i + o), i = e.innerH, i !== s && (i = i < n.minH - a ? n.minH - a : i, i = i > n.maxH - a ? n.maxH - a : i, n.innerH = i, n.h = i + a), e.contentW !== s && (n.contentW = e.contentW), e.contentH !== s && (n.contentH = e.contentH), r = t._lastLayoutRect, (r.x !== n.x || r.y !== n.y || r.w !== n.w || r.h !== n.h) && (l = c.repaintControls, l && l.map && !l.map[t._id] && (l.push(t), l.map[t._id] = !0), r.x = n.x, r.y = n.y, r.w = n.w, r.h = n.h), t) : n }, repaint: function () { var e = this, t, n, r, i, o = 0, a = 0, s, l; l = document.createRange ? function (e) { return e } : Math.round, t = e.getEl().style, r = e._layoutRect, s = e._lastRepaintRect || {}, i = e._borderBox, o = i.left + i.right, a = i.top + i.bottom, r.x !== s.x && (t.left = l(r.x) + "px", s.x = r.x), r.y !== s.y && (t.top = l(r.y) + "px", s.y = r.y), r.w !== s.w && (t.width = l(r.w - o) + "px", s.w = r.w), r.h !== s.h && (t.height = l(r.h - a) + "px", s.h = r.h), e._hasBody && r.innerW !== s.innerW && (n = e.getEl("body").style, n.width = l(r.innerW) + "px", s.innerW = r.innerW), e._hasBody && r.innerH !== s.innerH && (n = n || e.getEl("body").style, n.height = l(r.innerH) + "px", s.innerH = r.innerH), e._lastRepaintRect = s, e.fire("repaint", {}, !1) }, on: function (e, t) { function n(e) { var t, n; return "string" != typeof e ? e : function (i) { return t || r.parentsAndSelf().each(function (r) { var i = r.settings.callbacks; return i && (t = i[e]) ? (n = r, !1) : void 0 }), t.call(n, i) } } var r = this; return o(r).on(e, n(t)), r }, off: function (e, t) { return o(this).off(e, t), this }, fire: function (e, t, n) { var r = this; if (t = t || {}, t.control || (t.control = r), t = o(r).fire(e, t), n !== !1 && r.parent) for (var i = r.parent(); i && !t.isPropagationStopped(); ) i.fire(e, t, !1), i = i.parent(); return t }, hasEventListeners: function (e) { return o(this).has(e) }, parents: function (e) { var t = this, n, i = new r; for (n = t.parent(); n; n = n.parent()) i.add(n); return e && (i = i.filter(e)), i }, parentsAndSelf: function (e) { return new r(this).add(this.parents(e)) }, next: function () { var e = this.parent().items(); return e[e.indexOf(this) + 1] }, prev: function () { var e = this.parent().items(); return e[e.indexOf(this) - 1] }, findCommonAncestor: function (e, t) { for (var n; e; ) { for (n = t; n && e != n; ) n = n.parent(); if (e == n) break; e = e.parent() } return e }, hasClass: function (e, t) { var n = this._classes[t || "control"]; return e = this.classPrefix + e, n && !!n.map[e] }, addClass: function (e, t) { var n = this, r, i; return e = this.classPrefix + e, r = n._classes[t || "control"], r || (r = [], r.map = {}, n._classes[t || "control"] = r), r.map[e] || (r.map[e] = e, r.push(e), n._rendered && (i = n.getEl(t), i && (i.className = r.join(" ")))), n }, removeClass: function (e, t) { var n = this, r, i, o; if (e = this.classPrefix + e, r = n._classes[t || "control"], r && r.map[e]) for (delete r.map[e], i = r.length; i--; ) r[i] === e && r.splice(i, 1); return n._rendered && (o = n.getEl(t), o && (o.className = r.join(" "))), n }, toggleClass: function (e, t, n) { var r = this; return t ? r.addClass(e, n) : r.removeClass(e, n), r }, classes: function (e) { var t = this._classes[e || "control"]; return t ? t.join(" ") : "" }, innerHtml: function (e) { return i.innerHtml(this.getEl(), e), this }, getEl: function (e) { var t = e ? this._id + "-" + e : this._id; return this._elmCache[t] || (this._elmCache[t] = i.get(t)), this._elmCache[t] }, visible: function (e) { var t = this, n; return "undefined" != typeof e ? (t._visible !== e && (t._rendered && (t.getEl().style.display = e ? "" : "none"), t._visible = e, n = t.parent(), n && (n._lastRect = null), t.fire(e ? "show" : "hide")), t) : t._visible }, show: function () { return this.visible(!0) }, hide: function () { return this.visible(!1) }, focus: function () { try { this.getEl().focus() } catch (e) { } return this }, blur: function () { return this.getEl().blur(), this }, aria: function (e, t) { var n = this, r = n.getEl(n.ariaTarget); return "undefined" == typeof t ? n._aria[e] : (n._aria[e] = t, n._rendered && r.setAttribute("role" == e ? e : "aria-" + e, t), n) }, encode: function (e, t) { return t !== !1 && (e = this.translate(e)), (e || "").replace(/[&<>"]/g, function (e) { return "&#" + e.charCodeAt(0) + ";" }) }, translate: function (e) { return c.translate ? c.translate(e) : e }, before: function (e) { var t = this, n = t.parent(); return n && n.insert(e, n.items().indexOf(t), !0), t }, after: function (e) { var t = this, n = t.parent(); return n && n.insert(e, n.items().indexOf(t)), t }, remove: function () { var e = this, t = e.getEl(), n = e.parent(), r, o; if (e.items) { var a = e.items().toArray(); for (o = a.length; o--; ) a[o].remove() } n && n.items && (r = [], n.items().each(function (t) { t !== e && r.push(t) }), n.items().set(r), n._lastRect = null), e._eventsRoot && e._eventsRoot == e && i.off(t); var s = e.getRoot().controlIdLookup; return s && delete s[e._id], t && t.parentNode && t.parentNode.removeChild(t), e._rendered = !1, e }, renderBefore: function (e) { var t = this; return e.parentNode.insertBefore(i.createFragment(t.renderHtml()), e), t.postRender(), t }, renderTo: function (e) { var t = this; return e = e || t.getContainerElm(), e.appendChild(i.createFragment(t.renderHtml())), t.postRender(), t }, postRender: function () { var e = this, t = e.settings, n, r, o, a, s; for (a in t) 0 === a.indexOf("on") && e.on(a.substr(2), t[a]); if (e._eventsRoot) { for (o = e.parent(); !s && o; o = o.parent()) s = o._eventsRoot; if (s) for (a in s._nativeEvents) e._nativeEvents[a] = !0 } e.bindPendingEvents(), t.style && (n = e.getEl(), n && (n.setAttribute("style", t.style), n.style.cssText = t.style)), e._visible || i.css(e.getEl(), "display", "none"), e.settings.border && (r = e.borderBox(), i.css(e.getEl(), { "border-top-width": r.top, "border-right-width": r.right, "border-bottom-width": r.bottom, "border-left-width": r.left })); var l = e.getRoot(); l.controlIdLookup || (l.controlIdLookup = {}), l.controlIdLookup[e._id] = e; for (var c in e._aria) e.aria(c, e._aria[c]); e.fire("postrender", {}, !1) }, scrollIntoView: function (e) { function t(e, t) { var n, r, i = e; for (n = r = 0; i && i != t && i.nodeType; ) n += i.offsetLeft || 0, r += i.offsetTop || 0, i = i.offsetParent; return { x: n, y: r} } var n = this.getEl(), r = n.parentNode, i, o, a, s, l, c, u = t(n, r); return i = u.x, o = u.y, a = n.offsetWidth, s = n.offsetHeight, l = r.clientWidth, c = r.clientHeight, "end" == e ? (i -= l - a, o -= c - s) : "center" == e && (i -= l / 2 - a / 2, o -= c / 2 - s / 2), r.scrollLeft = i, r.scrollTop = o, this }, bindPendingEvents: function () { function e(e) { var t = o.getParentCtrl(e.target); t && t.fire(e.type, e) } function t() { var e = d._lastHoverCtrl; e && (e.fire("mouseleave", { target: e.getEl() }), e.parents().each(function (e) { e.fire("mouseleave", { target: e.getEl() }) }), d._lastHoverCtrl = null) } function n(e) { var t = o.getParentCtrl(e.target), n = d._lastHoverCtrl, r = 0, i, a, s; if (t !== n) { if (d._lastHoverCtrl = t, a = t.parents().toArray().reverse(), a.push(t), n) { for (s = n.parents().toArray().reverse(), s.push(n), r = 0; r < s.length && a[r] === s[r]; r++); for (i = s.length - 1; i >= r; i--) n = s[i], n.fire("mouseleave", { target: n.getEl() }) } for (i = r; i < a.length; i++) t = a[i], t.fire("mouseenter", { target: t.getEl() }) } } function r(e) { e.preventDefault(), "mousewheel" == e.type ? (e.deltaY = -1 / 40 * e.wheelDelta, e.wheelDeltaX && (e.deltaX = -1 / 40 * e.wheelDeltaX)) : (e.deltaX = 0, e.deltaY = e.detail), e = o.fire("wheel", e) } var o = this, l, c, u, d, f, p; if (o._rendered = !0, f = o._nativeEvents) { for (u = o.parents().toArray(), u.unshift(o), l = 0, c = u.length; !d && c > l; l++) d = u[l]._eventsRoot; for (d || (d = u[u.length - 1] || o), o._eventsRoot = d, c = l, l = 0; c > l; l++) u[l]._eventsRoot = d; var h = d._delegates; h || (h = d._delegates = {}); for (p in f) { if (!f) return !1; "wheel" !== p || s ? ("mouseenter" === p || "mouseleave" === p ? d._hasMouseEnter || (i.on(d.getEl(), "mouseleave", t), i.on(d.getEl(), "mouseover", n), d._hasMouseEnter = 1) : h[p] || (i.on(d.getEl(), p, e), h[p] = !0), f[p] = !1) : a ? i.on(o.getEl(), "mousewheel", r) : i.on(o.getEl(), "DOMMouseScroll", r) } } }, getRoot: function () { for (var e = this, t, n = []; e; ) { if (e.rootControl) { t = e.rootControl; break } n.push(e), t = e, e = e.parent() } t || (t = this); for (var r = n.length; r--; ) n[r].rootControl = t; return t }, reflow: function () { return this.repaint(), this } }); return c }), r(G, [], function () { var e = {}, t; return { add: function (t, n) { e[t.toLowerCase()] = n }, has: function (t) { return !!e[t.toLowerCase()] }, create: function (n, r) { var i, o, a; if (!t) { a = tinymce.ui; for (o in a) e[o.toLowerCase()] = a[o]; t = !0 } if ("string" == typeof n ? (r = r || {}, r.type = n) : (r = n, n = r.type), n = n.toLowerCase(), i = e[n], !i) throw new Error("Could not find control by type: " + n); return i = new i(r), i.type = n, i } } }), r(X, [], function () { return function (e) { function t(e) { return e = e || b, e && e.getAttribute("role") } function n(e) { for (var n, r = e || b; r = r.parentNode; ) if (n = t(r)) return n } function r(e) { var t = b; return t ? t.getAttribute("aria-" + e) : void 0 } function i(e) { var t = e.tagName.toUpperCase(); return "INPUT" == t || "TEXTAREA" == t } function o(e) { return i(e) && !e.hidden ? !0 : /^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell)$/.test(t(e)) ? !0 : !1 } function a(e) { function t(e) { if (1 == e.nodeType && "none" != e.style.display) { o(e) && n.push(e); for (var r = 0; r < e.childNodes.length; r++) t(e.childNodes[r]) } } var n = []; return t(e || y.getEl()), n } function s(e) { var t, n; e = e || C, n = e.parents().toArray(), n.unshift(e); for (var r = 0; r < n.length && (t = n[r], !t.settings.ariaRoot); r++); return t } function l(e) { var t = s(e), n = a(t.getEl()); t.settings.ariaRemember && "lastAriaIndex" in t ? c(t.lastAriaIndex, n) : c(0, n) } function c(e, t) { return 0 > e ? e = t.length - 1 : e >= t.length && (e = 0), t[e] && t[e].focus(), e } function u(e, t) { var n = -1, r = s(); t = t || a(r.getEl()); for (var i = 0; i < t.length; i++) t[i] === b && (n = i); n += e, r.lastAriaIndex = c(n, t) } function d() { var e = n(); "tablist" == e ? u(-1, a(b.parentNode)) : C.parent().submenu ? g() : u(-1) } function f() { var e = t(), i = n(); "tablist" == i ? u(1, a(b.parentNode)) : "menuitem" == e && "menu" == i && r("haspopup") ? v() : u(1) } function p() { u(-1) } function h() { var e = t(), i = n(); "menuitem" == e && "menubar" == i ? v() : "button" == e && r("haspopup") ? v({ key: "down" }) : u(1) } function m(e) { var t = n(); if ("tablist" == t) { var r = a(C.getEl("body"))[0]; r && r.focus() } else u(e.shiftKey ? -1 : 1) } function g() { C.fire("cancel") } function v(e) { e = e || {}, C.fire("click", { target: b, aria: e }) } var y = e.root, b, C; try { b = document.activeElement } catch (x) { b = document.body } return C = y.getParentCtrl(b), y.on("keydown", function (e) { function t(e, t) { i(b) || t(e) !== !1 && e.preventDefault() } if (!e.isDefaultPrevented()) switch (e.keyCode) { case 37: t(e, d); break; case 39: t(e, f); break; case 38: t(e, p); break; case 40: t(e, h); break; case 27: g(); break; case 14: case 13: case 32: t(e, v); break; case 9: m(e) !== !1 && e.preventDefault() } }), y.on("focusin", function (e) { b = e.target, C = e.control }), { focusFirst: l} } }), r(J, [K, j, q, G, X, u, Y], function (e, t, n, r, i, o, a) { var s = {}; return e.extend({ layout: "", innerClass: "container-inner", init: function (e) { var n = this; n._super(e), e = n.settings, n._fixed = e.fixed, n._items = new t, n.isRtl() && n.addClass("rtl"), n.addClass("container"), n.addClass("container-body", "body"), e.containerCls && n.addClass(e.containerCls), n._layout = r.create((e.layout || n.layout) + "layout"), n.settings.items && n.add(n.settings.items), n._hasBody = !0 }, items: function () { return this._items }, find: function (e) { return e = s[e] = s[e] || new n(e), e.find(this) }, add: function (e) { var t = this; return t.items().add(t.create(e)).parent(t), t }, focus: function (e) { var t = this, n, r, i; return e && (r = t.keyboardNav || t.parents().eq(-1)[0].keyboardNav) ? void r.focusFirst(t) : (i = t.find("*"), t.statusbar && i.add(t.statusbar.items()), i.each(function (e) { return e.settings.autofocus ? (n = null, !1) : void (e.canFocus && (n = n || e)) }), n && n.focus(), t) }, replace: function (e, t) { for (var n, r = this.items(), i = r.length; i--; ) if (r[i] === e) { r[i] = t; break } i >= 0 && (n = t.getEl(), n && n.parentNode.removeChild(n), n = e.getEl(), n && n.parentNode.removeChild(n)), t.parent(this) }, create: function (t) { var n = this, i, a = []; return o.isArray(t) || (t = [t]), o.each(t, function (t) { t && (t instanceof e || ("string" == typeof t && (t = { type: t }), i = o.extend({}, n.settings.defaults, t), t.type = i.type = i.type || t.type || n.settings.defaultType || (i.defaults ? i.defaults.type : null), t = r.create(i)), a.push(t)) }), a }, renderNew: function () { var e = this; return e.items().each(function (t, n) { var r, i; t.parent(e), t._rendered || (r = e.getEl("body"), i = a.createFragment(t.renderHtml()), r.hasChildNodes() && n <= r.childNodes.length - 1 ? r.insertBefore(i, r.childNodes[n]) : r.appendChild(i), t.postRender()) }), e._layout.applyClasses(e), e._lastRect = null, e }, append: function (e) { return this.add(e).renderNew() }, prepend: function (e) { var t = this; return t.items().set(t.create(e).concat(t.items().toArray())), t.renderNew() }, insert: function (e, t, n) { var r = this, i, o, a; return e = r.create(e), i = r.items(), !n && t < i.length - 1 && (t += 1), t >= 0 && t < i.length && (o = i.slice(0, t).toArray(), a = i.slice(t).toArray(), i.set(o.concat(e, a))), r.renderNew() }, fromJSON: function (e) { var t = this; for (var n in e) t.find("#" + n).value(e[n]); return t }, toJSON: function () { var e = this, t = {}; return e.find("*").each(function (e) { var n = e.name(), r = e.value(); n && "undefined" != typeof r && (t[n] = r) }), t }, preRender: function () { }, renderHtml: function () { var e = this, t = e._layout, n = this.settings.role; return e.preRender(), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes() + '"' + (n ? ' role="' + this.settings.role + '"' : "") + '><div id="' + e._id + '-body" class="' + e.classes("body") + '">' + (e.settings.html || "") + t.renderHtml(e) + "</div></div>" }, postRender: function () { var e = this, t; return e.items().exec("postRender"), e._super(), e._layout.postRender(e), e._rendered = !0, e.settings.style && a.css(e.getEl(), e.settings.style), e.settings.border && (t = e.borderBox(), a.css(e.getEl(), { "border-top-width": t.top, "border-right-width": t.right, "border-bottom-width": t.bottom, "border-left-width": t.left })), e.parent() || (e.keyboardNav = new i({ root: e })), e }, initLayoutRect: function () { var e = this, t = e._super(); return e._layout.recalc(e), t }, recalc: function () { var e = this, t = e._layoutRect, n = e._lastRect; return n && n.w == t.w && n.h == t.h ? void 0 : (e._layout.recalc(e), t = e.layoutRect(), e._lastRect = { x: t.x, y: t.y, w: t.w, h: t.h }, !0) }, reflow: function () { var t; if (this.visible()) { for (e.repaintControls = [], e.repaintControls.map = {}, this.recalc(), t = e.repaintControls.length; t--; ) e.repaintControls[t].repaint(); "flow" !== this.settings.layout && "stack" !== this.settings.layout && this.repaint(), e.repaintControls = [] } return this } }) }), r(Q, [Y], function (e) { function t() { var e = document, t, n, r, i, o, a, s, l, c = Math.max; return t = e.documentElement, n = e.body, r = c(t.scrollWidth, n.scrollWidth), i = c(t.clientWidth, n.clientWidth), o = c(t.offsetWidth, n.offsetWidth), a = c(t.scrollHeight, n.scrollHeight), s = c(t.clientHeight, n.clientHeight), l = c(t.offsetHeight, n.offsetHeight), { width: o > r ? i : r, height: l > a ? s : a} } return function (n, r) { function i() { return a.getElementById(r.handle || n) } var o, a = document, s, l, c, u, d, f; r = r || {}, l = function (n) { var l = t(), p, h; n.preventDefault(), s = n.button, p = i(), d = n.screenX, f = n.screenY, h = window.getComputedStyle ? window.getComputedStyle(p, null).getPropertyValue("cursor") : p.runtimeStyle.cursor, o = a.createElement("div"), e.css(o, { position: "absolute", top: 0, left: 0, width: l.width, height: l.height, zIndex: 2147483647, opacity: 1e-4, cursor: h }), a.body.appendChild(o), e.on(a, "mousemove", u), e.on(a, "mouseup", c), r.start(n) }, u = function (e) { return e.button !== s ? c(e) : (e.deltaX = e.screenX - d, e.deltaY = e.screenY - f, e.preventDefault(), void r.drag(e)) }, c = function (t) { e.off(a, "mousemove", u), e.off(a, "mouseup", c), o.parentNode.removeChild(o), r.stop && r.stop(t) }, this.destroy = function () { e.off(i()) }, e.on(i(), "mousedown", l) } }), r(Z, [Y, Q], function (e, t) { return { init: function () { var e = this; e.on("repaint", e.renderScroll) }, renderScroll: function () { function n() { function t(t, a, s, l, c, u) { var d, f, p, h, m, g, v, y, b; if (f = i.getEl("scroll" + t)) { if (y = a.toLowerCase(), b = s.toLowerCase(), i.getEl("absend") && e.css(i.getEl("absend"), y, i.layoutRect()[l] - 1), !c) return void e.css(f, "display", "none"); e.css(f, "display", "block"), d = i.getEl("body"), p = i.getEl("scroll" + t + "t"), h = d["client" + s] - 2 * o, h -= n && r ? f["client" + u] : 0, m = d["scroll" + s], g = h / m, v = {}, v[y] = d["offset" + a] + o, v[b] = h, e.css(f, v), v = {}, v[y] = d["scroll" + a] * g, v[b] = h * g, e.css(p, v) } } var n, r, a; a = i.getEl("body"), n = a.scrollWidth > a.clientWidth, r = a.scrollHeight > a.clientHeight, t("h", "Left", "Width", "contentW", n, "Height"), t("v", "Top", "Height", "contentH", r, "Width") } function r() { function n(n, r, a, s, l) { var c, u = i._id + "-scroll" + n, d = i.classPrefix; i.getEl().appendChild(e.createFragment('<div id="' + u + '" class="' + d + "scrollbar " + d + "scrollbar-" + n + '"><div id="' + u + 't" class="' + d + 'scrollbar-thumb"></div></div>')), i.draghelper = new t(u + "t", { start: function () { c = i.getEl("body")["scroll" + r], e.addClass(e.get(u), d + "active") }, drag: function (e) { var t, u, d, f, p = i.layoutRect(); u = p.contentW > p.innerW, d = p.contentH > p.innerH, f = i.getEl("body")["client" + a] - 2 * o, f -= u && d ? i.getEl("scroll" + n)["client" + l] : 0, t = f / i.getEl("body")["scroll" + a], i.getEl("body")["scroll" + r] = c + e["delta" + s] / t }, stop: function () { e.removeClass(e.get(u), d + "active") } }) } i.addClass("scroll"), n("v", "Top", "Height", "Y", "Width"), n("h", "Left", "Width", "X", "Height") } var i = this, o = 2; i.settings.autoScroll && (i._hasScroll || (i._hasScroll = !0, r(), i.on("wheel", function (e) { var t = i.getEl("body"); t.scrollLeft += 10 * (e.deltaX || 0), t.scrollTop += 10 * e.deltaY, n() }), e.on(i.getEl("body"), "scroll", n)), n()) } } }), r(et, [J, Z], function (e, t) { return e.extend({ Defaults: { layout: "fit", containerCls: "panel" }, Mixins: [t], renderHtml: function () { var e = this, t = e._layout, n = e.settings.html; return e.preRender(), t.preRender(e), "undefined" == typeof n ? n = '<div id="' + e._id + '-body" class="' + e.classes("body") + '">' + t.renderHtml(e) + "</div>" : ("function" == typeof n && (n = n.call(e)), e._hasBody = !1), '<div id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1" role="group">' + (e._preBodyHtml || "") + n + "</div>" } }) }), r(tt, [Y], function (e) { function t(t, n, r) { var i, o, a, s, l, c, u, d, f, p; return f = e.getViewPort(), o = e.getPos(n), a = o.x, s = o.y, t._fixed && "static" == e.getRuntimeStyle(document.body, "position") && (a -= f.x, s -= f.y), i = t.getEl(), p = e.getSize(i), l = p.width, c = p.height, p = e.getSize(n), u = p.width, d = p.height, r = (r || "").split(""), "b" === r[0] && (s += d), "r" === r[1] && (a += u), "c" === r[0] && (s += Math.round(d / 2)), "c" === r[1] && (a += Math.round(u / 2)), "b" === r[3] && (s -= c), "r" === r[4] && (a -= l), "c" === r[3] && (s -= Math.round(c / 2)), "c" === r[4] && (a -= Math.round(l / 2)), { x: a, y: s, w: l, h: c} } return { testMoveRel: function (n, r) { for (var i = e.getViewPort(), o = 0; o < r.length; o++) { var a = t(this, n, r[o]); if (this._fixed) { if (a.x > 0 && a.x + a.w < i.w && a.y > 0 && a.y + a.h < i.h) return r[o] } else if (a.x > i.x && a.x + a.w < i.w + i.x && a.y > i.y && a.y + a.h < i.h + i.y) return r[o] } return r[0] }, moveRel: function (e, n) { "string" != typeof n && (n = this.testMoveRel(e, n)); var r = t(this, e, n); return this.moveTo(r.x, r.y) }, moveBy: function (e, t) { var n = this, r = n.layoutRect(); return n.moveTo(r.x + e, r.y + t), n }, moveTo: function (t, n) { function r(e, t, n) { return 0 > e ? 0 : e + n > t ? (e = t - n, 0 > e ? 0 : e) : e } var i = this; if (i.settings.constrainToViewport) { var o = e.getViewPort(window), a = i.layoutRect(); t = r(t, o.w + o.x, a.w), n = r(n, o.h + o.y, a.h) } return i._rendered ? i.layoutRect({ x: t, y: n }).repaint() : (i.settings.x = t, i.settings.y = n), i.fire("move", { x: t, y: n }), i } } }), r(nt, [Y], function (e) { return { resizeToContent: function () { this._layoutRect.autoResize = !0, this._lastRect = null, this.reflow() }, resizeTo: function (t, n) { if (1 >= t || 1 >= n) { var r = e.getWindowSize(); t = 1 >= t ? t * r.w : t, n = 1 >= n ? n * r.h : n } return this._layoutRect.autoResize = !1, this.layoutRect({ minW: t, minH: n, w: t, h: n }).reflow() }, resizeBy: function (e, t) { var n = this, r = n.layoutRect(); return n.resizeTo(r.w + e, r.h + t) } } }), r(rt, [et, tt, nt, Y], function (e, t, n, r) { function i() { function e(e, t) { for (; e; ) { if (e == t) return !0; e = e.parent() } } u || (u = function (t) { if (2 != t.button) for (var n = p.length; n--; ) { var r = p[n], i = r.getParentCtrl(t.target); if (r.settings.autohide) { if (i && (e(i, r) || r.parent() === i)) continue; t = r.fire("autohide", { target: t.target }), t.isDefaultPrevented() || r.hide() } } }, r.on(document, "click", u)) } function o() { d || (d = function () { var e; for (e = p.length; e--; ) s(p[e]) }, r.on(window, "scroll", d)) } function a() { if (!f) { var e = document.documentElement, t = e.clientWidth, n = e.clientHeight; f = function () { document.all && t == e.clientWidth && n == e.clientHeight || (t = e.clientWidth, n = e.clientHeight, g.hideAll()) }, r.on(window, "resize", f) } } function s(e) { function t(t, n) { for (var r, i = 0; i < p.length; i++) if (p[i] != e) for (r = p[i].parent(); r && (r = r.parent()); ) r == e && p[i].fixed(t).moveBy(0, n).repaint() } var n = r.getViewPort().y; e.settings.autofix && (e._fixed ? e._autoFixY > n && (e.fixed(!1).layoutRect({ y: e._autoFixY }).repaint(), t(!1, e._autoFixY - n)) : (e._autoFixY = e.layoutRect().y, e._autoFixY < n && (e.fixed(!0).layoutRect({ y: 0 }).repaint(), t(!0, n - e._autoFixY)))) } function l(e, t) { var n, i = g.zIndex || 65535, o; if (e) h.push(t); else for (n = h.length; n--; ) h[n] === t && h.splice(n, 1); if (h.length) for (n = 0; n < h.length; n++) h[n].modal && (i++, o = h[n]), h[n].getEl().style.zIndex = i, h[n].zIndex = i, i++; var a = document.getElementById(t.classPrefix + "modal-block"); o ? r.css(a, "z-index", o.zIndex - 1) : a && (a.parentNode.removeChild(a), m = !1), g.currentZIndex = i } function c(e) { var t; for (t = p.length; t--; ) p[t] === e && p.splice(t, 1); for (t = h.length; t--; ) h[t] === e && h.splice(t, 1) } var u, d, f, p = [], h = [], m, g = e.extend({ Mixins: [t, n], init: function (e) { var t = this; t._super(e), t._eventsRoot = t, t.addClass("floatpanel"), e.autohide && (i(), a(), p.push(t)), e.autofix && (o(), t.on("move", function () { s(this) })), t.on("postrender show", function (e) { if (e.control == t) { var n, i = t.classPrefix; t.modal && !m && (n = r.createFragment('<div id="' + i + 'modal-block" class="' + i + "reset " + i + 'fade"></div>'), n = n.firstChild, t.getContainerElm().appendChild(n), setTimeout(function () { r.addClass(n, i + "in"), r.addClass(t.getEl(), i + "in") }, 0), m = !0), l(!0, t) } }), t.on("show", function () { t.parents().each(function (e) { return e._fixed ? (t.fixed(!0), !1) : void 0 }) }), e.popover && (t._preBodyHtml = '<div class="' + t.classPrefix + 'arrow"></div>', t.addClass("popover").addClass("bottom").addClass(t.isRtl() ? "end" : "start")) }, fixed: function (e) { var t = this; if (t._fixed != e) { if (t._rendered) { var n = r.getViewPort(); e ? t.layoutRect().y -= n.y : t.layoutRect().y += n.y } t.toggleClass("fixed", e), t._fixed = e } return t }, show: function () { var e = this, t, n = e._super(); for (t = p.length; t-- && p[t] !== e; ); return -1 === t && p.push(e), n }, hide: function () { return c(this), l(!1, this), this._super() }, hideAll: function () { g.hideAll() }, close: function () { var e = this; return e.fire("close").isDefaultPrevented() || (e.remove(), l(!1, e)), e }, remove: function () { c(this), this._super() }, postRender: function () { var e = this; return e.settings.bodyRole && this.getEl("body").setAttribute("role", e.settings.bodyRole), e._super() } }); return g.hideAll = function () { for (var e = p.length; e--; ) { var t = p[e]; t && t.settings.autohide && (t.hide(), p.splice(e, 1)) } }, g }), r(it, [rt, et, Y, Q], function (e, t, n, r) { var i = e.extend({ modal: !0, Defaults: { border: 1, layout: "flex", containerCls: "panel", role: "dialog", callbacks: { submit: function () { this.fire("submit", { data: this.toJSON() }) }, close: function () { this.close() } } }, init: function (e) { var n = this; n._super(e), n.isRtl() && n.addClass("rtl"), n.addClass("window"), n._fixed = !0, e.buttons && (n.statusbar = new t({ layout: "flex", border: "1 0 0 0", spacing: 3, padding: 10, align: "center", pack: n.isRtl() ? "start" : "end", defaults: { type: "button" }, items: e.buttons }), n.statusbar.addClass("foot"), n.statusbar.parent(n)), n.on("click", function (e) { -1 != e.target.className.indexOf(n.classPrefix + "close") && n.close() }), n.on("cancel", function () { n.close() }), n.aria("describedby", n.describedBy || n._id + "-none"), n.aria("label", e.title), n._fullscreen = !1 }, recalc: function () { var e = this, t = e.statusbar, r, i, o, a; e._fullscreen && (e.layoutRect(n.getWindowSize()), e.layoutRect().contentH = e.layoutRect().innerH), e._super(), r = e.layoutRect(), e.settings.title && !e._fullscreen && (i = r.headerW, i > r.w && (o = r.x - Math.max(0, i / 2), e.layoutRect({ w: i, x: o }), a = !0)), t && (t.layoutRect({ w: e.layoutRect().innerW }).recalc(), i = t.layoutRect().minW + r.deltaW, i > r.w && (o = r.x - Math.max(0, i - r.w), e.layoutRect({ w: i, x: o }), a = !0)), a && e.recalc() }, initLayoutRect: function () { var e = this, t = e._super(), r = 0, i; if (e.settings.title && !e._fullscreen) { i = e.getEl("head"); var o = n.getSize(i); t.headerW = o.width, t.headerH = o.height, r += t.headerH } e.statusbar && (r += e.statusbar.layoutRect().h), t.deltaH += r, t.minH += r, t.h += r; var a = n.getWindowSize(); return t.x = Math.max(0, a.w / 2 - t.w / 2), t.y = Math.max(0, a.h / 2 - t.h / 2), t }, renderHtml: function () { var e = this, t = e._layout, n = e._id, r = e.classPrefix, i = e.settings, o = "", a = "", s = i.html; return e.preRender(), t.preRender(e), i.title && (o = '<div id="' + n + '-head" class="' + r + 'window-head"><div id="' + n + '-title" class="' + r + 'title">' + e.encode(i.title) + '</div><button type="button" class="' + r + 'close" aria-hidden="true">\xd7</button><div id="' + n + '-dragh" class="' + r + 'dragh"></div></div>'), i.url && (s = '<iframe src="' + i.url + '" tabindex="-1"></iframe>'), "undefined" == typeof s && (s = t.renderHtml(e)), e.statusbar && (a = e.statusbar.renderHtml()), '<div id="' + n + '" class="' + e.classes() + '" hidefocus="1"><div class="' + e.classPrefix + 'reset" role="application">' + o + '<div id="' + n + '-body" class="' + e.classes("body") + '">' + s + "</div>" + a + "</div></div>" }, fullscreen: function (e) { var t = this, r = document.documentElement, i, o = t.classPrefix, a; if (e != t._fullscreen) if (n.on(window, "resize", function () { var e; if (t._fullscreen) if (i) t._timer || (t._timer = setTimeout(function () { var e = n.getWindowSize(); t.moveTo(0, 0).resizeTo(e.w, e.h), t._timer = 0 }, 50)); else { e = (new Date).getTime(); var r = n.getWindowSize(); t.moveTo(0, 0).resizeTo(r.w, r.h), (new Date).getTime() - e > 50 && (i = !0) } }), a = t.layoutRect(), t._fullscreen = e, e) { t._initial = { x: a.x, y: a.y, w: a.w, h: a.h }, t._borderBox = t.parseBox("0"), t.getEl("head").style.display = "none", a.deltaH -= a.headerH + 2, n.addClass(r, o + "fullscreen"), n.addClass(document.body, o + "fullscreen"), t.addClass("fullscreen"); var s = n.getWindowSize(); t.moveTo(0, 0).resizeTo(s.w, s.h) } else t._borderBox = t.parseBox(t.settings.border), t.getEl("head").style.display = "", a.deltaH += a.headerH, n.removeClass(r, o + "fullscreen"), n.removeClass(document.body, o + "fullscreen"), t.removeClass("fullscreen"), t.moveTo(t._initial.x, t._initial.y).resizeTo(t._initial.w, t._initial.h); return t.reflow() }, postRender: function () { var e = this, t; setTimeout(function () { e.addClass("in") }, 0), e._super(), e.statusbar && e.statusbar.postRender(), e.focus(), this.dragHelper = new r(e._id + "-dragh", { start: function () { t = { x: e.layoutRect().x, y: e.layoutRect().y} }, drag: function (n) { e.moveTo(t.x + n.deltaX, t.y + n.deltaY) } }), e.on("submit", function (t) { t.isDefaultPrevented() || e.close() }) }, submit: function () { return this.fire("submit", { data: this.toJSON() }) }, remove: function () { var e = this, t = e.classPrefix; e.dragHelper.destroy(), e._super(), e.statusbar && this.statusbar.remove(), e._fullscreen && (n.removeClass(document.documentElement, t + "fullscreen"), n.removeClass(document.body, t + "fullscreen")) }, getContentWindow: function () { var e = this.getEl().getElementsByTagName("iframe")[0]; return e ? e.contentWindow : null } }); return i }), r(ot, [it], function (e) { var t = e.extend({ init: function (e) { e = { border: 1, padding: 20, layout: "flex", pack: "center", align: "center", containerCls: "panel", autoScroll: !0, buttons: { type: "button", text: "Ok", action: "ok" }, items: { type: "label", multiline: !0, maxWidth: 500, maxHeight: 200} }, this._super(e) }, Statics: { OK: 1, OK_CANCEL: 2, YES_NO: 3, YES_NO_CANCEL: 4, msgBox: function (n) { function r(e, t, n) { return { type: "button", text: e, subtype: n ? "primary" : "", onClick: function (e) { e.control.parents()[1].close(), o(t) } } } var i, o = n.callback || function () { }; switch (n.buttons) { case t.OK_CANCEL: i = [r("Ok", !0, !0), r("Cancel", !1)]; break; case t.YES_NO: case t.YES_NO_CANCEL: i = [r("Yes", 1, !0), r("No", 0)], n.buttons == t.YES_NO_CANCEL && i.push(r("Cancel", -1)); break; default: i = [r("Ok", !0, !0)] } return new e({ padding: 20, x: n.x, y: n.y, minWidth: 300, minHeight: 100, layout: "flex", pack: "center", align: "center", buttons: i, title: n.title, role: "alertdialog", items: { type: "label", multiline: !0, maxWidth: 500, maxHeight: 200, text: n.text }, onPostRender: function () { this.aria("describedby", this.items()[0]._id) }, onClose: n.onClose, onCancel: function () { o(!1) } }).renderTo(document.body).reflow() }, alert: function (e, n) { return "string" == typeof e && (e = { text: e }), e.callback = n, t.msgBox(e) }, confirm: function (e, n) { return "string" == typeof e && (e = { text: e }), e.callback = n, e.buttons = t.OK_CANCEL, t.msgBox(e) } } }); return t }), r(at, [it, ot], function (e, t) { return function (n) { function r() { return o.length ? o[o.length - 1] : void 0 } var i = this, o = []; i.windows = o, n.on("remove", function () { for (var e = o.length; e--; ) o[e].close() }), i.open = function (t, r) { var i; return n.editorManager.setActive(n), t.title = t.title || " ", t.url = t.url || t.file, t.url && (t.width = parseInt(t.width || 320, 10), t.height = parseInt(t.height || 240, 10)), t.body && (t.items = { defaults: t.defaults, type: t.bodyType || "form", items: t.body }), t.url || t.buttons || (t.buttons = [{ text: "Ok", subtype: "primary", onclick: function () { i.find("form")[0].submit() } }, { text: "Cancel", onclick: function () { i.close() } }]), i = new e(t), o.push(i), i.on("close", function () { for (var e = o.length; e--; ) o[e] === i && o.splice(e, 1); o.length || n.focus() }), t.data && i.on("postRender", function () { this.find("*").each(function (e) { var n = e.name(); n in t.data && e.value(t.data[n]) }) }), i.features = t || {}, i.params = r || {}, 1 === o.length && n.nodeChanged(), i.renderTo().reflow() }, i.alert = function (e, r, i) { t.alert(e, function () { r ? r.call(i || this) : n.focus() }) }, i.confirm = function (e, n, r) { t.confirm(e, function (e) { n.call(r || this, e) }) }, i.close = function () { r() && r().close() }, i.getParams = function () { return r() ? r().params : null }, i.setParams = function (e) { r() && (r().params = e) }, i.getWindows = function () { return o } } }), r(st, [B, x, _, g, d, u], function (e, t, n, r, i, o) { return function (a) { function s(e, t) { try { a.getDoc().execCommand(e, !1, t) } catch (n) { } } function l() { var e = a.getDoc().documentMode; return e ? e : 6 } function c(e) { return e.isDefaultPrevented() } function u() { function t(e) { var t = new i(function () { }); o.each(a.getBody().getElementsByTagName("*"), function (e) { "SPAN" == e.tagName && e.setAttribute("mce-data-marked", 1), !e.hasAttribute("data-mce-style") && e.hasAttribute("style") && a.dom.setAttrib(e, "style", a.dom.getAttrib(e, "style")) }), t.observe(a.getDoc(), { childList: !0, attributes: !0, subtree: !0, attributeFilter: ["style"] }), a.getDoc().execCommand(e ? "ForwardDelete" : "Delete", !1, null); var n = a.selection.getRng(), r = n.startContainer.parentNode; o.each(t.takeRecords(), function (e) { if (q.isChildOf(e.target, a.getBody())) { if ("style" == e.attributeName) { var t = e.target.getAttribute("data-mce-style"); t ? e.target.setAttribute("style", t) : e.target.removeAttribute("style") } o.each(e.addedNodes, function (e) { if ("SPAN" == e.nodeName && !e.getAttribute("mce-data-marked")) { var t, i; e == r && (t = n.startOffset, i = e.firstChild), q.remove(e, !0), i && (n.setStart(i, t), n.setEnd(i, t), a.selection.setRng(n)) } }) } }), t.disconnect(), o.each(a.dom.select("span[mce-data-marked]"), function (e) { e.removeAttribute("mce-data-marked") }) } var n = a.getDoc(), r = "data:text/mce-internal,", i = window.MutationObserver, s, l; i || (s = !0, i = function () { function e(e) { var t = e.relatedNode || e.target; n.push({ target: t, addedNodes: [t] }) } function t(e) { var t = e.relatedNode || e.target; n.push({ target: t, attributeName: e.attrName }) } var n = [], r; this.observe = function (n) { r = n, r.addEventListener("DOMSubtreeModified", e, !1), r.addEventListener("DOMNodeInsertedIntoDocument", e, !1), r.addEventListener("DOMNodeInserted", e, !1), r.addEventListener("DOMAttrModified", t, !1) }, this.disconnect = function () { r.removeEventListener("DOMSubtreeModified", e, !1), r.removeEventListener("DOMNodeInsertedIntoDocument", e, !1), r.removeEventListener("DOMNodeInserted", e, !1), r.removeEventListener("DOMAttrModified", t, !1) }, this.takeRecords = function () { return n } }), a.on("keydown", function (n) { var r = n.keyCode == $, i = e.metaKeyPressed(n); if (!c(n) && (r || n.keyCode == U)) { var o = a.selection.getRng(), s = o.startContainer, l = o.startOffset; if (!i && o.collapsed && 3 == s.nodeType && (r ? l < s.data.length : l > 0)) return; n.preventDefault(), i && a.selection.getSel().modify("extend", r ? "forward" : "backward", "word"), t(r) } }), a.on("keypress", function (n) { c(n) || j.isCollapsed() || !n.charCode || e.metaKeyPressed(n) || (n.preventDefault(), t(!0), a.selection.setContent(String.fromCharCode(n.charCode))) }), a.addCommand("Delete", function () { t() }), a.addCommand("ForwardDelete", function () { t(!0) }), s || (a.on("dragstart", function (e) { var t; a.selection.isCollapsed() && "IMG" == e.target.tagName && j.select(e.target), l = j.getRng(), t = a.selection.getContent(), t.length > 0 && e.dataTransfer.setData("URL", "data:text/mce-internal," + escape(t)) }), a.on("drop", function (e) { if (!c(e)) { var i = e.dataTransfer.getData("URL"); if (!i || -1 == i.indexOf(r) || !n.caretRangeFromPoint) return; i = unescape(i.substr(r.length)), n.caretRangeFromPoint && (e.preventDefault(), window.setTimeout(function () { var r = n.caretRangeFromPoint(e.x, e.y); l && (j.setRng(l), l = null), t(), j.setRng(r), a.insertContent(i) }, 0)) } }), a.on("cut", function (e) { !c(e) && e.clipboardData && (e.preventDefault(), e.clipboardData.clearData(), e.clipboardData.setData("text/html", a.selection.getContent()), e.clipboardData.setData("text/plain", a.selection.getContent({ format: "text" })), t(!0)) })) } function d() { function e(e) { var t = q.create("body"), n = e.cloneContents(); return t.appendChild(n), j.serializer.serialize(t, { format: "html" }) } function n(n) { if (!n.setStart) { if (n.item) return !1; var r = n.duplicate(); return r.moveToElementText(a.getBody()), t.compareRanges(n, r) } var i = e(n), o = q.createRng(); o.selectNode(a.getBody()); var s = e(o); return i === s } a.on("keydown", function (e) { var t = e.keyCode, r, i; if (!c(e) && (t == $ || t == U)) { if (r = a.selection.isCollapsed(), i = a.getBody(), r && !q.isEmpty(i)) return; if (!r && !n(a.selection.getRng())) return; e.preventDefault(), a.setContent(""), i.firstChild && q.isBlock(i.firstChild) ? a.selection.setCursorLocation(i.firstChild, 0) : a.selection.setCursorLocation(i, 0), a.nodeChanged() } }) } function f() { a.shortcuts.add("ctrl+a", null, "SelectAll") } function p() { a.settings.content_editable || (q.bind(a.getDoc(), "focusin", function () { j.setRng(j.getRng()) }), q.bind(a.getDoc(), "mousedown mouseup", function (e) { e.target == a.getDoc().documentElement && (a.getBody().focus(), "mousedown" == e.type ? j.placeCaretAt(e.clientX, e.clientY) : j.setRng(j.getRng())) })) } function h() { a.on("keydown", function (e) { if (!c(e) && e.keyCode === U) { if (!a.getBody().getElementsByTagName("hr").length) return; if (j.isCollapsed() && 0 === j.getRng(!0).startOffset) { var t = j.getNode(), n = t.previousSibling; if ("HR" == t.nodeName) return q.remove(t), void e.preventDefault(); n && n.nodeName && "hr" === n.nodeName.toLowerCase() && (q.remove(n), e.preventDefault()) } } }) } function m() { window.Range.prototype.getClientRects || a.on("mousedown", function (e) { if (!c(e) && "HTML" === e.target.nodeName) { var t = a.getBody(); t.blur(), setTimeout(function () { t.focus() }, 0) } }) } function g() { a.on("click", function (e) { var t = e.target; /^(IMG|HR)$/.test(t.nodeName) && (e.preventDefault(), j.getSel().setBaseAndExtent(t, 0, t, 1), a.nodeChanged()), "A" == t.nodeName && q.hasClass(t, "mce-item-anchor") && (e.preventDefault(), j.select(t)) }) } function v() { function e() { var e = q.getAttribs(j.getStart().cloneNode(!1)); return function () { var t = j.getStart(); t !== a.getBody() && (q.setAttrib(t, "style", null), V(e, function (e) { t.setAttributeNode(e.cloneNode(!0)) })) } } function t() { return !j.isCollapsed() && q.getParent(j.getStart(), q.isBlock) != q.getParent(j.getEnd(), q.isBlock) } a.on("keypress", function (n) { var r; return c(n) || 8 != n.keyCode && 46 != n.keyCode || !t() ? void 0 : (r = e(), a.getDoc().execCommand("delete", !1, null), r(), n.preventDefault(), !1) }), q.bind(a.getDoc(), "cut", function (n) { var r; !c(n) && t() && (r = e(), setTimeout(function () { r() }, 0)) }) } function y() { document.body.setAttribute("role", "application") } function b() { a.on("keydown", function (e) { if (!c(e) && e.keyCode === U && j.isCollapsed() && 0 === j.getRng(!0).startOffset) { var t = j.getNode().previousSibling; if (t && t.nodeName && "table" === t.nodeName.toLowerCase()) return e.preventDefault(), !1 } }) } function C() { l() > 7 || (s("RespectVisibilityInDesign", !0), a.contentStyles.push(".mceHideBrInPre pre br {display: none}"), q.addClass(a.getBody(), "mceHideBrInPre"), K.addNodeFilter("pre", function (e) { for (var t = e.length, r, i, o, a; t--; ) for (r = e[t].getAll("br"), i = r.length; i--; ) o = r[i], a = o.prev, a && 3 === a.type && "\n" != a.value.charAt(a.value - 1) ? a.value += "\n" : o.parent.insert(new n("#text", 3), o, !0).value = "\n" }), G.addNodeFilter("pre", function (e) { for (var t = e.length, n, r, i, o; t--; ) for (n = e[t].getAll("br"), r = n.length; r--; ) i = n[r], o = i.prev, o && 3 == o.type && (o.value = o.value.replace(/\r?\n$/, "")) })) } function x() { q.bind(a.getBody(), "mouseup", function () { var e, t = j.getNode(); "IMG" == t.nodeName && ((e = q.getStyle(t, "width")) && (q.setAttrib(t, "width", e.replace(/[^0-9%]+/g, "")), q.setStyle(t, "width", "")), (e = q.getStyle(t, "height")) && (q.setAttrib(t, "height", e.replace(/[^0-9%]+/g, "")), q.setStyle(t, "height", ""))) }) } function w() { a.on("keydown", function (t) { var n, r, i, o, s; if (!c(t) && t.keyCode == e.BACKSPACE && (n = j.getRng(), r = n.startContainer, i = n.startOffset, o = q.getRoot(), s = r, n.collapsed && 0 === i)) { for (; s && s.parentNode && s.parentNode.firstChild == s && s.parentNode != o; ) s = s.parentNode; "BLOCKQUOTE" === s.tagName && (a.formatter.toggle("blockquote", null, s), n = q.createRng(), n.setStart(r, 0), n.setEnd(r, 0), j.setRng(n)) } }) } function _() { function e() { a._refreshContentEditable(), s("StyleWithCSS", !1), s("enableInlineTableEditing", !1), Y.object_resizing || s("enableObjectResizing", !1) } Y.readonly || a.on("BeforeExecCommand MouseDown", e) } function E() { function e() { V(q.select("a"), function (e) { var t = e.parentNode, n = q.getRoot(); if (t.lastChild === e) { for (; t && !q.isBlock(t); ) { if (t.parentNode.lastChild !== t || t === n) return; t = t.parentNode } q.add(t, "br", { "data-mce-bogus": 1 }) } }) } a.on("SetContent ExecCommand", function (t) { ("setcontent" == t.type || "mceInsertLink" === t.command) && e() }) } function N() { Y.forced_root_block && a.on("init", function () { s("DefaultParagraphSeparator", Y.forced_root_block) }) } function k() { a.on("Undo Redo SetContent", function (e) { e.initial || a.execCommand("mceRepaint") }) } function S() { a.on("keydown", function (e) { var t; c(e) || e.keyCode != U || (t = a.getDoc().selection.createRange(), t && t.item && (e.preventDefault(), a.undoManager.beforeChange(), q.remove(t.item(0)), a.undoManager.add())) }) } function T() { var e; l() >= 10 && (e = "", V("p div h1 h2 h3 h4 h5 h6".split(" "), function (t, n) { e += (n > 0 ? "," : "") + t + ":empty" }), a.contentStyles.push(e + "{padding-right: 1px !important}")) } function R() { l() < 9 && (K.addNodeFilter("noscript", function (e) { for (var t = e.length, n, r; t--; ) n = e[t], r = n.firstChild, r && n.attr("data-mce-innertext", r.value) }), G.addNodeFilter("noscript", function (e) { for (var t = e.length, i, o, a; t--; ) i = e[t], o = e[t].firstChild, o ? o.value = r.decode(o.value) : (a = i.attributes.map["data-mce-innertext"], a && (i.attr("data-mce-innertext", null), o = new n("#text", 3), o.value = a, o.raw = !0, i.append(o))) })) } function A() { function e(e, t) { var n = i.createTextRange(); try { n.moveToPoint(e, t) } catch (r) { n = null } return n } function t(t) { var r; t.button ? (r = e(t.x, t.y), r && (r.compareEndPoints("StartToStart", a) > 0 ? r.setEndPoint("StartToStart", a) : r.setEndPoint("EndToEnd", a), r.select())) : n() } function n() { var e = r.selection.createRange(); a && !e.item && 0 === e.compareEndPoints("StartToEnd", e) && a.select(), q.unbind(r, "mouseup", n), q.unbind(r, "mousemove", t), a = o = 0 } var r = q.doc, i = r.body, o, a, s; r.documentElement.unselectable = !0, q.bind(r, "mousedown contextmenu", function (i) { if ("HTML" === i.target.nodeName) { if (o && n(), s = r.documentElement, s.scrollHeight > s.clientHeight) return; o = 1, a = e(i.x, i.y), a && (q.bind(r, "mouseup", n), q.bind(r, "mousemove", t), q.getRoot().focus(), a.select()) } }) } function B() { a.on("keyup focusin mouseup", function (t) { 65 == t.keyCode && e.metaKeyPressed(t) || j.normalize() }, !0) } function D() { a.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}") } function L() { a.inline || a.on("keydown", function () { document.activeElement == document.body && a.getWin().focus() }) } function H() { a.inline || (a.contentStyles.push("body {min-height: 150px}"), a.on("click", function (e) { "HTML" == e.target.nodeName && (a.getBody().focus(), a.selection.normalize(), a.nodeChanged()) })) } function M() { i.mac && a.on("keydown", function (t) { !e.metaKeyPressed(t) || 37 != t.keyCode && 39 != t.keyCode || (t.preventDefault(), a.selection.getSel().modify("move", 37 == t.keyCode ? "backward" : "forward", "word")) }) } function P() { s("AutoUrlDetect", !1) } function O() { a.inline || a.on("focus blur beforegetcontent", function () { var e = a.dom.create("br"); a.getBody().appendChild(e), e.parentNode.removeChild(e) }, !0) } function I() { a.on("click", function (e) { var t = e.target; do if ("A" === t.tagName) return void e.preventDefault(); while (t = t.parentNode) }), a.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}") } function F() { a.on("touchstart", function (e) { var t, n, r, i; t = e.target, n = (new Date).getTime(), i = e.changedTouches, !i || i.length > 1 || (r = i[0], a.once("touchend", function (e) { var i = e.changedTouches[0], o; (new Date).getTime() - n > 500 || Math.abs(r.clientX - i.clientX) > 5 || Math.abs(r.clientY - i.clientY) > 5 || (o = { target: t }, V("pageX pageY clientX clientY screenX screenY".split(" "), function (e) { o[e] = i[e] }), o = a.fire("click", o), o.isDefaultPrevented() || (a.selection.placeCaretAt(i.clientX, i.clientY), a.nodeChanged())) })) }) } function z() { a.on("init", function () { a.dom.bind(a.getBody(), "submit", function (e) { e.preventDefault() }) }) } function W() { K.addNodeFilter("br", function (e) { for (var t = e.length; t--; ) "Apple-interchange-newline" == e[t].attr("class") && e[t].remove() }) } var V = o.each, U = e.BACKSPACE, $ = e.DELETE, q = a.dom, j = a.selection, Y = a.settings, K = a.parser, G = a.serializer, X = i.gecko, J = i.ie, Q = i.webkit; w(), d(), B(), Q && (u(), p(), g(), N(), z(), b(), W(), F(), i.iOS ? (L(), H(), I()) : f()), J && i.ie < 11 && (h(), y(), C(), x(), S(), T(), R(), A()), i.ie >= 11 && (H(), O(), b()), i.ie && (f(), P()), X && (h(), m(), v(), _(), E(), k(), D(), M(), b()) } }), r(lt, [$], function (e) { function t(t) { return t._eventDispatcher || (t._eventDispatcher = new e({ scope: t, toggleEvent: function (n, r) { e.isNative(n) && t.toggleNativeEvent && t.toggleNativeEvent(n, r) } })), t._eventDispatcher } return { fire: function (e, n, r) { var i = this; if (i.removed && "remove" !== e) return n; if (n = t(i).fire(e, n, r), r !== !1 && i.parent) for (var o = i.parent(); o && !n.isPropagationStopped(); ) o.fire(e, n, !1), o = o.parent(); return n }, on: function (e, n, r) { return t(this).on(e, n, r) }, off: function (e, n) { return t(this).off(e, n) }, once: function (e, n) { return t(this).once(e, n) }, hasEventListeners: function (e) { return t(this).has(e) } } }), r(ct, [lt, y, u], function (e, t, n) { function r(e, t) { return "selectionchange" == t ? e.getDoc() : !e.inline && /^mouse|click|contextmenu|drop|dragover|dragend/.test(t) ? e.getDoc().documentElement : e.settings.event_root ? (e.eventRoot || (e.eventRoot = o.select(e.settings.event_root)[0]), e.eventRoot) : e.getBody() } function i(e, t) { var n = r(e, t), i; if (e.delegates || (e.delegates = {}), !e.delegates[t]) if (e.settings.event_root) { if (a || (a = {}, e.editorManager.on("removeEditor", function () { var t; if (!e.editorManager.activeEditor && a) { for (t in a) e.dom.unbind(r(e, t)); a = null } })), a[t]) return; i = function (n) { for (var r = n.target, i = e.editorManager.editors, a = i.length; a--; ) { var s = i[a].getBody(); (s === r || o.isChildOf(r, s)) && (i[a].hidden || i[a].fire(t, n)) } }, a[t] = i, o.bind(n, t, i) } else i = function (n) { e.hidden || e.fire(t, n) }, o.bind(n, t, i), e.delegates[t] = i } var o = t.DOM, a, s = { bindPendingEventDelegates: function () { var e = this; n.each(e._pendingNativeEvents, function (t) { i(e, t) }) }, toggleNativeEvent: function (e, t) { var n = this; n.settings.readonly || "focus" != e && "blur" != e && (t ? n.initialized ? i(n, e) : n._pendingNativeEvents ? n._pendingNativeEvents.push(e) : n._pendingNativeEvents = [e] : n.initialized && (n.dom.unbind(r(n, e), e, n.delegates[e]), delete n.delegates[e])) }, unbindAllNativeEvents: function () { var e = this, t; if (e.delegates) { for (t in e.delegates) e.dom.unbind(r(e, t), t, e.delegates[t]); delete e.delegates } e.inline || (e.getBody().onload = null, e.dom.unbind(e.getWin()), e.dom.unbind(e.getDoc())), e.dom.unbind(e.getBody()), e.dom.unbind(e.getContainer()) } }; return s = n.extend({}, e, s) }), r(ut, [u, d], function (e, t) { var n = e.each, r = e.explode, i = { f9: 120, f10: 121, f11: 122 }; return function (o) { var a = this, s = {}; o.on("keyup keypress keydown", function (e) { (e.altKey || e.ctrlKey || e.metaKey) && !e.isDefaultPrevented() && n(s, function (n) { var r = t.mac ? e.metaKey : e.ctrlKey; if (n.ctrl == r && n.alt == e.altKey && n.shift == e.shiftKey) return e.keyCode == n.keyCode || e.charCode && e.charCode == n.charCode ? (e.preventDefault(), "keydown" == e.type && n.func.call(n.scope), !0) : void 0 }) }), a.add = function (t, a, l, c) { var u; return u = l, "string" == typeof l ? l = function () { o.execCommand(u, !1, null) } : e.isArray(u) && (l = function () { o.execCommand(u[0], u[1], u[2]) }), n(r(t.toLowerCase()), function (e) { var t = { func: l, scope: c || o, desc: o.translate(a), alt: !1, ctrl: !1, shift: !1 }; n(r(e, "+"), function (e) { switch (e) { case "alt": case "ctrl": case "shift": t[e] = !0; break; default: /^[0-9]{2,}$/.test(e) ? t.keyCode = parseInt(e, 10) : (t.charCode = e.charCodeAt(0), t.keyCode = i[e] || e.toUpperCase().charCodeAt(0)) } }), s[(t.ctrl ? "ctrl" : "") + "," + (t.alt ? "alt" : "") + "," + (t.shift ? "shift" : "") + "," + t.keyCode] = t }), !0 } } }), r(dt, [y, f, C, w, _, R, T, H, O, I, F, z, W, V, b, l, at, E, k, st, d, u, ct, ut], function (e, n, r, i, o, a, s, l, c, u, d, f, p, h, m, g, v, y, b, C, x, w, _, E) { function N(e, t, i) { var o = this, a, s; a = o.documentBaseUrl = i.documentBaseURL, s = i.baseURI, o.settings = t = R({ id: e, theme: "modern", delta_width: 0, delta_height: 0, popup_css: "", plugins: "", document_base_url: a, add_form_submit_trigger: !0, submit_patch: !0, add_unload_trigger: !0, convert_urls: !0, relative_urls: !0, remove_script_host: !0, object_resizing: !0, doctype: "<!DOCTYPE html>", visual: !0, font_size_style_values: "xx-small,x-small,small,medium,large,x-large,xx-large", font_size_legacy_values: "xx-small,small,medium,large,x-large,xx-large,300%", forced_root_block: "p", hidden_input: !0, padd_empty_editor: !0, render_ui: !0, indentation: "30px", inline_styles: !0, convert_fonts_to_spans: !0, indent: "simple", indent_before: "p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist", indent_after: "p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist", validate: !0, entity_encoding: "named", url_converter: o.convertURL, url_converter_scope: o, ie7_compat: !0 }, t), r.language = t.language || "en", r.languageLoad = t.language_load, r.baseURL = i.baseURL, o.id = t.id = e, o.isNotDirty = !0, o.plugins = {}, o.documentBaseURI = new h(t.document_base_url || a, { base_uri: s }), o.baseURI = s, o.contentCSS = [], o.contentStyles = [], o.shortcuts = new E(o), o.execCommands = {}, o.queryStateCommands = {}, o.queryValueCommands = {}, o.loadedCSS = {}, t.target && (o.targetElm = t.target), o.suffix = i.suffix, o.editorManager = i, o.inline = t.inline, i.fire("SetupEditor", o), o.execCallback("setup", o), o.$ = n.overrideDefaults(function () { return { context: o.inline ? o.getBody() : o.getDoc(), element: o.getBody()} }) } var k = e.DOM, S = r.ThemeManager, T = r.PluginManager, R = w.extend, A = w.each, B = w.explode, D = w.inArray, L = w.trim, H = w.resolve, M = g.Event, P = x.gecko, O = x.ie; return N.prototype = { render: function () { function e() { k.unbind(window, "ready", e), n.render() } function t() { var e = m.ScriptLoader; if (r.language && "en" != r.language && !r.language_url && (r.language_url = n.editorManager.baseURL + "/langs/" + r.language + ".js"), r.language_url && e.add(r.language_url), r.theme && "function" != typeof r.theme && "-" != r.theme.charAt(0) && !S.urls[r.theme]) { var t = r.theme_url; t = t ? n.documentBaseURI.toAbsolute(t) : "themes/" + r.theme + "/theme" + o + ".js", S.load(r.theme, t) } w.isArray(r.plugins) && (r.plugins = r.plugins.join(" ")), A(r.external_plugins, function (e, t) { T.load(t, e), r.plugins += " " + t }), A(r.plugins.split(/[ ,]/), function (e) { if (e = L(e), e && !T.urls[e]) if ("-" == e.charAt(0)) { e = e.substr(1, e.length); var t = T.dependencies(e); A(t, function (e) { var t = { prefix: "plugins/", resource: e, suffix: "/plugin" + o + ".js" }; e = T.createUrl(t, e), T.load(e.resource, e) }) } else T.load(e, { prefix: "plugins/", resource: e, suffix: "/plugin" + o + ".js" }) }), e.loadQueue(function () { n.removed || n.init() }) } var n = this, r = n.settings, i = n.id, o = n.suffix; if (!M.domLoaded) return void k.bind(window, "ready", e); if (n.getElement() && x.contentEditable) { r.inline ? n.inline = !0 : (n.orgVisibility = n.getElement().style.visibility, n.getElement().style.visibility = "hidden"); var a = n.getElement().form || k.getParent(i, "form"); a && (n.formElement = a, r.hidden_input && !/TEXTAREA|INPUT/i.test(n.getElement().nodeName) && (k.insertAfter(k.create("input", { type: "hidden", name: i }), i), n.hasHiddenInput = !0), n.formEventDelegate = function (e) { n.fire(e.type, e) }, k.bind(a, "submit reset", n.formEventDelegate), n.on("reset", function () { n.setContent(n.startContent, { format: "raw" }) }), !r.submit_patch || a.submit.nodeType || a.submit.length || a._mceOldSubmit || (a._mceOldSubmit = a.submit, a.submit = function () { return n.editorManager.triggerSave(), n.isNotDirty = !0, a._mceOldSubmit(a) })), n.windowManager = new v(n), "xml" == r.encoding && n.on("GetContent", function (e) { e.save && (e.content = k.encode(e.content)) }), r.add_form_submit_trigger && n.on("submit", function () { n.initialized && n.save() }), r.add_unload_trigger && (n._beforeUnload = function () { !n.initialized || n.destroyed || n.isHidden() || n.save({ format: "raw", no_events: !0, set_dirty: !1 }) }, n.editorManager.on("BeforeUnload", n._beforeUnload)), t() } }, init: function () { function e(n) { var r = T.get(n), i, o; i = T.urls[n] || t.documentBaseUrl.replace(/\/$/, ""), n = L(n), r && -1 === D(m, n) && (A(T.dependencies(n), function (t) { e(t) }), o = new r(t, i, t.$), t.plugins[n] = o, o.init && (o.init(t, i), m.push(n))) } var t = this, n = t.settings, r = t.getElement(), i, o, a, s, l, c, u, d, f, p, h, m = []; if (t.rtl = this.editorManager.i18n.rtl, t.editorManager.add(t), n.aria_label = n.aria_label || k.getAttrib(r, "aria-label", t.getLang("aria.rich_text_area")), n.theme && ("function" != typeof n.theme ? (n.theme = n.theme.replace(/-/, ""), c = S.get(n.theme), t.theme = new c(t, S.urls[n.theme]), t.theme.init && t.theme.init(t, S.urls[n.theme] || t.documentBaseUrl.replace(/\/$/, ""), t.$)) : t.theme = n.theme), A(n.plugins.replace(/\-/g, "").split(/[ ,]/), e), n.render_ui && t.theme && (t.orgDisplay = r.style.display, "function" != typeof n.theme ? (i = n.width || r.style.width || r.offsetWidth, o = n.height || r.style.height || r.offsetHeight, a = n.min_height || 100, p = /^[0-9\.]+(|px)$/i, p.test("" + i) && (i = Math.max(parseInt(i, 10), 100)), p.test("" + o) && (o = Math.max(parseInt(o, 10), a)), l = t.theme.renderUI({ targetNode: r, width: i, height: o, deltaWidth: n.delta_width, deltaHeight: n.delta_height }), n.content_editable || (o = (l.iframeHeight || o) + ("number" == typeof o ? l.deltaHeight || 0 : ""), a > o && (o = a))) : (l = n.theme(t, r), l.editorContainer.nodeType && (l.editorContainer = l.editorContainer.id = l.editorContainer.id || t.id + "_parent"), l.iframeContainer.nodeType && (l.iframeContainer = l.iframeContainer.id = l.iframeContainer.id || t.id + "_iframecontainer"), o = l.iframeHeight || r.offsetHeight), t.editorContainer = l.editorContainer), n.content_css && A(B(n.content_css), function (e) { t.contentCSS.push(t.documentBaseURI.toAbsolute(e)) }), n.content_style && t.contentStyles.push(n.content_style), n.content_editable) return r = s = l = null, t.initContentBody(); for (t.iframeHTML = n.doctype + "<html><head>", n.document_base_url != t.documentBaseUrl && (t.iframeHTML += '<base href="' + t.documentBaseURI.getURI() + '" />'), !x.caretAfter && n.ie7_compat && (t.iframeHTML += '<meta http-equiv="X-UA-Compatible" content="IE=7" />'), t.iframeHTML += '<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />', h = 0; h < t.contentCSS.length; h++) { var g = t.contentCSS[h]; /*t.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+g+'" />',t.loadedCSS[g]=!0*/ } d = n.body_id || "tinymce", -1 != d.indexOf("=") && (d = t.getParam("body_id", "", "hash"), d = d[t.id] || d), f = n.body_class || "", -1 != f.indexOf("=") && (f = t.getParam("body_class", "", "hash"), f = f[t.id] || ""), n.content_security_policy && (t.iframeHTML += '<meta http-equiv="Content-Security-Policy" content="' + n.content_security_policy + '" />'), t.iframeHTML += '</head><body id="' + d + '" class="mce-content-body ' + f + '" data-id="' + t.id + '"><br></body></html>'; var v = 'javascript:(function(){document.open();document.domain="' + document.domain + '";var ed = window.parent.tinymce.get("' + t.id + '");document.write(ed.iframeHTML);document.close();ed.initContentBody(true);})()'; document.domain != location.hostname && (u = v); var y = k.create("iframe", { id: t.id + "_ifr", frameBorder: "0", allowTransparency: "true", title: t.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"), style: { width: "100%", height: o, display: "block"} }); if (y.onload = function () { y.onload = null, t.fire("load") }, k.setAttrib(y, "src", u || 'javascript:""'), t.contentAreaContainer = l.iframeContainer, t.iframeElement = y, s = k.add(l.iframeContainer, y), O) try { t.getDoc() } catch (b) { s.src = u = v } l.editorContainer && (k.get(l.editorContainer).style.display = t.orgDisplay, t.hidden = k.isHidden(l.editorContainer)), t.getElement().style.display = "none", k.setAttrib(t.id, "aria-hidden", !0), u || t.initContentBody(), r = s = l = null }, initContentBody: function (t) { var n = this, r = n.settings, s = n.getElement(), h = n.getDoc(), m, g; r.inline || (n.getElement().style.visibility = n.orgVisibility), t || r.content_editable || (h.open(), h.write(n.iframeHTML), h.close()), r.content_editable && (n.on("remove", function () { var e = this.getBody(); k.removeClass(e, "mce-content-body"), k.removeClass(e, "mce-edit-focus"), k.setAttrib(e, "contentEditable", null) }), k.addClass(s, "mce-content-body"), n.contentDocument = h = r.content_document || document, n.contentWindow = r.content_window || window, n.bodyElement = s, r.content_document = r.content_window = null, r.root_name = s.nodeName.toLowerCase()), m = n.getBody(), m.disabled = !0, r.readonly || (n.inline && "static" == k.getStyle(m, "position", !0) && (m.style.position = "relative"), m.contentEditable = n.getParam("content_editable_state", !0)), m.disabled = !1, n.schema = new y(r), n.dom = new e(h, { keep_values: !0, url_converter: n.convertURL, url_converter_scope: n, hex_colors: r.force_hex_style_colors, class_filter: r.class_filter, update_styles: !0, root_element: n.inline ? n.getBody() : null, collect: r.content_editable, schema: n.schema, onSetAttrib: function (e) { n.fire("SetAttrib", e) } }), n.parser = new b(r, n.schema), n.parser.addAttributeFilter("src,href,style,tabindex", function (e, t) { for (var r = e.length, i, o = n.dom, a, s; r--; ) i = e[r], a = i.attr(t), s = "data-mce-" + t, i.attributes.map[s] || ("style" === t ? (a = o.serializeStyle(o.parseStyle(a), i.name), a.length || (a = null), i.attr(s, a), i.attr(t, a)) : "tabindex" === t ? (i.attr(s, a), i.attr(t, null)) : i.attr(s, n.convertURL(a, t, i.name))) }), n.parser.addNodeFilter("script", function (e) { for (var t = e.length, n; t--; ) n = e[t], n.attr("type", "mce-" + (n.attr("type") || "no/type")) }), n.parser.addNodeFilter("#cdata", function (e) { for (var t = e.length, n; t--; ) n = e[t], n.type = 8, n.name = "#comment", n.value = "[CDATA[" + n.value + "]]" }), n.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div", function (e) { for (var t = e.length, r, i = n.schema.getNonEmptyElements(); t--; ) r = e[t], r.isEmpty(i) && (r.append(new o("br", 1)).shortEnded = !0) }), n.serializer = new a(r, n), n.selection = new l(n.dom, n.getWin(), n.serializer, n), n.formatter = new c(n), n.undoManager = new u(n), n.forceBlocks = new f(n), n.enterKey = new d(n), n.editorCommands = new p(n), n._nodeChangeDispatcher = new i(n), n.fire("PreInit"), r.browser_spellcheck || r.gecko_spellcheck || (h.body.spellcheck = !1, k.setAttrib(m, "spellcheck", "false")), n.fire("PostRender"), n.quirks = new C(n), r.directionality && (m.dir = r.directionality), r.nowrap && (m.style.whiteSpace = "nowrap"), r.protect && n.on("BeforeSetContent", function (e) { A(r.protect, function (t) { e.content = e.content.replace(t, function (e) { return "<!--mce:protected " + escape(e) + "-->" }) }) }), n.on("SetContent", function () { n.addVisual(n.getBody()) }), r.padd_empty_editor && n.on("PostProcess", function (e) { e.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/, "") }), n.load({ initial: !0, format: "html" }), n.startContent = n.getContent({ format: "raw" }), n.initialized = !0, n.bindPendingEventDelegates(), n.fire("init"), n.focus(!0), n.nodeChanged({ initial: !0 }), n.execCallback("init_instance_callback", n), n.contentStyles.length > 0 && (g = "", A(n.contentStyles, function (e) { g += e + "\r\n" }), n.dom.addStyle(g)), A(n.contentCSS, function (e) { n.loadedCSS[e] || (/*n.dom.loadCSS(e)*/true, n.loadedCSS[e] = !0) }), r.auto_focus && setTimeout(function () { var e; e = r.auto_focus === !0 ? n : n.editorManager.get(r.auto_focus), e.focus() }, 100), s = h = m = null }, focus: function (e) { var t = this, n = t.selection, r = t.settings.content_editable, i, o, a = t.getDoc(), s; if (!e) { if (i = n.getRng(), i.item && (o = i.item(0)), t._refreshContentEditable(), r || (x.opera || t.getBody().focus(), t.getWin().focus()), P || r) { if (s = t.getBody(), s.setActive) try { s.setActive() } catch (l) { s.focus() } else s.focus(); r && n.normalize() } o && o.ownerDocument == a && (i = a.body.createControlRange(), i.addElement(o), i.select()) } t.editorManager.setActive(t) }, execCallback: function (e) { var t = this, n = t.settings[e], r; if (n) return t.callbackLookup && (r = t.callbackLookup[e]) && (n = r.func, r = r.scope), "string" == typeof n && (r = n.replace(/\.\w+$/, ""), r = r ? H(r) : 0, n = H(n), t.callbackLookup = t.callbackLookup || {}, t.callbackLookup[e] = { func: n, scope: r }), n.apply(r || t, Array.prototype.slice.call(arguments, 1)) }, translate: function (e) { var t = this.settings.language || "en", n = this.editorManager.i18n; return e ? n.data[t + "." + e] || e.replace(/\{\#([^\}]+)\}/g, function (e, r) { return n.data[t + "." + r] || "{#" + r + "}" }) : "" }, getLang: function (e, n) { return this.editorManager.i18n.data[(this.settings.language || "en") + "." + e] || (n !== t ? n : "{#" + e + "}") }, getParam: function (e, t, n) { var r = e in this.settings ? this.settings[e] : t, i; return "hash" === n ? (i = {}, "string" == typeof r ? A(r.split(r.indexOf("=") > 0 ? /[;,](?![^=;,]*(?:[;,]|$))/ : ","), function (e) { e = e.split("="), i[L(e[0])] = L(e.length > 1 ? e[1] : e) }) : i = r, i) : r }, nodeChanged: function (e) { this._nodeChangeDispatcher.nodeChanged(e) }, addButton: function (e, t) { var n = this; t.cmd && (t.onclick = function () { n.execCommand(t.cmd) }), t.text || t.icon || (t.icon = e), n.buttons = n.buttons || {}, t.tooltip = t.tooltip || t.title, n.buttons[e] = t }, addMenuItem: function (e, t) { var n = this; t.cmd && (t.onclick = function () { n.execCommand(t.cmd) }), n.menuItems = n.menuItems || {}, n.menuItems[e] = t }, addCommand: function (e, t, n) { this.execCommands[e] = { func: t, scope: n || this} }, addQueryStateHandler: function (e, t, n) { this.queryStateCommands[e] = { func: t, scope: n || this} }, addQueryValueHandler: function (e, t, n) { this.queryValueCommands[e] = { func: t, scope: n || this} }, addShortcut: function (e, t, n, r) { this.shortcuts.add(e, t, n, r) }, execCommand: function (e, t, n, r) { var i = this, o = 0, a; if (/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(e) || r && r.skip_focus || i.focus(), r = R({}, r), r = i.fire("BeforeExecCommand", { command: e, ui: t, value: n }), r.isDefaultPrevented()) return !1; if ((a = i.execCommands[e]) && a.func.call(a.scope, t, n) !== !0) return i.fire("ExecCommand", { command: e, ui: t, value: n }), !0; if (A(i.plugins, function (r) { return r.execCommand && r.execCommand(e, t, n) ? (i.fire("ExecCommand", { command: e, ui: t, value: n }), o = !0, !1) : void 0 }), o) return o; if (i.theme && i.theme.execCommand && i.theme.execCommand(e, t, n)) return i.fire("ExecCommand", { command: e, ui: t, value: n }), !0; if (i.editorCommands.execCommand(e, t, n)) return i.fire("ExecCommand", { command: e, ui: t, value: n }), !0; try { o = i.getDoc().execCommand(e, t, n) } catch (s) { } return o ? (i.fire("ExecCommand", { command: e, ui: t, value: n }), !0) : !1 }, queryCommandState: function (e) { var t = this, n, r; if (!t._isHidden()) { if ((n = t.queryStateCommands[e]) && (r = n.func.call(n.scope), r === !0 || r === !1)) return r; if (r = t.editorCommands.queryCommandState(e), -1 !== r) return r; try { return t.getDoc().queryCommandState(e) } catch (i) { } } }, queryCommandValue: function (e) { var n = this, r, i; if (!n._isHidden()) { if ((r = n.queryValueCommands[e]) && (i = r.func.call(r.scope), i !== !0)) return i; if (i = n.editorCommands.queryCommandValue(e), i !== t) return i; try { return n.getDoc().queryCommandValue(e) } catch (o) { } } }, show: function () { var e = this; e.hidden && (e.hidden = !1, e.inline ? e.getBody().contentEditable = !0 : (k.show(e.getContainer()), k.hide(e.id)), e.load(), e.fire("show")) }, hide: function () { var e = this, t = e.getDoc(); e.hidden || (O && t && !e.inline && t.execCommand("SelectAll"), e.save(), e.inline ? (e.getBody().contentEditable = !1, e == e.editorManager.focusedEditor && (e.editorManager.focusedEditor = null)) : (k.hide(e.getContainer()), k.setStyle(e.id, "display", e.orgDisplay)), e.hidden = !0, e.fire("hide")) }, isHidden: function () { return !!this.hidden }, setProgressState: function (e, t) { this.fire("ProgressState", { state: e, time: t }) }, load: function (e) { var n = this, r = n.getElement(), i; return r ? (e = e || {}, e.load = !0, i = n.setContent(r.value !== t ? r.value : r.innerHTML, e), e.element = r, e.no_events || n.fire("LoadContent", e), e.element = r = null, i) : void 0 }, save: function (e) { var t = this, n = t.getElement(), r, i; if (n && t.initialized) return e = e || {}, e.save = !0, e.element = n, r = e.content = t.getContent(e), e.no_events || t.fire("SaveContent", e), r = e.content, /TEXTAREA|INPUT/i.test(n.nodeName) ? n.value = r : (t.inline || (n.innerHTML = r), (i = k.getParent(t.id, "form")) && A(i.elements, function (e) { return e.name == t.id ? (e.value = r, !1) : void 0 })), e.element = n = null, e.set_dirty !== !1 && (t.isNotDirty = !0), r }, setContent: function (e, t) { var n = this, r = n.getBody(), i; return t = t || {}, t.format = t.format || "html", t.set = !0, t.content = e, t.no_events || n.fire("BeforeSetContent", t), e = t.content, 0 === e.length || /^\s+$/.test(e) ? (i = n.settings.forced_root_block, i && n.schema.isValidChild(r.nodeName.toLowerCase(), i.toLowerCase()) ? (e = O && 11 > O ? "" : '<br data-mce-bogus="1">', e = n.dom.createHTML(i, n.settings.forced_root_block_attrs, e)) : O || (e = '<br data-mce-bogus="1">'), n.dom.setHTML(r, e), n.fire("SetContent", t)) : ("raw" !== t.format && (e = new s({}, n.schema).serialize(n.parser.parse(e, { isRootContent: !0 }))), t.content = L(e), n.dom.setHTML(r, t.content), t.no_events || n.fire("SetContent", t)), t.content }, getContent: function (e) { var t = this, n, r = t.getBody(); return e = e || {}, e.format = e.format || "html", e.get = !0, e.getInner = !0, e.no_events || t.fire("BeforeGetContent", e), n = "raw" == e.format ? r.innerHTML : "text" == e.format ? r.innerText || r.textContent : t.serializer.serialize(r, e), e.content = "text" != e.format ? L(n) : n, e.no_events || t.fire("GetContent", e), e.content }, insertContent: function (e, t) { t && (e = R({ content: e }, t)), this.execCommand("mceInsertContent", !1, e) }, isDirty: function () { return !this.isNotDirty }, getContainer: function () { var e = this; return e.container || (e.container = k.get(e.editorContainer || e.id + "_parent")), e.container }, getContentAreaContainer: function () { return this.contentAreaContainer }, getElement: function () { return this.targetElm || (this.targetElm = k.get(this.id)), this.targetElm }, getWin: function () { var e = this, t; return e.contentWindow || (t = e.iframeElement, t && (e.contentWindow = t.contentWindow)), e.contentWindow }, getDoc: function () { var e = this, t; return e.contentDocument || (t = e.getWin(), t && (e.contentDocument = t.document)), e.contentDocument }, getBody: function () { return this.bodyElement || this.getDoc().body }, convertURL: function (e, t, n) { var r = this, i = r.settings; return i.urlconverter_callback ? r.execCallback("urlconverter_callback", e, n, !0, t) : !i.convert_urls || n && "LINK" == n.nodeName || 0 === e.indexOf("file:") || 0 === e.length ? e : i.relative_urls ? r.documentBaseURI.toRelative(e) : e = r.documentBaseURI.toAbsolute(e, i.remove_script_host) }, addVisual: function (e) { var n = this, r = n.settings, i = n.dom, o; e = e || n.getBody(), n.hasVisual === t && (n.hasVisual = r.visual), A(i.select("table,a", e), function (e) { var t; switch (e.nodeName) { case "TABLE": return o = r.visual_table_class || "mce-item-table", t = i.getAttrib(e, "border"), void (t && "0" != t || !n.hasVisual ? i.removeClass(e, o) : i.addClass(e, o)); case "A": return void (i.getAttrib(e, "href", !1) || (t = i.getAttrib(e, "name") || e.id, o = r.visual_anchor_class || "mce-item-anchor", t && n.hasVisual ? i.addClass(e, o) : i.removeClass(e, o))) } }), n.fire("VisualAid", { element: e, hasVisual: n.hasVisual }) }, remove: function () { var e = this; e.removed || (e.save(), e.removed = 1, e.unbindAllNativeEvents(), e.hasHiddenInput && k.remove(e.getElement().nextSibling), e.inline || (O && 10 > O && e.getDoc().execCommand("SelectAll", !1, null), k.setStyle(e.id, "display", e.orgDisplay), e.getBody().onload = null), e.fire("remove"), e.editorManager.remove(e), k.remove(e.getContainer()), e.destroy()) }, destroy: function (e) { var t = this, n; if (!t.destroyed) { if (!e && !t.removed) return void t.remove(); e || (t.editorManager.off("beforeunload", t._beforeUnload), t.theme && t.theme.destroy && t.theme.destroy(), t.selection.destroy(), t.dom.destroy()), n = t.formElement, n && (n._mceOldSubmit && (n.submit = n._mceOldSubmit, n._mceOldSubmit = null), k.unbind(n, "submit reset", t.formEventDelegate)), t.contentAreaContainer = t.formElement = t.container = t.editorContainer = null, t.bodyElement = t.contentDocument = t.contentWindow = null, t.iframeElement = t.targetElm = null, t.selection && (t.selection = t.selection.win = t.selection.dom = t.selection.dom.doc = null), t.destroyed = 1 } }, _refreshContentEditable: function () { var e = this, t, n; e._isHidden() && (t = e.getBody(), n = t.parentNode, n.removeChild(t), n.appendChild(t), t.focus()) }, _isHidden: function () { var e; return P ? (e = this.selection.getSel(), !e || !e.rangeCount || 0 === e.rangeCount) : 0 } }, R(N.prototype, _), N }), r(ft, [], function () { var e = {}; return { rtl: !1, add: function (t, n) { for (var r in n) e[r] = n[r]; this.rtl = this.rtl || "rtl" === e._dir }, translate: function (t) { if ("undefined" == typeof t) return t; if ("string" != typeof t && t.raw) return t.raw; if (t.push) { var n = t.slice(1); t = (e[t[0]] || t[0]).replace(/\{([^\}]+)\}/g, function (e, t) { return n[t] }) } return e[t] || t }, data: e} }), r(pt, [y, d], function (e, t) { function n(e) { function s() { try { return document.activeElement } catch (e) { return document.body } } function l(e, t) { if (t && t.startContainer) { if (!e.isChildOf(t.startContainer, e.getRoot()) || !e.isChildOf(t.endContainer, e.getRoot())) return; return { startContainer: t.startContainer, startOffset: t.startOffset, endContainer: t.endContainer, endOffset: t.endOffset} } return t } function c(e, t) { var n; return t.startContainer ? (n = e.getDoc().createRange(), n.setStart(t.startContainer, t.startOffset), n.setEnd(t.endContainer, t.endOffset)) : n = t, n } function u(e) { return !!a.getParent(e, n.isEditorUIElement) } function d(n) { var d = n.editor; d.on("init", function () { (d.inline || t.ie) && ("onbeforedeactivate" in document && t.ie < 9 ? d.dom.bind(d.getBody(), "beforedeactivate", function (e) { if (e.target == d.getBody()) try { d.lastRng = d.selection.getRng() } catch (t) { } }) : d.on("nodechange mouseup keyup", function (e) { var t = s(); "nodechange" == e.type && e.selectionChange || (t && t.id == d.id + "_ifr" && (t = d.getBody()), d.dom.isChildOf(t, d.getBody()) && (d.lastRng = d.selection.getRng())) }), t.webkit && !r && (r = function () { var t = e.activeEditor; if (t && t.selection) { var n = t.selection.getRng(); n && !n.collapsed && (d.lastRng = n) } }, a.bind(document, "selectionchange", r))) }), d.on("setcontent", function () { d.lastRng = null }), d.on("mousedown", function () { d.selection.lastFocusBookmark = null }), d.on("focusin", function () { var t = e.focusedEditor; d.selection.lastFocusBookmark && (d.selection.setRng(c(d, d.selection.lastFocusBookmark)), d.selection.lastFocusBookmark = null), t != d && (t && t.fire("blur", { focusedEditor: d }), e.setActive(d), e.focusedEditor = d, d.fire("focus", { blurredEditor: t }), d.focus(!0)), d.lastRng = null }), d.on("focusout", function () { window.setTimeout(function () { var t = e.focusedEditor; u(s()) || t != d || (d.fire("blur", { focusedEditor: null }), e.focusedEditor = null, d.selection && (d.selection.lastFocusBookmark = null)) }, 0) }), i || (i = function (t) { var n = e.activeEditor; n && t.target.ownerDocument == document && (n.selection && t.target != n.getBody() && (n.selection.lastFocusBookmark = l(n.dom, n.lastRng)), t.target == document.body || u(t.target) || e.focusedEditor != n || (n.fire("blur", { focusedEditor: null }), e.focusedEditor = null)) }, a.bind(document, "focusin", i)), d.inline && !o && (o = function (t) { var n = e.activeEditor; if (n.inline && !n.dom.isChildOf(t.target, n.getBody())) { var r = n.selection.getRng(); r.collapsed || (n.lastRng = r) } }, a.bind(document, "mouseup", o)) } function f(t) { e.focusedEditor == t.editor && (e.focusedEditor = null), e.activeEditor || (a.unbind(document, "selectionchange", r), a.unbind(document, "focusin", i), a.unbind(document, "mouseup", o), r = i = o = null) } e.on("AddEditor", d), e.on("RemoveEditor", f) } var r, i, o, a = e.DOM; return n.isEditorUIElement = function (e) { return -1 !== e.className.toString().indexOf("mce-") }, n }), r(ht, [dt, f, y, V, d, u, lt, ft, pt], function (e, t, n, r, i, o, a, s, l) { function c(e) { var t = v.editors, n; delete t[e.id]; for (var r = 0; r < t.length; r++) if (t[r] == e) { t.splice(r, 1), n = !0; break } return v.activeEditor == e && (v.activeEditor = t[0]), v.focusedEditor == e && (v.focusedEditor = null), n } function u(e) { return e && !(e.getContainer() || e.getBody()).parentNode && (c(e), e.unbindAllNativeEvents(), e.destroy(!0), e = null), e } var d = n.DOM, f = o.explode, p = o.each, h = o.extend, m = 0, g, v; return v = { $: t, majorVersion: "4", minorVersion: "1.6", releaseDate: "2014-10-08", editors: [], i18n: s, activeEditor: null, setup: function () { var e = this, t, n, i = "", o, a; if (n = document.location.href, /^[^:]+:\/\/\/?[^\/]+\//.test(n) && (n = n.replace(/[\?#].*$/, "").replace(/[\/\\][^\/]+$/, ""), /[\/\\]$/.test(n) || (n += "/")), o = window.tinymce || window.tinyMCEPreInit) t = o.base || o.baseURL, i = o.suffix; else { for (var s = document.getElementsByTagName("script"), c = 0; c < s.length; c++) if (a = s[c].src, /tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(a)) { -1 != a.indexOf(".min") && (i = ".min"), t = a.substring(0, a.lastIndexOf("/")); break } !t && document.currentScript && (a = document.currentScript.src, -1 != a.indexOf(".min") && (i = ".min"), t = a.substring(0, a.lastIndexOf("/"))) } e.baseURL = new r(n).toAbsolute(t), e.documentBaseURL = n, e.baseURI = new r(e.baseURL), e.suffix = i, e.focusManager = new l(e) }, init: function (t) { function n(e) { var t = e.id; return t || (t = e.name, t = t && !d.get(t) ? e.name : d.uniqueId(), e.setAttribute("id", t)), t } function r(t, n, r) { if (!u(s.get(t))) { var i = new e(t, n, s); i.targetElm = i.targetElm || r, l.push(i), i.render() } } function i(e) { var n = t[e]; if (n) return n.apply(s, Array.prototype.slice.call(arguments, 2)) } function o(e, t) { return t.constructor === RegExp ? t.test(e.className) : d.hasClass(e, t) } function a() { var e, s; if (d.unbind(window, "ready", a), i("onpageload"), t.types) return void p(t.types, function (e) { p(d.select(e.selector), function (i) { r(n(i), h({}, t, e), i) }) }); if (t.selector) return void p(d.select(t.selector), function (e) { r(n(e), t, e) }); switch (t.target && r(n(t.target), t), t.mode) { case "exact": e = t.elements || "", e.length > 0 && p(f(e), function (e) { var n; (n = d.get(e)) ? r(e, t, n) : p(document.forms, function (n) { p(n.elements, function (n) { n.name === e && (e = "mce_editor_" + m++, d.setAttrib(n, "id", e), r(e, t, n)) }) }) }); break; case "textareas": case "specific_textareas": p(d.select("textarea"), function (e) { t.editor_deselector && o(e, t.editor_deselector) || (!t.editor_selector || o(e, t.editor_selector)) && r(n(e), t, e) }) } t.oninit && (e = s = 0, p(l, function (t) { s++, t.initialized ? e++ : t.on("init", function () { e++, e == s && i("oninit") }), e == s && i("oninit") })) } var s = this, l = []; s.settings = t, d.bind(window, "ready", a) }, get: function (e) { return arguments.length ? e in this.editors ? this.editors[e] : null : this.editors }, add: function (e) { var t = this, n = t.editors; return n[e.id] = e, n.push(e), t.activeEditor = e, t.fire("AddEditor", { editor: e }), g || (g = function () { t.fire("BeforeUnload") }, d.bind(window, "beforeunload", g)), e }, createEditor: function (t, n) { return this.add(new e(t, n, this)) }, remove: function (e) { var t = this, n, r = t.editors, i; { if (e) return "string" == typeof e ? (e = e.selector || e, void p(d.select(e), function (e) { i = r[e.id], i && t.remove(i) })) : (i = e, r[i.id] ? (c(i) && t.fire("RemoveEditor", { editor: i }), r.length || d.unbind(window, "beforeunload", g), i.remove(), i) : null); for (n = r.length - 1; n >= 0; n--) t.remove(r[n]) } }, execCommand: function (t, n, r) { var i = this, o = i.get(r); switch (t) { case "mceAddEditor": return i.get(r) || new e(r, i.settings, i).render(), !0; case "mceRemoveEditor": return o && o.remove(), !0; case "mceToggleEditor": return o ? (o.isHidden() ? o.show() : o.hide(), !0) : (i.execCommand("mceAddEditor", 0, r), !0) } return i.activeEditor ? i.activeEditor.execCommand(t, n, r) : !1 }, triggerSave: function () { p(this.editors, function (e) { e.save() }) }, addI18n: function (e, t) { s.add(e, t) }, translate: function (e) { return s.translate(e) }, setActive: function (e) { var t = this.activeEditor; this.activeEditor != e && (t && t.fire("deactivate", { relatedTarget: e }), e.fire("activate", { relatedTarget: t })), this.activeEditor = e } }, h(v, a), v.setup(), window.tinymce = window.tinyMCE = v, v }), r(mt, [ht, u], function (e, t) { var n = t.each, r = t.explode; e.on("AddEditor", function (e) { var t = e.editor; t.on("preInit", function () { function e(e, t) { n(t, function (t, n) { t && s.setStyle(e, n, t) }), s.rename(e, "span") } function i(e) { s = t.dom, l.convert_fonts_to_spans && n(s.select("font,u,strike", e.node), function (e) { o[e.nodeName.toLowerCase()](s, e) }) } var o, a, s, l = t.settings; l.inline_styles && (a = r(l.font_size_legacy_values), o = { font: function (t, n) { e(n, { backgroundColor: n.style.backgroundColor, color: n.color, fontFamily: n.face, fontSize: a[parseInt(n.size, 10) - 1] }) }, u: function (t, n) { e(n, { textDecoration: "underline" }) }, strike: function (t, n) { e(n, { textDecoration: "line-through" }) } }, t.on("PreProcess SetContent", i)) }) }) }), r(gt, [lt, u], function (e, t) { var n = { send: function (e) { function t() { !e.async || 4 == r.readyState || i++ > 1e4 ? (e.success && 1e4 > i && 200 == r.status ? e.success.call(e.success_scope, "" + r.responseText, r, e) : e.error && e.error.call(e.error_scope, i > 1e4 ? "TIMED_OUT" : "GENERAL", r, e), r = null) : setTimeout(t, 10) } var r, i = 0; if (e.scope = e.scope || this, e.success_scope = e.success_scope || e.scope, e.error_scope = e.error_scope || e.scope, e.async = e.async === !1 ? !1 : !0, e.data = e.data || "", r = new XMLHttpRequest) { if (r.overrideMimeType && r.overrideMimeType(e.content_type), r.open(e.type || (e.data ? "POST" : "GET"), e.url, e.async), e.crossDomain && (r.withCredentials = !0), e.content_type && r.setRequestHeader("Content-Type", e.content_type), r.setRequestHeader("X-Requested-With", "XMLHttpRequest"), r = n.fire("beforeSend", { xhr: r, settings: e }).xhr, r.send(e.data), !e.async) return t(); setTimeout(t, 10) } } }; return t.extend(n, e), n }), r(vt, [], function () { function e(t, n) { var r, i, o, a; if (n = n || '"', null === t) return "null"; if (o = typeof t, "string" == o) return i = "\bb	t\nn\ff\rr\"\"''\\\\", n + t.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g, function (e, t) { return '"' === n && "'" === e ? e : (r = i.indexOf(t), r + 1 ? "\\" + i.charAt(r + 1) : (e = t.charCodeAt().toString(16), "\\u" + "0000".substring(e.length) + e)) }) + n; if ("object" == o) { if (t.hasOwnProperty && "[object Array]" === Object.prototype.toString.call(t)) { for (r = 0, i = "["; r < t.length; r++) i += (r > 0 ? "," : "") + e(t[r], n); return i + "]" } i = "{"; for (a in t) t.hasOwnProperty(a) && (i += "function" != typeof t[a] ? (i.length > 1 ? "," + n : n) + a + n + ":" + e(t[a], n) : ""); return i + "}" } return "" + t } return { serialize: e, parse: function (e) { try { return window[String.fromCharCode(101) + "val"]("(" + e + ")") } catch (t) { } } } }), r(yt, [vt, gt, u], function (e, t, n) { function r(e) { this.settings = i({}, e), this.count = 0 } var i = n.extend; return r.sendRPC = function (e) { return (new r).send(e) }, r.prototype = { send: function (n) { var r = n.error, o = n.success; n = i(this.settings, n), n.success = function (t, i) { t = e.parse(t), "undefined" == typeof t && (t = { error: "JSON Parse error." }), t.error ? r.call(n.error_scope || n.scope, t.error, i) : o.call(n.success_scope || n.scope, t.result) }, n.error = function (e, t) { r && r.call(n.error_scope || n.scope, e, t) }, n.data = e.serialize({ id: n.id || "c" + this.count++, method: n.method, params: n.params }), n.content_type = "application/json", t.send(n) } }, r }), r(bt, [y], function (e) { return { callbacks: {}, count: 0, send: function (n) { var r = this, i = e.DOM, o = n.count !== t ? n.count : r.count, a = "tinymce_jsonp_" + o; r.callbacks[o] = function (e) { i.remove(a), delete r.callbacks[o], n.callback(e) }, i.add(i.doc.body, "script", { id: a, src: n.url, type: "text/javascript" }), r.count++ } } }), r(Ct, [], function () { function e() { s = []; for (var e in a) s.push(e); i.length = s.length } function n() { function n(e) { var n, r; return r = e !== t ? u + e : i.indexOf(",", u), -1 === r || r > i.length ? null : (n = i.substring(u, r), u = r + 1, n) } var r, i, s, u = 0; if (a = {}, c) { o.load(l), i = o.getAttribute(l) || ""; do { var d = n(); if (null === d) break; if (r = n(parseInt(d, 32) || 0), null !== r) { if (d = n(), null === d) break; s = n(parseInt(d, 32) || 0), r && (a[r] = s) } } while (null !== r); e() } } function r() { var t, n = ""; if (c) { for (var r in a) t = a[r], n += (n ? "," : "") + r.length.toString(32) + "," + r + "," + t.length.toString(32) + "," + t; o.setAttribute(l, n); try { o.save(l) } catch (i) { } e() } } var i, o, a, s, l, c; try { if (window.localStorage) return localStorage } catch (u) { } return l = "tinymce", o = document.documentElement, c = !!o.addBehavior, c && o.addBehavior("#default#userData"), i = { key: function (e) { return s[e] }, getItem: function (e) { return e in a ? a[e] : null }, setItem: function (e, t) { a[e] = "" + t, r() }, removeItem: function (e) { delete a[e], r() }, clear: function () { a = {}, r() } }, n(), i }), r(xt, [y, l, b, C, u, d], function (e, t, n, r, i, o) { var a = window.tinymce; return a.DOM = e.DOM, a.ScriptLoader = n.ScriptLoader, a.PluginManager = r.PluginManager, a.ThemeManager = r.ThemeManager, a.dom = a.dom || {}, a.dom.Event = t.Event, i.each(i, function (e, t) { a[t] = e }), i.each("isOpera isWebKit isIE isGecko isMac".split(" "), function (e) { a[e] = o[e.substr(2).toLowerCase()] }), {} }), r(wt, [U, u], function (e, t) { return e.extend({ Defaults: { firstControlClass: "first", lastControlClass: "last" }, init: function (e) { this.settings = t.extend({}, this.Defaults, e) }, preRender: function (e) { e.addClass(this.settings.containerClass, "body") }, applyClasses: function (e) { var t = this, n = t.settings, r, i, o; r = e.items().filter(":visible"), i = n.firstControlClass, o = n.lastControlClass, r.each(function (e) { e.removeClass(i).removeClass(o), n.controlClass && e.addClass(n.controlClass) }), r.eq(0).addClass(i), r.eq(-1).addClass(o) }, renderHtml: function (e) { var t = this, n = t.settings, r, i = ""; return r = e.items(), r.eq(0).addClass(n.firstControlClass), r.eq(-1).addClass(n.lastControlClass), r.each(function (e) { n.controlClass && e.addClass(n.controlClass), i += e.renderHtml() }), i }, recalc: function () { }, postRender: function () { } }) }), r(_t, [wt], function (e) { return e.extend({ Defaults: { containerClass: "abs-layout", controlClass: "abs-layout-item" }, recalc: function (e) { e.items().filter(":visible").each(function (e) { var t = e.settings; e.layoutRect({ x: t.x, y: t.y, w: t.w, h: t.h }), e.recalc && e.recalc() }) }, renderHtml: function (e) { return '<div id="' + e._id + '-absend" class="' + e.classPrefix + 'abs-end"></div>' + this._super(e) } }) }), r(Et, [K, tt], function (e, t) { return e.extend({ Mixins: [t], Defaults: { classes: "widget tooltip tooltip-n" }, text: function (e) { var t = this; return "undefined" != typeof e ? (t._value = e, t._rendered && (t.getEl().lastChild.innerHTML = t.encode(e)), t) : t._value }, renderHtml: function () { var e = this, t = e.classPrefix; return '<div id="' + e._id + '" class="' + e.classes() + '" role="presentation"><div class="' + t + 'tooltip-arrow"></div><div class="' + t + 'tooltip-inner">' + e.encode(e._text) + "</div></div>" }, repaint: function () { var e = this, t, n; t = e.getEl().style, n = e._layoutRect, t.left = n.x + "px", t.top = n.y + "px", t.zIndex = 131070 } }) }), r(Nt, [K, Et], function (e, t) { var n, r = e.extend({ init: function (e) { var t = this; t._super(e), e = t.settings, t.canFocus = !0, e.tooltip && r.tooltips !== !1 && (t.on("mouseenter", function (n) { var r = t.tooltip().moveTo(-65535); if (n.control == t) { var i = r.text(e.tooltip).show().testMoveRel(t.getEl(), ["bc-tc", "bc-tl", "bc-tr"]); r.toggleClass("tooltip-n", "bc-tc" == i), r.toggleClass("tooltip-nw", "bc-tl" == i), r.toggleClass("tooltip-ne", "bc-tr" == i), r.moveRel(t.getEl(), i) } else r.hide() }), t.on("mouseleave mousedown click", function () { t.tooltip().hide() })), t.aria("label", e.ariaLabel || e.tooltip) }, tooltip: function () { return n || (n = new t({ type: "tooltip" }), n.renderTo()), n }, active: function (e) { var t = this, n; return e !== n && (t.aria("pressed", e), t.toggleClass("active", e)), t._super(e) }, disabled: function (e) { var t = this, n; return e !== n && (t.aria("disabled", e), t.toggleClass("disabled", e)), t._super(e) }, postRender: function () { var e = this, t = e.settings; e._rendered = !0, e._super(), e.parent() || !t.width && !t.height || (e.initLayoutRect(), e.repaint()), t.autofocus && e.focus() }, remove: function () { this._super(), n && (n.remove(), n = null) } }); return r }), r(kt, [Nt], function (e) { return e.extend({ Defaults: { classes: "widget btn", role: "button" }, init: function (e) { var t = this, n; t.on("click mousedown", function (e) { e.preventDefault() }), t._super(e), n = e.size, e.subtype && t.addClass(e.subtype), n && t.addClass("btn-" + n) }, icon: function (e) { var t = this, n = t.classPrefix; if ("undefined" == typeof e) return t.settings.icon; if (t.settings.icon = e, e = e ? n + "ico " + n + "i-" + t.settings.icon : "", t._rendered) { var r = t.getEl().firstChild, i = r.getElementsByTagName("i")[0]; e ? (i && i == r.firstChild || (i = document.createElement("i"), r.insertBefore(i, r.firstChild)), i.className = e) : i && r.removeChild(i), t.text(t._text) } return t }, repaint: function () { var e = this.getEl().firstChild.style; e.width = e.height = "100%", this._super() }, text: function (e) { var t = this; if (t._rendered) { var n = t.getEl().lastChild.lastChild; n && (n.data = t.translate(e)) } return t._super(e) }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix, r = e.settings.icon, i; return i = e.settings.image, i ? (r = "none", "string" != typeof i && (i = window.getSelection ? i[0] : i[1]), i = " style=\"background-image: url('" + i + "')\"") : i = "", r = e.settings.icon ? n + "ico " + n + "i-" + r : "", '<div id="' + t + '" class="' + e.classes() + '" tabindex="-1" aria-labelledby="' + t + '"><button role="presentation" type="button" tabindex="-1">' + (r ? '<i class="' + r + '"' + i + "></i>" : "") + (e._text ? (r ? "\xa0" : "") + e.encode(e._text) : "") + "</button></div>" } }) }), r(St, [J], function (e) { return e.extend({ Defaults: { defaultType: "button", role: "group" }, renderHtml: function () { var e = this, t = e._layout; return e.addClass("btn-group"), e.preRender(), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes() + '"><div id="' + e._id + '-body">' + (e.settings.html || "") + t.renderHtml(e) + "</div></div>" } }) }), r(Tt, [Nt], function (e) { return e.extend({ Defaults: { classes: "checkbox", role: "checkbox", checked: !1 }, init: function (e) { var t = this; t._super(e), t.on("click mousedown", function (e) { e.preventDefault() }), t.on("click", function (e) { e.preventDefault(), t.disabled() || t.checked(!t.checked()) }), t.checked(t.settings.checked) }, checked: function (e) { var t = this; return "undefined" != typeof e ? (e ? t.addClass("checked") : t.removeClass("checked"), t._checked = e, t.aria("checked", e), t) : t._checked }, value: function (e) { return this.checked(e) }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix; return '<div id="' + t + '" class="' + e.classes() + '" unselectable="on" aria-labelledby="' + t + '-al" tabindex="-1"><i class="' + n + "ico " + n + 'i-checkbox"></i><span id="' + t + '-al" class="' + n + 'label">' + e.encode(e._text) + "</span></div>" } }) }), r(Rt, [Nt, G, Y], function (e, t, n) { return e.extend({ init: function (e) { var t = this; t._super(e), t.addClass("combobox"), t.subinput = !0, t.ariaTarget = "inp", e = t.settings, e.menu = e.menu || e.values, e.menu && (e.icon = "caret"), t.on("click", function (n) { for (var r = n.target, i = t.getEl(); r && r != i; ) r.id && -1 != r.id.indexOf("-open") && (t.fire("action"), e.menu && (t.showMenu(), n.aria && t.menu.items()[0].focus())), r = r.parentNode }), t.on("keydown", function (e) { "INPUT" == e.target.nodeName && 13 == e.keyCode && t.parents().reverse().each(function (n) { return e.preventDefault(), t.fire("change"), n.hasEventListeners("submit") && n.toJSON ? (n.fire("submit", { data: n.toJSON() }), !1) : void 0 }) }), e.placeholder && (t.addClass("placeholder"), t.on("focusin", function () { t._hasOnChange || (n.on(t.getEl("inp"), "change", function () { t.fire("change") }), t._hasOnChange = !0), t.hasClass("placeholder") && (t.getEl("inp").value = "", t.removeClass("placeholder")) }), t.on("focusout", function () { 0 === t.value().length && (t.getEl("inp").value = e.placeholder, t.addClass("placeholder")) })) }, showMenu: function () { var e = this, n = e.settings, r; e.menu || (r = n.menu || [], r.length ? r = { type: "menu", items: r} : r.type = r.type || "menu", e.menu = t.create(r).parent(e).renderTo(e.getContainerElm()), e.fire("createmenu"), e.menu.reflow(), e.menu.on("cancel", function (t) { t.control === e.menu && e.focus() }), e.menu.on("show hide", function (t) { t.control.items().each(function (t) { t.active(t.value() == e.value()) }) }).fire("show"), e.menu.on("select", function (t) { e.value(t.control.value()) }), e.on("focusin", function (t) { "INPUT" == t.target.tagName.toUpperCase() && e.menu.hide() }), e.aria("expanded", !0)), e.menu.show(), e.menu.layoutRect({ w: e.layoutRect().w }), e.menu.moveRel(e.getEl(), e.isRtl() ? ["br-tr", "tr-br"] : ["bl-tl", "tl-bl"]) }, value: function (e) { var t = this; return "undefined" != typeof e ? (t._value = e, t.removeClass("placeholder"), t._rendered && (t.getEl("inp").value = e), t) : t._rendered ? (e = t.getEl("inp").value, e != t.settings.placeholder ? e : "") : t._value }, disabled: function (e) { var t = this; return t._rendered && "undefined" != typeof e && (t.getEl("inp").disabled = e), t._super(e) }, focus: function () { this.getEl("inp").focus() }, repaint: function () { var e = this, t = e.getEl(), r = e.getEl("open"), i = e.layoutRect(), o, a; o = r ? i.w - n.getSize(r).width - 10 : i.w - 10; var s = document; return s.all && (!s.documentMode || s.documentMode <= 8) && (a = e.layoutRect().h - 2 + "px"), n.css(t.firstChild, { width: o, lineHeight: a }), e._super(), e }, postRender: function () { var e = this; return n.on(this.getEl("inp"), "change", function () { e.fire("change") }), e._super() }, remove: function () { n.off(this.getEl("inp")), this._super() }, renderHtml: function () { var e = this, t = e._id, n = e.settings, r = e.classPrefix, i = n.value || n.placeholder || "", o, a, s = "", l = ""; return "spellcheck" in n && (l += ' spellcheck="' + n.spellcheck + '"'), n.maxLength && (l += ' maxlength="' + n.maxLength + '"'), n.size && (l += ' size="' + n.size + '"'), n.subtype && (l += ' type="' + n.subtype + '"'), e.disabled() && (l += ' disabled="disabled"'), o = n.icon, o && "caret" != o && (o = r + "ico " + r + "i-" + n.icon), a = e._text, (o || a) && (s = '<div id="' + t + '-open" class="' + r + "btn " + r + 'open" tabIndex="-1" role="button"><button id="' + t + '-action" type="button" hidefocus="1" tabindex="-1">' + ("caret" != o ? '<i class="' + o + '"></i>' : '<i class="' + r + 'caret"></i>') + (a ? (o ? " " : "") + a : "") + "</button></div>", e.addClass("has-open")), '<div id="' + t + '" class="' + e.classes() + '"><input id="' + t + '-inp" class="' + r + "textbox " + r + 'placeholder" value="' + i + '" hidefocus="1"' + l + " />" + s + "</div>" } }) }), r(At, [Rt], function (e) { return e.extend({ init: function (e) { var t = this; e.spellcheck = !1, e.onaction && (e.icon = "none"), t._super(e), t.addClass("colorbox"), t.on("change keyup postrender", function () { t.repaintColor(t.value()) }) }, repaintColor: function (e) { var t = this.getEl().getElementsByTagName("i")[0]; if (t) try { t.style.background = e } catch (n) { } }, value: function (e) { var t = this; return "undefined" != typeof e && t._rendered && t.repaintColor(e), t._super(e) } }) }), r(Bt, [kt, rt], function (e, t) { return e.extend({ showPanel: function () { var e = this, n = e.settings; if (e.active(!0), e.panel) e.panel.show(); else { var r = n.panel; r.type && (r = { layout: "grid", items: r }), r.role = r.role || "dialog", r.popover = !0, r.autohide = !0, r.ariaRoot = !0, e.panel = new t(r).on("hide", function () { e.active(!1) }).on("cancel", function (t) { t.stopPropagation(), e.focus(), e.hidePanel() }).parent(e).renderTo(e.getContainerElm()), e.panel.fire("show"), e.panel.reflow() } e.panel.moveRel(e.getEl(), n.popoverAlign || (e.isRtl() ? ["bc-tr", "bc-tc"] : ["bc-tl", "bc-tc"])) }, hidePanel: function () { var e = this; e.panel && e.panel.hide() }, postRender: function () { var e = this; return e.aria("haspopup", !0), e.on("click", function (t) { t.control === e && (e.panel && e.panel.visible() ? e.hidePanel() : (e.showPanel(), e.panel.focus(!!t.aria))) }), e._super() }, remove: function () { return this.panel && (this.panel.remove(), this.panel = null), this._super() } }) }), r(Dt, [Bt, y], function (e, t) { var n = t.DOM; return e.extend({ init: function (e) { this._super(e), this.addClass("colorbutton") }, color: function (e) { return e ? (this._color = e, this.getEl("preview").style.backgroundColor = e, this) : this._color }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix, r = e.settings.icon ? n + "ico " + n + "i-" + e.settings.icon : "", i = e.settings.image ? " style=\"background-image: url('" + e.settings.image + "')\"" : ""; return '<div id="' + t + '" class="' + e.classes() + '" role="button" tabindex="-1" aria-haspopup="true"><button role="presentation" hidefocus="1" type="button" tabindex="-1">' + (r ? '<i class="' + r + '"' + i + "></i>" : "") + '<span id="' + t + '-preview" class="' + n + 'preview"></span>' + (e._text ? (r ? " " : "") + e._text : "") + '</button><button type="button" class="' + n + 'open" hidefocus="1" tabindex="-1"> <i class="' + n + 'caret"></i></button></div>' }, postRender: function () { var e = this, t = e.settings.onclick; return e.on("click", function (r) { r.aria && "down" == r.aria.key || r.control != e || n.getParent(r.target, "." + e.classPrefix + "open") || (r.stopImmediatePropagation(), t.call(e, r)) }), delete e.settings.onclick, e._super() } }) }), r(Lt, [], function () { function e(e) { function i(e, i, o) { var a, s, l, c, u, d; return a = 0, s = 0, l = 0, e /= 255, i /= 255, o /= 255, u = t(e, t(i, o)), d = n(e, n(i, o)), u == d ? (l = u, { h: 0, s: 0, v: 100 * l }) : (c = e == u ? i - o : o == u ? e - i : o - e, a = e == u ? 3 : o == u ? 1 : 5, a = 60 * (a - c / (d - u)), s = (d - u) / d, l = d, { h: r(a), s: r(100 * s), v: r(100 * l) }) } function o(e, i, o) { var a, s, l, c; if (e = (parseInt(e, 10) || 0) % 360, i = parseInt(i, 10) / 100, o = parseInt(o, 10) / 100, i = n(0, t(i, 1)), o = n(0, t(o, 1)), 0 === i) return void (d = f = p = r(255 * o)); switch (a = e / 60, s = o * i, l = s * (1 - Math.abs(a % 2 - 1)), c = o - s, Math.floor(a)) { case 0: d = s, f = l, p = 0; break; case 1: d = l, f = s, p = 0; break; case 2: d = 0, f = s, p = l; break; case 3: d = 0, f = l, p = s; break; case 4: d = l, f = 0, p = s; break; case 5: d = s, f = 0, p = l; break; default: d = f = p = 0 } d = r(255 * (d + c)), f = r(255 * (f + c)), p = r(255 * (p + c)) } function a() { function e(e) { return e = parseInt(e, 10).toString(16), e.length > 1 ? e : "0" + e } return "#" + e(d) + e(f) + e(p) } function s() { return { r: d, g: f, b: p} } function l() { return i(d, f, p) } function c(e) { var t; return "object" == typeof e ? "r" in e ? (d = e.r, f = e.g, p = e.b) : "v" in e && o(e.h, e.s, e.v) : (t = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(e)) ? (d = parseInt(t[1], 10), f = parseInt(t[2], 10), p = parseInt(t[3], 10)) : (t = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(e)) ? (d = parseInt(t[1], 16), f = parseInt(t[2], 16), p = parseInt(t[3], 16)) : (t = /#([0-F])([0-F])([0-F])/gi.exec(e)) && (d = parseInt(t[1] + t[1], 16), f = parseInt(t[2] + t[2], 16), p = parseInt(t[3] + t[3], 16)), d = 0 > d ? 0 : d > 255 ? 255 : d, f = 0 > f ? 0 : f > 255 ? 255 : f, p = 0 > p ? 0 : p > 255 ? 255 : p, u } var u = this, d = 0, f = 0, p = 0; e && c(e), u.toRgb = s, u.toHsv = l, u.toHex = a, u.parse = c } var t = Math.min, n = Math.max, r = Math.round; return e }), r(Ht, [Nt, Q, Y, Lt], function (e, t, n, r) { return e.extend({ Defaults: { classes: "widget colorpicker" }, init: function (e) { this._super(e) }, postRender: function () { function e(e, t) { var r = n.getPos(e), i, o; return i = t.pageX - r.x, o = t.pageY - r.y, i = Math.max(0, Math.min(i / e.clientWidth, 1)), o = Math.max(0, Math.min(o / e.clientHeight, 1)), { x: i, y: o} } function i(e, t) { var i = (360 - e.h) / 360; n.css(d, { top: 100 * i + "%" }), t || n.css(p, { left: e.s + "%", top: 100 - e.v + "%" }), f.style.background = new r({ s: 100, v: 100, h: e.h }).toHex(), s.color().parse({ s: e.s, v: e.v, h: e.h }) } function o(t) { var n; n = e(f, t), c.s = 100 * n.x, c.v = 100 * (1 - n.y), i(c), s.fire("change") } function a(t) { var n; n = e(u, t), c = l.toHsv(), c.h = 360 * (1 - n.y), i(c, !0), s.fire("change") } var s = this, l = s.color(), c, u, d, f, p; u = s.getEl("h"), d = s.getEl("hp"), f = s.getEl("sv"), p = s.getEl("svp"), s._repaint = function () { c = l.toHsv(), i(c) }, s._super(), s._svdraghelper = new t(s._id + "-sv", { start: o, drag: o }), s._hdraghelper = new t(s._id + "-h", { start: a, drag: a }), s._repaint() }, rgb: function () { return this.color().toRgb() }, value: function (e) { var t = this; return arguments.length ? (t.color().parse(e), void (t._rendered && t._repaint())) : t.color().toHex() }, color: function () { return this._color || (this._color = new r), this._color }, renderHtml: function () { function e() { var e, t, n = "", i, a; for (i = "filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=", a = o.split(","), e = 0, t = a.length - 1; t > e; e++) n += '<div class="' + r + 'colorpicker-h-chunk" style="height:' + 100 / t + "%;" + i + a[e] + ",endColorstr=" + a[e + 1] + ");-ms-" + i + a[e] + ",endColorstr=" + a[e + 1] + ')"></div>'; return n } var t = this, n = t._id, r = t.classPrefix, i, o = "#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000", a = "background: -ms-linear-gradient(top," + o + ");background: linear-gradient(to bottom," + o + ");"; return i = '<div id="' + n + '-h" class="' + r + 'colorpicker-h" style="' + a + '">' + e() + '<div id="' + n + '-hp" class="' + r + 'colorpicker-h-marker"></div></div>', '<div id="' + n + '" class="' + t.classes() + '"><div id="' + n + '-sv" class="' + r + 'colorpicker-sv"><div class="' + r + 'colorpicker-overlay1"><div class="' + r + 'colorpicker-overlay2"><div id="' + n + '-svp" class="' + r + 'colorpicker-selector1"><div class="' + r + 'colorpicker-selector2"></div></div></div></div></div>' + i + "</div>" } }) }), r(Mt, [Nt], function (e) { return e.extend({ init: function (e) { var t = this; e.delimiter || (e.delimiter = "\xbb"), t._super(e), t.addClass("path"), t.canFocus = !0, t.on("click", function (e) { var n, r = e.target; (n = r.getAttribute("data-index")) && t.fire("select", { value: t.data()[n], index: n }) }) }, focus: function () { var e = this; return e.getEl().firstChild.focus(), e }, data: function (e) { var t = this; return "undefined" != typeof e ? (t._data = e, t.update(), t) : t._data }, update: function () { this.innerHtml(this._getPathHtml()) }, postRender: function () { var e = this; e._super(), e.data(e.settings.data) }, renderHtml: function () { var e = this; return '<div id="' + e._id + '" class="' + e.classes() + '">' + e._getPathHtml() + "</div>" }, _getPathHtml: function () { var e = this, t = e._data || [], n, r, i = "", o = e.classPrefix; for (n = 0, r = t.length; r > n; n++) i += (n > 0 ? '<div class="' + o + 'divider" aria-hidden="true"> ' + e.settings.delimiter + " </div>" : "") + '<div role="button" class="' + o + "path-item" + (n == r - 1 ? " " + o + "last" : "") + '" data-index="' + n + '" tabindex="-1" id="' + e._id + "-" + n + '" aria-level="' + n + '">' + t[n].name + "</div>"; return i || (i = '<div class="' + o + 'path-item">\xa0</div>'), i } }) }), r(Pt, [Mt, ht], function (e, t) { return e.extend({ postRender: function () { function e(e) { if (1 === e.nodeType) { if ("BR" == e.nodeName || e.getAttribute("data-mce-bogus")) return !0; if ("bookmark" === e.getAttribute("data-mce-type")) return !0 } return !1 } var n = this, r = t.activeEditor; return n.on("select", function (e) { r.focus(), r.selection.select(this.data()[e.index].element), r.nodeChanged() }), r.on("nodeChange", function (t) { for (var i = [], o = t.parents, a = o.length; a--; ) if (1 == o[a].nodeType && !e(o[a])) { var s = r.fire("ResolveName", { name: o[a].nodeName.toLowerCase(), target: o[a] }); if (s.isDefaultPrevented() || i.push({ name: s.name, element: o[a] }), s.isPropagationStopped()) break } n.data(i) }), n._super() } }) }), r(Ot, [J], function (e) { return e.extend({ Defaults: { layout: "flex", align: "center", defaults: { flex: 1} }, renderHtml: function () { var e = this, t = e._layout, n = e.classPrefix; return e.addClass("formitem"), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1">' + (e.settings.title ? '<div id="' + e._id + '-title" class="' + n + 'title">' + e.settings.title + "</div>" : "") + '<div id="' + e._id + '-body" class="' + e.classes("body") + '">' + (e.settings.html || "") + t.renderHtml(e) + "</div></div>" } }) }), r(It, [J, Ot, u], function (e, t, n) { return e.extend({ Defaults: { containerCls: "form", layout: "flex", direction: "column", align: "stretch", flex: 1, padding: 20, labelGap: 30, spacing: 10, callbacks: { submit: function () { this.submit() } } }, preRender: function () { var e = this, r = e.items(); e.settings.formItemDefaults || (e.settings.formItemDefaults = { layout: "flex", autoResize: "overflow", defaults: { flex: 1} }), r.each(function (r) { var i, o = r.settings.label; o && (i = new t(n.extend({ items: { type: "label", id: r._id + "-l", text: o, flex: 0, forId: r._id, disabled: r.disabled()} }, e.settings.formItemDefaults)), i.type = "formitem", r.aria("labelledby", r._id + "-l"), "undefined" == typeof r.settings.flex && (r.settings.flex = 1), e.replace(r, i), i.add(r)) }) }, recalcLabels: function () { var e = this, t = 0, n = [], r, i, o; if (e.settings.labelGapCalc !== !1) for (o = "children" == e.settings.labelGapCalc ? e.find("formitem") : e.items(), o.filter("formitem").each(function (e) { var r = e.items()[0], i = r.getEl().clientWidth; t = i > t ? i : t, n.push(r) }), i = e.settings.labelGap || 0, r = n.length; r--; ) n[r].settings.minWidth = t + i }, visible: function (e) { var t = this._super(e); return e === !0 && this._rendered && this.recalcLabels(), t }, submit: function () { return this.fire("submit", { data: this.toJSON() }) }, postRender: function () { var e = this; e._super(), e.recalcLabels(), e.fromJSON(e.settings.data) } }) }), r(Ft, [It], function (e) { return e.extend({ Defaults: { containerCls: "fieldset", layout: "flex", direction: "column", align: "stretch", flex: 1, padding: "25 15 5 15", labelGap: 30, spacing: 10, border: 1 }, renderHtml: function () { var e = this, t = e._layout, n = e.classPrefix; return e.preRender(), t.preRender(e), '<fieldset id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1">' + (e.settings.title ? '<legend id="' + e._id + '-title" class="' + n + 'fieldset-title">' + e.settings.title + "</legend>" : "") + '<div id="' + e._id + '-body" class="' + e.classes("body") + '">' + (e.settings.html || "") + t.renderHtml(e) + "</div></fieldset>" } }) }), r(zt, [Rt, u], function (e, t) { return e.extend({ init: function (e) { var n = this, r = tinymce.activeEditor, i = r.settings, o, a, s; e.spellcheck = !1, s = i.file_picker_types || i.file_browser_callback_types, s && (s = t.makeMap(s, /[, ]/)), (!s || s[e.filetype]) && (a = i.file_picker_callback, !a || s && !s[e.filetype] ? (a = i.file_browser_callback, !a || s && !s[e.filetype] || (o = function () { a(n.getEl("inp").id, n.value(), e.filetype, window) })) : o = function () { var i = n.fire("beforecall").meta; i = t.extend({ filetype: e.filetype }, i), a.call(r, function (e, t) { n.value(e).fire("change", { meta: t }) }, n.value(), i) }), o && (e.icon = "browse", e.onaction = o), n._super(e) } }) }), r(Wt, [_t], function (e) { return e.extend({ recalc: function (e) { var t = e.layoutRect(), n = e.paddingBox(); e.items().filter(":visible").each(function (e) { e.layoutRect({ x: n.left, y: n.top, w: t.innerW - n.right - n.left, h: t.innerH - n.top - n.bottom }), e.recalc && e.recalc() }) } }) }), r(Vt, [_t], function (e) { return e.extend({ recalc: function (e) { var t, n, r, i, o, a, s, l, c, u, d, f, p, h, m, g, v = [], y, b, C, x, w, _, E, N, k, S, T, R, A, B, D, L, H, M, P, O, I, F, z = Math.max, W = Math.min; for (r = e.items().filter(":visible"), i = e.layoutRect(), o = e._paddingBox, a = e.settings, f = e.isRtl() ? a.direction || "row-reversed" : a.direction, s = a.align, l = e.isRtl() ? a.pack || "end" : a.pack, c = a.spacing || 0, ("row-reversed" == f || "column-reverse" == f) && (r = r.set(r.toArray().reverse()), f = f.split("-")[0]), "column" == f ? (k = "y", E = "h", N = "minH", S = "maxH", R = "innerH", T = "top", A = "deltaH", B = "contentH", P = "left", H = "w", D = "x", L = "innerW", M = "minW", O = "right", I = "deltaW", F = "contentW") : (k = "x", E = "w", N = "minW", S = "maxW", R = "innerW", T = "left", A = "deltaW", B = "contentW", P = "top", H = "h", D = "y", L = "innerH", M = "minH", O = "bottom", I = "deltaH", F = "contentH"), d = i[R] - o[T] - o[T], _ = u = 0, t = 0, n = r.length; n > t; t++) p = r[t], h = p.layoutRect(), m = p.settings, g = m.flex, d -= n - 1 > t ? c : 0, g > 0 && (u += g, h[S] && v.push(p), h.flex = g), d -= h[N], y = o[P] + h[M] + o[O], y > _ && (_ = y); if (x = {}, x[N] = 0 > d ? i[N] - d + i[A] : i[R] - d + i[A], x[M] = _ + i[I], x[B] = i[R] - d, x[F] = _, x.minW = W(x.minW, i.maxW), x.minH = W(x.minH, i.maxH), x.minW = z(x.minW, i.startMinWidth), x.minH = z(x.minH, i.startMinHeight), !i.autoResize || x.minW == i.minW && x.minH == i.minH) { for (C = d / u, t = 0, n = v.length; n > t; t++) p = v[t], h = p.layoutRect(), b = h[S], y = h[N] + h.flex * C, y > b ? (d -= h[S] - h[N], u -= h.flex, h.flex = 0, h.maxFlexSize = b) : h.maxFlexSize = 0; for (C = d / u, w = o[T], x = {}, 0 === u && ("end" == l ? w = d + o[T] : "center" == l ? (w = Math.round(i[R] / 2 - (i[R] - d) / 2) + o[T], 0 > w && (w = o[T])) : "justify" == l && (w = o[T], c = Math.floor(d / (r.length - 1)))), x[D] = o[P], t = 0, n = r.length; n > t; t++) p = r[t], h = p.layoutRect(), y = h.maxFlexSize || h[N], "center" === s ? x[D] = Math.round(i[L] / 2 - h[H] / 2) : "stretch" === s ? (x[H] = z(h[M] || 0, i[L] - o[P] - o[O]), x[D] = o[P]) : "end" === s && (x[D] = i[L] - h[H] - o.top), h.flex > 0 && (y += h.flex * C), x[E] = y, x[k] = w, p.layoutRect(x), p.recalc && p.recalc(), w += y + c } else if (x.w = x.minW, x.h = x.minH, e.layoutRect(x), this.recalc(e), null === e._lastRect) { var V = e.parent(); V && (V._lastRect = null, V.recalc()) } } }) }), r(Ut, [wt], function (e) { return e.extend({ Defaults: { containerClass: "flow-layout", controlClass: "flow-layout-item", endClass: "break" }, recalc: function (e) { e.items().filter(":visible").each(function (e) { e.recalc && e.recalc() }) } }) }), r($t, [K, Nt, rt, u, ht, d], function (e, t, n, r, i, o) { function a(e) { function t(t, n) { return function () { var r = this; e.on("nodeChange", function (i) { var o = e.formatter, a = null; s(i.parents, function (e) { return s(t, function (t) { return n ? o.matchNode(e, n, { value: t.value }) && (a = t.value) : o.matchNode(e, t.value) && (a = t.value), a ? !1 : void 0 }), a ? !1 : void 0 }), r.value(a) }) } } function r(e) { e = e.replace(/;$/, "").split(";"); for (var t = e.length; t--; ) e[t] = e[t].split("="); return e } function i() { function t(e) { var n = []; if (e) return s(e, function (e) { var o = { text: e.title, icon: e.icon }; if (e.items) o.menu = t(e.items); else { var a = e.format || "custom" + r++; e.format || (e.name = a, i.push(e)), o.format = a, o.cmd = e.cmd } n.push(o) }), n } function n() { var n; return n = t(e.settings.style_formats_merge ? e.settings.style_formats ? o.concat(e.settings.style_formats) : o : e.settings.style_formats || o) } var r = 0, i = [], o = [{ title: "Headings", items: [{ title: "Heading 1", format: "h1" }, { title: "Heading 2", format: "h2" }, { title: "Heading 3", format: "h3" }, { title: "Heading 4", format: "h4" }, { title: "Heading 5", format: "h5" }, { title: "Heading 6", format: "h6"}] }, { title: "Inline", items: [{ title: "Bold", icon: "bold", format: "bold" }, { title: "Italic", icon: "italic", format: "italic" }, { title: "Underline", icon: "underline", format: "underline" }, { title: "Strikethrough", icon: "strikethrough", format: "strikethrough" }, { title: "Superscript", icon: "superscript", format: "superscript" }, { title: "Subscript", icon: "subscript", format: "subscript" }, { title: "Code", icon: "code", format: "code"}] }, { title: "Blocks", items: [{ title: "Paragraph", format: "p" }, { title: "Blockquote", format: "blockquote" }, { title: "Div", format: "div" }, { title: "Pre", format: "pre"}] }, { title: "Alignment", items: [{ title: "Left", icon: "alignleft", format: "alignleft" }, { title: "Center", icon: "aligncenter", format: "aligncenter" }, { title: "Right", icon: "alignright", format: "alignright" }, { title: "Justify", icon: "alignjustify", format: "alignjustify"}]}]; return e.on("init", function () { s(i, function (t) { e.formatter.register(t.name, t) }) }), { type: "menu", items: n(), onPostRender: function (t) { e.fire("renderFormatsMenu", { control: t.control }) }, itemDefaults: { preview: !0, textStyle: function () { return this.settings.format ? e.formatter.getCssText(this.settings.format) : void 0 }, onPostRender: function () { var t = this; t.parent().on("show", function () { var n, r; n = t.settings.format, n && (t.disabled(!e.formatter.canApply(n)), t.active(e.formatter.match(n))), r = t.settings.cmd, r && t.active(e.queryCommandState(r)) }) }, onclick: function () { this.settings.format && l(this.settings.format), this.settings.cmd && e.execCommand(this.settings.cmd) } }} } function o(t) { return function () { function n() { return e.undoManager ? e.undoManager[t]() : !1 } var r = this; t = "redo" == t ? "hasRedo" : "hasUndo", r.disabled(!n()), e.on("Undo Redo AddUndo TypingUndo ClearUndos", function () { r.disabled(!n()) }) } } function a() { var t = this; e.on("VisualAid", function (e) { t.active(e.hasVisual) }), t.active(e.hasVisual) } function l(t) { t.control && (t = t.control.value()), t && e.execCommand("mceToggleFormat", !1, t) } var c; c = i(), s({ bold: "Bold", italic: "Italic", underline: "Underline", strikethrough: "Strikethrough", subscript: "Subscript", superscript: "Superscript" }, function (t, n) { e.addButton(n, { tooltip: t, onPostRender: function () { var t = this; e.formatter ? e.formatter.formatChanged(n, function (e) { t.active(e) }) : e.on("init", function () { e.formatter.formatChanged(n, function (e) { t.active(e) }) }) }, onclick: function () { l(n) } }) }), s({ outdent: ["Decrease indent", "Outdent"], indent: ["Increase indent", "Indent"], cut: ["Cut", "Cut"], copy: ["Copy", "Copy"], paste: ["Paste", "Paste"], help: ["Help", "mceHelp"], selectall: ["Select all", "SelectAll"], removeformat: ["Clear formatting", "RemoveFormat"], visualaid: ["Visual aids", "mceToggleVisualAid"], newdocument: ["New document", "mceNewDocument"] }, function (t, n) { e.addButton(n, { tooltip: t[0], cmd: t[1] }) }), s({ blockquote: ["Blockquote", "mceBlockQuote"], numlist: ["Numbered list", "InsertOrderedList"], bullist: ["Bullet list", "InsertUnorderedList"], subscript: ["Subscript", "Subscript"], superscript: ["Superscript", "Superscript"], alignleft: ["Align left", "JustifyLeft"], aligncenter: ["Align center", "JustifyCenter"], alignright: ["Align right", "JustifyRight"], alignjustify: ["Justify", "JustifyFull"] }, function (t, n) { e.addButton(n, { tooltip: t[0], cmd: t[1], onPostRender: function () { var t = this; e.formatter ? e.formatter.formatChanged(n, function (e) { t.active(e) }) : e.on("init", function () { e.formatter.formatChanged(n, function (e) { t.active(e) }) }) } }) }), e.addButton("undo", { tooltip: "Undo", onPostRender: o("undo"), cmd: "undo" }), e.addButton("redo", { tooltip: "Redo", onPostRender: o("redo"), cmd: "redo" }), e.addMenuItem("newdocument", { text: "New document", shortcut: "Ctrl+N", icon: "newdocument", cmd: "mceNewDocument" }), e.addMenuItem("undo", { text: "Undo", icon: "undo", shortcut: "Ctrl+Z", onPostRender: o("undo"), cmd: "undo" }), e.addMenuItem("redo", { text: "Redo", icon: "redo", shortcut: "Ctrl+Y", onPostRender: o("redo"), cmd: "redo" }), e.addMenuItem("visualaid", { text: "Visual aids", selectable: !0, onPostRender: a, cmd: "mceToggleVisualAid" }), s({ cut: ["Cut", "Cut", "Ctrl+X"], copy: ["Copy", "Copy", "Ctrl+C"], paste: ["Paste", "Paste", "Ctrl+V"], selectall: ["Select all", "SelectAll", "Ctrl+A"], bold: ["Bold", "Bold", "Ctrl+B"], italic: ["Italic", "Italic", "Ctrl+I"], underline: ["Underline", "Underline"], strikethrough: ["Strikethrough", "Strikethrough"], subscript: ["Subscript", "Subscript"], superscript: ["Superscript", "Superscript"], removeformat: ["Clear formatting", "RemoveFormat"] }, function (t, n) { e.addMenuItem(n, { text: t[0], icon: n, shortcut: t[2], cmd: t[1] }) }), e.on("mousedown", function () { n.hideAll() }), e.addButton("styleselect", { type: "menubutton", text: "Formats", menu: c }), e.addButton("formatselect", function () { var n = [], i = r(e.settings.block_formats || "Paragraph=p;Address=address;Pre=pre;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6"); return s(i, function (t) { n.push({ text: t[0], value: t[1], textStyle: function () { return e.formatter.getCssText(t[1]) } }) }), { type: "listbox", text: i[0][0], values: n, fixedWidth: !0, onselect: l, onPostRender: t(n)} }), e.addButton("fontselect", function () { var n = "Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats", i = [], o = r(e.settings.font_formats || n); return s(o, function (e) { i.push({ text: { raw: e[0] }, value: e[1], textStyle: -1 == e[1].indexOf("dings") ? "font-family:" + e[1] : "" }) }), { type: "listbox", text: "Font Family", tooltip: "Font Family", values: i, fixedWidth: !0, onPostRender: t(i, "fontname"), onselect: function (t) { t.control.settings.value && e.execCommand("FontName", !1, t.control.settings.value) } } }), e.addButton("fontsizeselect", function () { var n = [], r = "8pt 10pt 12pt 14pt 18pt 24pt 36pt", i = e.settings.fontsize_formats || r; return s(i.split(" "), function (e) { var t = e, r = e, i = e.split("="); i.length > 1 && (t = i[0], r = i[1]), n.push({ text: t, value: r }) }), { type: "listbox", text: "Font Sizes", tooltip: "Font Sizes", values: n, fixedWidth: !0, onPostRender: t(n, "fontsize"), onclick: function (t) { t.control.settings.value && e.execCommand("FontSize", !1, t.control.settings.value) } } }), e.addMenuItem("formats", { text: "Formats", menu: c }) } var s = r.each; i.on("AddEditor", function (t) { t.editor.rtl && (e.rtl = !0), a(t.editor) }), e.translate = function (e) { return i.translate(e) }, t.tooltips = !o.iOS }), r(qt, [_t], function (e) { return e.extend({ recalc: function (e) { var t = e.settings, n, r, i, o, a, s, l, c, u, d, f, p, h, m, g, v, y, b, C, x, w, _, E = [], N = [], k, S, T, R, A, B; t = e.settings, i = e.items().filter(":visible"), o = e.layoutRect(), r = t.columns || Math.ceil(Math.sqrt(i.length)), n = Math.ceil(i.length / r), y = t.spacingH || t.spacing || 0, b = t.spacingV || t.spacing || 0, C = t.alignH || t.align, x = t.alignV || t.align, g = e._paddingBox, A = "reverseRows" in t ? t.reverseRows : e.isRtl(), C && "string" == typeof C && (C = [C]), x && "string" == typeof x && (x = [x]); for (d = 0; r > d; d++) E.push(0); for (f = 0; n > f; f++) N.push(0); for (f = 0; n > f; f++) for (d = 0; r > d && (u = i[f * r + d], u); d++) c = u.layoutRect(), k = c.minW, S = c.minH, E[d] = k > E[d] ? k : E[d], N[f] = S > N[f] ? S : N[f]; for (T = o.innerW - g.left - g.right, w = 0, d = 0; r > d; d++) w += E[d] + (d > 0 ? y : 0), T -= (d > 0 ? y : 0) + E[d]; for (R = o.innerH - g.top - g.bottom, _ = 0, f = 0; n > f; f++) _ += N[f] + (f > 0 ? b : 0), R -= (f > 0 ? b : 0) + N[f]; if (w += g.left + g.right, _ += g.top + g.bottom, l = {}, l.minW = w + (o.w - o.innerW), l.minH = _ + (o.h - o.innerH), l.contentW = l.minW - o.deltaW, l.contentH = l.minH - o.deltaH, l.minW = Math.min(l.minW, o.maxW), l.minH = Math.min(l.minH, o.maxH), l.minW = Math.max(l.minW, o.startMinWidth), l.minH = Math.max(l.minH, o.startMinHeight), !o.autoResize || l.minW == o.minW && l.minH == o.minH) { o.autoResize && (l = e.layoutRect(l), l.contentW = l.minW - o.deltaW, l.contentH = l.minH - o.deltaH); var D; D = "start" == t.packV ? 0 : R > 0 ? Math.floor(R / n) : 0; var L = 0, H = t.flexWidths; if (H) for (d = 0; d < H.length; d++) L += H[d]; else L = r; var M = T / L; for (d = 0; r > d; d++) E[d] += H ? H[d] * M : M; for (h = g.top, f = 0; n > f; f++) { for (p = g.left, s = N[f] + D, d = 0; r > d && (B = A ? f * r + r - 1 - d : f * r + d, u = i[B], u); d++) m = u.settings, c = u.layoutRect(), a = Math.max(E[d], c.startMinWidth), c.x = p, c.y = h, v = m.alignH || (C ? C[d] || C[0] : null), "center" == v ? c.x = p + a / 2 - c.w / 2 : "right" == v ? c.x = p + a - c.w : "stretch" == v && (c.w = a), v = m.alignV || (x ? x[d] || x[0] : null), "center" == v ? c.y = h + s / 2 - c.h / 2 : "bottom" == v ? c.y = h + s - c.h : "stretch" == v && (c.h = s), u.layoutRect(c), p += a + y, u.recalc && u.recalc(); h += s + b } } else if (l.w = l.minW, l.h = l.minH, e.layoutRect(l), this.recalc(e), null === e._lastRect) { var P = e.parent(); P && (P._lastRect = null, P.recalc()) } } }) }), r(jt, [Nt], function (e) { return e.extend({ renderHtml: function () { var e = this; return e.addClass("iframe"), e.canFocus = !1, '<iframe id="' + e._id + '" class="' + e.classes() + '" tabindex="-1" src="' + (e.settings.url || "javascript:''") + '" frameborder="0"></iframe>' }, src: function (e) { this.getEl().src = e }, html: function (e, t) { var n = this, r = this.getEl().contentWindow.document.body; return r ? (r.innerHTML = e, t && t()) : setTimeout(function () { n.html(e) }, 0), this } }) }), r(Yt, [Nt, Y], function (e, t) { return e.extend({ init: function (e) { var t = this; t._super(e), t.addClass("widget"), t.addClass("label"), t.canFocus = !1, e.multiline && t.addClass("autoscroll"), e.strong && t.addClass("strong") }, initLayoutRect: function () { var e = this, n = e._super(); if (e.settings.multiline) { var r = t.getSize(e.getEl()); r.width > n.maxW && (n.minW = n.maxW, e.addClass("multiline")), e.getEl().style.width = n.minW + "px", n.startMinH = n.h = n.minH = Math.min(n.maxH, t.getSize(e.getEl()).height) } return n }, repaint: function () { var e = this; return e.settings.multiline || (e.getEl().style.lineHeight = e.layoutRect().h + "px"), e._super() }, text: function (e) { var t = this; return t._rendered && e && this.innerHtml(t.encode(e)), t._super(e) }, renderHtml: function () { var e = this, t = e.settings.forId; return '<label id="' + e._id + '" class="' + e.classes() + '"' + (t ? ' for="' + t + '"' : "") + ">" + e.encode(e._text) + "</label>" } }) }), r(Kt, [J], function (e) { return e.extend({ Defaults: { role: "toolbar", layout: "flow" }, init: function (e) { var t = this; t._super(e), t.addClass("toolbar") }, postRender: function () { var e = this; return e.items().addClass("toolbar-item"), e._super() } }) }), r(Gt, [Kt], function (e) { return e.extend({ Defaults: { role: "menubar", containerCls: "menubar", ariaRoot: !0, defaults: { type: "menubutton"}} }) }), r(Xt, [kt, G, Gt], function (e, t, n) { function r(e, t) { for (; e; ) { if (t === e) return !0; e = e.parentNode } return !1 } var i = e.extend({ init: function (e) { var t = this; t._renderOpen = !0, t._super(e), t.addClass("menubtn"), e.fixedWidth && t.addClass("fixed-width"), t.aria("haspopup", !0), t.hasPopup = !0 }, showMenu: function () { var e = this, n = e.settings, r; return e.menu && e.menu.visible() ? e.hideMenu() : (e.menu || (r = n.menu || [], r.length ? r = { type: "menu", items: r} : r.type = r.type || "menu", e.menu = t.create(r).parent(e).renderTo(), e.fire("createmenu"), e.menu.reflow(), e.menu.on("cancel", function (t) { t.control.parent() === e.menu && (t.stopPropagation(), e.focus(), e.hideMenu()) }), e.menu.on("select", function () { e.focus() }), e.menu.on("show hide", function (t) { t.control == e.menu && e.activeMenu("show" == t.type), e.aria("expanded", "show" == t.type) }).fire("show")), e.menu.show(), e.menu.layoutRect({ w: e.layoutRect().w }), void e.menu.moveRel(e.getEl(), e.isRtl() ? ["br-tr", "tr-br"] : ["bl-tl", "tl-bl"])) }, hideMenu: function () { var e = this; e.menu && (e.menu.items().each(function (e) { e.hideMenu && e.hideMenu() }), e.menu.hide()) }, activeMenu: function (e) { this.toggleClass("active", e) }, renderHtml: function () { var e = this, t = e._id, r = e.classPrefix, i = e.settings.icon, o; return o = e.settings.image, o ? (i = "none", "string" != typeof o && (o = window.getSelection ? o[0] : o[1]), o = " style=\"background-image: url('" + o + "')\"") : o = "", i = e.settings.icon ? r + "ico " + r + "i-" + i : "", e.aria("role", e.parent() instanceof n ? "menuitem" : "button"), '<div id="' + t + '" class="' + e.classes() + '" tabindex="-1" aria-labelledby="' + t + '"><button id="' + t + '-open" role="presentation" type="button" tabindex="-1">' + (i ? '<i class="' + i + '"' + o + "></i>" : "") + "<span>" + (e._text ? (i ? "\xa0" : "") + e.encode(e._text) : "") + '</span> <i class="' + r + 'caret"></i></button></div>' }, postRender: function () { var e = this; return e.on("click", function (t) { t.control === e && r(t.target, e.getEl()) && (e.showMenu(), t.aria && e.menu.items()[0].focus()) }), e.on("mouseenter", function (t) { var n = t.control, r = e.parent(), o; n && r && n instanceof i && n.parent() == r && (r.items().filter("MenuButton").each(function (e) { e.hideMenu && e != n && (e.menu && e.menu.visible() && (o = !0), e.hideMenu()) }), o && (n.focus(), n.showMenu())) }), e._super() }, text: function (e) { var t = this, n, r; if (t._rendered) for (r = t.getEl("open").getElementsByTagName("span"), n = 0; n < r.length; n++) r[n].innerHTML = (t.settings.icon && e ? "\xa0" : "") + t.encode(e); return this._super(e) }, remove: function () { this._super(), this.menu && this.menu.remove() } }); return i }), r(Jt, [Xt], function (e) { return e.extend({ init: function (e) { function t(r) { for (var a = 0; a < r.length; a++) { if (i = r[a].selected || e.value === r[a].value) { o = o || r[a].text, n._value = r[a].value; break } r[a].menu && t(r[a].menu) } } var n = this, r, i, o, a; n._values = r = e.values, r && ("undefined" != typeof e.value && t(r), !i && r.length > 0 && (o = r[0].text, n._value = r[0].value), e.menu = r), e.text = e.text || o || r[0].text, n._super(e), n.addClass("listbox"), n.on("select", function (t) { var r = t.control; a && (t.lastControl = a), e.multiple ? r.active(!r.active()) : n.value(t.control.settings.value), a = r }) }, value: function (e) { function t(e, n) { e.items().each(function (e) { i = e.value() === n, i && (o = o || e.text()), e.active(i), e.menu && t(e.menu, n) }) } function n(t) { for (var r = 0; r < t.length; r++) i = t[r].value == e, i && (o = o || t[r].text), t[r].active = i, t[r].menu && n(t[r].menu) } var r = this, i, o, a; return "undefined" != typeof e && (r.menu ? t(r.menu, e) : (a = r.settings.menu, n(a)), r.text(o || this.settings.text)), r._super(e) } }) }), r(Qt, [Nt, G, d], function (e, t, n) { return e.extend({ Defaults: { border: 0, role: "menuitem" }, init: function (e) { var t = this; t.hasPopup = !0, t._super(e), e = t.settings, t.addClass("menu-item"), e.menu && t.addClass("menu-item-expand"), e.preview && t.addClass("menu-item-preview"), ("-" === t._text || "|" === t._text) && (t.addClass("menu-item-sep"), t.aria("role", "separator"), t._text = "-"), e.selectable && (t.aria("role", "menuitemcheckbox"), t.addClass("menu-item-checkbox"), e.icon = "selected"), e.preview || e.selectable || t.addClass("menu-item-normal"), t.on("mousedown", function (e) { e.preventDefault() }), e.menu && !e.ariaHideMenu && t.aria("haspopup", !0) }, hasMenus: function () { return !!this.settings.menu }, showMenu: function () { var e = this, n = e.settings, r, i = e.parent(); if (i.items().each(function (t) { t !== e && t.hideMenu() }), n.menu) { r = e.menu, r ? r.show() : (r = n.menu, r.length ? r = { type: "menu", items: r} : r.type = r.type || "menu", i.settings.itemDefaults && (r.itemDefaults = i.settings.itemDefaults), r = e.menu = t.create(r).parent(e).renderTo(), r.reflow(), r.on("cancel", function (t) { t.stopPropagation(), e.focus(), r.hide() }), r.on("show hide", function (e) { e.control.items().each(function (e) { e.active(e.settings.selected) }) }).fire("show"), r.on("hide", function (t) { t.control === r && e.removeClass("selected") }), r.submenu = !0), r._parentMenu = i, r.addClass("menu-sub"); var o = r.testMoveRel(e.getEl(), e.isRtl() ? ["tl-tr", "bl-br", "tr-tl", "br-bl"] : ["tr-tl", "br-bl", "tl-tr", "bl-br"]); r.moveRel(e.getEl(), o), r.rel = o, o = "menu-sub-" + o, r.removeClass(r._lastRel), r.addClass(o), r._lastRel = o, e.addClass("selected"), e.aria("expanded", !0) } }, hideMenu: function () { var e = this; return e.menu && (e.menu.items().each(function (e) { e.hideMenu && e.hideMenu() }), e.menu.hide(), e.aria("expanded", !1)), e }, renderHtml: function () { var e = this, t = e._id, r = e.settings, i = e.classPrefix, o = e.encode(e._text), a = e.settings.icon, s = "", l = r.shortcut; return a && e.parent().addClass("menu-has-icons"), r.image && (a = "none", s = " style=\"background-image: url('" + r.image + "')\""), l && n.mac && (l = l.replace(/ctrl\+alt\+/i, "&#x2325;&#x2318;"), l = l.replace(/ctrl\+/i, "&#x2318;"), l = l.replace(/alt\+/i, "&#x2325;"), l = l.replace(/shift\+/i, "&#x21E7;")), a = i + "ico " + i + "i-" + (e.settings.icon || "none"), '<div id="' + t + '" class="' + e.classes() + '" tabindex="-1">' + ("-" !== o ? '<i class="' + a + '"' + s + "></i>\xa0" : "") + ("-" !== o ? '<span id="' + t + '-text" class="' + i + 'text">' + o + "</span>" : "") + (l ? '<div id="' + t + '-shortcut" class="' + i + 'menu-shortcut">' + l + "</div>" : "") + (r.menu ? '<div class="' + i + 'caret"></div>' : "") + "</div>" }, postRender: function () { var e = this, t = e.settings, n = t.textStyle; if ("function" == typeof n && (n = n.call(this)), n) { var r = e.getEl("text"); r && r.setAttribute("style", n) } return e.on("mouseenter click", function (n) { n.control === e && (t.menu || "click" !== n.type ? (e.showMenu(), n.aria && e.menu.focus(!0)) : (e.fire("select"), e.parent().hideAll())) }), e._super(), e }, active: function (e) { return "undefined" != typeof e && this.aria("checked", e), this._super(e) }, remove: function () { this._super(), this.menu && this.menu.remove() } }) }), r(Zt, [rt, Qt, u], function (e, t, n) { var r = e.extend({ Defaults: { defaultType: "menuitem", border: 1, layout: "stack", role: "application", bodyRole: "menu", ariaRoot: !0 }, init: function (e) { var t = this; if (e.autohide = !0, e.constrainToViewport = !0, e.itemDefaults) for (var r = e.items, i = r.length; i--; ) r[i] = n.extend({}, e.itemDefaults, r[i]); t._super(e), t.addClass("menu") }, repaint: function () { return this.toggleClass("menu-align", !0), this._super(), this.getEl().style.height = "", this.getEl("body").style.height = "", this }, cancel: function () { var e = this; e.hideAll(), e.fire("select") }, hideAll: function () { var e = this; return this.find("menuitem").exec("hideMenu"), e._super() }, preRender: function () { var e = this; return e.items().each(function (t) { var n = t.settings; return n.icon || n.selectable ? (e._hasIcons = !0, !1) : void 0 }), e._super() } }); return r }), r(en, [Tt], function (e) { return e.extend({ Defaults: { classes: "radio", role: "radio"} }) }), r(tn, [Nt, Q], function (e, t) { return e.extend({ renderHtml: function () { var e = this, t = e.classPrefix; return e.addClass("resizehandle"), "both" == e.settings.direction && e.addClass("resizehandle-both"), e.canFocus = !1, '<div id="' + e._id + '" class="' + e.classes() + '"><i class="' + t + "ico " + t + 'i-resize"></i></div>' }, postRender: function () { var e = this; e._super(), e.resizeDragHelper = new t(this._id, { start: function () { e.fire("ResizeStart") }, drag: function (t) { "both" != e.settings.direction && (t.deltaX = 0), e.fire("Resize", t) }, stop: function () { e.fire("ResizeEnd") } }) }, remove: function () { return this.resizeDragHelper && this.resizeDragHelper.destroy(), this._super() } }) }), r(nn, [Nt], function (e) { return e.extend({ renderHtml: function () { var e = this; return e.addClass("spacer"), e.canFocus = !1, '<div id="' + e._id + '" class="' + e.classes() + '"></div>' } }) }), r(rn, [Xt, Y], function (e, t) { return e.extend({ Defaults: { classes: "widget btn splitbtn", role: "button" }, repaint: function () { var e = this, n = e.getEl(), r = e.layoutRect(), i, o; return e._super(), i = n.firstChild, o = n.lastChild, t.css(i, { width: r.w - t.getSize(o).width, height: r.h - 2 }), t.css(o, { height: r.h - 2 }), e }, activeMenu: function (e) { var n = this; t.toggleClass(n.getEl().lastChild, n.classPrefix + "active", e) }, renderHtml: function () { var e = this, t = e._id, n = e.classPrefix, r, i = e.settings.icon; return r = e.settings.image, r ? (i = "none", "string" != typeof r && (r = window.getSelection ? r[0] : r[1]), r = " style=\"background-image: url('" + r + "')\"") : r = "", i = e.settings.icon ? n + "ico " + n + "i-" + i : "", '<div id="' + t + '" class="' + e.classes() + '" role="button" tabindex="-1"><button type="button" hidefocus="1" tabindex="-1">' + (i ? '<i class="' + i + '"' + r + "></i>" : "") + (e._text ? (i ? " " : "") + e._text : "") + '</button><button type="button" class="' + n + 'open" hidefocus="1" tabindex="-1">' + (e._menuBtnText ? (i ? "\xa0" : "") + e._menuBtnText : "") + ' <i class="' + n + 'caret"></i></button></div>' }, postRender: function () { var e = this, t = e.settings.onclick; return e.on("click", function (e) { var n = e.target; if (e.control == this) for (; n; ) { if (e.aria && "down" != e.aria.key || "BUTTON" == n.nodeName && -1 == n.className.indexOf("open")) return e.stopImmediatePropagation(), void t.call(this, e); n = n.parentNode } }), delete e.settings.onclick, e._super() } }) }), r(on, [Ut], function (e) { return e.extend({ Defaults: { containerClass: "stack-layout", controlClass: "stack-layout-item", endClass: "break"} }) }), r(an, [et, Y], function (e, t) { return e.extend({ Defaults: { layout: "absolute", defaults: { type: "panel"} }, activateTab: function (e) { var n; this.activeTabId && (n = this.getEl(this.activeTabId), t.removeClass(n, this.classPrefix + "active"), n.setAttribute("aria-selected", "false")), this.activeTabId = "t" + e, n = this.getEl("t" + e), n.setAttribute("aria-selected", "true"), t.addClass(n, this.classPrefix + "active"), this.items()[e].show().fire("showtab"), this.reflow(), this.items().each(function (t, n) { e != n && t.hide() }) }, renderHtml: function () { var e = this, t = e._layout, n = "", r = e.classPrefix; return e.preRender(), t.preRender(e), e.items().each(function (t, i) { var o = e._id + "-t" + i; t.aria("role", "tabpanel"), t.aria("labelledby", o), n += '<div id="' + o + '" class="' + r + 'tab" unselectable="on" role="tab" aria-controls="' + t._id + '" aria-selected="false" tabIndex="-1">' + e.encode(t.settings.title) + "</div>" }), '<div id="' + e._id + '" class="' + e.classes() + '" hidefocus="1" tabindex="-1"><div id="' + e._id + '-head" class="' + r + 'tabs" role="tablist">' + n + '</div><div id="' + e._id + '-body" class="' + e.classes("body") + '">' + t.renderHtml(e) + "</div></div>" }, postRender: function () { var e = this; e._super(), e.settings.activeTab = e.settings.activeTab || 0, e.activateTab(e.settings.activeTab), this.on("click", function (t) { var n = t.target.parentNode; if (t.target.parentNode.id == e._id + "-head") for (var r = n.childNodes.length; r--; ) n.childNodes[r] == t.target && e.activateTab(r) }) }, initLayoutRect: function () { var e = this, n, r, i; r = t.getSize(e.getEl("head")).width, r = 0 > r ? 0 : r, i = 0, e.items().each(function (e) { r = Math.max(r, e.layoutRect().minW), i = Math.max(i, e.layoutRect().minH) }), e.items().each(function (e) { e.settings.x = 0, e.settings.y = 0, e.settings.w = r, e.settings.h = i, e.layoutRect({ x: 0, y: 0, w: r, h: i }) }); var o = t.getSize(e.getEl("head")).height; return e.settings.minWidth = r, e.settings.minHeight = i + o, n = e._super(), n.deltaH += o, n.innerH = n.h - n.deltaH, n } }) }), r(sn, [Nt, Y], function (e, t) { return e.extend({ init: function (e) { var t = this; t._super(e), t._value = e.value || "", t.addClass("textbox"), e.multiline ? t.addClass("multiline") : t.on("keydown", function (e) { 13 == e.keyCode && t.parents().reverse().each(function (t) { return e.preventDefault(), t.hasEventListeners("submit") && t.toJSON ? (t.fire("submit", { data: t.toJSON() }), !1) : void 0 }) }) }, disabled: function (e) { var t = this; return t._rendered && "undefined" != typeof e && (t.getEl().disabled = e), t._super(e) }, value: function (e) { var t = this; return "undefined" != typeof e ? (t._value = e, t._rendered && (t.getEl().value = e), t) : t._rendered ? t.getEl().value : t._value }, repaint: function () { var e = this, t, n, r, i = 0, o = 0, a; t = e.getEl().style, n = e._layoutRect, a = e._lastRepaintRect || {}; var s = document; return !e.settings.multiline && s.all && (!s.documentMode || s.documentMode <= 8) && (t.lineHeight = n.h - o + "px"), r = e._borderBox, i = r.left + r.right + 8, o = r.top + r.bottom + (e.settings.multiline ? 8 : 0), n.x !== a.x && (t.left = n.x + "px", a.x = n.x), n.y !== a.y && (t.top = n.y + "px", a.y = n.y), n.w !== a.w && (t.width = n.w - i + "px", a.w = n.w), n.h !== a.h && (t.height = n.h - o + "px", a.h = n.h), e._lastRepaintRect = a, e.fire("repaint", {}, !1), e }, renderHtml: function () { var e = this, t = e._id, n = e.settings, r = e.encode(e._value, !1), i = ""; return "spellcheck" in n && (i += ' spellcheck="' + n.spellcheck + '"'), n.maxLength && (i += ' maxlength="' + n.maxLength + '"'), n.size && (i += ' size="' + n.size + '"'), n.subtype && (i += ' type="' + n.subtype + '"'), e.disabled() && (i += ' disabled="disabled"'), n.multiline ? '<textarea id="' + t + '" class="' + e.classes() + '" ' + (n.rows ? ' rows="' + n.rows + '"' : "") + ' hidefocus="1"' + i + ">" + r + "</textarea>" : '<input id="' + t + '" class="' + e.classes() + '" value="' + r + '" hidefocus="1"' + i + " />" }, postRender: function () { var e = this; return t.on(e.getEl(), "change", function (t) { e.fire("change", t) }), e._super() }, remove: function () { t.off(this.getEl()), this._super() } }) }), r(ln, [Y, K], function (e, t) { return function (n, r) { var i = this, o, a = t.classPrefix; i.show = function (t) { return i.hide(), o = !0, window.setTimeout(function () { o && n.appendChild(e.createFragment('<div class="' + a + "throbber" + (r ? " " + a + "throbber-inline" : "") + '"></div>')) }, t || 0), i }, i.hide = function () { var e = n.lastChild; return e && -1 != e.className.indexOf("throbber") && e.parentNode.removeChild(e), o = !1, i } } }), a([l, c, u, d, f, p, h, m, g, y, b, C, _, E, N, k, S, T, R, A, B, D, L, H, M, O, I, F, z, W, V, U, $, q, j, Y, K, G, X, J, Q, Z, et, tt, nt, rt, it, ot, at, st, lt, ct, ut, dt, ft, pt, ht, mt, gt, vt, yt, bt, Ct, xt, wt, _t, Et, Nt, kt, St, Tt, Rt, At, Bt, Dt, Lt, Ht, Mt, Pt, Ot, It, Ft, zt, Wt, Vt, Ut, $t, qt, jt, Yt, Kt, Gt, Xt, Jt, Qt, Zt, en, tn, nn, rn, on, an, sn, ln]) } (this); tinymce.PluginManager.add("autoresize", function (a) { function b() { return a.plugins.fullscreen && a.plugins.fullscreen.isFullscreen() } function c(d) { var g, h, i, j, k, l, m, n, o, p, q, r, s = tinymce.DOM; if (h = a.getDoc()) { if (i = h.body, j = h.documentElement, k = e.autoresize_min_height, !i || d && "setcontent" === d.type && d.initial || b()) return void (i && j && (i.style.overflowY = "auto", j.style.overflowY = "auto")); m = a.dom.getStyle(i, "margin-top", !0), n = a.dom.getStyle(i, "margin-bottom", !0), o = a.dom.getStyle(i, "padding-top", !0), p = a.dom.getStyle(i, "padding-bottom", !0), q = a.dom.getStyle(i, "border-top-width", !0), r = a.dom.getStyle(i, "border-bottom-width", !0), l = i.offsetHeight + parseInt(m, 10) + parseInt(n, 10) + parseInt(o, 10) + parseInt(p, 10) + parseInt(q, 10) + parseInt(r, 10), (isNaN(l) || 0 >= l) && (l = tinymce.Env.ie ? i.scrollHeight : tinymce.Env.webkit && 0 === i.clientHeight ? 0 : i.offsetHeight), l > e.autoresize_min_height && (k = l), e.autoresize_max_height && l > e.autoresize_max_height ? (k = e.autoresize_max_height, i.style.overflowY = "auto", j.style.overflowY = "auto") : (i.style.overflowY = "hidden", j.style.overflowY = "hidden", i.scrollTop = 0), k !== f && (g = k - f, s.setStyle(a.iframeElement, "height", k + "px"), f = k, tinymce.isWebKit && 0 > g && c(d)) } } function d(a, b, e) { setTimeout(function () { c({}), a-- ? d(a, b, e) : e && e() }, b) } var e = a.settings, f = 0; a.settings.inline || (e.autoresize_min_height = parseInt(a.getParam("autoresize_min_height", a.getElement().offsetHeight), 10), e.autoresize_max_height = parseInt(a.getParam("autoresize_max_height", 0), 10), a.on("init", function () { var b = a.getParam("autoresize_overflow_padding", 1); a.dom.setStyles(a.getBody(), { paddingBottom: a.getParam("autoresize_bottom_margin", 50), paddingLeft: b, paddingRight: b }) }), a.on("nodechange setcontent keyup FullscreenStateChanged", c), a.getParam("autoresize_on_init", !0) && a.on("init", function () { d(20, 100, function () { d(5, 1e3) }) }), a.addCommand("mceAutoResize", c)) }); tinymce.PluginManager.add("code", function (a) { function b() { var b = a.windowManager.open({ title: "Source code", body: { type: "textbox", name: "code", multiline: !0, minWidth: a.getParam("code_dialog_width", 600), minHeight: a.getParam("code_dialog_height", Math.min(tinymce.DOM.getViewPort().h - 200, 500)), spellcheck: !1, style: "direction: ltr; text-align: left" }, onSubmit: function (b) { a.focus(), a.undoManager.transact(function () { a.setContent(b.data.code) }), a.selection.setCursorLocation(), a.nodeChanged() } }); b.find("#code").value(a.getContent({ source_view: !0 })) } a.addCommand("mceCodeEditor", b), a.addButton("code", { icon: "code", tooltip: "Source code", onclick: b }), a.addMenuItem("code", { icon: "code", text: "Source code", context: "tools", onclick: b }) }); tinymce.PluginManager.add("textcolor", function (a) { function b(b) { var c; return a.dom.getParents(a.selection.getStart(), function (a) { var d; (d = a.style["forecolor" == b ? "color" : "background-color"]) && (c = d) }), c } function c() { var b, c, d = []; for (c = a.settings.textcolor_map || ["000000", "Black", "993300", "Burnt orange", "333300", "Dark olive", "003300", "Dark green", "003366", "Dark azure", "000080", "Navy Blue", "333399", "Indigo", "333333", "Very dark gray", "800000", "Maroon", "FF6600", "Orange", "808000", "Olive", "008000", "Green", "008080", "Teal", "0000FF", "Blue", "666699", "Grayish blue", "808080", "Gray", "FF0000", "Red", "FF9900", "Amber", "99CC00", "Yellow green", "339966", "Sea green", "33CCCC", "Turquoise", "3366FF", "Royal blue", "800080", "Purple", "999999", "Medium gray", "FF00FF", "Magenta", "FFCC00", "Gold", "FFFF00", "Yellow", "00FF00", "Lime", "00FFFF", "Aqua", "00CCFF", "Sky blue", "993366", "Red violet", "FFFFFF", "White", "FF99CC", "Pink", "FFCC99", "Peach", "FFFF99", "Light yellow", "CCFFCC", "Pale green", "CCFFFF", "Pale cyan", "99CCFF", "Light sky blue", "CC99FF", "Plum"], b = 0; b < c.length; b += 2) d.push({ text: c[b + 1], color: "#" + c[b] }); return d } function d() { function b(a, b) { var c = "transparent" == a; return '<td class="mce-grid-cell' + (c ? " mce-colorbtn-trans" : "") + '"><div id="' + n + "-" + o++ + '" data-mce-color="' + (a ? a : "") + '" role="option" tabIndex="-1" style="' + (a ? "background-color: " + a : "") + '" title="' + tinymce.translate(b) + '">' + (c ? "&#215;" : "") + "</div></td>" } var d, e, f, g, h, k, l, m = this, n = m._id, o = 0; for (d = c(), d.push({ text: tinymce.translate("No color"), color: "transparent" }), f = '<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>', g = d.length - 1, k = 0; j > k; k++) { for (f += "<tr>", h = 0; i > h; h++) l = k * i + h, l > g ? f += "<td></td>" : (e = d[l], f += b(e.color, e.text)); f += "</tr>" } if (a.settings.color_picker_callback) { for (f += '<tr><td colspan="' + i + '" class="mce-custom-color-btn"><div id="' + n + '-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="' + n + '-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">' + tinymce.translate("Custom...") + "</button></div></td></tr>", f += "<tr>", h = 0; i > h; h++) f += b("", "Custom color"); f += "</tr>" } return f += "</tbody></table>" } function e(b, c) { a.focus(), a.formatter.apply(b, { value: c }), a.nodeChanged() } function f(b) { a.focus(), a.formatter.remove(b, { value: null }, null, !0), a.nodeChanged() } function g(c) { function d(a) { j.hidePanel(), j.color(a), e(j.settings.format, a) } function g(a, b) { a.style.background = b, a.setAttribute("data-mce-color", b) } var h, j = this.parent(); if (tinymce.DOM.getParent(c.target, ".mce-custom-color-btn") && (j.hidePanel(), a.settings.color_picker_callback.call(a, function (a) { var b, c, e, f = j.panel.getEl().getElementsByTagName("table")[0]; for (b = tinymce.map(f.rows[f.rows.length - 1].childNodes, function (a) { return a.firstChild }), e = 0; e < b.length && (c = b[e], c.getAttribute("data-mce-color")); e++); if (e == i) for (e = 0; i - 1 > e; e++) g(b[e], b[e + 1].getAttribute("data-mce-color")); g(c, a), d(a) }, b(j.settings.format))), h = c.target.getAttribute("data-mce-color")) { if (this.lastId && document.getElementById(this.lastId).setAttribute("aria-selected", !1), c.target.setAttribute("aria-selected", !0), this.lastId = c.target.id, "transparent" == h) return f(j.settings.format), void j.hidePanel(); d(h) } else null !== h && j.hidePanel() } function h() { var a = this; a._color && e(a.settings.format, a._color) } var i, j; j = a.settings.textcolor_rows || 5, i = a.settings.textcolor_cols || 8, a.addButton("forecolor", { type: "colorbutton", tooltip: "Text color", format: "forecolor", panel: { role: "application", ariaRemember: !0, html: d, onclick: g }, onclick: h }), a.addButton("backcolor", { type: "colorbutton", tooltip: "Background color", format: "hilitecolor", panel: { role: "application", ariaRemember: !0, html: d, onclick: g }, onclick: h }) }); tinymce.ThemeManager.add("modern", function (a) { function b() { function b(b) { var d, e = []; if (b) return l(b.split(/[ ,]/), function (b) { function c() { var c = a.selection; "bullist" == f && c.selectorChanged("ul > li", function (a, c) { for (var d, e = c.parents.length; e-- && (d = c.parents[e].nodeName, "OL" != d && "UL" != d); ); b.active(a && "UL" == d) }), "numlist" == f && c.selectorChanged("ol > li", function (a, c) { for (var d, e = c.parents.length; e-- && (d = c.parents[e].nodeName, "OL" != d && "UL" != d); ); b.active(a && "OL" == d) }), b.settings.stateSelector && c.selectorChanged(b.settings.stateSelector, function (a) { b.active(a) }, !0), b.settings.disabledStateSelector && c.selectorChanged(b.settings.disabledStateSelector, function (a) { b.disabled(a) }) } var f; "|" == b ? d = null : k.has(b) ? (b = { type: b }, j.toolbar_items_size && (b.size = j.toolbar_items_size), e.push(b), d = null) : (d || (d = { type: "buttongroup", items: [] }, e.push(d)), a.buttons[b] && (f = b, b = a.buttons[f], "function" == typeof b && (b = b()), b.type = b.type || "button", j.toolbar_items_size && (b.size = j.toolbar_items_size), b = k.create(b), d.items.push(b), a.initialized ? c() : a.on("init", c))) }), c.push({ type: "toolbar", layout: "flow", items: e }), !0 } var c = []; if (tinymce.isArray(j.toolbar)) { if (0 === j.toolbar.length) return; tinymce.each(j.toolbar, function (a, b) { j["toolbar" + (b + 1)] = a }), delete j.toolbar } for (var d = 1; 10 > d && b(j["toolbar" + d]); d++); return c.length || j.toolbar === !1 || b(j.toolbar || o), c.length ? { type: "panel", layout: "stack", classes: "toolbar-grp", ariaRoot: !0, ariaRemember: !0, items: c} : void 0 } function c() { function b(b) { var c; return "|" == b ? { text: "|"} : c = a.menuItems[b] } function c(c) { var d, e, f, g, h; if (h = tinymce.makeMap((j.removed_menuitems || "").split(/[ ,]/)), j.menu ? (e = j.menu[c], g = !0) : e = n[c], e) { d = { text: e.title }, f = [], l((e.items || "").split(/[ ,]/), function (a) { var c = b(a); c && !h[a] && f.push(b(a)) }), g || l(a.menuItems, function (a) { a.context == c && ("before" == a.separator && f.push({ text: "|" }), a.prependToContext ? f.unshift(a) : f.push(a), "after" == a.separator && f.push({ text: "|" })) }); for (var i = 0; i < f.length; i++) "|" == f[i].text && (0 === i || i == f.length - 1) && f.splice(i, 1); if (d.menu = f, !d.menu.length) return null } return d } var d, e = [], f = []; if (j.menu) for (d in j.menu) f.push(d); else for (d in n) f.push(d); for (var g = "string" == typeof j.menubar ? j.menubar.split(/[ ,]/) : f, h = 0; h < g.length; h++) { var i = g[h]; i = c(i), i && e.push(i) } return e } function d(b) { function c(a) { var c = b.find(a)[0]; c && c.focus(!0) } a.shortcuts.add("Alt+F9", "", function () { c("menubar") }), a.shortcuts.add("Alt+F10", "", function () { c("toolbar") }), a.shortcuts.add("Alt+F11", "", function () { c("elementpath") }), b.on("cancel", function () { a.focus() }) } function e(b, c) { function d(a) { return { width: a.clientWidth, height: a.clientHeight} } var e, f, g, h; e = a.getContainer(), f = a.getContentAreaContainer().firstChild, g = d(e), h = d(f), null !== b && (b = Math.max(j.min_width || 100, b), b = Math.min(j.max_width || 65535, b), m.setStyle(e, "width", b + (g.width - h.width)), m.setStyle(f, "width", b)), c = Math.max(j.min_height || 100, c), c = Math.min(j.max_height || 65535, c), m.setStyle(f, "height", c), a.fire("ResizeEditor") } function f(b, c) { var d = a.getContentAreaContainer(); i.resizeTo(d.clientWidth + b, d.clientHeight + c) } function g(e) { function f() { if (n && n.moveRel && n.visible() && !n._fixed) { var b = a.selection.getScrollContainer(), c = a.getBody(), d = 0, e = 0; if (b) { var f = m.getPos(c), g = m.getPos(b); d = Math.max(0, g.x - f.x), e = Math.max(0, g.y - f.y) } n.fixed(!1).moveRel(c, a.rtl ? ["tr-br", "br-tr"] : ["tl-bl", "bl-tl", "tr-br"]).moveBy(d, e) } } function g() { n && (n.show(), f(), m.addClass(a.getBody(), "mce-edit-focus")) } function h() { n && (n.hide(), m.removeClass(a.getBody(), "mce-edit-focus")) } function l() { return n ? void (n.visible() || g()) : (n = i.panel = k.create({ type: o ? "panel" : "floatpanel", role: "application", classes: "tinymce tinymce-inline", layout: "flex", direction: "column", align: "stretch", autohide: !1, autofix: !0, fixed: !!o, border: 1, items: [j.menubar === !1 ? null : { type: "menubar", border: "0 0 1 0", items: c() }, b()] }), a.fire("BeforeRenderUI"), n.renderTo(o || document.body).reflow(), d(n), g(), a.on("nodeChange", f), a.on("activate", g), a.on("deactivate", h), void a.nodeChanged()) } var n, o; return j.fixed_toolbar_container && (o = m.select(j.fixed_toolbar_container)[0]), j.content_editable = !0, a.on("focus", function () { e.skinUiCss ? tinymce.DOM.styleSheetLoader.load(e.skinUiCss, l, l) : l() }), a.on("blur hide", h), a.on("remove", function () { n && (n.remove(), n = null) }), e.skinUiCss && tinymce.DOM.styleSheetLoader.load(e.skinUiCss), {} } function h(f) { var g, h, l; return /*f.skinUiCss&&tinymce.DOM.loadCSS(f.skinUiCss)*/true, g = i.panel = k.create({ type: "panel", role: "application", classes: "tinymce", style: "visibility: hidden", layout: "stack", border: 1, items: [j.menubar === !1 ? null : { type: "menubar", border: "0 0 1 0", items: c() }, b(), { type: "panel", name: "iframe", layout: "stack", classes: "edit-area", html: "", border: "1 0 0 0"}] }), j.resize !== !1 && (h = { type: "resizehandle", direction: j.resize, onResizeStart: function () { var b = a.getContentAreaContainer().firstChild; l = { width: b.clientWidth, height: b.clientHeight} }, onResize: function (a) { "both" == j.resize ? e(l.width + a.deltaX, l.height + a.deltaY) : e(null, l.height + a.deltaY) } }), j.statusbar !== !1 && g.add({ type: "panel", name: "statusbar", classes: "statusbar", layout: "flow", border: "1 0 0 0", ariaRoot: !0, items: [{ type: "elementpath" }, h] }), j.readonly && g.find("*").disabled(!0), a.fire("BeforeRenderUI"), g.renderBefore(f.targetNode).reflow(), j.width && tinymce.DOM.setStyle(g.getEl(), "width", j.width), a.on("remove", function () { g.remove(), g = null }), d(g), { iframeContainer: g.find("#iframe")[0].getEl(), editorContainer: g.getEl()} } var i = this, j = a.settings, k = tinymce.ui.Factory, l = tinymce.each, m = tinymce.DOM, n = { file: { title: "File", items: "newdocument" }, edit: { title: "Edit", items: "undo redo | cut copy paste pastetext | selectall" }, insert: { title: "Insert", items: "|" }, view: { title: "View", items: "visualaid |" }, format: { title: "Format", items: "bold italic underline strikethrough superscript subscript | formats | removeformat" }, table: { title: "Table" }, tools: { title: "Tools"} }, o = "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"; i.renderUI = function (b) { var c = j.skin !== !1 ? j.skin || "lightgray" : !1; if (c) { var d = j.skin_url; d = d ? a.documentBaseURI.toAbsolute(d) : tinymce.baseURL + "/skins/" + c, b.skinUiCss = tinymce.Env.documentMode <= 7 ? d + "/skin.ie7.min.css" : d + "/skin.min.css", a.contentCSS.push(d + "/content" + (a.inline ? ".inline" : "") + ".min.css") } return a.on("ProgressState", function (a) { i.throbber = i.throbber || new tinymce.ui.Throbber(i.panel.getEl("body")), a.state ? i.throbber.show(a.time) : i.throbber.hide() }), j.inline ? g(b) : h(b) }, i.resizeTo = e, i.resizeBy = f });;
